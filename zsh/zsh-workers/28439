From zsh-workers-return-28439-mason-zsh=primenet.com.au@zsh.org Wed Nov 24 15:27:53 2010
Return-Path: <zsh-workers-return-28439-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7435 invoked by alias); 24 Nov 2010 15:27:53 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28439
Received: (qmail 24178 invoked from network); 24 Nov 2010 15:27:50 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_LOW,
	SPF_HELO_PASS autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at csr.com does not designate permitted sender hosts)
Date: Wed, 24 Nov 2010 15:24:08 +0000
From: Peter Stephenson <Peter.Stephenson@csr.com>
To: Sorin Ionescu <sorin.ionescu@gmail.com>, zsh-workers@zsh.org
Subject: Re: Mac OS X Prompt Bug
Message-ID: <20101124152408.3c901d79@pwslap01u.europe.root.pri>
In-Reply-To: <BAB9C52A-B68A-4B5A-99C2-F85B310B1380@gmail.com>
References: <BAB9C52A-B68A-4B5A-99C2-F85B310B1380@gmail.com>
Organization: Cambridge Silicon Radio
X-Mailer: Claws Mail 3.7.6 (GTK+ 2.20.1; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 24 Nov 2010 15:24:08.0371 (UTC) FILETIME=[A3503830:01CB8BEB]
X-Scanned-By: MailControl A_10_80_00 (www.mailcontrol.com) on 10.68.1.127

On Wed, 24 Nov 2010 08:58:26 -0500
Sorin Ionescu <sorin.ionescu@gmail.com> wrote:
> A % character appears before every prompt then it is replaced by the
> prompt; so, it only flashes for a fraction of a second. However, if
> the buffer is empty when ZSH starts, such as when one has a
> ~/.hushlogin file, it results in the behaviour in the screenshot,
> which is % character followed by blank lines. 

That's almost certainly a side-effect of the PROMPT_SP option, see the
manual entry. This gets printed at the start of the line, then covered
over by the prompt itself.

Somehow in the case you're showing some output is coming out between zsh
printing the mark and printing the prompt itself.  I have no idea where
that would be, but the pre-prompt activities are carried out quite
early, before the line editor is set up, so there is a reasonable amount
of scope for it.

If you don't have time to track down where the extra output is coming
from, turning off the PROMPT_SP option should make the mark go away.

-- 
Peter Stephenson <pws@csr.com>            Software Engineer
Tel: +44 (0)1223 692070                   Cambridge Silicon Radio Limited
Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, UK


Member of the CSR plc group of companies. CSR plc registered in England and Wales, registered number 4187346, registered office Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, United Kingdom

