From zsh-users-return-10233-mason-zsh=primenet.com.au@sunsite.dk Wed May 10 09:23:05 2006
Return-Path: <zsh-users-return-10233-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3820 invoked from network); 10 May 2006 09:22:56 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.1 (2006-03-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO,
	HTML_MESSAGE autolearn=ham version=3.1.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 10 May 2006 09:22:56 -0000
Received: (qmail 51815 invoked from network); 10 May 2006 09:22:40 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 May 2006 09:22:40 -0000
Received: (qmail 14529 invoked by alias); 10 May 2006 09:22:31 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10233
Received: (qmail 14518 invoked from network); 10 May 2006 09:22:31 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 10 May 2006 09:22:31 -0000
Received: (qmail 50661 invoked from network); 10 May 2006 09:22:31 -0000
Received: from smtp.eu.citrix.com (195.153.38.115)
  by a.mx.sunsite.dk with SMTP; 10 May 2006 09:22:30 -0000
Received: from lonpexchmx01.citrite.net ([10.30.224.191])
  by SMTP.EU.CITRIX.COM with ESMTP; 10 May 2006 10:22:13 +0100
X-IronPort-AV: i="4.05,108,1146438000"; 
   d="scan'208,217"; a="5078543:sNHT58289720"
Received: from lonpexch01.citrite.net ([10.30.224.136]) by lonpexchmx01.citrite.net with Microsoft SMTPSVC(6.0.3790.1830);
	 Wed, 10 May 2006 10:22:12 +0100
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01C67413.384B2AFB"
Subject: Parameter expansion flags question
Date: Wed, 10 May 2006 10:22:12 +0100
Message-ID: <DD74FBB8EE28D441903D56487861CD9D0971728B@lonpexch01.citrite.net>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Parameter expansion flags question
Thread-Index: AcZ0EzhN8LTv/NUXSdqKylXHm/HXgA==
From: "John Cooper" <john.cooper@eu.citrix.com>
To: <zsh-users@sunsite.dk>
X-OriginalArrivalTime: 10 May 2006 09:22:12.0901 (UTC) FILETIME=[38933550:01C67413]

This is a multi-part message in MIME format.

------_=_NextPart_001_01C67413.384B2AFB
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

I've been writing a function to run a command, extract the first word of
each line of the command's output and use that as a parameter to another
command. The command's output looks like this:

		1:/Citrix/Pres  WI
http://RA.eng.citrite.net/Citrix/Pres   4.5.5.1159
c:\inetpub\wwwroot\Citrix\Pres =20
		1:/Citrix/Pres2 WI
http://RA.eng.citrite.net/Citrix/Pres2  4.5.5.1159
c:\inetpub\wwwroot\Citrix\Pres2=20

After some trial-and-error I finally have the following function:

		SITEMGR=3Dc:/Program\ Files/Citrix/Web\
Interface/4.5/sitemgr.exe
		delsites() {
		    for site in "${(f)$($SITEMGR -i)}" ; {
			sitepath=3D${${=3Dsite}[1]}
			[[ -n "$sitepath" ]] && $SITEMGR -r
"WICurrent=3D$sitepath"
		    }
		}

I'm new to the zsh parameter expansion flags, but I've gathered the
${(f) will take the command's output a line at a time, and the =
${=3Dsite}
will then split each line into words, allowing me to grab the first word
of each line.

Is there a better (or simpler!) way to do this?  When the command has no
output, the `for' loop is still executed once (seemingly because the
command is within double-quotes) and is the reason for checking that the
length of $sitepath is non-zero. Is there a way to avoid the loop being
entered when the command has no output and avoid the need for this
check?

(btw, is there a good set of examples of using parameter expansion
flags? The zsh guide seemed a bit sparse in this area)

Thanks,

    --- John


------_=_NextPart_001_01C67413.384B2AFB
Content-Type: text/html;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV=3D"Content-Type" CONTENT=3D"text/html; =
charset=3Dus-ascii">
<META NAME=3D"Generator" CONTENT=3D"MS Exchange Server version =
6.5.7638.1">
<TITLE>Parameter expansion flags question</TITLE>
</HEAD>
<BODY>
<!-- Converted from text/rtf format -->

<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">I</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">&#8217;</FONT></SPAN><SPAN LANG=3D"en-us"><FONT =
SIZE=3D2 FACE=3D"Verdana">ve been</FONT></SPAN><SPAN LANG=3D"en-us"> =
<FONT SIZE=3D2 FACE=3D"Verdana">writing a function to</FONT></SPAN><SPAN =
LANG=3D"en-us"> <FONT SIZE=3D2 FACE=3D"Verdana">run a =
command</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">,</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana"> extract the first word of each line of =
the</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 FACE=3D"Verdana"> =
command</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">&#8217;</FONT></SPAN><SPAN LANG=3D"en-us"><FONT =
SIZE=3D2 FACE=3D"Verdana">s output and use that as a parameter to =
another command. The command</FONT></SPAN><SPAN LANG=3D"en-us"><FONT =
SIZE=3D2 FACE=3D"Verdana">&#8217;</FONT></SPAN><SPAN =
LANG=3D"en-us"><FONT SIZE=3D2 FACE=3D"Verdana">s output looks like =
this:</FONT></SPAN><SPAN LANG=3D"en-us"></SPAN></P>
<UL><UL>
<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">1:/Citrix/Pres&nbsp; WI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
<A =
HREF=3D"http://RA.eng.citrite.net/Citrix/Pres">http://RA.eng.citrite.net/=
Citrix/Pres</A>&nbsp;&nbsp; 4.5.5.1159&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
c:\inetpub\wwwroot\Citrix\Pres&nbsp; </FONT></SPAN></P>

<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">1:/Citrix/Pres2 WI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A =
HREF=3D"http://RA.eng.citrite.net/Citrix/Pres2">http://RA.eng.citrite.net=
/Citrix/Pres2</A>&nbsp; 4.5.5.1159&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
c:\inetpub\wwwroot\Citrix\Pres2</FONT></SPAN><SPAN LANG=3D"en-us"> =
</SPAN></P>
</UL></UL>
<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">After some trial-and-error I finally have the following =
function:</FONT></SPAN></P>
<UL><UL>
<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">SITEMGR=3Dc:/Program\ Files/Citrix/Web\ =
Interface/4.5/sitemgr.exe</FONT></SPAN></P>

<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">delsites() {</FONT></SPAN></P>

<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">&nbsp;&nbsp;&nbsp; for site in &quot;${(f)$($SITEMGR =
-i)}&quot; ; {</FONT></SPAN></P>

<P ALIGN=3DLEFT><SPAN =
LANG=3D"en-us">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT SIZE=3D2 =
FACE=3D"Verdana">sitepath=3D${${=3Dsite}[1]}</FONT></SPAN></P>

<P ALIGN=3DLEFT><SPAN =
LANG=3D"en-us">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT SIZE=3D2 =
FACE=3D"Verdana">[[ -n &quot;$sitepath&quot; ]] &amp;&amp; $SITEMGR -r =
&quot;WICurrent=3D$sitepath&quot;</FONT></SPAN></P>

<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">&nbsp;&nbsp;&nbsp; }</FONT></SPAN></P>

<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">}</FONT></SPAN><SPAN LANG=3D"en-us"></SPAN></P>
</UL></UL>
<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">I</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">&#8217;</FONT></SPAN><SPAN LANG=3D"en-us"><FONT =
SIZE=3D2 FACE=3D"Verdana">m new to</FONT></SPAN><SPAN LANG=3D"en-us"> =
<FONT SIZE=3D2 FACE=3D"Verdana">the</FONT></SPAN><SPAN LANG=3D"en-us"> =
<FONT SIZE=3D2 FACE=3D"Verdana">zsh</FONT></SPAN><SPAN LANG=3D"en-us"> =
<FONT SIZE=3D2 FACE=3D"Verdana">parameter</FONT></SPAN><SPAN =
LANG=3D"en-us"> <FONT SIZE=3D2 =
FACE=3D"Verdana">expansion</FONT></SPAN><SPAN LANG=3D"en-us"><FONT =
SIZE=3D2 FACE=3D"Verdana"> flags</FONT></SPAN><SPAN LANG=3D"en-us"><FONT =
SIZE=3D2 FACE=3D"Verdana">, but I</FONT></SPAN><SPAN =
LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">&#8217;</FONT></SPAN><SPAN LANG=3D"en-us"><FONT =
SIZE=3D2 FACE=3D"Verdana">ve</FONT></SPAN><SPAN LANG=3D"en-us"><FONT =
SIZE=3D2 FACE=3D"Verdana"> gather</FONT></SPAN><SPAN =
LANG=3D"en-us"><FONT SIZE=3D2 FACE=3D"Verdana">ed</FONT></SPAN><SPAN =
LANG=3D"en-us"><FONT SIZE=3D2 FACE=3D"Verdana"> the ${(f) will take the =
command</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">&#8217;</FONT></SPAN><SPAN LANG=3D"en-us"><FONT =
SIZE=3D2 FACE=3D"Verdana">s output a line at a time, and the =
${=3D</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">site} will</FONT></SPAN><SPAN LANG=3D"en-us"> <FONT =
SIZE=3D2 FACE=3D"Verdana">then</FONT></SPAN><SPAN LANG=3D"en-us"> <FONT =
SIZE=3D2 FACE=3D"Verdana">split each line into words, allowing me to =
grab the first word of each line.</FONT></SPAN><SPAN =
LANG=3D"en-us"></SPAN></P>

<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"><FONT SIZE=3D2 FACE=3D"Verdana">Is =
there a better</FONT></SPAN><SPAN LANG=3D"en-us"> <FONT SIZE=3D2 =
FACE=3D"Verdana">(</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">or</FONT></SPAN><SPAN LANG=3D"en-us"> <FONT SIZE=3D2 =
FACE=3D"Verdana">simpler!)</FONT></SPAN><SPAN LANG=3D"en-us"> <FONT =
SIZE=3D2 FACE=3D"Verdana">way to do this?&nbsp; When the =
command</FONT></SPAN><SPAN LANG=3D"en-us"> <FONT SIZE=3D2 =
FACE=3D"Verdana">has no output, the `for</FONT></SPAN><SPAN =
LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">&#8217;</FONT></SPAN><SPAN LANG=3D"en-us"><FONT =
SIZE=3D2 FACE=3D"Verdana"> loop is still executed once =
(</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">seemingly because the command is within =
double-quotes</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">) and is the reason for checking</FONT></SPAN><SPAN =
LANG=3D"en-us"> <FONT SIZE=3D2 FACE=3D"Verdana">that the length =
of</FONT></SPAN><SPAN LANG=3D"en-us"> <FONT SIZE=3D2 =
FACE=3D"Verdana">$</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">sitepath is non-zero.</FONT></SPAN><SPAN =
LANG=3D"en-us"><FONT SIZE=3D2 FACE=3D"Verdana"> Is there a way to avoid =
the loop being entered when the command has no output</FONT></SPAN><SPAN =
LANG=3D"en-us"><FONT SIZE=3D2 FACE=3D"Verdana"> and avoid the need for =
this check</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">?</FONT></SPAN><SPAN LANG=3D"en-us"></SPAN></P>

<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">(</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">btw,</FONT></SPAN><SPAN LANG=3D"en-us"> <FONT SIZE=3D2 =
FACE=3D"Verdana">is there a good set of examples</FONT></SPAN><SPAN =
LANG=3D"en-us"> <FONT SIZE=3D2 FACE=3D"Verdana">of using parameter =
expansion flags? T</FONT></SPAN><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">he zsh guide seemed a bit sparse in this =
area)</FONT></SPAN><SPAN LANG=3D"en-us"></SPAN></P>

<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"><FONT SIZE=3D2 =
FACE=3D"Verdana">Thanks,</FONT></SPAN></P>

<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"></SPAN><A NAME=3D""><SPAN =
LANG=3D"en-us"><FONT SIZE=3D2 FACE=3D"Verdana">&nbsp;&nbsp;&nbsp; --- =
John</FONT></SPAN></A><SPAN LANG=3D"en-us"></SPAN><SPAN =
LANG=3D"en-us"></SPAN></P>

<P ALIGN=3DLEFT><SPAN LANG=3D"en-us"></SPAN></P>

</BODY>
</HTML>
------_=_NextPart_001_01C67413.384B2AFB--

