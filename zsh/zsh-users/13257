From zsh-users-return-13257-mason-zsh=primenet.com.au@sunsite.dk Fri Sep 19 10:41:10 2008
Return-Path: <zsh-users-return-13257-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17324 invoked from network); 19 Sep 2008 10:41:07 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00,HTML_MESSAGE
	autolearn=ham version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 19 Sep 2008 10:41:07 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 95694 invoked from network); 19 Sep 2008 10:40:48 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 19 Sep 2008 10:40:48 -0000
Received: (qmail 19550 invoked by alias); 19 Sep 2008 10:40:07 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13257
Received: (qmail 19510 invoked from network); 19 Sep 2008 10:40:02 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 19 Sep 2008 10:40:02 -0000
Received: from qb-out-0506.google.com (qb-out-0506.google.com [72.14.204.232])
	by bifrost.dotsrc.org (Postfix) with ESMTP id BEFF180309AD
	for <zsh-users@sunsite.dk>; Fri, 19 Sep 2008 12:39:40 +0200 (CEST)
Received: by qb-out-0506.google.com with SMTP id o21so277231qba.37
        for <zsh-users@sunsite.dk>; Fri, 19 Sep 2008 03:39:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from:to
         :subject:cc:in-reply-to:mime-version:content-type:references;
        bh=ranFV9Ou0ypmom84/ogNb2JpNM34kgQs/80L9XQnnVk=;
        b=gmGZw/th+GWqb7o2IHw4sj1jz7f3GOrD5J48jFdcv4EXgtAgyaHLQvg8POXuHS50kh
         jFxEGsW5MoapcJ5PQDHcZcKkFwnhzYz9GpIBFy+PB6nwpLMsHcXkdQlKZb8PPlo42duw
         Y4wxOglTnHtkXdWDfMLq/DEEimyHIsh2vo6WQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:to:subject:cc:in-reply-to:mime-version
         :content-type:references;
        b=DC4JZiT/ZWHpXgLQrgHdKp2eNAD/2FiP8oQZVP0TKeu0Kkz6MuDz+2icJgGKUFI4Am
         tosAmtCpgNrpaiROK5JYguhT63sZ4DG2BlzhF51YEKrXthz8Wd1trOksR5HPeFvwKEZ/
         C3r/m5rkxCrT3A6Ds9DLKtsYcRqgh4xEel36I=
Received: by 10.114.234.13 with SMTP id g13mr5281507wah.176.1221820769028;
        Fri, 19 Sep 2008 03:39:29 -0700 (PDT)
Received: by 10.114.159.2 with HTTP; Fri, 19 Sep 2008 03:39:28 -0700 (PDT)
Message-ID: <6cd6de210809190339g57a4e722u5ad1371e858c8501@mail.gmail.com>
Date: Fri, 19 Sep 2008 06:39:28 -0400
From: "Rocky Bernstein" <rocky.bernstein@gmail.com>
To: "Peter Stephenson" <pws@csr.com>
Subject: Re: reading a file into an array. mapfile? (f)?
Cc: "zsh users mailing list" <zsh-users@sunsite.dk>
In-Reply-To: <20080919100725.5c471019@news01>
MIME-Version: 1.0
Content-Type: multipart/alternative; 
	boundary="----=_Part_22092_13672178.1221820769018"
References: <6cd6de210809171953pd956d75gd4b3609ac036fe0@mail.gmail.com>
	 <080917214418.ZM27616@torch.brasslantern.com>
	 <6cd6de210809181747kc0f0a5bt4489f534589725a8@mail.gmail.com>
	 <20080919100725.5c471019@news01>
X-Virus-Scanned: ClamAV 0.92.1/8287/Fri Sep 19 10:13:26 2008 on bifrost
X-Virus-Status: Clean

------=_Part_22092_13672178.1221820769018
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

This doesn't seem to work for me. What am I doing wrong?

Here is my test program

zmodload -ap zsh/mapfile mapfile
echo 'line 1' > ./file.txt
echo '' >> ./file.txt
echo 'line 2' >> ./file.txt
text=( "${(f)mapfile[./file.txt]}" )
declare -p text
print ${#text[@]} lines

text=( "${(f)mapfile[/src/external-cvs/zsh/configure]}" )
print ${#text[@]} lines
wc -l /src/external-cvs/zsh/configure

And here is the output I get:

typeset -a text
text=('line 1' 'line 2' '')
3 lines
18726 lines
21124 /src/external-cvs/zsh/configure

Further tests show that the behavior seems to be to drop blank lines but put
one at the end of the file.

Thanks.





On Fri, Sep 19, 2008 at 5:07 AM, Peter Stephenson <pws@csr.com> wrote:

> On Thu, 18 Sep 2008 20:47:00 -0400
> "Rocky Bernstein" <rocky.bernstein@gmail.com> wrote:
> > On Thu, Sep 18, 2008 at 12:44 AM, Bart Schaefer
> > <schaefer@brasslantern.com>wrote:
> > > It's much simpler than you seem to believe:
> > >
> > > lines=( ${(f)mapfile[/path/to/file]} )
> >
> >
> > Doesn't seem to work if the file (/path/to/file) has 0-length lines.
> These
> > don't get stored in the array (lines).
>
> Try
>
> lines=( "${(f)mapfile[/path/to/file]}" )
>
> Explanation:  without the quotes, elements that turn into an empty string
> are removed.  (f) includes the effect of the (@) flag, which is a
> generalised equivalent of the behaviour of "${array[@]}", so simply adding
> the quotes is enough to get the empty lines.
>
> I'd better update the change I made to the mapfile documentation.
>
> --
> Peter Stephenson <pws@csr.com>                  Software Engineer
> CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
> Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070
>

------=_Part_22092_13672178.1221820769018
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

<div dir="ltr">This doesn&#39;t seem to work for me. What am I doing wrong?<br><br>Here is my test program<br><br>zmodload -ap zsh/mapfile mapfile<br>echo &#39;line 1&#39; &gt; ./file.txt<br>echo &#39;&#39; &gt;&gt; ./file.txt<br>
echo &#39;line 2&#39; &gt;&gt; ./file.txt<br>text=( &quot;${(f)mapfile[./file.txt]}&quot; )<br>declare -p text<br>print ${#text[@]} lines<br><br>text=( &quot;${(f)mapfile[/src/external-cvs/zsh/configure]}&quot; )<br>print ${#text[@]} lines<br>
wc -l /src/external-cvs/zsh/configure<br><br>And here is the output I get:<br><br>typeset -a text<br>text=(&#39;line 1&#39; &#39;line 2&#39; &#39;&#39;)<br>3 lines<br>18726 lines<br>21124 /src/external-cvs/zsh/configure<br>
<br>Further tests show that the behavior seems to be to drop blank lines but put one at the end of the file.<br><br>Thanks.<br><br><br><br><br><br><div class="gmail_quote">On Fri, Sep 19, 2008 at 5:07 AM, Peter Stephenson <span dir="ltr">&lt;<a href="mailto:pws@csr.com">pws@csr.com</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">On Thu, 18 Sep 2008 20:47:00 -0400<br>
<div class="Ih2E3d">&quot;Rocky Bernstein&quot; &lt;<a href="mailto:rocky.bernstein@gmail.com">rocky.bernstein@gmail.com</a>&gt; wrote:<br>
</div><div class="Ih2E3d">&gt; On Thu, Sep 18, 2008 at 12:44 AM, Bart Schaefer<br>
&gt; &lt;<a href="mailto:schaefer@brasslantern.com">schaefer@brasslantern.com</a>&gt;wrote:<br>
&gt; &gt; It&#39;s much simpler than you seem to believe:<br>
&gt; &gt;<br>
&gt; &gt; lines=( ${(f)mapfile[/path/to/file]} )<br>
&gt;<br>
&gt;<br>
&gt; Doesn&#39;t seem to work if the file (/path/to/file) has 0-length lines. These<br>
&gt; don&#39;t get stored in the array (lines).<br>
<br>
</div>Try<br>
<div class="Ih2E3d"><br>
lines=( &quot;${(f)mapfile[/path/to/file]}&quot; )<br>
<br>
</div>Explanation: &nbsp;without the quotes, elements that turn into an empty string<br>
are removed. &nbsp;(f) includes the effect of the (@) flag, which is a<br>
generalised equivalent of the behaviour of &quot;${array[@]}&quot;, so simply adding<br>
the quotes is enough to get the empty lines.<br>
<br>
I&#39;d better update the change I made to the mapfile documentation.<br>
<div><div></div><div class="Wj3C7c"><br>
--<br>
Peter Stephenson &lt;<a href="mailto:pws@csr.com">pws@csr.com</a>&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Software Engineer<br>
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road<br>
Cambridge, CB4 0WZ, UK &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Tel: +44 (0)1223 692070<br>
</div></div></blockquote></div><br></div>

------=_Part_22092_13672178.1221820769018--

