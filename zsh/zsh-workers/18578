From zsh-workers-return-18578-mason-zsh=primenet.com.au@sunsite.dk Sat May 24 22:42:20 2003
Return-Path: <zsh-workers-return-18578-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17900 invoked from network); 24 May 2003 22:42:19 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 24 May 2003 22:42:19 -0000
Received: (qmail 3961 invoked by alias); 24 May 2003 22:42:13 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18578
Received: (qmail 3954 invoked from network); 24 May 2003 22:42:13 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 24 May 2003 22:42:13 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [195.92.195.173] by sunsite.dk (MessageWall 1.0.8) with SMTP; 24 May 2003 22:42:13 -0000
Received: from modem-33.tennessee.dialup.pol.co.uk ([62.137.93.33] helo=pwstephenson.fsnet.co.uk)
	by cmailg3.svr.pol.co.uk with esmtp (Exim 4.14)
	id 19JhiN-0001tF-Eq; Sat, 24 May 2003 23:42:11 +0100
Received: by pwstephenson.fsnet.co.uk (Postfix, from userid 501)
	id 393F11B76D; Sat, 24 May 2003 23:42:57 +0100 (BST)
Received: from pwstephenson.fsnet.co.uk (localhost [127.0.0.1])
	by pwstephenson.fsnet.co.uk (Postfix) with ESMTP
	id 089E61B76C; Sat, 24 May 2003 23:42:56 +0100 (BST)
To: Vin Shelton <acs@alumni.princeton.edu>
Cc: zsh-workers@sunsite.dk
Subject: Re: Test Failures in Latest CVS 
In-reply-to: "Vin Shelton"'s message of "Fri, 23 May 2003 20:49:10 EDT."
             <m21xyp1855.fsf@zion.rcn.com> 
Date: Sat, 24 May 2003 23:42:51 +0100
From: Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Message-Id: <20030524224257.393F11B76D@pwstephenson.fsnet.co.uk>

Vin Shelton wrote:
> Hello,
> 
> The 5/21 build passes all tests, but builds from the current CVS do not:

This is because I changed OPT_ISSET() to return either 1 or 0, based on
noticing that some code expects that, but other bits of code were using
OPT_ISSET() to test for specific bits.

Index: Src/builtin.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/builtin.c,v
retrieving revision 1.101
diff -u -r1.101 builtin.c
--- Src/builtin.c	15 May 2003 09:39:57 -0000	1.101
+++ Src/builtin.c	24 May 2003 22:39:26 -0000
@@ -2145,7 +2145,7 @@
     }
 
     if (!(OPT_ISSET(ops,'g') || OPT_ISSET(ops,'x') || OPT_ISSET(ops,'m')) || 
-	OPT_ISSET(ops,'g') == 2 || *name == 'l' ||
+	OPT_PLUS(ops,'g') || *name == 'l' ||
 	(!isset(GLOBALEXPORT) && !OPT_ISSET(ops,'g')))
 	on |= PM_LOCAL;
 
@@ -2263,7 +2263,7 @@
 		returnval = 1;
 		continue;
 	    }
-	    if (OPT_PLUS(ops,'m') == 2 && !asg->value) {
+	    if (OPT_PLUS(ops,'m') && !asg->value) {
 		scanmatchtable(paramtab, pprog, on|roff, 0,
 			       paramtab->printnode, printflags);
 		continue;
@@ -2351,7 +2351,7 @@
     int on = 0, off = 0, pflags = 0;
 
     /* Do we have any flags defined? */
-    if (OPT_ISSET(ops,'u') == 2)
+    if (OPT_PLUS(ops,'u'))
 	off |= PM_UNDEFINED;
     else if (OPT_MINUS(ops,'u') || OPT_ISSET(ops,'X'))
 	on |= PM_UNDEFINED;

-- 
Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Work: pws@csr.com
Web: http://www.pwstephenson.fsnet.co.uk

