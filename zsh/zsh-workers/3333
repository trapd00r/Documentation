From zsh-workers-request@euclid.skiles.gatech.edu Wed Jul 02 06:11:46 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 10364 invoked from network); 2 Jul 1997 06:11:43 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 2 Jul 1997 06:11:43 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id BAA04701; Wed, 2 Jul 1997 01:34:23 -0400 (EDT)
Resent-Date: Wed, 2 Jul 1997 01:34:23 -0400 (EDT)
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <970701224347.ZM7707@candle.brasslantern.com>
Date: Tue, 1 Jul 1997 22:43:47 -0700
In-Reply-To: <m0wjGP0-000AgCC@malachit.Informatik.Uni-Oldenburg.DE>
Comments: In reply to "Ingo Wilken" <Ingo.Wilken@Informatik.Uni-Oldenburg.DE>
        "Completion bug introduced in 3.0.3" (Jul  2,  5:48am)
References: <m0wjGP0-000AgCC@malachit.Informatik.Uni-Oldenburg.DE> 
	<slrn5rjmvs.94h.mason@coral.primenet.com.au>
In-Reply-To: <slrn5rjmvs.94h.mason@coral.primenet.com.au>
Comments: In reply to mason@primenet.com.au (Geoff Wing)
        "Re: Completion bug introduced in 3.0.3" (Jul  2,  4:41am)
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: "Ingo Wilken" <Ingo.Wilken@Informatik.Uni-Oldenburg.DE>,
        zsh-workers@math.gatech.edu, mason@primenet.com.au
Subject: Re: Completion bug introduced in 3.0.3
Cc: ingo@malachit.Informatik.Uni-Oldenburg.DE (Ingo Wilken)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"ugs0S.0.O91.UXUkp"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3333
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On Jul 2,  5:48am, Ingo Wilken wrote:
} Subject: Completion bug introduced in 3.0.3
}
} Hi,
} 
} I just upgraded from zsh 3.0.0 to 3.0.4 and noticed a severe bug with
} filename completion in multiple-line commands.  I build all intermediate
} versions, and noticed that this bug was introduced with 3.0.3.

On Jul 2,  4:41am, Geoff Wing wrote:
} Subject: Re: Completion bug introduced in 3.0.3
}
} Reproduced gives:
} BUG: xorrec: ll != strlen(line)
} 
} Hopefully shouldn't be too hard for someone to find (someone else, that is :-)

I've confirmed that this bug is fixed by the patch to zle_utils.c that
PWS sent some days ago, which properly nul-terminates the `line' string.
My debugging version had the patch, my regular one did not, which is why
I was not able to reproduce with debugging.

Here's the patch again, against 3.0.4 instead of 3.1.2.

Index: Src/zle_utils.c
===================================================================
--- zle_utils.c	1997/06/27 18:37:08	1.1.1.3
+++ zle_utils.c	1997/06/29 02:21:59	1.4
@@ -73,7 +73,7 @@
 	line[to] = line[to + cnt];
 	to++;
     }
-    ll = to;
+    line[ll = to] = '\0';
 }
 
 /**/

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

