From zsh-workers-return-10554-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Apr 06 17:10:08 2000
Return-Path: <zsh-workers-return-10554-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17326 invoked from network); 6 Apr 2000 17:10:07 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 6 Apr 2000 17:10:07 -0000
Received: (qmail 7693 invoked by alias); 6 Apr 2000 17:10:01 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10554
Received: (qmail 7681 invoked from network); 6 Apr 2000 17:10:00 -0000
Date: Thu, 06 Apr 2000 18:09:33 +0100
From: Peter Stephenson <pws@cambridgesiliconradio.com>
Subject: Associative array index.
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Message-id: <0FSL00K3NUBW5N@la-la.cambridgesiliconradio.com>
Content-transfer-encoding: 7BIT

I'm sure we've had this discussion but the behaviour is still inconsistent.
The lexer and the parameter code disagree over the handling of associative
array indices.

% typeset -A foo
% foo=("'" ouch)
% print $foo['
quote> 

but

% print $foo[']'
ouch

Maybe the lexer can be educated, but doing it this way we are always going
to have problems with any expression with `]' in it, especially since no
form of quoting works in the [...].  I'd prefer to do it the way perl does
it, which is if you want quoting you add it yourself.  The current way of
doing it is supposed to be like a double-quoted string, but it isn't, as
this example shows.  I should offer a prize for anyone able to extract
the value of
  foo=("]" ouch)
by direct indexing.  Indirect indexing using a parameter is OK, although
this can get confused, too.

% print ${nonexistent:-"]"}
]
% print $foo[${nonexistent:-"]"}]
zsh: parse error

which shows how thoroughly horrible it is.

-- 
Peter Stephenson <pws@cambridgesiliconradio.com>
Cambridge Silicon Radio, Unit 300, Science Park, Milton Road,
Cambridge, CB4 0XL, UK                          Tel: +44 (0)1223 392070

