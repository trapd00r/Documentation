From zsh-workers-return-21598-mason-zsh=primenet.com.au@sunsite.dk Thu Aug 11 14:52:42 2005
Return-Path: <zsh-workers-return-21598-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23717 invoked from network); 11 Aug 2005 14:52:37 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 11 Aug 2005 14:52:37 -0000
Received: (qmail 71809 invoked from network); 11 Aug 2005 14:52:31 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 11 Aug 2005 14:52:31 -0000
Received: (qmail 2989 invoked by alias); 11 Aug 2005 14:52:27 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21598
Received: (qmail 2980 invoked from network); 11 Aug 2005 14:52:26 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 11 Aug 2005 14:52:26 -0000
Received: (qmail 71451 invoked from network); 11 Aug 2005 14:52:26 -0000
Received: from cluster-e.mailcontrol.com (HELO rly01e.srv.mailcontrol.com) (217.79.216.190)
  by a.mx.sunsite.dk with SMTP; 11 Aug 2005 14:52:16 -0000
Received: from iris.logica.co.uk (iris.logica.co.uk [158.234.9.163])
	by rly01e.srv.mailcontrol.com (MailControl) with ESMTP id j7BEqEc6023502
	for <zsh-workers@sunsite.dk>; Thu, 11 Aug 2005 15:52:14 +0100
Received: from trentino.logica.co.uk ([158.234.142.59])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id j7BEqETp009006
	for <zsh-workers@sunsite.dk>; Thu, 11 Aug 2005 15:52:14 +0100
Received: from trentino.groupinfra.com (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP id 2583E7EAE7
	for <zsh-workers@sunsite.dk>; Thu, 11 Aug 2005 16:52:14 +0200 (CEST)
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <20050808130547.GA651@scowler.net> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <20050802180158.GA10402@spiegl.de> <19401.1123058911@trentino.groupinfra.com> <20050803101007.GA9755@spiegl.de> <2356.1123064346@trentino.groupinfra.com> <20050805154030.GA16800@spiegl.de> <32449.1123262228@trentino.groupinfra.com> <20050805193652.GA6842@spiegl.de> <30056.1123491980@trentino.groupinfra.com> <237967ef050808051952243c18@mail.gmail.com> <20050808130547.GA651@scowler.net>
To: zsh-workers@sunsite.dk
Subject: Re: simple completion example? (aptitude completion doesn't work) 
Date: Thu, 11 Aug 2005 16:52:14 +0200
Message-ID: <27241.1123771934@trentino.groupinfra.com>
X-Scanned-By: MailControl A-05-01-05 (www.mailcontrol.com)
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.4

On 8 Aug, Clint Adams wrote:
> If people are setting LC_ALL (which is meant to override everything),
> shouldn't they be able to override everything?

That's certainly arguable. However, it looks like it'll just lead to us
getting bug reports. And it seems that people just set a load of LC_
variables with little idea of which take precedence.

The _aptitude that I checked in now uses LC_ALL. I'm also applying the
following patch to _subversion which also fixes Debian bug #322573
(sorry about that one, my fault).

Oliver
 
Index: Completion/Unix/Command/_subversion
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_subversion,v
retrieving revision 1.14
diff -u -r1.14 _subversion
--- Completion/Unix/Command/_subversion	8 Aug 2005 08:54:21 -0000	1.14
+++ Completion/Unix/Command/_subversion	11 Aug 2005 14:50:43 -0000
@@ -12,7 +12,7 @@
   if [[ -n $state ]] && (( ! $+_svn_cmds )); then
     typeset -gHA _svn_cmds
     _svn_cmds=(
-      ${=${(f)${${"$(LC_MESSAGES=C _call_program commands svn help)"#l#*Available subcommands:}%%Subversion is a tool*}}/(#s)[[:space:]]#(#b)([a-z]##)[[:space:]]#(\([a-z, ?]##\))#/$match[1] :$match[1]${match[2]:+:${${match[2]//[(),]}// /:}}:}
+      ${=${(f)${${"$(LC_ALL=C _call_program commands svn help)"#l#*Available subcommands:}%%Subversion is a tool*}}/(#s)[[:space:]]#(#b)([a-z]##)[[:space:]]#(\([a-z, ?]##\))#/$match[1] :$match[1]${match[2]:+:${${match[2]//[(),]}// /:}}:}
     )
   fi
 
@@ -28,9 +28,9 @@
       if (( $#cmd )); then
         curcontext="${curcontext%:*:*}:svn-${cmd}:"
 
-        usage=${${(M)${(f)"$(LC_MESSAGES=C _call_program options svn help $cmd)"}:#usage:*}#usage: $cmd] }
+        usage=${${(M)${(f)"$(LC_ALL=C _call_program options svn help $cmd)"}:#usage:*}#usage: $cmd] }
         args=(
-          ${=${${${(M)${(f)"$(LC_MESSAGES=C _call_program options svn help $cmd)"##*Valid options:}:#* :*}%% #:*}/ arg/:arg:}/(#b)-([[:alpha:]]) \[--([a-z-]##)\](:arg:)#/(--$match[2])-$match[1]$match[3] (-$match[1])--$match[2]$match[3]}
+          ${=${${${(M)${(f)"$(LC_ALL=C _call_program options svn help $cmd)"##*Valid options:}:#* :*}%% #:*}/ arg/:arg:}/(#b)-([[:alpha:]]) \[--([a-z-]##)\](:arg:)#/(--$match[2])-$match[1]$match[3] (-$match[1])--$match[2]$match[3]}
         )
 
         case $cmd in;
@@ -40,7 +40,7 @@
             )
           ;;
           commit)
-            args-+=(
+            args+=(
               '*:file:_files -g "*(e:_svn_status:)"'
             )
           ;;
@@ -101,7 +101,7 @@
   if [[ -n $state ]] && (( ! $+_svnadmin_cmds )); then
     typeset -gHA _svnadmin_cmds
     _svnadmin_cmds=(
-      ${=${(f)${${"$(LC_MESSAGES=C _call_program commands svnadmin help)"#l#*Available subcommands:}}}/(#s)[[:space:]]#(#b)([-a-z]##)[[:space:]]#(\([a-z, ?]##\))#/$match[1] :$match[1]${match[2]:+:${${match[2]//[(),]}// /:}}:}
+      ${=${(f)${${"$(LC_ALL=C _call_program commands svnadmin help)"#l#*Available subcommands:}}}/(#s)[[:space:]]#(#b)([-a-z]##)[[:space:]]#(\([a-z, ?]##\))#/$match[1] :$match[1]${match[2]:+:${${match[2]//[(),]}// /:}}:}
     )
   fi
 
@@ -116,9 +116,9 @@
       if (( $#cmd )); then
         curcontext="${curcontext%:*:*}:svnadmin-${cmd}:"
 
-        usage=${${(M)${(f)"$(LC_MESSAGES=C _call_program options svnadmin help $cmd)"}:#$cmd: usage:*}#$cmd: usage: svnadmin $cmd }
+        usage=${${(M)${(f)"$(LC_ALL=C _call_program options svnadmin help $cmd)"}:#$cmd: usage:*}#$cmd: usage: svnadmin $cmd }
         args=(
-          ${=${${${(M)${(f)"$(LC_MESSAGES=C _call_program options svnadmin help $cmd)"##*Valid options:}:#*:*}%% #:*}/ arg/:arg:}/(#b)-([[:alpha:]]) \[--([a-z-]##)\](:arg:)#/(--$match[2])-$match[1]$match[3] (-$match[1])--$match[2]$match[3]}
+          ${=${${${(M)${(f)"$(LC_ALL=C _call_program options svnadmin help $cmd)"##*Valid options:}:#*:*}%% #:*}/ arg/:arg:}/(#b)-([[:alpha:]]) \[--([a-z-]##)\](:arg:)#/(--$match[2])-$match[1]$match[3] (-$match[1])--$match[2]$match[3]}
         )
         if [[ $_svnadmin_subcmd_usage == *REPOS_PATH* ]]; then
           args+=( ":path:_files -/" )


This e-mail and any attachment is for authorised use by the intended recipient(s) only. It may contain proprietary material, confidential information and/or be subject to legal privilege. It should not be copied, disclosed to, retained or used by, any other party. If you are not an intended recipient then please promptly delete this e-mail and any attachment and all copies and inform the sender. Thank you.

