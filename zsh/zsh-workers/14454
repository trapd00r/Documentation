From zsh-workers-return-14454-mason-zsh=primenet.com.au@sunsite.dk Wed May 23 09:56:10 2001
Return-Path: <zsh-workers-return-14454-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21697 invoked from network); 23 May 2001 09:56:07 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 23 May 2001 09:56:07 -0000
Received: (qmail 13583 invoked by alias); 23 May 2001 09:55:54 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14454
Received: (qmail 13550 invoked from network); 23 May 2001 09:55:53 -0000
Message-ID: <Tc0a88d0153b1b5a119@mailsweeper01.cambridgesiliconradio.com>
To: zsh-workers@sunsite.dk
Subject: Re: compilation issues 
In-reply-to: "Oliver Kiddle"'s message of "Wed, 23 May 2001 10:06:27 BST."
             <3B0B7D93.F329904C@u.genie.co.uk> 
Date: Wed, 23 May 2001 10:55:02 +0100
From: Peter Stephenson <pws@csr.com>

Oliver Kiddle wrote:
> alpha Compaq Tru64 5.1
> 
> It was this machine where I got the V01zmodload test seg fault so it
> isn't just Solaris and Cygwin.

This sounds like it needs something added in Etc/MACHINES.

> sparc Sun Solaris 8, gcc
> 
> Presumably most people are using Sun's compiler for this but they only
> have gcc and it fails at its first invocation with this:

As I said yesterday, I had no problem at all with SunOS 5.8 with gcc with
the default configuration.  I was using gcc 2.95.2.  It could be another
manifestation of the problems with warnings in headers, but there are still
some odd things going on.

> gcc -c -I.  -DHAVE_CONFIG_H -Wall -Wno-implicit -Wmissing-prototypes -O2  -o builtin.o builtin.c
> In file included from zsh.mdh:15,
> 		   from builtin.c:30:
> system.h:155: redefinition of `struct timezone'

You should have

#define HAVE_STRUCT_TIMEZONE 1

which avoids this.  struct timezone is defined in sys/time.h:

#if (!defined(_POSIX_C_SOURCE) && !defined(_XOPEN_SOURCE)) || \
        defined(__EXTENSIONS__)
#ifndef _ASM
struct timezone {
        int     tz_minuteswest; /* minutes west of Greenwich */
        int     tz_dsttime;     /* type of dst correction */
};

#endif  /* _ASM */
#endif  /* (!defined(_POSIX_C_SOURCE) && !defined(_XOPEN_SOURCE))... */

> In file included from zsh.mdh:16,
> 		   from builtin.c:30:
> zsh.h:1469: field `tchars' has incomplete type

That means HAVE_TERMIO_H isn't being defined as it should be.

> In file included from zsh.mdh:41,
> 		   from builtin.c:30:
> jobs.epro:9: `MAXJOB' undeclared here (not in a function)

This is very suspicious --- this should be defined by configure in
config.h.  It should default to 50.

> In file included from zsh.mdh:53,
> 		   from builtin.c:30:
> signals.epro:27: parse error before `handler'
> signals.epro:27: warning: data definition has no type or storage class

That means RETSIGTYPE isn't being defined properly in config.h.  It ought
to be `void'.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR Ltd., Unit 300, Science Park, Milton Road,
Cambridge, CB4 0XL, UK                          Tel: +44 (0)1223 392070


**********************************************************************
The information transmitted is intended only for the person or
entity to which it is addressed and may contain confidential 
and/or privileged material. 
Any review, retransmission, dissemination or other use of, or
taking of any action in reliance upon, this information by 
persons or entities other than the intended recipient is 
prohibited.  
If you received this in error, please contact the sender and 
delete the material from any computer.
**********************************************************************

