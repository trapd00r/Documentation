From zsh-workers-return-8916-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Dec 06 16:32:02 1999
Return-Path: <zsh-workers-return-8916-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27825 invoked from network); 6 Dec 1999 16:32:00 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 6 Dec 1999 16:32:00 -0000
Received: (qmail 19871 invoked by alias); 6 Dec 1999 16:31:54 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8916
Received: (qmail 19863 invoked from network); 6 Dec 1999 16:31:53 -0000
Date: Mon, 6 Dec 1999 11:31:52 -0500
From: Clint Adams <schizo@debian.org>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: the transform saga, directories
Message-ID: <19991206113152.A25632@dman.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
User-Agent: Mutt/1.0i

This unfortunately brings back my make hack in order to
transform fndir and MODDIR.  I'm a little iffy about fndir since
it has its own configure switch and this makes the description
incorrect.

Index: configure.in
===================================================================
RCS file: /cvs/zsh/zsh/configure.in,v
retrieving revision 1.1.1.47
diff -u -r1.1.1.47 configure.in
--- configure.in	1999/12/06 04:33:04	1.1.1.47
+++ configure.in	1999/12/06 16:27:56
@@ -48,6 +48,15 @@
 dnl Handle --program-prefix, --program-suffix, etc.
 AC_ARG_PROGRAM
 
+u_ptn=`make -s -f - <<EOF
+all:
+	@echo ${program_transform_name}
+EOF
+`
+tzsh=`echo zsh | sed -e "${u_ptn}"`
+
+AC_SUBST(tzsh)dnl
+
 dnl Do you want to debug zsh?
 undefine([zsh-debug])dnl
 AC_ARG_ENABLE(zsh-debug,
@@ -214,10 +223,10 @@
 AC_ARG_ENABLE(fndir,
 [  --enable-fndir=DIR         where functions go (default DATADIR/zsh/functions)],
 [if test $enableval = yes; then
-  fndir=${datadir}/zsh/functions
+  fndir=${datadir}/${tzsh}/functions
 else
   fndir="$enableval"
-fi], [fndir=${datadir}/zsh/functions])
+fi], [fndir=${datadir}/${tzsh}/functions])
 
 undefine([function_subdirs])
 AC_ARG_ENABLE(function-subdirs,
Index: Config/defs.mk.in
===================================================================
RCS file: /cvs/zsh/zsh/Config/defs.mk.in,v
retrieving revision 1.1.1.3
diff -u -r1.1.1.3 defs.mk.in
--- Config/defs.mk.in	1999/06/18 10:55:49	1.1.1.3
+++ Config/defs.mk.in	1999/12/06 16:27:56
@@ -33,7 +33,7 @@
 exec_prefix     = @exec_prefix@
 bindir          = @bindir@
 libdir          = @libdir@
-MODDIR          = $(libdir)/zsh/$(VERSION)
+MODDIR          = $(libdir)/@tzsh@/$(VERSION)
 infodir         = @infodir@
 mandir          = @mandir@
 fndir           = @fndir@
Index: Doc/Makefile.in
===================================================================
RCS file: /cvs/zsh/zsh/Doc/Makefile.in,v
retrieving revision 1.1.1.33
diff -u -r1.1.1.33 Makefile.in
--- Doc/Makefile.in	1999/12/06 04:40:27	1.1.1.33
+++ Doc/Makefile.in	1999/12/06 16:27:56
@@ -168,14 +168,15 @@
 install.man: $(MAN)
 	$(sdir_top)/mkinstalldirs $(DESTDIR)$(mandir)/man1
 	for file in $(MAN); do \
-	  tzsh=`echo $$file | sed '$(transform)'`; \
+	  tzsh=`echo zsh | sed '$(transform)'`; \
+	  tfile=`echo $$file | sed "s/zsh/$$tzsh/"`; \
 	  if test -f $$file; then \
-	    cp -f $$file $$tzsh; \
+	    cp -f $$file $$tfile; \
 	  elif test -f $(sdir)/$$file; then \
-	    cp -f $(sdir)/$$file $$tzsh; \
+	    cp -f $(sdir)/$$file $$tfile; \
 	  else :; \
 	  fi || exit 1; \
-	  $(INSTALL_DATA) $$tzsh $(DESTDIR)$(mandir)/man1 || exit 1; \
+	  $(INSTALL_DATA) $$tfile $(DESTDIR)$(mandir)/man1 || exit 1; \
 	done
 
 # install info pages, creating install directory if necessary
@@ -203,7 +204,8 @@
 uninstall.man:
 	for file in $(MAN); do \
 	  tzsh=`echo zsh | sed '$(transform)'`; \
-	  rm -f $(DESTDIR)$(mandir)/man1/$$tzsh; \
+	  tfile=`echo $$file | sed "s/zsh/$$tzsh/"`; \
+	  rm -f $(DESTDIR)$(mandir)/man1/$$tfile; \
 	done
 
 # uninstall info pages

