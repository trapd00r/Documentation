From zsh-users-return-12111-mason-zsh=primenet.com.au@sunsite.dk Thu Oct 25 10:06:07 2007
Return-Path: <zsh-users-return-12111-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6807 invoked from network); 25 Oct 2007 10:05:57 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 Oct 2007 10:05:57 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 49544 invoked from network); 25 Oct 2007 10:05:51 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 25 Oct 2007 10:05:51 -0000
Received: (qmail 9805 invoked by alias); 25 Oct 2007 10:05:43 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12111
Received: (qmail 9789 invoked from network); 25 Oct 2007 10:05:42 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 25 Oct 2007 10:05:42 -0000
Received: (qmail 48349 invoked from network); 25 Oct 2007 10:05:42 -0000
Received: from smtp.ctxuk.citrix.com (HELO SMTP.EU.CITRIX.COM) (62.200.22.115)
  by a.mx.sunsite.dk with SMTP; 25 Oct 2007 10:05:35 -0000
X-IronPort-AV: E=Sophos;i="4.21,328,1188792000"; 
   d="scan'208";a="11519039"
Received: from lonpexchmx01.citrite.net ([10.30.224.191])
  by LONPIPO01.EU.CITRIX.COM with ESMTP; 25 Oct 2007 06:05:34 -0400
Received: from lonpexch01.citrite.net ([10.30.224.136]) by lonpexchmx01.citrite.net with Microsoft SMTPSVC(6.0.3790.1830);
	 Thu, 25 Oct 2007 11:04:35 +0100
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Slow compdump on Vista - no .zcompdump created
Date: Thu, 25 Oct 2007 11:04:26 +0100
Message-ID: <DD74FBB8EE28D441903D56487861CD9D2271A057@lonpexch01.citrite.net>
In-Reply-To: <018501c81658$6beebbc0$43cc3340$@com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Slow compdump on Vista - no .zcompdump created
thread-index: AcgWQWjxaiC/Ru7GTv+tUqmiXiYgJQACohYwAABJ4TAAAscUMAAlWf2w
References: <DD74FBB8EE28D441903D56487861CD9D22719534@lonpexch01.citrite.net> <016801c8164c$301c5d70$90551850$@com> <DD74FBB8EE28D441903D56487861CD9D2271979B@lonpexch01.citrite.net> <018501c81658$6beebbc0$43cc3340$@com>
From: "John Cooper" <John.Cooper@citrix.com>
To: "Seth Kurtzberg" <seth@cql.com>,
	"Zsh Users" <zsh-users@sunsite.dk>
Cc: "John Cooper" <John.Cooper@citrix.com>
X-OriginalArrivalTime: 25 Oct 2007 10:04:35.0439 (UTC) FILETIME=[723877F0:01C816EE]

It turns out the massive slowdown of "ls -l" on Vista was due to the
Symantec AntiVirus software:
http://www.cygwin.com/ml/cygwin/2007-10/msg00527.html

With "File System Auto-Protect" disabled, the execution time for
"compinit" goes down from 12 seconds to 3 seconds.

Still, it does seem odd that .zcompdump is not created by default.
Presumably, if it were, compinit would likely run in a fraction of a
second?
Does anyone know why .zcompdump might not be getting created on Cygwin,
and whether I can force it?

    --- John.


-----Original Message-----
From: Seth Kurtzberg [mailto:seth@cql.com]=20
Sent: 24 October 2007 17:11
To: John Cooper; 'Zsh Users'
Subject: RE: Slow compdump on Vista - no .zcompdump created

I'll time some ls operations, then run rebaseall, then check whether the
ls
performance has changed.

As I can't run ls from zsh at the moment, I'll run it from the cygwin
bash
shell.  Doing the before and after with bash, and then comparing bash to
zsh, should allow us to infer whether the rebaseall is related to the ls
performance.

-----Original Message-----
From: John Cooper [mailto:John.Cooper@citrix.com]=20
Sent: Wednesday, October 24, 2007 11:02 AM
To: Seth Kurtzberg; Zsh Users
Cc: John Cooper
Subject: RE: Slow compdump on Vista - no .zcompdump created

It's usable although noticeably sluggish (and I have a 2.8GHz dual-core
machine with 4Gb memory!).
I've just posted to the cygwin mailing list about "ls" being much slower
on Vista compared to XP:
http://cygwin.com/ml/cygwin/2007-10/msg00500.html

I did encounter the fork problem but ran "rebaseall" to fix things up.
Perhaps this rebasing has somehow contributed to the slowdown?

    --- John.

-----Original Message-----
From: Seth Kurtzberg [mailto:seth@cql.com]=20
Sent: 24 October 2007 15:43
To: John Cooper; 'Zsh Users'
Subject: RE: Slow compdump on Vista - no .zcompdump created

Does your question imply that zsh with cygwin is more or less functional
on
vista?  My experience with it, confirmed by many postings around the
'net,
is that the cygwin fork functionality is completely broken on vista and
this
makes zsh essentially unusable on vista.  Has there been a fix for this
problem, or has the situation changed for some other reason?

Thanks in advance,

Seth Kurtzberg
Software Engineer
Specializing in Security, Reliability, and the Hardware/Software
Interface



-----Original Message-----
From: John Cooper [mailto:John.Cooper@citrix.com]=20
Sent: Wednesday, October 24, 2007 9:26 AM
To: Zsh Users
Subject: Slow compdump on Vista - no .zcompdump created

Each time I start cygwin zsh (4.3.2 or 4.3.4) on Vista, compinit takes
around 12 seconds and no .zcompdump file is created:

C:\>zsh -f
$P$Gautoload -U compinit
$P$Gcd
$P$Gdate; compinit; date
Wed Oct 24 13:56:08 GMTDT 2007
Wed Oct 24 13:56:20 GMTDT 2007
$P$Gls .zcompdump
ls: .zcompdump: No such file or directory
$P$G

"compinit -u" and "compinit -C" take about the same time.


With zsh 4.2.6 on WinXP, when I run "compinit" I get prompted:
  Ignore insecure directories and continue [ny]?

(this prompt isn't shown with zsh 4.3.{2,4} on Vista.)

If I type "y" or run "compinit -C" it runs much faster in zsh 4.2.6 on
WinXP (although a .zcompdump file is still not created):

$P$Gdate; compinit -C; date
Wed Oct 24 14:08:16 GMTDT 2007
Wed Oct 24 14:08:17 GMTDT 2007
$P$G

Any ideas on how to speed it up on zsh 4.3.4 on Vista, and why the
.zcompdump file is not being created (`man zshall' states it should be
created by default)?

Thanks,

    --- John.

