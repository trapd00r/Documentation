From zsh-users-return-13921-mason-zsh=primenet.com.au@sunsite.dk Sun Mar 15 19:51:22 2009
Return-Path: <zsh-users-return-13921-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20794 invoked from network); 15 Mar 2009 19:51:16 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 15 Mar 2009 19:51:16 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 79818 invoked from network); 15 Mar 2009 19:48:13 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 15 Mar 2009 19:48:13 -0000
Received: (qmail 4008 invoked by alias); 15 Mar 2009 19:47:59 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13921
Received: (qmail 3997 invoked from network); 15 Mar 2009 19:47:58 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 15 Mar 2009 19:47:58 -0000
Received: from vms173007pub.verizon.net (vms173007pub.verizon.net [206.46.173.7])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 6A3A680307F8
	for <zsh-users@sunsite.dk>; Sun, 15 Mar 2009 20:47:54 +0100 (CET)
Received: from torch.brasslantern.com ([96.249.201.13])
 by vms173007.mailsrvcs.net
 (Sun Java(tm) System Messaging Server 6.3-7.04 (built Sep 26 2008; 32bit))
 with ESMTPA id <0KGK00EGACBR2431@vms173007.mailsrvcs.net> for
 zsh-users@sunsite.dk; Sun, 15 Mar 2009 14:47:52 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id n2FJloCE005279	for
 <zsh-users@sunsite.dk>; Sun, 15 Mar 2009 12:47:51 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id n2FJlnCI005278	for zsh-users@sunsite.dk; Sun,
 15 Mar 2009 12:47:49 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <090315124749.ZM5277@torch.brasslantern.com>
Date: Sun, 15 Mar 2009 12:47:49 -0700
In-reply-to: <20090315182446.60806.qmail@smasher.org>
Comments: In reply to Atom Smasher <atom@smasher.org>        "jobs -Z example?"
 (Mar 16,  7:24am)
References: <20090315182446.60806.qmail@smasher.org>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: zsh-users@sunsite.dk
Subject: Re: jobs -Z example?
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii
X-Virus-Scanned: ClamAV 0.92.1/9110/Sun Mar 15 06:06:44 2009 on bifrost
X-Virus-Status: Clean

On Mar 16,  7:24am, Atom Smasher wrote:
}
} can someone point me to an example of "jobs -Z" in action?

torch% ps $$
  PID TTY      STAT   TIME COMMAND
 5249 pts/4    Ss     0:00 Src/zsh -f
torch% jobs -Z "You can't see me"
torch% ps $$                     
  PID TTY      STAT   TIME COMMAND
 5249 pts/4    Ss     0:00 You can't see me
torch% print $(< /proc/$$/cmdline )
You can't see me
torch% 

If you mean an explanation of why you'd *want* to do that sort of
thing, the reasons can be a bit obscure.  As one real-world example,
at work we run a job queuing system where a controller process passes
tasks to a set of worker processes.  The worker processes are each a
subshell of a "foreman" script which runs in an infinite loop to keep
track of how many workers are active and to start a new one when one
exits.

So the script at startup runs something like
    jobs -Z "worker:foreman"
and when each subshell starts it runs
    jobs -Z "worker:task"

That way, we can differentiate in "ps" output which process is which,
rather than having them all appear to be copies of the same script.
If we want to shut the system down cleanly, we kill the foreman and
let the workers die off as their tasks complete.

Yes, we could do this by having the foreman write it's PID to a file
instead, etc.  This just makes it obvious when running "top" or other
system monitoring.

