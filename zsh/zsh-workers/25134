From zsh-workers-return-25134-mason-zsh=primenet.com.au@sunsite.dk Wed Jun 04 12:02:16 2008
Return-Path: <zsh-workers-return-25134-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27659 invoked from network); 4 Jun 2008 12:02:13 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 4 Jun 2008 12:02:13 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 50710 invoked from network); 4 Jun 2008 12:02:10 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Jun 2008 12:02:10 -0000
Received: (qmail 6872 invoked by alias); 4 Jun 2008 12:02:07 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25134
Received: (qmail 6860 invoked from network); 4 Jun 2008 12:02:06 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 4 Jun 2008 12:02:06 -0000
Received: from smtp02.cdmon.com (smtp02.cdmon.com [212.36.74.229])
	by bifrost.dotsrc.org (Postfix) with ESMTP id E607280589A4
	for <zsh-workers@sunsite.dk>; Wed,  4 Jun 2008 14:02:02 +0200 (CEST)
Received: from DervishD (212.Red-80-35-44.staticIP.rima-tde.net [80.35.44.212])
	by smtp02.cdmon.com (Postfix) with ESMTP id 04CDC45318
	for <zsh-workers@sunsite.dk>; Wed,  4 Jun 2008 14:02:00 +0200 (CEST)
Date: Wed, 4 Jun 2008 14:01:46 +0200
From: =?UTF-8?B?UmHDumwgTsO6w7Fleg==?= de Arenas Coronado <raul@dervishd.net>
To: zsh-workers@sunsite.dk
Subject: Directories with multibyte names are never empty
Message-ID: <20080604140146.77f2ab35@DervishD>
Organization: DervishD
X-Mailer: Claws Mail 2.10.0 (GTK+ 2.12.0; i486-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Scanned: ClamAV 0.91.2/7358/Wed Jun  4 13:41:00 2008 on bifrost
X-Virus-Status: Clean

Hi all :)

First of all, my excuses if this is already solved. I haven't been
following the list with much attention lately and I'm using zsh-4.3.4
in my Ubuntu, which may be a bit outdated.

This said, the problem is very easy to reproduce:

$ mkdir H
$ mkdir H/=C5=8D  <-- This is an "o" with a dash above
$ mkdir H/a
$ mkdir H/empty
$ touch H/a/test
$ touch H/=C5=8D/test
$ print -l **/*(/^F)
H/empty
H/=C5=8D

The last output should be just "H/empty", but the directory with the
"=C5=8D" is considered empty, too (and it is obviously not empty).

I have multibyte enabled and my encoding is UTF-8 (both in console and
in the filesystem). Curiously, this doesn't happen with letters like
"=C3=B1", "=C3=A1", "=C3=A9", etc. which are multibyte and are encoded usin=
g two
bytes in UTF-8, just like "=C5=8D" (0x014D =3D> 0xC5 0x8D in UTF-8).

My locale is a mix between en_US-UTF-8 and es_ES-UTF-8 (I want the
messages in English; date, time, collation and ctype in Spanish).

If you need more information, just tell. Thanks a lot in advance :)=20

Ra=C3=BAl "DervishD" N=C3=BA=C3=B1ez de Arenas Coronado
--=20
Linux Registered User 88736 | http://www.dervishd.net
It's my PC and I'll cry if I want to... RAmen!
We are waiting for 13 Feb 2009 23:31:30 +0000 ...

