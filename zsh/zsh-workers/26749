From zsh-workers-return-26749-mason-zsh=primenet.com.au@sunsite.dk Tue Mar 17 17:37:02 2009
Return-Path: <zsh-workers-return-26749-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2258 invoked from network); 17 Mar 2009 17:36:59 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 17 Mar 2009 17:36:59 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 75326 invoked from network); 17 Mar 2009 17:36:53 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Mar 2009 17:36:53 -0000
Received: (qmail 18755 invoked by alias); 17 Mar 2009 17:36:46 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26749
Received: (qmail 18743 invoked from network); 17 Mar 2009 17:36:46 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 17 Mar 2009 17:36:46 -0000
Received: from vms173007pub.verizon.net (vms173007pub.verizon.net [206.46.173.7])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 909CA801E289
	for <zsh-workers@sunsite.dk>; Tue, 17 Mar 2009 18:36:30 +0100 (CET)
Received: from torch.brasslantern.com ([96.249.201.13])
 by vms173007.mailsrvcs.net
 (Sun Java(tm) System Messaging Server 6.3-7.04 (built Sep 26 2008; 32bit))
 with ESMTPA id <0KGN00CMXVKDVBA9@vms173007.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Tue, 17 Mar 2009 12:36:19 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id n2HHaCMa017711	for
 <zsh-workers@sunsite.dk>; Tue, 17 Mar 2009 10:36:13 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id n2HHaCSw017710	for zsh-workers@sunsite.dk; Tue,
 17 Mar 2009 10:36:12 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <090317103612.ZM17709@torch.brasslantern.com>
Date: Tue, 17 Mar 2009 10:36:12 -0700
In-reply-to: <20090317095717.02bedf7e@news01>
Comments: In reply to Peter Stephenson <pws@csr.com>
 "Re: Bug#519535: history expansion: modifier completion missing" (Mar 17,
 9:57am)
References: <20090313105555.GA19025@piper.oerlikon.madduck.net>
	<20090315062253.GB14010@scru.org>	<20090316181852.27e9420d@news01>
	<090316194434.ZM16487@torch.brasslantern.com>	<20090317095717.02bedf7e@news01>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: zsh-workers@sunsite.dk
Subject: Re: Bug#519535: history expansion: modifier completion missing
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii
X-Virus-Scanned: ClamAV 0.92.1/9123/Tue Mar 17 17:25:37 2009 on bifrost
X-Virus-Status: Clean

On Mar 17,  9:57am, Peter Stephenson wrote:
} Subject: Re: Bug#519535: history expansion: modifier completion missing
}
} On Mon, 16 Mar 2009 19:44:34 -0700
} Bart Schaefer <schaefer@brasslantern.com> wrote:
} > I don't know how the generic quoting code plays in, but I suspect this
} > is done this way *because* history expansion takes place so early.  If
} > it looks like a history expansion and it got this far, then it must be
} > a *failed* history expansion and needs to be quoted if it matches any
} > other completion -- otherwise the history expansion will fail *again*
} > after accept-line, and spoil the whole command.
} 
} That's quite possible. The quote code is hair-raising enough (see
} utils.c around line 4504) that it's quite hard to tell.

Yes, I can see where it might be hard to follow exactly how we come
to be passing through there.  And it certainly looks as if at least
tildes as well as histchars should be getting quoted.  Are the other
backslashes perhaps being added here but removed elsewhere?

} It's being called from multiquote() within callcompfunc() in
} compcore.c, which is called for all top-level completion widgets. The
} commenting in that last function is quite amusing in an infuriating
} sort of way: there are three, and all of them are in blocks marked
} with "#if 0".

Apparently Sven only felt it necessary to remind himself why he did NOT
do things.  There must be some discussion of group numbers lurking in
the list archives.

