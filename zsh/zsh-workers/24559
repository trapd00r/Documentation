From zsh-workers-return-24559-mason-zsh=primenet.com.au@sunsite.dk Sat Feb 16 09:01:23 2008
Return-Path: <zsh-workers-return-24559-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1673 invoked from network); 16 Feb 2008 09:01:11 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Feb 2008 09:01:11 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 36651 invoked from network); 16 Feb 2008 09:01:05 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Feb 2008 09:01:05 -0000
Received: (qmail 9468 invoked by alias); 16 Feb 2008 09:01:00 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24559
Received: (qmail 9456 invoked from network); 16 Feb 2008 09:01:00 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 16 Feb 2008 09:00:59 -0000
Received: from vms044pub.verizon.net (vms044pub.verizon.net [206.46.252.44])
	by bifrost.dotsrc.org (Postfix) with ESMTP id EA8C98026E0B
	for <zsh-workers@sunsite.dk>; Sat, 16 Feb 2008 10:00:56 +0100 (CET)
Received: from torch.brasslantern.com ([71.121.18.67])
 by vms044.mailsrvcs.net (Sun Java System Messaging Server 6.2-6.01 (built Apr
 3 2006)) with ESMTPA id <0JWB0065HQDID161@vms044.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Sat, 16 Feb 2008 03:00:55 -0600 (CST)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id m1G90qHn030145; Sat,
 16 Feb 2008 01:00:53 -0800
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id m1G90pDL030144; Sat, 16 Feb 2008 01:00:51 -0800
Date: Sat, 16 Feb 2008 01:00:51 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: Fw: Phil's prompt is not working when LANG is set to UTF-8
In-reply-to: <200802161056.29466.arvidjaar@newmail.ru>
To: Andrey Borzenkov <arvidjaar@newmail.ru>, zsh-workers@sunsite.dk
Cc: Wael Nasreddine <mla@nasreddine.com>
Message-id: <080216010051.ZM30143@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <20080215235241.2f255730@pws-pc>
	<200802161056.29466.arvidjaar@newmail.ru>
Comments: In reply to Andrey Borzenkov <arvidjaar@newmail.ru>
 "Re: Fw: Phil's prompt is not working when LANG is set to UTF-8" (Feb 16,
 10:56am)
X-Virus-Scanned: ClamAV version 0.91.2, clamav-milter version 0.91.2 on bifrost
X-Virus-Status: Clean

On Feb 16, 10:56am, Andrey Borzenkov wrote:
}
} Now downside of course is, it works only with patched shell ...

I'll describe a workaround but I don't have time now to actually
write code for it:

(1) Emit %{, the sequence for "save cursor position", %}

(2) Emit ${#PR_FILLBAR} spaces.

(3) Emit %{, "restore cursor position", then the actual line drawing
    characters (which will overwrite the spaces), then %}

This should work in any shell, and should work whether the shell is
correctly calculating the width of the ACS characters or not, and
should even work if the ACS characters are not being used.

