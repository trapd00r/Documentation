From zsh-workers-return-17060-mason-zsh=primenet.com.au@sunsite.dk Wed May 01 21:56:39 2002
Return-Path: <zsh-workers-return-17060-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21143 invoked from network); 1 May 2002 21:56:38 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 1 May 2002 21:56:38 -0000
Received: (qmail 25719 invoked by alias); 1 May 2002 21:56:28 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 17060
Received: (qmail 25706 invoked from network); 1 May 2002 21:56:26 -0000
Date: Wed, 1 May 2002 14:56:22 -0700
From: "John H. Robinson, IV" <jhriv@ucsd.edu>
To: zsh-workers@sunsite.dk
Subject: zsh 4.0.4 on Solaris 2.6, shared (dynamic) library issues
Message-ID: <20020501215622.GA18926@ucsd.edu>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.3.27i
X-ddate: Today is Sweetmorn, the 48th day of Discord in the YOLD 3168

i am not subscribed to this list.

anyway, whilst compiling zsh 4.0.4 on a Solaris 2.6 system,

[jhriv@chao:~]% uname -a
SunOS chao.ucsd.edu 5.6 Generic_105181-26 sun4u sparc

i was having a very hard time getting the ``make check'' to complete. i
narrowed it down to the zsh/zpty module not being loaded. further
research indicated that _no_ dynamic modules were being loaded.

eventually, i found the problem in the configure script: it thinks that
the proper flag for shared libraries is a -G, however, for my version of
gcc

[jhriv@chao:~]% gcc --version
2.95.2

    the proper flag is -shared.

when i changed the line:
solaris*|sysv4*|esix*) DLLDFLAGS="${DLLDFLAGS=-G}" ;;
to
solaris*|sysv4*|esix*) DLLDFLAGS="${DLLDFLAGS=-shared}" ;;

./config.status --recheck was able to determine that no underscore was
required, built most everything as a dynamic module, all checks passed
with flying colours, and my new shell is only 4.0k big.

oh, i did have to temporarily set LD_LIBRARY_PATH=$PWD/Src for the make
check to even see the libzsh-4.0.4.so library. once i did that,
everything was great.

i have no idea how to change autoconf's mind about the -G/-shared flag
issue.

-john

