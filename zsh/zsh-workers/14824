From zsh-workers-return-14824-mason-zsh=primenet.com.au@sunsite.dk Sat Jun 09 16:08:10 2001
Return-Path: <zsh-workers-return-14824-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13221 invoked from network); 9 Jun 2001 16:08:09 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 9 Jun 2001 16:08:09 -0000
Received: (qmail 511 invoked by alias); 9 Jun 2001 16:07:33 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14824
Received: (qmail 458 invoked from network); 9 Jun 2001 16:07:32 -0000
X-Authentication-Warning: candle.brasslantern.com: schaefer set sender to lantern@shell10.ba.best.com using -f
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010609160614.ZM13120@candle.brasslantern.com>
Date: Sat, 9 Jun 2001 16:06:14 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.dk
Subject: PATCH: Avoid echotc in comptest
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

This is an improvement on the change to keep the TERM setting of the pty
separate from that of the testing user's terminal.  I'm actually not sure
why the clear-to-eol is needed at all, but ...

Index: Test/comptest
===================================================================
diff -c -r1.3 comptest
--- Test/comptest	2001/06/08 03:53:14	1.3
+++ Test/comptest	2001/06/08 16:26:28
@@ -8,7 +8,6 @@
   zmodload -i zsh/zpty
 
   comptest_zsh=${ZSH:-zsh}
-  termcap_ce="$(echotc ce 2>/dev/null)"
 
   while getopts z: opt; do
     case $opt in
@@ -105,7 +104,7 @@
       log="${log[$mend[1]+1,-1]}"
       if (( 0 <= $mbegin[2] )); then
 	if [[ $match[2] != TC && $match[3] != \ # ]]; then
-	  print -lr "$match[2]:{${match[3]%$termcap_ce}}"
+	  print -lr "$match[2]:{${match[3]%${(%):-%E}}}"
 	fi
       elif (( 0 <= $mbegin[4] )); then
 	print -lr "DESCRIPTION:{$match[4]}"

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

