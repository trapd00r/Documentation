From zsh-workers-return-13388-mason-zsh=primenet.com.au@sunsite.dk Thu Jan 25 15:14:45 2001
Return-Path: <zsh-workers-return-13388-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11397 invoked from network); 25 Jan 2001 15:14:44 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 25 Jan 2001 15:14:44 -0000
Received: (qmail 15361 invoked by alias); 25 Jan 2001 15:14:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13388
Received: (qmail 15349 invoked from network); 25 Jan 2001 15:14:38 -0000
Date: Thu, 25 Jan 2001 16:14:36 +0100 (MET)
Message-Id: <200101251514.QAA18940@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Felix Rosencrantz's message of Wed, 24 Jan 2001 22:45:05 -0800
	(PST)
Subject: RE: PATCH: completion positions


Felix Rosencrantz wrote:

> I've attached a patch for the first attempt at a test for insert_positions.
> I think there is a bug in the last test case, so I haven't tried to check in.
> 
> Sven, could you look at it.
> 
> I think the output should look like:
> +>line: {tst a}{.bC.cB.dA}
> +>COMPADD:{}
> +>INSERT_POSITIONS:{5:14}
> +>NO:{aA.bC.cB.dA}
> +>NO:{aD.bC.cB.dA}
> 
> But zsh seems to want to leave the cursor after the C, and insert_positions has
> three values rather than 2.

Indeed.  A bug when merging two CLF_MID entries. This should fix it.

Bye
 Sven

Index: Src/Zle/compmatch.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compmatch.c,v
retrieving revision 1.30
diff -u -r1.30 compmatch.c
--- Src/Zle/compmatch.c	2001/01/15 10:44:15	1.30
+++ Src/Zle/compmatch.c	2001/01/25 15:13:19
@@ -1627,7 +1627,7 @@
 	    *orest = NULL;
 	if (nrest)
 	    *nrest = n;
-	if (n)
+	if (n && n->wlen)
 	    ot->flags |= CLF_MISS;
 
 	return;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

