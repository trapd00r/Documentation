From zsh-workers-return-19537-mason-zsh=primenet.com.au@sunsite.dk Thu Mar 04 14:00:02 2004
Return-Path: <zsh-workers-return-19537-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11049 invoked from network); 4 Mar 2004 14:00:02 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 4 Mar 2004 14:00:02 -0000
Received: (qmail 29937 invoked by alias); 4 Mar 2004 13:59:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19537
Received: (qmail 29911 invoked from network); 4 Mar 2004 13:59:49 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 4 Mar 2004 13:59:49 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [62.189.58.19] by sunsite.dk (MessageWall 1.0.8) with SMTP; 4 Mar 2004 13:59:48 -0000
Received: from MAILSWEEPER01.csr.com (mailhost1.csr.com [62.189.183.235])
	by lhuumrelay3.lnd.ops.eu.uu.net (8.11.0/8.11.0) with ESMTP id i24Dxmv21838
	for <zsh-workers@sunsite.dk>; Thu, 4 Mar 2004 13:59:48 GMT
Received: from EXCHANGE02.csr.com (unverified [192.168.137.45]) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.12) with ESMTP id <T682294b12cc0a88d01588@MAILSWEEPER01.csr.com>;
 Thu, 4 Mar 2004 13:59:28 +0000
Received: from csr.com ([192.168.144.127]) by EXCHANGE02.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Thu, 4 Mar 2004 14:01:28 +0000
To: Zsh hackers list <zsh-workers@sunsite.dk>,
   Ibraheem Umaru-Mohammed <umarumohammed@btinternet.com>
Subject: Re: 4.2.0-pre-2 
In-reply-to: "Ibraheem Umaru-Mohammed"'s message of "Thu, 04 Mar 2004 13:12:07 GMT."
             <1078405927.18583.10.camel@sonic> 
Date: Thu, 04 Mar 2004 13:59:47 +0000
Message-ID: <3775.1078408787@csr.com>
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 04 Mar 2004 14:01:28.0640 (UTC) FILETIME=[308B5400:01C401F1]

Ibraheem Umaru-Mohammed wrote:
> Ok. I have included the capabilities.h which seems to have the "opaque"
> definition for cap_t. Below is the result of running grep through
> /usr/include:

Thanks for the info... The important thing is if you managed to get
it to compile.  I don't see a prototype for cap_get_proc there.
The only thing I can see is to add the flag I suggested earlier.

If anyone has the ability to fix this properly, please do.

I've just noticed that the `term.h' problem hasn't gone away.
It looks like configure should test for curses.h first, then see if
it can include term.h using

#ifdef HAVE_CURSES_H
#include <curses.h>
#endif
#include <term.h>

and if that works unconditionally use term.h, so getting rid of the
current `needs curses.h' flag.

It would be great if someone else had a chance to do that.  I only have
limited time for all these endless configuration changes.


Index: configure.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.ac,v
retrieving revision 1.12
diff -u -r1.12 configure.ac
--- configure.ac	3 Mar 2004 19:38:00 -0000	1.12
+++ configure.ac	4 Mar 2004 13:47:44 -0000
@@ -313,6 +313,11 @@
 AC_HELP_STRING([--enable-pcre],
 [enable the search for the pcre library (may create run-time library dependencies)]))
 
+dnl Do you want to look for capability support?
+AC_ARG_ENABLE(cap,
+AC_HELP_STRING([--enable-cap],
+[enable the search for POSIX capabilities (may require additional headers to be added by hand)]))
+
 dnl ------------------
 dnl CHECK THE COMPILER
 dnl ------------------
@@ -709,7 +714,9 @@
   AC_CHECK_LIB(dl, dlopen)
 fi
 
-AC_CHECK_LIB(cap, cap_get_proc)
+if test x$enable_cap = xyes; then
+  AC_CHECK_LIB(cap, cap_get_proc)
+fi
 
 AC_CHECK_LIB(socket, socket)
 
@@ -1029,7 +1036,6 @@
 	       initgroups nis_list \
 	       setuid seteuid setreuid setresuid setsid \
 	       memcpy memmove strstr strerror \
-	       cap_get_proc \
 	       getrlimit \
 	       setlocale \
 	       uname \
@@ -1045,6 +1051,10 @@
 	       grantpt unlockpt ptsname)
 AC_FUNC_STRCOLL
 
+if test x$enable_cap = xyes; then
+  AC_CHECK_FUNCS(cap_get_proc)
+fi
+
 dnl  Check if tgetent accepts NULL (and will allocate its own termcap buffer)
 dnl  Some termcaps reportedly accept a zero buffer, but then dump core
 dnl  in tgetstr().
Index: INSTALL
===================================================================
RCS file: /cvsroot/zsh/zsh/INSTALL,v
retrieving revision 1.13
diff -u -r1.13 INSTALL
--- INSTALL	1 Mar 2004 17:58:53 -0000	1.13
+++ INSTALL	4 Mar 2004 13:47:44 -0000
@@ -359,20 +359,32 @@
 None of this is relevant for 64-bit systems; zsh should compile and run
 without problems if (sizeof(long) == 8).
 
-Searching for `pcre'
---------------------
+Searching for additional features
+---------------------------------
+
+Various additional features are turned off by default to avoid
+compatibility problems.
+
+--enable-pcre:
 
 Zsh has a module which allows the pcre regular expression library to be
 used via shell builtins.  Compiling this library into the shell with
 dynamic loading (the default where available) produces a dependency on the
 library libpcre.so.  This is a problem on systems where zsh needs to be
-available at boot before the directory containing libpcre.so (for
-example /usr/lib or /usr/local/lib) is mounted.  For this reason,
-pcre support will only be searched for if the option --enable-pcre
-is passed to configure.
+available at boot before the directory containing libpcre.so (for example
+/usr/lib or /usr/local/lib) is mounted.  For this reason, pcre support will
+only be searched for if the option --enable-pcre is passed to configure.
 
 (Future versions of the shell may have a better fix for this problem.)
 
+--enable-cap:
+
+This searches for POSIX capabilities; if found, the `cap' library
+is available and the shell will use these to determine if the
+shell is running in some privileged mode.  This is turned off by
+default as on some systems non-standard headers (in particular AIX) are
+required.  A direct fix for that problem would be appreciated.
+
 Options For Configure
 ---------------------
 

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR Ltd., Science Park, Milton Road,
Cambridge, CB4 0WH, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

This footnote also confirms that this email message has been swept by
MIMEsweeper for the presence of computer viruses.

www.mimesweeper.com
**********************************************************************

