From zsh-workers-return-13352-mason-zsh=primenet.com.au@sunsite.dk Mon Jan 15 17:26:55 2001
Return-Path: <zsh-workers-return-13352-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2898 invoked from network); 15 Jan 2001 17:26:54 -0000
Received: from sunsite.dk (HELO sunsite.auc.dk) (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 Jan 2001 17:26:54 -0000
Received: (qmail 3845 invoked by alias); 15 Jan 2001 17:26:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13352
Received: (qmail 3833 invoked from network); 15 Jan 2001 17:26:47 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010115172300.ZM15781@candle.brasslantern.com>
Date: Mon, 15 Jan 2001 17:23:00 +0000
In-Reply-To: <20010115094653.A2172@dan.emsphone.com>
Comments: In reply to Dan Nelson <dnelson@emsphone.com>
        "Re: TERMCAP problem." (Jan 15,  9:46am)
References: <3A62CD8D.2DC85B34@alcatel.be> 
	<20010115094653.A2172@dan.emsphone.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: koen van hoof <koen.van_hoof@alcatel.be>
Subject: Re: TERMCAP problem.
Cc: zsh-workers@sunsite.auc.dk
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Jan 15,  9:46am, Dan Nelson wrote:
} Subject: Re: TERMCAP problem.
}
} In the last episode (Jan 15), koen van hoof said:
} > zsh V3.1.9 and termcap V1.3 on SunOS se9ws265 5.6 Generic_105181-03
} > sun4u sparc
[...]
} > it core dumps, because at a certain moment getenv("TERM")
} > returns 0 and this is fed into a strcmp.
} 
} getenv("TERM") should never return 0.  screen sets both TERM and
} TERMCAP on all my machines.

But zsh shouldn't dump core when TERM is not set, even so.

Koen, you're going to have to give us more details (if you can) about the
core dump.  As far as I can tell, zsh never feeds the result of getenv()
directly to strcmp().  $TERM is handled by params.c:termsetfn(), which
always sets the global char *term to the empty string when $TERM is NULL;
later comparisons on the terminal type always use *term, which should
never be NULL unless ztrdup("") failed (which would indicate a serious
memory allocation problem).

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

