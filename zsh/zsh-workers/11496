From zsh-workers-return-11496-mason-zsh=primenet.com.au@sunsite.auc.dk Mon May 22 12:10:33 2000
Return-Path: <zsh-workers-return-11496-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1716 invoked from network); 22 May 2000 12:10:26 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 22 May 2000 12:10:26 -0000
Received: (qmail 16391 invoked by alias); 22 May 2000 12:10:10 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11496
Received: (qmail 16384 invoked from network); 22 May 2000 12:10:09 -0000
Date: Mon, 22 May 2000 14:08:59 +0200 (MET DST)
Message-Id: <200005221208.OAA20250@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Mon, 22 May 2000 15:07:56 +0400
Subject: PATCH: Re: Something strange with path completion


Andrej Borsenkow wrote:

> bor@itsrm2% l /to/sh/z/-4/f/B/_a<TAB>
> bor@itsrm2% l /tools/share/zsh/3.1.7-pre-4/functions/B<CURSOR HERE>/a
> Completing file
> Base/      Builtins/
> 
> Oops! Where is `_' before the final `a'.

Yep. add_match_part() overwrote the cline-data.

Bye
 Sven

Index: Src/Zle/compmatch.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compmatch.c,v
retrieving revision 1.14
diff -u -r1.14 compmatch.c
--- Src/Zle/compmatch.c	2000/05/17 11:59:33	1.14
+++ Src/Zle/compmatch.c	2000/05/22 12:08:37
@@ -378,9 +378,14 @@
 	matchsubs = matchlastsub = NULL;
     }
     /* Store the arguments in the last part-cline. */
-    lp->line = l; lp->llen = wl;
-    lp->word = w; lp->wlen = wl;
-    lp->orig = o; lp->olen = ol;
+    if (lp->llen || lp->wlen) {
+	lp->next = get_cline(l, wl, w, wl, o, ol, CLF_NEW);
+	lp = lp->next;
+    } else {
+	lp->line = l; lp->llen = wl;
+	lp->word = w; lp->wlen = wl;
+	lp->orig = o; lp->olen = ol;
+    }
     if (o || ol)
 	lp->flags &= ~CLF_NEW;
 

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

