From zsh-workers-return-8302-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Oct 17 06:21:32 1999
Return-Path: <zsh-workers-return-8302-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12259 invoked from network); 17 Oct 1999 06:21:30 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Oct 1999 06:21:30 -0000
Received: (qmail 26951 invoked by alias); 17 Oct 1999 06:21:23 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8302
Received: (qmail 26943 invoked from network); 17 Oct 1999 06:21:23 -0000
To: zsh-workers@sunsite.auc.dk
Subject: Re: 3.1.6-bart-7
References: <991016212429.ZM15954@candle.brasslantern.com>
MIME-Version: 1.0 (generated by AKEMI 1.13.2 - =?ISO-2022-JP?B?Ig==?=
 =?ISO-2022-JP?B?GyRCQTA0Y0s8GyhCIg==?=)
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@jaist.ac.jp>
Date: 17 Oct 1999 15:21:20 +0900
In-Reply-To: "Bart Schaefer"'s message of "Sat, 16 Oct 1999 21:24:29 +0000"
Message-ID: <rsqbt9ya4nz.fsf@crane.jaist.ac.jp>
Lines: 152
User-Agent: Chao-gnus/6.12.5 AKEMI/1.13.2 (=?ISO-2022-JP?B?GyRCQTAbKEI=?=
 =?ISO-2022-JP?B?GyRCNGNLPBsoQg==?=) FLAM-DOODLE/1.12.6
 (=?ISO-2022-JP?B?GyRCM3cbKEI=?= 10R4.0/5.0) Emacs/20.4
 (sparc-sun-solaris2.6) MULE/4.0 (HANANOEN)

In article <991016212429.ZM15954@candle.brasslantern.com>,
  "Bart Schaefer" <schaefer@candle.brasslantern.com> writes:

> I'm quite certain I've missed at least a couple of patches; but I don't
> think I've missed anything major, and I'm sure nothing that would cause
> conflicts if applied again on top of this source.  So, point 'em out if
> you spot 'em.

I found some differences between my patched pws-6 and bart-7.

_history_complete_word stuff is not applied.
  8028,8070,8098 Completion/Commands/_history_complete_word
  8063 Doc/Zsh/compsys.yo

SH_JOB_CONTROL stuff is not applied.
  8109 Src/builtin.c,Src/options.c,Src/zsh.h
  8110 Doc/Zsh/options.yo

_man and mathfunc.c patch is not applied.
  8139 Completion/User/_man
  8138 Src/Modules/mathfunc.c

And I couldn't find messages which contains following differences.

  Completion/Linux/_rpm
  Doc/Makefile.in
  Src/init.c
  Src/main.c
  Src/Zle/zle_tricky.c

At least, .yo.1 rule in Doc/Makefile.in is wrong.  It run yodl twice.
# Maybe `echo' is forgotten?

| Index: zsh/Completion/Linux/_rpm
| diff -u zsh/Completion/Linux/_rpm:1.1.1.11 zsh/Completion/Linux/_rpm:1.1.1.10
| --- zsh/Completion/Linux/_rpm:1.1.1.11	Sun Oct 17 04:53:02 1999
| +++ zsh/Completion/Linux/_rpm	Wed Oct 13 17:50:33 1999
| @@ -148,7 +148,7 @@
|        '*:RPM package:->package' && ret=0
|      ;;
|    build_b)
| -    tmp=( '*:spec file:_path_files -/ -g \*.spec' )
| +    tmp=( '*:spec file:_files -g \*.spec' )
|      ;&
|    build_t)
|      (( $#tmp )) || tmp=( '*:tar file:_files -g \*.\(\#i\)tar\(.\*\|\)' )
| @@ -195,7 +195,7 @@
|        _hosts -S/ && ret=0
|      else
|        _description expl 'RPM package file'
| -      _path_files "$expl[@]" -/ -g '*.(#i)rpm' && ret=0
| +      _files "$expl[@]" -g '*.(#i)rpm' && ret=0
|        _description expl 'ftp URL prefix'
|        compadd "$expl[@]" ftp://
|      fi
| Index: zsh/Doc/Makefile.in
| diff -u zsh/Doc/Makefile.in:1.1.1.23 zsh/Doc/Makefile.in:1.1.1.22
| --- zsh/Doc/Makefile.in:1.1.1.23	Sun Oct 17 04:53:03 1999
| +++ zsh/Doc/Makefile.in	Wed Sep 29 23:04:30 1999
| @@ -81,11 +81,10 @@
|  	test -f $(sdir)/zsh.texi
|  
|  .yo.1:
| -	@case $@ in \
| +	case $@ in \
|  	  */*) target=$@ ;; \
|  	  *) target=$(sdir)/$@ ;; \
|  	esac; \
| -	$(YODL) -o $$target -I$(sdir) -w zman.yo version.yo $< ; \
|  	$(YODL) -I$(sdir) -w zman.yo version.yo $< | sed -e '1s/\\-/-/g' -e '/^\.'\''/d' > $$target || exit 1; \
|  	test -f $$target
|  
| @@ -99,11 +98,10 @@
|  	$(TEXI2HTML) $(sdir)/zsh.texi
|  
|  zshall.1: zsh.yo
| -	@case $@ in \
| +	case $@ in \
|  	  */*) target=$@ ;; \
|  	  *) target=$(sdir)/$@ ;; \
|  	esac; \
| -	echo $(YODL) -o $$target -I$(sdir) -DZSHALL -w zman.yo version.yo zsh.yo; \
|  	$(YODL) -I$(sdir) -DZSHALL -w zman.yo version.yo zsh.yo | sed -e '1s/\\-/-/g' -e '/^\.'\''/d' > $$target || exit 1; \
|  	test -f $$target
|  
| Index: zsh/Src/init.c
| diff -u zsh/Src/init.c:1.1.1.22 zsh/Src/init.c:1.1.1.21
| --- zsh/Src/init.c:1.1.1.22	Sun Oct 17 04:53:13 1999
| +++ zsh/Src/init.c	Wed Sep 22 13:08:38 1999
| @@ -113,8 +113,8 @@
|  	if (!(list = parse_event())) {	/* if we couldn't parse a list */
|  	    hend();
|  	    if ((tok == ENDINPUT && !errflag) ||
| -		(tok == LEXERR && (!noerrexit || emulation == EMULATE_KSH)
| -		 && (!isset(SHINSTDIN) || !toplevel)) || justonce)
| +		(tok == LEXERR && (!isset(SHINSTDIN) || !toplevel)) ||
| +		justonce)
|  		break;
|  	    continue;
|  	}
| Index: zsh/Src/main.c
| diff -u zsh/Src/main.c:1.1.1.3 zsh/Src/main.c:1.1.1.2
| --- zsh/Src/main.c:1.1.1.3	Sun Oct 17 04:53:13 1999
| +++ zsh/Src/main.c	Tue Jun  8 09:26:14 1999
| @@ -87,8 +87,7 @@
|      for (;;) {
|  	do
|  	    loop(1,0);
| -	while (tok != ENDINPUT &&
| -	       (tok != LEXERR || noerrexit || isset(SHINSTDIN)));
| +	while (tok != ENDINPUT && (tok != LEXERR || isset(SHINSTDIN)));
|  	if (tok == LEXERR) {
|  	    stopmsg = 1;
|  	    zexit(lastval, 0);
| Index: zsh/Src/Zle/zle_tricky.c
| diff -u zsh/Src/Zle/zle_tricky.c:1.1.1.78 zsh/Src/Zle/zle_tricky.c:1.1.1.77
| --- zsh/Src/Zle/zle_tricky.c:1.1.1.78	Sun Oct 17 04:53:18 1999
| +++ zsh/Src/Zle/zle_tricky.c	Fri Oct 15 14:14:45 1999
| @@ -811,7 +811,7 @@
|  		*b != '=' && *b != Equals &&
|  		*b != '~' && *b != Tilde)
|  		break;
| -	if (*b == '#' || *b == Pound || *b == '+' || *b == ' ')
| +	if (*b == '#' || *b == Pound || *b == '+')
|  	    b++;
|  
|  	e = b;
| @@ -6927,20 +6927,14 @@
|      if (cc->mask & (CC_JOBS | CC_RUNNING | CC_STOPPED)) {
|  	/* Get job names. */
|  	int i;
| -	char *j, *jj;
| +	char *j;
|  
|  	for (i = 0; i < MAXJOB; i++)
|  	    if ((jobtab[i].stat & STAT_INUSE) &&
|  		jobtab[i].procs && jobtab[i].procs->text) {
|  		int stopped = jobtab[i].stat & STAT_STOPPED;
|  
| -		j = jj = dupstring(jobtab[i].procs->text);
| -		/* Find the first word. */
| -		for (; *jj; jj++)
| -		    if (*jj == ' ') {
| -			*jj = '\0';
| -			break;
| -		    }
| +		j = dupstring(jobtab[i].procs->text);
|  		if ((cc->mask & CC_JOBS) ||
|  		    (stopped && (cc->mask & CC_STOPPED)) ||
|  		    (!stopped && (cc->mask & CC_RUNNING)))
-- 
Tanaka Akira

