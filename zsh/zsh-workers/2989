From zsh-workers-request@euclid.skiles.gatech.edu Fri Mar 14 06:55:57 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 1870 invoked from network); 14 Mar 1997 06:55:56 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 14 Mar 1997 06:55:56 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id BAA14672; Fri, 14 Mar 1997 01:49:46 -0500 (EST)
Resent-Date: Fri, 14 Mar 1997 01:49:46 -0500 (EST)
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <970313225052.ZM4299@candle.brasslantern.com>
Date: Thu, 13 Mar 1997 22:50:52 -0800
Reply-To: schaefer@nbn.com
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: zsh-workers@math.gatech.edu
Subject: Getting crashes in savehistfile()
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"2hQ773.0.Bb3.9KFAp"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2989
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Over the last couple of days I suddenly began noticing that my zsh history
was occassionally becoming empty.  I found a core file with the following
stack trace:

#0  0x80630c0 in savehistfile ()
#1  0x805285a in zexit ()
#2  0x8072103 in handler ()
#3  0xbffff5f0 in ?? ()
#4  0x8063023 in savehistfile ()
#5  0x805285a in zexit ()
#6  0x807fd9a in getkey ()
#7  0x8080635 in getkeycmd ()
#8  0x8080283 in zleread ()
#9  0x8064e67 in inputline ()
#10 0x8064d85 in ingetc ()
#11 0x80609d9 in hgetc ()
#12 0x8067311 in gettok ()
#13 0x8066e89 in yylex ()
#14 0x806f99c in parse_event ()
#15 0x806367a in loop ()
#16 0x8063597 in main ()

This apparently happens after I press ctrl-D to exit a shell, though not in
all cases (perhaps with SAVEHIST=0, which I do from time to time).  I never
notice because of course the shell is exiting anyway.

I'm running 3.0.3-test4 with several of the recent patches from the list.

-- 
Bart Schaefer                             Brass Lantern Enterprises
http://www.well.com/user/barts            http://www.nbn.com/people/lantern

