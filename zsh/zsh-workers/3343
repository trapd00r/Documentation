From zsh-workers-request@euclid.skiles.gatech.edu Thu Jul 03 06:51:56 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 324 invoked from network); 3 Jul 1997 06:51:56 -0000
Received: from ns2.primenet.com.au (HELO dns.primenet.com.au) (203.24.36.40)
  by ns1.primenet.com.au with SMTP; 3 Jul 1997 06:51:56 -0000
Received: (qmail 452 invoked from network); 3 Jul 1997 06:44:29 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by ns2.primenet.com.au with SMTP; 3 Jul 1997 06:44:29 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id CAA21882; Thu, 3 Jul 1997 02:02:51 -0400 (EDT)
Resent-Date: Thu, 3 Jul 1997 02:02:51 -0400 (EDT)
Date: Thu, 3 Jul 1997 10:07:24 +0400 (MSD)
From: Andrej Borsenkow <borsenkow.msk@sni.de>
X-Sender: bor@itsrm1
Reply-To: borsenkow.msk@sni.de
To: Zsh workers mailing list <zsh-workers@math.gatech.edu>
Subject: Refresh patch (Was: Refresh problem) (fwd)
Message-ID: <Pine.SV4.3.95.970703100602.4351E-100000@itsrm1>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Resent-Message-ID: <"vOgMs2.0.rL5.A2qkp"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3343
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

I forward a patch from Geoff Wing. It appears to fix the problem

-------------------------------------------------------------------------
Andrej Borsenkow 		Fax:   +7 (095) 252 01 05
SNI ITS Moscow			Tel:   +7 (095) 252 13 88

NERV:  borsenkow.msk		E-Mail: borsenkow.msk@sni.de
-------------------------------------------------------------------------


---------- Forwarded message ----------
Date: 3 Jul 1997 12:11:37 +1000
From: gwing@primenet.com.au
Reply-To: mason@primenet.com.au
To: Andrej@primenet.com.au, Borsenkow@primenet.com.au, borsenkow.msk@sni.de
Subject: Refresh patch (Was: Refresh problem)

Try this.  It's a patch against 3.0.4, but it should work with 3.1.2:


*** zle_refresh.c.org	Mon Jun 23 15:12:47 1997
--- zle_refresh.c	Thu Jul  3 12:02:34 1997
***************
*** 575,583 ****
  	if (nllen)
  	    strncpy(p1, nl, nllen);
  	memset(p1 + nllen, ' ', winw - nllen);
! 	p1[winw] = p1[winw + 1] = '\0';
  	if (ln && nbuf[ln])
! 	    strncpy(nl, p1, winw + 2);	/* next time obuf will be up-to-date */
  	else
  	    nl = p1;		/* don't keep the padding for prompt line */
  	nllen = winw;
--- 575,584 ----
  	if (nllen)
  	    strncpy(p1, nl, nllen);
  	memset(p1 + nllen, ' ', winw - nllen);
! 	p1[winw] = '\0';
! 	p1[winw + 1] = (nllen < winw) ? '\0' : nl[winw + 1];
  	if (ln && nbuf[ln])
! 	    memcpy(nl, p1, winw + 2);	/* next time obuf will be up-to-date */
  	else
  	    nl = p1;		/* don't keep the padding for prompt line */
  	nllen = winw;


-- 
Geoff Wing [mason@primenet.com.au]   Technical Manager
  Phone    : +61-3-9818 2977         PrimeNet - Internet Consultancy
  Facsimile: +61-3-9819 3788         Web : <URL:http://www.primenet.com.au/>
  Mobile   : 0412 162 441

