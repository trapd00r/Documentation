From zsh-workers-return-11561-mason-zsh=primenet.com.au@sunsite.auc.dk Wed May 24 15:34:50 2000
Return-Path: <zsh-workers-return-11561-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2941 invoked from network); 24 May 2000 15:34:48 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 24 May 2000 15:34:48 -0000
Received: (qmail 24326 invoked by alias); 24 May 2000 15:34:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11561
Received: (qmail 24318 invoked from network); 24 May 2000 15:34:38 -0000
Date: Wed, 24 May 2000 16:34:11 +0100
From: Peter Stephenson <pws@cambridgesiliconradio.com>
Subject: PATCH: RC_QUOTES
In-reply-to: "Your message of Tue, 23 May 2000 12:44:18 BST."
 <0FV000K1QGLUD7@la-la.cambridgesiliconradio.com>
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Message-id: <0FV200DGOLWYA8@la-la.cambridgesiliconradio.com>
Content-transfer-encoding: 7BIT

I wrote:
> I've finally discovered why this doesn't work for me.  First, $'...''...'
> is using RCQUOTES to interpolate a ' in the middle.  I suspect this is
> wrong with $'...', since you can quote a single quote in that, but I'll
> take counsel before trying to fix it.

Nobody replied.  Does anyone object to my changing it?  Given the wording
of the option description, I am even more inclined to regard this as a bug,
but I've made it explicit there, too.

Index: Doc/Zsh/options.yo
===================================================================
RCS file: /cvsroot/zsh/zsh/Doc/Zsh/options.yo,v
retrieving revision 1.7
diff -u -r1.7 options.yo
--- Doc/Zsh/options.yo	2000/05/22 07:03:38	1.7
+++ Doc/Zsh/options.yo	2000/05/24 15:26:44
@@ -917,7 +917,9 @@
 cindex(quoting style, rc)
 item(tt(RC_QUOTES))(
 Allow the character sequence `tt('')' to signify a single quote
-within singly quoted strings.
+within singly quoted strings.  Note this does not apply in quoted strings
+using the format tt($')var(...)tt('), where a backslashed single quote can
+be used.
 )
 pindex(RCS)
 cindex(startup files, sourcing)
Index: Src/lex.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/lex.c,v
retrieving revision 1.6
diff -u -r1.6 lex.c
--- Src/lex.c	2000/05/23 08:20:57	1.6
+++ Src/lex.c	2000/05/24 15:26:44
@@ -1190,7 +1190,7 @@
 		    goto brk;
 		}
 		e = hgetc();
-		if (e != '\'' || unset(RCQUOTES))
+		if (e != '\'' || unset(RCQUOTES) || strquote)
 		    break;
 		add(c);
 	    }

-- 
Peter Stephenson <pws@cambridgesiliconradio.com>
Cambridge Silicon Radio, Unit 300, Science Park, Milton Road,
Cambridge, CB4 0XL, UK                          Tel: +44 (0)1223 392070

