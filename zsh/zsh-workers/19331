From zsh-workers-return-19331-mason-zsh=primenet.com.au@sunsite.dk Thu Dec 25 11:50:42 2003
Return-Path: <zsh-workers-return-19331-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7403 invoked from network); 25 Dec 2003 11:50:41 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 25 Dec 2003 11:50:41 -0000
Received: (qmail 12348 invoked by alias); 25 Dec 2003 11:50:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19331
Received: (qmail 12268 invoked from network); 25 Dec 2003 11:50:35 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 25 Dec 2003 11:50:35 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [192.35.17.14] by sunsite.dk (MessageWall 1.0.8) with SMTP; 25 Dec 2003 11:50:34 -0000
Received: from mail3.siemens.de (mail3.siemens.de [139.25.208.14])
	by david.siemens.de (8.11.7/8.11.7) with ESMTP id hBPBoYr18034
	for <zsh-workers@sunsite.dk>; Thu, 25 Dec 2003 12:50:34 +0100 (MET)
Received: from mowp006a.ww600.siemens.net (mowp006a.ru001.siemens.net [163.242.193.6])
	by mail3.siemens.de (8.11.7/8.11.7) with ESMTP id hBPBoWj29804
	for <zsh-workers@sunsite.dk>; Thu, 25 Dec 2003 12:50:32 +0100 (MET)
Received: by mowp006a.ru001.siemens.net with Internet Mail Service (5.5.2653.19)
	id <Y7SABH20>; Thu, 25 Dec 2003 14:50:31 +0300
Message-ID: <66F451E8923A3D42B22434287141E2E3C675A5@mowp006a.ru001.siemens.net>
From: Borzenkov Andrey <Andrey.Borzenkov@siemens.com>
To: "'Zsh hackers list'" <zsh-workers@sunsite.dk>
Subject: RE: autoconf 2.5 (Re: PATCH: terminfo horor) 
Date: Thu, 25 Dec 2003 14:49:49 +0300
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: text/plain


> 
> The configure script is creating config.modules twice. Second time
> round when evaluating $link using the code in terminfo.mdd,
> $ac_cv_func_tigetstr was unset. It seems the configure script runs
> config.status. By running configure with --no-create, it was happy to
> build terminfo.so. Switching from autoconf 2.57 to 2.13 also solved the
> issue.
> 

looking in current zshconfig.ac it should not do it unless something else is
buggy.

> configure cats config.modules.sh into config.status using
> AC_OUTPUT_COMMANDS which is obsolete in autoconf 2.5. Using the new
> AC_CONFIG_COMMANDS doesn't help because variables like
> $ac_cv_func_tigetstr are still not set.
> 
> Does anyone understand the real point of config.status? Why does
> configure need to run it? I get the impression that it should contain
> just a duplicate of what is in config.modules as created and recreate
> it as opposed to rerunning scripts to derive its contents.
> 

I do not remember if it was me who put it in. Anyway

- autoconf 2.13 creates output files as the final step in running configure.
It is using environment variables CONFIG_FILES et al to pass information
which files are to be created further down

- autoconf 2.5 does not create anything in configure. Instead the sole point
of configure script is to create config.status - and it is config.status
that finally does (should do) the job of creating files, making
substitutions etc

apparently zshconfig.ac  tries to detect 2.5 by checking if
$CONFIG_FILES$CONFIG_HEADERS is empty; if it is it dumps config.modules.sh
into config.status. Hmm ... and runs it once more after that ... that looks
strange.

> We really ought to ditch support for autoconf 2.13 in the 4.1 branch.
> Not having a mixture will just make things simpler.
>

yes. 2.5 makes many things simpler and more consistent. OTOH I remember I
have tried to switch over to 2.5 way - doing job in config.status - and
failed for some reasons (do not remember exactly) - I guess I attempted to
move creation of all makefiles into config.status instead of creating
makefiles during make run. Also it definitely was not portable across
2.13/2.5

we could try it once more if 2.13 compatibility is not an issue.

-andrey

