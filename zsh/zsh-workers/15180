From zsh-workers-return-15180-mason-zsh=primenet.com.au@sunsite.dk Fri Jun 29 14:42:57 2001
Return-Path: <zsh-workers-return-15180-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2818 invoked from network); 29 Jun 2001 14:42:55 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 29 Jun 2001 14:42:55 -0000
Received: (qmail 4251 invoked by alias); 29 Jun 2001 14:42:02 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15180
Received: (qmail 4209 invoked from network); 29 Jun 2001 14:42:01 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer goliath.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "ZSH Workers Mailing List" <zsh-workers@sunsite.dk>
Subject: PATCH: final patch for AIX
Date: Fri, 29 Jun 2001 18:41:51 +0400
Message-ID: <000301c100a9$a20b09f0$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="koi8-r"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
Importance: Normal
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2479.0006

This makes termcap the default and adds explicit shared type for modules.
Hopefully, it is all for now.

I briefly considered using private variables (like in zftp) but it was too
much hassle and easy workaround is available (termcap). To pursue it further
somebody with AIX knowledge and access is needed.

Should AIX 3.x be moved in "Other machines" section?

-andrej

Index: zshconfig.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/zshconfig.ac,v
retrieving revision 1.9
diff -u -r1.9 zshconfig.ac
--- zshconfig.ac        2001/06/27 21:57:30     1.9
+++ zshconfig.ac        2001/06/29 14:26:15
@@ -553,7 +553,7 @@
   termcap_curses_order="termcap curses ncurses"
 fi],
 [case "$host_os" in
-  aix*|hpux10.*|hpux11.*|solaris*)
+  hpux10.*|hpux11.*|solaris*)
       termcap_curses_order="curses ncurses termcap" ;;
   *)             termcap_curses_order="termcap curses ncurses" ;;
 esac])dnl
@@ -1535,6 +1535,11 @@
   DL_EXT="${DL_EXT=so}"
   DLLD="${DLLD=$CC}"
   zsh_cv_func_dlsym_needs_underscore=no
+  if test -n "$GCC"; then
+    DLLDFLAGS=${DLLDFLAGS=-shared}
+  else
+    DLLDFLAGS=${DLLDFLAGS=-bM:SRE}
+  fi
   DLLDFLAGS=${DLLDFLAGS=}
   EXTRA_LDFLAGS=${EXTRA_LDFLAGS=}
   EXPOPT=${LDARG}-bE:
bor@itsrm2% vi Etc/MACHINES
bor@itsrm2% cvs diff
Index: zshconfig.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/zshconfig.ac,v
retrieving revision 1.9
diff -u -r1.9 zshconfig.ac
--- zshconfig.ac        2001/06/27 21:57:30     1.9
+++ zshconfig.ac        2001/06/29 14:40:05
@@ -553,7 +553,7 @@
   termcap_curses_order="termcap curses ncurses"
 fi],
 [case "$host_os" in
-  aix*|hpux10.*|hpux11.*|solaris*)
+  hpux10.*|hpux11.*|solaris*)
       termcap_curses_order="curses ncurses termcap" ;;
   *)             termcap_curses_order="termcap curses ncurses" ;;
 esac])dnl
@@ -1535,6 +1535,11 @@
   DL_EXT="${DL_EXT=so}"
   DLLD="${DLLD=$CC}"
   zsh_cv_func_dlsym_needs_underscore=no
+  if test -n "$GCC"; then
+    DLLDFLAGS=${DLLDFLAGS=-shared}
+  else
+    DLLDFLAGS=${DLLDFLAGS=-bM:SRE}
+  fi
   DLLDFLAGS=${DLLDFLAGS=}
   EXTRA_LDFLAGS=${EXTRA_LDFLAGS=}
   EXPOPT=${LDARG}-bE:
Index: Etc/MACHINES
===================================================================
RCS file: /cvsroot/zsh/zsh/Etc/MACHINES,v
retrieving revision 1.12
diff -u -r1.12 MACHINES
--- Etc/MACHINES        2001/06/01 13:58:54     1.12
+++ Etc/MACHINES        2001/06/29 14:40:39
@@ -72,7 +72,7 @@
        Compiling with gcc 2.7.1 is known to fail with header file
        conflicts on HP-UX 11.  Use the HP ANSI C compiler.

-IBM: AIX 3.2, 4.1
+IBM: AIX 3.2, 4.x
        Should build `out-of-the-box', but --enable-zsh-mem will not work.

        On 3.2, for 64-bit integer support you need to compile with gcc, as
@@ -81,6 +81,12 @@
        --enable-dynamic (the default) with gcc (version was 2.7.2.3) in
        4.1, though native cc works. More information about this problem
        would be appreciated.
+
+       It was reported, that at least some 4.x versions have problem
+       with curses - variables boolcodes and some other are declared
+       in term.h but missing is libcurses.a. That makes native compiler
+       very unhappy (GCC 3.0 apparently does not mind). Zsh now defaults
+       to termcap on AIX; any info about this problem is appreciated.

 Linux: Linux 2.* (various 32-bit and 64-bit processors)
        Should build `out-of-the-box'.

