From zsh-workers-return-21108-mason-zsh=primenet.com.au@sunsite.dk Thu Apr 07 16:45:05 2005
Return-Path: <zsh-workers-return-21108-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9942 invoked from network); 7 Apr 2005 16:45:03 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 7 Apr 2005 16:45:03 -0000
Received: (qmail 65871 invoked from network); 7 Apr 2005 16:44:56 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 Apr 2005 16:44:56 -0000
Received: (qmail 26566 invoked by alias); 7 Apr 2005 16:44:52 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21108
Received: (qmail 26552 invoked from network); 7 Apr 2005 16:44:52 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 7 Apr 2005 16:44:52 -0000
Received: (qmail 65600 invoked from network); 7 Apr 2005 16:44:52 -0000
Received: from mail36.messagelabs.com (193.109.254.211)
  by a.mx.sunsite.dk with SMTP; 7 Apr 2005 16:44:42 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-4.tower-36.messagelabs.com!1112892281!15923282!1
X-StarScan-Version: 5.4.11; banners=-,-,-
X-Originating-IP: [158.234.9.163]
Received: (qmail 11269 invoked from network); 7 Apr 2005 16:44:41 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-4.tower-36.messagelabs.com with SMTP; 7 Apr 2005 16:44:41 -0000
Received: from trentino.logica.co.uk ([158.234.142.59])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id j37GifR9009653
	for <zsh-workers@sunsite.dk>; Thu, 7 Apr 2005 17:44:41 +0100
Received: from trentino.groupinfra.com (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP id DD2E34AB06
	for <zsh-workers@sunsite.dk>; Thu,  7 Apr 2005 18:44:20 +0200 (CEST)
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <25526.1112889862@trentino.groupinfra.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <200504061125.j36BP1Fs029244@news01.csr.com> <20050406212036.GA12193@fermat.math.technion.ac.il> <27939.1112860797@trentino.groupinfra.com> <20050407144954.GN64927@dan.emsphone.com> <25526.1112889862@trentino.groupinfra.com>
To: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: zsh 4.2.5 
Date: Thu, 07 Apr 2005 18:44:20 +0200
Message-ID: <27362.1112892260@trentino.groupinfra.com>
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

I wrote:
> Okay, so we need to find out if iconv.h comes from libiconv. That's

Sorry for following up to myself but there's a further point I thought
I'd mention. 

In zsh, iconv conversions are only done to the encoding used in the
current locale which is retrieved using nl_langinfo(CODESET). On Solaris
that returns things like "646" and "8859" which the native iconv
understands but libiconv doesn't. Anyone who is building on Solaris with
gcc and libiconv installed would probably be wise to use
CFLAGS=-I/usr/include. That also has the advantage that the resulting
binary will run on another Solaris box which lacks libiconv.

We could do things like attempting to normalise the output of
nl_langinfo(CODESET) but \u is only really useful when the encoding is
something like UTF-8 and that only has one name. It is also tempting to
suggest automatically digging around for the system iconv.h but it's
better to leave control in the hands of the user so they can have the
choice of using libiconv.

Oliver

