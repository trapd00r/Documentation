From zsh-users-return-13881-mason-zsh=primenet.com.au@sunsite.dk Thu Mar 05 16:16:50 2009
Return-Path: <zsh-users-return-13881-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14033 invoked from network); 5 Mar 2009 16:16:46 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 Mar 2009 16:16:46 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 46558 invoked from network); 5 Mar 2009 16:16:33 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 Mar 2009 16:16:33 -0000
Received: (qmail 26826 invoked by alias); 5 Mar 2009 16:16:17 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13881
Received: (qmail 26817 invoked from network); 5 Mar 2009 16:16:16 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 5 Mar 2009 16:16:16 -0000
Received: from vms173019pub.verizon.net (vms173019pub.verizon.net [206.46.173.19])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 3DDDA80307F7
	for <zsh-users@sunsite.dk>; Thu,  5 Mar 2009 17:16:00 +0100 (CET)
Received: from torch.brasslantern.com ([173.67.122.60])
 by vms173019.mailsrvcs.net
 (Sun Java(tm) System Messaging Server 6.3-7.04 (built Sep 26 2008; 32bit))
 with ESMTPA id <0KG1005DRJUDQOXU@vms173019.mailsrvcs.net> for
 zsh-users@sunsite.dk; Thu, 05 Mar 2009 10:15:50 -0600 (CST)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id n25GFmpJ004605	for
 <zsh-users@sunsite.dk>; Thu, 05 Mar 2009 08:15:49 -0800
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id n25GFmiN004604	for zsh-users@sunsite.dk; Thu,
 05 Mar 2009 08:15:48 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <090305081548.ZM4603@torch.brasslantern.com>
Date: Thu, 05 Mar 2009 08:15:48 -0800
In-reply-to: <d5baa8100903050235ofd66039jf2c29b58684bc8d8@mail.gmail.com>
Comments: In reply to ruud grosmann <r.grosmann@gmail.com>
 "expansion of environment variables" (Mar  5, 11:35am)
References: <d5baa8100903050235ofd66039jf2c29b58684bc8d8@mail.gmail.com>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: zsh-users@sunsite.dk
Subject: Re: expansion of environment variables
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii
X-Virus-Scanned: ClamAV 0.92.1/9074/Thu Mar  5 16:21:02 2009 on bifrost
X-Virus-Status: Clean

On Mar 5, 11:35am, ruud grosmann wrote:
}
} The new version has a feature that is not in the 3.0 version. I would
} like to disable the feature, but I am not sure if an option exist for
} that one. Maybe you can help me.

I don't know why this would have changed, but it does not appear that
there is any way to turn it off.  Both the expand-or-complete and the
complete-word widgets expand the variable; I would have expected the
latter not to.

Worse, if I enable the new completion system with 'compinit' then the
variable doesn't expand but the completion doesn't work.  I mention
this because with the new completion system enabled, the 'suffix'
zstyle is supposed to control exactly what Ruud is asking about, and
the default is to have the "old" behavior that he wants.
 
For benefit of zsh-workers, with compinit this is yet another problem
in _path_files.  At line 479 (latest CVS) it correctly assigns the
expanded list of files to the tmp2 array (having originally gotten
them from "compadd -D tmp1" at line 466), but then when building the
exppaths array at lines 484 or 486, it uses ${tpre}${tsuf} which have
never been expanded.

I'm also not sure how line 484 can ever be reached, since at 479
"${(@)tmp2:h}" is always going to strip off any trailing slash.  It
seems a bit strange to compare an entire array to a single pattern
at line 483 as well, but I guess it works since the last element of
the array should be representative of any single element.

