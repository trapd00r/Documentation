From zsh-users-return-15410-mason-zsh=primenet.com.au@zsh.org Sat Sep 18 23:58:33 2010
Return-Path: <zsh-users-return-15410-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6363 invoked by alias); 18 Sep 2010 23:58:33 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15410
Received: (qmail 1396 invoked from network); 18 Sep 2010 23:58:29 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.0 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,
	T_TO_NO_BRKTS_FREEMAIL autolearn=ham version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.216.171 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=i0fbpTf2V5VF87GIdh+J6pJiBVrT0fehYNsS+3tGiqk=;
        b=dZUM1Tqb/xmZAmMFFDy26C3ZRR/rK9BmLbp80v6behLdxwpPoBgyD9LAwQZiHFp/ZW
         ZAhuS6YXCHkh11gn0hKKCUF0ioYlW3hWJ5rHIypMbVEPCdVhrIUXng+Yy6XQmzDP5Cri
         Ec8oezaL+0a/ahBD/IKu97uaY882akcBOLoGI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=RTvqPPRQgrnw1gCWQzGhSiXOV+EJrNUczEIV0Tgb699t5Kb1AlK24qyGk8rj30jE2z
         LgkkK6ukNMkOzF/pZ+hxPQ6pLOpHMoH9XkJ+TOeEuBM0Yq9s/Wv4/EQYrAXP34A1ueCg
         r1PlBdC0IeTxaxE+bxfypvQCEcZdp2Ypj1xF0=
MIME-Version: 1.0
In-Reply-To: <20100918230945.GA4530@Lancelot>
References: <AANLkTinNJXay4pibEiQmKR4PSRcNiwCJ3w==Scc9rco0@mail.gmail.com>
 <20100913130345.GA9240@Lancelot> <AANLkTikq=h-awW+-HAB8-QWdg0dWTuY+uydMu-Ezmt-0@mail.gmail.com>
 <6227C736-CCD3-4E09-A922-106573F3D70D@biskalar.de> <AANLkTimj6n_qSd3_5Egk6RN=v47GwWBb+W3_MjWpMs4t@mail.gmail.com>
 <AANLkTi=28cEq+XhxCy7pYKtu+bmSNG3QSKMfBUckJ7Tc@mail.gmail.com> <20100918230945.GA4530@Lancelot>
From: Michel <michel.barret@gmail.com>
Date: Sun, 19 Sep 2010 01:58:04 +0200
Message-ID: <AANLkTin4ufgJ-5WHPxojvuukJiksMaqywFJtU0-So1Mo@mail.gmail.com>
Subject: Re: Dynamic colored command in zsh
To: zsh-users@zsh.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Thanks everybody for your help.

I have work with the first code give by Roy and I have this :
color_cmd() {
  res=3D$(builtin type $1 2>/dev/null)
  [ -z $res ] && return
  case $res in
    *'reserved word'*)  color=3D'magenta' ;;
    *'an alias'*)       color=3D'cyan'    ;;
    *'shell builtin'*)  color=3D'yellow'  ;;
    *'shell function'*) color=3D'green'   ;;
    *"$cms is"*)        color=3D'blue'    ;;
    *)                  color=3D'red'
  esac
  case $cmd in
    'sudo')   state=3D1 ;;
    'start')  state=3D1 ;;
    'time')   state=3D1 ;;
    'strace') state=3D1 ;;
    *)        state=3D2
  esac
}

color_arg() {
  case $1 in
    '--'*) color=3D'magenta' ;;
    '-'*)  color=3D'cyan'    ;;
    *)     color=3D'red'
  esac
}

color_string() {
  case $1 in
    '"'*) color=3D'yellow' ;;
    "'"*) color=3D'yellow' ;;
    *)       color=3D''
  esac
}

recolor-cmd() {
  args=3D(${(z)BUFFER})
  offset=3D0
  state=3D1
  region_highlight=3D()
  for cmd in $args; do
    if [ $state -eq 1 ]; then
      color_cmd $cmd
    elif [ $state -eq 2 ]; then
      color_arg $cmd
      if [[ "$color" =3D~ 'red' ]]; then
        color_string $cmd
      fi
    fi
    if [ -n "$color" ]; then
      region_highlight=3D($region_highlight "$offset $((${#cmd}+offset))
fg=3D${color},bold")
    fi
    offset=3D$((offset+${#cmd}+1))
    case $cmd in
      *'|')  state=3D1 ;;
      *'&')  state=3D1 ;;
      *';')  state=3D1 ;;
    esac
  done
}

check-cmd-self-insert() { zle .self-insert && recolor-cmd }
check-cmd-backward-delete-char() { zle .backward-delete-char && recolor-cmd=
 }
#check-cmd-expand-or-complete() { zle .expand-or-complete } # && recolor-cm=
d }

zle -N self-insert check-cmd-self-insert
#zle -N expand-or-complete check-cmd-expand-or-complete
zle -N backward-delete-char check-cmd-backward-delete-char

_____________________
Michel BARRET



2010/9/19 Roy Zuo <roylzuo@gmail.com>:
> Not exactly the same code, but the same feature and less bugs.
>
> =C2=A0 =C2=A0recolor-cmd() {
> =C2=A0 =C2=A0 =C2=A0 =C2=A0region_highlight=3D()
> =C2=A0 =C2=A0 =C2=A0 =C2=A0colorize=3Dtrue
> =C2=A0 =C2=A0 =C2=A0 =C2=A0start_pos=3D0
> =C2=A0 =C2=A0 =C2=A0 =C2=A0for arg in ${(z)BUFFER}; do
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0((start_pos+=3D${#BUFFER[$start_=
pos+1,-1]}-${#${BUFFER[$start_pos+1,-1]## #}}))
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0((end_pos=3D$start_pos+${#arg}))
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0if $colorize; then
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0colorize=3Dfalse
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0res=3D$(LC_ALL=3DC=
 builtin type $arg 2>/dev/null)
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0case $res in
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0*'re=
served word'*) =C2=A0 style=3D"fg=3Dmagenta,bold";;
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0*'al=
ias for'*) =C2=A0 =C2=A0 =C2=A0 style=3D"fg=3Dcyan,bold";;
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0*'sh=
ell builtin'*) =C2=A0 style=3D"fg=3Dyellow,bold";;
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0*'sh=
ell function'*) =C2=A0style=3D'fg=3Dgreen,bold';;
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0*"$a=
rg is"*)
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0[[ $arg =3D 'sudo' ]] && style=3D"fg=3Dred,bold" || style=3D"fg=
=3Dblue,bold";;
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0*) =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 style=3D'non=
e,bold';;
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0esac
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0region_highlight+=
=3D("$start_pos $end_pos $style")
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0fi
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0if [[ $arg =3D '|' ]] || [[ $arg=
 =3D 'sudo' ]]; then
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0colorize=3D=
true
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0fi
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0start_pos=3D$end_pos
> =C2=A0 =C2=A0 =C2=A0 =C2=A0done
> =C2=A0 =C2=A0}
>
> =C2=A0 =C2=A0check-cmd-self-insert() { zle .self-insert && recolor-cmd }
> =C2=A0 =C2=A0check-cmd-backward-delete-char() { zle .backward-delete-char=
 && recolor-cmd }
>
> =C2=A0 =C2=A0zle -N self-insert check-cmd-self-insert
> =C2=A0 =C2=A0zle -N backward-delete-char check-cmd-backward-delete-char
>
> Roy
>
> On Sat, Sep 18, 2010 at 06:03:42PM +0200, Richard Hartmann wrote:
>> On Mon, Sep 13, 2010 at 16:34, Julien Nicoulaud
>> <julien.nicoulaud@gmail.com> wrote:
>>
>> > I created a collaborative notepad, feel free to improve it:
>> > http://ethercodes.com/zDUmDAuWiV
>>
>> That link does not seem to work, any more.
>>
>>
>> Richard
>>
>
> --
> =C2=A0____________________________________________________________
> / Nothing will dispel enthusiasm like a small admission fee. \
> | =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0|
> \ -- Kim Hubbard =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 /
> =C2=A0------------------------------------------------------------
> =C2=A0 =C2=A0 =C2=A0 \ =C2=A0 ,__,
> =C2=A0 =C2=A0 =C2=A0 =C2=A0\ =C2=A0(oo)____
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (__) =C2=A0 =C2=A0)\
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0||--|| *
>

