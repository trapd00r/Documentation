From zsh-workers-return-21720-mason-zsh=primenet.com.au@sunsite.dk Fri Sep 09 16:52:59 2005
Return-Path: <zsh-workers-return-21720-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28623 invoked from network); 9 Sep 2005 16:52:55 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 9 Sep 2005 16:52:55 -0000
Received: (qmail 47456 invoked from network); 9 Sep 2005 16:52:46 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 Sep 2005 16:52:46 -0000
Received: (qmail 25838 invoked by alias); 9 Sep 2005 16:52:41 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21720
Received: (qmail 25747 invoked from network); 9 Sep 2005 16:52:40 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 9 Sep 2005 16:52:40 -0000
Received: (qmail 45913 invoked from network); 9 Sep 2005 16:52:39 -0000
Received: from mailhost1.csr.com (HELO MAILSWEEPER01.csr.com) (81.105.217.43)
  by a.mx.sunsite.dk with SMTP; 9 Sep 2005 16:52:32 -0000
Received: from exchange03.csr.com (unverified [10.100.137.60]) by 
    MAILSWEEPER01.csr.com (Content Technologies SMTPRS 4.3.12) with ESMTP id 
    <T73486b09500a6c8d012dc@MAILSWEEPER01.csr.com> for 
    <zsh-workers@sunsite.dk>; Fri, 9 Sep 2005 17:50:13 +0100
Received: from news01 ([10.103.143.38]) by exchange03.csr.com with Microsoft 
    SMTPSVC (5.0.2195.6713); Fri, 9 Sep 2005 17:53:36 +0100
Date: Fri, 9 Sep 2005 17:52:44 +0100
From: Peter Stephenson <pws@csr.com>
To: zsh-workers@sunsite.dk
Subject: Re: various weirdnesses with unicode support
Message-Id: <20050909175244.39bae9c6.pws@csr.com>
In-Reply-To: <237967ef050909053330303540@mail.gmail.com>
References: <237967ef05090713304637c1f1@mail.gmail.com> 
    <20050908085533.GA2463@fargo> 
    <200509081002.j88A215f024377@news01.csr.com> 
    <20050908113246.52522e05.pws@csr.com> 
    <237967ef0509080731646f7306@mail.gmail.com> 
    <20050909125341.12a21423.pws@csr.com> 
    <237967ef050909053330303540@mail.gmail.com>
Organization: Cambridge Silicon Radio
X-Mailer: Sylpheed version 0.9.12 (GTK+ 1.2.10; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 09 Sep 2005 16:53:36.0812 (UTC) 
    FILETIME=[0576CEC0:01C5B55F]
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.4

Mikael Magnusson <mikachu@gmail.com> wrote:
> As for confusing zsh with keyboard input, just running a terminal in
> some iso-8859 mode and running export LC_CTYPE=xx_XX.UTF-8 should be
> enough to trigger the thing i talked about, since zsh then expects the
> input to be UTF-8.

Something like this worked... this leads to the following patch which
should improve matters a bit.

Index: Src/Zle/zle_main.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_main.c,v
retrieving revision 1.74
diff -u -r1.74 zle_main.c
--- Src/Zle/zle_main.c	9 Sep 2005 11:48:28 -0000	1.74
+++ Src/Zle/zle_main.c	9 Sep 2005 16:50:19 -0000
@@ -814,7 +814,8 @@
 		 * timed out.  This probably indicates a duff character.
 		 * Return a '?'.
 		 */
-		lastchar_wide = L'?';
+		lastchar = '?';
+		return lastchar_wide = L'?';
 	    }
 	    else
 		return lastchar_wide = WEOF;



-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

**********************************************************************

