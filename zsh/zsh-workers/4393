From zsh-workers-request@math.gatech.edu Mon Sep 21 08:47:46 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13278 invoked from network); 21 Sep 1998 08:47:45 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 21 Sep 1998 08:47:45 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id EAA18966;
	Mon, 21 Sep 1998 04:38:50 -0400 (EDT)
Resent-Date: Mon, 21 Sep 1998 04:38:50 -0400 (EDT)
Date: Mon, 21 Sep 1998 10:41:37 +0200 (MET DST)
Message-Id: <199809210841.KAA01691@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@math.gatech.edu
Subject: PATCH: fix for completion with -W
Resent-Message-ID: <"jSr83.0.He4.P2X1s"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4393
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu


Hello

The patch below fixes my patch that allowed multiple directories with -W.
The problem was that -W with only one directory and a path prefix on
the line was handled incorrectly (the prefix on the line being ignored).

Bye
 Sven

*** Src/Zle/zle_tricky.c	Thu Aug 27 13:24:19 1998
--- ../Src/Zle/zle_tricky.c	Mon Sep 21 10:33:30 1998
***************
*** 3848,3854 ****
  		}
  		if (!dirs) {
  		    dirs = ta;
! 		    ta[0] = (cc->withd ? cc->withd : ppre);
  		    ta[1] = NULL;
  		}
  		while (*dirs) {
--- 3849,3864 ----
  		}
  		if (!dirs) {
  		    dirs = ta;
! 		    if (cc->withd) {
! 			char *tp;
! 			int pl = strlen(cc->withd);
! 
! 			ta[0] = tp = (char *) halloc(strlen(ppre) + pl + 2);
! 			strcpy(tp, cc->withd);
! 			tp[pl] = '/';
! 			strcpy(tp + pl + 1, ppre);
! 		    } else
! 			ta[0] = ppre;
  		    ta[1] = NULL;
  		}
  		while (*dirs) {


--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

