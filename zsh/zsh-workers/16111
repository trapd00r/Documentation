From zsh-workers-return-16111-mason-zsh=primenet.com.au@sunsite.dk Mon Oct 22 15:04:58 2001
Return-Path: <zsh-workers-return-16111-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15479 invoked from network); 22 Oct 2001 15:04:57 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 22 Oct 2001 15:04:57 -0000
Received: (qmail 29856 invoked by alias); 22 Oct 2001 15:04:44 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16111
Received: (qmail 29818 invoked from network); 22 Oct 2001 15:04:39 -0000
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <1011022150435.ZM16767@candle.brasslantern.com>
Date: Mon, 22 Oct 2001 15:04:35 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.dk
Subject: PATCH: "limit" should not set a limit to 0 on bad input
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

Remind me again why "limit" doesn't understand a spec of "unlimited"?

Index: Src/Builtins/rlimits.c
===================================================================
--- Src/Builtins/rlimits.c	2001/04/09 20:14:13	1.1.1.1
+++ Src/Builtins/rlimits.c	2001/10/22 15:01:09
@@ -332,7 +332,12 @@
 	} else if (limtype[lim] == ZLIMTYPE_NUMBER || limtype[lim] == ZLIMTYPE_UNKNOWN) {
 	    /* pure numeric resource -- only a straight decimal number is
 	    permitted. */
-	    val = zstrtorlimt(s, &s, 10);
+	    char *t = s;
+	    val = zstrtorlimt(t, &s, 10);
+	    if (s == t) {
+		zwarnnam("limit", "limit must be a number", NULL, 0);
+		return 1;
+	    }
 	} else {
 	    /* memory-type resource -- `k' and `M' modifiers are permitted,
 	    meaning (respectively) 2^10 and 2^20. */

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

