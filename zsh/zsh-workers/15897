From zsh-workers-return-15897-mason-zsh=primenet.com.au@sunsite.dk Sat Sep 29 21:29:12 2001
Return-Path: <zsh-workers-return-15897-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13989 invoked from network); 29 Sep 2001 21:29:11 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 29 Sep 2001 21:29:11 -0000
Received: (qmail 12810 invoked by alias); 29 Sep 2001 21:29:06 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15897
Received: (qmail 12799 invoked from network); 29 Sep 2001 21:29:05 -0000
From: Borsenkow Andrej <Andrej.Borsenkow@mow.siemens.ru>
To: lordzork@lordzork.com
Cc: ZSH Workers Mailing List <zsh-workers@sunsite.dk>
Message-ID: <3BB63D16.5040709@mow.siemens.ru>
Date: Sun, 30 Sep 2001 01:28:54 +0400
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:0.9.4) Gecko/20010914
X-Accept-Language: en-us
MIME-Version: 1.0
Subject: Re: error on TTY read: no such file or directory
References: <20010910200737.A6256@hithaeglir.net> <001f01c13abb$6997dca0$21c9ca95@mow.siemens.ru> <20010911084904.A11501@hithaeglir.net> <1010911140155.ZM24429@candle.brasslantern.com> <20010928121347.B16561@hithaeglir.net> <3BB56D03.2000300@mow.siemens.ru> <20010929034953.E16561@hithaeglir.net> <3BB62E93.10802@mow.siemens.ru> <20010929170811.G16561@hithaeglir.net>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit

lordzork@lordzork.com wrote:

> In the gothic chambers of the underworld on Sat 29 Sep 2001 at 16:26 -0400,
> Borsenkow Andrej muttered darkly:
> 
> 
>>Could you send me the full strace. I promise nothing but this resembles 
>>something :)
>>
>>
> 
> certainly. here it is.
> 
> t.
> 
> 


open("/etc/zsh/zshenv", O_RDONLY|O_NOCTTY|O_LARGEFILE) = 3
...

open("/tmp/login-trace", O_WRONLY|O_CREAT|O_TRUNC|O_NOCTTY|O_LARGEFILE, 
0666) = 3
fcntl64(2, F_DUPFD, 10)                 = 13
close(2)                                = 0
dup2(3, 2)                              = 2
...
ioctl(2, SNDCTL_TMR_TIMEBASE, 0xbffff8d8) = -1 ENOTTY (Inappropriate 
ioctl for device)

fd 2 does not look like tty, does it? I presume you do exec > 
/tmp/login-trace very early in your /etc/zshenv

Still there is something weird going on:

write(10, "\r\33[m\33[m\33[m\33[J\n\33[1;30m[ \33[1;37mlc"..., 270) = 270
write(10, "\33[K", 3)                   = 3
read(10, "l", 1)                        = 1
write(10, "l", 1)                       = 1
read(10, "s", 1)                        = 1
write(10, "\10ls", 3)                   = 3
read(10, "syJ\10\10\0\0\0\0\0\0\0\0\240G\f\10\0\0\0\0\1\0\0\0\0\0"..., 
1) = 1025

Oops. Where does this last line comes from?

-andrej


