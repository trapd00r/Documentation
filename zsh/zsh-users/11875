From zsh-users-return-11875-mason-zsh=primenet.com.au@sunsite.dk Mon Sep 24 15:37:22 2007
Return-Path: <zsh-users-return-11875-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21686 invoked from network); 24 Sep 2007 15:37:13 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 24 Sep 2007 15:37:13 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 18545 invoked from network); 24 Sep 2007 15:37:06 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 24 Sep 2007 15:37:06 -0000
Received: (qmail 13401 invoked by alias); 24 Sep 2007 15:36:58 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11875
Received: (qmail 13379 invoked from network); 24 Sep 2007 15:36:57 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 24 Sep 2007 15:36:57 -0000
Received: (qmail 17313 invoked from network); 24 Sep 2007 15:36:57 -0000
Received: from lorien.comfychair.org (64.81.241.43)
  by a.mx.sunsite.dk with SMTP; 24 Sep 2007 15:36:51 -0000
Received: from lorien.comfychair.org (localhost [127.0.0.1])
	by lorien.comfychair.org (8.13.7/8.13.7) with ESMTP id l8OFafbU017460;
	Mon, 24 Sep 2007 08:36:41 -0700
Received: (from duvall@localhost)
	by lorien.comfychair.org (8.13.7/8.13.7/Submit) id l8OFae9n017459;
	Mon, 24 Sep 2007 08:36:41 -0700
Date: Mon, 24 Sep 2007 08:36:40 -0700
From: Danek Duvall <duvall@comfychair.org>
To: Peter Stephenson <pws@csr.com>
Cc: zsh-users@sunsite.dk
Subject: Re: _values and specifying -M to compadd
Message-ID: <20070924153640.GB32335@lorien.comfychair.org>
Mail-Followup-To: Danek Duvall <duvall@comfychair.org>,
	Peter Stephenson <pws@csr.com>, zsh-users@sunsite.dk
References: <20070924050450.GA32335@lorien.comfychair.org> <200709240924.l8O9OPNP005103@news01.csr.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <200709240924.l8O9OPNP005103@news01.csr.com>
User-Agent: mutt-ng/devel-r535 (Linux)

On Mon, Sep 24, 2007 at 10:24:25AM +0100, Peter Stephenson wrote:

> _values is designed to be smart about the values of key/value pairs,
> whereas you need something to be smart about the keys.  (_values is
> also a bit of a mess because the internals are delegated to a builtin
> "compvalues" which is only documented in the C source.)

Yeah, that stymied me.  :)  I wasn't all that intent into diving into the C
source.  Though if it's well commented, I might take a look anyway.

> Actually, using compadd directly isn't that hairy here.  I got this to work:

Wonderful.  I was missing the compset bits, and while I might have
eventually stumbled on the first, I probably wouldn't have gotten the
second.

The only thing remaining is to remove already-completed tokens, which I'm
doing with a simple loop over IPREFIX:

    for t in ${(s:,:)${IPREFIX//\\#\!/}}; do
        tokens=( ${tokens:#$t} )
    done

before passing tokens on to compadd.  It looked like there wasn't any
special magic in _values that did this, but it's sufficiently poorly
commented that I wasn't sure exactly where this was happening.

You can't think of a fruit starting with "e" either, eh?  :)

Thanks!
Danek

