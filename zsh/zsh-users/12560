From zsh-users-return-12560-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 13 14:38:42 2008
Return-Path: <zsh-users-return-12560-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14558 invoked from network); 13 Feb 2008 14:38:39 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 13 Feb 2008 14:38:39 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 3144 invoked from network); 13 Feb 2008 14:38:24 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 13 Feb 2008 14:38:24 -0000
Received: (qmail 12936 invoked by alias); 13 Feb 2008 14:38:15 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12560
Received: (qmail 12918 invoked from network); 13 Feb 2008 14:38:15 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 13 Feb 2008 14:38:15 -0000
Received: from prunille.vinc17.org (vinc17.pck.nerim.net [213.41.242.187])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 35AF780482A1
	for <zsh-users@sunsite.dk>; Wed, 13 Feb 2008 15:38:04 +0100 (CET)
Received: by prunille.vinc17.org (Postfix, from userid 501)
	id 20D5A1F9FD1D; Wed, 13 Feb 2008 15:38:04 +0100 (CET)
Date: Wed, 13 Feb 2008 15:38:03 +0100
From: Vincent Lefevre <vincent@vinc17.org>
To: "ZSH User List" <zsh-users@sunsite.dk>
Subject: Re: timeout problem in ssh sessions
Message-ID: <20080213143803.GI619@prunille.vinc17.org>
Mail-Followup-To: "ZSH User List" <zsh-users@sunsite.dk>
References: <20080211233404.GA13398@spiegl.de> <080212083755.ZM20121@torch.brasslantern.com> <20080212232947.GA13793@spiegl.de> <080212200708.ZM20711@torch.brasslantern.com> <20080213134200.GB31852@spiegl.de> <200802131349.m1DDnXRF004831@news01.csr.com> <27b8b8a0802130621x47568c7fo304848d02a1c6e76@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="6c2NcOVqGQ03X4Wi"
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <27b8b8a0802130621x47568c7fo304848d02a1c6e76@mail.gmail.com>
X-Mailer-Info: http://www.vinc17.org/mutt/
User-Agent: Mutt/1.5.17-vl-r19795 (2008-01-17)
X-Virus-Scanned: ClamAV 0.91.2/5798/Wed Feb 13 11:51:39 2008 on bifrost
X-Virus-Status: Clean


--6c2NcOVqGQ03X4Wi
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit

On 2008-02-13 22:21:22 +0800, ubergoonz wrote:
> I used to have this problem a few years ago when my workplace is using an
> older versio of openssh.
> 
> this is more like a behavior with openssh then zsh
> 
> http://www.openssh.com/faq.html#3.10
> http://www.snailbook.com/faq/background-jobs.auto.html

Note that hangs also occur when non-standard file descriptors are
still attached to the terminal. This happens when one does "exec zsh"
from some old tcsh versions (but that can still be found), because
tcsh forgot to close some descriptors in its exec builtin. So, I use
the attached wrapper in my .cshrc:

[...]
if ($?ZSH) then
  if (-x $ZSH) then
    setenv SHELL $ZSH
    if ($?loginsh) set ZSH = "$ZSH -l"
    if ($?prompt) echo "executing $ZSH"
    exec shexec $ZSH
  endif
endif

-- 
Vincent Lefèvre <vincent@vinc17.org> - Web: <http://www.vinc17.org/>
100% accessible validated (X)HTML - Blog: <http://www.vinc17.org/blog/>
Work: CR INRIA - computer arithmetic / Arenaire project (LIP, ENS-Lyon)

--6c2NcOVqGQ03X4Wi
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename=shexec

#!/usr/bin/env perl

# Workaround for the tcsh exec bug. Example:
#   tcsh> exec shexec zsh

use strict;

eval {
  require POSIX;
  foreach (3..63)
    { POSIX::close $_ if -t $_ }
  1;
} or warn <<"EOF";
Perl POSIX module not found! The non-standard file descriptors attached
to a tty (as those let open by this buggy tcsh) could not be closed.
EOF

exec @ARGV;

# $Id: shexec 11281 2006-02-27 13:24:27Z lefevre $

--6c2NcOVqGQ03X4Wi--

