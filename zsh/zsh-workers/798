From zsh-workers-request@euclid.skiles.gatech.edu  Wed Mar  6 09:31:31 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by werple.net.au (8.7/8.7.1) with ESMTP id JAA00877 for <mason@werple.mira.net.au>; Wed, 6 Mar 1996 09:31:27 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id RAA22171; Tue, 5 Mar 1996 17:09:37 -0500 (EST)
Resent-Date: Tue, 5 Mar 1996 17:09:37 -0500 (EST)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199603052208.XAA12680@bolyai.cs.elte.hu>
Subject: zsh-2.6-beta13-hzoli13 release
To: zsh-workers@math.gatech.edu (zsh-workers)
Date: Tue, 5 Mar 1996 23:08:56 +0100 (MET)
Organization: Dept. of Comp. Sci., Eotvos University, Budapest, Hungary
Phone: (36 1)2669833 ext: 2667, home phone: (36 1) 2752368
X-Mailer: ELM [version 2.4 PL24 PGP3 *ALPHA*]
Mime-Version: 1.0
Content-Type: application/pgp
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"X0kzt1.0.IQ5.WkBFn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/798
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

-----BEGIN PGP SIGNED MESSAGE-----

I've made a new zsh release which can be found at
ftp://bolyai.cs.elte.hu/pub/zsh/

Filenames and sizes:

 -rw-r--r--  411003 Mar  5 22:22 zsh-2.6-beta13-hzoli13-RCS.tar.gz
 -rw-r--r--  128561 Mar  5 22:30 zsh-2.6-beta13-hzoli13.diff.gz
 -rw-r--r--  636796 Mar  5 22:29 zsh-2.6-beta13-hzoli13.tar.gz

This version is almost 8-bit clean.  Even null characters are allowed in
parameters and in zsh scripts.  Builtin commands can also handle arguments
containing null characters.  Also character codes between 128 and 159 are now
usable.  The IFS is by default contains the null character as well.

Internally zsh inserts a Meta character before each null character or token
and toggles the 5th bit of these characters.  This makes implementation quite
easy.  E.g. no change required in the lexer.  The real problem is to find all
places when zsh communicates with the world.  Each input should be metafied
before it goes to zsh's stomach, and every output should be unmetafied.
Unfortunately I had not time to find all of these places so 8-bit support is
not complete yet.  Input handling is mostly complete.  Here the main miss is
the zsh editor which is not 8-bit clean yet so do not use zed to edit binary
files.  I think that the editor should use the raw 8-bit data for editing.
zle already have and ll variable for the line length so it is not necessary to
take the null character as the end of the buffer.  Unfortunately many routines
use the fact that line is null-terminated.  Also completion will be hard to
implement.

On the output side my main concern was to make echo and print fully 8-bit
clean.  Most other builtins will print the internal format (e.g. compctl -L &
co.).

As far as I know I found all places where zsh uses a library call with a
pathname.  Before each such call the filename should be unmetafied.  Globbing
should also handle 8-bit filenames correctly.

I'd invite everyone who has time to add the missing parts.  Making zle 8-bit
clean is by far the most difficult job here.  The rest are very simple.  All
you have to do is to call the provided unmetafy routine with apropriate
arguments to avoid memory leaks.  Or alternatively write a new zprintf() and
use that for all output.  The later would be easier but it's probably more
difficult to make it portable.

I prepared a patch which only contains my 8-bit modifications.  It is in

 -rw-r--r--   14812 Mar  5 22:34 8bit.diff.gz

on my ftp site.  It is provided only show you my changes although it would
probably apply to the hzoli12 release.  Also it could probably be modified to
apply to the vanilla release.

This release also fixes several other bugs and contains the named directory
hash table patch from Zefram.  Here it the complete list of changes.  I'll try
to post the bugfixes which can be applied to the vanilla release separately
later.

Wed Jan  3 1996:

 - Print tokens correctly in error messages (705)

 - read -q and read -k no longer screw up the terminal.  From Peter (565)

 - Whence -f is back.  From Zefram (644)

 - Set $? to 1 after wibble=$(false).  From Zefram (637)

 - A single ^ no longer crashes zsh.  From Peter (560)

Sat Jan  6 1996

 - A little zle_refresh bugfix from Zefram (706).

Mon Jan  8 1996

 - Fix echotc to work with ncurses

Wed Jan 24 1996

 - termbuf is now a local variable

Sat Feb 24 1996

 - Print thousands of a second correctly in time reports (793).

Fri March  1 1996

 - It's a bug to call lexsave with alstackind != 0 (792).

Sun March  3 1996

 - The first working and mostly 8-bit clean version.

 - add lexsave/lexrestore to parselstring()

 - save/restore tok with lexsave/lexrestore

 - prevent coredumps on some bad math expressions

 - a xored completion bugfix in zle_tricky.c

 - create temporary files with O_EXCL flag to improve security

 - init_term if necessary before putprompt. From Eskandar (791)

 - cd .. should not use cdpath

 - handle history correctly together with interactivecomments (from Peter, 741)
   get magic-space & completion work with interactivecomments (from me)

 - Line refresh fixes from Geoff Wing (742)

 - fc builtin fix

Mon March  4 1996

 - make n and N extended completions work on words with special characters

 - Store named directories in a hash table.  From Zefram (711)

 - Allos colon qualifiers with ^...^...^ history substitution.  From Peter (608)

 - Fix printquoted() to handle CSH_JUNKIE_QUOTES.  From Zefram (713)

 - AUTO_PUSHD option documentation fix forom Anthony Heading (598)

Zoltan

-----BEGIN PGP SIGNATURE-----
Version: 2.6.3i
Charset: noconv

iQCVAwUBMTy7dwupSCiLN749AQGKFAP+M3fTETI8vvHF3faiFOWXRfmFlcdNuREk
zabd0P2lcpPhnu53nBMTpVy5AKHHdxGtZycv/rCGcyRADYNaZvBbn8+YE+o/6z+b
uj+FUc7c26rEmFHtjce8EpSMwdLem38Ky+Edi3CGnTygaSDAJefSsY0le3xy7xJP
7AdU5PP92go=
=KFHc
-----END PGP SIGNATURE-----

