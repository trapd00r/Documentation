From zsh-workers-return-20658-mason-zsh=primenet.com.au@sunsite.dk Sun Jan 09 16:46:56 2005
Return-Path: <zsh-workers-return-20658-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7651 invoked from network); 9 Jan 2005 16:46:55 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 9 Jan 2005 16:46:55 -0000
Received: (qmail 72868 invoked from network); 9 Jan 2005 16:46:44 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 Jan 2005 16:46:44 -0000
Received: (qmail 11576 invoked by alias); 9 Jan 2005 16:46:41 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20658
Received: (qmail 11561 invoked from network); 9 Jan 2005 16:46:40 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 9 Jan 2005 16:46:40 -0000
Received: (qmail 72588 invoked from network); 9 Jan 2005 16:46:40 -0000
Received: from smtp-out6.blueyonder.co.uk (195.188.213.9)
  by a.mx.sunsite.dk with SMTP; 9 Jan 2005 16:46:37 -0000
Received: from sc ([82.41.236.30]) by smtp-out6.blueyonder.co.uk with Microsoft SMTPSVC(5.0.2195.6713);
	 Sun, 9 Jan 2005 16:47:09 +0000
Date: Sun, 9 Jan 2005 16:47:53 +0000
From: Stephane Chazelas <Stephane_Chazelas@yahoo.fr>
To: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: multios and unnecessary processes
Message-ID: <20050109164753.GA4246@sc>
Mail-Followup-To: Zsh hackers list <zsh-workers@sunsite.dk>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-15
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
User-Agent: Mutt/1.5.6i
X-OriginalArrivalTime: 09 Jan 2005 16:47:09.0780 (UTC) FILETIME=[DC652940:01C4F66A]
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

Hi, I would expect:

zsh -c 'lsof -ag $$ -d0-2,10-15 >&2 >&- >&2'

and 

zsh -c 'lsof -ag $$ -d0-2,10-15 >&2'

To work the same. However, in the first case, I get:

~$ zsh -c 'lsof -ag $$ -d0-2,10-15 >&2 >&- >&2'
~$ COMMAND  PID PGID     USER   FD   TYPE DEVICE SIZE  NODE NAME                                                                          16:39
lsof    7684 7684 chazelas    0u   CHR  136,6          8 /dev/pts/6
lsof    7684 7684 chazelas    1w  FIFO    0,7      21985 pipe
lsof    7684 7684 chazelas    2u   CHR  136,6          8 /dev/pts/6
zsh     7685 7684 chazelas   13u   CHR  136,6          8 /dev/pts/6
zsh     7685 7684 chazelas   14r  FIFO    0,7      21985 pipe

(note that my prompt is displayed before the result of lsof
because the output is written by that background zsh process).

In the second case, I get the expected behavior:

~$ zsh -c 'lsof -ag $$ -d0-2,10-15 >&2'
COMMAND  PID PGID     USER   FD   TYPE DEVICE SIZE NODE NAME
lsof    7702 7702 chazelas    0u   CHR  136,6         8 /dev/pts/6
lsof    7702 7702 chazelas    1u   CHR  136,6         8 /dev/pts/6
lsof    7702 7702 chazelas    2u   CHR  136,6         8 /dev/pts/6


I came accross this while trying to make some code independant
of the multios setting (hence the >&- to cancel the teed
redirection).

~$ zsh -f
% zmodload zsh/parameter
% echo $options[multios]
on

I'm not too sure it's a good idea to make multios the default.

-- 
Stéphane

