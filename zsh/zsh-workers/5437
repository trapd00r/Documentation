From zsh-workers-return-5437-mason-zsh=primenet.com.au@sunsite.auc.dk Sat Feb 20 13:20:47 1999
Return-Path: <zsh-workers-return-5437-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14842 invoked from network); 20 Feb 1999 13:20:46 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 20 Feb 1999 13:20:46 -0000
Received: (qmail 1454 invoked by alias); 20 Feb 1999 13:20:34 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5437
Received: (qmail 10899 invoked from network); 20 Feb 1999 11:16:44 -0000
Message-Id: <9902191644.AA15484@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: Bug in guess what?
Date: Fri, 19 Feb 1999 17:44:58 +0100
From: Peter Stephenson <pws@ibmth.df.unipi.it>

I think I've got all the patches to date (I certainly hope so), but I'm
still getting problems with the following completion:

% _foo() { [[ -string '=' ]] && complist -f; }
% defcomp _foo foo
% foo bar=^D

now pauses for a long time, then asks if I want to see its list of 1931
completions, which I don't much but they seem to be external commands
(except that there are 2757 of those and I get them much more quickly).
-class does the same.  However, the following works splendidly.

_foo() {   
  if [[ $PREFIX = *'='* ]]; then
    IPREFIX=${PREFIX%%=*}=
    PREFIX=${PREFIX#*=}
    complist -f
  fi
}

(And maybe it's just me, but sometimes when I look at set -x output from
these things, PREFIX is full of \'s (such as \= in the above), and
sometimes they're not there.  I haven't worked this out, but maybe it's not
important.)

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

