From zsh-users-return-6568-mason-zsh=primenet.com.au@sunsite.dk Sat Sep 13 23:19:39 2003
Return-Path: <zsh-users-return-6568-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14682 invoked from network); 13 Sep 2003 23:19:38 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 13 Sep 2003 23:19:38 -0000
Received: (qmail 3789 invoked by alias); 13 Sep 2003 23:19:27 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 6568
Received: (qmail 3780 invoked from network); 13 Sep 2003 23:19:27 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 13 Sep 2003 23:19:27 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [4.64.232.255] by sunsite.dk (MessageWall 1.0.8) with SMTP; 13 Sep 2003 23:19:26 -0000
Received: (from schaefer@localhost)
	by candle.brasslantern.com (8.11.6/8.11.6) id h8DNJPI16457
	for zsh-users@sunsite.dk; Sat, 13 Sep 2003 16:19:25 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <1030913231924.ZM16456@candle.brasslantern.com>
Date: Sat, 13 Sep 2003 23:19:24 +0000
In-Reply-To: <20030913220707.13828.qmail@web10412.mail.yahoo.com>
Comments: In reply to Felix Rosencrantz <f_rosencrantz@yahoo.com>
        "Re: Ability to set HISTNO to a certain position from within zshrc" (Sep 13,  3:07pm)
References: <20030913220707.13828.qmail@web10412.mail.yahoo.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-users <zsh-users@sunsite.dk>
Subject: Re: Ability to set HISTNO to a certain position from within zshrc
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Sep 13,  3:07pm, Felix Rosencrantz wrote:
}
} I wanted to start in the middle of history not the beginning.  So the lines
} above the starting point contain commands that might need to be run, and the
} starting line and following lines contain the likely sequence of commands to
} run.
} 
} With the "print -z"/ainh solution I lose the ability to have the leading
} commands.

So use print -z followed by history-search-backward, followed by either
moving up through the history or executing accept-line-and-down-history.

If it's really too much to have to hit one extra key before hammering away
at Enter, set up a keymap (see bindkey -N) in which up-arrow is bound to
a user-defined widget that changes back to the default keymap and then
executes history-search-backward and finally executes up-history, and in
which Enter is bound to a user-defined widget that changes back to the
default keymap and then executes accept-line-and-down-history.  Install
that keymap right after your print -z.

} It almost seems like there should be a infer-back-into-history, where it
} determines the inferred line, and jumps to it in history.

Isn't that what history-search-backward does?

} Maybe even an accept-and-down-history-or-infer, which accepts,
} attempts to go down in history, and if at the end of the history,
} attempts to infer the next command.

I think all the tools are available to write this as a user-defined widget.
As a crude stab at it:

aadhoi () {
    local buffer="$BUFFER"
    if zle down-history
    then
    	zle up-history
	BUFFER="$buffer"
	zle accept-line-and-down-history
    else
	zle -U $'\exinfer-next-history\n'
	zle accept-and-hold
    fi
}

