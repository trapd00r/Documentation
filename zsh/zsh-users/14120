From zsh-users-return-14120-mason-zsh=primenet.com.au@sunsite.dk Thu May 14 16:05:51 2009
Return-Path: <zsh-users-return-14120-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 667 invoked from network); 14 May 2009 16:05:46 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 14 May 2009 16:05:46 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 37829 invoked from network); 14 May 2009 16:05:24 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 14 May 2009 16:05:24 -0000
Received: (qmail 20706 invoked by alias); 14 May 2009 16:04:53 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 14120
Received: (qmail 20693 invoked from network); 14 May 2009 16:04:52 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 14 May 2009 16:04:52 -0000
Received: from yx-out-2324.google.com (yx-out-2324.google.com [74.125.44.29])
	by bifrost.dotsrc.org (Postfix) with ESMTP id AD9A782D05A0
	for <zsh-users@sunsite.dk>; Thu, 14 May 2009 18:04:48 +0200 (CEST)
Received: by yx-out-2324.google.com with SMTP id 8so850803yxg.81
        for <zsh-users@sunsite.dk>; Thu, 14 May 2009 09:04:47 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.100.107.3 with SMTP id f3mr3303500anc.119.1242317087080; Thu, 
	14 May 2009 09:04:47 -0700 (PDT)
In-Reply-To: <20090514104908.98556.qmail@smasher.org>
References: <20090514104908.98556.qmail@smasher.org>
Date: Thu, 14 May 2009 09:04:47 -0700
Message-ID: <691a5d910905140904p538d5343md0712590db983853@mail.gmail.com>
Subject: Re: piping stderr
From: Bart Schaefer <schaefer@brasslantern.com>
To: zsh-users@sunsite.dk
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: ClamAV 0.92.1/9357/Wed May 13 23:05:21 2009 on bifrost
X-Virus-Status: Clean

On Thu, May 14, 2009 at 3:49 AM, Atom Smasher <atom@smasher.org> wrote:
> i'd like to pipe all stderr from a script into a command to do logging...
> but this isn't synchronous:
>        exec 2> >( multilog /path/ )
>
> i need it to be synchronous so that multiple scripts running at the same
> time (and also logging debug messages) can all log together and not clobber
> each others output.

I'm not sure what you think "synchronous" implies here.  Within a
particular "instance" of zsh, such as a single running script,
commands can be synchronous in the sense that zsh waits for the
command to finish before going on to the next one.  However, multiple
scripts "running at the same time" already implies that the zsh
instances are asynchronous with respect to one another, so no command
started by a particular zsh instance will be synchronous with respect
to other instances (unless you employ some sort of external locking
scheme, but then you're just preventing the scripts from "running at
the same time").

That said ... have you tried your example above?  I'd be mildly
surprised if multilog doesn't already do something to assure that
multiple loggers don't clobber one another's output.  They might
intermingle their output, in which case you need to tag each line of
it with a PID or some such, but Dan Bernstein is generally pretty
compulsive about preventing data loss.

