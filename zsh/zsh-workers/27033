From zsh-workers-return-27033-mason-zsh=primenet.com.au@sunsite.dk Thu Jun 04 15:23:44 2009
Return-Path: <zsh-workers-return-27033-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12181 invoked from network); 4 Jun 2009 15:23:41 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 4 Jun 2009 15:23:41 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 68979 invoked from network); 4 Jun 2009 15:23:20 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Jun 2009 15:23:20 -0000
Received: (qmail 26376 invoked by alias); 4 Jun 2009 15:22:47 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 27033
Received: (qmail 26273 invoked from network); 4 Jun 2009 15:22:43 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 4 Jun 2009 15:22:43 -0000
Received: from fg-out-1718.google.com (fg-out-1718.google.com [72.14.220.155])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 608A28027106
	for <zsh-workers@sunsite.dk>; Thu,  4 Jun 2009 17:21:21 +0200 (CEST)
Received: by fg-out-1718.google.com with SMTP id 13so286144fge.14
        for <zsh-workers@sunsite.dk>; Thu, 04 Jun 2009 08:21:20 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:received:date:from:to:subject
         :message-id:mime-version:content-type:content-disposition
         :content-transfer-encoding:user-agent;
        bh=W4N+eYtnNa1XBX3iYLbSd7+Q+fowlLXUrOKVO03l4HE=;
        b=VdNdCtH7F6M6OQaJz5z06vkMy8l1rvSnUM2z9e8PPMXPDhLW97kOMY+tzWQ2bOm5tY
         EoGm9NLyKbsbzC7TbkQ3lWfhDZq4LsS9xNkOy4wQUQakjhG1tpC9RldzZcYRNXd4/5L4
         x/UBn3co2EzG0WZAntrKJhZTIXPZ+ke4zhK4c=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=date:from:to:subject:message-id:mime-version:content-type
         :content-disposition:content-transfer-encoding:user-agent;
        b=soUlvUXsqCyRA4WA2Mqr0UgAzxS9Sg/qYoPJOaocKMMZEFov2Tdgjz4n9wYceePdtU
         oTTqEuJ8QG7ZPLSOKzqe5SzASe1QuYrnTJpon9AWkB3VZMbE5qzEZg0lMcX6RvMNYgW6
         j1UMKmf9kW9SvUBfYLiKIRI/7A6JmTQ3l7rzE=
Received: by 10.86.98.10 with SMTP id v10mr2682636fgb.36.1244128880449;
        Thu, 04 Jun 2009 08:21:20 -0700 (PDT)
Received: from wicklow.lan (stc92-3-82-245-249-89.fbx.proxad.net [82.245.249.89])
        by mx.google.com with ESMTPS id e20sm2132802fga.15.2009.06.04.08.21.19
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 04 Jun 2009 08:21:20 -0700 (PDT)
Received: by wicklow.lan (Postfix, from userid 1002)
	id 2AC2826D7F; Thu,  4 Jun 2009 17:21:18 +0200 (CEST)
Date: Thu, 4 Jun 2009 17:21:18 +0200
From: Baptiste Daroussin <baptiste.daroussin@gmail.com>
To: zsh-workers@sunsite.dk
Subject: Few patches for freebsd
Message-ID: <20090604152117.GF40721@wicklow.lan>
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="/e2eDi0V/xtL+Mc8"
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
User-Agent: Mutt/1.5.19 (2009-01-05)
X-Virus-Scanned: ClamAV 0.94.2/9420/Thu Jun  4 15:11:00 2009 on bifrost
X-Virus-Status: Clean


--/e2eDi0V/xtL+Mc8
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hi, here are patches for _portaudit , and _mount

regards,
Bapt

--/e2eDi0V/xtL+Mc8
Content-Type: text/x-diff; charset=utf-8
Content-Disposition: attachment; filename="_portaudit.diff"
Content-Transfer-Encoding: 8bit

diff --git a/Completion/BSD/Command/_portaudit b/Completion/BSD/Command/_portaudit
index 879e4c5..36f6d5f 100644
--- a/Completion/BSD/Command/_portaudit
+++ b/Completion/BSD/Command/_portaudit
@@ -2,13 +2,13 @@
 
 _arguments -s \
     '-a[Vulnerability report for all installed packages]' \
-    '-C[Vulnerability report for the port in the current working directory]' \
+    '-C[Vulnerability report for the port in the current working directory]' \
     '-d[Print creation date of the database]' \
-    '-f[Check the packages listed in file]:file:_files' \
     '-F[Fetch the current database]' \
     '-q[Quiet mode]' \
     '-V[Show portaudit version number]' \
     '-v[Verbose mode]' \
+    '-X[Download a fresh database from least days old]:days:' \
+    '-f[Check the packages listed in file]:file:_files' \
     '-r[Restrict listed vulnerabilities with eregex pattern]:eregex:' \
-    '-X[Download a fresh database]:days:' \
-    ':pkg-name:_files'
+    ':pkg-name:'

--/e2eDi0V/xtL+Mc8
Content-Type: text/x-diff; charset=us-ascii
Content-Disposition: attachment; filename="_mount.diff"

diff --git a/Completion/Unix/Command/_mount b/Completion/Unix/Command/_mount
index fcd848e..8825643 100644
--- a/Completion/Unix/Command/_mount
+++ b/Completion/Unix/Command/_mount
@@ -41,10 +41,10 @@ fi
 
 local curcontext="$curcontext" state line expl suf ret=1
 local args deffs=iso9660 tmp typeops=-t _nfs_access _fs_nfs _nfs_ufs \
-_fs_ufs _fs_efs _fs_iso9660 _fs_cachefs _fs_s5fs _fs_tmpfs _fs_pcfs _fs_hsfs \
-_fs_advfs _fs_cdfs _fs_affs _fs_ext2 _fs_fat _fs_ext3 _fs_msdos _fs_umsdos \
-_fs_vfat _fs_hpfs _fs_ntfs _fs_reiserfs _fs_smbfs _fs_xfs _fs_std _fs_devfs \
-_fs_fdesc _fs_kernfs _fs_linprocfs _fs_procfs
+_fs_ufs _fs_efs _fs_cd9660 _fs_iso9660 _fs_cachefs _fs_s5fs _fs_tmpfs _fs_pcfs \
+_fs_hsfs _fs_advfs _fs_cdfs _fs_affs _fs_ext2 _fs_fat _fs_ext3 _fs_msdos \
+_fs_msdosfs _fs_umsdos _fs_vfat _fs_hpfs _fs_ntfs _fs_reiserfs _fs_smbfs \
+_fs_xfs _fs_std _fs_devfs _fs_fdesc _fs_kernfs _fs_linprocfs _fs_procfs
 
 typeset -A opt_args
 
@@ -527,7 +527,7 @@ if (( ! $+_fs_any )); then
       'swidth[specify stripe width]:size'
     )
     ;;
-  *freebsd*|dragonfly*)
+  freebsd*|dragonfly*)
     _fs_any=(
       '(sync)async[do all I/O asynchronously]'
       'current[use current options on already mounted file system]'
@@ -548,12 +548,12 @@ if (( ! $+_fs_any )); then
       'update[change status of already mounted filesystem]'
       'union[cause the namespace at the mount point to appear as the union of the mounted filesystem and the existing directory]'
     )
-    _fs_iso9660=(
-      'extatt[enable use of extended attributes]'
-      "gens[don't strip version number on files]"
-      "joliet[don't use any Joliet extensions]"
-      "rrip[don't use any Rockridge extensions]"
-      'strictjoliet[relax checking for Supplementary Volume Descriptor Flags field which is set to a wrong value on some Joliet formatted disks]'
+    _fs_cd9660=(
+      'extatt[enable the use of extended attributes]'
+      'gens[do not strip version numbers on files]'
+      'nojoliet[do not use any Joliet extensions]'
+      'norrip[do not use any Rockridge extensions]'
+      'nostrictjoliet[relax checking for Supplementary Volume Descriptor Flags field]'
     )
     _fs_std=(
       "nodev[don't interpret devices]"
@@ -571,7 +571,13 @@ if (( ! $+_fs_any )); then
       'shortnames[]'
       'longnames[]'
       'nowin95[]'
+      'shortnames[force only the old MS-DOS 8.3 style filenames to be visible]'
+      'longnames[force Windows 95 long filenames to be visible]'
+      'nowin95[completely ignore Windows 95 extended file information]'
     )
+    if [[ "${OSTYPE}" =~ freebsd.* ]]; then
+	    _fs_msdosfs=( "$_fs_msdos[@]" )
+    fi
     ;;
   esac
 fi
@@ -682,7 +688,7 @@ if [[ "$service" = mount ]]; then
     deffs=hsfs
     typeops=-F
     ;;
-  *freebsd*|dragonfly*)
+  freebsd*|dragonfly*)
     args=( -s
       '(:)-a[mount all filesystems in fstab]'
       '-d[cause everything to be done except for the actual system call]'      
@@ -757,7 +763,7 @@ else
 	'*:dev or dir:->udevordir'
       )
     ;;
-    *freebsd*|dragonfly*)
+    freebsd*|dragonfly*)
       args=(
 	'(*)-a[unmount all mounted file systems]'
 	'-A[unmount all mounted file systems except the root]'
@@ -819,7 +825,28 @@ devordir)
   fi
 
   case "$OSTYPE" in
-  *freebsd*|dragonfly*)
+  dragonfly*)
+    while read mline; do 
+      case $mline[(w)1] in
+	\#* )
+	  ;;
+	proc)
+	  ;;
+	*)
+	  [[ $mline[(w)3] == swap ]] || \
+	    dev_tmp+=( $mline[(w)1] ) \
+	    mp_tmp+=( $mline[(w)2] )
+	  ;;
+      esac
+    done < /etc/fstab
+
+    _alternative \
+      'hosts:host:_hosts -S :' \
+      'devices:device:compadd -a dev_tmp' \
+      'directories:mount point:compadd -a mp_tmp' && ret=0
+      ;;
+  freebsd*)
+    local _glabel
     while read mline; do 
       case $mline[(w)1] in
 	\#* )
@@ -833,6 +860,16 @@ devordir)
 	  ;;
       esac
     done < /etc/fstab
+    # 
+    /sbin/ggatel list | while read mline; do
+      dev_tmp+=(/dev/$mline)
+    done
+
+    # add glabel devices
+    _glabel=(${(M)${(f)"$(/sbin/glabel list)"}:#*Name:[[:space:]]*/*})
+    for mline ($_glabel);do
+	    dev_tmp+=( mline[(w)3] )
+    done
 
     _alternative \
       'hosts:host:_hosts -S :' \
@@ -859,6 +896,12 @@ udevordir)
     dev_tmp=( "${(@)${(@)tmp%% *}:#none}" )
     mp_tmp=( "${(@)${(@)tmp#* }%% *}" )
     ;;
+  freebsd*|dragonfly*)
+    /sbin/mount | while read mline; do
+      dev_tmp+=( $mline[(w)1] )
+      mp_tmp+=( $mline[(w)3] )
+    done
+  ;;
   *)
     /sbin/mount | while read mline; do
       mp_tmp+=( $mline[(w)1] )

--/e2eDi0V/xtL+Mc8--

