From zsh-workers-request@euclid.skiles.gatech.edu  Mon Jul 29 08:06:41 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by coral.primenet.com.au (8.7.5/8.7.3) with ESMTP id IAA01555 for <mason@primenet.com.au>; Mon, 29 Jul 1996 08:06:39 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id RAA04761; Sun, 28 Jul 1996 17:47:32 -0400 (EDT)
Resent-Date: Sun, 28 Jul 1996 17:47:32 -0400 (EDT)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199607282047.WAA02530@hzoli.ppp.cs.elte.hu>
Subject: isearch bugfix
To: zsh-workers@math.gatech.edu (Zsh hacking and development)
Date: Sun, 28 Jul 1996 22:47:30 +0200 (MET DST)
X-Mailer: ELM [version 2.4ME+ PL17 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"ZlNgc2.0.FA1.o_z-n"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1802
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

There is a bug in isearch which rarely causes a SEGV.  The problem is that
zsfree() is used on a non-null-terminated string.  Below is a unified
context diff (sometimes I find it more readable than normal context diffs).

Zoltan


--- zle_hist.c	1996/07/28 19:50:55	2.22
+++ zle_hist.c	1996/07/28 20:03:15
@@ -862,7 +862,7 @@
     }
   brk:
     if (sbptr) {
-	zsfree(previous_search);
+	zfree(previous_search, previous_search_len);
 	previous_search = zalloc(sbptr);
 	memcpy(previous_search, sbuf, previous_search_len = sbptr);
     }

