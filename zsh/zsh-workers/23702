From zsh-workers-return-23702-mason-zsh=primenet.com.au@sunsite.dk Wed Jul 25 20:44:11 2007
Return-Path: <zsh-workers-return-23702-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11763 invoked from network); 25 Jul 2007 20:44:08 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.1 (2007-05-02) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 Jul 2007 20:44:08 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 22327 invoked from network); 25 Jul 2007 20:44:02 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 25 Jul 2007 20:44:02 -0000
Received: (qmail 28457 invoked by alias); 25 Jul 2007 20:43:58 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23702
Received: (qmail 28447 invoked from network); 25 Jul 2007 20:43:57 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 25 Jul 2007 20:43:57 -0000
Received: (qmail 22034 invoked from network); 25 Jul 2007 20:43:57 -0000
Received: from mtaout03-winn.ispmail.ntl.com (81.103.221.49)
  by a.mx.sunsite.dk with SMTP; 25 Jul 2007 20:43:52 -0000
Received: from aamtaout01-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout03-winn.ispmail.ntl.com with ESMTP
          id <20070725204351.NUBR13.mtaout03-winn.ispmail.ntl.com@aamtaout01-winn.ispmail.ntl.com>
          for <zsh-workers@sunsite.dk>; Wed, 25 Jul 2007 21:43:51 +0100
Received: from pws-pc.ntlworld.com ([81.107.45.67])
          by aamtaout01-winn.ispmail.ntl.com with ESMTP
          id <20070725204351.VRSG219.aamtaout01-winn.ispmail.ntl.com@pws-pc.ntlworld.com>
          for <zsh-workers@sunsite.dk>; Wed, 25 Jul 2007 21:43:51 +0100
Received: from pws-pc.ntlworld.com (pws-pc.ntlworld.com [127.0.0.1])
	by pws-pc.ntlworld.com (8.14.1/8.13.8) with ESMTP id l6PKgUB2018927
	for <zsh-workers@sunsite.dk>; Wed, 25 Jul 2007 21:42:30 +0100
Message-Id: <200707252042.l6PKgUB2018927@pws-pc.ntlworld.com>
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-workers@sunsite.dk
Subject: Re: Problems building 4.3.4 on FreeBSD
In-Reply-To: Message from "Renato Botelho" <rbgarga@gmail.com>
   of "Wed, 25 Jul 2007 16:56:07 -0300." <747dc8f30707251256q36a4f18bka028ec7e972645c3@mail.gmail.com>
Date: Wed, 25 Jul 2007 21:42:30 +0100

"Renato Botelho" wrote:
> I figured it out, the problem is caused because some Functions and
> Completions has 0755 permissions, so, installfns.sh consider it
> executable and call install with -s.

The change that brought this in is 22341.  It looks like we need to set
the permissions separately from installing.

Ideally we still need to be more selective with the permissions somehow.
The permissions don't seem to be fixable in the archive by any obvious
means.  We could perhaps run a script to get this right in the
distribution.

Index: Config/installfns.sh
===================================================================
RCS file: /cvsroot/zsh/zsh/Config/installfns.sh,v
retrieving revision 1.13
diff -u -r1.13 installfns.sh
--- Config/installfns.sh	20 Mar 2006 11:06:24 -0000	1.13
+++ Config/installfns.sh	25 Jul 2007 20:42:08 -0000
@@ -45,10 +45,9 @@
       esac
     fi
     test -d $instdir || /bin/sh $sdir_top/mkinstalldirs $instdir || exit 1
+    $INSTALL_DATA $sdir_top/$file $instdir || exit 1
     if test -x $sdir_top/$file; then
-	$INSTALL_PROGRAM $sdir_top/$file $instdir || exit 1
-    else
-	$INSTALL_DATA $sdir_top/$file $instdir || exit 1
+	chmod +x $instdir/`echo $file | sed -e 's%^.*/%%'`
     fi
   fi
 done

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

