From zsh-workers-request@euclid.skiles.gatech.edu Wed Jul 09 23:19:43 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 22666 invoked from network); 9 Jul 1997 23:19:41 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 9 Jul 1997 23:19:41 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id TAA15176; Wed, 9 Jul 1997 19:08:28 -0400 (EDT)
Resent-Date: Wed, 9 Jul 1997 19:08:06 -0400 (EDT)
Date: Thu, 10 Jul 1997 09:12:11 +1000
From: Andrew J Cosgriff <Andrew.Cosgriff@cc.monash.edu.au>
Subject: Re: access jobs information
In-reply-to: Paul Lew's message of "Wed, 9 Jul 1997 13:45:17 -0400"
To: Paul Lew <lew@ezdzit.zko.dec.com>
Cc: zsh-users@math.gatech.edu
Message-id: <ruirad795x0.fsf@goaway.cc.monash.edu.au>
MIME-version: 1.0 (generated by tm-edit 7.108)
X-Mailer: Gnus v5.4.62/XEmacs 20.3(beta10) - "Athens"
Content-type: text/plain; charset=US-ASCII
X-Attribution: ajc
X-URI: <URL:http://www-personal.monash.edu.au/~ajc>
X-PGP-Key-ID: C7BD53F5
X-Face: 
 PBPJ+.AE`FBN4$}H<dIo+^`A-G%mJTXXP$^4bBox##5=oF{G\[:0|sNlr%~H1,>rwwEh<qq.dHRpu8ftJ\'14l]<x(nRD>J)x?-5$MQ%Z)svNR@Q\WG6[GDr,}a@8ULwGWBsk,Pqxm!Z<lnD(Skwwe$j+<0g6N6z}>-
X-Emacs: a compelling argument for pencil and paper.
Lines: 54
References: <9707091745.AA02190@ezdzit.zko.dec.com>
Resent-Message-ID: <"9jwUC3.0.hi3.Ld1np"@euclid>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/943
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu


[ sent to zsh-users, which seemed more appropriate than zsh-workers ]

>>>>> "Paul" == Paul Lew <lew@ezdzit.zko.dec.com> writes:

Paul> I would like to add the current background job information to my
Paul> prompt.  I could not find an interface to do this, at least:

Paul> jno=$(jobs | wc -l)
Paul> RPROMPT="$jno"

Paul> wont work.  Any idea?

This is what a friend of mine hacked up a year or two ago to do a
similar sort of thing.

precmd () {
  if [[ -o interactive ]]
  then
    # Get a list of suspended jobs to put in the command line.
    # Have to use a temporary file because it's the only way
    # we can run the jobs builtin and set a variable within the current
    # shell - doing either of these in a subshell defeats the purpose.
    # The jobs command outputs to stderr.  Use the current hostname
    # and process ID to ensure that there's no problems even if
    # /tmp is mounted across filesystems.
    builtin jobs -r >&! /tmp/jobs$HOST$$
    if [[ -s /tmp/jobs$HOST$$ ]]
    then
      # There's at least one suspended job.  Glean the job numbers from
      # the file.  Surround the text with the relevant description and
      # proper number of spaces.
      psvar[4]="`sed -n 's/^\[\([^]]*\)\].*$/\1 /p' \
       < /tmp/jobs$HOST$$ | \
       tr -d '\012'`"
    else
      # No jobs - we can skip the calls to sed and tr.
      psvar[4]=""
    fi
    /bin/rm /tmp/jobs$HOST$$

    jobs -s
  fi
}

So I end up with the job numbers of any running (non-suspended) jobs
in psvar[4] (so you just put a %4v somewhere in PROMPT/RPROMPT) and
any suspended jobs are listed normally above my prompt.

Andrew
-- 
 - Andrew J. Cosgriff -        >> see X-headers >>       ajc@bing.wattle.id.au
       LOOK!!  Sullen American teens wearing MADRAS shorts and "Flock of
                              Seagulls" HAIRCUTS!

