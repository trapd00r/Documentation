From zsh-workers-return-11410-mason-zsh=primenet.com.au@sunsite.auc.dk Tue May 16 12:59:51 2000
Return-Path: <zsh-workers-return-11410-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18126 invoked from network); 16 May 2000 12:59:42 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 16 May 2000 12:59:42 -0000
Received: (qmail 4385 invoked by alias); 16 May 2000 12:59:18 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11410
Received: (qmail 4355 invoked from network); 16 May 2000 12:59:05 -0000
Date: Tue, 16 May 2000 13:58:37 +0100
From: Peter Stephenson <pws@cambridgesiliconradio.com>
Subject: PATCH: Re: globsubst and =command
In-reply-to: "Your message of Tue, 16 May 2000 14:41:12 +0200."
 <200005161241.OAA26858@beta.informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Message-id: <0FUN0090RLDP47@la-la.cambridgesiliconradio.com>
Content-transfer-encoding: 7BIT

Sven wrote:
> Tanaka Akira wrote:
> > serein% print -r - $~a
> > =ls
> > 
> > Since the expansion of =command is kind of filename expansion and ~
> > enables filename expansion on the result, I think $~a should be expand
> > to /bin/ls.  Do I miss something?
> 
> I don't think it should do that because it really is something
> completely different.

$~a does do ~dir expansion (that's where the ~ originally came from, before
it ever tokenized the rest of the pattern), which is performed at the same
time as =cmd expansion, so it is a little odd.  The real issue is that `='
don't get tokenized by on-the-fly tokenization.  This patch would do that.
But if you can think of a good reason for not...?

Index: Src/glob.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/glob.c,v
retrieving revision 1.5
diff -u -r1.5 glob.c
--- Src/glob.c	2000/04/30 17:58:35	1.5
+++ Src/glob.c	2000/05/16 12:56:28
@@ -2395,6 +2395,7 @@
 	case ']':
 	case '*':
 	case '?':
+	case '=':
 	    for (t = ztokens; *t; t++)
 		if (*t == *s) {
 		    if (bslash)

-- 
Peter Stephenson <pws@cambridgesiliconradio.com>
Cambridge Silicon Radio, Unit 300, Science Park, Milton Road,
Cambridge, CB4 0XL, UK                          Tel: +44 (0)1223 392070

