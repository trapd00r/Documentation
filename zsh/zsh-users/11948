From zsh-users-return-11948-mason-zsh=primenet.com.au@sunsite.dk Mon Oct 08 00:40:35 2007
Return-Path: <zsh-users-return-11948-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7659 invoked from network); 8 Oct 2007 00:40:26 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00,SPF_HELO_PASS
	autolearn=ham version=3.2.3
Received: from ns2.primenet.com.au (HELO primenet.com.au) (@203.24.36.3)
  by ns1.primenet.com.au with (DHE-RSA-AES256-SHA encrypted) SMTP; 8 Oct 2007 00:40:26 -0000
Received: (qmail 19699 invoked from network); 7 Oct 2007 17:33:43 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns2.melb.primenet.com.au with SMTP; 7 Oct 2007 17:33:43 -0000
Received-SPF: none (ns2.melb.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 76783 invoked from network); 7 Oct 2007 17:33:36 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 Oct 2007 17:33:36 -0000
Received: (qmail 22592 invoked by alias); 7 Oct 2007 17:33:28 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11948
Received: (qmail 22576 invoked from network); 7 Oct 2007 17:33:27 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 7 Oct 2007 17:33:27 -0000
Received: (qmail 75499 invoked from network); 7 Oct 2007 17:33:27 -0000
Received: from vms046pub.verizon.net (206.46.252.46)
  by a.mx.sunsite.dk with SMTP; 7 Oct 2007 17:33:20 -0000
Received: from torch.brasslantern.com ([71.116.76.59])
 by vms046.mailsrvcs.net (Sun Java System Messaging Server 6.2-6.01 (built Apr
 3 2006)) with ESMTPA id <0JPJ00DIKY2PMXJ4@vms046.mailsrvcs.net> for
 zsh-users@sunsite.dk; Sun, 07 Oct 2007 12:32:50 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id l97HWmJQ023820	for
 <zsh-users@sunsite.dk>; Sun, 07 Oct 2007 10:32:49 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id l97HWgeT023817	for zsh-users@sunsite.dk; Sun,
 07 Oct 2007 10:32:42 -0700
Date: Sun, 07 Oct 2007 10:32:42 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: PROMPT escape sequences
In-reply-to: <20071007103407.33577.qmail@smasher.org>
To: zsh-users@sunsite.dk
Message-id: <071007103242.ZM23816@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <20071007103407.33577.qmail@smasher.org>
Comments: In reply to Atom Smasher <atom@smasher.org>
 "PROMPT escape sequences" (Oct  7, 11:34pm)

On Oct 7, 11:34pm, Atom Smasher wrote:
}
} PS1='%S%# '

That doesn't just set your prompt to reverse, does it?  Everything you
type after the prompt would be in reverse, too, because you're never
turning "standout mode" off again after turning it on.

Similarly:

} PS1='%{^[[36m%}%# '

This enters cyan coloring mode but does not leave it again.

The prompt itself (the "%" or "#" sign) remains cyan colored, does it not?
Zsh is only responsible for what happens to the characters that are in
the PS1 string, not for any "unbalanced" state you've left things in
after PS1 has been printed.

So the answer to this question is:

} is there a way to set a color at the prompt that doesn't reset to default 
} when i tab-complete?

No, there isn't, because you're relying on the entire prompt being re-
painted every time zsh needs to redraw the line that begins with the
prompt, but ZLE is optimized to use cursor motions and only redraw the
bits of the line that actually need changing.  It has no idea what the
color settings are at any given position on the terminal, so it can't
restore color; it only knows what the non-zero-width characters are.

It "works" for %S because of a quirk in the way some terminals (xterm
included) implement "standout mode", not because of anything zsh does
differently.  On a different terminal/emulator (or possibly even just
with different termcap/terminfo definitions) you're likely to see %S
behaving the same way you now see cyan.

You can "unsetopt alwayslastprompt" so that zsh does not return to the
previous prompt after completing, but you may find that unsatisfactory
for other reasons.

