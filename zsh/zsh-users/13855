From zsh-users-return-13855-mason-zsh=primenet.com.au@sunsite.dk Sat Feb 14 21:40:10 2009
Return-Path: <zsh-users-return-13855-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10523 invoked from network); 14 Feb 2009 21:39:57 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 14 Feb 2009 21:39:57 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 47027 invoked from network); 14 Feb 2009 21:39:46 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 14 Feb 2009 21:39:46 -0000
Received: (qmail 21905 invoked by alias); 14 Feb 2009 21:39:29 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13855
Received: (qmail 21884 invoked from network); 14 Feb 2009 21:39:28 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 14 Feb 2009 21:39:28 -0000
Received: from vms173017pub.verizon.net (vms173017pub.verizon.net [206.46.173.17])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 1642F80271F0
	for <zsh-users@sunsite.dk>; Sat, 14 Feb 2009 22:39:24 +0100 (CET)
Received: from torch.brasslantern.com ([96.238.220.215])
 by vms173017.mailsrvcs.net
 (Sun Java(tm) System Messaging Server 6.3-7.04 (built Sep 26 2008; 32bit))
 with ESMTPA id <0KF200KL0S55X2H1@vms173017.mailsrvcs.net> for
 zsh-users@sunsite.dk; Sat, 14 Feb 2009 15:39:06 -0600 (CST)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id n1ELd473015385	for
 <zsh-users@sunsite.dk>; Sat, 14 Feb 2009 13:39:05 -0800
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id n1ELd42i015384	for zsh-users@sunsite.dk; Sat,
 14 Feb 2009 13:39:04 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <090214133904.ZM15383@torch.brasslantern.com>
Date: Sat, 14 Feb 2009 13:39:04 -0800
In-reply-to: <237967ef0902141141y609b61d3i154546f6f6886c65@mail.gmail.com>
Comments: In reply to Mikael Magnusson <mikachu@gmail.com>
 "Re: Problem with fake-files style and cd" (Feb 14,  8:41pm)
References: <mikachu@gmail.com>
	<237967ef0902140622s7389d2c8h5a0c786dcf207422@mail.gmail.com>
	<200902141801.n1EI1E2l003603@pws-pc.ntlworld.com>
	<237967ef0902141019t30118690m30116c9413015d96@mail.gmail.com>
	<090214111316.ZM15188@torch.brasslantern.com>
	<237967ef0902141141y609b61d3i154546f6f6886c65@mail.gmail.com>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: zsh-users <zsh-users@sunsite.dk>
Subject: Re: Problem with fake-files style and cd
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii
X-Virus-Scanned: ClamAV 0.92.1/8992/Sat Feb 14 16:43:07 2009 on bifrost
X-Virus-Status: Clean

On Feb 14,  8:41pm, Mikael Magnusson wrote:
}
} 2009/2/14 Bart Schaefer <schaefer@brasslantern.com>:
} > I'm not sure I'm following the last part of that, but what you need to
} > look at is the documentation for the tag-order zstyle.
} 
} Even if I had accidentally read that whole section, it would not have
} occurred to me it could be used here.

Next you need to read chapters 10 and 15 of "From Bash to Z Shell". :-)

(Hey, Peter and Oliver ... any updated revision of the book planned?)

} It is a tiny bit confusing why the name of the "directories" tag is
} changed to local-directories only when $cdpath is set, is it for any
} other reason than to break all your styles when you set/unset cdpath?

It's been like that for years ... in fact originally it appears that
the local-directories style was *always* used, even if cdpath was not
set, so someone (Sven?) probably decided that it didn't make sense to
differentiate "local" if there was no possibility of "non-local".  The
ChangeLog from that time gives no hints.

I'm also sure the expectation was that cdpath is not something that
changes state frequently; it's value might change but not whether it
*has* a value.

} > I use this:
} >
} >    zstyle :completion::complete:cd:: tag-order \
} >        local-directories path-directories

This can easily be modified to deal with a flip-flop of cdpath:

    zstyle :completion::complete:cd:: tag-order \
    	'directories local-directories' path-directories

The local-directories style doc ought to mention this, I guess.

} Thanks, with my hack to _cd removed, I think this does more or less
} exactly what I want. I wouldn't mind if it was on a per-completion
} entry, ie it would be nice if I got this:
} % mkdir -p local/code/foo
} % mkdir -p path/code/bar
} % cdpath=$PWD/path
} % cd local
} % cd code<tab>
} ---- local directory
} foo/
} ---- directory in cdpath
} bar/
} 
} which is what I get without the above style set. However,
} % mkdir arg
} % cd <tab>
} ---- local directory
} arg/   code/
} ---- directory in cdpath
} code/
} 
} I don't want the cdpath to appear in this case, only once I'm actually
} completing at a place where they differ.

I'm not entirely sure, but I think what you're asking for is to have
duplicate completions removed from the listing even when the duplicates
are in different tag groups.  Suppose we add

% mkdir -p path/other/thing

to the above.  Is what you'd like to see:

% cd <tab>
---- local directory
arg/   code/
---- directory in cdpath
other/

??  That isn't something that's supported in the internals, but for a
specific case like this we can the the same effect like so:

zstyle -e :completion::complete:cd::path-directories ignored-patterns \
    	'reply=( *(/) )'

This says that when completing in the cdpath, ignore any name that matches
the name of a directory in the current directory.

In fact I like that so much I might even replace my tag-order with it.

