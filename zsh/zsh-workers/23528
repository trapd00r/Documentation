From zsh-workers-return-23528-mason-zsh=primenet.com.au@sunsite.dk Tue Jun 05 22:05:59 2007
Return-Path: <zsh-workers-return-23528-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18982 invoked from network); 5 Jun 2007 22:05:57 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.0 (2007-05-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=no
	version=3.2.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 Jun 2007 22:05:57 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 40981 invoked from network); 5 Jun 2007 22:05:51 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 Jun 2007 22:05:51 -0000
Received: (qmail 20520 invoked by alias); 5 Jun 2007 22:05:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23528
Received: (qmail 20510 invoked from network); 5 Jun 2007 22:05:47 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 5 Jun 2007 22:05:47 -0000
Received: (qmail 40689 invoked from network); 5 Jun 2007 22:05:47 -0000
Received: from main.gmane.org (HELO ciao.gmane.org) (80.91.229.2)
  by a.mx.sunsite.dk with SMTP; 5 Jun 2007 22:05:44 -0000
Received: from root by ciao.gmane.org with local (Exim 4.43)
	id 1Hvh9D-00087y-45
	for zsh-workers@sunsite.dk; Wed, 06 Jun 2007 00:05:03 +0200
Received: from h189n2c1o1114.bredband.skanova.com ([81.225.17.189])
        by main.gmane.org with esmtp (Gmexim 0.1 (Debian))
        id 1AlnuQ-0007hv-00
        for <zsh-workers@sunsite.dk>; Wed, 06 Jun 2007 00:05:03 +0200
Received: from zrajmc by h189n2c1o1114.bredband.skanova.com with local (Gmexim 0.1 (Debian))
        id 1AlnuQ-0007hv-00
        for <zsh-workers@sunsite.dk>; Wed, 06 Jun 2007 00:05:03 +0200
X-Injected-Via-Gmane: http://gmane.org/
To: zsh-workers@sunsite.dk
From:  Zrajm C Akfohg <zrajmc@gmail.com>
Subject:  zsh-4.3.2 fails to run .zcompdump when an "alias -g" is in it
Date: Tue, 5 Jun 2007 21:58:44 +0000 (UTC)
Lines: 54
Message-ID:  <loom.20070605T234624-393@post.gmane.org>
Mime-Version:  1.0
Content-Type:  text/plain; charset=us-ascii
Content-Transfer-Encoding:  7bit
X-Complaints-To: usenet@sea.gmane.org
X-Gmane-NNTP-Posting-Host: main.gmane.org
User-Agent: Loom/3.14 (http://gmane.org/)
X-Loom-IP: 81.225.17.189 (Mozilla/5.0 (Windows; U; Windows NT 5.1; sv-SE; rv:1.8.1.4) Gecko/20070515 Firefox/2.0.0.4)
Sender: news <news@sea.gmane.org>

I reported this bug via the Gentoo Bugzilla in November 2006, however noone
there [http://bugs.gentoo.org/show_bug.cgi?id=155525] has commented on it, much
less passed it on "upstream", as they claim they do. So now I've tried to track
down the relevant ppl and direct by bugreport directly to you. I cincerely hope
this is the right place for this stuff. Here is a copy of my original bug report
on bugs.gentoo.org:


A couple of zsh versions ago I started to sometimes get the following error
message each time I opened up a new (z)shell:

    /home/zrajm/.zcompdump:3: bad set of key/value pairs for associative array

And after this message, all tab completion stops working in that shell. Once
the problem has appeared, all new shells get the exact same symptoms. If I
erase the ~/.zcompdump file, however, the shell I start after that will work
just fine (but start a little slow, since it is generating a new .zcompdump).
Upon starting a new shell after that, though, the problem is back.

I.e. *all* shells which source an existing .zcompdump show this problem.

At the time I did some experimenting, and found that if I removed the line "cp
_cp" inside the associative array assignment of _comps the problem I had went
away.

Today I realized that this might have something with the global alias "cp" that
I have. And sure enough, if I remove the line

     alias -g cp='cp -b'

from my .zshrc the problem goes away.

HOWEVER instead of removing the alias, I can also edit the .zcompdump file,
quoting the word "cp" on the faulty line. If I replace

_comps=(
   ...
   cp _cp
   ...
)

with

_comps=(
   ...
   'cp' _cp
   ...
)

the problem goes away completely. -- Until zsh generates a new (faulty)
.zcompdump file.

Thus, zsh should generate a .zcompdump file in which the keys in all
associative arrays are quoted, to avoid having them expanded as aliases.

