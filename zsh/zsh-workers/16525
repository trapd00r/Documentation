From zsh-workers-return-16525-mason-zsh=primenet.com.au@sunsite.dk Thu Jan 31 08:44:18 2002
Return-Path: <zsh-workers-return-16525-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26290 invoked from network); 31 Jan 2002 08:44:17 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 31 Jan 2002 08:44:17 -0000
Received: (qmail 19241 invoked by alias); 31 Jan 2002 08:44:10 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16525
Received: (qmail 19229 invoked from network); 31 Jan 2002 08:44:09 -0000
Date: Thu, 31 Jan 2002 00:44:06 -0800
From: Derek Peschel <dpeschel@eskimo.com>
To: zsh-workers@sunsite.dk
Subject: BUG? - 4.0.2, current 4.1 - blank left prompt & blank line erases right prompt
Message-ID: <20020131004406.A5021@eskimo.eskimo.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 1.0i

I wrote "BUG?" instead of "BUG" because this behavior is kind of cute.
Probably it was unintended, however.  And the right thing to do (which
I am NOT volunteering for, since I don't think it's important) is to
add a bunch of options -- transient_prompt, transient_prompt_blank_line,
transient_rprompt_blank_line, etc.

The behavior affects the released 4.0.2, as well as today's daily 4.1
snapshot.  I haven't tested 4.0.4 (it seems not to compile on my system)
but undoubtedly it works the same way.

If the left prompt is empty and you enter a blank line (by simply hitting
return) then the right prompt will be erased.

This is strange in 4.0.2 since it has no transient_rprompt option,
so there's no other way of erasing the right prompt!  With the daily
snapshot the transient_rprompt option is ignored.

The logic for displaying the right prompt (in Src/Zle/zle_refresh.c)
checks trashedzle.  Perhaps the combination of the empty prompt and
empty line means that trashedzle is never set.  (I haven't actually
tested this theory.)  But in that case why does the right prompt get
displayed at all?

-- Derek

