From zsh-workers-return-15376-mason-zsh=primenet.com.au@sunsite.dk Wed Jul 11 19:04:59 2001
Return-Path: <zsh-workers-return-15376-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14808 invoked from network); 11 Jul 2001 19:04:57 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 11 Jul 2001 19:04:57 -0000
Received: (qmail 17633 invoked by alias); 11 Jul 2001 19:04:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15376
Received: (qmail 17622 invoked from network); 11 Jul 2001 19:04:49 -0000
X-Authentication-Warning: water.cs.brown.edu: tsm set sender to tsm@water.cs.brown.edu using -f
Sender: tsm@cs.brown.edu
Resent-Message-Id: <200107111900.PAA13770@water.cs.brown.edu>
Resent-To: zsh-workers@sunsite.dk
Resent-From: Timothy Miller <tsm@cs.brown.edu>
Resent-Date: 11 Jul 2001 15:00:47 -0400
CC: zsh-workers@sunsite.dk
Subject: Re: fatal flaw zsh 4.0.1 on irix 6.3 & 6.5: suspend "ls -l|less" then resume hangs
References: <200106140732.JAA08108@beta.informatik.hu-berlin.de> <yehvgl0kdvm.fsf@water.cs.brown.edu> <1010710162547.ZM29353@candle.brasslantern.com> <yehofqsjx1a.fsf@water.cs.brown.edu> <010710162700.ZM30017@candle.brasslantern.com>
From: Timothy Miller <tsm@cs.brown.edu>
Date: 11 Jul 2001 14:59:43 -0400
In-Reply-To: "Bart Schaefer"'s message of "Tue, 10 Jul 2001 16:27:00 -0700"
Message-ID: <yehg0c3jnq8.fsf@water.cs.brown.edu>
User-Agent: Gnus/5.0802 (Gnus v5.8.2) XEmacs/21.1 (Big Bend)
Content-Type: text/plain; charset=us-ascii
Lines: 69
MIME-Version: 1.0

On Tue, 10 Jul 2001 16:27:00 -0700, "Bart Schaefer" <schaefer@candle.brasslantern.com> wrote:
> On Jul 10,  5:26pm, Timothy Miller wrote:
> > 
> > Ok: zsh-3_1_6-pws-2 works; zsh-3_1_6-pws-3 fails.
> 
> One of these must be the culprit, then:
> 
> 	* Sven: 7605: Src/exec.c, Src/jobs.c: use killpg instead of
> 	  altering process group when leader exits, fix fg test to use
> 	  killpg.
> 
> 	* Sven: 7573: Src/signals.c, Src/exec.c, Src/utils.c: fix return
> 	  value of killjb(); pipelines which lose their leader get a new
> 	  one.
> 
> Can you send us some output of `ps' that shows the process groups of the
> processes involved, from both -pws-2 and anything after that?

Output is that of "ps -fljt ttyq4" with irrelevant (preexisting) processes
on that tty removed; zsh started as "./Src/zsh +Z -f".

-pws-2:
Initial prompt:
  F S      UID   PID  PPID  PGID   SID  C PRI NI  P    SZ:RSS      WCHAN    STIME TTY     TIME CMD
 b0 S      tsm  9487  1092  9487  1092  0  28 20  *   564:164   8039df60 14:46:22 ttyq4   0:00 ./Src/zsh +Z -f 

while "ls -lR /|cat" is running:
  F S      UID   PID  PPID  PGID   SID  C PRI NI  P    SZ:RSS      WCHAN    STIME TTY     TIME CMD
 b0 R      tsm  9489  9487  9489  1092 15  67 20  *   394:94           - 14:47:03 ttyq4   0:00 ls -lR / 
 b0 S      tsm  9487  1092  9487  1092  0  39 20  *   582:193   8039d510 14:46:22 ttyq4   0:00 ./Src/zsh +Z -f 
 b0 S      tsm  9490  9487  9489  1092  0  60 20  *    45:25    c04cd91c 14:47:03 ttyq4   0:00 cat 

after ^Z:
  F S      UID   PID  PPID  PGID   SID  C PRI NI  P    SZ:RSS      WCHAN    STIME TTY     TIME CMD
 b0 T      tsm  9489  9487  9489  1092  0  60 20  *   394:94           - 14:47:03 ttyq4   0:01 ls -lR / 
 b0 S      tsm  9487  1092  9487  1092  0  28 20  *   582:196   8039df60 14:46:22 ttyq4   0:00 ./Src/zsh +Z -f 
 b0 S      tsm  9490  9487  9489  1092  0  60 20  *    45:25    c04cd91c 14:47:03 ttyq4   0:00 cat 

after fg:
  F S      UID   PID  PPID  PGID   SID  C PRI NI  P    SZ:RSS      WCHAN    STIME TTY     TIME CMD
 b0 S      tsm  9489  9487  9489  1092  7  63 20  *   394:94    c27ae1d8 14:47:03 ttyq4   0:01 ls -lR / 
 b0 S      tsm  9487  1092  9487  1092  0  39 20  *   582:211   8039d510 14:46:22 ttyq4   0:00 ./Src/zsh +Z -f 
 b0 S      tsm  9490  9487  9489  1092  0  60 20  *    45:25    c04cd91c 14:47:03 ttyq4   0:00 cat 

********

-pws-3:
initial prompt:
  F S      UID   PID  PPID  PGID   SID  C PRI NI  P    SZ:RSS      WCHAN    STIME TTY     TIME CMD
 b0 S      tsm 13718  1092 13718  1092  0  28 20  *   563:163   8039df60 14:55:38 ttyq4   0:00 ./Src/zsh +Z -f 

while "ls -lR /|cat" is running:
  F S      UID   PID  PPID  PGID   SID  C PRI NI  P    SZ:RSS      WCHAN    STIME TTY     TIME CMD
 b0 R      tsm 13720 13718 13720  1092 29  74 20  *   394:94           - 14:56:08 ttyq4   0:00 ls -lR / 
 b0 S      tsm 13721 13718 13721  1092  0  60 20  *    45:25    c0c5131c 14:56:08 ttyq4   0:00 cat 
 b0 S      tsm 13718  1092 13718  1092  0  39 20  *   581:191   8039d510 14:55:38 ttyq4   0:00 ./Src/zsh +Z -f 

after ^Z:
  F S      UID   PID  PPID  PGID   SID  C PRI NI  P    SZ:RSS      WCHAN    STIME TTY     TIME CMD
 b0 S      tsm 13720 13718 13720  1092  0  60 20  *   394:94    c0c51320 14:56:08 ttyq4   0:01 ls -lR / 
 b0 T      tsm 13721 13718 13721  1092  0  60 20  *    45:25           - 14:56:08 ttyq4   0:00 cat 
 b0 S      tsm 13718  1092 13718  1092  0  39 20  *   581:192   8039d510 14:55:38 ttyq4   0:00 ./Src/zsh +Z -f 

This version of zsh has different behavior than the current one, it turns
out now I see it interactively: it just hangs uninterruptibly (except by
SIGKILL) after the ^Z, with no prompt and no additional printout of any
kind. My expect script was supposed to have caught that and flagged it as a
problem; I'm not sure what happened there.
   Tim

