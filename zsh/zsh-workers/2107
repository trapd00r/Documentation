From zsh-workers-request@euclid.skiles.gatech.edu  Thu Sep  5 03:32:12 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by coral.primenet.com.au (8.7.5/8.7.3) with ESMTP id DAA00994 for <mason@primenet.com.au>; Thu, 5 Sep 1996 03:32:08 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id NAA09380; Wed, 4 Sep 1996 13:29:05 -0400 (EDT)
Resent-Date: Wed, 4 Sep 1996 13:29:05 -0400 (EDT)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199609041727.TAA12902@bolyai.cs.elte.hu>
Subject: Re: 3.0.1-test on cray
To: gene@bear.com
Date: Wed, 4 Sep 1996 19:27:12 +0200 (MET DST)
Cc: zsh-workers@math.gatech.edu
In-Reply-To: <9609041618.AA00907@bear.com> from "gene@bear.com" at "Sep 4, 96 12:18:28 pm"
Organization: Dept. of Comp. Sci., Eotvos University, Budapest, Hungary
Phone: (36 1)2669833 ext: 2667, home phone: (36 1) 2752368
X-Mailer: ELM [version 2.4ME+ PL16 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"VMKRc3.0.UI2.WnRBo"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2107
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

> FYI:
> 
>   zsh v3.0.1-test failed to compile on cray-c90 under Unicos 9.0.
...
>  ldr-334 cc: CAUTION 
>      File 'libdir.a' cannot be found in any of the search directories.

This is probably because your cc runs successfully even if a given library
is missing which makes configure think that you have a `dir' library.

>  ldr-133 cc: WARNING 
>      Unsatisfied external references have been encountered.
> 
>  Unsatisfied external references
>  Entry name      Modules referencing entry 
> 
>  nis_list        zle_tricky$c

If that happens with 3.0.1-test, then compilation of 3.0.0 should also
fail.  Does your system have NIS+?  Do you have HAVE_NIS_PLUS defined in
the zsh-3.0.0 config.h?  In that case, how was zsh-3.0.0 linked?  If the
libraries linked with 3.0.0 is different from 3.0.1, what are the
differences in config.log?

There was no change in configure since 3.0.0.

Anyway, the patch below does not hurt anyone and it should fix this, but
the real problem is probably a missing library which should be linked to
zsh.  You can use nm to find a library which defines nis_list and we may
add a configure test for that library.

Zoltan


--- configure	1996/08/15 17:37:46	2.21
+++ configure	1996/09/04 17:13:51
@@ -2585,7 +2585,7 @@
 for ac_func in strftime waitpid select tcsetpgrp tcgetattr strstr lstat \
               getlogin setpgid gettimeofday gethostname mkfifo wait3 difftime \
               sigblock sigsetmask sigrelse sighold killpg sigaction getrlimit \
-              sigprocmask setuid seteuid setreuid setresuid strerror
+              sigprocmask setuid seteuid setreuid setresuid strerror nis_list
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
@@ -2769,7 +2769,8 @@
 if eval "test \"`echo '$''{'zsh_cv_sys_nis_plus'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  test -f /usr/bin/nisls && /usr/bin/nisls > /dev/null 2>&1 && \
+  test $ac_cv_func_nis_list = yes && test -f /usr/bin/nisls && \
+ /usr/bin/nisls > /dev/null 2>&1 && \
 zsh_cv_sys_nis_plus=yes || zsh_cv_sys_nis_plus=no
 fi
 
@@ -2836,7 +2837,7 @@
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2840 "configure"
+#line 2841 "configure"
 #include "confdefs.h"
 #include <unistd.h>
 double brk();
@@ -2845,7 +2846,7 @@
 int i;
 ; return 0; }
 EOF
-if { (eval echo configure:2849: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2850: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   zsh_cv_header_unistd_h_brk_proto=no
 else
@@ -2869,7 +2870,7 @@
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2873 "configure"
+#line 2874 "configure"
 #include "confdefs.h"
 #include <unistd.h>
 double sbrk();
@@ -2878,7 +2879,7 @@
 int i;
 ; return 0; }
 EOF
-if { (eval echo configure:2882: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2883: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   zsh_cv_header_unistd_h_sbrk_proto=no
 else
--- configure.in	1996/08/15 17:37:46	2.20
+++ configure.in	1996/09/04 17:13:18
@@ -425,7 +425,7 @@
 AC_CHECK_FUNCS(strftime waitpid select tcsetpgrp tcgetattr strstr lstat \
               getlogin setpgid gettimeofday gethostname mkfifo wait3 difftime \
               sigblock sigsetmask sigrelse sighold killpg sigaction getrlimit \
-              sigprocmask setuid seteuid setreuid setresuid strerror)
+              sigprocmask setuid seteuid setreuid setresuid strerror nis_list)
 
 dnl  Checking for working strcoll
 AC_CACHE_CHECK(for working strcoll, zsh_cv_func_strcoll,
@@ -508,7 +508,8 @@
 dnl CHECK FOR NISPLUS
 dnl -----------------
 AC_CACHE_CHECK(for NIS+, zsh_cv_sys_nis_plus,
-[test -f /usr/bin/nisls && /usr/bin/nisls > /dev/null 2>&1 && \
+[test $ac_cv_func_nis_list = yes && test -f /usr/bin/nisls && \
+ /usr/bin/nisls > /dev/null 2>&1 && \
 zsh_cv_sys_nis_plus=yes || zsh_cv_sys_nis_plus=no])
 if test $zsh_cv_sys_nis_plus = yes; then
   AC_DEFINE(HAVE_NIS_PLUS)

