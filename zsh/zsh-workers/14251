From zsh-workers-return-14251-mason-zsh=primenet.com.au@sunsite.dk Tue May 08 08:11:51 2001
Return-Path: <zsh-workers-return-14251-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14591 invoked from network); 8 May 2001 08:11:50 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 8 May 2001 08:11:50 -0000
Received: (qmail 23168 invoked by alias); 8 May 2001 08:11:43 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14251
Received: (qmail 23156 invoked from network); 8 May 2001 08:11:42 -0000
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
Date: Tue, 8 May 2001 10:11:29 +0200 (MET DST)
Message-Id: <200105080811.KAA03599@beta.informatik.hu-berlin.de>
To: zsh-workers@sunsite.dk
Subject: PATCH: Re: Screen refresh problem with completion messages
In-Reply-To: <1010507143439.ZM27670@candle.brasslantern.com>

Bart Schaefer wrote:

> On May 7, 12:33pm, Sven Wischnowsky wrote:
> } Subject: Re: Screen refresh problem with completion messages
> }
> } This is yet another manifestation of the first bug in the BUGS file.
> } 
> } At least for the non-complist code, it actually prints all characters
> } and then outputs a CLEAREOL which removes the last character again.
> 
> What about simply emitting space-backspace when the cursor reaches the
> COLUMNS-th character?  That might have some ramifications in zle, but
> it should be completely harmless in complist.

Oh, yes.

Bye
  Sven

Index: Src/Zle/complist.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/complist.c,v
retrieving revision 1.40
diff -u -r1.40 complist.c
--- Src/Zle/complist.c	2001/03/15 09:55:33	1.40
+++ Src/Zle/complist.c	2001/05/08 08:11:11
@@ -576,6 +576,7 @@
 		    return ask;
 		}
 		col = 0;
+                fputs(" \010", shout);
 	    }
 	}
     }
@@ -895,8 +896,10 @@
 		    continue;
 		}
 		putc(*p, shout);
-		if ((beg = !(cc % columns)) && !stat)
+		if ((beg = !(cc % columns)) && !stat) {
 		    ml++;
+                    fputs(" \010", shout);
+                }
 		if (mscroll && beg && !--mrestlines && (ask = asklistscroll(ml))) {
 		    *stop = 1;
 		    if (stat && n)
Index: Src/Zle/zle_tricky.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_tricky.c,v
retrieving revision 1.24
diff -u -r1.24 zle_tricky.c
--- Src/Zle/zle_tricky.c	2001/02/28 09:12:57	1.24
+++ Src/Zle/zle_tricky.c	2001/05/08 08:11:12
@@ -1917,8 +1917,11 @@
 		l += 1 + (cc / columns);
 		cc = 0;
 	    }
-	    if (dopr)
+	    if (dopr) {
 		putc(*p, shout);
+                if (!(cc % columns))
+                    fputs(" \010", shout);
+            }
 	}
     }
     if (dopr) {

-- 
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

