From zsh-workers-return-25099-mason-zsh=primenet.com.au@sunsite.dk Sat May 24 20:21:54 2008
Return-Path: <zsh-workers-return-25099-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21857 invoked from network); 24 May 2008 20:21:51 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 24 May 2008 20:21:51 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 10967 invoked from network); 24 May 2008 20:21:45 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 24 May 2008 20:21:45 -0000
Received: (qmail 21195 invoked by alias); 24 May 2008 20:21:42 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25099
Received: (qmail 21177 invoked from network); 24 May 2008 20:21:41 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 24 May 2008 20:21:41 -0000
Received: from cork.scru.org (cork.scru.org [209.20.67.2])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 025F08059114
	for <zsh-workers@sunsite.dk>; Sat, 24 May 2008 22:21:37 +0200 (CEST)
Received: by cork.scru.org (Postfix, from userid 1000)
	id 6AB561040D7; Sat, 24 May 2008 20:21:35 +0000 (UTC)
Date: Sat, 24 May 2008 20:21:35 +0000
From: Clint Adams <schizo@debian.org>
To: Sykora <sykora.skywave@gmail.com>
Cc: 482662@bugs.debian.org, zsh-workers@sunsite.dk
Subject: Re: Bug#482662: zsh: completion with locate gives extra output
Message-ID: <20080524202135.GA18082@scru.org>
Mail-Followup-To: Sykora <sykora.skywave@gmail.com>, 482662@bugs.debian.org,
	zsh-workers@sunsite.dk
References: <20080524095358.26811.79795.reportbug@nexus> <20080524135404.GA9888@scru.org> <20080524164656.GA2682@nexus>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20080524164656.GA2682@nexus>
User-Agent: Mutt/1.5.17+20080114 (2008-01-14)
X-Virus-Scanned: ClamAV 0.91.2/7228/Sat May 24 20:09:29 2008 on bifrost
X-Virus-Status: Clean

On Sat, May 24, 2008 at 10:16:56PM +0530, Sykora wrote:
> I just typed "locate" at the prompt and pressed space, followed by tab. 
> 
> 
> $> locate Usage: locate [-d path | --database=path] [-e | -E | --[non-]existing]
>       [-i | --ignore-case] [-w | --wholename] [-b | --basename] 
>       [--limit=N | -l N] [-S | --statistics] [-0 | --null] [-c | --count]
>       [-P | -H | --nofollow] [-L | --follow] [-m | --mmap ] [ -s | --stdio ]
>       [-A | --all] [-p | --print] [-r | --regex ] [--regextype=TYPE]
>       [--max-database-age D] [--version] [--help]
>       pattern...
> 
> Report bugs to <bug-findutils@gnu.org>.
> <CURSOR HERE>

Ah, okay. You are using GNU locate and I am using mlocate.

> If I try to complete an option, it places the normal completion list
> following the cursor, but after the help text.
> 
> If you're unable to reproduce it, then I'm wondering if it's simply a
> conflict with my shell setup. But yet, when I checked on #zsh, some were
> able to recreate it.
> 
> I'll see if I can find out what it is.
> 
> Further, I found that I could (nominally) fix the problem by commenting
> out :
> 
>     input="$(_call_program locate $words[1])"
>     
> at line 14 of _locate, and setting ltype to gnu directly. But then, I
> have little clue what I did, just thought I'd mention it.

So _locate is trying to match *(#i)gnu locate*, which does not appear in the
`locate -V` output (nor does it appear in the `locate --version` output).
Does anyone have an older version of findutils handy? Would matching for
*findutils* or (#i)*findutils*gnu* cover all possibilities?

% locate: invalid option -- V
Usage: locate [-d path | --database=path] [-e | -E | --[non-]existing]
      [-i | --ignore-case] [-w | --wholename] [-b | --basename] 
      [--limit=N | -l N] [-S | --statistics] [-0 | --null] [-c | --count]
      [-P | -H | --nofollow] [-L | --follow] [-m | --mmap ] [ -s | --stdio ]
      [-A | --all] [-p | --print] [-r | --regex ] [--regextype=TYPE]
      [--max-database-age D] [--version] [--help]
      pattern...

Report bugs to <bug-findutils@gnu.org>.

% locate --version
locate (GNU findutils) 4.4.0
Copyright (C) 2007 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by Eric B. Decker, James Youngman, and Kevin Dalley.
Built using GNU gnulib version e5573b1bad88bfabcda181b9e0125fb0c52b7d3b

