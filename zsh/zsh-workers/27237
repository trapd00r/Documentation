From zsh-workers-return-27237-mason-zsh=primenet.com.au@sunsite.dk Fri Aug 28 21:13:15 2009
Return-Path: <zsh-workers-return-27237-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13955 invoked from network); 28 Aug 2009 21:13:02 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 28 Aug 2009 21:13:02 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 36375 invoked from network); 28 Aug 2009 21:09:00 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Aug 2009 21:09:00 -0000
Received: (qmail 1709 invoked by alias); 28 Aug 2009 21:08:55 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 27237
Received: (qmail 24889 invoked from network); 28 Aug 2009 21:02:13 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 28 Aug 2009 21:02:13 -0000
Received: from sievert.tabularazor.org (becquerel.tabularazor.org [217.114.213.185])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 807D88059048
	for <zsh-workers@sunsite.dk>; Fri, 28 Aug 2009 23:02:06 +0200 (CEST)
Received: by sievert.tabularazor.org (Postfix, from userid 1001)
	id 5A5824142F0D; Fri, 28 Aug 2009 21:02:05 +0000 (UTC)
Date: Fri, 28 Aug 2009 21:02:05 +0000
From: Daniel Friesel <derf@becquerel.tabularazor.org>
To: zsh-workers@sunsite.dk
Subject: Question regarding _ssh_hosts
Message-ID: <20090828210205.GA236642@becquerel.tabularazor.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.16 (2007-06-09)
X-Virus-Scanned: ClamAV 0.94.2/9757/Fri Aug 28 15:16:44 2009 on bifrost
X-Virus-Status: Clean

Heya,

The ssh completion (.../Completion/Unix/_ssh) defines the function
_ssh_hosts, which contains the following lines:

> # If users-hosts matches, we shouldn't complete anything else.
> if [[ "$IPREFIX" == *@ ]]; then
>   _combination -s '[:@]' my-accounts users-hosts "users=${IPREFIX/@}" hosts "$@" && return
> else
>   _combination -s '[:@]' my-accounts users-hosts \
>     ${opt_args[-l]:+"users=${opt_args[-l]:q}"} hosts "$@" && return
> fi

Afterwards, the completion reads ~/.ssh/config for the hosts to
complete.

However, zshcompsys(1) says about _combination:

> If  no  style  with  the given name is defined for the given tag, or if
> none of the strings in style's value match, but a function name of the
> required field preceded by an underscore is defined, that function will
> be called to generate the matches.  For example, if there is no
> `users-hosts-ports'  or no matching hostname when a host is required,
> the function `_hosts' will automatically be called.

Judging from this, it seems that the part after the if/else is never
called, which is also what I observe when testing.

Since there is a case in which I want _ssh_hosts to use its (quite nice)
completion based upon ~/.ssh/config, I wonder if there's something I'm
getting wrong or if there really is no way to use that completion part.

Greetings,
derf

