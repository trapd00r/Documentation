From kazda@VNET.IBM.COM Wed Apr 24 06:09:56 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3) with ESMTP id GAA15483 for <mason@werple.mira.net.au>; Wed, 24 Apr 1996 06:09:48 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id PAA17799; Tue, 23 Apr 1996 15:52:18 -0400 (EDT)
Resent-Date: Tue, 23 Apr 1996 15:52:18 -0400 (EDT)
Date: Tue, 23 Apr 1996 13:58:54 -0400
From: <kazda@VNET.IBM.COM> (Mike Kazda)
Message-Id: <9604231758.AA16361@rumor.fishkill.ibm.com>
To: Zefram <A.Main@dcs.warwick.ac.uk>
Cc: zsh-workers@math.gatech.edu
Subject: Re: zsh-2.6-beta14 on AIX with login shell problem
In-Reply-To: <9828.199604231559@stone.dcs.warwick.ac.uk>
References: <9604231535.AA27344@rumor.fishkill.ibm.com>
        <9828.199604231559@stone.dcs.warwick.ac.uk>
Resent-Message-ID: <"XVkRL1.0.-L4.nJJVn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/948
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 2135
Status: OR

>>>>> "Zefram" == Zefram  <A.Main@dcs.warwick.ac.uk> writes:

    >> Aha!  That did it!  It seems that when zsh uses -lcurses it
    >> works correctly.  Maybe the 'configure.in' file should be
    >> changed to prefer SysV curses library over the BSD termcap
    >> library.  Hint, hint.. Richard how do you feel about making
    >> this change?

    Zefram> But we don't *use* curses, only termcap, and on many
    Zefram> systems libcurses doesn't include libtermcap (you need
    Zefram> them both to get working curses).  I think termcap should
    Zefram> still be preferred, but a kludge to recognise systems
    Zefram> where it's actually broken would be appropriate.

In that case, I agree.  Here's a patch to kludge the preference order
of termcap and curses for AIX 3.2.5.  It will replace my other one.
Please consider this one instead for inclusion.

--- configure.in.orig   Mon Apr 15 01:32:58 1996
+++ configure.in        Tue Apr 23 13:53:14 1996
@@ -217,8 +217,17 @@
 dnl -------------------
 dnl CHECK FOR LIBRARIES
 dnl -------------------
-dnl Prefer BSD termcap library to SysV curses library.
-for lib in termcap curses ncurses; do
+dnl Prefer BSD termcap library to SysV curses library, except on aix3.2.5
+dnl  On aix3.2.5:
+dnl  It appears that the curses library works properly with installed
+dnl  configuration instead of the termcap library, both are shared and
+dnl  include termcap.
+if test `echo $host_os | sed 's/^.*\(aix3.2.5\)/\1/'` = aix3.2.5; then
+  termcap_curses_order="curses ncurses termcap"
+else
+  termcap_curses_order="termcap curses ncurses"
+fi
+for lib in $termcap_curses_order; do
   AC_CHECK_LIB($lib, tgetent, [LIBS="$LIBS -l$lib"; break])
 done

    Zefram> The best solution would be for sysadmins to fix broken
    Zefram> terminfo libraries.

Actually I don't think that's the best solution.  If sysadmins muck
with the system configuration and then install a new patch or update,
chances are the customizations will get overwritten.  What really
needs to be done is to fix the messed up terminfo stuff in an update
to AIX or whatever.  Then everyone can get this fixed.

Mike


