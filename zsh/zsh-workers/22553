From zsh-workers-return-22553-mason-zsh=primenet.com.au@sunsite.dk Mon Jul 17 22:40:50 2006
Return-Path: <zsh-workers-return-22553-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4198 invoked from network); 17 Jul 2006 22:40:48 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.3 (2006-06-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 17 Jul 2006 22:40:48 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 98500 invoked from network); 17 Jul 2006 22:40:43 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Jul 2006 22:40:43 -0000
Received: (qmail 2501 invoked by alias); 17 Jul 2006 22:40:40 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22553
Received: (qmail 29077 invoked from network); 17 Jul 2006 22:25:39 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 17 Jul 2006 22:25:39 -0000
Received: (qmail 83144 invoked from network); 17 Jul 2006 22:25:39 -0000
Received: from ultrasuede.reed.edu (134.10.2.46)
  by a.mx.sunsite.dk with SMTP; 17 Jul 2006 22:25:37 -0000
Received: from [66.81.18.49] (66-81-18-49.socal.dialup.o1.com [66.81.18.49])
	(authenticated bits=0)
	by ultrasuede.reed.edu (8.13.7/8.13.6) with ESMTP id k6HMPOac012003
	(version=TLSv1/SSLv3 cipher=RC4-SHA bits=128 verify=NOT)
	for <zsh-workers@sunsite.dk>; Mon, 17 Jul 2006 15:25:33 -0700
Mime-Version: 1.0 (Apple Message framework v623)
To: zsh-workers@sunsite.dk
Message-Id: <839a001951e139f1c79f13dd7253d7ef@netwood.net>
Content-Type: multipart/mixed; boundary=Apple-Mail-2-921796780
From: Jesse W <jessw@netwood.net>
Subject: PATCH: metaflac completion
Date: Mon, 17 Jul 2006 15:26:11 -0700
X-Mailer: Apple Mail (2.623)
X-Scanned-By: MIMEDefang 2.53 on 134.10.2.46


--Apple-Mail-2-921796780
Content-Transfer-Encoding: 7bit
Content-Type: text/plain;
	charset=US-ASCII;
	format=flowed

I've written a first version of a z shell completion function for the 
FLAC metadata editing program, metaflac; right now it doesn't complete 
any of the option arguments that arn't files, but it handles the 
various options, and handles looking only for FLAC files (with the -g 
option of _files).  This will be more or less my first zsh completion 
function, so any suggestions would be greatly appreciated.

I plan to implement completion for the tag options, so that, i.e. 
`metaflac foo.flac --show-tag=` would automatically get a list of the 
tags in the file in the background and complete their names at that 
point; also, I'd hope the --set-tag= option would have a preset range 
of tags to set.

My eventual goal is to make metaflac (with zsh completion) into a 
more-or-less comfortable FLAC metadata editor.

The file is attached.  If the mailing system mucks it up, it's also 
available at
http://netwood.net/usr/jessw/_metaflac


--Apple-Mail-2-921796780
Content-Transfer-Encoding: 7bit
Content-Type: application/octet-stream;
	x-unix-mode=0644;
	name="_metaflac"
Content-Disposition: attachment;
	filename=_metaflac

#compdef metaflac

#Written by Jesse Weinstein <jessw@netwood.net>, Mon Jul 17 15:17:12 2006
#Version 0.3 - doesn't handle non-file option arguments yet.
#Released under the MIT license (or any compatible free-content license)
#i.e. do whatever you like with it, but credit me.

local _metaflac_opts _metaflac_shorts _metaflac_opers
typeset -A opt_args
function _metaflac_tags () {
    echo "\n\nBEEP - $line - BEEP\n\n"
}
_metaflac_opts=( 
    '--preserve-modtime' 
    '--with-filename[prefix output with filename]' 
    '--no-filename' 
    '--dont-use-padding[always rewrite the file]' 
)
_metaflac_shorts=(
    '--show-md5sum'
    '--show-min-blocksize'
    '--show-max-blocksize'
    '--show-min-framesize'
    '--show-max-framesize'
    '--show-sample-rate'
    '--show-channels'
    '--show-bps'
    '--show-total-samples'
    '--show-vendor-tag'
    '--show-tag=:FLAC tags:_metaflac_tags'
    '--remove-tag=:FLAC tags: '
    '--remove-first-tag=:FLAC tags: '
    '--remove-all-tags'
    '--set-tag=:FLAC tag and value: '
    '--import-tags-from=:flat file:_files'
    '--export-tags-to=:new file: '
    '--import-cuesheet-from=:file:_files'
    '--export-cuesheet-to=:new file: '
    '--add-replay-gain'
    '--add-seekpoint=:: '
    '--add-padding=length'

)
_metaflac_opers=(
    '--block-number=:: '
    '--block-type=:: '
    '--except-block-type=:: '
    '--application-data-format=:: '
    '--remove'
    '--remove-all'
    '--merge-padding'
    '--sort-padding'
)

_arguments "$_metaflac_opts[@]" \
    "*:FLAC file:_files -g \*.flac" \
    - "shortcuts" \
    "$_metaflac_shorts[@]" \
    - "(operations)" \
    "$_metaflac_opers[@]" \
    && return 0


--Apple-Mail-2-921796780--

