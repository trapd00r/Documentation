From zsh-workers-request@math.gatech.edu  Fri May 19 20:47:36 1995
Received: from gatech.edu (gatech.edu [128.61.1.1]) by werple.mira.net.au (8.6.10/8.6.9) with SMTP id UAA02768 for <mason@werple.mira.net.au>; Fri, 19 May 1995 20:47:30 +1000
Received: from math (math.skiles.gatech.edu) by gatech.edu with SMTP id AA19458
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Fri, 19 May 1995 06:42:30 -0400
Received: by math (5.x/SMI-SVR4)
	id AA18810; Fri, 19 May 1995 06:37:20 -0400
Resent-Date: Fri, 19 May 1995 12:32:39 +0100 (MET DST)
Old-Return-Path: <hzoli@cs.elte.hu>
From: hzoli@cs.elte.hu (Zoltan Hidvegi)
Message-Id: <9505191032.AA11439@turan.elte.hu>
Subject: Bugfix to hzoli8
To: zsh-list@sterling.com (zsh-list)
Date: Fri, 19 May 1995 12:32:39 +0100 (MET DST)
X-Mailer: ELM [version 2.4 PL21]
Content-Type: text
Resent-Message-Id: <"FU1N-.0.lb4.VJ7ll"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/12
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

I discovered a small bug in my zsh distribution:

% zsh -f
turan% setopt ignorebraces 
turan% foo=bug
turan% echo ${bar-${foo}}
zsh: closing brace expected

Here is the fix.

Zoltan


*** 1.10	1995/05/05 17:20:22
--- Src/lex.c	1995/05/17 21:02:14
***************
*** 675,684 ****
  		}
  		c = Outpar;
  	    } else {
! 		if (e == '{' && !in_brace_param) {
  		    add(c);
  		    c = Inbrace;
! 		    in_brace_param = ++bct;
  		} else
  		    hungetc(e);
  	    }
--- 675,686 ----
  		}
  		c = Outpar;
  	    } else {
! 		if (e == '{') {
  		    add(c);
  		    c = Inbrace;
! 		    ++bct;
! 		    if (!in_brace_param)
! 			in_brace_param = bct;
  		} else
  		    hungetc(e);
  	    }

