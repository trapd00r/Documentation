From zsh-workers-return-19422-mason-zsh=primenet.com.au@sunsite.dk Sun Feb 15 12:37:18 2004
Return-Path: <zsh-workers-return-19422-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19014 invoked from network); 15 Feb 2004 12:37:16 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 15 Feb 2004 12:37:16 -0000
Received: (qmail 1887 invoked by alias); 15 Feb 2004 12:36:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19422
Received: (qmail 1873 invoked from network); 15 Feb 2004 12:36:59 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 15 Feb 2004 12:36:59 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [80.184.44.192] by sunsite.dk (MessageWall 1.0.8) with SMTP; 15 Feb 2004 12:36:58 -0000
Received: from opk by athlon with esmtp (masqmail 0.2.20) id
 1AsLhB-5qN-00; Sun, 15 Feb 2004 13:48:25 +0100
cc: zsh-workers@sunsite.dk
In-reply-to: <C1A391A0-5DF8-11D8-AEA2-000A958FBAFE@e.co.za> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <C1A391A0-5DF8-11D8-AEA2-000A958FBAFE@e.co.za>
To: Marius van Wyk <marius@e.co.za>
Subject: Re: ZSH 4.1.1 Coredump bug 
Date: Sun, 15 Feb 2004 13:48:25 +0100
Message-ID: <22466.1076849305@athlon>

Marius van Wyk wrote:
> [marius@boa-constructor /home/marius]$ zsh -f
> boa-constructor% compctl -f -x 'p[2]' -s "`/bin/ls /bin`" --open
> Segmentation fault (core dumped)

This should fix it.

Index: Src/Zle/compctl.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compctl.c,v
retrieving revision 1.16
diff -u -r1.16 compctl.c
--- Src/Zle/compctl.c	13 Nov 2003 14:34:38 -0000	1.16
+++ Src/Zle/compctl.c	15 Feb 2004 12:29:35 -0000
@@ -857,7 +857,7 @@
 		}
 		break;
 	    default:
-		if (!first && (**argv == '-' || **argv == '+'))
+		if (!first && (**argv == '-' || **argv == '+') && !argv[0][1])
 		    (*argv)--, argv--, ready = 1;
 		else {
 		    zwarnnam(name, "bad option: -%c", NULL, **argv);

