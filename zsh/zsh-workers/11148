From zsh-workers-return-11148-mason-zsh=primenet.com.au@sunsite.auc.dk Thu May 04 11:40:26 2000
Return-Path: <zsh-workers-return-11148-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2675 invoked from network); 4 May 2000 11:40:25 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 4 May 2000 11:40:25 -0000
Received: (qmail 5053 invoked by alias); 4 May 2000 11:40:14 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11148
Received: (qmail 5042 invoked from network); 4 May 2000 11:40:13 -0000
Date: Thu, 4 May 2000 13:40:01 +0200 (MET DST)
Message-Id: <200005041140.NAA03047@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Bart Schaefer"'s message of Wed, 3 May 2000 16:57:00 +0000
Subject: Re: PATCH: Re: History bug (Re: Completion debugging)


Bart Schaefer wrote:

> On May 3,  9:07am, Sven Wischnowsky wrote:
> } Subject: PATCH: Re: History bug (Re: Completion debugging)
> }
> } > Why are there two of numbers 24, 29 and 32?  In each case, the first of the
> } > two was inserted by calling "print -s ..." during completion.  Apparently
> } > that doesn't work very well.
> } 
> } Of course this isn't only in completion, but in every widget.
> } 
> } The problem is that the history number for the currently edited line
> } is `reserved' and the `print -s' makes it be used. The patch below is
> } the simplest solution I can think of.
> 
> OOOooh, this is fun.
> 
> Change the "print -zR" in _complete_debug to "print -sR", and then:
> 
> zagzig[112] ls <C-x?>
> Debugging output left in /tmp/zsh13117ls3
> (listing omitted)
> zagzig[112] ls <C-n>
> zagzig[112] emacs /tmp/zsh13117ls3 ;: "ls -CF "<C-p>
> zagzig[112] ls <wait a few minutes, then RET>
> (listing omitted)
> zagzig[114] history -d
>   113  09:48  emacs /tmp/zsh13117ls3 ;: "ls -CF "
>   113  09:51  ls
> zagzig[115] 
> 
> So there are still two 113s in the history list, but the prompt has the
> right history number.  I'm expecting that particular shell to crash any
> time now ...

I get a SEGV reproducibly after C-p C-n. If I take out my patch for
this, I get it after the C-p.

Hm, maybe someone more knowledgeable with history stuff...?

Bye
 Sven


--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

