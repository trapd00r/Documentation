From zsh-workers-return-10322-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Mar 29 22:19:16 2000
Return-Path: <zsh-workers-return-10322-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24154 invoked from network); 29 Mar 2000 22:19:14 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 29 Mar 2000 22:19:14 -0000
Received: (qmail 14863 invoked by alias); 29 Mar 2000 22:19:04 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10322
Received: (qmail 14844 invoked from network); 29 Mar 2000 22:19:02 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <000329141848.ZM7407@candle.brasslantern.com>
Date: Wed, 29 Mar 2000 14:18:48 -0800
In-Reply-To: <E12aOS2-0004hL-00.2000-03-29-20-48-26@mail4.svr.pol.co.uk>
Comments: In reply to Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
        "Re: Bugs with exclusion using file paths." (Mar 28,  9:48pm)
References: <E12aOS2-0004hL-00.2000-03-29-20-48-26@mail4.svr.pol.co.uk>
X-Mailer: Z-Mail Lite (5.0.0 30July97)
To: Peter Stephenson <pws@pwstephenson.fsnet.co.uk>,
        zsh-workers@sunsite.auc.dk
Subject: Re: Bugs with exclusion using file paths.
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Mar 28,  9:48pm, Peter Stephenson wrote:
> Subject: Re: Bugs with exclusion using file paths.
> 
> Let me know if there is still a problem after this.

I now get no core dumps, no BUG:s, and the same results from both dynamic
and static links (which I'm not sure I was getting before, strangely).

A somewhat more complete patch for 11glob.ztst seems to be in order.  This
goes on top of my last patch.  I guess it turns out to be a multios test
as well; hmm.

This patch also fixes a problem I inadvertently found with the test
for completion, which is that if TERM is set to a value which causes ZLE
to be disabled, the test hangs forever.  I chose to force TERM=vt100,
but if anyone can think of a safer choice ...

Index: Test/11glob.ztst
===================================================================
@@ -1,13 +1,20 @@
 # Tests for globbing
 
 %prep
+  mkdir glob.tmp
+  mkdir glob.tmp/dir1
+  mkdir glob.tmp/dir2
+  : >glob.tmp/{,{dir1,dir2}/}{a,b,c}
+
   globtest () { $ZTST_testdir/../Src/zsh -f $ZTST_srcdir/../Misc/$1 }
 
   regress_absolute_path_and_core_dump() {
-    local absolute_srcdir=$(cd $ZTST_srcdir/.. && pwd -P) || return 1
-    setopt localoptions extendedglob nonomatch
-    print $absolute_srcdir/**/*~/*
-    print $absolute_srcdir/**/*~(.)#
+    local absolute_dir=$(cd glob.tmp && pwd -P)
+    [[ -n $absolute_dir ]] || return 1
+    setopt localoptions extendedglob nullglob
+    print $absolute_dir/**/*~/*
+    setopt nonullglob nomatch
+    print glob.tmp/**/*~(.)#
   }
 
 %test
@@ -244,3 +251,5 @@
 
   ( regress_absolute_path_and_core_dump )
 0:exclusions regression test
+>
+>glob.tmp/a glob.tmp/b glob.tmp/c glob.tmp/dir1 glob.tmp/dir1/a glob.tmp/dir1/b glob.tmp/dir1/c glob.tmp/dir2 glob.tmp/dir2/a glob.tmp/dir2/b glob.tmp/dir2/c
Index: Test/53completion.ztst
===================================================================
@@ -3,7 +3,8 @@
 %prep
   zmodload -i zsh/zpty
 
-  export ZTST_testdir ZTST_srcdir
+  TERM=vt100
+  export ZTST_testdir ZTST_srcdir TERM
   comptest () { $ZTST_testdir/../Src/zsh -f $ZTST_srcdir/comptest -z $ZTST_testdir/../Src/zsh -d $ZTST_testdir/compdump.tmp "$@" }
 
   mkdir comp.tmp

