From zsh-workers-return-10895-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Apr 24 02:58:41 2000
Return-Path: <zsh-workers-return-10895-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10197 invoked from network); 24 Apr 2000 02:58:39 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 24 Apr 2000 02:58:39 -0000
Received: (qmail 19233 invoked by alias); 24 Apr 2000 02:58:33 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10895
Received: (qmail 19215 invoked from network); 24 Apr 2000 02:58:32 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000424025822.ZM30224@candle.brasslantern.com>
Date: Mon, 24 Apr 2000 02:58:22 +0000
In-Reply-To: <20000417105803.A25633@primenet.com.au>
Comments: In reply to Geoff Wing <gcw@pobox.com>
        "Re: 3.1.6-dev-22" (Apr 17, 10:58am)
References: <E12f77V-0004S7-00.2000-04-11-21-18-46@cmailg2.svr.pol.co.uk> 
	<slrn8f85va.edk.mason@coral.primenet.com.au> 
	<1000412081220.ZM11853@candle.brasslantern.com> 
	<20000417105803.A25633@primenet.com.au>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Geoff Wing <gcw@pobox.com>
Subject: Re: 3.1.6-dev-22
Cc: zsh-workers@sunsite.auc.dk
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Apr 17, 10:58am, Geoff Wing wrote:
} Subject: Re: 3.1.6-dev-22
}
} Bart Schaefer wrote about Re: 3.1.6-dev-22:
} :On Apr 12,  6:30am, Geoff Wing wrote:
} :} Subject: Re: 3.1.6-dev-22
} :} We differ from other shells in that we have a clear workspace
} :} under the prompt line.  Apply [users/2973] and [...]
} :} My preference is for the current arrangement and I have
} :} noalwayslastprompt - adding the patch may spawn another setopt
} :} value: gimmeaclearworkspace :-)
} :I'll play with this a bit when I'm wider awake, but:
} 
} I've been waiting.  Are you wider awake yet?  :-)

I woke up and promptly left town.  (Pun?)

What I was supposed to try was:

% clear; ls; echo "\e[0H"; ls

If I replace those semicolons with RETs so that a new prompt is printed
between each pair of commands, then I begin to see what you mean.  (It
depends more than a little bit on the "ls" output -- if the output is
enough to scroll the screen, for example, no difference is discernable).

Nevertheless, this is only an issue if a command (the echo in the sample)
leaves the cursor above some portion of a screenful of output.  Does that
happen to you a lot?  The last time I can remember it happening to me, it
was because a curses-based program crashed.

I'm sure some test other than `&& isset(ALWAYSLASTPROMPT)' would be better;
if it's not clearing for the completion code's benefit then whether we've
returned to the previous prompt is irrelevant (e.g., if Geoff's arguments
aren't convincing then maybe we should remove that CLEAREOD entirely).

However, I don't feel very strongly about it either way; special-case code
for transparent terminals makes even less sense than for crashing commands.

} :Can't you get the same effect with 2973 applied by having %E as the last
} :thing in $PS1 ?
} 
} 1) %E is CLEAREOL (erase to end of line)

Oh, duh.

} :And what's the point of having the %E escape if zsh is always going to
} :clear the screen unconditionally?  Just for "print -P"?
} 
} 2) The display code doesn't know about %E.  The prompt code handles
}    that but doesn't pass that information through, leading to:
} 3) %E in prompts may be dangerous.

Maybe we should document this?

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

