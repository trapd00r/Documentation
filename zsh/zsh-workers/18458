From zsh-workers-return-18458-mason-zsh=primenet.com.au@sunsite.dk Tue Apr 22 12:19:00 2003
Return-Path: <zsh-workers-return-18458-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20587 invoked from network); 22 Apr 2003 12:18:59 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 22 Apr 2003 12:18:59 -0000
Received: (qmail 28292 invoked by alias); 22 Apr 2003 12:18:52 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18458
Received: (qmail 28246 invoked from network); 22 Apr 2003 12:18:51 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 22 Apr 2003 12:18:51 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [212.125.75.4] by sunsite.dk (MessageWall 1.0.8) with SMTP; 22 Apr 2003 12:18:51 -0000
Received: (qmail 8131 invoked from network); 22 Apr 2003 12:17:57 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-4.tower-1.messagelabs.com with SMTP; 22 Apr 2003 12:17:57 -0000
Received: from gmcs3.logica.co.uk ([158.234.142.61])
	by iris.logica.co.uk (8.9.3/8.9.3/Debian 8.9.3-21) with ESMTP id NAA07028
	for <zsh-workers@sunsite.dk>; Tue, 22 Apr 2003 13:17:05 +0100
X-Authentication-Warning: iris.logica.co.uk: Host [158.234.142.61] claimed to be gmcs3.logica.co.uk
Received: from gmcs3.logica.co.uk (localhost [127.0.0.1])
	by gmcs3.logica.co.uk (8.11.6/8.11.6/SuSE Linux 0.5) with ESMTP id h3MCGxF13506
	for <zsh-workers@sunsite.dk>; Tue, 22 Apr 2003 14:16:59 +0200
X-VirusChecked: Checked
From: Oliver Kiddle <okiddle@yahoo.co.uk>
To: Zsh workers <zsh-workers@sunsite.dk>
Subject: PATCH: prefix-needed ignored by _describe -o
Date: Tue, 22 Apr 2003 14:16:59 +0200
Message-ID: <13504.1051013819@gmcs3.logica.co.uk>

The documentation for _describe -o says that it will check, among
others, the prefix-needed style. But it doesn't. This patch makes it do
so. It also adds a completion for renice which uses _describe for
options and thus alerted me to the problem.

Oliver

Index: Completion/Base/Utility/_describe
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Base/Utility/_describe,v
retrieving revision 1.13
diff -u -r1.13 _describe
--- Completion/Base/Utility/_describe	23 May 2002 12:16:42 -0000
1.13
+++ Completion/Base/Utility/_describe	22 Apr 2003 10:59:47 -0000
@@ -20,6 +20,10 @@
   shift
 fi
 
+[[ "$_type" = options && ! -prefix [-+]* ]] && \
+    zstyle -T ":completion:${curcontext}:options" prefix-needed &&
+        return 1
+
 # Do the tests. `showd' is set if the descriptions should be shown.
 
 zstyle -T ":completion:${curcontext}:$_type" verbose && _showd=yes
Index: Completion/Unix/Command/.distfiles
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/.distfiles,v
retrieving revision 1.39
diff -u -r1.39 .distfiles
--- Completion/Unix/Command/.distfiles	19 Apr 2003 17:23:47 -0000
1.39
+++ Completion/Unix/Command/.distfiles	22 Apr 2003 10:59:47 -0000
@@ -19,5 +19,5 @@
 _fsh          _chkconfig    _cdcd         _irssi        _mysqldiff
_sccs
 _netcat       _larch        _texinfo	  _figlet       _elinks
_tidy
 _global       _global_tags  _ant          _lsof         _mt
_xmlsoft
-_perforce     _python       _antiword     _screen
+_perforce     _python       _antiword     _screen       _renice
 '
Index: Completion/Unix/Command/_renice
===================================================================
RCS file: Completion/Unix/Command/_renice
diff -N Completion/Unix/Command/_renice
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ Completion/Unix/Command/_renice	22 Apr 2003 10:59:47 -0000
@@ -0,0 +1,22 @@
+#compdef renice
+
+if [[ $CURRENT = 2 ]]; then
+  _message -e priority
*  return
+else
+  local opts ret=1
+  opts=(
+    '-g:interpret args as process group IDs'
+    '-u:interpret args as user names'
+    '-p:interpret args as process IDs'
+  )
+  _describe -o option opts && ret=0
+
+  case ${(v)words[(I)-?]} in
+    -g) _message -e pgids 'process group ID' && ret=0 ;;
+    -u) _users && ret=0 ;;
+    *)  _pids && ret=0;;
+  esac
+fi
+
+return ret

