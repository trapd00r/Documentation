From zsh-workers-return-18984-mason-zsh=primenet.com.au@sunsite.dk Sat Aug 30 19:29:48 2003
Return-Path: <zsh-workers-return-18984-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13618 invoked from network); 30 Aug 2003 19:29:48 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 30 Aug 2003 19:29:48 -0000
Received: (qmail 19817 invoked by alias); 30 Aug 2003 19:29:43 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18984
Received: (qmail 19806 invoked from network); 30 Aug 2003 19:29:43 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 30 Aug 2003 19:29:43 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [195.92.193.211] by sunsite.dk (MessageWall 1.0.8) with SMTP; 30 Aug 2003 19:29:43 -0000
Received: from modem-218.imperator-angel.dialup.pol.co.uk ([62.137.32.218] helo=pwstephenson.fsnet.co.uk)
	by cmailm4.svr.pol.co.uk with esmtp (Exim 4.14)
	id 19tBPq-0001Hi-6N; Sat, 30 Aug 2003 20:29:42 +0100
Received: by pwstephenson.fsnet.co.uk (Postfix, from userid 501)
	id 193A9850C; Sat, 30 Aug 2003 15:33:33 -0400 (EDT)
Received: from pwstephenson.fsnet.co.uk (localhost [127.0.0.1])
	by pwstephenson.fsnet.co.uk (Postfix) with ESMTP
	id F263884E1; Sat, 30 Aug 2003 20:33:33 +0100 (BST)
To: Alexey Tourbin <at@altlinux.ru>,
	zsh-workers@sunsite.dk (Zsh hackers list)
Subject: Re: zpty 
In-reply-to: "Alexey Tourbin"'s message of "Fri, 29 Aug 2003 15:03:33 +0400."
             <20030829110333.GB2661@julia.office.altlinux.ru> 
Date: Sat, 30 Aug 2003 20:33:32 +0100
From: Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Message-Id: <20030830193333.193A9850C@pwstephenson.fsnet.co.uk>

Alexey Tourbin wrote:
> I'm new to this mailing list.  I've been using zsh for a while.
> Recently I found out that zpty actually does not work on my Linux
> system.

[This is about the internals and should really go to zsh-workers rather
than zsh-users, so I've redirected this follow up.]

> As I digged into the code, I saw those old-style /dev/ptyxx heuristics
> which may not work on some modern Linux systems because the location is
> changed to /dev/pts/xx.  Meanwhile there's an API in glibc for dealing
> with pseudo terminals.  So I reworked that code a bit.
> 
> Now it works fine for me.  Of course it's not portable, it works with
> glibc only.  But glibc is one of the most popular libc implementation,
> and it works not on Linux systems only.  So please consider whether this
> can be useful somehow.

This is very useful, thank you, but as with the NIS/NIS+ patch I just
commented on, it can't go in without some configuration test.  It looks
like testing for getpt, grantpt and unlockpt functions in zshconfig.ac
might do the trick (I see it also does some streams handling, which is
kernel-specific and we can't really assume, either), so we might be able
to do it; however, it won't happen straight away.

-- 
Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Work: pws@csr.com
Web: http://www.pwstephenson.fsnet.co.uk

