From zsh-workers-return-12725-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Sep 03 05:19:08 2000
Return-Path: <zsh-workers-return-12725-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21860 invoked from network); 3 Sep 2000 05:19:07 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 3 Sep 2000 05:19:07 -0000
Received: (qmail 8296 invoked by alias); 3 Sep 2000 05:18:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12725
Received: (qmail 8289 invoked from network); 3 Sep 2000 05:18:47 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000903051841.ZM28003@candle.brasslantern.com>
Date: Sun, 3 Sep 2000 05:18:41 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: Fix up helpfiles just a little
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

At least on my system, GNU nroff -man does not produce end-of-page numbers
in a format matching /^\s*Page/, which causes helpfiles to run past the end
of the builtins section.  This adds an additional end-of-page test.

Also, zshzle is now the next section after zshbuiltins, not zshcompctl.

Of course, there are now command descriptions in several other sections of
the manual besides zshbuiltins, and helpfiles still misses those entirely.

Incidentally, the builtins.yo patch in 12724 is also needed for helpfiles
to work properly, in case that helps motivate anyone to improve on 12724.

Index: Util/helpfiles
===================================================================
@@ -109,8 +109,9 @@
 	$undented && &doprint($_);
 	while (defined($_ = <>) && /(^\w)|(^\s*$)/) { 
 	    last BUILTINS if /^STARTUP\/SHUTDOWN FILES/;
+	    last if /^zsh.*\s\d$/; # GNU nroff -man end-of-page marker
 	}
-        if (/^\s*Page/) {
+        if (/^\s*Page/ || /^zsh.*\s\d$/) {
 	    do {
 		$_ = <>;
 	    } while (defined($_) && /^\s*$/);
@@ -121,8 +122,8 @@
 	    }
 	}
 	# In zshall, the zshcompctl manual page comes after the
-	# builtins.
-	if (/ZSHCOMPCTL\(1\).*ZSHCOMPCTL\(1\)/) {
+	# builtins for 3.0, and zshzle comes after it for 3.1.
+	if (/ZSH(COMPCTL|ZLE)\(1\).*ZSH(COMPCTL|ZLE)\(1\)/) {
 	    last BUILTINS;
 	}
 	if (/^(\s*)/ && length($1) < $indent) {

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

