From zsh-workers-return-27570-mason-zsh=primenet.com.au@zsh.org Wed Jan 06 09:48:40 2010
Return-Path: <zsh-workers-return-27570-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2765 invoked by alias); 6 Jan 2010 09:48:40 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 27570
Received: (qmail 4474 invoked from network); 6 Jan 2010 09:48:29 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-3.0 required=5.0 tests=AWL,BAYES_00,
	RCVD_IN_DNSWL_LOW,SPF_HELO_PASS autolearn=ham version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at csr.com does not designate permitted sender hosts)
Date: Wed, 6 Jan 2010 09:48:19 +0000
From: Peter Stephenson <pws@csr.com>
To: zsh-workers@zsh.org
Subject: Re: [PATCH]: Revamped (P) expansion flag
Message-ID: <20100106094819.48f1e9e0@news01>
In-Reply-To: <22a0ef081001051452g4066b985nef6ac1e9a60e4de9@mail.gmail.com>
References: <22a0ef080912261448x3d14b301yc4082a924cd760d8@mail.gmail.com>
	<20100105172012.3f1d628c@news01>
	<22a0ef081001051452g4066b985nef6ac1e9a60e4de9@mail.gmail.com>
Organization: CSR
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.8; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 06 Jan 2010 09:48:20.0180 (UTC) FILETIME=[610AC140:01CA8EB5]
X-Scanned-By: MailControl A-09-22-10 (www.mailcontrol.com) on 10.68.0.152

On Tue, 5 Jan 2010 17:52:47 -0500
Michael Hwang <michael.a.hwang@gmail.com> wrote:
> On Tue, Jan 5, 2010 at 12:20 PM, Peter Stephenson <pws@csr.com> wrote:
> > With the two patches I know about (the second a single line), the test
> > suite now fails at this test in D06subscript.ztst:
> 
> On Sat, Dec 26, 2009 at 5:48 PM, Michael Hwang
> <michael.a.hwang@gmail.com> wrote:
> > On the more buggy-ish side:
> >
> > % STRING='zsh is awesome!'
> > % STR='zsh sucks... :-/'
> > % REF=STRING
> > % print ${(P)REF[1,3]}
> > zsh sucks... :-/
> >
> > As ${(P)REF} is really ${(P)${REF}}, one would think that that
> > ${(P)REF[1,3]} would be expanded as ${(P)${REF}[1,3]}. But as you can
> > see, it is instead expanded as ${(P)${REF[1,3]}}.
> 
> I believe that the behavior that test relies on should be considered a
> bug. What do you think?

The test isn't very logical without the $.  If I put them into the test,

  qqq=lower
  QQQ=upper
  print ${(P)${A[one\"two\"three\"quotes]}}
  print "${(P)${A[$A[(i)one\"two\"three\"quotes]]}}"
0:Keys with double quotes and the (P) expansion flag
>lower
>upper

it still fails, however:  the first output is now "lower" as before,
but the second output is "lower" too whereas before (even in this form of
the test) it was "upper".  Something has changed in the way quoting is
done.  There may be a logical explanation for this.

-- 
Peter Stephenson <pws@csr.com>            Software Engineer
Tel: +44 (0)1223 692070                   Cambridge Silicon Radio Limited
Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, UK


Member of the CSR plc group of companies. CSR plc registered in England and Wales, registered number 4187346, registered office Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, United Kingdom

