From zsh-workers-return-27900-mason-zsh=primenet.com.au@zsh.org Sat Apr 24 21:40:51 2010
Return-Path: <zsh-workers-return-27900-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 220 invoked by alias); 24 Apr 2010 21:40:51 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 27900
Received: (qmail 4305 invoked from network); 24 Apr 2010 21:40:39 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,FREEMAIL_FROM,
	RCVD_IN_DNSWL_NONE,T_TO_NO_BRKTS_FREEMAIL autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at free.fr does not designate permitted sender hosts)
Date: Sat, 24 Apr 2010 23:40:17 +0200
From: =?UTF-8?B?RnJhbsOnb2lz?= Gannaz <francois.gannaz@free.fr>
To: zsh-workers@zsh.org
Subject: vcs_info and locales
Message-ID: <20100424234017.776ae0ea@coriolan>
X-Mailer: Claws Mail 3.7.5 (GTK+ 2.20.0; x86_64-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Hi

As I installed my zsh prompt on another computer, vcs_info stopped working =
for
svn repositories, it didn't print the branch nor the revision. It was just
because I had a french locale, and so vcs_info could not parse the output of
"svn info". The locale had no effect on hg/git, but I didn't fully test the=
m.

So I suggest either to fix the documentation or (better) fix the code.

In the documentation, for the example in the quickstart:
- precmd () { vcs_info }
+ precmd () { LC_ALL=3DC vcs_info }

In the code:

--- VCS_Info/Backends/VCS_INFO_get_data_svn	2010-02-21 20:48:23.000000000 +=
0100
+++ VCS_INFO_get_data_svn	2010-04-24 23:28:03.000000000 +0200
@@ -10,10 +10,10 @@
=20
 svnbase=3D".";
 svninfo=3D()
-${vcs_comm[cmd]} info --non-interactive | while IFS=3D: read a b; do svnin=
fo[${a// /_}]=3D"${b## #}"; done
+LC_ALL=3DC ${vcs_comm[cmd]} info --non-interactive | while IFS=3D: read a =
b; do svninfo[${a// /_}]=3D"${b## #}"; done
 while [[ -d "${svnbase}/../.svn" ]]; do
     parentinfo=3D()
-    ${vcs_comm[cmd]} info --non-interactive "${svnbase}/.." | while IFS=3D=
: read a b; do parentinfo[${a// /_}]=3D"${b## #}"; done
+    LC_ALL=3DC ${vcs_comm[cmd]} info --non-interactive "${svnbase}/.." | w=
hile IFS=3D: read a b; do parentinfo[${a// /_}]=3D"${b## #}"; done
     [[ ${parentinfo[Repository_UUID]} !=3D ${svninfo[Repository_UUID]} ]] =
&& break
     svninfo=3D(${(kv)parentinfo})
     svnbase=3D"${svnbase}/.."

BTW, changing the command with:
	zstyle ':vcs_info:svn:*:-all-' command "LC_ALL=3DC svn"
didn't work at all, and I don't understand why.

Regards
--
Fran=C3=A7ois

