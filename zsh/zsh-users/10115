From zsh-users-return-10115-mason-zsh=primenet.com.au@sunsite.dk Thu Mar 30 23:02:25 2006
Return-Path: <zsh-users-return-10115-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7460 invoked from network); 30 Mar 2006 23:02:23 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.1 (2006-03-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 30 Mar 2006 23:02:23 -0000
Received: (qmail 12000 invoked from network); 30 Mar 2006 23:02:17 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 30 Mar 2006 23:02:17 -0000
Received: (qmail 17369 invoked by alias); 30 Mar 2006 23:02:01 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10115
Received: (qmail 17345 invoked from network); 30 Mar 2006 23:02:00 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 30 Mar 2006 23:02:00 -0000
Received: (qmail 10333 invoked from network); 30 Mar 2006 23:01:59 -0000
Received: from ihug-mail.icp-qv1-irony4.iinet.net.au (HELO mail-ihug.icp-qv1-irony4.iinet.net.au) (203.59.1.198)
  by a.mx.sunsite.dk with SMTP; 30 Mar 2006 23:01:58 -0000
Received: from 203-214-113-248.dyn.iinet.net.au (HELO mail.endbracket.net) ([203.214.113.248])
  by mail-ihug.icp-qv1-irony4.iinet.net.au with ESMTP; 31 Mar 2006 07:01:57 +0800
X-BrightmailFiltered: true
X-Brightmail-Tracker: AAAAAA==
X-IronPort-AV: i="4.03,148,1141574400"; 
   d="scan'208"; a="680392528:sNHT13889276"
Received: from pepper.endbracket.net (pepper.endbracket.net [192.168.1.7])
	by mail.endbracket.net (Postfix) with ESMTP id BBC55369D9
	for <zsh-users@sunsite.dk>; Fri, 31 Mar 2006 10:01:54 +1100 (EST)
Subject: nomatch/cshnullglob problems
From: Michael Wardle <michael@endbracket.net>
To: zsh-users@sunsite.dk
Content-Type: text/plain
Date: Fri, 31 Mar 2006 10:02:09 +1100
Message-Id: <1143759729.5240.19.camel@pepper.endbracket.net.endbracket.net>
Mime-Version: 1.0
X-Mailer: Evolution 2.6.0 
Content-Transfer-Encoding: 7bit

Hi

There's a couple of things about the NO_MATCH and CSH_NULL_GLOB options
that have surprised me.

It seems that sometimes, CSH_NULL_GLOB causes an error even if some of
the file names in the list match.  It also seems that such an error is
fatal when using "source" or "." (dot).

If I create a script called "globtest" with the following contents,
-----
#!/bin/zsh

setopt cshnullglob
unsetopt nomatch
echo start
for dir
in /opt/*/bin /usr/X11R6/bin /usr/kerberos/bin /usr/posix/bin /usr/gnu/bin /usr/local/bin "$HOME"/bin
do
    test -d "$dir" && echo "$dir"
done
echo finish
-----

set it executable, then run "./globtest", I get the following output:
-----
start
globtest:6: no match
finish
-----

According to the manual:
	CSH_NULL_GLOB <C>
		If a pattern for filename generation has no matches, delete the
pattern
		from the argument list; do not report an error unless all the patterns
in
		a command have no matches.  Overrides NOMATCH.

I this case, I would expect the output to be the same as when the third
line is changed to "unsetopt cshnullglob":
-----
start
/usr/X11R6/bin
/usr/local/bin
/home/michael/bin
finish
-----

since the non-matching "/opt/*/bin" should be removed from the list,
leaving /usr/X11R6/bin /usr/kerberos/bin, etc., and no error should be
reported.

The same directory list containing the /opt/*/bin wildcard seems to work
fine in tcsh, which the CSH_NULL_GLOB option should be emulating.

If the option only comes into effect if there are multiple wildcards
(globbing characters) in the same list, then what is its use, and how
can I get the result I want?

Further, if I run ". globtest", I get the following output:
-----
start
globtest:6: no match
-----

which suggests that the "." command terminates as soon as an error is
encountered.

If I add a "set -o | grep err", I can see that neither ERR_EXIT nor
ERR_RETURN are set, so I would have expected the sourcing of the script
to complete and print "finish" like when it's run as a script.  (The
same script does complete and print "finish" when sourcing the script in
bash.)

I'm running zsh 4.2.5 on Ubuntu Linux.

Is this a bug or the expected behavior?

Thanks

Michael

