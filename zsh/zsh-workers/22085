From zsh-workers-return-22085-mason-zsh=primenet.com.au@sunsite.dk Thu Dec 15 14:42:37 2005
Return-Path: <zsh-workers-return-22085-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26011 invoked from network); 15 Dec 2005 14:42:34 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 15 Dec 2005 14:42:34 -0000
Received: (qmail 29254 invoked from network); 15 Dec 2005 14:42:28 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 15 Dec 2005 14:42:28 -0000
Received: (qmail 10936 invoked by alias); 15 Dec 2005 14:42:26 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22085
Received: (qmail 10927 invoked from network); 15 Dec 2005 14:42:26 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 15 Dec 2005 14:42:26 -0000
Received: (qmail 28987 invoked from network); 15 Dec 2005 14:42:26 -0000
Received: from cluster-d.mailcontrol.com (HELO rly28d.srv.mailcontrol.com) (217.69.20.190)
  by a.mx.sunsite.dk with SMTP; 15 Dec 2005 14:42:24 -0000
Received: from exchange03.csr.com (uuk202166.uk.customer.alter.net [62.189.241.194] (may be forged))
	by rly28d.srv.mailcontrol.com (MailControl) with ESMTP id jBFEgKCT006279
	for <zsh-workers@sunsite.dk>; Thu, 15 Dec 2005 14:42:21 GMT
Received: from news01 ([10.103.143.38]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Thu, 15 Dec 2005 14:42:19 +0000
Date: Thu, 15 Dec 2005 14:42:13 +0000
From: Peter Stephenson <pws@csr.com>
To: zsh-workers@sunsite.dk
Subject: Re: PATCH: multibyte FAQ
Message-Id: <20051215144213.0297729f.pws@csr.com>
In-Reply-To: <20051214184127.6bf8df9e.pws@csr.com>
References: <200512141831.jBEIV3qQ028002@news01.csr.com>
	<20051214184127.6bf8df9e.pws@csr.com>
Organization: Cambridge Silicon Radio
X-Mailer: Sylpheed version 0.9.12 (GTK+ 1.2.10; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 15 Dec 2005 14:42:19.0857 (UTC) FILETIME=[C0809C10:01C60185]
X-Scanned-By: MailControl A-05-40-01 (www.mailcontrol.com) on 10.68.0.138

Peter Stephenson <pws@csr.com> wrote:
> Peter Stephenson <pws@csr.com> wrote:
> > +and to work when configured with --enable-multibyte on:
> > +
> > +  - Solaris 8 and later
> 
> Hmm... not convinced any more.

This is still the case, but I've got slightly more idea about why behaviour
was poor with --multibyte-enable without assuming wchar_t was UCS-4.
We don't include langinfo.h if MULTIBYTE_SUPPORT is defined, which means
CODESET isn't defined, which means we don't use iconv.  (We had a report
about this a while back, I think from Zvi.)

It doesn't seem worth trying too hard to work out if we don't need
langinfo.h.  I'll apply the following patch and following Oliver's
suggestion back off the other one.

I'm still not getting the resulting multibyte strings handled properly in
Solaris.  I don't know why not or whether they should.  I had a vague
feeling this was basically working...

Index: Src/system.h
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/system.h,v
retrieving revision 1.35
diff -u -r1.35 system.h
--- Src/system.h	28 Oct 2005 17:34:33 -0000	1.35
+++ Src/system.h	15 Dec 2005 14:29:43 -0000
@@ -703,11 +703,10 @@
  */
 # include <wchar.h>
 # include <wctype.h>
-#else
-# ifdef HAVE_LANGINFO_H
-#   include <langinfo.h>
-#   ifdef HAVE_ICONV
-#     include <iconv.h>
-#   endif
-# endif
+#endif
+#ifdef HAVE_LANGINFO_H
+#  include <langinfo.h>
+#  ifdef HAVE_ICONV
+#    include <iconv.h>
+#  endif
 #endif

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


This message has been scanned for viruses by BlackSpider MailControl - www.blackspider.com

