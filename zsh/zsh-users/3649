From zsh-users-return-3649-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 28 16:41:15 2001
Return-Path: <zsh-users-return-3649-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18111 invoked from network); 28 Feb 2001 16:41:13 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 28 Feb 2001 16:41:13 -0000
Received: (qmail 4475 invoked by alias); 28 Feb 2001 16:41:01 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 3649
Received: (qmail 4460 invoked from network); 28 Feb 2001 16:41:00 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010228164026.ZM7578@candle.brasslantern.com>
Date: Wed, 28 Feb 2001 16:40:26 +0000
In-Reply-To: <20010228085313.D18441@oakt.mkt.tosco.com>
Comments: In reply to Paul Ackersviller <paulda@alumni.uwo.ca>
        "A few problems with 4.0.1-pre-1" (Feb 28,  8:53am)
References: <20010228085313.D18441@oakt.mkt.tosco.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Paul Ackersviller <paulda@alumni.uwo.ca>, zsh-users@sunsite.dk
Subject: PATCH: Re: A few problems with 4.0.1-pre-1
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Feb 28,  8:53am, Paul Ackersviller wrote:
} Subject: A few problems with 4.0.1-pre-1
}
} > setopt localoptions $_comp_options
} > 
} The fix is simply to put back unsetopt ksharrays.  Even though
} $_comp_options has noksharrays in it, the fact that it's inside of a
} csh-style array is trouble for someone such as myself who is setting
} ksharrays earlier.

That's not the problem, the problem is that $_comp_options is a zsh-style
array "dereference".  The patch below should fix it.

} My second problem is that in vi editting mode, after I type Escape,
} then / to search through history, all I get is this error:
} _history_complete_word_gen_matches:21: bad output format specification

This is also a ksharrays problem.

} I don't even see where this function is coming from, so can someone
} enlighten me on this?

It's because of this line at the top of _history_complete_word:

#compdef -K _history-complete-older complete-word \e/

This causes ESC / to be bound to history completion.  This is designed
to be done in "bindkey -e" mode, but you must have "bindkey -v" before
"compinit" in your startup files, so the keys get bound that way in vi
mode.  Hence you aren't even in history search mode yet when the first
thing you type after ESC is a slash.

} Lastly, the Makefile is not working for me in Doc.  The output is below,
} and I see that there's no $target created.  It appears ': yodl' should
} be something else, can anyone tell me what?

You need to install yodl in order to build the docs from the cvs source.

The use of ": yodl" (when yodl is not installed) followed by "test -f"
is so that the install works correctly when building from the distrib
tarballs, which have the doc files already compiled and hence don't need
yodl.

Here's the patch.


Index: ChangeLog
===================================================================
--- ChangeLog	2001/02/26 17:11:17	1.172
+++ ChangeLog	2001/02/27 17:42:18
@@ -13,6 +13,12 @@
 	
 	* 13530: Src/hist.c: properly restore noaliases in bufferwords()
 	
+2001-02-22  Peter Stephenson  <pws@csr.com>
+
+	* 13520: Completion/Builtin/_vars_eq: use $service to decide
+	on service; shorten description to avoid dreaded 80-character
+	redisplay bug.
+
 2001-02-20  Sven Wischnowsky  <wischnow@zsh.org>
 
 	* 13509: Src/jobs.c: more (|un)queue_signals(), this time for the
Index: Completion/Commands/_bash_completions
===================================================================
--- Completion/Commands/_bash_completions	2000/10/22 03:08:48	1.9
+++ Completion/Commands/_bash_completions	2001/02/28 16:28:56
@@ -25,7 +25,7 @@
 # that will not have been overridden, so you should add '~' to the
 # list of keys at the top of the for-loop.
 
-setopt localoptions $_comp_options
+setopt localoptions ${_comp_options[@]}
 
 local key=$KEYS[-1] expl
 
Index: Completion/Commands/_complete_debug
===================================================================
--- Completion/Commands/_complete_debug	2000/10/22 03:08:48	1.12
+++ Completion/Commands/_complete_debug	2001/02/28 16:29:30
@@ -1,6 +1,6 @@
 #compdef -k complete-word \C-x?
 
-setopt localoptions $_comp_options
+setopt localoptions ${_comp_options[@]}
 
 setopt localtraps noerrexit ; trap - ZERR
 
Index: Completion/Commands/_complete_help
===================================================================
--- Completion/Commands/_complete_help	2000/10/22 03:08:48	1.15
+++ Completion/Commands/_complete_help	2001/02/28 16:29:33
@@ -1,7 +1,7 @@
 #compdef -k complete-word \C-xh
 
 _complete_help() {
-  setopt localoptions $_comp_options
+  setopt localoptions ${_comp_options[@]}
 
   exec </dev/null	# ZLE closes stdin, which can cause errors
 
Index: Completion/Commands/_correct_word
===================================================================
--- Completion/Commands/_correct_word	2000/10/22 03:08:48	1.12
+++ Completion/Commands/_correct_word	2001/02/28 16:29:35
@@ -7,7 +7,7 @@
 # If configurations keys with the prefix `correctword_' are
 # given they override those starting with `correct_'.
 
-setopt localoptions $_comp_options
+setopt localoptions ${_comp_options[@]}
 
 local curcontext="$curcontext"
 
Index: Completion/Commands/_expand_word
===================================================================
--- Completion/Commands/_expand_word	2000/10/22 03:08:48	1.15
+++ Completion/Commands/_expand_word	2001/02/28 16:29:37
@@ -2,7 +2,7 @@
 
 # Simple completion front-end implementing expansion.
 
-setopt localoptions $_comp_options
+setopt localoptions ${_comp_options[@]}
 
 local curcontext="$curcontext"
 
Index: Completion/Commands/_history_complete_word
===================================================================
--- Completion/Commands/_history_complete_word	2000/10/22 03:08:48	1.23
+++ Completion/Commands/_history_complete_word	2001/02/28 16:27:39
@@ -16,7 +16,7 @@
 #   range -- range of history words to complete
 
 _history_complete_word () {
-  setopt localoptions $_comp_options
+  setopt localoptions ${_comp_options[@]}
 
   local expl direction stop curcontext="$curcontext"
   local max slice hmax=$#historywords
Index: Completion/Commands/_next_tags
===================================================================
--- Completion/Commands/_next_tags	2000/10/22 03:08:48	1.15
+++ Completion/Commands/_next_tags	2001/02/28 16:29:43
@@ -3,7 +3,7 @@
 # Main widget.
 
 _next_tags() {
-  setopt localoptions $_comp_options
+  setopt localoptions ${_comp_options[@]}
 
   local ins ops="$PREFIX$SUFFIX"
 
Index: Completion/Core/_main_complete
===================================================================
--- Completion/Commands/_main_complete	2000/10/22 03:08:48	1.80
+++ Completion/Commands/_main_complete	2001/02/28 16:22:20
@@ -16,7 +16,7 @@
 # which makes the output of setopt and unsetopt reflect a different
 # state than the global one for which you are completing.
 
-setopt localoptions $_comp_options
+setopt localoptions ${_comp_options[@]}
 
 exec </dev/null	# ZLE closes stdin, which can cause errors
 

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

