From hzoli@cs.elte.hu Tue Mar 26 11:17:50 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3) with ESMTP id LAA27846 for <mason@werple.mira.net.au>; Tue, 26 Mar 1996 11:17:45 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id TAA10283; Mon, 25 Mar 1996 19:04:33 -0500 (EST)
Resent-Date: Mon, 25 Mar 1996 19:04:33 -0500 (EST)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199603260003.BAA00586@bolyai.cs.elte.hu>
Subject: Re: hzoli13 another bug ?
To: hzoli@cs.elte.hu (Zoltan Hidvegi)
Date: Tue, 26 Mar 1996 01:02:41 +0100 (MET)
In-Reply-To: <199603251250.NAA01730@bolyai.cs.elte.hu> from Zoltan Hidvegi at "Mar 25, 96 01:50:44 pm"
Organization: Dept. of Comp. Sci., Eotvos University, Budapest, Hungary
Phone: (36 1)2669833 ext: 2667, home phone: (36 1) 2752368
X-Mailer: ELM [version 2.4ME+ PL11 (25)]
MIME-Version: 1.0
Content-Type: application/pgp; format=text; x-action=sign
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"t2zOT2.0.bW2.HIpLn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/856
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 1884
Status: OR

-----BEGIN PGP SIGNED MESSAGE-----

> A patch in art. 637 from Zefram broke this.  It tried to fix a bug when an
> assignment like wibble=$(false) did not set $?.  Everyone who applied the
> patch in art. 637 (i.e. everyone using beta13-hzoli13) should also apply
> the patch below.

Unfortunately my fix broke what Zefram originally wanted to fix.  Please
apply the patch below after my previous patch.  This should really fix
all problems related to $?.

Bye,

Zoltan

 *** Src/exec.c	1996/03/25 23:37:56	1.14
 --- Src/exec.c	1996/03/25 23:46:28
 ***************
 *** 1174,1184 ****
   	    } else
   		addlinknode(args, dupstring(nullcmd));
   	} else {
   	    addvars(cmd->vars, 0);
   	    if(errflag)
   		lastval = errflag;
   	    else
 ! 		lastval = 0;
   	    if (isset(XTRACE)) {
   		fputc('\n', stderr);
   		fflush(stderr);
 --- 1174,1185 ----
   	    } else
   		addlinknode(args, dupstring(nullcmd));
   	} else {
 + 	    cmdoutval = 0;
   	    addvars(cmd->vars, 0);
   	    if(errflag)
   		lastval = errflag;
   	    else
 ! 		lastval = cmdoutval;
   	    if (isset(XTRACE)) {
   		fputc('\n', stderr);
   		fflush(stderr);
 ***************
 *** 1920,1925 ****
 --- 1921,1927 ----
   	return NULL;
       mpipe(pipes);
       child_block();
 +     cmdoutval = 0;
       if ((cmdoutpid = pid = zfork()) == -1) {
   	/* fork error */
   	popheap();
 ***************
 *** 1937,1943 ****
   	retval = readoutput(pipes[0], qt);
   	child_suspend(0);		/* unblocks */
   	lastval = cmdoutval;
 - 	cmdoutval = 0;
   	return retval;
       }
   
 --- 1939,1944 ----

-----BEGIN PGP SIGNATURE-----
Version: 2.6.3i
Charset: noconv

iQCVAwUBMVc0GQupSCiLN749AQHRKwP/cBgMBteAP5QgvaS6TZiGMIZ8VzFy8jh9
juJA1Fu+f6RqBCmmkeC/sWC1D9HYrKV8wwIo3ytfv/JZOA0vDW8SBPO0YFGbBOwu
uRXAg2VVOvlwO1XBeRftM1mAu5u4nJq287snm69DeP6xneSg/vVQzQqW+5jhfD90
h0z66DedNN0=
=ulyt
-----END PGP SIGNATURE-----


