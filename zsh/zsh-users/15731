From zsh-users-return-15731-mason-zsh=primenet.com.au@zsh.org Tue Jan 25 16:22:26 2011
Return-Path: <zsh-users-return-15731-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29742 invoked by alias); 25 Jan 2011 16:22:26 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15731
Received: (qmail 15352 invoked from network); 25 Jan 2011 16:22:15 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.7 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FROM,RCVD_IN_DNSWL_LOW autolearn=ham
	version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.216.178 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:in-reply-to:references:date
         :message-id:subject:from:to:cc:content-type;
        bh=NMl+nc1tFAvHVFwoTc4GBaqMSaHaV//jQxU1Y8LsxHA=;
        b=xiGimjcgJA04rYVbQwU+QNjTrepI2fh0p2W6UoDWkwBNBjWg6pp6xG0v0wz/899fJ9
         U9QO5rAGUasyp6ooq+YdxMyEI9FpfnKNEaQYd2ytlrRe0e70vJINVh/ri3UONRSXGKIF
         5RIHOAyILOHqNJPVZjBdIr7UTCo7oLVrro7rM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :cc:content-type;
        b=aEUdFlEKMTLB+q28y0W1I9+gAtEp7NvR/IkSJxIFqrKHsXIvkyq5nHi2KT5VRVjFf2
         5GYmu4IG+EBwSrJAUyvIqj2ZRb6LpFPDxX5KtiM3iQxPGS5j4eND3NFx1048BPEDcumG
         xR1xSyfTBqcttAsBuk0iPqDYFxgWySWHv/TQA=
MIME-Version: 1.0
In-Reply-To: <44CE36D4-9044-4148-BDCE-636D85AC003B@cl.cam.ac.uk>
References: <44CE36D4-9044-4148-BDCE-636D85AC003B@cl.cam.ac.uk>
Date: Tue, 25 Jan 2011 17:22:09 +0100
Message-ID: <AANLkTi==AFonoqW8xjRMtzROxsNdPNx4e8k=7Wt8zXUd@mail.gmail.com>
Subject: Re: Absolute pathnames similar to expand-cmd-path
From: Mikael Magnusson <mikachu@gmail.com>
To: David Evans <david.evans@cl.cam.ac.uk>
Cc: zsh-users@zsh.org
Content-Type: text/plain; charset=UTF-8

On 25 January 2011 16:56, David Evans <david.evans@cl.cam.ac.uk> wrote:
> expand-cmd-path is a great widget. Is there a similar thing for turning the current word
> into an absolute path? Sometimes I'm typing a ../../.. chain and would like to see how far
> I've gone. This should be easy with a widget function and :a but I don't want to write it
> if even less work is needed.

I have this lying around. It shouldn't be too hard to modify it to do
what you want.

autoload -U split-shell-arguments

function _split_shell_arguments_under()
{
  local -a reply
  split-shell-arguments
  #have to duplicate some of modify-current-argument to get the word
  #_under_ the cursor, not after.
  setopt localoptions noksharrays multibyte
  if (( REPLY > 1 )); then
    if (( REPLY & 1 )); then
      (( REPLY-- ))
    fi
  fi
  REPLY=${reply[$REPLY]}
}

function _showcurrargrealpath() {
  setopt localoptions nonomatch
  local REPLY REALPATH
  _split_shell_arguments_under
  #zle -M "$(realpath ${(Q)${~REPLY}} 2> /dev/null | head -n1 || echo
1>&2 "No such path")"
  REALPATH=( ${(Q)${~REPLY}}(:A) )
  zle -M "${REALPATH:-Path not found: $REPLY}"
}


-- 
Mikael Magnusson

