From zsh-workers-return-23474-mason-zsh=primenet.com.au@sunsite.dk Sun May 27 14:31:01 2007
Return-Path: <zsh-workers-return-23474-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25504 invoked from network); 27 May 2007 14:31:00 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.0 (2007-05-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=no
	version=3.2.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 27 May 2007 14:31:00 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 52335 invoked from network); 27 May 2007 14:30:52 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 27 May 2007 14:30:52 -0000
Received: (qmail 20444 invoked by alias); 27 May 2007 14:30:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23474
Received: (qmail 20435 invoked from network); 27 May 2007 14:30:48 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 27 May 2007 14:30:48 -0000
Received: (qmail 51989 invoked from network); 27 May 2007 14:30:48 -0000
Received: from acolyte.scowler.net (216.254.112.45)
  by a.mx.sunsite.dk with SMTP; 27 May 2007 14:30:44 -0000
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id F359A5C284; Sun, 27 May 2007 10:30:42 -0400 (EDT)
Date: Sun, 27 May 2007 10:30:42 -0400
From: Clint Adams <clint@zsh.org>
To: Lasse Kliemann <lasse-list-zsh-workers-2007@mail.plastictree.net>
Cc: zsh-workers@sunsite.dk
Subject: Re: Bug report: count undeclared in utils.c
Message-ID: <20070527143042.GA2437@scowler.net>
Mail-Followup-To: Lasse Kliemann <lasse-list-zsh-workers-2007@mail.plastictree.net>,
	zsh-workers@sunsite.dk
References: <20070527115223.GD3500@enterprise.starfleet>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20070527115223.GD3500@enterprise.starfleet>
User-Agent: Mutt/1.5.13 (2006-08-11)

> Compiling zsh 4.3.4 on OpenBSD, I get:
> 
> utils.c: In function `getkeystring':
> utils.c:4746: error: `count' undeclared (first use in this function)
> utils.c:4746: error: (Each undeclared identifier is reported only once
> utils.c:4746: error: for each function it appears in.)
> 
> Having a look at the source utils.c, I suspect that `count' is really 
> undeclared in case that 
> 
> - `HAVE_NL_LANGINFO' and `CODESET' are defined,
> - and `HAVE_ICONV' is not defined,
> - and one of the following is also not defined: `HAVE_WCHAR_H', 
>   `HAVE_WCTOMB', `__STDC_ISO_10646__'.
> 
> Maybe this is a rare configuration that only occurs on OpenBSD.

Builds and passes 'make check' for me on OpenBSD 3.5.  GNU iconv is in
/usr/local but I didn't tell configure to find it there.

config.h lines:

#define HAVE_NL_LANGINFO 1
/* #undef HAVE_ICONV */
/* #undef HAVE_WCHAR_H */
#define HAVE_WCTOMB 1


wchar_t and wctomb are defined in stdlib.h; there is no wchar.h.
__STDC_ISO_10646__ does not appear to be defined anywhere.

