From zsh-workers-return-18956-mason-zsh=primenet.com.au@sunsite.dk Thu Aug 21 12:39:28 2003
Return-Path: <zsh-workers-return-18956-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1291 invoked from network); 21 Aug 2003 12:39:27 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 21 Aug 2003 12:39:27 -0000
Received: (qmail 569 invoked by alias); 21 Aug 2003 12:39:21 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18956
Received: (qmail 557 invoked from network); 21 Aug 2003 12:39:21 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 21 Aug 2003 12:39:21 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [193.109.254.211] by sunsite.dk (MessageWall 1.0.8) with SMTP; 21 Aug 2003 12:39:21 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-13.tower-36.messagelabs.com!1061469559!87386
X-StarScan-Version: 5.0.7; banners=-,-,-
Received: (qmail 21976 invoked from network); 21 Aug 2003 12:39:19 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-13.tower-36.messagelabs.com with SMTP; 21 Aug 2003 12:39:19 -0000
Received: from gmcs3.local ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id h7LCdIHM030019
	for <zsh-workers@sunsite.dk>; Thu, 21 Aug 2003 13:39:19 +0100
Received: from gmcs3.local (localhost [127.0.0.1])
	by gmcs3.local (8.11.6/8.11.6/SuSE Linux 0.5) with ESMTP id h7LCf4R01776
	for <zsh-workers@sunsite.dk>; Thu, 21 Aug 2003 14:41:04 +0200
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
From: Oliver Kiddle <okiddle@yahoo.co.uk>
To: Zsh workers <zsh-workers@sunsite.dk>
Subject: PATCH: _a2ps update
Date: Thu, 21 Aug 2003 14:41:03 +0200
Message-ID: <1774.1061469663@gmcs3.local>

It was bothering me that the languages (style sheets) weren't being
completed. This is still far from perfect.

The _arguments --help parsing stuff seems to have a few problems. If I
added a description for options it picked up, they are matched twice.
It would probably be better if that functionality was extracted out
from _arguments and done by a separate wrapper function. Might also
free up `--' to be used to separate options from option specifications.

Oliver

Index: Completion/Unix/Command/_a2ps
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_a2ps,v
retrieving revision 1.1
diff -u -r1.1 _a2ps
--- Completion/Unix/Command/_a2ps	2 Apr 2001 11:44:39 -0000	1.1
+++ Completion/Unix/Command/_a2ps	21 Aug 2003 12:20:18 -0000
@@ -2,38 +2,52 @@
 
 # This is for the GNU version of a2ps.
 
-if [[ "$words[1]" != "$_a2ps_cache_cmd" ]]; then
+if [[ "$words[1]" != "$_cache_a2ps_cmd" ]]; then
   local descr
 
-  _a2ps_cache_cmd="$words[1]"
+  _cache_a2ps_cmd="$words[1]"
 
   descr=( "${(@)${(f@)$(_call_program features LC_ALL=C $words[1] --list=features)//
  /	}:#}" )
 
-  _a2ps_cache_values=(
-      "${descr[(r)Known [Ss]tyle [Ss]heets*]#*	}"
-      "${descr[(r)Known [Ee]ncodings*]#*	}"
-      "${descr[(r)Known [Mm]edia*]#*	}"
-      "${descr[(r)Known [Pp]rologues*]#*	}"
-      "${descr[(r)Known PostScript Printer Descriptions*]#*	}"
-      "${descr[(r)Known [Oo]utput [Dd]estination*]#*	}"
-      "${descr[(r)Known [Uu]ser [Oo]ptions*]#*	}"
-      "${descr[(r)Known Variables*]#*	}"
+  _cache_a2ps_values=(
+    "${descr[(r)Known [Ss]tyle [Ss]heets*]#*	}"
+    "${descr[(r)Known [Ee]ncodings*]#*	}"
+    "${descr[(r)Known [Mm]edia*]#*	}"
+    "${descr[(r)Known [Pp]rologues*]#*	}"
+    "${descr[(r)Known PostScript Printer Descriptions*]#*	}"
+    "${descr[(r)Known [Oo]utputs*]#*	}"
+    "${descr[(r)Known [Uu]ser [Oo]ptions*]#*	}"
+    "${descr[(r)Known Variables*]#*	}"
   )
 fi
 
-_arguments '*:input file:_files' -- \
-           '*\*:toggle:(yes no)' \
-           '*=DIRECTION:direction:(rows columns)' \
-           '*=TYPE:type:(r n nr rn any)' \
-	   '--highlight-level*:highlight:(none normal heavy)' \
-	   '--version-control*:version control:(none off t numbered nil 
-		                                existing never simple)' \
-	   "--pretty-print*::style:(${_a2ps_cache_values[1]})" \
-	   "--encoding*:encoding:(${_a2ps_cache_values[2]})" \
-	   "--medium*::medium:(${_a2ps_cache_values[3]})" \
-	   "--prologue*::prologue:(${_a2ps_cache_values[4]})" \
-	   "--ppd*::printer description:(${_a2ps_cache_values[5]})" \
-	   "--printer*::printer:(${_a2ps_cache_values[6]})" \
-	   "--user-option*::user option:(${_a2ps_cache_values[7]})" \
-	   "--variable*::variable:(${_a2ps_cache_values[8]})"
+_arguments \
+  '(-E --pretty-print=)'{-E-,--pretty-print=}"[enable pretty-printing]::language:(${_cache_a2ps_values[1]})" \
+  \*{-D+,--define=}"[set or unset variable]:variable:(${_cache_a2ps_values[8]})" \
+  '(-d -P --printer)'{-P,--printer=}"[send output to printer]:printer:(${_cache_a2ps_values[6]})" \
+  '(-A --file-align)'{-A,--file-align=}'[specify alignment of separate files]:mode:(virtual rank page sheet)' \
+  '(-a --pages)'{-a-,--pages=}'[select pages to print]:page range' \
+  '(-q --quiet --silent -v --verbose)'{-q,--quiet,--silent}'[quiet output]' \
+  '(-q --quiet --silent -v --verbose)'{-v-,--verbose=}'[verbose output]:level' \
+  '(-b --header)'{-b-,--header=}'[set the page header]:text' \
+  '(-g)--highlight-level=:highlight:(none normal heavy)' \
+  '--list=:topic:(features delegations encodings media prologues printers style-sheets user-options variables)' \
+  "--user-option=:user option:(${_cache_a2ps_values[7]})" \
+  {-M,--medium=}":medium:(${_cache_a2ps_values[3]})" \
+  "--ppd=::printer description:(${_cache_a2ps_values[5]})" \
+  '--statusdict=:statusdict definition' \
+  '--setpagedevice=:page device definition' \
+  '--margin=:margin size (PostScript points)' \
+  '--toc=:format' \
+  --{{center,left,right}-title.underlay,{,left-,right-}footer}'=:text' \
+  '*:input file:_files' -- \
+  '*\*:toggle:(yes no)' \
+  '*=DIRECTION:direction:(rows columns)' \
+  '*=TYPE:type:((r\:CR mac\:CR unix\:LF n\:LF nr\:LFCR rn\:CRLF pc\:CRLF any auto))' \
+  '--version-control*:version control:(none off t numbered nil existing never simple)' \
+  '--strip-level*:strip level:((0\:everything\ is\ printed 1\:regular\ comments\ are\ not\ printed 2\:strong\ comments\ are\ not\ printed 3\:no\ comment\ is\ printed))' \
+  '--sides=*:mode:(simplex duplex tumble)' \
+  '--non-printable-format*:format:(caret space question-mark octal hexa emacs)' \
+  "--encoding*:encoding:(${_cache_a2ps_values[2]})" \
+  "--prologue*::prologue:(${_cache_a2ps_values[4]})"

