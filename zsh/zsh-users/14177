From zsh-users-return-14177-mason-zsh=primenet.com.au@sunsite.dk Tue May 26 11:13:57 2009
Return-Path: <zsh-users-return-14177-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2902 invoked from network); 26 May 2009 11:13:45 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 26 May 2009 11:13:45 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 83691 invoked from network); 26 May 2009 11:13:30 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 26 May 2009 11:13:30 -0000
Received: (qmail 24842 invoked by alias); 26 May 2009 11:13:08 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 14177
Received: (qmail 24822 invoked from network); 26 May 2009 11:13:08 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 26 May 2009 11:13:08 -0000
Received: from biskalar.biskalar.de (sesamstrafe.de [213.133.108.195])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id BD01D8027106
	for <zsh-users@sunsite.dk>; Tue, 26 May 2009 13:13:04 +0200 (CEST)
Received: from [192.124.26.250] (helo=ranga.kyb.local)
	by biskalar.biskalar.de with esmtpsa (TLS-1.0:RSA_AES_128_CBC_SHA:16)
	(Exim 4.50)
	id 1M8uad-0005lR-7V; Tue, 26 May 2009 13:13:03 +0200
Cc: zsh-users@sunsite.dk
Message-Id: <154941E5-F5C5-4B9E-97E1-17EFABF9CDC8@biskalar.de>
From: Sebastian Stark <seb-zsh@biskalar.de>
To: Wayne Davison <wayned@users.sourceforge.net>
In-Reply-To: <20090524222632.GC26513@blorf.net>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v935.3)
Subject: Re: updating the shell environment in screen (was Re: prompt and ssh)
Date: Tue, 26 May 2009 13:13:02 +0200
References: <e7db6e960905190954j7be72739p6b521bca8e90fe7f@mail.gmail.com> <20090519200217.35368.qmail@smasher.org> <20090521074103.GN27141@prunille.vinc17.org> <20090524222632.GC26513@blorf.net>
X-Mailer: Apple Mail (2.935.3)
X-Virus-Scanned: ClamAV 0.94.2/9393/Tue May 26 12:17:55 2009 on bifrost
X-Virus-Status: Clean


On 25.05.2009, at 00:26, Wayne Davison wrote:

> On Thu, May 21, 2009 at 09:41:03AM +0200, Vincent Lefevre wrote:
>> 3. Later, log on the machine directly (without ssh) and recall the
>>   screen session. SSH_CONNECTION is still set (as the environment
>>   doesn't change in the recalled shell)
>
> Here's what I do to ensure that my screen sessions always have updated
> environment info:
>
> In my ~/.zshrc file:
>
> alias scr=' ~/bin/update_screenenv; screen -R -d -i'
> function preexec {
>    [ -e ~/.screenenv ] && . ~/.screenenv
>    # ... among other things ...
> }
>
> The ~/bin/update_screenenv script:
>
> #!/bin/zsh
> for var in SSH_AUTH_SOCK SSH_AGENT_PID DISPLAY WINDOWID SSH_TTY  
> SSH_CLIENT SSH_CONNECTION SESSION_MANAGER; do
>    if [[ -n "${(P)var}" ]]; then
> 	echo "export $var='${(P)var}'"
>    else
> 	echo "unset $var"
>    fi
> done >~/.screenenv
>
> What this does for me is to update the ~/.screenenv file every time I
> connect to my screen session (which I always do via my 'scr' alias).
> Since my shells all source the ~/.screenenv file before every command,
> the environment stays updated with the info from the latest parent  
> shell
> that connected to screen.

What happens if you do not use screen? .screenenv is still sourced  
before every command. Doesn't this lead to confusion? How do you  
detect that you're inside screen?

For the latter I think something like "if [[ $TERM == screen-bce ]]"  
would be okay, but far from perfect.


Sebastian

