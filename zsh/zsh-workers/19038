From zsh-workers-return-19038-mason-zsh=primenet.com.au@sunsite.dk Sun Sep 07 04:07:13 2003
Return-Path: <zsh-workers-return-19038-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18403 invoked from network); 7 Sep 2003 04:07:12 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 7 Sep 2003 04:07:12 -0000
Received: (qmail 8878 invoked by alias); 7 Sep 2003 04:07:06 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19038
Received: (qmail 8868 invoked from network); 7 Sep 2003 04:07:06 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 7 Sep 2003 04:07:06 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [207.172.4.62] by sunsite.dk (MessageWall 1.0.8) with SMTP; 7 Sep 2003 4:7:5 -0000
Received: from 65-78-17-226.c3-0.nwt-ubr2.sbo-nwt.ma.cable.rcn.com ([65.78.17.226] helo=zion.rcn.com)
	by smtp03.mrf.mail.rcn.net with esmtp (Exim 3.35 #4)
	id 19vqpM-0006oF-00; Sun, 07 Sep 2003 00:07:04 -0400
Received: by zion.rcn.com (Postfix, from userid 500)
	id 50A0E1E086; Sun,  7 Sep 2003 00:03:01 -0400 (EDT)
To: Bart Schaefer <schaefer@brasslantern.com>
Cc: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: PATCH: zsh/system library
References: <13496.1062496567@csr.com>
	<1030902151802.ZM17604@candle.brasslantern.com>
From: Vin Shelton <acs@alumni.princeton.edu>
Organization: EtherSoft, Inc
Date: Sun, 07 Sep 2003 00:03:01 -0400
In-Reply-To: <1030902151802.ZM17604@candle.brasslantern.com> (Bart
 Schaefer's message of "Tue, 2 Sep 2003 15:18:02 +0000")
Message-ID: <m3ad9hnt3e.fsf@zion.rcn.com>
Lines: 57
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

Bart Schaefer <schaefer@brasslantern.com> writes:

> On Sep 2, 10:56am, Peter Stephenson wrote:
> } Subject: Re: PATCH: zsh/system library
> }
> } sed -n -e 's/^#line[ 	].*\"\(.*\)\"/\2/p' \
> }        -e 's/^#[ 	].*\"\(.*\)\"/\2/p' |
> } 
> } should work.
>
> Except that those should be \1 instead of \2 in that formulation.

Here is the patch:

Index: ChangeLog
===================================================================
RCS file: /cvsroot/zsh/zsh/ChangeLog,v
retrieving revision 1.2089
diff -a -u -u -0 -r1.2089 ChangeLog
--- ChangeLog	3 Sep 2003 14:07:25 -0000	1.2089
+++ ChangeLog	7 Sep 2003 04:03:38 -0000
@@ -0,0 +1,4 @@
+2003-09-06  Vin Shelton  <acs@alumni.princeton.edu>
+
+	* zshconfig.ac: Make sed grok icc's cpp output.
+
Index: zshconfig.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/zshconfig.ac,v
retrieving revision 1.39
diff -a -u -r1.39 zshconfig.ac
--- zshconfig.ac	30 Aug 2003 19:16:22 -0000	1.39
+++ zshconfig.ac	7 Sep 2003 04:03:54 -0000
@@ -1081,7 +1081,8 @@
 dnl slashes rather than doubled backslashes in the path.
 echo "#include <signal.h>" > nametmp.c
 sigfile_list="`$CPP nametmp.c |
-sed -n 's/^#[ 	].*\"\(.*\)\"/\1/p' |
+sed -n -e 's/^#line[ 	].*\"\(.*\)\"/\1/p' \
+       -e 's/^#[ 	].*\"\(.*\)\"/\1/p' |
 sed 's/\\\\\\\\/\//g' |
 $AWK '{ if (\$1 ~ \"sig\") files[[\$1]] = \$1 }
   END { for (var in files) print var }'`"
@@ -1128,7 +1129,8 @@
 dnl slashes rather than doubled backslashes in the path.
 echo "#include <errno.h>" > nametmp.c
 errfile_list="`$CPP nametmp.c |
-sed -n 's/^#[ 	].*\"\(.*\)\"/\1/p' |
+sed -n -e 's/^#line[ 	].*\"\(.*\)\"/\1/p' \
+       -e 's/^#[ 	].*\"\(.*\)\"/\1/p' |
 sed 's/\\\\\\\\/\//g' |
 $AWK '{ if (\$1 ~ \"err\") files[[\$1]] = \$1 }
   END { for (var in files) print var }'`"


HTH,
 Vin

