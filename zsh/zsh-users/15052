From zsh-users-return-15052-mason-zsh=primenet.com.au@zsh.org Wed May 05 16:32:42 2010
Return-Path: <zsh-users-return-15052-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20988 invoked by alias); 5 May 2010 16:32:42 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15052
Received: (qmail 17580 invoked from network); 5 May 2010 16:32:40 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_NONE
	autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at sysctl.co.uk does not designate permitted sender hosts)
Subject: Re: Watcher script - please comment
Mime-Version: 1.0 (Apple Message framework v1147.1)
Content-Type: text/plain; charset=us-ascii
From: Matt Wright <matt@sysctl.co.uk>
In-Reply-To: <tkrat.d90ba1177c225a6b@igpm.rwth-aachen.de>
Date: Wed, 5 May 2010 08:27:36 -0700
Cc: zsh-users@zsh.org
Content-Transfer-Encoding: quoted-printable
Message-Id: <47130C0B-C664-4300-B4A3-505C43F67221@sysctl.co.uk>
References: <tkrat.d90ba1177c225a6b@igpm.rwth-aachen.de>
To: jarausch@igpm.rwth-aachen.de
X-Mailer: Apple Mail (2.1147.1)

I know it's dirty but I use this to check if my dotfiles git repository =
has new updates available. I wonder if you could adapt that.

#!/bin/zsh

# register a SIGUSR1 handler, this will let us catch a message from
# the spawned subshell below.
TRAPUSR1() {
	[[ -o zle ]] && zle -I
	echo "NOTE: A dotfiles update is available in git."
	# reset trap USR1 so we're not hogging it
	trap - USR1
}

# grab the current PID so we can signal ourselves, the &| at the end of =
the
# brackets cause us to disown the child so they don't print on our =
window.
PID=3D$$
(
	cd ~/.dotfiles

	# make sure we never ask for a password with this check
	export GIT_SSH=3D"${HOME}/.dotfiles/tools/quiet-ssh.sh"

	l=3D$(git rev-list master | head -1)
	r=3D$(git ls-remote origin heads/master | awk '{print $1}')
	if [[ "${r}" !=3D "$(git merge-base ${r} ${l} 2>/dev/null)" ]]; =
then
		# signal ourselves to write on the terminal
	  kill -USR1 $PID
	fi=20
) 2>/dev/null &|

On May 5, 2010, at 4:25 AM, Helmut Jarausch wrote:

> Hi,
>=20
> I'd like to start a "daemon" which notifies me if some file
> is no longer accessed (e.g. by rsync from a remote host).
>=20
> My simple minded solution is
>=20
> #!/bin/zsh
>=20
> while /bin/true; do
>  if ! fuser -s $1; then break; fi
>  sleep 5
> done
> notifier -1 -e5 -tREADY <<< $1
>=20
>=20
> where the file in question is passed as a parameter.
>=20
> Is there something builtin into ZSH which is more efficient / elegant.
>=20
> Many thanks for a hint,
> Helmut.
>=20
> --=20
> Helmut Jarausch
>=20
> Lehrstuhl fuer Numerische Mathematik
> RWTH - Aachen University
> D 52056 Aachen, Germany

