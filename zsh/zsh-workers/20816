From zsh-workers-return-20816-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 16 17:35:23 2005
Return-Path: <zsh-workers-return-20816-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12655 invoked from network); 16 Feb 2005 17:35:22 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Feb 2005 17:35:22 -0000
Received: (qmail 34927 invoked from network); 16 Feb 2005 17:35:17 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Feb 2005 17:35:17 -0000
Received: (qmail 24199 invoked by alias); 16 Feb 2005 17:35:11 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20816
Received: (qmail 24181 invoked from network); 16 Feb 2005 17:35:10 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 16 Feb 2005 17:35:10 -0000
Received: (qmail 34624 invoked from network); 16 Feb 2005 17:35:10 -0000
Received: from mailhost1.csr.com (HELO MAILSWEEPER01.csr.com) (81.105.217.43)
  by a.mx.sunsite.dk with SMTP; 16 Feb 2005 17:35:05 -0000
Received: from exchange03.csr.com (unverified [10.100.137.60]) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.12) with ESMTP id <T6f28a429190a6c8d013bc@MAILSWEEPER01.csr.com> for <zsh-workers@sunsite.dk>;
 Wed, 16 Feb 2005 17:33:36 +0000
Received: from news01.csr.com ([10.103.143.38]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Wed, 16 Feb 2005 17:35:42 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.1/8.12.11) with ESMTP id j1GHZ3wk022535
	for <zsh-workers@sunsite.dk>; Wed, 16 Feb 2005 17:35:03 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.1/8.13.1/Submit) with ESMTP id j1GHZ2wp022532
	for <zsh-workers@sunsite.dk>; Wed, 16 Feb 2005 17:35:02 GMT
Message-Id: <200502161735.j1GHZ2wp022532@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-workers@sunsite.dk
Subject: Re: limit on CVS does not work - please help 
In-reply-to: <20050216165312.C9FFEFEBFD@numa-i.igpm.rwth-aachen.de> 
References: <20050216165312.C9FFEFEBFD@numa-i.igpm.rwth-aachen.de>
Date: Wed, 16 Feb 2005 17:35:01 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 16 Feb 2005 17:35:42.0760 (UTC) FILETIME=[F05D2280:01C5144D]
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.5

Helmut Jarausch wrote:
> Hi,
> 
> having used ZSH for years now, I've encountered a problem
> when building ZSH (CVS 2005/01/29  - currently CVS is broken)
> on a new system with glibc-2.3.4 .

I've now got a new resource header too...

> Although the build looked perfectly normal,
> the 'limit' command doesn't work anymore.

...yep, they've really messed it about this time.  There are more
underscores and the entries are out of order.  Try this.

This will be required to build any version of zsh with this system.   It
ought to go on zsh-4_2-patches, too.

I've diffed it against the old local version owing to the unavailability
of CVS; I would think it's the same as Helmut's.

--- Src/Builtins/rlimits.awk.old	2005-02-16 17:27:41.000000000 +0000
+++ Src/Builtins/rlimits.awk	2005-02-16 17:29:57.272157640 +0000
@@ -6,7 +6,7 @@
 #
 BEGIN {limidx = 0}
 
-/^[\t ]*(#[\t ]*define[\t _]*RLIMIT_[A-Z_]*[\t ]*[0-9][0-9]*|RLIMIT_[A-Z_]*,[\t ]*|RLIMIT_[A-Z_]*[\t ]*=[\t ]*[0-9][0-9]*,[\t ]*)/ {
+/^[\t ]*(#[\t ]*define[\t _]*RLIMIT_[A-Z_]*[\t ]*[0-9][0-9]*|RLIMIT_[A-Z_]*,[\t ]*|_*RLIMIT_[A-Z_]*[\t ]*=[\t ]*[0-9][0-9]*,[\t ]*)/ {
     limindex = index($0, "RLIMIT_")
     limtail = substr($0, limindex, 80)
     split(limtail, tmp)
@@ -19,7 +19,11 @@
 	limnam = substr(limnam, 1, limindex-1)
     }
     if (limnum == "=") {
-	limnum = limidx++
+	if (tmp[3] ~ /^[0-9]/) {
+	    limnum = tmp[3] + 0
+	} else {
+	    limnum = limidx++
+	}
 	limindex = index($0, ",")
 	limnam = substr(limnam, 1, limindex-1)
     }
@@ -60,7 +64,7 @@
 /^[\t ]*RLIM_NLIMITS[\t ]*=[\t ]*RLIMIT_NLIMITS/ {
     if(!nlimits) { nlimits = limidx }
 }
-/^[\t ]*RLIM(IT)?_NLIMITS[\t ]*=[\t ]*[0-9][0-9]*/ {
+/^[\t _]*RLIM(IT)?_NLIMITS[\t ]*=[\t ]*[0-9][0-9]*/ {
     limindex = index($0, "=")
     limtail = substr($0, limindex, 80)
     split(limtail, tmp)

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

**********************************************************************

