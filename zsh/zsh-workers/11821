From zsh-workers-return-11821-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Jun 08 09:56:20 2000
Return-Path: <zsh-workers-return-11821-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12786 invoked from network); 8 Jun 2000 09:56:19 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 8 Jun 2000 09:56:19 -0000
Received: (qmail 20330 invoked by alias); 8 Jun 2000 09:56:09 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11821
Received: (qmail 20323 invoked from network); 8 Jun 2000 09:56:08 -0000
Date: Thu, 08 Jun 2000 10:55:38 +0100
From: Peter Stephenson <pws@cambridgesiliconradio.com>
Subject: Re: zsh changing cp1250 letters beyond recognition
In-reply-to: "Your message of Thu, 08 Jun 2000 10:51:15 BST."
 <0FVT001HKY1FC6@la-la.cambridgesiliconradio.com>
To: Jan Fedak <J.Fedak@sh.cvut.cz>,
 zsh-workers@sunsite.auc.dk (Zsh hackers list)
Message-id: <0FVT001IBY8QC6@la-la.cambridgesiliconradio.com>
Content-transfer-encoding: 7BIT

> There's a bug that characters in this range present on the command line
> don't get turned properly into zsh's internal representation.
>...
> I'll send a separate one
> for 3.0.8 (the fix is the same, but the context for the patch is
> different).

Here's the patch for 3.0.8.

--- Src/init.c.old	Thu Jun  8 10:33:34 2000
+++ Src/init.c	Thu Jun  8 10:35:22 2000
@@ -37,11 +37,23 @@
 main(int argc, char **argv)
 {
     char **t;
+    int t0;
 #ifdef USE_LOCALE
     setlocale(LC_ALL, "");
 #endif
 
     global_permalloc();
+
+    /*
+     * Provisionally set up the type table to allow metafication.
+     * This will be done properly when we have decided if we are
+     * interactive
+     */
+    typtab['\0'] |= IMETA;
+    typtab[STOUC(Meta)  ] |= IMETA;
+    typtab[STOUC(Marker)] |= IMETA;
+    for (t0 = (int)STOUC(Pound); t0 <= (int)STOUC(Nularg); t0++)
+	typtab[t0] |= ITOK | IMETA;
 
     for (t = argv; *t; *t = metafy(*t, -1, META_ALLOC), t++);
 

-- 
Peter Stephenson <pws@cambridgesiliconradio.com>
Cambridge Silicon Radio, Unit 300, Science Park, Milton Road,
Cambridge, CB4 0XL, UK                          Tel: +44 (0)1223 392070

