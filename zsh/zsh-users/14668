From zsh-users-return-14668-mason-zsh=primenet.com.au@zsh.org Sat Dec 19 22:39:25 2009
Return-Path: <zsh-users-return-14668-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21112 invoked by alias); 19 Dec 2009 22:39:25 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14668
Received: (qmail 28684 invoked from network); 19 Dec 2009 22:39:14 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.7 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received-SPF: pass (ns1.primenet.com.au: SPF record at gmx.de designates 213.165.64.20 as permitted sender)
X-Authenticated: #9006135
X-Provags-ID: V01U2FsdGVkX18ePds8W84eHcpoNXBNG3h7gArpFjE+sN3LDScleu
	AQZ/cGPxY4O+hs
Content-Type: text/plain; charset=UTF-8
Subject: suing zpty how to switch to interactive mode?
From: Marc Weber <marco-oweber@gmx.de>
To: zsh-users@zsh.org
Date: Sat, 19 Dec 2009 23:39:07 +0100
Message-Id: <1261259727-sup-9197@nixos>
User-Agent: Sup/git
Content-Transfer-Encoding: 8bit
X-Y-GMX-Trusted: 0
X-FuHaFi: 0.67

I already know pexpect or expect. However I wonder whether I can so some
simple tasks using zsh as well?

I have in mind logging in using ssh and changing directory, then switch
to interactive mode.

Eg this works:
{ echo "cd /tmp"; cat  } |  ssh user@host

However I can't get a terminal:

 scripts i%{ echo "cd /tmp"; cat  } |  ssh -t  user@host
Pseudo-terminal will not be allocated because stdin is not a terminal.


Can this be done using zpty ?

I got close:

zpty -b test /bin/sh
zpty -w test "cd /tmp"
# connect stdout
{ while :; do zpty -r test; done; }&
# connect stdin
zpty -w test

Then you can type pwd and you'll get /tmp as reply.

However basic stuff such as tab completion is not working..

What happens to stderr?

Probably I should stick with expect..

Marc Weber

