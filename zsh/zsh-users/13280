From zsh-users-return-13280-mason-zsh=primenet.com.au@sunsite.dk Tue Sep 23 08:30:10 2008
Return-Path: <zsh-users-return-13280-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21954 invoked from network); 23 Sep 2008 08:30:07 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-0.6 required=5.0 tests=AWL,BAYES_00,SUBJ_RE_NUM
	autolearn=no version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 Sep 2008 08:30:07 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 9235 invoked from network); 23 Sep 2008 08:29:25 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 Sep 2008 08:29:25 -0000
Received: (qmail 1730 invoked by alias); 23 Sep 2008 08:28:49 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13280
Received: (qmail 1719 invoked from network); 23 Sep 2008 08:28:48 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 23 Sep 2008 08:28:48 -0000
Received: from smtp.tt-solutions.com (sunset.tt-solutions.com [82.238.156.189])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id EF54B8030847
	for <zsh-users@sunsite.dk>; Tue, 23 Sep 2008 10:28:44 +0200 (CEST)
Received: from nightfall ([192.168.17.76])
	by smtp.tt-solutions.com with esmtp (Exim 4.63)
	(envelope-from <vz-zsh@zeitlins.org>)
	id 1Ki3GG-0005gP-Uz
	for zsh-users@sunsite.dk; Tue, 23 Sep 2008 10:28:44 +0200
Date: Tue, 23 Sep 2008 10:28:45 +0200
From: Vadim Zeitlin <vz-zsh@zeitlins.org>
Subject: Re[2]: svn completion under Cygwin
To: zsh-users@sunsite.dk
MIME-Version: 1.0
Content-Type: MULTIPART/SIGNED; protocol="application/pgp-signature"; micalg=pgp-sha1; BOUNDARY="496446511-23010-1222158525=:1580"
References: <20080922192357.6940f0ae@pws-pc> <20080922225133.06A6B8030847@bifrost.dotsrc.org> <20080922233655.GA48041@redoubt.spodhuis.org>
In-Reply-To: <20080922233655.GA48041@redoubt.spodhuis.org>
X-Mailer: Mahogany 0.67.2 'Constance', running under Windows Server 2003 (build 3790, Service Pack 1)
Message-Id: <20080923082844.EF54B8030847@bifrost.dotsrc.org>
X-Virus-Scanned: ClamAV 0.92.1/8315/Tue Sep 23 08:59:00 2008 on bifrost
X-Virus-Status: Clean

--496446511-23010-1222158525=:1580
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII
Content-Disposition: INLINE

On Mon, 22 Sep 2008 16:36:55 -0700 Phil Pennock <zsh-workers+phil.pennock@spodhuis.org> wrote:

PP> On 2008-09-23 at 00:51 +0200, Vadim Zeitlin wrote:
PP> >  But, once again, the problem with svn completion under Cygwin is not due
PP> > to CR LF trouble but to the fact that the native Win32 svn.exe outputs the
PP> > file paths with backslashes and not slashes as the completion code expects.
PP> > Let me repost my trivial patch which fixes the completion for me:
PP> 
PP> Do you have IPv6 connectivity?  If so, can you please tell me what you
PP> see for the fifth line of output from:
PP>   svn ls http://svn.spodhuis.org/svn/scratch-db/trunk
PP> ?

 No, sorry, I don't, but I do have my own svn server so I just created a
repository with the files with the same names and the output of "svn ls" is
the same under Windows, i.e. it still uses slashes to indicate directories
in this case, i.e.

	% svn ls svn+ssh://my-server/test
	sub\dir/

So I decided to check how would it work when checked out locally. But this
test failed:

	% svn co svn+ssh://my-server/test
	---------------------------
	svn.exe - Application Error
	---------------------------
	The exception unknown software exception (0xc00000fd) occurred in
	the application at location 0x7c8302d9.

	Click on OK to terminate the program
	Click on CANCEL to debug the program
	---------------------------
	OK   Cancel   
	---------------------------

This is both with svn 1.4.5 and 1.5.2 (latest available Win32 binary
version) so I'll report it as a bug...

PP> So clearly \ is a valid character in a directory name for svn; I can
PP> update files inside such a directory, etc.

 Well, not under Windows :-/

PP> I suspect that we need an _svn_osfixup() filter after the svn command,
PP> where that would, for the Windows OSes (I forget the values of $OSTYPE
PP> there) apply changes.  But before that can be written, what 'foo\bar'
PP> maps to needs to be determined, so that we can reverse it.

 I agree in theory but in practice it looks rather unlikely that anybody
uses backslash in their file names...

PP> > -    _cache_svn_status[$dir]="$(_call_program files svn status -N $dir)"
PP> > +    _cache_svn_status[$dir]="$(_call_program files svn status -N $dir) | tr '\\' '/'"
PP> 
PP> I'm somewhat surprised that this works, without the 'tr' being inside
PP> the $(...), but know little enough about completion.

 *blush* It indeed doesn't work, sorry, I made a mistake when cleaning up
my attempts to fix it and didn't notice that I broke it in the process
because my running shell still used the old, working, version. The correct
version is definitely

-    _cache_svn_status[$dir]="$(_call_program files svn status -N $dir)"
+    _cache_svn_status[$dir]="$(_call_program files svn status -N $dir | tr '\\' '/')"

 Thanks a lot for noticing it!
VZ

--496446511-23010-1222158525=:1580
Content-Type: APPLICATION/PGP-SIGNATURE

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (MingW32)

iEYEABECAAYFAkjYqL0ACgkQBupB3k9sHoaE4ACgjJQDzYjqgR6+iMZ8b/mpEaP5
9MsAn1HBskSTXkPTImXqZr0HZ6Cez4/a
=19tN
-----END PGP SIGNATURE-----

--496446511-23010-1222158525=:1580--

