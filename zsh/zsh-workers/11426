From zsh-workers-return-11426-mason-zsh=primenet.com.au@sunsite.auc.dk Wed May 17 03:41:13 2000
Return-Path: <zsh-workers-return-11426-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26400 invoked from network); 17 May 2000 03:41:11 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 May 2000 03:41:11 -0000
Received: (qmail 1419 invoked by alias); 17 May 2000 03:41:04 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11426
Received: (qmail 1401 invoked from network); 17 May 2000 03:40:51 -0000
To: zsh-workers@sunsite.auc.dk
Subject: Re: pty device files.
References: <hvopuqmfjjl.fsf@serein.m17n.org> <E12rn9y-0000b8-00@crucigera.fysh.org>
MIME-Version: 1.0 (generated by SEMI 1.13.7 - "Awazu")
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@m17n.org>
Date: 17 May 2000 12:42:19 +0900
In-Reply-To: <E12rn9y-0000b8-00@crucigera.fysh.org>
 (Zefram's message of "Tue, 16 May 2000 20:37:42 +0100 (BST)")
Message-ID: <hvobt25rgf8.fsf@serein.m17n.org>
Lines: 42
User-Agent: T-gnus/6.14.1 (based on Gnus v5.8.3) (revision 16) SEMI/1.13.7 (Awazu) FLIM/1.13.2 (Kasanui) Emacs/20.6 (i686-pc-linux-gnu) MULE/4.0 (HANANOEN)

In article <E12rn9y-0000b8-00@crucigera.fysh.org>,
  Zefram <zefram@fysh.org> writes:

> >+#elif defined(__FreeBSD__)
> 
> Trivial point: #elif isn't portable enough for us (it's not in some
> K&R preprocessors).  Though I see one has crept into system.h.

I see.

Index: Src/Modules/zpty.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/zpty.c,v
retrieving revision 1.8
diff -u -r1.8 zpty.c
--- Src/Modules/zpty.c	2000/05/16 18:16:20	1.8
+++ Src/Modules/zpty.c	2000/05/17 03:40:01
@@ -213,16 +213,18 @@
 get_pty(int master, int *retfd)
 {
 
-#if defined(__linux)
+#ifdef __linux
     static char char1[] = "abcdefghijklmnopqrstuvwxyz";
     static char char2[] = "0123456789abcdef";
-#elif defined(__FreeBSD__)
+#else /* __linux */
+# ifdef __FreeBSD__
     static char char1[] = "pqrsPQRS";
     static char char2[] = "0123456789abcdefghijklmnopqrstuv";
-#else
+# else /* __FreeBSD__ */
     static char char1[] = "pqrstuvwxyzPQRST";
     static char char2[] = "0123456789abcdef";
-#endif
+# endif /* __FreeBSD__ */
+#endif /* __linux */
 
     static char name[11];
     static int mfd, sfd;
-- 
Tanaka Akira

