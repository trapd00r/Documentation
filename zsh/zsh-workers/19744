From zsh-workers-return-19744-mason-zsh=primenet.com.au@sunsite.dk Tue Apr 06 22:26:06 2004
Return-Path: <zsh-workers-return-19744-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11864 invoked from network); 6 Apr 2004 22:26:05 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 6 Apr 2004 22:26:05 -0000
Received: (qmail 9887 invoked by alias); 6 Apr 2004 22:25:53 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19744
Received: (qmail 9877 invoked from network); 6 Apr 2004 22:25:52 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 6 Apr 2004 22:25:52 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [130.225.247.86] by sunsite.dk (MessageWall 1.0.8) with SMTP; 6 Apr 2004 22:25:52 -0000
Received: (qmail 28092 invoked from network); 6 Apr 2004 22:25:52 -0000
Received: from ip-66-80-62-153.dsl.sca.megapath.net (HELO ripple.fruitbat.org) (66.80.62.153)
  by a.mx.sunsite.dk with SMTP; 6 Apr 2004 22:25:50 -0000
Received: (from daemon@localhost)
	by ripple.fruitbat.org (8.10.2/8.8.8/PAC-1.3) id i36MPU414015
	for <zsh-workers@sunsite.dk>; Tue, 6 Apr 2004 15:25:30 -0700
Received: from ming.fruitbat.org(192.168.1.2) by ripple.fruitbat.org via smap (V2.1/2.1+anti-relay+anti-spam)
	id xma014013; Tue, 6 Apr 04 15:25:18 -0700
Received: from gremlin.fruitbat.org (IDENT:202@gremlin.fruitbat.org [192.168.1.4])
	by ming.fruitbat.org (8.10.2/8.10.2/PAC-1.6) with ESMTP id i36NPJi22682
	for <zsh-workers@sunsite.dk>; Tue, 6 Apr 2004 16:25:19 -0700
Date: Tue, 6 Apr 2004 15:25:23 -0700 (PDT)
From: "Peter A. Castro" <doctor@fruitbat.org>
To: zsh-workers@sunsite.dk
Subject: Re: zsh and line breaks 
In-Reply-To: <12924.1081244614@csr.com>
Message-ID: <Pine.LNX.4.53.0404061515260.11532@gremlin.fruitbat.org>
References: <12924.1081244614@csr.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

On Tue, 6 Apr 2004, Peter Stephenson wrote:

> "Peter A. Castro" wrote:
> > Ok, see attached diff of the following files.  These are primarily Cygwin
> > specific fixes, but some could be considdered generic:
> >
> > Doc/Makefile.in - A little correction to the texi2html command
> >                   args and a fix to the install.html target to use sdir.
> > Src/builtin.c - Prevent from constructing "//path".
> > Src/exec.c    - change read to use actual length instead of stat'd length.
> > Src/main.c    - added Cygwin premain hook to deal with Text related I/O.
> > Src/system.h  - add #include of <sys/cygwin.h>.
> > configure     - change DLLD & DLLDFLAGS to not use dllwrap
> > configure.ac  - change DLLD & DLLDFLAGS to not use dllwrap
>
> Thanks, I've committed this apart from the texi2html hunk.

Thanks, Peter :)

> It's possible opening all files in text mode will cause problems
> elsewhere, e.g. on file descriptors passed to external programmes, but
> the text/binary problem is inescapable; we probably need to wait and
> see.  We can always invent grotesqueries like <#myfile.bin if it becomes
> necessary.

If it's any consolation, only files which are opened only as O_RDONLY are
massaged to be opened with the special O_TEXT attribute.  All O_WRONLY
and O_RDWR are left alone, which I hope, will produce the correct
semantic.  Since shells are primarily dealing with textual data I feel
this is a sufficient trade-off.  I will, of course, be following this
issue and report if there are any problems (which I'll probably have to
fix, since I opened this can'o'worms myself :)  But, as you say, time
will tell.

-- 
Peter A. Castro <doctor@fruitbat.org> or <Peter.Castro@oracle.com>
	"Cats are just autistic Dogs" -- Dr. Tony Attwood

