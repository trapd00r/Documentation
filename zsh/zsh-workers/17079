From zsh-workers-return-17079-mason-zsh=primenet.com.au@sunsite.dk Mon May 06 15:35:57 2002
Return-Path: <zsh-workers-return-17079-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4254 invoked from network); 6 May 2002 15:35:56 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 6 May 2002 15:35:56 -0000
Received: (qmail 14422 invoked by alias); 6 May 2002 15:35:40 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 17079
Received: (qmail 14370 invoked from network); 6 May 2002 15:35:34 -0000
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <1020506153137.ZM6413@candle.brasslantern.com>
Date: Mon, 6 May 2002 15:31:37 +0000
In-Reply-To: <6134254DE87BD411908B00A0C99B044F035BB41F@mowd019a.mow.siemens.ru>
Comments: In reply to Borsenkow Andrej <Andrej.Borsenkow@mow.siemens.ru>
        "completion in quotes - " vs ' - no suffix added" (May  6, 11:54am)
References: <6134254DE87BD411908B00A0C99B044F035BB41F@mowd019a.mow.siemens.ru>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Borsenkow Andrej <Andrej.Borsenkow@mow.siemens.ru>,
        "'Zsh hackers list'" <zsh-workers@sunsite.dk>
Subject: Re: completion in quotes - " vs ' - no suffix added
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On May 6, 11:54am, Borsenkow Andrej wrote:
} Subject: completion in quotes - " vs ' - no suffix added
}
}   "-E[exclude path(s) from backup]:paths to exclude from
} backup:->quoted_path" \
}   "-I[path(s) to backup]:paths to inlcude in backup:->quoted_path" \
                                    ^^^^^^^
				    You might want to fix that before
				    you commit this completion ...
} 
} bor@itsrm2% mondoarchive -I "a\\ b
} Completing file
} a\\ b   c\\ d
} 
} no suffix added.

Hmm.  It's slightly worse than that ...

schaefer<510> functions _foo
_foo () {
        local suf="/ \t\n"
        [[ -n $compstate[quote] ]] && { suf="$compstate[quote]$suf" 
                compset -q }
        _files -r $suf
}
schaefer<511> compdef _foo foo         
schaefer<512> ls                 
don't stop/  rmthat/
schaefer<514> foo '<TAB>
Completing file
don\'\''t\ stop   rmthat/         
schaefer<514> foo "<TAB>
Completing file
don\\'t\\ stop   rmthat/        

Wrong number of backslashes in both cases; that's why the trailing suffix
didn't get added.  This looks similar to the problem we had with _values,
that Sven patched in 16998.

Same thing happens in 4.0.1, by the way, so this is not a new problem.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

