From zsh-workers-request@math.gatech.edu Wed Aug 12 11:26:06 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2349 invoked from network); 12 Aug 1998 11:26:05 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 12 Aug 1998 11:26:05 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id HAA00374;
	Wed, 12 Aug 1998 07:20:03 -0400 (EDT)
Resent-Date: Wed, 12 Aug 1998 07:20:03 -0400 (EDT)
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <980811195439.ZM1039@candle.brasslantern.com>
Date: Tue, 11 Aug 1998 19:54:39 -0700
In-Reply-To: <9808112147.AA08406@ezdzit.zko.dec.com>
Comments: In reply to Paul Lew <lew@ezdzit.zko.dec.com>
        "possible to disable zsh compatibility mode?" (Aug 11,  5:47pm)
References: <9808112147.AA08406@ezdzit.zko.dec.com>
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: Paul Lew <lew@ezdzit.zko.dec.com>, zsh-workers@math.gatech.edu
Subject: Re: possible to disable zsh compatibility mode?
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"UVeu12.0.n5.YfNqr"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4300
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On Aug 11,  5:47pm, Paul Lew wrote:
} Subject: possible to disable zsh compatibility mode?
}
} Is it possible to disable the sh/ksh compatibility mode in zsh?

There's presently no way (without modifying the source yourself) to build
zsh with argv[0]-based emulation turned off.  Perhaps there should be?

} My OS (Digital UNIX) script program fork the shell as:
} 
} 	 execl(shell, "sh", "-is", 0);

Ick.  Your best bet is to use the ENV environment variable, e.g.

	ENV=$HOME/.zshzsh script zsh

Where the file ~/.zshzsh contains

	emulate -R zsh
	function source_etc {
	  [[ -r /etc/$1 ]] && source /etc/$1
	  unsetopt localoptions
	}
	function sourcehome {
	  [[ -r ${ZDOTDIR:-$HOME}/$1 ]] && source ${ZDOTDIR:-$HOME}/$1
	  unsetopt localoptions
	}
	source_etc zshenv
	[[ -o rcs ]] && {
	  sourcehome .zshenv
	  [[ -o login ]] && {
	    source_etc zprofile
	    sourcehome .zprofile
	  }
	  [[ -o interact ]] && {
	    source_etc zshrc
	    sourcehome .zshrc
	  }
	  [[ -o login ]] && {
	    source_etc zlogin
	    sourcehome .zlogin
	  }
	}
	unfunction source_etc sourcehome

Zsh sources the file named by $ENV when emulating sh or ksh, and the above
commands are equivalent to what zsh executes internally when not emulating.

The remaining problem is that zsh still interprets its command-line flags in
emulation mode, but there's nothing that can be done about that.  The only
differences are in pretty obscure usages anyway.  Oh, and you can't stop it
from sourcing /etc/profile, which could alter ENV and thereby mess you up,
but it doesn't sound like you're having problems with that.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

