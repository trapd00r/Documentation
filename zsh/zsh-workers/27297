From zsh-workers-return-27297-mason-zsh=primenet.com.au@sunsite.dk Tue Sep 29 17:41:41 2009
Return-Path: <zsh-workers-return-27297-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28340 invoked from network); 29 Sep 2009 17:41:29 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 29 Sep 2009 17:41:29 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 67157 invoked from network); 29 Sep 2009 17:41:24 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 29 Sep 2009 17:41:24 -0000
Received: (qmail 5757 invoked by alias); 29 Sep 2009 17:41:21 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 27297
Received: (qmail 5744 invoked from network); 29 Sep 2009 17:41:21 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 29 Sep 2009 17:41:21 -0000
Received: from mail-fx0-f220.google.com (mail-fx0-f220.google.com [209.85.220.220])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 2068E801E2BF
	for <zsh-workers@sunsite.dk>; Tue, 29 Sep 2009 19:41:12 +0200 (CEST)
Received: by fxm20 with SMTP id 20so4536251fxm.38
        for <zsh-workers@sunsite.dk>; Tue, 29 Sep 2009 10:41:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=vU8HDp+WNsCnYQHzyAoQvzUjs6vxRBnXwtmjH3/oIqM=;
        b=s6ilFA6c6+dGsKf8cVSN8dAXVg9H/055F7cCBlnuS6l52ZrWgfyFyokBtb5Ng93EIg
         6LNE5LPYJjnNJhdSQfOGmXPx8k1pXU5feuyEZIssqUjvG+rj9PsWDtTvuMolED/iN93E
         OcrkX9W7U4KOauwW+8m3fs/h4Gvy/piZLs7kw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=n7Y0vyfQKwNlc4c5T0yVZMOU0b/pFzI5GUOeH5QIz5TuHVvoh0Zjj3qJvv4lqztai4
         ULQgf+R2Bh8GaW/gDIstArgAC8xj2NJ+sBXXS4npUXjoMc47Vz7M9dmD9XAnv2jYgEfc
         hZTh3UH2/uJ79tYjROnVv2AqICbbrLoZSzfiE=
MIME-Version: 1.0
Received: by 10.204.24.2 with SMTP id t2mr4434102bkb.65.1254246071364; Tue, 29 
	Sep 2009 10:41:11 -0700 (PDT)
In-Reply-To: <ADC9F79E-C7F4-4CB8-9E22-869ABDE01878@kba.biglobe.ne.jp>
References: <090927225016.ZM17646@torch.brasslantern.com>
	 <ADC9F79E-C7F4-4CB8-9E22-869ABDE01878@kba.biglobe.ne.jp>
Date: Tue, 29 Sep 2009 19:41:11 +0200
Message-ID: <237967ef0909291041k363e10d0o318dd2d7c2b0328e@mail.gmail.com>
Subject: Re: Rebuilding from CVS on Snow Leopard
From: Mikael Magnusson <mikachu@gmail.com>
To: zsh-workers@sunsite.dk
Content-Type: text/plain; charset=UTF-8
X-Virus-Scanned: ClamAV 0.94.2/9852/Tue Sep 29 17:06:51 2009 on bifrost
X-Virus-Status: Clean

2009/9/29 Jun T. <takimoto-j@kba.biglobe.ne.jp>:
> On 2009/09/28, at 14:50, Bart Schaefer wrote:
>
>> configure: WARNING: libc.h: accepted by the compiler, rejected by the
>> preprocessor!
>
>
> This is due to the lines 464-467 of configure.ac:
>
> dnl Default preprocessing on Mac OS X produces warnings
> case "$host_os" in
>  darwin*) CPP="$CPP -traditional-cpp" ;;
> esac
>
> I don't know when and why this is added.

The comment in the commit and the changelog entry don't exactly seem
to match up, but maybe the second hunk is the actual change?

5b8b7e9f06c
Author: Oliver Kiddle <opk@users.sourceforge.net>  2004-03-14 12:27:28
19619: fix problem with getting signals on MacOS X 10.1

---------------------------------- ChangeLog ----------------------------------
+2004-03-14  Oliver Kiddle  <opk@zsh.org>
+
+	* 19619: configure.ac: fix problem with getting signals
+	on MacOS X 10.1

--------------------------------- configure.ac ---------------------------------
@@ -399,32 +399,37 @@ esac
 case " ${LIBLDFLAGS+$LIBLDFLAGS }" in
   " ") ;;
   *" -s "*) strip_libldflags=true
     LIBLDFLAGS=`echo " $LIBLDFLAGS " | sed "$sed"` ;;
   *) strip_libldflags=false ;;
 esac

 AC_SUBST(CFLAGS)dnl
 AC_SUBST(LDFLAGS)dnl
 AC_SUBST(EXELDFLAGS)dnl
 AC_SUBST(LIBLDFLAGS)dnl

 AC_PROG_CPP                 dnl Figure out how to run C preprocessor.
 AC_PROG_GCC_TRADITIONAL     dnl Do we need -traditional flag for gcc.
 AC_C_CONST                  dnl Does compiler support `const'.

+dnl Default preprocessing on Mac OS X produces warnings
+case "$host_os" in
+  darwin*) CPP="$CPP -traditional-cpp" ;;
+esac
+
 fp_PROG_CC_STDC
 AC_MSG_CHECKING([whether to use prototypes])
 if test ."$ansi2knr" = .yes || test ."$ansi2knr" = .no; then
   msg="(overridden) "
 else
   msg=
   if test ."$fp_cv_prog_cc_stdc" = .no; then
     ansi2knr=yes
   else
     ansi2knr=no
   fi
 fi
 AH_TEMPLATE([PROTOTYPES],
 [Define to 1 if ANSI function prototypes are usable.])
 if test "$ansi2knr" = yes; then
   AC_MSG_RESULT(${msg}no)
@@ -1219,33 +1224,33 @@ zsh_cv_path_signal_h=$SIGNAL_H
 ])
 SIGNAL_H=$zsh_cv_path_signal_h
 AC_SUBST(SIGNAL_H)dnl

 dnl Where are error names located?  Needed as input for errnames1.awk
 AC_CACHE_CHECK(where error names are located, zsh_cv_path_errno_h,
 [dnl Look at the output from the preprocessor.
 dnl We should get lines of the form `# 1 "/usr/include/errno.h"'
 dnl The following assumes the real definitions are in a file which
 dnl contains the name `err'; we could relax this if necessary,
 dnl but then you can get a rather long list of files to test.
 dnl The backslash substitution is to persuade cygwin to cough up
 dnl slashes rather than doubled backslashes in the path.
 echo "#include <errno.h>" > nametmp.c
 errfile_list="`$CPP nametmp.c |
 sed -n -e 's/^#line[ 	].*\"\(.*\)\"/\1/p' \
-       -e 's/^#[ 	].*\"\(.*\)\"/\1/p' |
+       -e 's/^#[ 	0-9].*\"\(.*\)\"/\1/p' |
 sed 's/\\\\\\\\/\//g' |
 $AWK '{ if (\$1 ~ \"err\") files[[\$1]] = \$1 }
   END { for (var in files) print var }'`"
 rm -f nametmp.c
 for ERRNO_H in $errfile_list /dev/null
 do
   dnl Try to make sure it doesn't get confused by files that don't
   dnl have real error definitions in.  Count definitions to make sure.
   nerrs=`test -f $ERRNO_H && \
   grep '#[ 	]*define[ 	][ 	]*E[0-9A-Z]*[ 	]*[0-9][0-9]*' $ERRNO_H | \
   wc -l | sed 's/[ 	]//g'`
   test "x$nerrs" != x && test "$nerrs" -ge 7 && break
 done
 if test $ERRNO_H = "/dev/null"; then
   AC_MSG_ERROR(ERROR MACROS NOT FOUND:  please report to developers)
 fi

-- 
Mikael Magnusson

