From zsh-workers-return-14039-mason-zsh=primenet.com.au@sunsite.dk Thu Apr 19 16:57:58 2001
Return-Path: <zsh-workers-return-14039-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13678 invoked from network); 19 Apr 2001 16:57:57 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 19 Apr 2001 16:57:57 -0000
Received: (qmail 28519 invoked by alias); 19 Apr 2001 16:57:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14039
Received: (qmail 28463 invoked from network); 19 Apr 2001 16:57:46 -0000
Date: Thu, 19 Apr 2001 12:57:44 -0400
From: Clint Adams <schizo@debian.org>
To: zsh-workers@sunsite.dk
Subject: PATCH: simulate old linking behavior
Message-ID: <20010419125744.A32550@dman.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i

I'll probably follow this one up with something that reduces linking
for the DSOs but not the main binary.

Index: configure.in
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.in,v
retrieving revision 1.44
diff -u -r1.44 configure.in
--- configure.in	2001/04/19 14:45:41	1.44
+++ configure.in	2001/04/19 16:55:09
@@ -898,7 +898,7 @@
   AC_DEFINE(TGETENT_ACCEPTS_NULL)
 fi
 
-LIBS=$SAVELIBS
+LIBS="$LIBS_CAP $LIBS_SOCKET $LIBS_M $LIBS_TERMCAP $LIBS_TERMINFO $LIBS_YP $SAVELIBS"
 
 AC_FUNC_MMAP
 if test x$ac_cv_func_mmap_fixed_mapped = xyes; then
@@ -1688,16 +1688,16 @@
   test "$zsh_cv_shared_environ" = yes || dynamic=no
 dnl  test "$zsh_cv_sys_dynamic_broken" = no || dynamic=no
   if test "$ac_cv_func_tgetent" = yes; then
-    SAVELIBS=$LIBS
-    LIBS="$LIBS_TERMCAP $LIBS"
+#    SAVELIBS=$LIBS
+#    LIBS="$LIBS_TERMCAP $LIBS"
     zsh_SHARED_FUNCTION([tgetent])
-    LIBS=$SAVELIBS
+#    LIBS=$SAVELIBS
   fi
   if test "$ac_cv_func_tigetstr" = yes; then
-    SAVELIBS=$LIBS
-    LIBS="$LIBS_TERMINFO $LIBS"
+#    SAVELIBS=$LIBS
+#    LIBS="$LIBS_TERMINFO $LIBS"
     zsh_SHARED_FUNCTION([tigetstr])
-    LIBS=$SAVELIBS
+#    LIBS=$SAVELIBS
   fi
 fi
 
Index: Src/zsh.mdd
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/zsh.mdd,v
retrieving revision 1.8
diff -u -r1.8 zsh.mdd
--- Src/zsh.mdd	2001/04/19 14:45:41	1.8
+++ Src/zsh.mdd	2001/04/19 16:55:09
@@ -17,7 +17,7 @@
 headers="../config.h system.h zsh.h sigcount.h signals.h \
 prototypes.h hashtable.h ztype.h"
 
-extralibs="m termcap yp"
+#extralibs="m termcap yp"
 
 :<<\Make
 @CONFIG_MK@
Index: Src/Modules/cap.mdd
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/cap.mdd,v
retrieving revision 1.3
diff -u -r1.3 cap.mdd
--- Src/Modules/cap.mdd	2001/04/19 14:45:42	1.3
+++ Src/Modules/cap.mdd	2001/04/19 16:55:09
@@ -6,4 +6,4 @@
 
 objects="cap.o"
 
-extralibs="cap"
+#extralibs="cap"
Index: Src/Modules/termcap.mdd
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/termcap.mdd,v
retrieving revision 1.5
diff -u -r1.5 termcap.mdd
--- Src/Modules/termcap.mdd	2001/04/19 14:45:42	1.5
+++ Src/Modules/termcap.mdd	2001/04/19 16:55:09
@@ -16,4 +16,4 @@
 
 objects="termcap.o"
 
-extralibs="termcap"
+#extralibs="termcap"
Index: Src/Modules/terminfo.mdd
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/terminfo.mdd,v
retrieving revision 1.7
diff -u -r1.7 terminfo.mdd
--- Src/Modules/terminfo.mdd	2001/04/19 14:45:42	1.7
+++ Src/Modules/terminfo.mdd	2001/04/19 16:55:09
@@ -17,4 +17,4 @@
 
 objects="terminfo.o"
 
-extralibs="terminfo"
+#extralibs="terminfo"
Index: Src/Modules/zftp.mdd
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/zftp.mdd,v
retrieving revision 1.3
diff -u -r1.3 zftp.mdd
--- Src/Modules/zftp.mdd	2000/11/30 18:36:23	1.3
+++ Src/Modules/zftp.mdd	2001/04/19 16:55:09
@@ -6,3 +6,5 @@
 autobins="zftp"
 
 objects="zftp.o"
+
+#extralibs="socket"

