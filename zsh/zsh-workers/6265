From zsh-workers-return-6265-mason-zsh=primenet.com.au@sunsite.auc.dk Tue May 11 17:28:29 1999
Return-Path: <zsh-workers-return-6265-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17645 invoked from network); 11 May 1999 17:28:28 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 11 May 1999 17:28:28 -0000
Received: (qmail 24744 invoked by alias); 11 May 1999 17:28:19 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6265
Received: (qmail 24737 invoked from network); 11 May 1999 17:28:18 -0000
From: "Andrej Borsenkow" <borsenkow.msk@sni.de>
To: "ZSH workers mailing list" <zsh-workers@sunsite.auc.dk>
Subject: LFS notes RE: pws-18 is go
Date: Tue, 11 May 1999 21:27:37 +0400
Message-ID: <000501be9bd3$908bfa50$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="koi8-r"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2910.0)
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2314.1300
In-reply-to: <9905111450.AA42215@ibmth.df.unipi.it>
Importance: Normal

>
> This includes the large file support for SunOS, although Andrej's points
> are all valid.

Unfotunately, after more close look at it, this is broken.

1. It sets both LFS_CLFAGS *and* LFS64_CFLAGS. The two are for *very*
different modes of compilation; you may select one or other - but you cannot
assume, that mixing them is safe (even, if it helds true for any particular
OS). LFS_CFLAGS & Co is for the case, when you use normal, usual interfaces
(open/lseek ...) and makes off_t/ino_t 64 bit long. LFS64_CFLAGS & Co is for
the case, when you use explicit 64 bit interfaces (open64/lseek64/...) and
introduces new types off64_t, ino64_t and some others.

2. Zsh is using fseek/ftell. These are using long and are incompatible with
LFS; to be on safe side, one must use fseeko/ftello that use off_t.

3. Setting LFS[64]_CFLAGS & Co is not enough!!! One must set either
_LARGEFILE_SOURCE *or* _LARGEFILE64_SOURCE to indicate, which mode is used
(a side note, that _LARGEFILE64_SOURCE has some problems on our system).

For reference, look at
http://ftp.sas.com/standards/large.file/x_open.20Mar96.html I think, this
should be in Single Unix as well.

4. (minor) summary at the end of configure does not include LFS flags.

I urge you once again to really think about adopting LP64 model. If system
supports LFS it should (most probably) support LP64 as well. It does not
have as nice configure tests, must I admit ... but it does not require
changes in ZSH sources.

regards

/andrej

