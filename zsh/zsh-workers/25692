From zsh-workers-return-25692-mason-zsh=primenet.com.au@sunsite.dk Fri Sep 19 03:33:54 2008
Return-Path: <zsh-workers-return-25692-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25014 invoked from network); 19 Sep 2008 03:33:51 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 19 Sep 2008 03:33:51 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 65341 invoked from network); 19 Sep 2008 03:33:34 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 19 Sep 2008 03:33:34 -0000
Received: (qmail 12980 invoked by alias); 19 Sep 2008 03:33:19 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25692
Received: (qmail 12961 invoked from network); 19 Sep 2008 03:33:16 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 19 Sep 2008 03:33:16 -0000
Received: from mx.spodhuis.org (redoubt.spodhuis.org [193.202.115.177])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id B34CC802720D
	for <zsh-workers@sunsite.dk>; Fri, 19 Sep 2008 05:33:02 +0200 (CEST)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws; s=d200807; d=spodhuis.org;
	h=Received:Date:From:To:Subject:Message-ID:Mail-Followup-To:MIME-Version:Content-Type:Content-Disposition;
	b=NLSQiO6ATgSCsoZpgquw9fgyBpBMlKFZ/aDl2IkdbpJpppFD2X0JEkufDkd5NrerdcgXLxEhE8Dnn+BRSw0/i+kR1PazF7g/kumnsAjKrfm432s9GU6+qeD7w0wRTi1uhSRYgsI1WzkuiZtHI8mbxhZUc/LLRNHKxtxb1d1tVmM=;
Received: by smtp.spodhuis.org with local 
	id 1KgWjt-0008i2-5l; Fri, 19 Sep 2008 03:33:01 +0000
Date: Thu, 18 Sep 2008 20:33:01 -0700
From: Phil Pennock <zsh-workers+phil.pennock@spodhuis.org>
To: zsh-workers@sunsite.dk
Subject: backward-kill-word & wide characters
Message-ID: <20080919033300.GA5088@redoubt.spodhuis.org>
Mail-Followup-To: zsh-workers@sunsite.dk
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
X-Virus-Scanned: ClamAV 0.92.1/8285/Fri Sep 19 02:41:07 2008 on bifrost
X-Virus-Status: Clean

I have Ctrl-W bound to backward-kill-word, per normal emacs-style
bindings.

If I have a command-line of one of these cases:

case1% cmd <widechar>
case2% cmd <widechar><widechar>
case3% cmd <widechar><ascii>
case4% cmd <ascii><widechar>

where, say, <ascii> is the letter 'a' and <widechar> is CodePoint U+A3
(POUND SIGN), wide in UTF-8, then typing Ctrl-W at the end:

Case 1: deletes entire line, treats space as part of word; skips past
        the space even when there are multiple spaces.
Case 2: ditto
Case 3: deletes <ascii>, stops before deleting widechar
Case 4: behaves "correctly", for my expectation, treating
        <ascii><widechar> as one word and deleting both, leaving the
	cursor after the space

Confirmed with "zsh -f" for a build from today, up to and including the
25690 change (pws's insertlastword fix).

The next two paragraphs note things which have already been confirmed to
not cause the results to vary.

The method of insertion doesn't matter, insert-composed-char or paste,
so widget vs straight input irrelevant.

For some characters, zsh shows in ZLE the codepoint instead of
attempting to render the character; eg, FLOWER PUNCTUATION MARK U+2055 
shows up as '<2055>' and seems to cut&paste cleanly back and forth; I
don't know enough to know if this comes from XTerm or elsewhere.
Regardless, it's deleted as a single character by backward-delete-char
and behaves identically to a rendered wide character as described above.

Okay, enough of the digression started when I went to
  http://www.sevenwires.com/play/UpsideDownLetters.html
and back to work.  ;)

