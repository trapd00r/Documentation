From zsh-workers-return-5797-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Mar 15 09:56:16 1999
Return-Path: <zsh-workers-return-5797-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25891 invoked from network); 15 Mar 1999 09:56:15 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 Mar 1999 09:56:15 -0000
Received: (qmail 3341 invoked by alias); 15 Mar 1999 09:55:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5797
Received: (qmail 3333 invoked from network); 15 Mar 1999 09:55:58 -0000
Message-Id: <9903150938.AA36437@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: 3.1.5-pws-12: configuration changes
In-Reply-To: ""Andrej Borsenkow""'s message of "Mon, 15 Mar 1999 11:19:58 NFT."
             <001801be6ebc$9d3fbe60$21c9ca95@mowp.siemens.ru> 
Date: Mon, 15 Mar 1999 10:38:56 +0100
From: Peter Stephenson <pws@ibmth.df.unipi.it>

"Andrej Borsenkow" wrote:
> This works for me. Thanks.

Satisfied customer, as Basil Fawlty said.

> The only problem is, we have to set CLOBBERS_TYPEAHED. Last time I checked
> it was set for me :-), Ultrix and something else - but definitely not for
> Irix. So, either we have different problem on Irix, or Irix should set
> CLOBBERS_TYPEAHED.

Well, the following sets it for Irix.  I'm only using Irix 6.2 and only
(very) remotely, and I didn't see the bug, but I've reconfigured to check
this doesn't do anything obviously wrong.  Helmut, you'll probably need
this.

> Another approach is to simply always use FIONREAD if available. What is the
> point of setting magical CLOBBERS_TYPEAHEAD at all?

In my case, fear.  But given that the mechanism we have seems to work
seamlessly when it's required, there's certainly an argument for removing
the test.

I also rescued Reliant UNIX and Rhapsody (see 4594) from the old
config.guess.

--- config.guess.irix	Mon Mar 15 10:26:14 1999
+++ config.guess	Mon Mar 15 09:52:44 1999
@@ -767,6 +767,9 @@
     RM*:SINIX-*:*:*)
 	echo mips-sni-sysv4
 	exit 0 ;;
+    RM*:ReliantUNIX-*:*:*)
+       echo mips-sni-sysv4
+       exit 0 ;;
     *:SINIX-*:*:*)
 	if uname -p 2>/dev/null >/dev/null ; then
 		UNAME_MACHINE=`(uname -p) 2>/dev/null`
@@ -800,6 +803,12 @@
 	else
 	        echo mips-unknown-sysv${UNAME_RELEASE}
 	fi
+        exit 0 ;;
+    Power*:Rhapsody:*:*)
+        echo powerpc-apple-rhapsody${UNAME_RELEASE}
+        exit 0 ;;
+    *:Rhapsody:*:*)
+        echo ${UNAME_MACHINE}-apple-rhapsody${UNAME_RELEASE}
         exit 0 ;;
     BeBox:BeOS:*:*)	# BeOS running on hardware made by Be, PPC only.
 	echo powerpc-be-beos
--- configure.in.irix	Sat Mar 13 14:46:44 1999
+++ configure.in	Mon Mar 15 09:57:52 1999
@@ -893,7 +893,7 @@
 dnl The doubled square brackets are necessary because autoconf uses m4.
 AC_CACHE_CHECK(if typeahead needs FIONREAD, zsh_cv_sys_clobbers_typeahead,
 [case x-$host_vendor-$host_os in
-    x-*-ultrix* | x-*-dgux* | x-sni-sysv4*)
+    x-*-ultrix* | x-*-dgux* | x-sni-sysv4* | x-*-irix*)
 	zsh_cv_sys_clobbers_typeahead=yes;;
     *)
 	zsh_cv_sys_clobbers_typeahead=no;;

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

