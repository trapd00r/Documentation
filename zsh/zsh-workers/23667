From zsh-workers-return-23667-mason-zsh=primenet.com.au@sunsite.dk Mon Jul 09 17:41:24 2007
Return-Path: <zsh-workers-return-23667-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4031 invoked from network); 9 Jul 2007 17:41:22 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.1 (2007-05-02) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,HTML_MESSAGE
	autolearn=ham version=3.2.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 9 Jul 2007 17:41:22 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 75923 invoked from network); 9 Jul 2007 17:41:15 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 Jul 2007 17:41:15 -0000
Received: (qmail 11062 invoked by alias); 9 Jul 2007 17:41:12 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23667
Received: (qmail 11052 invoked from network); 9 Jul 2007 17:41:12 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 9 Jul 2007 17:41:12 -0000
Received: (qmail 75579 invoked from network); 9 Jul 2007 17:41:12 -0000
Received: from wx-out-0506.google.com (66.249.82.237)
  by a.mx.sunsite.dk with SMTP; 9 Jul 2007 17:41:09 -0000
Received: by wx-out-0506.google.com with SMTP id h27so993139wxd
        for <zsh-workers@sunsite.dk>; Mon, 09 Jul 2007 10:41:08 -0700 (PDT)
DKIM-Signature: a=rsa-sha1; c=relaxed/relaxed;
        d=gmail.com; s=beta;
        h=domainkey-signature:received:received:message-id:date:from:to:subject:mime-version:content-type;
        b=IlHW0anL/H8BOzN5ZYux45YxVB2ubNkXfuvvEXaa6TRsr5ALyQxzXC0MJZxyLhpMZ71ANswv5XrpxRg28f6Dva3D8p5gyl102hArQ0WsntOF4CtT5X+w6ZFFDR4/dB7xYnu8P2HFoBOSr96ktlY+cFG2lpUDEQ0UexLYXJLoVVw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=beta;
        h=received:message-id:date:from:to:subject:mime-version:content-type;
        b=EWPXYF743XWQ/BRrybe1M5dwVRt5inEsAWW58Zkycx/o75gwubj633kmZq6i0IU4/d6ECsiJrtfq7Gr1qhQdxz1ppiGQyXJ1CorXuJePW5BBsXyxxTmoAEUZsmqsNthYbROBATyhMnBGrBBW2Nx0HYzKM4FIaVe7rePRn/ZNwxQ=
Received: by 10.70.73.12 with SMTP id v12mr6231941wxa.1184002868076;
        Mon, 09 Jul 2007 10:41:08 -0700 (PDT)
Received: by 10.70.117.18 with HTTP; Mon, 9 Jul 2007 10:41:08 -0700 (PDT)
Message-ID: <3cb6e920707091041t3b3f5c1cy7d7b08e6028c22f9@mail.gmail.com>
Date: Mon, 9 Jul 2007 13:41:08 -0400
From: "Joe D" <joe.divola@gmail.com>
To: zsh-workers@sunsite.dk
Subject: adding history logging "automagically" :)
MIME-Version: 1.0
Content-Type: multipart/alternative; 
	boundary="----=_Part_101884_12950977.1184002868053"

------=_Part_101884_12950977.1184002868053
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

Hi all,
   We have two user accounts which groups use for a few diff purposes, and
to ease our debugging of what went wrong when things crash with our tools,
we want a nice easy way to find out what was last done on the system (as
opposed to the user not having any idea what the previous user did).  So
essentially, these two user accounts (who already use 'zsh') will always log
to a file that not everyone has to know about (just the support teams).
This doesn't take into account users who switch shells, etc, but this will
give us info for about 90% of our problems.

So in a nutshell, all I want to do is modify 'zsh' source to always do the
following options automatically (regardless of if these lines are present or
not):

HISTSIZE=1000
SAVEHIST=1000
HISTFILE=/opt/some_location/.user.log
setopt APPEND_HISTORY
setopt SHARE_HISTORY
setopt INC_APPEND_HISTORY

I've played around with hist.c & init.c with various functions and couldn't
quite get this behaviour, so I was hoping for a few pointers from anyone?
I've looked at 'init_misc' in init.c and tried simple things like:

    dosetopt(SHAREHISTORY, 1, 1);
    dosetopt(INCAPPENDHISTORY, 1, 1);

and in 'hist.c', I've used

char *new_hf = "/opt/some_location/.user.log"
setsparam("HISTFILE", ztrdup(new_hf));

in a few different places, but didn't seem to do the trick.  At this point,
i get a ".user.log.LOCK" file created in the proper place, but nothing gets
written to ".user.log" even after the shell is exitted.

Any suggestions/info/comments would be greatly appreciated.

Thanks,
Joe.

------=_Part_101884_12950977.1184002868053
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

Hi all,<br>
&nbsp;&nbsp; We have two user accounts which groups use for a few diff
purposes, and to ease our debugging of what went wrong when things
crash with our tools, we want a nice easy way to find out what was last
done on the system (as opposed to the user not having any idea what the
previous user did).&nbsp; So essentially, these two user accounts (who
already use &#39;zsh&#39;) will always log to a file that not everyone has to
know about (just the support teams).&nbsp;&nbsp; This doesn&#39;t take into
account users who switch shells, etc, but this will give us info for
about 90% of our problems. <br>
<br>
So in a nutshell, all I want to do is modify &#39;zsh&#39; source to always do
the following options automatically (regardless of if these lines are
present or not):<br>
<br style="font-style: italic;">
<span style="font-style: italic;">HISTSIZE=1000</span><br style="font-style: italic;">
<span style="font-style: italic;">SAVEHIST=1000</span><br style="font-style: italic;">
<span style="font-style: italic;">HISTFILE=/opt/some_location/.user.log</span><br style="font-style: italic;">
<span style="font-style: italic;">setopt APPEND_HISTORY</span><br style="font-style: italic;">
<span style="font-style: italic;">setopt SHARE_HISTORY</span><br style="font-style: italic;">
<span style="font-style: italic;">setopt INC_APPEND_HISTORY<br>
<br>
</span>I&#39;ve played around with hist.c &amp; init.c with various
functions and couldn&#39;t quite get this behaviour, so I was hoping for a
few pointers from anyone?&nbsp;&nbsp; I&#39;ve looked at &#39;init_misc&#39; in
init.c and tried simple things like:<br>
<br>
<span style="font-style: italic;">&nbsp;&nbsp;&nbsp; dosetopt(SHAREHISTORY, 1, 1);</span><br style="font-style: italic;">
<span style="font-style: italic;">&nbsp;&nbsp;&nbsp; dosetopt(INCAPPENDHISTORY, 1, 1);</span><br style="font-style: italic;">
<br>
and in &#39;hist.c&#39;, I&#39;ve used <br>
<br>
<span style="font-style: italic;">char *new_hf = &quot;/opt/some_location/.user.log&quot;</span><br style="font-style: italic;">
<span style="font-style: italic;">setsparam(&quot;HISTFILE&quot;, ztrdup(new_hf));</span><br style="font-style: italic;">
<br>
in a few different places, but didn&#39;t seem to do the trick.&nbsp; At
this point, i get a &quot;.user.log.LOCK&quot; file created in the proper place,
but nothing gets written to &quot;.user.log&quot; even after the shell is exitted.<br>
<br>
Any suggestions/info/comments would be greatly appreciated. <br>
<br>
Thanks,<br>
Joe.<br>
<br>
<br>

------=_Part_101884_12950977.1184002868053--

