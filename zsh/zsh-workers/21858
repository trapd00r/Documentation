From zsh-workers-return-21858-mason-zsh=primenet.com.au@sunsite.dk Mon Oct 10 09:37:20 2005
Return-Path: <zsh-workers-return-21858-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21802 invoked from network); 10 Oct 2005 09:37:16 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 10 Oct 2005 09:37:16 -0000
Received: (qmail 56707 invoked from network); 10 Oct 2005 09:37:07 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 Oct 2005 09:37:07 -0000
Received: (qmail 25415 invoked by alias); 10 Oct 2005 09:37:04 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21858
Received: (qmail 25406 invoked from network); 10 Oct 2005 09:37:04 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 10 Oct 2005 09:37:04 -0000
Received: (qmail 56371 invoked from network); 10 Oct 2005 09:37:04 -0000
Received: from cluster-c.mailcontrol.com (HELO rly24c.srv.mailcontrol.com) (168.143.177.190)
  by a.mx.sunsite.dk with SMTP; 10 Oct 2005 09:37:02 -0000
Received: from exchange03.csr.com (mailhost1.csr.com [81.105.217.43])
	by rly24c.srv.mailcontrol.com (MailControl) with ESMTP id j9A9axX1001114
	for <zsh-workers@sunsite.dk>; Mon, 10 Oct 2005 10:36:59 +0100
Received: from csr.com ([10.103.143.38]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Mon, 10 Oct 2005 10:39:01 +0100
To: zsh-workers@sunsite.dk
Subject: Re: cosmetic completion problem 
In-reply-to: <1051009025449.ZM6480@candle.brasslantern.com> 
References: <20051006205811.GA29634@scowler.net> <20051008073254.GB81@DervishD> <20051008214058.GA16720@scowler.net> <1051009025449.ZM6480@candle.brasslantern.com>
Comments: In-reply-to Bart Schaefer <schaefer@brasslantern.com>
   message dated "Sun, 09 Oct 2005 02:54:49 -0000."
Date: Mon, 10 Oct 2005 10:37:03 +0100
From: Peter Stephenson <pws@csr.com>
Message-ID: <EXCHANGE03O6AprLfKY00003f28@exchange03.csr.com>
X-OriginalArrivalTime: 10 Oct 2005 09:39:01.0574 (UTC) FILETIME=[72377E60:01C5CD7E]
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A-05-40-00 (www.mailcontrol.com) on 10.67.0.134
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.4

Bart Schaefer wrote:
> Inside that same (col >= columns) block is an fputs() call that's intended
> to make sure that the line really has wrapped when col == columns.  I'm
> not sure, looking at it, why that's only necessary when (colors).

This doesn't really help, but until I added the ZLE_UNICODE_SUPPORT
there were two separate functions, one which handled colours and one
which didn't.  I rationalised them into one with a flag for the few
local differences.

What might be more interesting is that I changed

	    if (++col == columns) {

into

	    if (col >= columns) {

which might well have introduced a subtle bug.  The reason I introduced it
was we may have characters spanning multiple columns, but perhaps those
need something more sophisticated.  (The increment now happens in one
of the immediately preceeding code branches.)

pws



This message has been scanned for viruses by BlackSpider MailControl - www.blackspider.com

