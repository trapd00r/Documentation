From stephens@hlrz26 Fri Jul  5 18:27:25 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3/2) with ESMTP id SAA17389 for <mason@werple.mira.net.au>; Fri, 5 Jul 1996 18:27:17 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id EAA01606; Fri, 5 Jul 1996 04:20:20 -0400 (EDT)
Resent-Date: Fri, 5 Jul 1996 04:20:20 -0400 (EDT)
Reply-To: stephens@hlrz26@hlrz31.hlrz.kfa-juelich.de
Message-Id: <199607050819.KAA06453@hlrz26.hlrz.kfa-juelich.de>
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: NIS+ configuration checks
Date: Fri, 05 Jul 1996 10:19:15 +0200
From: "Peter W. Stephenson" <stephens@hlrz26>
Resent-Message-ID: <"QgDSm2.0.0P.31Dtn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1530
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 1766
Status: OR

The following patches for configure.in and config.h.in allow NIS+ to
be correctly configured and compiled here, where NIS+ is running.  I
didn't see any compilation problems.

It also correctly failed to find NIS+ on a machine without it: one
last test I haven't performed is to try on a machine with NIS+ but
without it running, though I did check that nisls returns status 1 in
such circumstances, which should be all that is needed.

I haven't sent the patch for configure itself since I used an earlier
version of autoconf so there are actually rather more changes there
than are necessary.

*** config.h.in.nisplus	Thu Jul  4 22:00:19 1996
--- config.h.in	Fri Jul  5 10:05:15 1996
***************
*** 100,105 ****
--- 100,108 ----
  /* Define if your system defines TIOCGWINSZ in sys/ioctl.h.  */
  #undef GWINSZ_IN_SYS_IOCTL
  
+ /* Define to 1 if you have NISPLUS */
+ #undef HAVE_NIS_PLUS
+ 
  /* Define to 1 if you have NIS */
  #undef HAVE_NIS
  
*** configure.in.nisplus	Thu Jul  4 22:06:46 1996
--- configure.in	Fri Jul  5 10:04:02 1996
***************
*** 465,470 ****
--- 465,480 ----
    AC_DEFINE(HAVE_SUPERROOT)
  fi
  
+ dnl -----------------
+ dnl CHECK FOR NISPLUS
+ dnl -----------------
+ AC_CACHE_CHECK(for NIS+, zsh_cv_have_nis_plus,
+ [test -f /usr/bin/nisls && /usr/bin/nisls > /dev/null 2>&1 && \
+ zsh_cv_have_nis_plus=yes || zsh_cv_have_nis_plus=no])
+ if test $zsh_cv_have_nis_plus = yes; then
+   AC_DEFINE_UNQUOTED(HAVE_NIS_PLUS, "1")
+ fi
+ 
  dnl -------------
  dnl CHECK FOR NIS
  dnl -------------


-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77330
Deutches Electronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.


