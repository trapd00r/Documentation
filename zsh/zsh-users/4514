From zsh-users-return-4514-mason-zsh=primenet.com.au@sunsite.dk Wed Nov 28 16:19:22 2001
Return-Path: <zsh-users-return-4514-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16353 invoked from network); 28 Nov 2001 16:19:21 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 28 Nov 2001 16:19:21 -0000
Received: (qmail 26650 invoked by alias); 28 Nov 2001 16:19:06 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4514
Received: (qmail 26639 invoked from network); 28 Nov 2001 16:19:06 -0000
Date: Wed, 28 Nov 2001 16:19:05 +0000
From: Adam Spiers <adam@spiers.net>
To: zsh users mailing list <zsh-users@sunsite.auc.dk>
Subject: vanishing history
Message-ID: <20011128161905.A9726@corelli.new.ox.ac.uk>
Reply-To: Adam Spiers <adam@spiers.net>
Mail-Followup-To: zsh users mailing list <zsh-users@sunsite.auc.dk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
X-URL: http://tigerpig.org/
X-OS: RedHat Linux
Sender: "Adam Spiers,,07775562717,020 88 30 30 35" <adam@corelli.new.ox.ac.uk>

Does anyone have any idea why my .zshhistory occasionally looses the
vast majority of its contents?  I can't reproduce it, so I can't begin
to track down what's going on.  I have the following settings:

HISTSIZE=3000
cshjunkiehistory
extendedhistory
histallowclobber
histexpiredupsfirst
histignorealldups
histignoredups
histreduceblanks
histverify
incappendhistory

I'm running 4.1.0-dev-2 from CVS.  I have a _very_ vague suspicion
that it might be something to do with running different versions of
zsh on the same history file, or maybe zcompile comes into it somehow,
but really I haven't a clue.  I wanted to get my .zshrc to
automatically alert me when it happens, via:

  _check_hist_size () {
    fc_out=( $(fc -l -1) )
    if (( "$fc_out[1]" < 500 )); then
      print "\nWARNING: Small history ($fc_out[1]) detected\!"
    fi
  }

but that just resulted in:

  _check_hist_size:fc:1: no such event: 0
  _check_hist_size:2: no such file or directory: 500

