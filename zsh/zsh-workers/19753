From zsh-workers-return-19753-mason-zsh=primenet.com.au@sunsite.dk Sun Apr 11 08:09:23 2004
Return-Path: <zsh-workers-return-19753-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23999 invoked from network); 11 Apr 2004 08:09:23 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 11 Apr 2004 08:09:23 -0000
Received: (qmail 26512 invoked by alias); 11 Apr 2004 08:09:18 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19753
Received: (qmail 26449 invoked from network); 11 Apr 2004 08:09:17 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 11 Apr 2004 08:09:17 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [130.225.247.86] by sunsite.dk (MessageWall 1.0.8) with SMTP; 11 Apr 2004 8:9:17 -0000
Received: (qmail 1590 invoked from network); 11 Apr 2004 08:09:17 -0000
Received: from ns1.primenet.com.au (HELO primenet.com.au) (@203.24.36.2)
  by a.mx.sunsite.dk with SMTP; 11 Apr 2004 08:09:14 -0000
Received: (qmail 4518 invoked by uid 8); 11 Apr 2004 08:09:08 -0000
To: zsh-workers@sunsite.dk
Path: not-for-mail
From: Geoff Wing <mason@primenet.com.au>
X-Newsgroups: lists.zsh.workers
Subject: Re: Crash of 4.2.0-dev-1
Date: Sun, 11 Apr 2004 08:09:07 +0000 (UTC)
Organization: PrimeNet Computer Consultants
Lines: 43
Message-ID: <slrnc7hv93.g5j.mason@g.primenet.com.au>
References: <1040411053038.ZM11840@candle.brasslantern.com>
Reply-To: mason@primenet.com.au
NNTP-Posting-Host: sparkles.primenet.com.au
X-Trace: coral.primenet.com.au 1081670947 7357 203.43.15.10 (11 Apr 2004 08:09:07 GMT)
X-Complaints-To: usenet@coral.primenet.com.au
NNTP-Posting-Date: Sun, 11 Apr 2004 08:09:07 +0000 (UTC)
User-Agent: slrn/0.9.8.0 (NetBSD)
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

Bart Schaefer <schaefer@brasslantern.com> typed:
: I presume of 4.2.0 also.  Reproduce as follows:
:
: (1) Create a file "kshtest" in a directory in fpath.  This file should NOT
: define the function "kshtest", that is, it's not a valid ksh-autoloadable
: file (but we're going to autoload it ksh-style anyway).

Any specific kshtest example for us?

% echo 'echo foo' > /usr/local/share/zsh/site-functions/kshtest
% zsh -f
% setopt kshautoload
% autoload +X -k kshtest
% kshtest
foo
foo
% kshtest
foo
% which kshtest
kshtest () {
        echo foo
}
% echo $ZSH_VERSION
4.2.0
% 

: (3) Observe the [correct] error:
:
: 	zsh: kshtest: function not defined by file

I don't understand why this is the correct error since you  setopt kshautload.
Also, I haven't yet understood why it was run twice in my case (but I've been
sick so maybe my brain isn't working properly yet).

: (4) Memory is now corrupted.  At some point soon, usually but not always
: during printing of the next prompt, the shell will crash in malloc().

I'm still going.  Haven't seen any memory problems yet.  Note that I use
the  --enable-zsh-mem* args to configure.

Regards,
-- 
Geoff Wing

