From zsh-users-return-11010-mason-zsh=primenet.com.au@sunsite.dk Sun Nov 19 23:20:35 2006
Return-Path: <zsh-users-return-11010-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14394 invoked from network); 19 Nov 2006 23:20:33 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 19 Nov 2006 23:20:33 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 82518 invoked from network); 19 Nov 2006 23:20:27 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 19 Nov 2006 23:20:27 -0000
Received: (qmail 27650 invoked by alias); 19 Nov 2006 23:20:19 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11010
Received: (qmail 27640 invoked from network); 19 Nov 2006 23:20:18 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 19 Nov 2006 23:20:18 -0000
Received: (qmail 81358 invoked from network); 19 Nov 2006 23:20:18 -0000
Received: from wx-out-0506.google.com (66.249.82.239)
  by a.mx.sunsite.dk with SMTP; 19 Nov 2006 23:20:15 -0000
Received: by wx-out-0506.google.com with SMTP id i31so1457172wxd
        for <zsh-users@sunsite.dk>; Sun, 19 Nov 2006 15:20:13 -0800 (PST)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:sender:to:subject:mime-version:content-type:content-transfer-encoding:content-disposition:x-google-sender-auth;
        b=ZZ3k4tetVT7KfYe25LXNugFd7RUScUO8ojXfyQGc1pdtVmlU6rqAS69breDTxXjTrIDC3+kKjI8GdaxTboPIiJFdtRoPTc7oobfajWqf/oNHQvSpIn6NK3zuocEMl+a2fvvD6o1t6KQzgnHo0lSX183vlbBI//21ohwhobdvqMI=
Received: by 10.90.90.16 with SMTP id n16mr2900115agb.1163978413328;
        Sun, 19 Nov 2006 15:20:13 -0800 (PST)
Received: by 10.90.65.18 with HTTP; Sun, 19 Nov 2006 15:20:13 -0800 (PST)
Message-ID: <dbfc82860611191520t62b02d9bg138ba4d1f7bca056@mail.gmail.com>
Date: Mon, 20 Nov 2006 00:20:13 +0100
From: "Nikolai Weibull" <now@bitwi.se>
Sender: nikolai.weibull@gmail.com
To: "zsh-users@sunsite.dk" <zsh-users@sunsite.dk>
Subject: Completion of mkisofs find operators
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
X-Google-Sender-Auth: 53a41312973a8f46

OK, another question regarding the -find option to mkisofs.

The options -a (logical AND) and -o (logical OR) are only interesting
after primaries, e.g., in "-mtime X -o -atime Y".  But the question is
how I best implement this.  I figured that all primaries, e.g.,
-mtime, would take a second optional argument (optional, as logical
AND is the default operator between primaries if none is given) that
would generate the two operators in question.  So my solution thus far
is

(( $+functions[_mkisofs_find_operators] )) ||
_mkisofs_find_operators () {
  _values 'find operator' \
    '*-a[logical and of options]' \
    '*-o[logical or of options]'
}

  '*-atime[true if the last-access time is in the specified
range]:range: ::_mkisofs_find_operators'

which works fine, except that options aren't listed after -atime
anymore, unless I delete the "-" that is automatically inserted when I
begin completion after the range argument to -atime.  (Though, if I
cycle through the matches, the options are given after -a and -o have
been given).

Wow, that's a terrible description of my problem, but I don't think I
can make it clearer.  I'll attach the completion function next time if
no one gets what I'm talking about.  My guess is that I should be
using a tag loop somewhere, but I'm not sure how and why.

Perhaps this is a better description of my problem:

Say that I have the following command line:

% mkisofs -find -atime X

and then I press <Tab>

% mkisofs -find -atime X <Tab>

this will give me

% mkisofs -find -atime X -
::: find operator :::
-a logical and of options
-o logical or of options

If I press <Tab> again auto-listing kicks in and I get

% mkisofs -find -atime X -a

pressing <Tab> again gives me a '-o' instead.  Another <Tab> then
begins completing options specified with _arguments, as the argument
is considered optional.  I would like the options specified with
_arguments to be listed immediately, like it would be if I deleted the
automatically inserted dash:

% mkisofs -find -atime X -<Backspace>-<Tab>
::: find operator :::
-a logical and of options
-o logical or of options
::: option :::
-acl true if the file has additional ACLs defined
:
:

Hm, perhaps 00:18 isn't the right time to ask complicated questions...

  nikolai

