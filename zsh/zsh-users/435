From zsh-workers-request@euclid.skiles.gatech.edu  Thu Oct 10 18:14:41 1996
Return-Path: zsh-workers-request@euclid.skiles.gatech.edu
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by coral.primenet.com.au (8.7.5/8.7.3) with ESMTP id SAA26264 for <mason@primenet.com.au>; Thu, 10 Oct 1996 18:14:38 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id EAA01551; Thu, 10 Oct 1996 04:09:07 -0400 (EDT)
Resent-Date: Thu, 10 Oct 1996 04:02:59 -0400 (EDT)
Message-Id: <199610100802.KAA02587@hydra.ifh.de>
X-Authentication-Warning: hydra.ifh.de: Host pws@localhost didn't use HELO protocol
To: tsv@cs.umanitoba.ca, zsh-users@math.gatech.edu (Zsh users list)
Subject: Re: Completion Control (Novice qn) 
In-reply-to: "Varadarajan"'s message of "Wed, 09 Oct 1996 13:02:03 MET."
             <199610091802.NAA29625@gold.cs.umanitoba.ca> 
Date: Thu, 10 Oct 1996 10:02:04 +0200
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"DlQGN3.0.5N.psANo"@euclid>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/435
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Varadarajan wrote:
> 
> Hi all,
>    I need some help with completions. Basically what I want is
> this. If I want to talk to a person on local network, I want talk to
> complete the machine name.
> Typically this is what I want.
> talk person@`rwho | grep person | cut -d: -f1 | awk '{print $2}' |
> head -1`

The following seems to work.  Note you want the second word in the
array: the first is the command.  Also, you don't need the `head':  zsh
will simply make the results into different possible completions.  The
upshot of the compctl command is that you need to type the @ sign
yourself before it is recognised as a candidate for this behaviour.
This allows you to complete users as well if there is no @ (the -u).

talkcomp () {
  local line from

  read -Ac line
  from="${line[2]}"
  from=${from%%@*}

  reply=( `rwho | grep $from | cut -d: -f1 | awk '{print $2}'` )
# with perl
# reply=( `rwho | perl -ane '/^(\S+)\s*(\S+):/ && ($1 eq '$from') 
#          && print "$2\n";` )
}
compctl -u -x 'n[1,@]' -K talkcomp -- talk

(Note that with perl you can get away with two processes instead of
four; maybe you can do it in awk too.)

> I would like to know what is the solution, and if
> there is any ways of debugging such things.. (Like how to know the
> value of variables being used).

Miss out the `local' and you can check the values afterwards.  You can
put `set -x' inside the function, although that makes the display
harder to see.

-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77413
Deutches Electronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.

