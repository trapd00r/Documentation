From zsh-workers-return-14125-mason-zsh=primenet.com.au@sunsite.dk Thu Apr 26 15:52:54 2001
Return-Path: <zsh-workers-return-14125-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29359 invoked from network); 26 Apr 2001 15:52:54 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 26 Apr 2001 15:52:54 -0000
Received: (qmail 5521 invoked by alias); 26 Apr 2001 15:52:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14125
Received: (qmail 5499 invoked from network); 26 Apr 2001 15:52:46 -0000
Date: Thu, 26 Apr 2001 11:52:39 -0400
From: Clint Adams <clint@zsh.org>
To: Bart Schaefer <schaefer@candle.brasslantern.com>
Cc: zsh-workers@sunsite.dk
Subject: Re: Or on ReliantUNIX ... RE: Make Failure on SunOS-4.1 (correction)
Message-ID: <20010426115239.B4344@dman.com>
References: <1010426143526.ZM13326@candle.brasslantern.com> <001101c0ce60$7621c200$21c9ca95@mow.siemens.ru> <20010426105825.A1957@dman.com> <1010426153244.ZM13520@candle.brasslantern.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <1010426153244.ZM13520@candle.brasslantern.com>; from schaefer@candle.brasslantern.com on Thu, Apr 26, 2001 at 03:32:44PM +0000

> Either it should be tested in getterm{info,cap}, or removed entirely.

Hmm, good point.

Index: Src/Modules/termcap.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/termcap.c,v
retrieving revision 1.11
diff -u -r1.11 termcap.c
--- Src/Modules/termcap.c	2001/04/26 15:48:17	1.11
+++ Src/Modules/termcap.c	2001/04/26 15:51:02
@@ -147,10 +147,6 @@
     BUILTIN("echotc", 0, bin_echotc, 1, -1, 0, NULL, NULL),
 };
 
-/* This says if we are cleaning up when the module is unloaded. */
-
-static int incleanup;
-
 /**/
 #ifdef HAVE_TGETENT
 
@@ -363,8 +359,6 @@
 int
 setup_(Module m)
 {
-    incleanup = 0;
-
     return 0;
 }
 
@@ -391,11 +385,7 @@
 {
 #ifdef HAVE_TGETENT
     Param pm;
-#endif
-
-    incleanup = 1;
 
-#ifdef HAVE_TGETENT
     if ((pm = (Param) paramtab->getnode(paramtab, termcap_nam)) &&
 	pm == termcap_pm) {
 	pm->flags &= ~PM_READONLY;
Index: Src/Modules/terminfo.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/terminfo.c,v
retrieving revision 1.16
diff -u -r1.16 terminfo.c
--- Src/Modules/terminfo.c	2001/04/24 06:48:54	1.16
+++ Src/Modules/terminfo.c	2001/04/26 15:51:02
@@ -109,10 +109,6 @@
     BUILTIN("echoti", 0, bin_echoti, 1, -1, 0, NULL, NULL),
 };
 
-/* This says if we are cleaning up when the module is unloaded. */
-
-static int incleanup;
-
 /**/
 #ifdef HAVE_TIGETSTR
 
@@ -337,8 +333,6 @@
 int
 setup_(Module m)
 {
-    incleanup = 0;
-
     return 0;
 }
 
@@ -365,11 +359,7 @@
 {
 #ifdef HAVE_TIGETSTR
     Param pm;
-#endif
-
-    incleanup = 1;
 
-#ifdef HAVE_TIGETSTR
     if ((pm = (Param) paramtab->getnode(paramtab, terminfo_nam)) &&
 	pm == terminfo_pm) {
 	pm->flags &= ~PM_READONLY;

