From zsh-workers-return-28146-mason-zsh=primenet.com.au@zsh.org Wed Aug 11 16:31:10 2010
Return-Path: <zsh-workers-return-28146-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25107 invoked by alias); 11 Aug 2010 16:31:10 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28146
Received: (qmail 14714 invoked from network); 11 Aug 2010 16:31:07 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_LOW,
	SPF_HELO_PASS autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at csr.com does not designate permitted sender hosts)
Date: Wed, 11 Aug 2010 17:30:59 +0100
From: Peter Stephenson <Peter.Stephenson@csr.com>
To: zsh-workers@zsh.org
Subject: Re: PATCH: Add $ZLE_STATE in zle widgets
Message-ID: <20100811173059.0bdd77cb@csr.com>
In-Reply-To: <877hjx6v9f.fsf@ft.bewatermyfriend.org>
References: <20100803105823.1232a42b@csr.com>
	<1280868200-11220-1-git-send-email-ft@bewatermyfriend.org>
	<87vd7n8p7u.fsf@ft.bewatermyfriend.org>
	<20100811130250.31da4e84@csr.com>
	<20100811134420.14c58317@csr.com>
	<87hbj171ik.fsf@ft.bewatermyfriend.org>
	<20100811154514.58e9c4a8@csr.com>
	<877hjx6v9f.fsf@ft.bewatermyfriend.org>
Organization: Cambridge Silicon Radio
X-Mailer: Claws Mail 3.7.6 (GTK+ 2.18.9; i686-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 11 Aug 2010 16:30:59.0662 (UTC) FILETIME=[94DAE6E0:01CB3972]
X-Scanned-By: MailControl A_09_40_00 (www.mailcontrol.com) on 10.68.0.163

On Wed, 11 Aug 2010 17:09:48 +0200
Frank Terbeck <ft@bewatermyfriend.org> wrote:
> > setopt promptsubst
> > PS1='$MYCONTEXT %# '
> > zle-line-init() {
> >   typeset -g MYCONTEXT=$CONTEXT
> >   zle reset-prompt
> > }
> > zle -N zle-line-init
> >
> > Now "vared -p $PS1" shows up "vared", otherwise I get "start" (or,
> > in principle, "cont").
> 
> But that would put the information in vared's PS1 and not in the one
> of the shell that called vared, wouldn't it? If I could do that, I'd
> know if vared is active even without using its `-p' option.
> 
> I could live with doing this, though:
>     vared() { builtin vared -p 'vared %% ' "$@" }

vared doesn't have a prompt by default, so unless you're passing it one (in
which case you can always do somethign like what you're suggesting) I don't
see how there can be a problem.  Do you really mean you want a default
prompt for vared?  A wrapper for vared would probably be the best way of
doing that.

You're not talking about some use of recursive editing to read information
while the line editor is active, are you?  You can't do that with vared,
since zle isn't recursive, but you can do it with recursive-edit.  For the
same reason there's no question of having a valid shell prompt outside
vared while vared is running --- vared with its prompt (or lack of one) is
the only instance of zle at that point, and when zle is next started you
get a fresh prompt.

-- 
Peter Stephenson <pws@csr.com>            Software Engineer
Tel: +44 (0)1223 692070                   Cambridge Silicon Radio Limited
Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, UK


Member of the CSR plc group of companies. CSR plc registered in England and Wales, registered number 4187346, registered office Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, United Kingdom

