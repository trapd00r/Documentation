From zsh-workers-return-14820-mason-zsh=primenet.com.au@sunsite.dk Sat Jun 09 05:01:53 2001
Return-Path: <zsh-workers-return-14820-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8198 invoked from network); 9 Jun 2001 05:01:52 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 9 Jun 2001 05:01:52 -0000
Received: (qmail 9012 invoked by alias); 9 Jun 2001 05:01:29 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14820
Received: (qmail 9001 invoked from network); 9 Jun 2001 05:01:25 -0000
X-Authentication-Warning: candle.brasslantern.com: schaefer set sender to lantern@shell10.ba.best.com using -f
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010609045924.ZM6260@candle.brasslantern.com>
Date: Sat, 9 Jun 2001 04:59:24 +0000
In-Reply-To: <yehd78epir3.fsf@water.cs.brown.edu>
Comments: In reply to Timothy Miller <tsm@cs.brown.edu>
        "zsh 4.0.1 make check failures on irix, freebsd, solaris, aix, linux" (Jun  8,  9:03pm)
References: <yehd78epir3.fsf@water.cs.brown.edu>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Timothy Miller <tsm@cs.brown.edu>, zsh-workers@sunsite.dk
Subject: Re: zsh 4.0.1 make check failures on irix, freebsd, solaris, aix, linux
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

Thanks for the feedback, Tim ...

On Jun 8,  9:03pm, Timothy Miller wrote:
} 
} I seem to be getting make check failures on the new version of zsh on all
} the architectures we have around here!

The failures in Y03 are a known problem that occurred as a result of a
last-minute patch for a different problem.  A fix has been applied to the
CVS repository at SourceForge <https://sourceforge.net/cvs/?group_id=4068>.
You will probably want to "cvs -d ... co -r zsh-4_0-patches".

} On Irix 6.3, gcc 2.8.0, C02, Y01, Y02, Y03 fail. Y0[123] appear to be due to 
} zpty failure, which is documented as a lack of support, so I don't include
} them (just C02). Using the SGI cc gives essentially the same result.

The -N test is known to fail on NFS filesystems.  Is your build dir NFS'd?

} On Irix 6.5, gcc 2.91.66, again fails C02
} On Solaris 2.7 (Sunos 5.7), gcc 2.95.3, C02

Test ./C02cond.ztst failed: bad status 1, expected 0 from:
  [[ -g modish && ! -g zerolength ]]

I tend to think this is NFS-related as well; the test is initialized by
trying to chmod a directory for set-group-id.  Depending on the NFS
mount options and whether the current user's default group exists on
the remote server, that might not be possible.

} On RedHat 7.0 linux 2.2.16 gcc 2.96 20000731, C02

Test ./C02cond.ztst failed: bad status 1, expected 0 from:
  if ! grep '#define HAVE_FIFOS' $ZTST_testdir/../config.h; then
    print -u8 'Warning: Not testing [[ -p pipe ]] (FIFOs not supported)'
    [[ ! -p zerolength ]]
  else
    if whence mkfifo && mkfifo pipe || mknod pipe p; then
      [[ -p pipe && ! -p zerolength ]]
    else
      print -u8 'Warning: Not testing [[ -p pipe ]] (cannot create FIFO)'
      [[ ! -p zerolength ]]
    fi
  fi

I suspect NFS again, particularly if one of the SGI machines is your NFS
server.  I wouldn't expect a FIFO created on an NFS filesystem to work
properly (though it should when both client and server are Linux).

} On aix 4.3.2, gcc 2.91.66 fails completely, installed zsh has an error being 
} unable to find libzsh-...

Yes, we're just having a discussion about that.  Unfortunately none of
the developers has direct access to an AIX machine.

} determined that the link line for both gcc and cc lacks -L to tell it where
} to find libzsh-... Adding that manually produced a zsh which ran and
} immediately segfaulted (even with -f).

The -L information is helpful, thanks (in fact, if you could post a short
manual excerpt relating to it that might be helpful too).

} I then tried the system cc, with
} configure --disable-dynamic and all modules set to link=static in
} config.modules, and that finally ran, but failed A04 and C02

This one (A04) is a race condition in the test and does not represent
an actual failure:

! foo: doo be doo be doo
! bar: doo be doo be doo
--- 1,2 ----
! foo: 
! bar: 
Test ./A04redirect.ztst failed: output differs from expected as shown above
for:
  print "foo: $(<foo)\nbar: $(<bar)"
Was testing: read 2-file multio

The C02 failure is the -g one already discussed above.  If NFS is not
involved, please try running:
	mkdir modish
	chmod g+xs modish
	ls -l modish
and see whether `modish' appears to have its setgid bit set.

} but, surprisingly, not Y03.

That is surprising.  My guess is it never got tried.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

