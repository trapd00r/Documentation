From zsh-users-return-13277-mason-zsh=primenet.com.au@sunsite.dk Mon Sep 22 22:52:28 2008
Return-Path: <zsh-users-return-13277-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10197 invoked from network); 22 Sep 2008 22:52:26 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-0.7 required=5.0 tests=AWL,BAYES_00,SUBJ_RE_NUM
	autolearn=no version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 22 Sep 2008 22:52:26 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 42040 invoked from network); 22 Sep 2008 22:52:02 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 22 Sep 2008 22:52:02 -0000
Received: (qmail 19356 invoked by alias); 22 Sep 2008 22:51:37 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13277
Received: (qmail 19338 invoked from network); 22 Sep 2008 22:51:36 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 22 Sep 2008 22:51:36 -0000
Received: from smtp.tt-solutions.com (sunset.tt-solutions.com [82.238.156.189])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 06A6B8030847
	for <zsh-users@sunsite.dk>; Tue, 23 Sep 2008 00:51:32 +0200 (CEST)
Received: from nightfall ([192.168.17.76])
	by smtp.tt-solutions.com with esmtp (Exim 4.63)
	(envelope-from <vz-zsh@zeitlins.org>)
	id 1KhuFf-0005KJ-IM
	for zsh-users@sunsite.dk; Tue, 23 Sep 2008 00:51:31 +0200
Date: Tue, 23 Sep 2008 00:51:31 +0200
From: Vadim Zeitlin <vz-zsh@zeitlins.org>
Subject: Re[2]: svn completion under Cygwin
To: zsh-users@sunsite.dk
MIME-Version: 1.0
Content-Type: MULTIPART/SIGNED; protocol="application/pgp-signature"; micalg=pgp-sha1; BOUNDARY="461812197-134-1222123891=:1580"
References: <20080915163326.05A4C809A183@bifrost.dotsrc.org><20080916104240.24559824@news01><20080919103226.1592E802720D@bifrost.dotsrc.org> <20080922192357.6940f0ae@pws-pc>
In-Reply-To: <20080922192357.6940f0ae@pws-pc>
X-Mailer: Mahogany 0.67.2 'Constance', running under Windows Server 2003 (build 3790, Service Pack 1)
Message-Id: <20080922225133.06A6B8030847@bifrost.dotsrc.org>
X-Virus-Scanned: ClamAV 0.92.1/8310/Mon Sep 22 20:58:13 2008 on bifrost
X-Virus-Status: Clean

--461812197-134-1222123891=:1580
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII
Content-Disposition: INLINE

On Mon, 22 Sep 2008 19:23:57 +0100 Peter Stephenson <p.w.stephenson@ntlworld.com> wrote:

PS> On Fri, 19 Sep 2008 12:32:25 +0200
PS> Vadim Zeitlin <vz-zsh@zeitlins.org> wrote:
PS> >  Sorry, I couldn't find anything about it at 
PS> > 
PS> > 	http://www.zsh.org/mla/workers/2008/threads.html
PS> > 
PS> > and I also have no idea how to make Cygwin to translate the Windows-style
PS> > filenames to POSIX ones automatically (and to be honest would be rather
PS> > surprised if it were possible). Could you have meant using cygpath to do
PS> > the conversion instead of a simple tr?
PS> 
PS> No, it's internal to the programme.  We already have the following code,
PS> 
PS> /**/
PS> mod_export void
PS> cygwin_premain0 (int argc, char **argv, void *myself)
PS> {
PS>     static struct __cygwin_perfile pf[] =
PS>     {
PS>         {"", O_RDONLY | O_TEXT},
PS>         {NULL, 0}
PS>     };
PS>     cygwin_internal (CW_PERFILE, pf);
PS> }
PS> 
PS> to do something of the kind for some files opened by the shell, but it
PS> apparently doesn't cover everything we might need.  That's all I know on
PS> the subject.

 I'm afraid I'm missing something obvious but does this really have
anything to do with replacing backslashes with slashes? I'd naively expect
the above to help with DOS/Unix EOL conversion and while the official
documentation (http://www.cygwin.com/cygwin-api/func-cygwin-internal.html)
doesn't say anything else than "Stay away unless you know what you're
doing." (good advice but not very useful), it looks like a lot of programs
use it for this.

 But, once again, the problem with svn completion under Cygwin is *not* due
to CR LF trouble but to the fact that the native Win32 svn.exe outputs the
file paths with backslashes and not slashes as the completion code expects.
Let me repost my trivial patch which fixes the completion for me:

--- _subversion.orig    2008-09-15 18:29:24.788071400 +0200
+++ _subversion 2008-09-15 18:29:33.412740200 +0200
@@ -194,7 +194,7 @@
   local pat="${1:-([ADMR~]|?M)}"

   if (( ! $+_cache_svn_status[$dir] )); then
-    _cache_svn_status[$dir]="$(_call_program files svn status -N $dir)"
+    _cache_svn_status[$dir]="$(_call_program files svn status -N $dir) | tr '\\' '/'"
   fi

   (( ${(M)#${(f)_cache_svn_status[$dir]}:#(#s)${~pat}*$REPLY} ))


 As you can see it simply forces the paths to use slashes and I've never
heard about Cygwin doing this automatically. This doesn't mean it can't,
it's full of black magic, but I couldn't find any mention of it.

 Regards, 
VZ

--461812197-134-1222123891=:1580
Content-Type: APPLICATION/PGP-SIGNATURE

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (MingW32)

iEYEABECAAYFAkjYIXMACgkQBupB3k9sHoYesQCfbYCR+BnBKPQe01MVgYvVDqs4
GxsAn3gH/zieOaOnqtDvHotV6qwaDiOt
=nK1W
-----END PGP SIGNATURE-----

--461812197-134-1222123891=:1580--

