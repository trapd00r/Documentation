From zsh-workers-return-21152-mason-zsh=primenet.com.au@sunsite.dk Sun Apr 17 17:35:40 2005
Return-Path: <zsh-workers-return-21152-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4156 invoked from network); 17 Apr 2005 17:35:39 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 17 Apr 2005 17:35:39 -0000
Received: (qmail 91590 invoked from network); 17 Apr 2005 17:35:34 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Apr 2005 17:35:34 -0000
Received: (qmail 24370 invoked by alias); 17 Apr 2005 17:35:30 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21152
Received: (qmail 24349 invoked from network); 17 Apr 2005 17:35:29 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 17 Apr 2005 17:35:29 -0000
Received: (qmail 91310 invoked from network); 17 Apr 2005 17:35:29 -0000
Received: from main.gmane.org (HELO ciao.gmane.org) (80.91.229.2)
  by a.mx.sunsite.dk with SMTP; 17 Apr 2005 17:35:23 -0000
Received: from root by ciao.gmane.org with local (Exim 4.43)
	id 1DNDbc-0007NG-BW
	for zsh-workers@sunsite.dk; Sun, 17 Apr 2005 19:30:48 +0200
Received: from p5481b9b5.dip.t-dialin.net ([84.129.185.181])
        by main.gmane.org with esmtp (Gmexim 0.1 (Debian))
        id 1AlnuQ-0007hv-00
        for <zsh-workers@sunsite.dk>; Sun, 17 Apr 2005 19:30:48 +0200
Received: from stephen.rueger by p5481b9b5.dip.t-dialin.net with local (Gmexim 0.1 (Debian))
        id 1AlnuQ-0007hv-00
        for <zsh-workers@sunsite.dk>; Sun, 17 Apr 2005 19:30:48 +0200
X-Injected-Via-Gmane: http://gmane.org/
To: zsh-workers@sunsite.dk
From:  Stephen Rueger <stephen.rueger@rechnerpost.org>
Subject:  Re: PATCH: _module-assistant
Date:  Sun, 17 Apr 2005 18:59:57 +0200
Lines: 91
Message-ID:  <d9haj2-v1s.ln1@rechnerpost.org>
References:  <20050417161535.GA31655@scowler.net>
X-Complaints-To: usenet@sea.gmane.org
X-Gmane-NNTP-Posting-Host: p5481b9b5.dip.t-dialin.net
User-Agent: nn/6.6.5+RFC1522
Sender: news <news@sea.gmane.org>
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=6.0 tests=AWL,BAYES_00,
	SUBJ_HAS_UNIQ_ID autolearn=no version=3.0.2
X-Spam-Hits: -1.9

Hi.

Please incorporate whatever you want from my version of _module-assistant

#compdef module-assistant m-a

_module-assistant() {
  _arguments - -A \
    '(-t --text)'{-t,--text}"[don't use dialog UI]" \
    '(-k --kerneldir)'{-k,--kerneldir}'[kernel source directory]:kernel source directory:_files -/' \
    '(-l --kvers-list)'{-l,--kvers-list}'[list of kernel version numbers]:kernel version number:' \
    '(-v --verbose)'{-v,--verbose}'[show more informations]' \
    '(-n --no-rebuild)'{-n,--no-rebuild}'[don''t rebuild existing packages]' \
    '(-f --force)'{-f,--force}'[force build/download]' \
    '(-u --user-dir)'{-u,--user-dir}'[override default dir]:directory:_files -/' \
    '(-i --ignore-failures)'{-i,--ignore-failures}'[ignore failed builds]' \
    '(-s --apt-search)'{-s,--apt-search}'[use apt-cache for searching]' \
    '(-h --help)'{-h,--help}'[print usage overview]' \
    '*::command:_m-a-commands'
}

_m-a-commands() {
  local cmd ret=1 m_a_commands

  m_a_commands=(
    update:"synchronize version index files"
    prepare:"install required kernel headers package"
    fakesource:"install required kernel source package"
    list:"a print a list of details about available packages"
    list-available:"b print a list of details about available packages "
    la:"c print a list of details about available packages  "
    list-installed:" print a list of details about installed packages "
    li:"print a list of details about installed packages  "
    search:"search for packages"
    get:"install specified source package"
    build:"build specified packages"
    install:"install specified packages"
    auto-install:"do all necessary steps to install specified packages"
    clean:"clear build directories of the kernel packages"
    purge:"clear cache and remove all binary packages of source package"
  )

  if (( CURRENT == 1 )); then
    _describe -t commands 'module-assistant command' m_a_commands
  else
    case $words[1] in
      (update|prepare|fakesource|clean)
        cmd=noop
        ;;
      (list*|la|li|search)
        cmd=ep
        ;;
      (get|build|(|auto-)install|purge)
        cmd=bp
        ;;
    esac

    _tags commands && _call_function ret _m-a-$cmd
  fi
  return ret
}

_m-a-noop() {
  _message nothing
}

_m-a-bp() {
  _wanted "package" expl "source package" \
    compadd -- /var/cache/modass/*.avail_version(:t:r)
    #compadd -- /usr/share/modass/packages/^generic.sh(:t)

    # which one of the above is better? don't know enough about m-a to
    # decide :-/
}

_m-a-ep() {
  _wanted "package" expl "source package" \
    compadd -- /var/cache/modass/*.avail_version(:t:r) all alli
    #compadd -- /usr/share/modass/packages/^generic.sh(:t) all alli

    # which one of the above is better? don't know enough about m-a to
    # decide :-/
}

_module-assistant "$@"



-- 
Stephen Rüger
stephen.rueger@rechnerpost.org

