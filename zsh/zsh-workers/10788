From zsh-workers-return-10788-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Apr 17 10:44:23 2000
Return-Path: <zsh-workers-return-10788-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5749 invoked from network); 17 Apr 2000 10:44:21 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Apr 2000 10:44:21 -0000
Received: (qmail 1969 invoked by alias); 17 Apr 2000 10:43:02 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10788
Received: (qmail 1952 invoked from network); 17 Apr 2000 10:43:01 -0000
Date: Mon, 17 Apr 2000 12:42:45 +0200 (MET DST)
Message-Id: <200004171042.MAA10628@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Peter Stephenson's message of Mon, 17 Apr 2000 10:08:00 +0100
Subject: PATCH: newlines in job-texts (was: Re: Questions)


Peter Stephenson wrote:

> > Would anyone object if I applied the patch below to make newlines in
> > strings in the job text be output as spaces (keeping the `jobs' output 
> > better readable)?
> 
> It's a good idea to keep the job text on one line for any kind of automated
> use, too.

Right.

Bye
 Sven

Index: Src/text.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/text.c,v
retrieving revision 1.2
diff -u -r1.2 text.c
--- Src/text.c	2000/04/01 20:49:48	1.2
+++ Src/text.c	2000/04/17 10:41:29
@@ -58,6 +58,7 @@
 taddstr(char *s)
 {
     int sl = strlen(s);
+    char c;
 
     while (tptr + sl >= tlim) {
 	int x = tptr - tbuf;
@@ -68,8 +69,8 @@
 	tlim = tbuf + tsiz;
 	tptr = tbuf + x;
     }
-    strcpy(tptr, s);
-    tptr += sl;
+    while ((c = *s++))
+	*tptr++ = (c == '\n' ? ' ' : c);
 }
 
 /**/

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

