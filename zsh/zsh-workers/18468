From zsh-workers-return-18468-mason-zsh=primenet.com.au@sunsite.dk Thu Apr 24 09:06:31 2003
Return-Path: <zsh-workers-return-18468-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5887 invoked from network); 24 Apr 2003 09:06:30 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 24 Apr 2003 09:06:30 -0000
Received: (qmail 6742 invoked by alias); 24 Apr 2003 09:06:25 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18468
Received: (qmail 6733 invoked from network); 24 Apr 2003 09:06:25 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 24 Apr 2003 09:06:25 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [212.125.75.4] by sunsite.dk (MessageWall 1.0.8) with SMTP; 24 Apr 2003 9:6:24 -0000
Received: (qmail 21080 invoked from network); 24 Apr 2003 09:06:12 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-16.tower-1.messagelabs.com with SMTP; 24 Apr 2003 09:06:12 -0000
Received: from gmcs3.logica.co.uk ([158.234.142.61])
	by iris.logica.co.uk (8.9.3/8.9.3/Debian 8.9.3-21) with ESMTP id KAA16695
	for <zsh-workers@sunsite.dk>; Thu, 24 Apr 2003 10:06:11 +0100
X-Authentication-Warning: iris.logica.co.uk: Host [158.234.142.61] claimed to be gmcs3.logica.co.uk
Received: from gmcs3.logica.co.uk (localhost [127.0.0.1])
	by gmcs3.logica.co.uk (8.11.6/8.11.6/SuSE Linux 0.5) with ESMTP id h3O968K02300
	for <zsh-workers@sunsite.dk>; Thu, 24 Apr 2003 11:06:08 +0200
To: zsh-workers@sunsite.dk
X-VirusChecked: Checked
In-reply-to: <1030423165343.ZM13391@candle.brasslantern.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <20030401151646.34142.qmail@web10411.mail.yahoo.com> <22800.1051093022@gmcs3.logica.co.uk> <1030423165343.ZM13391@candle.brasslantern.com>
Subject: Re: PATCH: Re: Bug with _perl_builtin_funcs 
Date: Thu, 24 Apr 2003 11:06:08 +0200
Message-ID: <2298.1051175168@gmcs3.logica.co.uk>

Bart wrote:
> On Apr 23, 12:17pm, Oliver Kiddle wrote:
> } Subject: PATCH: Re: Bug with _perl_builtin_funcs
> }
> } On 1 Apr, Felix Rosencrantz wrote:
> } > it parses the man page it assume it is plain text.  However, on RH
> } > the man page is compressed with gzip.
> } 
> } This should make it use bzip2 or gzip as appropriate.
> 
> Why not parse the output of "perldoc perlfunc" instead?

As I don't ever use perldoc, I was just looking for the minimal easy fix
and throwing in a case statement to run gzcat/bzcat/cat on a file seemed
easier than anything which would involve rewriting the parsing.

And it seemed to make sense that parsing troff source is easier than
the formatted output so I didn't think much about it. However, I just
looked at the perldoc man page and it seems that I can get POD source
by using perldoc -u (so _perldoc is clearly very minimal). That's nice
and easy to parse and yields this, much shorter function:

#autoload

local expl

: ${(A)_perl_builtin_funcs:=${(u)${${(M)${(f)"$(_call_program functions \
    perldoc -u perlfunc)"}:#\=item [a-z]*}#* }%%[^a-z]*}}

_wanted functions expl 'perl built-in function' compadd "$@" -a - \
    _perl_builtin_funcs

