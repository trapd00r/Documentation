From zsh-workers-return-17640-mason-zsh=primenet.com.au@sunsite.dk Mon Sep 09 14:44:00 2002
Return-Path: <zsh-workers-return-17640-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8965 invoked from network); 9 Sep 2002 14:43:59 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 9 Sep 2002 14:43:59 -0000
Received: (qmail 13115 invoked by alias); 9 Sep 2002 14:43:51 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 17640
Received: (qmail 13094 invoked from network); 9 Sep 2002 14:43:49 -0000
Message-ID: <20020909144347.76540.qmail@web10403.mail.yahoo.com>
Date: Mon, 9 Sep 2002 07:43:47 -0700 (PDT)
From: Felix Rosencrantz <f_rosencrantz@yahoo.com>
Subject: adding mkdir to _store_cache
To: zsh-workers@sunsite.auc.dk
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

Would anyone object to adding an additional mkdir to the _store_cache function.

This would allow a cache identifier to contain slashes, basically a simple
attempt at having caches that can be per file.

Here is the suggested patch.

-FR.
Index: Completion/Base/Utility/_store_cache
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Base/Utility/_store_cache,v
retrieving revision 1.2
diff -u -r1.2 _store_cache
--- Completion/Base/Utility/_store_cache	16 Apr 2002 07:48:45 -0000	1.2
+++ Completion/Base/Utility/_store_cache	9 Sep 2002 02:19:26 -0000
@@ -2,7 +2,7 @@
 #
 # Storage component of completions caching layer
 
-local _cache_ident
+local _cache_ident _cache_ident_dir
 _cache_ident="$1"
 
 if zstyle -t ":completion:${curcontext}:" use-cache; then
@@ -20,6 +20,21 @@
       fi
     fi
   fi
+  _cache_ident_dir="$_cache_dir/$_cache_ident"
+  _cache_ident_dir="$_cache_ident_dir:h"
+  
+  if [[ ! -d "$_cache_ident_dir" ]]; then
+    if [[ -e "$_cache_ident_dir" ]]; then
+      _message "cache ident dir points to a non-directory:$_cache_ident_dir"
+    else
+      mkdir -p "$_cache_ident_dir"
+      if [[ ! -d "$_cache_ident_dir" ]]; then
+        _message "couldn't create cache-ident_dir $_cache_ident_dir"
+        return 1
+      fi
+    fi
+  fi
+  
 
   shift
   for var; do



__________________________________________________
Do You Yahoo!?
Yahoo! Finance - Get real-time stock quotes
http://finance.yahoo.com

