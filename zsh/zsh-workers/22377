From zsh-workers-return-22377-mason-zsh=primenet.com.au@sunsite.dk Sat Mar 25 15:12:15 2006
Return-Path: <zsh-workers-return-22377-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29936 invoked from network); 25 Mar 2006 15:12:13 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.1 (2006-03-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 Mar 2006 15:12:13 -0000
Received: (qmail 81554 invoked from network); 25 Mar 2006 15:12:04 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 25 Mar 2006 15:12:04 -0000
Received: (qmail 18146 invoked by alias); 25 Mar 2006 15:12:02 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22377
Received: (qmail 18136 invoked from network); 25 Mar 2006 15:12:01 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 25 Mar 2006 15:12:01 -0000
Received: (qmail 81271 invoked from network); 25 Mar 2006 15:12:01 -0000
Received: from acolyte.scowler.net (216.254.112.45)
  by a.mx.sunsite.dk with SMTP; 25 Mar 2006 15:12:00 -0000
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id 0441970059; Sat, 25 Mar 2006 10:11:55 -0500 (EST)
Date: Sat, 25 Mar 2006 10:11:55 -0500
From: Clint Adams <schizo@debian.org>
To: zsh-workers@sunsite.dk
Cc: 355430-forwarded@bugs.debian.org, Jay Berkenbilt <qjb@debian.org>
Subject: Re: Bug#355430: zsh: acroread completion prints debugging information
Message-ID: <20060325151155.GA21370@scowler.net>
Mail-Followup-To: zsh-workers@sunsite.dk, 355430-forwarded@bugs.debian.org,
	Jay Berkenbilt <qjb@debian.org>
References: <20060305163923.12356.23913.reportbug@soup.q.ql.org> <20060306020302.GA6489@scowler.net> <20060325095217.2524443157.qww314159@soup.q.ql.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20060325095217.2524443157.qww314159@soup.q.ql.org>
User-Agent: Mutt/1.5.11+cvs20060126

> Sorry to have taken so long to do this.  The output contains a my
> entire environment among other things, so I was reluctant to just
> blindly paste it into a bug report without further study.  Upon
> looking into the problem, it turns out that the problem is caused by
> the fact that my /usr/bin/acroread is this shell script:
> 
> #!/bin/sh
> exec /usr/lib/Acrobat7.0/bin/acroread ${1+"$@"}
> 
> In the olden days, it used to not work to make /usr/bin/acroread a
> link to the actual acroread binary, but this does appear to work now.
> The way I found this was to do setopt -x before acroread TAB and to
> see that the loads of extra output I got started after evaluating line
> 7 of _acroread which shown here including the preceding comment:
> 
>   # Try extracting the version number directly from the executable.
>   # (This will fail if the executable is a wrapper script for acroread.)
>   local ver=${${${(f)"$(<$commands[$words[1]])"}:#^ver=*}##ver=}
> 
> I'm afraid my zsh isn't good enough to figure out what's happening
> there without consulting the manual.  Anyway, it seems this more than
> just fails if acroread is a wrapper, it actually causes this problem.
> 
> If you are able to reproduce the problem by putting the above script
> in your path as acroread, then hopefully I have provided sufficient
> information.  Otherwise, I will sanitize the output that I get so that
> it is suitable for public dissemination.  Anyway, here's the beginning
> of the output:
> 
> integer 10 readonly '!'=0
> integer 10 readonly '#'=0
> integer 10 readonly '$'=25511
[...]

What's happening is that that line is being run as "local" without the
argument.  Why?

