From zsh-workers-return-19626-mason-zsh=primenet.com.au@sunsite.dk Mon Mar 15 18:54:40 2004
Return-Path: <zsh-workers-return-19626-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1487 invoked from network); 15 Mar 2004 18:54:39 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 15 Mar 2004 18:54:39 -0000
Received: (qmail 7297 invoked by alias); 15 Mar 2004 18:54:26 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19626
Received: (qmail 7261 invoked from network); 15 Mar 2004 18:54:26 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 15 Mar 2004 18:54:26 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [66.93.131.57] by sunsite.dk (MessageWall 1.0.8) with SMTP; 15 Mar 2004 18:54:25 -0000
Received: from lorien.emufarm.org (localhost [127.0.0.1])
	by lorien.emufarm.org (8.12.7/8.12.7) with ESMTP id i2FIsM1t032324;
	Mon, 15 Mar 2004 10:54:22 -0800
Received: (from duvall@localhost)
	by lorien.emufarm.org (8.12.7/8.12.7/Submit) id i2FIsLjC032322;
	Mon, 15 Mar 2004 10:54:21 -0800
Date: Mon, 15 Mar 2004 10:54:21 -0800
From: Danek Duvall <duvall@emufarm.org>
To: zsh-workers@sunsite.dk
Subject: patch to call release_pgrp() on exit
Message-ID: <20040315185421.GB31418@lorien.emufarm.org>
Mail-Followup-To: Danek Duvall <duvall@emufarm.org>, zsh-workers@sunsite.dk
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="5vNYLRcllDrimb99"
Content-Disposition: inline
User-Agent: Mutt/1.5.4i


--5vNYLRcllDrimb99
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

This patch was posted in 19140, but seems not to have been applied.
It's needed to get exiting from su working properly (without it, it
looks like the su shell is suspended, but foregrounding it makes it go
away).

I know there was some discussion at the time of how necessary this patch
was, but unless someone can point me to the specific misbehavior of
Solaris su, I'll need to include this patch for the Solaris build of
zsh (as I did for 4.1.1).

Can it make it into 4.2?

Thanks,
Danek

--5vNYLRcllDrimb99
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="pgrp.patch"

--- Src/builtin.c.orig	Fri Sep 26 11:38:52 2003
+++ Src/builtin.c	Fri Sep 26 11:39:19 2003
@@ -3977,6 +3977,9 @@
     if (sigtrapped[SIGEXIT])
 	dotrap(SIGEXIT);
     runhookdef(EXITHOOK, NULL);
+    if (opts[MONITOR] && interact && (SHTTY != -1)) {
+	release_pgrp();
+    }
     if (mypid != getpid())
 	_exit(val);
     else

--5vNYLRcllDrimb99--

