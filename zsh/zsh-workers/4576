From zsh-workers-request@math.gatech.edu Fri Nov 06 09:32:24 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3185 invoked from network); 6 Nov 1998 09:32:22 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 6 Nov 1998 09:32:22 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id EAA17318;
	Fri, 6 Nov 1998 04:13:54 -0500 (EST)
Resent-Date: Fri, 6 Nov 1998 04:13:54 -0500 (EST)
Date: Fri, 6 Nov 1998 10:11:57 +0100 (MET)
Message-Id: <199811060911.KAA04730@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@math.gatech.edu
In-reply-to: "Bart Schaefer"'s message of Fri, 6 Nov 1998 00:57:29 -0800
Subject: Re: fixsuffix() again
Resent-Message-ID: <"RM2hF2.0.XE4.IthGs"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4576
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu



"Bart Schaefer" wrote:

> On Nov 6,  9:16am, Sven Wischnowsky wrote:
> } Subject: Re:  fixsuffix() again
> }
> } Bart Schaefer wrote:
> } > Sven, one of your patch hunks in zsh-workers/4510 removes a call to
> } > fixsuffix() from the top of docompletion().  Is this intentional or not?
> } 
> } I have no idea where this fixsuffix() in docompletion() comes from
> 
> Looks like Zefram added it when he did the 3.1.5 release.  It's not in
> any version I have in CVS until after I import the 3.1.5 code and merge.
> 
> } As I wrote in another message this may be a issue of personal
> } taste. If we put a fixsuffix() there any suffix on the line that is
> } autoremovable will become fixed when completion is tried in any way
> } (listing matches, completion with no matches, ...).
> 
> So you mean with that one call to fixsuffix() in docompletion() we can
> get rid of all the other calls to fixsuffix() scattered about in other
> places?  If so, then by golly I vote for putting that one back and
> nuking the others.

The one in deletecharorlist() will still be need since it is in the
branch where completion is noct called. So it would make two instead
of three calls in zle_tricky.c. The patch below does this, but note
that there is one ugliness:

In the main zsh directory do:

  ls Sr<TAB>

giving you

  ls Src/

now type C-d, you get the matches in Src, then type a space. With
fixsuffix() in docompletion() the slash is not removed, but with the
old style it is.

Bye
 Sven

*** os/Zle/zle_tricky.c	Fri Nov  6 10:09:42 1998
--- Src/Zle/zle_tricky.c	Fri Nov  6 10:10:19 1998
***************
*** 2927,2932 ****
--- 2927,2934 ----
  static void
  docompletion(char *s, int lst, int incmd)
  {
+     fixsuffix();
+ 
      HEAPALLOC {
  	pushheap();
  
***************
*** 4807,4814 ****
  	if (!ainfo)
  	    return;
  
- 	fixsuffix();
- 
  	/* Delete the old stuff from the command line. */
  	cs = wb;
  	foredel(we - wb);
--- 4809,4814 ----
***************
*** 4938,4945 ****
      if (!prpre) prpre = "";
      if (!ppre) ppre = "";
      if (!psuf) psuf = "";
- 
-     fixsuffix();
  
      if (!menucur) {
  	/* We are currently not in a menu-completion, *
--- 4938,4943 ----


--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

