From zsh-workers-return-17840-mason-zsh=primenet.com.au@sunsite.dk Fri Oct 18 22:31:49 2002
Return-Path: <zsh-workers-return-17840-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4111 invoked from network); 18 Oct 2002 22:31:48 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 18 Oct 2002 22:31:48 -0000
Received: (qmail 11106 invoked by alias); 18 Oct 2002 22:31:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 17840
Received: (qmail 11091 invoked from network); 18 Oct 2002 22:31:37 -0000
Message-ID: <20021018223134.9310.qmail@hithaeglir.lordzork.com>
Date: Fri, 18 Oct 2002 18:31:34 -0400
From: tmk@lordzork.com
To: zsh-workers@sunsite.dk
Subject: compiling zsh on an i686 for an i586 target
Reply-To: tmk@lordzork.com
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Organization: lordzork industries
X-GPG-Key-ID: 1024D/EE946A6E
X-GPG-Key-Fingerprint: E27C 03D8 A1B6 F7C5 2B92  58A9 4BEA 926A EE94 6A6E
X-GPG-Public-Key: http://lordzork.com/~zork/tmk.pub.asc
X-Mailer: Funmail 2.47 (Funmail: 80% more fun than the leading brand)
X-Originating-IP: [127.0.0.1]
X-Midgets: too tall

Greetings,

I have two i586 boxes on my network acting as dns/samba/dhcp/qmail
servers. One of these is a k6-2, the other is a 167 mhz Pentium. I need
to be able to compile zsh on my main i686 box (AMD Athlon) and have it
run on the i586s. So far the resulting zsh binary crashes immediately
upon execution as a result of an "illegal instruction".

All the boxes concerned are running glibc 2.3 under my own home-grown
brand of linux (2.4) with all of the standard GNU tools. I'm using the
latest zsh version, 4.0.6.

Zsh is configured as follows:

./configure  --prefix=/usr --bindir=/bin --enable-etcdir=/etc/zsh
--enable-maildir-support --build=i586-pc-linux-gnu
--host=i586-pc-linux-gnu --target=i586-pc-linux-gnu

After configure is finished running, I see among other things: 

host operating system     : i586-pc-linux-gnu
compiler                  : gcc
preprocessor flags        : -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
executable compiler flags :  -Wall -Wmissing-prototypes -O2
module compiler flags     :  -Wall -Wmissing-prototypes -O2 -fPIC
executable linker flags   :   -s -rdynamic
module linker flags       :   -s -shared
library flags             : -ldl -lnsl -lcurses -lm  -lc

The gcc version, by the way, is 3.2. I've also tried using 2.95.3 with
the same result. I'm using version 2.13.90.0.4 20020814 of binutils
(which was required to build glibc 2.3).

It seems rather odd to me that this isn't working, because I've
successfully compiled a lot of other i586 binaries on the i686,
including glibc. It's usually enough to just pass the --host= and
--build= options to configure and make sure the cflags are ok.

I did try to make an i586 cross-compiling environment, but gcc wouldn't
build this way. In any case, wouldn't this be unnescessary since the
basic architecture is the same?

If anyone has any ideas, I would very much appreciate hearing them. I
hope I've sent this to the right list; it seemed to me that it had to do
more with the guts of the shell than the driving of it.

t.


-- 
4.0k -rw-rw-r--    1 zork     zork       17 Apr 4 17:38 .signature

