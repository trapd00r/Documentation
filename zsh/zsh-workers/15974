From zsh-workers-return-15974-mason-zsh=primenet.com.au@sunsite.dk Mon Oct 08 10:33:56 2001
Return-Path: <zsh-workers-return-15974-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10624 invoked from network); 8 Oct 2001 10:33:55 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 8 Oct 2001 10:33:55 -0000
Received: (qmail 25274 invoked by alias); 8 Oct 2001 10:33:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15974
Received: (qmail 25243 invoked from network); 8 Oct 2001 10:33:43 -0000
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: Re: PATCH: (2) test for trap EXIT fix. 
In-reply-to: "Bart Schaefer"'s message of "Mon, 08 Oct 2001 09:56:31 -0000."
             <1011008095631.ZM3834@candle.brasslantern.com> 
Date: Mon, 08 Oct 2001 11:32:29 +0100
Message-ID: <485.1002537149@csr.com>
From: Peter Stephenson <pws@csr.com>

Bart Schaefer wrote:
> On Oct 8,  9:10am, Peter Stephenson wrote:
> }
> } I'm committing this, partly because it seems to make the shell reasonably
> } compatible with older versions
> 
> Did you also see my message about how this still doesn't quite act like
> bash (and presumably therefore not quite like the standard shell)?

Yes, but that's the same issue as whether falling off the end of the list
should trigger the trap.  The position of the `trap' command matters
because of the stuff in entersubsh() we discussed earlier.  I have a
trivial patch to fix this by calling the trap at the end of execcmd() if
the shell is forked and we are exiting (which is implied at that point if
the shell is forked).  This changes the behaviour, however, so I'm not sure
what to do.

> } but mainly because it saves me having to
> } edit it out when committing the zglob patch.
> 
> Does that mean you're putting the exit-trap patch onto the stable branch?

No, I meant to say that.  It's not yet stable enough.  But we should
document the bug in the 4.0 BUGS list.

I've committed the ChangeLog for the previous patches.

Index: Etc/BUGS
===================================================================
RCS file: /cvsroot/zsh/zsh/Etc/BUGS,v
retrieving revision 1.2
diff -u -r1.2 BUGS
--- Etc/BUGS	2000/04/07 15:01:03	1.2
+++ Etc/BUGS	2001/10/08 10:31:42
@@ -2,6 +2,10 @@
 KNOWN BUGS IN ZSH
 -----------------
 
+When a shell is exited from within a function, the only EXIT trap which is
+run is the one for the function itself, if any.  In particular, an EXIT
+trap set for the shell itself will not be executed in this case.
+------------------------------------------------------------------------
 On some terminals, display of lines with exactly 80 characters is
 problematic.  zsh assumes that the terminal does not print an extra
 newline in this case, but some terminals (e.g. aixterm) do.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR Ltd., Science Park, Milton Road,
Cambridge, CB4 0WH, UK                          Tel: +44 (0)1223 392070


**********************************************************************
The information transmitted is intended only for the person or
entity to which it is addressed and may contain confidential 
and/or privileged material. 
Any review, retransmission, dissemination or other use of, or
taking of any action in reliance upon, this information by 
persons or entities other than the intended recipient is 
prohibited.  
If you received this in error, please contact the sender and 
delete the material from any computer.
**********************************************************************

