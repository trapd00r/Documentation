From zsh-users-return-11650-mason-zsh=primenet.com.au@sunsite.dk Mon Jul 16 18:31:18 2007
Return-Path: <zsh-users-return-11650-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27884 invoked from network); 16 Jul 2007 18:31:15 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.1 (2007-05-02) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00,WHOIS_NETSOLPR
	autolearn=ham version=3.2.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Jul 2007 18:31:15 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 82328 invoked from network); 16 Jul 2007 18:31:09 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Jul 2007 18:31:09 -0000
Received: (qmail 11895 invoked by alias); 16 Jul 2007 18:31:00 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11650
Received: (qmail 11885 invoked from network); 16 Jul 2007 18:30:59 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 16 Jul 2007 18:30:59 -0000
Received: (qmail 80984 invoked from network); 16 Jul 2007 18:30:59 -0000
Received: from phsmgmx2.partners.org (155.52.251.33)
  by a.mx.sunsite.dk with SMTP; 16 Jul 2007 18:30:55 -0000
Received: from phsmgmx2.partners.org (localhost.localdomain [127.0.0.1])
	by localhost (Postfix) with SMTP id 887CC3E0043
	for <zsh-users@sunsite.dk>; Mon, 16 Jul 2007 14:30:54 -0400 (EDT)
Received: from PHSXCON5.partners.org (phsxcon5.mgh.harvard.edu [132.183.130.38])
	by phsmgmx2.partners.org (Postfix) with ESMTP id 591573E007E
	for <zsh-users@sunsite.dk>; Mon, 16 Jul 2007 14:30:54 -0400 (EDT)
Received: from PHSXMB8.partners.org ([170.223.201.59]) by PHSXCON5.partners.org with Microsoft SMTPSVC(6.0.3790.1830);
	 Mon, 16 Jul 2007 14:20:50 -0400
Received: from W0053328.mgh.harvard.edu.partners.org ([132.183.29.121]) by PHSXMB8.partners.org with Microsoft SMTPSVC(6.0.3790.1830);
	 Mon, 16 Jul 2007 14:20:50 -0400
To: zsh-users@sunsite.dk
Subject: Filename Generation (again)
From: jadamson@partners.org (Joel J. Adamson)
Date: Mon, 16 Jul 2007 14:20:05 -0400
Message-ID: <87odic43e2.fsf@W0053328.mgh.harvard.edu>
User-Agent: Gnus/5.11 (Gnus v5.11) Emacs/22.1 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-OriginalArrivalTime: 16 Jul 2007 18:20:50.0220 (UTC) FILETIME=[09A6BEC0:01C7C7D6]

Howdy List,

I wrote in about this filename generation a while ago.  I used a
suggestion from Peter Stephenson, and I thought that it worked, but
now I'm getting the same "no matches found".

As before, I get different behavior from within the doit() function
and at the command line.  In other words, I use this globbing pattern
found in the second line of the function doit() and I get the files I
want.  The script, however returns

----------------------------------------
doit:1: no matches found: /home/joel/data/*generic*~*~
----------------------------------------

Since the script is short, I'll post the whole thing:

----------------------------------------
#!/bin/zsh
#script to set up new data directory
# $Author$
# $Revision$
# $Date$
# this script needs some setup conditions that will help it to do its job
# 1.  establish the current path
# 2.  if options are blank or "help" is the only argument, then
# print a terse help message

doit () {
   for file in $1/*generic*~*\~	# help from Peter Stephenson
       do
       filename=${file##$1}
       newfilename=${filename/\/generic/$title}
       cp $file ./$newfilename
       ci -m'new analysis' -u -zLT $newfilename	
     done

     if [[ -a ${title}Makefile ]]; then
  	mv ./(generic|$title)Makefile ./Makefile
     else
  	print No Makefile found
     fi

     if [[ -a $1/data/wilens.bib ]]; then
 	ln -s $1/data/wilens.bib
     fi
    
     exit 0
}

if [[ $1 == *help* || -z $1 ]]; then
    print "DataDir v1.0
Usage: datadir -n new subdirectory [-o source for files] -t title for new analysis
See 'man datadir' for more information"
    exit 1
else

    local opt			# process options: n = new directory
				# t = title: new string for filenames
    while getopts n:o:t: opt; do

	case $opt in
	    (n) new=$OPTARG;;	# long options?
	    (o) old=$OPTARG;;
	    (t) title=$OPTARG;;
	esac

    done
    
    if [[ -d $new || -a $new ]]; then

	print File or directory $new exists	# this should probably do more, like
	exit 1				#ask for a new name

    else

	mkdir -p $new

    fi

# now the magic:
    cd $new
    mkdir RCS
    umask gu+rw

    if [[ -n  `find $old -iregex ".*generic.*[^~]"` ]]; then # what if
#    $old is not set?
	age=$old
    elif [[ -n  `find $HOME/data/ -iregex ".*generic.*[^~]"` ]]; then
# default location for generic files
	age=$HOME/data
    fi

    doit $age
fi
----------------------------------------

Thanks for any help,
Joel

-- 
Joel J. Adamson
Biostatistician
Pediatric Psychopharmacology Research Unit
Massachusetts General Hospital
Boston, MA  02114
(617) 643-1432
(303) 880-3109

*Getting unexpected output from Word?
http://www.youtube.com/watch?v=9sZtriK9rKQ&NR=1

*Try LaTeX: it's free, easy and professional
http://www.edafe.org/latex/
http://en.wikipedia.org/wiki/LaTeX
http://nitens.org/taraborelli/latex





The information transmitted in this electronic communication is intended only for the person or entity to whom it is addressed and may contain confidential and/or privileged material. Any review, retransmission, dissemination or other use of or taking of any action in reliance upon this information by persons or entities other than the intended recipient is prohibited. If you received this information in error, please contact the Compliance HelpLine at 800-856-1983 and properly dispose of this information.

