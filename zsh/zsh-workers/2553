From zsh-workers-request@euclid.skiles.gatech.edu Wed Dec 11 03:11:04 1996
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 17644 invoked from network); 11 Dec 1996 03:11:02 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 11 Dec 1996 03:11:02 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id VAA05398; Tue, 10 Dec 1996 21:56:28 -0500 (EST)
Resent-Date: Tue, 10 Dec 1996 21:56:28 -0500 (EST)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199612110056.BAA00648@hzoli.ppp.cs.elte.hu>
Subject: Re: Another missing HEAPALLOC
To: pws@ifh.de (Peter Stephenson)
Date: Wed, 11 Dec 1996 01:56:09 +0100 (MET)
Cc: zsh-workers@math.gatech.edu
In-Reply-To: <199612100857.JAA07347@hydra.ifh.de> from Peter Stephenson at "Dec 10, 96 09:57:28 am"
X-Mailer: ELM [version 2.4ME+ PL17 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"UN66e3.0.HK1.RBYho"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2553
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

> PERMALLOC is set in bin_cd for calling cd_get_dest(), but the
> parameter code in getnamedir() needs HEAPALLOC.  (Is this
> getstrvalue() test new?  I've only just started noticing the error
> messages.)  The following patch is chosen simply to make the minimum
> code reorganisation necessary, but maybe the HEAPALLOC needs to be
> further down in getstrvalue() or wherever, as Zoltan suggested.

Yes, this check in getstrvalue() is new.  I added this after Hrvoje Niksic
(it I remember correctly) discovered this memory leak with purify.  I have
changed it to USEHEAP as it seems to be more appropriate now, but it was
proved to quite useful as it allowed me to discover that zlogout scripts
are called with permalloc in effect when the shell exited with a zle
timeout (that's because I do not use zlogout but getsparam("HISTFILE")
invoked this warning).

Zoltan

