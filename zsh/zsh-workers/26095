From zsh-workers-return-26095-mason-zsh=primenet.com.au@sunsite.dk Thu Nov 27 17:04:02 2008
Return-Path: <zsh-workers-return-26095-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11730 invoked from network); 27 Nov 2008 17:03:58 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.3 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 27 Nov 2008 17:03:58 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 1081 invoked from network); 27 Nov 2008 17:03:54 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 27 Nov 2008 17:03:54 -0000
Received: (qmail 9720 invoked by alias); 27 Nov 2008 17:03:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26095
Received: (qmail 9704 invoked from network); 27 Nov 2008 17:03:49 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 27 Nov 2008 17:03:49 -0000
Received: from cluster-d.mailcontrol.com (cluster-d.mailcontrol.com [85.115.60.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 0EFDF80525B4
	for <zsh-workers@sunsite.dk>; Thu, 27 Nov 2008 18:03:45 +0100 (CET)
Received: from rly14d.srv.mailcontrol.com (localhost.localdomain [127.0.0.1])
	by rly14d.srv.mailcontrol.com (MailControl) with ESMTP id mARH3gX5015177
	for <zsh-workers@sunsite.dk>; Thu, 27 Nov 2008 17:03:42 GMT
Received: from submission.mailcontrol.com (submission.mailcontrol.com [86.111.216.190])
	by rly14d.srv.mailcontrol.com (MailControl) id mARH3aHT014584
	for zsh-workers@sunsite.dk; Thu, 27 Nov 2008 17:03:36 GMT
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly14d-eth0.srv.mailcontrol.com (envelope-sender Peter.Stephenson@csr.com) (MIMEDefang) with ESMTP id mARH3aEi014545; Thu, 27 Nov 2008 17:03:36 +0000 (GMT)
Received: from news01 ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 27 Nov 2008 17:03:36 +0000
Date: Thu, 27 Nov 2008 17:03:36 +0000
From: Peter Stephenson <pws@csr.com>
To: Elbert Pol <e.pol@chello.nl>, zsh-workers@sunsite.dk
Subject: Re: Os2
Message-ID: <20081127170336.798d5be4@news01>
In-Reply-To: <492ECBED.6020402@chello.nl>
References: <492ECBED.6020402@chello.nl>
Organization: CSR
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.8; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 27 Nov 2008 17:03:36.0642 (UTC) FILETIME=[165DDA20:01C950B2]
X-Scanned-By: MailControl A_08_51_00 (www.mailcontrol.com) on 10.68.1.124
X-Virus-Scanned: ClamAV 0.92.1/8688/Thu Nov 27 17:08:54 2008 on bifrost
X-Virus-Status: Clean

On Thu, 27 Nov 2008 17:33:49 +0100
Elbert Pol <e.pol@chello.nl> wrote:
> Hello,
> 
> I've try to port zsh to os2 and it fails with the "make"
> 
> I use Gcc v4.32
> 
> utils.c: In function 'adjustwinsize':
> utils.c:1537: error: 'struct ttyinfo' has no member named 'winsize'
> utils.c:1538: error: 'struct ttyinfo' has no member named 'winsize'
> make.exe[2]: *** [utils.o] Error 1
> make.exe[2]: Leaving directory `U:/zsh-4.3.9/Src'
> make.exe[1]: *** [modobjs] Error 2
> make.exe[1]: Leaving directory `U:/zsh-4.3.9/Src'
> make.exe: *** [all] Error 1
> Any thoughts ?

That's a bug in the source code.

Index: Src/utils.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/utils.c,v
retrieving revision 1.206
diff -u -r1.206 utils.c
--- Src/utils.c	30 Oct 2008 15:34:18 -0000	1.206
+++ Src/utils.c	27 Nov 2008 16:59:16 -0000
@@ -1534,8 +1534,10 @@
 adjustwinsize(int from)
 {
     static int getwinsz = 1;
+#ifdef TIOCGWINSZ
     int ttyrows = shttyinfo.winsize.ws_row;
     int ttycols = shttyinfo.winsize.ws_col;
+#endif
     int resetzle = 0;
 
     if (getwinsz || from == 1) {


-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

