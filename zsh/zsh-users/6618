From zsh-users-return-6618-mason-zsh=primenet.com.au@sunsite.dk Thu Sep 25 06:22:01 2003
Return-Path: <zsh-users-return-6618-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4796 invoked from network); 25 Sep 2003 06:22:00 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 25 Sep 2003 06:22:00 -0000
Received: (qmail 5170 invoked by alias); 25 Sep 2003 06:21:47 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 6618
Received: (qmail 5159 invoked from network); 25 Sep 2003 06:21:47 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 25 Sep 2003 06:21:47 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [216.136.128.126] by sunsite.dk (MessageWall 1.0.8) with SMTP; 25 Sep 2003 6:21:46 -0000
Message-ID: <20030925062145.66292.qmail@web10412.mail.yahoo.com>
Received: from [165.247.203.51] by web10412.mail.yahoo.com via HTTP; Wed, 24 Sep 2003 23:21:45 PDT
Date: Wed, 24 Sep 2003 23:21:45 -0700 (PDT)
From: Felix Rosencrantz <f_rosencrantz@yahoo.com>
Subject: Re: Ability to set HISTNO to a certain position from within zshrc
To: zsh-users <zsh-users@sunsite.dk>
In-Reply-To: <1030913231924.ZM16456@candle.brasslantern.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

This is quite a bit later, but here it goes....
--- Bart Schaefer <schaefer@brasslantern.com> wrote:
> } It almost seems like there should be a infer-back-into-history, where it
> } determines the inferred line, and jumps to it in history.
> 
> Isn't that what history-search-backward does?
History-search-backward looks at the first word of the current line, and then
searches for the next line back in history that starts with the same first
word. 

The "infer" widgets are funkier search widgets, they look at the previous
history line, look back past that line in history for that same line, and then
return the line following it.  Though it looks like all the infer widgets copy
the inferred line, none change HISTNO back to that line.

> 
> } Maybe even an accept-and-down-history-or-infer, which accepts,
> } attempts to go down in history, and if at the end of the history,
> } attempts to infer the next command.
> 
> I think all the tools are available to write this as a user-defined widget.
> As a crude stab at it:
> 
> aadhoi () {
>     local buffer="$BUFFER"
>     if zle down-history
>     then
>     	zle up-history
> 	BUFFER="$buffer"
> 	zle accept-line-and-down-history
>     else
> 	zle -U $'\exinfer-next-history\n'
> 	zle accept-and-hold
>     fi
> }

I tried this. (And thanks for the code!)  Though, I wasn't able to get it to
hit the else case. (Probably I'm doing something silly.) I looked at the zshzle
man page, it doesn't really say what kind of return value to expect from
down-history.  I looked at the source code for downhistory (I didn't look at
the code for those functions it called) and it looked that it would always
succeed if nohistbeep was set(!?). I didn't have it set, but tried using setopt
to change it without success.

As I said in the original message, I just wanted to set HISTNO from my .zshrc.
Though that's not possible.  It seems like some simple functionality is
missing; the ability to go to a history entry, and the ability to figure out
what the last entry is.  In some ways it seems like the zle widgets are not
fully oriented towards writing zle widgets. 

Though it is very easy to modify history by adding entries to history.  Based
on the code you sent, it even seems like it is difficult within a widget to
figure out if you're at the end of history.  You have to do an indirect test,
attempt to do a down-history and if that fails you are at the end.  

-FR.


__________________________________
Do you Yahoo!?
The New Yahoo! Shopping - with improved product search
http://shopping.yahoo.com

