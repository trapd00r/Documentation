From zsh-users-return-4032-mason-zsh=primenet.com.au@sunsite.dk Thu Jul 12 12:45:13 2001
Return-Path: <zsh-users-return-4032-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15661 invoked from network); 12 Jul 2001 12:45:11 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 12 Jul 2001 12:45:11 -0000
Received: (qmail 17905 invoked by alias); 12 Jul 2001 12:44:53 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4032
Received: (qmail 17894 invoked from network); 12 Jul 2001 12:44:52 -0000
MIME-Version: 1.0
From: Vincent Lefevre <vincent@vinc17.org>
To: zsh-users@sunsite.dk
Date: Thu, 12 Jul 2001 14:43:17 +0200
Subject: Re: [4.0.2 bug] commands not written to history
Message-ID: <4a98ea1d71vincent@vinc17.org>
In-Reply-To: <1010712033003.ZM31613@candle.brasslantern.com>
References: <20010629163348.A9632@greux.loria.fr>  	<1010629155017.ZM14989@candle.brasslantern.com>  	<4a9256987fvincent@vinc17.org>  	<1010630160614.ZM21128@candle.brasslantern.com>  	<20010712003459.A24126@greux.loria.fr>  	<20010712015910.A24326@greux.loria.fr> <1010712033003.ZM31613@candle.brasslantern.com>
User-Agent: Pluto/2.02e (RISC-OS/4.02) POPstar/2.03
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit

On 12 Jul, Bart Schaefer <schaefer@candle.brasslantern.com> wrote:

> Hrm.  Just because there's an entry in $HISTFILE doesn't mean that it's
> present in the shell history, of course.  With INC_APPEND_HISTORY set
> (as I believe you have), $HISTFILE may have up to $[SAVEHIST/5] extra
> commands stored in it.  (This is to avoid having to rewrite the entire
> file too frequently.)  But only $HISTSIZE of those commands is actually
> in memory (and thus searchable) at any given time.

But this wasn't the problem, as the history contained about 100 lines
(it was just after I used a new history file), and $HISTSIZE is 2000
here.

> Next time you see this happen, try running `fc -W temphistfile' and then
> `diff $HISTFILE temphistfile'.  You should see differences only at the
> beginning and possibly one or two commands at the end, not in the middle.
> If there are commands missing (or misordered) in the middle, then we'll
> have evidence of a real bug.

greux:~[Failed 130]> fc -W temphistfile                               <14:30:51
greux:~> diff $HISTFILE temphistfile                                  <14:35:11
112c112
< : 994936533:0;mail
---
> : 994937129:867;mail
116,120c116,119
< : 994939941:0;m $HISTFILE
< : 994939999:0;mail
< : 994940004:0;m $HISTFILE
< : 994940081:0;mail
< : 994940743:0;rem
---
> : 994939966:13;m $HISTFILE
> : 994939999:2;mail
> : 994940004:8;m $HISTFILE
> : 994940743:308;rem
122d120
< : 994941319:0;diff $HISTFILE temphistfile

Is it normal?

It seems that a "mail" command has disappeared from the history file.

> } It seems to be due to the fact that the time stamps are not in the
> } increasing order.

> Can you show an example of this, please?

This can be done by manually copying commands to the history file
(useful when starting with a new history file...). But even without
doing that:

[...]
: 994850317:0;emacs cshrc.loria
: 994850342:0;rl lepois
: 994850341:0;locale
[...]

But this is because host lepois wasn't synchronized, so a very special
case.

-- 
Vincent Lefèvre <vincent@vinc17.org> - Web: <http://www.vinc17.org/> - 100%
validated HTML - Acorn Risc PC, Yellow Pig 17, Championnat International des
Jeux Mathématiques et Logiques, TETRHEX, etc.
Work: CR INRIA - computer arithmetic / SPACES project at LORIA

