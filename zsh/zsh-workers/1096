From joda@pdc.kth.se Sun May 19 17:22:12 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3) with ESMTP id RAA07579 for <mason@werple.mira.net.au>; Sun, 19 May 1996 17:22:08 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id CAA12362; Sun, 19 May 1996 02:53:10 -0400 (EDT)
Resent-Date: Sun, 19 May 1996 02:53:10 -0400 (EDT)
To: zsh-workers@math.gatech.edu
Subject: Patches for Unicos 9
Mime-Version: 1.0 (generated by tm-edit 7.61)
Content-Type: multipart/mixed;
 boundary="Multipart_Sun_May_19_08:48:02_1996-1"
Content-Transfer-Encoding: 7bit
From: joda@pdc.kth.se (Johan Danielsson)
Date: 19 May 1996 08:52:32 +0200
Message-ID: <xofohnlp32n.fsf@emma.pdc.kth.se>
Lines: 129
X-Mailer: September Gnus v0.82/Emacs 19.30
Resent-Message-ID: <"UJCKk2.0.413.LLidn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1096
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 3764
Status: O

--Multipart_Sun_May_19_08:48:02_1996-1
Content-Type: text/plain; charset=US-ASCII

Here are some patches to make beta17 work with Cray Unicos 9.

This consists of two changes. First nawk believes that the string
"#else" means something to it. Changing to "\#else" seems to work ok.

Then join() is defined by the system (doing the same as join(1)), so I
changed its name to zjoin(). After this everything seems to work, but
there might be more problems - Crays *are* very unusual after all.

/Johan

--Multipart_Sun_May_19_08:48:02_1996-1
Content-Type: text/plain; charset=US-ASCII

--- signames.awk	1996/05/19 05:52:46	1.1
+++ signames.awk	1996/05/19 05:52:57
@@ -52,7 +52,7 @@
 
 END {
     ps = "%s"
-    ifdstr = sprintf("#ifdef USE_SUSPENDED\n\t%csuspended%s%c,\n#else\n\t%cstopped%s%c,\n#endif\n", 034, ps, 034, 034, ps, 034)
+    ifdstr = sprintf("#ifdef USE_SUSPENDED\n\t%csuspended%s%c,\n\#else\n\t%cstopped%s%c,\n#endif\n", 034, ps, 034, 034, ps, 034)
 
     printf("%s\n%s\n\n%s\t%d\n\n%s\n\n%s\n\t%c%s%c,\n", "/** signals.h                                 **/", "/** architecture-customized signals.h for zsh **/", "#define SIGCOUNT", max, "#ifdef GLOBALS", "char *sigmsg[SIGCOUNT+2] = {", 034, "done", 034)
 
@@ -87,7 +87,7 @@
     print "\tNULL"
     print "};"
     print ""
-    print "#else"
+    print "\#else"
     print "extern char *sigs[SIGCOUNT+4],*sigmsg[SIGCOUNT+2];"
     print "#endif"
 }
--- builtin.c	1996/05/19 05:58:31	1.1
+++ builtin.c	1996/05/19 06:31:15
@@ -4044,7 +4044,7 @@
     /* -z option -- push the arguments onto the editing buffer stack */
     if (ops['z']) {
 	permalloc();
-	pushnode(bufstack, ztrdup(join(args, *ifs)));
+	pushnode(bufstack, ztrdup(zjoin(args, *ifs)));
 	heapalloc();
 	return 0;
     }
@@ -4071,7 +4071,7 @@
 	    }
 	} else
 	    ent->words = (short *)NULL;
-	ent->text = ztrdup(join(args, ' '));
+	ent->text = ztrdup(zjoin(args, ' '));
 	ent->stim = ent->ftim = time(NULL);
 	ent->flags = 0;
 	heapalloc();
@@ -4540,9 +4540,9 @@
 {
     List list;
 
-    /* Safe not to copy join() return value, since *
+    /* Safe not to copy zjoin() return value, since *
      * join doesn't get used when parsing.         */
-    inpush(join(argv, ' '), 0);
+    inpush(zjoin(argv, ' '), 0);
     strinbeg();
     stophist = 2;
     list = parse_list();
@@ -5120,7 +5120,7 @@
     of scheduled commands. */
     sch = (struct schedcmd *) zcalloc(sizeof *sch);
     sch->time = t;
-    sch->cmd = ztrdup(join(argv, ' '));
+    sch->cmd = ztrdup(zjoin(argv, ' '));
     sch->next = NULL;
     for (sch2 = (struct schedcmd *)&schedcmds; sch2->next; sch2 = sch2->next);
     sch2->next = sch;
--- params.c	1996/05/19 05:56:07	1.1
+++ params.c	1996/05/19 06:01:46
@@ -654,7 +654,7 @@
     switch(PM_TYPE(v->pm->flags)) {
     case PM_ARRAY:
 	if (v->isarr)
-	    return join(v->pm->gets.afn(v->pm), *ifs);
+	    return zjoin(v->pm->gets.afn(v->pm), *ifs);
 
 	ss = v->pm->gets.afn(v->pm);
 	if (v->a < 0)
@@ -1281,7 +1281,7 @@
 char *
 colonarrgetfn(Param pm)
 {
-    return join(*(char ***)pm->data, ':');
+    return zjoin(*(char ***)pm->data, ':');
 }
 
 /**/
@@ -1307,7 +1307,7 @@
 char *
 colonpathgetfn(Param pm)
 {
-    return join(path, ':');
+    return zjoin(path, ':');
 }
 
 /* Function to set special (scalar) parameter `PATH'.     *
@@ -1739,7 +1739,7 @@
     int len_s;
     Param pm;
 
-    u = join(t, ':');
+    u = zjoin(t, ':');
     len_s = strlen(s);
     pm = (Param) paramtab->getnode(paramtab, s);
     for (ep = environ; *ep; ep++)
--- utils.c	1996/05/19 05:56:07	1.1
+++ utils.c	1996/05/19 05:59:56
@@ -1360,7 +1360,7 @@
 
 /**/
 char *
-join(char **arr, int delim)
+zjoin(char **arr, int delim)
 {
     int len = 0;
     char **s, *ret, *ptr;

--Multipart_Sun_May_19_08:48:02_1996-1--


