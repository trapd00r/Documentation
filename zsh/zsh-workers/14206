From zsh-workers-return-14206-mason-zsh=primenet.com.au@sunsite.dk Wed May 02 15:56:10 2001
Return-Path: <zsh-workers-return-14206-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23495 invoked from network); 2 May 2001 15:56:09 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 2 May 2001 15:56:09 -0000
Received: (qmail 7551 invoked by alias); 2 May 2001 15:56:04 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14206
Received: (qmail 7534 invoked from network); 2 May 2001 15:56:03 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010502155536.ZM9724@candle.brasslantern.com>
Date: Wed, 2 May 2001 15:55:36 +0000
In-Reply-To: <Tc0a88d0153457fbe39@mailsweeper01.cambridgesiliconradio.com>
Comments: In reply to Peter Stephenson <pws@csr.com>
        "Re: Termcap saga" (May  2, 10:38am)
References: <Tc0a88d0153457fbe39@mailsweeper01.cambridgesiliconradio.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: PATCH: Re: Termcap saga
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On May 2, 10:38am, Peter Stephenson wrote:
} Subject: Re: Termcap saga
}
} > There was a short period of time when installing ncurses would overwrite
} > termcap.h with its own header; it is fixed now but if you happen to catch
} > this old version, you have to reinstall termcap to get original header.
} > 
} > There is no term.h under Cygwin so it looks like the only possibility.
} 
} termcap.h looks OK, but there is a term.h in my case which smells strongly
} of ncurses.  It could be that's gone since the last time I installed
} cygwin.

See if this doesn't fix you up.  It also repairs a bug that I introduced
when reshuffling the order of some of the --enable option checks.

Index: configure.in
===================================================================
--- configure.in	2001/05/02 15:04:40	1.6
+++ configure.in	2001/05/02 15:48:17
@@ -425,7 +425,6 @@
 
 [if test x$enableval = xyes; then
 
-  if test $ac_cv_header_linux_tasks_h = yes; then
    AC_EGREP_CPP(yes,
    [#include <linux/tasks.h>
     #ifdef MAX_TASKS_PER_USER
@@ -433,7 +432,6 @@
     #endif
    ],
    maxj=max)
-  fi
 
    if test x$maxj = xmax; then
     AC_DEFINE(MAXJOB, MAX_TASKS_PER_USER)
@@ -478,7 +476,7 @@
 		 limits.h fcntl.h libc.h sys/utsname.h sys/resource.h \
 		 locale.h errno.h stdlib.h unistd.h sys/capability.h \
 		 utmp.h utmpx.h sys/types.h pwd.h grp.h poll.h sys/mman.h \
-		 linux/tasks.h netinet/in_systm.h curses.h term.h)
+		 netinet/in_systm.h)
 if test $dynamic = yes; then
   AC_CHECK_HEADERS(dlfcn.h)
   AC_CHECK_HEADERS(dl.h)
@@ -562,6 +560,11 @@
 esac])dnl
 
 AC_SEARCH_LIBS(tgetent, [$termcap_curses_order])
+case "$LIBS" in
+*curses*)
+AC_CHECK_HEADERS(curses.h term.h)
+if test x$ac_cv_header_term_h = xyes; then
+
 AC_MSG_CHECKING(if term.h needs curses.h)
 AC_TRY_COMPILE([#include <term.h>], [char **test = boolcodes;], boolcodes_with_only_term_h=yes,
 boolcodes_with_only_term_h=no)
@@ -612,6 +615,9 @@
 #include <term.h>], [char **test = strnames; printf(*test);],
 AC_DEFINE(HAVE_STRNAMES) strnames=yes, strnames=no)
 AC_MSG_RESULT($strnames)
+
+fi;;
+esac
 
 dnl Some systems (Solaris 2.x, Linux Redhat 5.x) require
 dnl libnsl (Network Services Library) to find yp_all

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

