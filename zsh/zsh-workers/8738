From zsh-workers-return-8738-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Nov 22 22:06:37 1999
Return-Path: <zsh-workers-return-8738-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28610 invoked from network); 22 Nov 1999 22:06:36 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 22 Nov 1999 22:06:36 -0000
Received: (qmail 17362 invoked by alias); 22 Nov 1999 22:06:30 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8738
Received: (qmail 17352 invoked from network); 22 Nov 1999 22:06:29 -0000
Message-ID: <3839BE76.8383A69E@supanet.com>
Date: Mon, 22 Nov 1999 22:06:46 +0000
From: Peter Stephenson <pws@supanet.com>
X-Mailer: Mozilla 4.7 [en] (Win98; I)
X-Accept-Language: en
MIME-Version: 1.0
To: Zsh Hacker's List <zsh-workers@sunsite.auc.dk>
Subject: 3.1.6-pws-9 details
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

This patch is supposed to fix the things noticed by Tanaka Akira and
Bart,
apart from the patch I missed which I've added separately.

Sorry I missed the space in prompt thing --- I saw Geoff's patch, but
thought it fixed something else related.

The remaining 80-column display problem I remember was due to some
terminals adding spaces and some not when the cursor is at the end of
the line.  There was a theory that there was a termcap variable which
could
distinguish the cases, but as far as I can remember there hasn't been
a patch.

By the way, the main difficulty with generating the AIX .export files
automatically is that at the point where they're missed, which is
where they're being imported into a dynamic library, you don't know
which file they're supposed to come from (e.g. is a symbol to be
resolved from zsh itself or from zle.so?)  This makes it hard.  Another
gotcha is that AIX isn't all that informative with errors if something
isn't exported (e.g. from zsh) but is imported (e.g. into zle.so), so if
you fix the .export file so that the library (zle.so) compiles because
it thinks it can get the symbol now, actually it can't unless you
recompile the file that should be exporting it (zsh) too.  It's lucky
Oliver is keeping up with this since I won't be using AIX any more.

--- Completion/Builtins/_vars.fixup	Mon Nov 22 20:30:04 1999
+++ Completion/Builtins/_vars	Mon Nov 22 20:30:08 1999
@@ -22,5 +22,3 @@
 else
   _tags parameters && _parameters
 fi
-
-
--- Completion/User/_make.fixup	Mon Nov 22 20:32:18 1999
+++ Completion/User/_make	Mon Nov 22 20:32:59 1999
@@ -18,11 +18,11 @@
     file=''
   fi
 
-   [[ -n "$file" ]] && _wanted targets expl 'make target' &&
-       compadd "$expl[@]" - \
-           $(awk '/^[a-zA-Z0-9][^\/ \t]+:/ {print $1}
- 	         /^\.include  *<bsd\.port\.(subdir\.|pre\.)?mk>/ ||
/^\.include  *".*mk\/bsd\.pkg\.(subdir\.)?mk"/ {
- 	           print "fetch fetch-list extract patch configure build
install reinstall deinstall package describe checkpatch checksum
makesum" }' \
- 	        FS=: $file) && ret=0
+  [[ -n "$file" ]] && _wanted targets expl 'make target' &&
+      compadd "$expl[@]" - \
+          $(awk '/^[a-zA-Z0-9][^\/ \t]+:/ {print $1}
+ 	      /^\.include  *<bsd\.port\.(subdir\.|pre\.)?mk>/ || /^\.include 
*".*mk\/bsd\.pkg\.(subdir\.)?mk"/ {
+ 	        print "fetch fetch-list extract patch configure build install
reinstall deinstall package describe checkpatch checksum makesum" }' \
+ 	     FS=: $file) && ret=0
   (( ret )) && { compset -P 1 '*\='; _files }
 fi
--- Doc/Zsh/compsys.yo.fixup	Mon Nov 22 20:34:16 1999
+++ Doc/Zsh/compsys.yo	Mon Nov 22 20:34:21 1999
@@ -2027,12 +2027,6 @@
 taken as the name of an array and its elements will be given to
 functions called to generate matches when executing the
 var(actions). For example, this allows one to give options for the
-tt(compadd) builtin that should be used.
-
-Another option supported is `tt(-O) var(name)'. The var(name) will be
-taken as the name of an array and its elements will be given to
-functions called to generate matches when executing the
-var(actions). For example, this allows one to give options for the
 tt(compadd) builtin that should be used for all var(action)s.
 
 Also, the tt(-M) option followed by a string may be given before the
--- Src/math.c.fixup	Mon Nov 22 20:36:13 1999
+++ Src/math.c	Mon Nov 22 20:36:19 1999
@@ -367,7 +367,7 @@
 #ifdef USE_LOCALE
 		    setlocale(LC_NUMERIC, prev_locale);
 #endif
-		    if (ptr == nptr || *nptr == '.' ) {
+		    if (ptr == nptr || *nptr == '.') {
 			zerr("bad floating point constant", NULL, 0);
 			return EOI;
 		    }
--- configure.in.fixup	Mon Nov 22 20:25:41 1999
+++ configure.in	Mon Nov 22 20:42:11 1999
@@ -398,7 +398,7 @@
 AC_PROG_INSTALL             dnl Check for BSD compatible `install'
 AC_PROG_AWK                 dnl Check for mawk,gawk,nawk, then awk.
 AC_PROG_LN                  dnl Check for working ln, for "make
install"
-AC_CHECK_PROGS([YODL], [yodl], [exit 0; yodl])
+AC_CHECK_PROGS([YODL], [yodl], [: yodl])
 
 dnl ------------------
 dnl CHECK HEADER FILES

