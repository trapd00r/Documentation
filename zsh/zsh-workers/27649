From zsh-workers-return-27649-mason-zsh=primenet.com.au@zsh.org Wed Feb 03 01:16:22 2010
Return-Path: <zsh-workers-return-27649-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29718 invoked by alias); 3 Feb 2010 01:16:22 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 27649
Received: (qmail 29782 invoked from network); 3 Feb 2010 01:16:20 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00,DKIM_SIGNED,
	DKIM_VERIFIED autolearn=ham version=3.2.5
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 74.125.78.148 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=R0SRS3frqKBBQXV4gs5dO3y+fcPqeYlHH9AJQaLq37I=;
        b=UIO9d3u5NEbp6RH60nv535Teft5ZaLC/OvC8F2AyPERWVsALFwK7oAlaAHnlXhwZDV
         1EsRF3DyRxonDRdbL/EpF7X2L/pgOj5qJmt43mHO1s3BEGK1O4/TVlLm5Zxty9A/vfSu
         9DyeF3nfJBVqnY6UarG4bY/TTnljkb4VG0ueo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=UqvR/GWIG6UcOkz+I0c+AognjJJZL2pjSG5drXlWJOFkLnhzxKH6zIwEgVpTxTNlnN
         LmYLsfcghVofd2H2D+PJPpLLltXnSf1yxSvyD0d4RMgtust9VQ2lGUFvGlxqNjHqWosd
         umwkDLje/jw/MdpK3PvgmN1Xh6y8xjBD+s/bY=
MIME-Version: 1.0
In-Reply-To: <20090817215819.796e9416@pws-pc>
References: <237967ef0908031315u72fa3661i17ff7f0107b85b9c@mail.gmail.com>
	 <200908040850.n748oxlc011862@news01.csr.com>
	 <20090817215819.796e9416@pws-pc>
Date: Wed, 3 Feb 2010 02:16:15 +0100
Message-ID: <237967ef1002021716l101c98b7obc758fb200a117e8@mail.gmail.com>
Subject: Re: Quoting problems with _zip (unzip) completer
From: Mikael Magnusson <mikachu@gmail.com>
To: zsh workers <zsh-workers@zsh.org>
Content-Type: text/plain; charset=UTF-8

On 17 August 2009 21:58, Peter Stephenson <p.w.stephenson@ntlworld.com> wrote:
> On Tue, 04 Aug 2009 09:50:59 +0100
> Peter Stephenson <pws@csr.com> wrote:
>> Mikael Magnusson wrote:
>> > % unzip test\[.zip <tab>
>> > _zip:117: bad pattern: test[.zip(|.zip|.ZIP)
>> > _zip:117: bad pattern: test[.zip(|.zip|.ZIP)
>> > _zip:117: bad pattern: test[.zip(|.zip|.ZIP)
>>
>> ... the value of "line" [in _zip] is a bit inconsistent.  Sure
>> enough if I use ~/tmp/zip/tmp\[.zip $line[1] comes back (using print -r) as
>>
>>   ~/tmp/zip/test[.zip
>>
>> which is wrong---either the ~ needs to be expanded, or the [ needs to be
>> quoted.  So this needs tracking internally, unfortunately.  If it hits
>> the internal completion quoting system we're probably stuck---I spent
>> weeks looking at that a couple of years ago and got virtually nowhere.
>> However, it may not be that bad in this case.
>
> It's inside comparguments, but luckily in only one place.  This removes
> the internal unquoting so the form above works.
>
> This could easily have knock-on effects in other callers of _arguments,
> however they should be fixable by simple local changes (and at least
> one case, the one above, works without updating, so others probably do,
> too), while with the old code there were unfixable cases, so I think we
> just need to identify them and change them as they come up.
>
> So please watch out for any anomalous _arguments quoting behaviour.

Hm, I can't remember if this fixed my original problem of not being
able to complete after unzip test\[.zip, if it did, something seems to
have broken it again. I do still have it in my "zsh-unfixed" dir so I
think it didn't. I don't get any errors, but I also don't get any
completions. (I actually encountered it when completing zdelattr,
which for some reason also uses $~, ah, you added that for me ;).

Long story short, if it was never fixed, never mind, I just want to
know if I'm getting senile. :)

--
Mikael Magnusson

