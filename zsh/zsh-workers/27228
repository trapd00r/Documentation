From zsh-workers-return-27228-mason-zsh=primenet.com.au@sunsite.dk Fri Aug 21 14:31:47 2009
Return-Path: <zsh-workers-return-27228-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14767 invoked from network); 21 Aug 2009 14:31:43 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.2 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 21 Aug 2009 14:31:43 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 36235 invoked from network); 21 Aug 2009 14:31:32 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 21 Aug 2009 14:31:32 -0000
Received: (qmail 20947 invoked by alias); 21 Aug 2009 14:31:26 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 27228
Received: (qmail 20927 invoked from network); 21 Aug 2009 14:31:25 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 21 Aug 2009 14:31:25 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [208.87.233.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id EEE0480307FF
	for <zsh-workers@sunsite.dk>; Fri, 21 Aug 2009 16:31:17 +0200 (CEST)
Received: from dalamsexb02.AMERICAS.ROOT.PRI ([65.208.56.47])
	by rly14g.srv.mailcontrol.com (MailControl) with ESMTP id n7LEUr27024135
	for <zsh-workers@sunsite.dk>; Fri, 21 Aug 2009 15:31:14 +0100
Received: from SJOAMSEXB01.AMERICAS.ROOT.PRI ([10.110.12.58]) by dalamsexb02.AMERICAS.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Fri, 21 Aug 2009 09:26:46 -0500
Received: from cameurexb01.EUROPE.ROOT.PRI ([10.100.137.61]) by SJOAMSEXB01.AMERICAS.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Fri, 21 Aug 2009 07:26:45 -0700
Received: from news01 ([10.99.50.25]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Fri, 21 Aug 2009 15:26:42 +0100
Date: Fri, 21 Aug 2009 15:26:37 +0100
From: Peter Stephenson <pws@csr.com>
To: "Zsh Hackers' List" <zsh-workers@sunsite.dk>
Subject: Re: Cygwin New User Issue?
Message-ID: <20090821152637.648a8851@news01>
In-Reply-To: <AC6F5002-C413-4AE7-9C9F-7C27AF4D3F1E@gmail.com>
References: <1B213508-B026-4632-8A06-B1D5FB1E2586@gmail.com>
	<20090817121133.427648cb@news01>
	<AC6F5002-C413-4AE7-9C9F-7C27AF4D3F1E@gmail.com>
Organization: CSR
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.8; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 21 Aug 2009 14:26:42.0958 (UTC) FILETIME=[67AAEAE0:01CA226B]
X-Scanned-By: MailControl A-09-22-00 (www.mailcontrol.com) on 10.71.0.124
X-Virus-Scanned: ClamAV 0.94.2/9724/Fri Aug 21 05:27:53 2009 on bifrost
X-Virus-Status: Clean

On Wed, 19 Aug 2009 09:03:26 +0800
Aaron Davies <aaron.davies@gmail.com> wrote:
> Specific to cygwin, I should also note that the default install has no  
> "clear" command included (they've packaged that with ncurses), so zsh- 
> newuser-install also throws several "command not found: clear" errors.

This should cover most bases.

Index: Functions/Newuser/zsh-newuser-install
===================================================================
RCS file: /cvsroot/zsh/zsh/Functions/Newuser/zsh-newuser-install,v
retrieving revision 1.7
diff -u -r1.7 zsh-newuser-install
--- Functions/Newuser/zsh-newuser-install	17 Aug 2009 11:15:38 -0000	1.7
+++ Functions/Newuser/zsh-newuser-install	21 Aug 2009 14:25:18 -0000
@@ -19,6 +19,15 @@
   return 1
 fi
 
+# clear is missing in some Cygwin configurations (lacking ncurses)
+if ! ( clear >/dev/null 2>/dev/null ); then
+  if zmodload zsh/termcap 2>/dev/null; then
+    clear() { echotc cl; }
+  else
+    clear() { print -n "\e[H\e[J"; }
+  fi
+fi
+
 # The directory in which to look for and save .zshrc.
 local zd=${ZDOTDIR:-$HOME}
 # The same directory in a user friendly form, i.e. with ~ replacement.

-- 
Peter Stephenson <pws@csr.com>            Software Engineer
Tel: +44 (0)1223 692070                   Cambridge Silicon Radio Limited
Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, UK


'member of the CSR plc group of companies. CSR plc registered in England and Wales, registered number 4187346, registered office Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, United Kingdom'

