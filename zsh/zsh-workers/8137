From zsh-workers-return-8137-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Oct 06 14:07:14 1999
Return-Path: <zsh-workers-return-8137-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4042 invoked from network); 6 Oct 1999 14:07:13 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 6 Oct 1999 14:07:13 -0000
Received: (qmail 28902 invoked by alias); 6 Oct 1999 14:07:06 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8137
Received: (qmail 28895 invoked from network); 6 Oct 1999 14:07:05 -0000
From: zefram@fysh.org
To: zsh-workers@sunsite.auc.dk
Subject: Solaris doors
Message-Id: <E11YriT-0000DF-00@crucigera.fysh.org>
Date: Wed, 06 Oct 1999 15:06:49 +0100

Something I meant to do a long time ago -- support for the stat module
to recognise Solaris doors.

-zefram

 diff -cr zsh-3.1.6-pws-6/Src/Modules/stat.c zsh/Src/Modules/stat.c
 *** zsh-3.1.6-pws-6/Src/Modules/stat.c	Tue May 18 08:49:10 1999
 --- zsh/Src/Modules/stat.c	Wed Oct  6 15:03:19 1999
 ***************
 *** 66,71 ****
 --- 66,73 ----
   	    *pm = 'c';
   	else if (S_ISDIR(mode))
   	    *pm = 'd';
 + 	else if (S_ISDOOR(mode))
 + 	    *pm = 'D';
   	else if (S_ISFIFO(mode))
   	    *pm = 'p';
   	else if (S_ISLNK(mode))
 diff -cr zsh-3.1.6-pws-6/Src/system.h zsh/Src/system.h
 *** zsh-3.1.6-pws-6/Src/system.h	Wed Sep  1 08:51:59 1999
 --- zsh/Src/system.h	Wed Oct  6 15:00:49 1999
 ***************
 *** 409,414 ****
 --- 409,415 ----
   # undef S_ISBLK
   # undef S_ISCHR
   # undef S_ISDIR
 + # undef S_ISDOOR
   # undef S_ISFIFO
   # undef S_ISLNK
   # undef S_ISMPB
 ***************
 *** 436,441 ****
 --- 437,445 ----
   #if !defined(S_ISDIR) && defined(S_IFDIR)
   # define S_ISDIR(m) (((m) & S_IFMT) == S_IFDIR)
   #endif
 + #if !defined(S_ISDOOR) && defined(S_IFDOOR)      /* Solaris */
 + # define S_ISDOOR(m) (((m) & S_IFMT) == S_IFDOOR)
 + #endif
   #if !defined(S_ISFIFO) && defined(S_IFIFO)
   # define S_ISFIFO(m) (((m) & S_IFMT) == S_IFIFO)
   #endif
 ***************
 *** 474,479 ****
 --- 478,486 ----
   #endif
   #ifndef S_ISDIR
   # define S_ISDIR(m) ((void)(m), 0)
 + #endif
 + #ifndef S_ISDOOR
 + # define S_ISDOOR(m) ((void)(m), 0)
   #endif
   #ifndef S_ISFIFO
   # define S_ISFIFO(m) ((void)(m), 0)

