From zsh-workers-return-18338-mason-zsh=primenet.com.au@sunsite.dk Tue Mar 11 13:06:50 2003
Return-Path: <zsh-workers-return-18338-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12865 invoked from network); 11 Mar 2003 13:06:50 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 11 Mar 2003 13:06:50 -0000
Received: (qmail 3842 invoked by alias); 11 Mar 2003 13:06:41 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18338
Received: (qmail 3831 invoked from network); 11 Mar 2003 13:06:41 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 11 Mar 2003 13:06:41 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [212.125.75.4] by sunsite.dk (MessageWall 1.0.8) with SMTP; 11 Mar 2003 13:6:40 -0000
Received: (qmail 8146 invoked from network); 11 Mar 2003 13:06:39 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-10.tower-1.messagelabs.com with SMTP; 11 Mar 2003 13:06:39 -0000
Received: from finches.logica.co.uk ([158.234.142.11])
	by iris.logica.co.uk (8.9.3/8.9.3/Debian 8.9.3-21) with ESMTP id NAA04682
	for <zsh-workers@sunsite.dk>; Tue, 11 Mar 2003 13:06:38 GMT
X-Authentication-Warning: iris.logica.co.uk: Host [158.234.142.11] claimed to be finches.logica.co.uk
Received: from finches.logica.co.uk (localhost [127.0.0.1])
	by finches.logica.co.uk (8.11.6/8.11.6/SuSE Linux 0.5) with ESMTP id h2BDAX817225
	for <zsh-workers@sunsite.dk>; Tue, 11 Mar 2003 14:10:33 +0100
To: zsh-workers@sunsite.dk (Zsh hackers list)
X-VirusChecked: Checked
In-reply-to: <22979.1046178445@csr.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <22979.1046178445@csr.com>
Subject: PATCH: Re: Bugs thrown up by _perforce 
Date: Tue, 11 Mar 2003 14:10:33 +0100
Message-ID: <17223.1047388233@finches.logica.co.uk>

On 25 Feb, Peter wrote:
> > [_next_tags always inserts an unambiguous completion]
> >

This patch is my fix for the first of the problems. From my own usage,
I'm happy that this is definitely better. If anyone really does want
_next_tags to insert unambiguous matches, it would be easy to make it
check the insert-unambiguous style.

Oliver

Index: Completion/Base/Widget/_next_tags
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Base/Widget/_next_tags,v
retrieving revision 1.4
diff -u -r1.4 _next_tags
--- Completion/Base/Widget/_next_tags	26 Feb 2003 16:36:07 -0000	1.4
+++ Completion/Base/Widget/_next_tags	11 Mar 2003 12:59:00 -0000
@@ -1,4 +1,4 @@
-#compdef -k complete-word \C-xn
+#compdef -k list-choices \C-xn
 
 # Main widget.
 
@@ -96,11 +96,7 @@
   _next_tags_pfx="$PREFIX"
   _next_tags_sfx="$SUFFIX"
 
-  if [[ -n "$compstate[old_insert]" ]]; then
-    ins=1
-  else
-    ins=unambiguous
-  fi
+  ins="${compstate[old_insert]:+1}"
 
   _main_complete _complete _next_tags_completer
 

