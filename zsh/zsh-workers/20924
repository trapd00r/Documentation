From zsh-workers-return-20924-mason-zsh=primenet.com.au@sunsite.dk Thu Mar 03 13:51:50 2005
Return-Path: <zsh-workers-return-20924-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8319 invoked from network); 3 Mar 2005 13:51:50 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 3 Mar 2005 13:51:50 -0000
Received: (qmail 7128 invoked from network); 3 Mar 2005 13:51:44 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 3 Mar 2005 13:51:44 -0000
Received: (qmail 17085 invoked by alias); 3 Mar 2005 13:51:42 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20924
Received: (qmail 17075 invoked from network); 3 Mar 2005 13:51:41 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 3 Mar 2005 13:51:41 -0000
Received: (qmail 6847 invoked from network); 3 Mar 2005 13:51:40 -0000
Received: from mail36.messagelabs.com (193.109.254.211)
  by a.mx.sunsite.dk with SMTP; 3 Mar 2005 13:51:35 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-18.tower-36.messagelabs.com!1109857881!13867517!1
X-StarScan-Version: 5.4.11; banners=-,-,-
X-Originating-IP: [158.234.9.163]
Received: (qmail 9849 invoked from network); 3 Mar 2005 13:51:21 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-18.tower-36.messagelabs.com with SMTP; 3 Mar 2005 13:51:21 -0000
Received: from trentino.logica.co.uk ([158.234.142.59])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id j23DpX61030616
	for <zsh-workers@sunsite.dk>; Thu, 3 Mar 2005 13:51:33 GMT
Received: from trentino.groupinfra.com (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP id 59D333AFC0
	for <zsh-workers@sunsite.dk>; Thu,  3 Mar 2005 14:51:13 +0100 (CET)
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <200503031126.j23BQmXE002473@news01.csr.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <5964.1109263147@trentino.logica.co.uk> <200503011246.j21CkRGS031240@news01.csr.com> <31072.1109700154@trentino.groupinfra.com> <200503021608.j22G8ips020857@news01.csr.com> <28818.1109848253@trentino.groupinfra.com> <200503031126.j23BQmXE002473@news01.csr.com>
To: Zsh workers <zsh-workers@sunsite.dk>
Subject: Re: configure tests for iconv 
Date: Thu, 03 Mar 2005 14:51:13 +0100
Message-ID: <32626.1109857873@trentino.groupinfra.com>
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

Peter wrote:
> OK, Cygwin now converts characters up to and including 0x7f.  After that

Good. Thanks for your help with this.

> Would it be worth changing the error message for that error (the second
> one in the iconv branch) to suggest the error was with the particular
> character, rather than with character sets in general?

When using wctomb() instead of iconv() it actually prints "character not
in range" for that situation so it certainly makes sense that we should
be consistent with that.

Oliver

--- utils.c.bak 2005-03-03 14:45:33.772178204 +0100
+++ utils.c     2005-03-03 14:45:36.562694413 +0100
@@ -3637,7 +3637,7 @@ getkeystring(char *s, int *len, int from
                     count = iconv(cd, &inptr, &inbytes, &t, &outbytes);
                    iconv_close(cd);
                    if (count == (size_t)-1) {
-                        zerr("cannot do charset conversion", NULL, 0);
+                        zerr("character not in range", NULL, 0);
                        *t = '\0';
                        *len = t - buf;
                        return buf;

