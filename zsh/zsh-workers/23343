From zsh-workers-return-23343-mason-zsh=primenet.com.au@sunsite.dk Sun Apr 29 12:34:46 2007
Return-Path: <zsh-workers-return-23343-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24360 invoked from network); 29 Apr 2007 12:34:44 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.8 (2007-02-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,FORGED_RCVD_HELO
	autolearn=ham version=3.1.8
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 29 Apr 2007 12:34:44 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 24070 invoked from network); 29 Apr 2007 12:34:38 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 29 Apr 2007 12:34:38 -0000
Received: (qmail 7418 invoked by alias); 29 Apr 2007 12:34:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23343
Received: (qmail 7406 invoked from network); 29 Apr 2007 12:34:35 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 29 Apr 2007 12:34:35 -0000
Received: (qmail 23805 invoked from network); 29 Apr 2007 12:34:35 -0000
Received: from redoubt.spodhuis.org (HELO mx.spodhuis.org) (193.202.115.177)
  by a.mx.sunsite.dk with SMTP; 29 Apr 2007 12:34:32 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws; s=first1; d=spodhuis.org;
	h=Received:Date:From:To:Subject:Message-ID:Mail-Followup-To:MIME-Version:Content-Type:Content-Disposition;
	b=SlI0yS/BwjbspQDvTJfUUSDb6CYidTroo8HxOkuUYwAp/mlPFvqGKxxWJOuZgK/Ttx8s6YsxPM1/6922OFR7EoM8d828tjb37Sbz0ABpAEjMzO/kjuTGd85FkPQ8f6rqjFwknDNSKpQIU9fvLpphQMATsQJsq2+BoSB+wnfCSaw=;
Received: by smtp.spodhuis.org with local 
	id 1Hi8bo-00098C-CH; Sun, 29 Apr 2007 12:34:32 +0000
Date: Sun, 29 Apr 2007 05:34:32 -0700
From: Phil Pennock <zsh-workers+phil.pennock@spodhuis.org>
To: zsh-workers@sunsite.dk
Subject: Library linkage portability?
Message-ID: <20070429123432.GA35096@redoubt.spodhuis.org>
Mail-Followup-To: zsh-workers@sunsite.dk
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

I've been playing around with embedding ruby into zsh, for no particular
reason beyond my own education.  In so doing, I found "issues" with
headers such as "regex.h" which are also in the ruby directory which has
ruby.h.

I ended up giving mdd files the ability to state per-module cflags and
linkage flags.  I then decided to get rid of the linkage of zsh against
pcre by resetting LIBS and CPPFLAGS in configure.ac after the test for
the pcre functions and just having pcre.mdd include:

  modincflags="`pcre-config --cflags`"
  modlibflags="`pcre-config --libs`"

Now I can run ldd against zsh and not see libpcre, but still have all
the PCRE functionality once I zmodload zsh/pcre.  I suspect that this
gets rid of the objections to building against pcre for systems where
zsh is on the root partition.

However, I also suspect that this is not portable to older a.out systems
and my memory's suggesting something about all library dependencies
having to be on the main executable, not being resolvable as libraries
are loaded.

Can someone please educate me as to the issues, or have I summed it up?
What about the stranger platforms, AIX etc?

Thanks,
-Phil

