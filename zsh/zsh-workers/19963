From zsh-workers-return-19963-mason-zsh=primenet.com.au@sunsite.dk Wed May 19 17:38:30 2004
Return-Path: <zsh-workers-return-19963-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13391 invoked from network); 19 May 2004 17:38:29 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.86)
  by ns1.primenet.com.au with SMTP; 19 May 2004 17:38:29 -0000
Received: (qmail 17035 invoked from network); 19 May 2004 17:38:11 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 19 May 2004 17:38:11 -0000
Received: (qmail 17932 invoked by alias); 19 May 2004 17:38:07 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19963
Received: (qmail 17921 invoked from network); 19 May 2004 17:38:06 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (qmailr@130.225.247.86)
  by sunsite.dk with SMTP; 19 May 2004 17:38:03 -0000
Received: (qmail 16678 invoked from network); 19 May 2004 17:38:03 -0000
Received: from nef.ens.fr (129.199.96.32)
  by a.mx.sunsite.dk with SMTP; 19 May 2004 17:38:00 -0000
Received: from clipper.ens.fr (clipper-gw.ens.fr [129.199.1.22])
          by nef.ens.fr (8.12.11/1.01.28121999) with ESMTP id i4JHaxRO094090
          ; Wed, 19 May 2004 19:36:59 +0200 (CEST)
Received: from (george@localhost) by clipper.ens.fr (8.12.3/jb-1.1)
Date: Wed, 19 May 2004 19:36:58 +0200
From: Nicolas George <nicolas.george@ens.fr>
To: Peter Stephenson <pws@csr.com>
Cc: zsh-workers@sunsite.dk, 249627@bugs.debian.org
Subject: Re: Bug#249627: Alias + LC_CTYPE + function => segmentation fault
Message-ID: <20040519173658.GA26842@clipper.ens.fr>
References: <20040518193055.GB6702@clipper.ens.fr> <3684.1084960653@csr.com>
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="k1lZvvs/B4yU6o8G"
Content-Disposition: inline
In-Reply-To: <3684.1084960653@csr.com>
User-Agent: Mutt/1.4.2i
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-1.3.2 (nef.ens.fr [129.199.96.32]); Wed, 19 May 2004 19:36:59 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0


--k1lZvvs/B4yU6o8G
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

Le primidi 1er prairial, an CCXII, Peter Stephenson a =E9crit=A0:
> I don't think this is the same problem, since the programme finishes
> correctly.  It does indicate something funny in saving and restoring
> environment variables.

If it is a memory corruption caused by an invalid free, it is likely
that valgrind would either prevent it, or change the exact place where
the corruption occurs, thus changing the time it results in a
segmentation fault. I have seen that just having used "setopt" earlyer
changed a segfault on the second try into an infinite loop in the third
try: this problem is very sensitive to initial conditions.

I have tried Electric Fence, here is a backtrace, just after the second
date:

ssecem% date

ElectricFence Aborting: free(403cdfe8): address not from malloc().

Program received signal SIGILL, Illegal instruction.
[Switching to Thread 1075767072 (LWP 1967)]
0xffffe410 in __kernel_vsyscall ()
(gdb) where
#0  0xffffe410 in __kernel_vsyscall ()
#1  0x400ce156 in kill () from /lib/tls/i686/cmov/libc.so.6
#2  0x4002719b in EF_Abort () from /usr/lib/libefence.so
#3  0x40026ac1 in free () from /usr/lib/libefence.so
#4  0x0808dc1e in zsfree (p=3D0x403cdfe8 "") at mem.c:1399
#5  0x0809b2d2 in delenv (x=3D0x403cdfe8 "") at params.c:3455
#6  0x080698f4 in save_params (state=3D0xbffff7c0, pc=3D0x406d915c,=20
    restore_p=3D0xbffff568, remove_p=3D0xbffff56c) at exec.c:2523
#7  0x08069314 in execcmd (state=3D0xbffff7c0, input=3D0, output=3D0, how=
=3D18,=20
    last1=3D2) at exec.c:2371
#8  0x08065e47 in execpline2 (state=3D0xbffff7c0, pcode=3D387, how=3D18, in=
put=3D0,=20
    output=3D0, last1=3D0) at exec.c:1276
#9  0x08065381 in execpline (state=3D0xbffff7c0, slcode=3D6146, how=3D18, l=
ast1=3D0)
    at exec.c:1066
#10 0x08064cce in execlist (state=3D0xbffff7c0, dont_change_job=3D0, exitin=
g=3D0)
    at exec.c:872
#11 0x080649ee in execode (p=3D0x406d9128, dont_change_job=3D0, exiting=3D0)
    at exec.c:773
#12 0x0807b253 in loop (toplevel=3D1, justonce=3D0) at init.c:165
#13 0x0807d99f in zsh_main (argc=3D1, argv=3D0xbffff8f4) at init.c:1274
#14 0x080521e6 in main (argc=3D1, argv=3D0xbffff8f4) at main.c:37

--k1lZvvs/B4yU6o8G
Content-Type: application/pgp-signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.0 (SunOS)

iD8DBQFAq5s6sGPZlzblTJMRAgSAAKCrmRRaQcdvur8EXmpLZ4OT0Jw/ZwCeLOQe
fAzstE0IGmGoNxt9sDbj5gw=
=g3vN
-----END PGP SIGNATURE-----

--k1lZvvs/B4yU6o8G--

