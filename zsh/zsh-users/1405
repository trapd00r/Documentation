From zsh-workers-request@math.gatech.edu Thu Mar 19 20:00:25 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 20301 invoked from network); 19 Mar 1998 20:00:22 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 19 Mar 1998 20:00:22 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id OAA00989;
	Thu, 19 Mar 1998 14:46:02 -0500 (EST)
Resent-Date: Thu, 19 Mar 1998 14:45:43 -0500 (EST)
From: "Eddy J. Gurney" <eddy@ans.net>
Message-Id: <980319144456.ZM19809@gizmo.aa.ans.net>
Date: Thu, 19 Mar 1998 14:44:56 -0500
X-Mailer: Z-Mail (4.0.1 13Jan97)
To: zsh-users@math.gatech.edu
Subject: Directory-only `cd' completion via compctl bug
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"gs0CA.0.yE.cNN4r"@math>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/1405
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

I'm using the cd completion routines from the "example" compctl file
provided with the zsh distribution:

# Another possibility for cd/pushd is to use it in conjunction with the
# cdmatch function (in the Functions subdirectory of zsh distribution).

if [[ -o AUTO_REMOVE_SLASH ]] then
    compctl -x 'p[2]' -Q -K cdmatch2 - 'S[/][~][./][../]' -g '*(-/)' + \
        -g '*(-/D)' - 'n[-1,/], s[]' -K cdmatch -q -S '/' -- cd pushd
else
    compctl -x 'p[2]' -Q -K cdmatch2 - 'S[/][~][./][../]' -g '*(-/)' + \
        -g '*(-/D)' - 'n[-1,/], s[]' -K cdmatch -S '/' -- cd pushd
fi

This works great... except for one case that I've found so far.

If you try to CD into a directory with spaces in the name, for some
reason it escapes the backslashes:

cd Schoolhouse\\\ Rock\\\ -\\\ America\\\ Rock/

instead of

cd Schoolhouse\ Rock\ -\ America\ Rock/

Any ideas how to fix it? (Note that is doesn't do it if there is a leading
slash, i.e., `cd ./Sc[tab]' works fine but `cd Sc[tab]' does not.)

Eddy

