From zsh-workers-request@math.gatech.edu Thu Jul 02 12:26:31 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11707 invoked from network); 2 Jul 1998 12:26:30 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 2 Jul 1998 12:26:30 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id IAA23902;
	Thu, 2 Jul 1998 08:13:15 -0400 (EDT)
Resent-Date: Thu, 2 Jul 1998 08:13:15 -0400 (EDT)
Message-Id: <199807021214.OAA11836@hydra.ifh.de>
X-Authentication-Warning: hydra.ifh.de: pws owned process doing -bs
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: Re: Abort on parse errors 
In-reply-to: ""Bart Schaefer""'s message of "Wed, 01 Jul 1998 11:32:57 MST."
             <980701113257.ZM13854@candle.brasslantern.com> 
Date: Thu, 02 Jul 1998 14:14:47 +0200
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"XzsE62.0.Pr5.Qbtcr"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4196
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

"Bart Schaefer" wrote:
> } Ksh will even abort initialisation scripts if they have a parse error.
> 
> Which this will, too, given `setopt errexit`, right?  I think that's fine,

The reference in the code to noerrexit is a bit confusing: it isn't
directly connected to the errexit option, it just specifies that there
shouldn't be an exit on an error whether the option's set or not.  I
used it because it seemed to give the best way of deciding when to
ignore parse errors.  (I hate being dumped out of initialisation
scripts, emacs does it to me all the time.)

> but perhaps in ksh emulation mode it should behave differently ...

True:  in that case the `!noerrexit' in init.c becomes
(!noerrexit || emulate == EMULATE_KSH)
--- it's not necessary in main.c at least in this case, in fact I'm
not sure if the noerrexit test there is useful.

*** Src/init.c.err2	Wed Jul  1 17:53:25 1998
--- Src/init.c	Thu Jul  2 14:01:21 1998
***************
*** 99,106 ****
  	if (!(list = parse_event())) {	/* if we couldn't parse a list */
  	    hend();
  	    if ((tok == ENDINPUT && !errflag) ||
! 		(tok == LEXERR && !noerrexit &&
! 		 (!isset(SHINSTDIN) || !toplevel)) || justonce)
  		break;
  	    continue;
  	}
--- 99,106 ----
  	if (!(list = parse_event())) {	/* if we couldn't parse a list */
  	    hend();
  	    if ((tok == ENDINPUT && !errflag) ||
! 		(tok == LEXERR && (!noerrexit || emulation == EMULATE_KSH)
! 		 && (!isset(SHINSTDIN) || !toplevel)) || justonce)
  		break;
  	    continue;
  	}

-- 
Peter Stephenson <pws@ifh.de>       Tel: +39 50 844536
WWW:  http://www.ifh.de/~pws/
Gruppo Teorico, Dipartimento di Fisica
Piazza Torricelli 2, 56100 Pisa, Italy


