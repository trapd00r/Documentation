From zsh-workers-return-14065-mason-zsh=primenet.com.au@sunsite.dk Sun Apr 22 14:42:12 2001
Return-Path: <zsh-workers-return-14065-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26785 invoked from network); 22 Apr 2001 14:42:11 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 22 Apr 2001 14:42:11 -0000
Received: (qmail 19758 invoked by alias); 22 Apr 2001 14:42:06 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14065
Received: (qmail 19745 invoked from network); 22 Apr 2001 14:42:05 -0000
Date: Sun, 22 Apr 2001 10:41:58 -0400
From: Clint Adams <schizo@debian.org>
To: Bart Schaefer <schaefer@candle.brasslantern.com>
Cc: zsh-workers@sunsite.dk
Subject: PATCH: Re: Something is still fishy in termcap & terminfo parameters
Message-ID: <20010422104158.B17242@dman.com>
References: <1010421220146.ZM32399@candle.brasslantern.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <1010421220146.ZM32399@candle.brasslantern.com>; from schaefer@candle.brasslantern.com on Sat, Apr 21, 2001 at 10:01:45PM +0000

> zagzig% echo $termcap[co]
> -4611700861834362800

Oh dear.

Index: Src/params.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/params.c,v
retrieving revision 1.38
diff -u -r1.38 params.c
--- Src/params.c	2001/04/21 18:49:13	1.38
+++ Src/params.c	2001/04/22 14:39:40
@@ -2153,7 +2153,7 @@
 /* Function to get value of an integer parameter */
 
 /**/
-static zlong
+mod_export zlong
 intgetfn(Param pm)
 {
     return pm->u.val;
Index: Src/Modules/termcap.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/termcap.c,v
retrieving revision 1.7
diff -u -r1.7 termcap.c
--- Src/Modules/termcap.c	2001/04/21 21:41:28	1.7
+++ Src/Modules/termcap.c	2001/04/22 14:39:58
@@ -208,6 +208,8 @@
     pm->flags = PM_READONLY;
     pm->sets.cfn = NULL;
     pm->gets.cfn = strgetfn;
+    pm->sets.ifn = NULL;
+    pm->gets.ifn = intgetfn;
     pm->unsetfn = NULL;
     pm->ct = 0;
     pm->env = NULL;
@@ -305,6 +307,8 @@
     pm = (Param) zhalloc(sizeof(struct param));
     pm->sets.cfn = NULL;
     pm->gets.cfn = strgetfn;
+    pm->sets.ifn = NULL;
+    pm->gets.ifn = intgetfn;
     pm->unsetfn = NULL;
     pm->ct = 0;
     pm->env = NULL;
Index: Src/Modules/terminfo.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/terminfo.c,v
retrieving revision 1.14
diff -u -r1.14 terminfo.c
--- Src/Modules/terminfo.c	2001/04/13 16:29:28	1.14
+++ Src/Modules/terminfo.c	2001/04/22 14:39:58
@@ -181,6 +181,8 @@
     pm->flags = PM_READONLY;
     pm->sets.cfn = NULL;
     pm->gets.cfn = strgetfn;
+    pm->sets.ifn = NULL;
+    pm->gets.ifn = intgetfn;
     pm->unsetfn = NULL;
     pm->ct = 0;
     pm->env = NULL;
@@ -291,6 +293,8 @@
     pm = (Param) zhalloc(sizeof(struct param));
     pm->sets.cfn = NULL;
     pm->gets.cfn = strgetfn;
+    pm->sets.ifn = NULL;
+    pm->gets.ifn = intgetfn;
     pm->unsetfn = NULL;
     pm->ct = 0;
     pm->env = NULL;

