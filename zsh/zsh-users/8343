From zsh-users-return-8343-mason-zsh=primenet.com.au@sunsite.dk Sat Jan 08 16:52:47 2005
Return-Path: <zsh-users-return-8343-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22239 invoked from network); 8 Jan 2005 16:52:46 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 8 Jan 2005 16:52:46 -0000
Received: (qmail 42267 invoked from network); 8 Jan 2005 16:52:40 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 8 Jan 2005 16:52:40 -0000
Received: (qmail 21428 invoked by alias); 8 Jan 2005 16:51:49 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8343
Received: (qmail 21415 invoked from network); 8 Jan 2005 16:51:48 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 8 Jan 2005 16:51:48 -0000
Received: (qmail 40849 invoked from network); 8 Jan 2005 16:50:49 -0000
Received: from adsl-216-158-26-62.cust.oldcity.dca.net (HELO spacecat.mcgillsociety.org) (216.158.26.62)
  by a.mx.sunsite.dk with SMTP; 8 Jan 2005 16:50:45 -0000
Received: from [10.0.1.2] (abase.mcgillsociety.org [216.158.26.165])
	by spacecat.mcgillsociety.org (8.11.3/8.11.3) with ESMTP id j08GmWl347931;
	Sat, 8 Jan 2005 11:48:32 -0500 (EST)
In-Reply-To: <20050108162405.1924985AF@pwstephenson.fsnet.co.uk>
References: <6037.1069091427@csr.com> <2B1BAD39-19FA-11D8-BE95-000393768D2C@mcgillsociety.org> <20031119170220.GB6550@atoom.net> <B4498176-6134-11D9-AB6E-000393768D2C@mcgillsociety.org> <20050108162405.1924985AF@pwstephenson.fsnet.co.uk>
Mime-Version: 1.0 (Apple Message framework v619)
Content-Type: text/plain; charset=US-ASCII; format=flowed
Message-Id: <69062D26-6195-11D9-BA9B-000393768D2C@mcgillsociety.org>
Content-Transfer-Encoding: 7bit
Cc: zsh users <zsh-users@sunsite.dk>
X-Image-Url: http://www.mcgillsociety.org/magill.jpg
From: "William H. Magill" <magill@mcgillsociety.org>
Subject: Re: zsh as ksh for login shell -- a bug with PS1? 
Date: Sat, 8 Jan 2005 11:50:32 -0500
To: Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
X-Mailer: Apple Mail (2.619)
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

On 08 Jan, 2005, at 11:24, Peter Stephenson wrote:
> "William H. Magill" wrote:
>> I have a two-line prompt string
>>
>> PS1='[$PWD] $me
>>   $HOST> '
>>
>> I have been using this for many years. It works fine under ksh on 
>> Tru64
>> Unix 5.1 and when zsh 4.2.1 itself is evoked as the login shell.
>>
>> However, if I change the /etc/password entry to evoke ksh instead of
>> zsh, the newline is lost, resulting in a prompt consisting of "$HOST> 
>> "
>
> I think you're saying that ksh is really a link to zsh.  In that case
> zsh will start up with a different set of options.  Probably the
> critical one in this case is single_line_zle.  Try "unsetopt
> single_line_zle" and see if that works.  (If my experiment is correct
> this is exactly the problem.)

Yes, ksh is a link to zsh.

"unsetopt single_line_zle" did the trick!

Profuse thanks....

> The option isn't there for the prompt, in fact, it's there because ksh
> doesn't handle multiple line editing buffers.  It so happens that in 
> zsh
> this is associated with a multi-line prompt.  However, it's not at all
> clear we really need to enforce this restriction of ksh when emulating
> it anyway.  It's hard to think of a case where it's an advantage.

I'm not certain I completely understand your comment, but from 
experience with various actual implementations of ksh, there is no 
restriction on two line prompts. Similarly, I find no restriction 
mentioned in the "Korn Shell" book by Bolsky and Korn.


T.T.F.N.
William H. Magill
# Beige G3 [Rev A motherboard - 300 MHz 768 Meg] OS X 10.2.8
# Flat-panel iMac (2.1) [800MHz - Super Drive - 768 Meg] OS X 10.3.7
# PWS433a [Alpha 21164 Rev 7.2 (EV56)- 64 Meg] Tru64 5.1a
# XP1000  [Alpha 21264-3 (EV6) - 256 meg] FreeBSD 5.3
# XP1000  [Alpha 21264-A (EV 6.7) - 384 meg] FreeBSD 5.3
magill@mcgillsociety.org
magill@acm.org
magill@mac.com
whmagill@gmail.com

