From zsh-workers-return-23732-mason-zsh=primenet.com.au@sunsite.dk Tue Jul 31 14:13:39 2007
Return-Path: <zsh-workers-return-23732-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25146 invoked from network); 31 Jul 2007 14:13:37 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.1 (2007-05-02) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 31 Jul 2007 14:13:37 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 69842 invoked from network); 31 Jul 2007 14:13:30 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 31 Jul 2007 14:13:30 -0000
Received: (qmail 5446 invoked by alias); 31 Jul 2007 14:13:26 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23732
Received: (qmail 5436 invoked from network); 31 Jul 2007 14:13:25 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 31 Jul 2007 14:13:25 -0000
Received: (qmail 69542 invoked from network); 31 Jul 2007 14:13:25 -0000
Received: from cluster-d.mailcontrol.com (217.69.20.190)
  by a.mx.sunsite.dk with SMTP; 31 Jul 2007 14:13:22 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly04d.srv.mailcontrol.com (MailControl) with ESMTP id l6VE7K9R013611
	for <zsh-workers@sunsite.dk>; Tue, 31 Jul 2007 15:13:06 +0100
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Tue, 31 Jul 2007 15:12:00 +0100
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.8/8.13.4) with ESMTP id l6VEC00T027333
	for <zsh-workers@sunsite.dk>; Tue, 31 Jul 2007 15:12:00 +0100
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.8/8.13.8/Submit) with ESMTP id l6VEC0tK027330
	for <zsh-workers@sunsite.dk>; Tue, 31 Jul 2007 15:12:00 +0100
Message-Id: <200707311412.l6VEC0tK027330@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: PATCH: random fixes
Date: Tue, 31 Jul 2007 15:12:00 +0100
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 31 Jul 2007 14:12:00.0303 (UTC) FILETIME=[C2EC73F0:01C7D37C]
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A-07-08-00 (www.mailcontrol.com) on 10.68.0.114

Three things found while running the test suite over NFS under Solaris.
All breakages must be paid for.

Index: Src/exec.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/exec.c,v
retrieving revision 1.121
diff -u -r1.121 exec.c
--- Src/exec.c	31 Jul 2007 11:26:59 -0000	1.121
+++ Src/exec.c	31 Jul 2007 14:08:35 -0000
@@ -1968,7 +1968,7 @@
 	hn = builtintab->getnode(builtintab, cmdarg);
 	if (!hn) {
 	    lastval = 1;
-	    zerr("unknown builtin: %s");
+	    zerr("unknown builtin: %s", cmdarg);
 	    return NULL;
 	}
     }
Index: Test/B02typeset.ztst
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/B02typeset.ztst,v
retrieving revision 1.15
diff -u -r1.15 B02typeset.ztst
--- Test/B02typeset.ztst	31 Jul 2007 11:26:59 -0000	1.15
+++ Test/B02typeset.ztst	31 Jul 2007 14:08:35 -0000
@@ -397,7 +397,7 @@
  (export FOOENV=BAR
  env | grep '^FOOENV'
  print Exec
- exec $ZTST_testdir/../Src/zsh -c '
+ exec $ZTST_testdir/../Src/zsh -fc '
  print Unset
  unset FOOENV
  env | grep "^FOOENV"')
Index: Test/C02cond.ztst
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/C02cond.ztst,v
retrieving revision 1.16
diff -u -r1.16 C02cond.ztst
--- Test/C02cond.ztst	19 Dec 2006 12:09:48 -0000	1.16
+++ Test/C02cond.ztst	31 Jul 2007 14:08:35 -0000
@@ -36,7 +36,7 @@
   if [[ -n $block ]]; then
     [[ -b $block[(f)1] && ! -b zerolength ]]
   else
-    print -u8 'Warning: Not testing [[ -b blockdevice ]] (no devices found)'
+    print -u$ZTST_fd 'Warning: Not testing [[ -b blockdevice ]] (no devices found)'
     [[ ! -b zerolength ]]
   fi
 0D:-b cond
@@ -55,7 +55,7 @@
   if [[ -n $block ]]; then
     [[ -f zerolength && ! -f cond && ! -f $char && ! -f $block[(f)1] && ! -f . ]]
   else
-    print -u8 'Warning: Not testing [[ -f blockdevice ]] (no devices found)'
+    print -u$ZTST_fd 'Warning: Not testing [[ -f blockdevice ]] (no devices found)'
     [[ -f zerolength && ! -f cond && ! -f $char && ! -f . ]]
   fi
 0:-f cond
@@ -79,20 +79,20 @@
 0:-o cond
 
   if ! grep '#define HAVE_FIFOS' $ZTST_testdir/../config.h; then
-    print -u8 'Warning: Not testing [[ -p pipe ]] (FIFOs not supported)'
+    print -u$ZTST_fd 'Warning: Not testing [[ -p pipe ]] (FIFOs not supported)'
     [[ ! -p zerolength ]]
   else
     if whence mkfifo && mkfifo pipe || mknod pipe p; then
       [[ -p pipe && ! -p zerolength ]]
     else
-      print -u8 'Warning: Not testing [[ -p pipe ]] (cannot create FIFO)'
+      print -u$ZTST_fd 'Warning: Not testing [[ -p pipe ]] (cannot create FIFO)'
       [[ ! -p zerolength ]]
     fi
   fi
 0dD:-p cond
 
   if (( EUID == 0 )); then
-    print -u8 'Warning: Not testing [[ ! -r file ]] (root reads anything)'
+    print -u$ZTST_fd 'Warning: Not testing [[ ! -r file ]] (root reads anything)'
     [[ -r zerolength && -r unmodish ]]
   else
     [[ -r zerolength && ! -r unmodish ]]
@@ -129,10 +129,10 @@
   cat unmodified
   touch newnewnew
   if [[ $OSTYPE == "cygwin" ]]; then
-    print -u8 "Warning: not testing [[ -N file ]] (not supported on Cygwin)"
+    print -u$ZTST_fd "Warning: not testing [[ -N file ]] (not supported on Cygwin)"
     true
   elif [[ "$(find . -prune -fstype nfs 2>/dev/null)" == "." ]]; then
-    print -u8 "Warning: not testing [[ -N file ]] (not supported with NFS)"
+    print -u$ZTST_fd "Warning: not testing [[ -N file ]] (not supported with NFS)"
     true
   else
     [[ -N newnewnew && ! -N unmodified ]]
@@ -174,7 +174,7 @@
 0:|| and && in conds
 
   if ! grep '#define PATH_DEV_FD' $ZTST_testdir/../config.h; then
-    print -u8 "Warning: not testing [[ -e /dev/fd/0 ]] (/dev/fd not supported)"
+    print -u$ZTST_fd "Warning: not testing [[ -e /dev/fd/0 ]] (/dev/fd not supported)"
     true
   else
     [[ -e /dev/fd/0 ]]
@@ -182,7 +182,7 @@
 0dD:/dev/fd support in conds handled by access
 
   if ! grep '#define PATH_DEV_FD' $ZTST_testdir/../config.h; then
-    print -u8 "Warning: not testing [[ -O /dev/fd/0 ]] (/dev/fd not supported)"
+    print -u$ZTST_fd "Warning: not testing [[ -O /dev/fd/0 ]] (/dev/fd not supported)"
     true
   else
     [[ -O /dev/fd/0 ]]

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


.

