From zsh-workers-return-19902-mason-zsh=primenet.com.au@sunsite.dk Mon May 10 00:03:02 2004
Return-Path: <zsh-workers-return-19902-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2060 invoked from network); 10 May 2004 00:01:41 -0000
Received: from ns2.primenet.com.au (HELO primenet.com.au) (26@203.24.36.3)
  by ns1.primenet.com.au with SMTP; 10 May 2004 00:01:41 -0000
Received: (qmail 5872 invoked from network); 9 May 2004 23:37:21 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.86)
  by proxy.melb.primenet.com.au with SMTP; 9 May 2004 23:37:21 -0000
Received: (qmail 29456 invoked from network); 9 May 2004 23:36:57 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 May 2004 23:36:57 -0000
Received: (qmail 22293 invoked by alias); 9 May 2004 23:36:52 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19902
Received: (qmail 22284 invoked from network); 9 May 2004 23:36:52 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (qmailr@130.225.247.86)
  by sunsite.dk with SMTP; 9 May 2004 23:36:49 -0000
Received: (qmail 29123 invoked from network); 9 May 2004 23:36:49 -0000
Received: from acolyte.scowler.net (216.254.112.45)
  by a.mx.sunsite.dk with SMTP; 9 May 2004 23:36:46 -0000
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id B92A27004A; Sun,  9 May 2004 19:36:19 -0400 (EDT)
Date: Sun, 9 May 2004 19:36:19 -0400
From: Clint Adams <clint@zsh.org>
To: zsh-workers@sunsite.dk
Cc: 245678-submitter@bugs.debian.org
Subject: Re: Bug#245678: zsh: built-in rm -rf fills up the memory
Message-ID: <20040509233619.GB11066@scowler.net>
References: <20040508140207.GA25045@scowler.net> <Pine.LNX.4.44.0405091518180.29962-100000@toltec.zanshin.com> <20040509233000.GA11066@scowler.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20040509233000.GA11066@scowler.net>
User-Agent: Mutt/1.5.5.1+cvs20040105i
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_44 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0

> [ h->used + (new - old) > HEAP_ARENA_SIZE ]
> 63432 + (63504 - 63432) > 16360
> 63504 + (63576 - 63504) > 16360

I added in h->size to the printf, to show the heap sizes.

60856 [out of 61440] + (60928 - 60856) > 16360
60928 [out of 61440] + (61008 - 60928) > 16360
61008 [out of 61440] + (61080 - 61008) > 16360
61080 [out of 61440] + (61152 - 61080) > 16360
61152 [out of 61440] + (61224 - 61152) > 16360
61224 [out of 61440] + (61304 - 61224) > 16360
61304 [out of 61440] + (61376 - 61304) > 16360
61376 [out of 61440] + (61448 - 61376) > 16360
61448 [out of 65536] + (61520 - 61448) > 16360
61520 [out of 65536] + (61600 - 61520) > 16360
61600 [out of 65536] + (61672 - 61600) > 16360
61672 [out of 65536] + (61744 - 61672) > 16360
61744 [out of 65536] + (61816 - 61744) > 16360
61816 [out of 65536] + (61896 - 61816) > 16360
61896 [out of 65536] + (61968 - 61896) > 16360
61968 [out of 65536] + (62040 - 61968) > 16360
62040 [out of 65536] + (62112 - 62040) > 16360
62112 [out of 65536] + (62184 - 62112) > 16360
62184 [out of 65536] + (62256 - 62184) > 16360
62256 [out of 65536] + (62328 - 62256) > 16360
62328 [out of 65536] + (62400 - 62328) > 16360
62400 [out of 65536] + (62472 - 62400) > 16360
62472 [out of 65536] + (62552 - 62472) > 16360
62552 [out of 65536] + (62624 - 62552) > 16360
62624 [out of 65536] + (62696 - 62624) > 16360
62696 [out of 65536] + (62768 - 62696) > 16360
62768 [out of 65536] + (62840 - 62768) > 16360
62840 [out of 65536] + (62912 - 62840) > 16360
62912 [out of 65536] + (62984 - 62912) > 16360
62984 [out of 65536] + (63056 - 62984) > 16360
63056 [out of 65536] + (63136 - 63056) > 16360
63136 [out of 65536] + (63208 - 63136) > 16360
63208 [out of 65536] + (63280 - 63208) > 16360
63280 [out of 65536] + (63352 - 63280) > 16360
63352 [out of 65536] + (63432 - 63352) > 16360
63432 [out of 65536] + (63504 - 63432) > 16360
63504 [out of 65536] + (63576 - 63504) > 16360
63576 [out of 65536] + (63648 - 63576) > 16360
63648 [out of 65536] + (63728 - 63648) > 16360
63728 [out of 65536] + (63800 - 63728) > 16360
63800 [out of 65536] + (63872 - 63800) > 16360
63872 [out of 65536] + (63944 - 63872) > 16360
63944 [out of 65536] + (64024 - 63944) > 16360
64024 [out of 65536] + (64096 - 64024) > 16360
64096 [out of 65536] + (64168 - 64096) > 16360
64168 [out of 65536] + (64240 - 64168) > 16360
64240 [out of 65536] + (64320 - 64240) > 16360
64320 [out of 65536] + (64392 - 64320) > 16360
64392 [out of 65536] + (64464 - 64392) > 16360
64464 [out of 65536] + (64536 - 64464) > 16360
64536 [out of 65536] + (64616 - 64536) > 16360
64616 [out of 65536] + (64688 - 64616) > 16360
64688 [out of 65536] + (64760 - 64688) > 16360
64760 [out of 65536] + (64832 - 64760) > 16360
64832 [out of 65536] + (64904 - 64832) > 16360
64904 [out of 65536] + (64984 - 64904) > 16360
64984 [out of 65536] + (65056 - 64984) > 16360
65056 [out of 65536] + (65128 - 65056) > 16360
65128 [out of 65536] + (65200 - 65128) > 16360
65200 [out of 65536] + (65280 - 65200) > 16360
65280 [out of 65536] + (65352 - 65280) > 16360
65352 [out of 65536] + (65424 - 65352) > 16360
65424 [out of 65536] + (65496 - 65424) > 16360
65496 [out of 65536] + (65576 - 65496) > 16360
65576 [out of 69632] + (65648 - 65576) > 16360
65648 [out of 69632] + (65720 - 65648) > 16360
65720 [out of 69632] + (65792 - 65720) > 16360
65792 [out of 69632] + (65872 - 65792) > 16360
65872 [out of 69632] + (65944 - 65872) > 16360
65944 [out of 69632] + (66016 - 65944) > 16360
66016 [out of 69632] + (66088 - 66016) > 16360
66088 [out of 69632] + (66168 - 66088) > 16360
66168 [out of 69632] + (66240 - 66168) > 16360
66240 [out of 69632] + (66312 - 66240) > 16360
66312 [out of 69632] + (66384 - 66312) > 16360
66384 [out of 69632] + (66456 - 66384) > 16360
66456 [out of 69632] + (66536 - 66456) > 16360
66536 [out of 69632] + (66608 - 66536) > 16360
66608 [out of 69632] + (66680 - 66608) > 16360
66680 [out of 69632] + (66752 - 66680) > 16360
66752 [out of 69632] + (66832 - 66752) > 16360
66832 [out of 69632] + (66904 - 66832) > 16360
66904 [out of 69632] + (66976 - 66904) > 16360
66976 [out of 69632] + (67048 - 66976) > 16360
67048 [out of 69632] + (67120 - 67048) > 16360
67120 [out of 69632] + (67200 - 67120) > 16360
67200 [out of 69632] + (67272 - 67200) > 16360
67272 [out of 69632] + (67344 - 67272) > 16360
67344 [out of 69632] + (67416 - 67344) > 16360
67416 [out of 69632] + (67488 - 67416) > 16360
67488 [out of 69632] + (67568 - 67488) > 16360
67568 [out of 69632] + (67640 - 67568) > 16360
67640 [out of 69632] + (67712 - 67640) > 16360
67712 [out of 69632] + (67784 - 67712) > 16360
67784 [out of 69632] + (67856 - 67784) > 16360
67856 [out of 69632] + (67928 - 67856) > 16360
67928 [out of 69632] + (68000 - 67928) > 16360
68000 [out of 69632] + (68072 - 68000) > 16360
68072 [out of 69632] + (68144 - 68072) > 16360
68144 [out of 69632] + (68216 - 68144) > 16360
68216 [out of 69632] + (68288 - 68216) > 16360
68288 [out of 69632] + (68360 - 68288) > 16360
68360 [out of 69632] + (68432 - 68360) > 16360
68432 [out of 69632] + (68504 - 68432) > 16360
68504 [out of 69632] + (68576 - 68504) > 16360
68576 [out of 69632] + (68648 - 68576) > 16360
68648 [out of 69632] + (68720 - 68648) > 16360
68720 [out of 69632] + (68792 - 68720) > 16360
68792 [out of 69632] + (68864 - 68792) > 16360
68864 [out of 69632] + (68936 - 68864) > 16360
68936 [out of 69632] + (69008 - 68936) > 16360
69008 [out of 69632] + (69080 - 69008) > 16360
69080 [out of 69632] + (69152 - 69080) > 16360
69152 [out of 69632] + (69224 - 69152) > 16360
69224 [out of 69632] + (69296 - 69224) > 16360
69296 [out of 69632] + (69368 - 69296) > 16360
69368 [out of 69632] + (69440 - 69368) > 16360
69440 [out of 69632] + (69512 - 69440) > 16360
69512 [out of 69632] + (69584 - 69512) > 16360
69584 [out of 69632] + (69656 - 69584) > 16360
69656 [out of 73728] + (69728 - 69656) > 16360
69728 [out of 73728] + (69800 - 69728) > 16360
69800 [out of 73728] + (69872 - 69800) > 16360
69872 [out of 73728] + (69944 - 69872) > 16360
69944 [out of 73728] + (70016 - 69944) > 16360
70016 [out of 73728] + (70088 - 70016) > 16360
70088 [out of 73728] + (70160 - 70088) > 16360
70160 [out of 73728] + (70232 - 70160) > 16360
70232 [out of 73728] + (70304 - 70232) > 16360
70304 [out of 73728] + (70376 - 70304) > 16360
70376 [out of 73728] + (70448 - 70376) > 16360
70448 [out of 73728] + (70520 - 70448) > 16360
70520 [out of 73728] + (70592 - 70520) > 16360
70592 [out of 73728] + (70664 - 70592) > 16360
70664 [out of 73728] + (70736 - 70664) > 16360
70736 [out of 73728] + (70808 - 70736) > 16360
70808 [out of 73728] + (70880 - 70808) > 16360
70880 [out of 73728] + (70952 - 70880) > 16360
70952 [out of 73728] + (71024 - 70952) > 16360
71024 [out of 73728] + (71096 - 71024) > 16360
71096 [out of 73728] + (71168 - 71096) > 16360
71168 [out of 73728] + (71240 - 71168) > 16360
71240 [out of 73728] + (71312 - 71240) > 16360
71312 [out of 73728] + (71384 - 71312) > 16360
71384 [out of 73728] + (71456 - 71384) > 16360
71456 [out of 73728] + (71528 - 71456) > 16360
71528 [out of 73728] + (71600 - 71528) > 16360
71600 [out of 73728] + (71672 - 71600) > 16360
71672 [out of 73728] + (71744 - 71672) > 16360
71744 [out of 73728] + (71816 - 71744) > 16360
71816 [out of 73728] + (71888 - 71816) > 16360
71888 [out of 73728] + (71960 - 71888) > 16360
71960 [out of 73728] + (72032 - 71960) > 16360
72032 [out of 73728] + (72104 - 72032) > 16360
72104 [out of 73728] + (72176 - 72104) > 16360
72176 [out of 73728] + (72248 - 72176) > 16360
72248 [out of 73728] + (72320 - 72248) > 16360
72320 [out of 73728] + (72392 - 72320) > 16360
72392 [out of 73728] + (72464 - 72392) > 16360
72464 [out of 73728] + (72536 - 72464) > 16360
72536 [out of 73728] + (72608 - 72536) > 16360
72608 [out of 73728] + (72680 - 72608) > 16360
72680 [out of 73728] + (72752 - 72680) > 16360
72752 [out of 73728] + (72824 - 72752) > 16360
72824 [out of 73728] + (72896 - 72824) > 16360
72896 [out of 73728] + (72968 - 72896) > 16360
72968 [out of 73728] + (73040 - 72968) > 16360
73040 [out of 73728] + (73112 - 73040) > 16360
73112 [out of 73728] + (73184 - 73112) > 16360
73184 [out of 73728] + (73256 - 73184) > 16360
73256 [out of 73728] + (73328 - 73256) > 16360
73328 [out of 73728] + (73400 - 73328) > 16360
73400 [out of 73728] + (73472 - 73400) > 16360
73472 [out of 73728] + (73544 - 73472) > 16360
73544 [out of 73728] + (73616 - 73544) > 16360
73616 [out of 73728] + (73688 - 73616) > 16360
73688 [out of 73728] + (73760 - 73688) > 16360
73760 [out of 77824] + (73832 - 73760) > 16360
73832 [out of 77824] + (73904 - 73832) > 16360
73904 [out of 77824] + (73976 - 73904) > 16360
73976 [out of 77824] + (74048 - 73976) > 16360
74048 [out of 77824] + (74120 - 74048) > 16360
74120 [out of 77824] + (74192 - 74120) > 16360
74192 [out of 77824] + (74264 - 74192) > 16360
74264 [out of 77824] + (74336 - 74264) > 16360
74336 [out of 77824] + (74408 - 74336) > 16360
74408 [out of 77824] + (74480 - 74408) > 16360
74480 [out of 77824] + (74552 - 74480) > 16360
74552 [out of 77824] + (74624 - 74552) > 16360
74624 [out of 77824] + (74696 - 74624) > 16360
74696 [out of 77824] + (74768 - 74696) > 16360
74768 [out of 77824] + (74840 - 74768) > 16360
74840 [out of 77824] + (74912 - 74840) > 16360
74912 [out of 77824] + (74984 - 74912) > 16360
74984 [out of 77824] + (75056 - 74984) > 16360
75056 [out of 77824] + (75128 - 75056) > 16360
75128 [out of 77824] + (75200 - 75128) > 16360
75200 [out of 77824] + (75272 - 75200) > 16360
75272 [out of 77824] + (75344 - 75272) > 16360
75344 [out of 77824] + (75416 - 75344) > 16360
75416 [out of 77824] + (75488 - 75416) > 16360
75488 [out of 77824] + (75560 - 75488) > 16360
75560 [out of 77824] + (75632 - 75560) > 16360
75632 [out of 77824] + (75704 - 75632) > 16360
75704 [out of 77824] + (75776 - 75704) > 16360
75776 [out of 77824] + (75848 - 75776) > 16360
75848 [out of 77824] + (75920 - 75848) > 16360
75920 [out of 77824] + (75992 - 75920) > 16360
75992 [out of 77824] + (76064 - 75992) > 16360
76064 [out of 77824] + (76136 - 76064) > 16360
76136 [out of 77824] + (76208 - 76136) > 16360
76208 [out of 77824] + (76280 - 76208) > 16360
76280 [out of 77824] + (76352 - 76280) > 16360
76352 [out of 77824] + (76424 - 76352) > 16360
76424 [out of 77824] + (76496 - 76424) > 16360
76496 [out of 77824] + (76568 - 76496) > 16360
76568 [out of 77824] + (76640 - 76568) > 16360
76640 [out of 77824] + (76712 - 76640) > 16360
76712 [out of 77824] + (76784 - 76712) > 16360
76784 [out of 77824] + (76856 - 76784) > 16360
76856 [out of 77824] + (76928 - 76856) > 16360
76928 [out of 77824] + (77000 - 76928) > 16360
77000 [out of 77824] + (77072 - 77000) > 16360
77072 [out of 77824] + (77144 - 77072) > 16360
77144 [out of 77824] + (77216 - 77144) > 16360
77216 [out of 77824] + (77288 - 77216) > 16360
77288 [out of 77824] + (77360 - 77288) > 16360
77360 [out of 77824] + (77432 - 77360) > 16360
77432 [out of 77824] + (77504 - 77432) > 16360
77504 [out of 77824] + (77576 - 77504) > 16360
77576 [out of 77824] + (77648 - 77576) > 16360
77648 [out of 77824] + (77720 - 77648) > 16360
77720 [out of 77824] + (77792 - 77720) > 16360
77792 [out of 77824] + (77864 - 77792) > 16360
77864 [out of 81920] + (77936 - 77864) > 16360
77936 [out of 81920] + (78008 - 77936) > 16360
78008 [out of 81920] + (78080 - 78008) > 16360
78080 [out of 81920] + (78152 - 78080) > 16360
78152 [out of 81920] + (78224 - 78152) > 16360
78224 [out of 81920] + (78296 - 78224) > 16360
78296 [out of 81920] + (78368 - 78296) > 16360
78368 [out of 81920] + (78440 - 78368) > 16360
78440 [out of 81920] + (78512 - 78440) > 16360
78512 [out of 81920] + (78584 - 78512) > 16360
78584 [out of 81920] + (78656 - 78584) > 16360
78656 [out of 81920] + (78728 - 78656) > 16360
78728 [out of 81920] + (78800 - 78728) > 16360
78800 [out of 81920] + (78872 - 78800) > 16360
78872 [out of 81920] + (78944 - 78872) > 16360
78944 [out of 81920] + (79016 - 78944) > 16360
79016 [out of 81920] + (79088 - 79016) > 16360
79088 [out of 81920] + (79160 - 79088) > 16360
79160 [out of 81920] + (79232 - 79160) > 16360
79232 [out of 81920] + (79304 - 79232) > 16360
79304 [out of 81920] + (79376 - 79304) > 16360
79376 [out of 81920] + (79448 - 79376) > 16360
79448 [out of 81920] + (79520 - 79448) > 16360
79520 [out of 81920] + (79592 - 79520) > 16360
79592 [out of 81920] + (79664 - 79592) > 16360
79664 [out of 81920] + (79736 - 79664) > 16360
79736 [out of 81920] + (79808 - 79736) > 16360
79808 [out of 81920] + (79880 - 79808) > 16360
79880 [out of 81920] + (79952 - 79880) > 16360
79952 [out of 81920] + (80024 - 79952) > 16360
80024 [out of 81920] + (80096 - 80024) > 16360
80096 [out of 81920] + (80168 - 80096) > 16360
80168 [out of 81920] + (80240 - 80168) > 16360
80240 [out of 81920] + (80312 - 80240) > 16360

