From zsh-workers-return-19442-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 18 22:01:38 2004
Return-Path: <zsh-workers-return-19442-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28754 invoked from network); 18 Feb 2004 22:01:37 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 18 Feb 2004 22:01:37 -0000
Received: (qmail 17578 invoked by alias); 18 Feb 2004 22:01:24 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19442
Received: (qmail 17565 invoked from network); 18 Feb 2004 22:01:23 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 18 Feb 2004 22:01:23 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [195.92.193.19] by sunsite.dk (MessageWall 1.0.8) with SMTP; 18 Feb 2004 22:1:22 -0000
Received: from modem-46.curufin.dialup.pol.co.uk ([62.136.148.174] helo=pwstephenson.fsnet.co.uk)
	by cmailm3.svr.pol.co.uk with esmtp (Exim 4.14)
	id 1AtZkv-0005mR-0s
	for zsh-workers@sunsite.dk; Wed, 18 Feb 2004 22:01:21 +0000
Received: by pwstephenson.fsnet.co.uk (Postfix, from userid 501)
	id 52447865B; Wed, 18 Feb 2004 17:02:30 -0500 (EST)
Received: from pwstephenson.fsnet.co.uk (localhost [127.0.0.1])
	by pwstephenson.fsnet.co.uk (Postfix) with ESMTP id 1A347865A
	for <zsh-workers@sunsite.dk>; Wed, 18 Feb 2004 22:02:30 +0000 (GMT)
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: Re: jobs not listing all commands 
In-reply-to: "Bart Schaefer"'s message of "Wed, 18 Feb 2004 17:47:08 GMT."
             <1040218174708.ZM13219@candle.brasslantern.com> 
Date: Wed, 18 Feb 2004 22:02:28 +0000
From: Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Message-Id: <20040218220230.52447865B@pwstephenson.fsnet.co.uk>

Bart Schaefer wrote:
> } I'm not sure how to test for this.  Maybe it would be enough to try
> } compiling and linking a programme with grantpt etc., since I think
> } configure is sensitive to compiler warnings.
> 
> While a missing-header test is probably appropriate, in this case I think
> the issue is whether zsh wants to define _XOPEN_SOURCE, and if not, then
> it shouldn't use /dev/ptmx even when the device exists.

Some more results...

1. Defining _GNU_SOURCE seems to work OK, except there is a function
which clashes with the getline in zle_hist.c.  However, that function
doesn't seem to be used anyway.

2. That doesn't fix the problem.  It seems that the problem is the
streams modules --- I was too optimistic about them not causing problems
if they weren't needed.  We need to find out where they are needed.
I'm tempted just to limit that chunk of code to Solaris.  Does anyone
know of another system (with /dev/ptmx) which is keen on ttcompat and
friends?

One course of action:

- Define _GNU_SOURCE for Linux only --- we've got enough testers to make
it fairly painless to find out if this causes compilation problems.
(Defining _XOPEN_SOURCE directly is harder since you've got to work
out the version number.)
- Check for the function definitions, particularly ptsname(), to make
sure.
- Only let the streams stuff cause havoc on Solaris.

-- 
Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Work: pws@csr.com
Web: http://www.pwstephenson.fsnet.co.uk

