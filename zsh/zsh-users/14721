From zsh-users-return-14721-mason-zsh=primenet.com.au@zsh.org Wed Jan 20 17:17:07 2010
Return-Path: <zsh-users-return-14721-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 960 invoked by alias); 20 Jan 2010 17:17:07 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14721
Received: (qmail 23951 invoked from network); 20 Jan 2010 17:17:04 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VERIFIED,UNPARSEABLE_RELAY autolearn=ham version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at yahoo.fr does not designate permitted sender hosts)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.fr;
  h=Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Date:From:To:Cc:Subject:Message-ID:Mail-Followup-To:References:MIME-Version:Content-Type:Content-Disposition:In-Reply-To:User-Agent;
  b=GUbXIGOsaTfVSHV4VFm+7tVjlehg49npMbWw+KSp+A/FHijsdJtFCdFl+al5O/MyXm6D++5vVKHRYyOnqnt9msmEe1/DBYq2jBVehbz4T0fNOgCQ2+FDjibIUzMtlbJzpbpyP+rUbcOlJiOTFaR4hhSxLzIJWe3zDrRCyyhLIyE=  ;
X-Yahoo-SMTP: V1UR0WuswBDVD1eFhM33188Ir8ciBckz4W8ZMsAh
X-YMail-OSG: v82nhiIVM1n3_53AGUuA4cpkZMx4C4hiE50YVsRQUrQtnz5PDAfGNT9B1COzEv0ZfgxpusQ8n3D2z9dDXVy.fl3GnyMecXXXhyiW.hSWHE5a7uKviSSU0W8_f30mn8pSICz9mrareETUz8jf4Pp_qF_JmEaNg1ouxBy18_RpzhVk4cS9yO05H0EDL2sgShIiIr2n_0mlOACR8H83ZCV8bdt_1pQBwrwxKnFdYCAhd_8u
X-Yahoo-Newman-Property: ymail-3
Date: Wed, 20 Jan 2010 17:10:20 +0000
From: Stephane Chazelas <stephane_chazelas@yahoo.fr>
To: Richard Hartmann <richih.mailinglist@gmail.com>
Cc: zsh-users@zsh.org
Subject: Re: More verbose && ?
Message-ID: <chaz20100120171020.GC3872@yahoo.fr>
Mail-Followup-To: Richard Hartmann <richih.mailinglist@gmail.com>,
	zsh-users@zsh.org
References: <2d460de71001200834i7037df54h647f7b01d6ebdc4@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <2d460de71001200834i7037df54h647f7b01d6ebdc4@mail.gmail.com>
User-Agent: Mutt/1.5.16 (2007-09-19)

2010-01-20 17:34:38 +0100, Richard Hartmann:
> Hi all,
> 
> I am wondering if there is a way to make && more verbose. Specifically,
> I am interested in where it failed in case it does.
> 
> Consider this, admittedly crafted, example:
> 
> 
> rm dontexist
> touch exist
> echo yes && cat exist 2>/dev/null && cat dontexist 2>/dev/null && echo no
> 
> 
> This will not tell you _where_ it failed, just that it did (and even
> that only implicitely via return codes). I would prefer something along
> the lines of:
> 
> 
> Error executing "echo yes && cat exist 2>/dev/null && cat dontexist
> 2>/dev/null && echo no": "cat dontexist" failed.
> 
> Or just
> Error(1): "cat dontexist"
> 
> 
> (1) being the, optional, return code being displayed.
[...]

try:

r() { last_run_command=${(j: :)*}; "$@"; }
report() {
  exit_code=$?
  printf >&2 'Error(%d): "%s"\n' "$exit_code" "$last_run_command"
  return "$exit_code"
}

r echo yes &&
  r cat exist 2>/dev/null &&
  r cat dontexist 2>/dev/null &&
  echo no || report

-- 
Stephane

