From zsh-users-return-13971-mason-zsh=primenet.com.au@sunsite.dk Thu Mar 26 08:11:06 2009
Return-Path: <zsh-users-return-13971-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21694 invoked from network); 26 Mar 2009 08:11:02 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 26 Mar 2009 08:11:02 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 51459 invoked from network); 26 Mar 2009 08:10:48 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 26 Mar 2009 08:10:48 -0000
Received: (qmail 8907 invoked by alias); 26 Mar 2009 08:10:29 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13971
Received: (qmail 8893 invoked from network); 26 Mar 2009 08:10:28 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 26 Mar 2009 08:10:28 -0000
Received: from atom.smasher.org (atom.smasher.org [69.55.237.145])
	by bifrost.dotsrc.org (Postfix) with SMTP id B084380EA0C1
	for <zsh-users@sunsite.dk>; Thu, 26 Mar 2009 09:10:04 +0100 (CET)
Received: (qmail 68167 invoked by uid 1000); 26 Mar 2009 08:10:03 -0000
Message-ID: <20090326081003.68165.qmail@smasher.org>
cc: Zsh Users <zsh-users@sunsite.dk>
Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed
Date: Thu, 26 Mar 2009 21:09:58 +1300 (NZDT)
From: Atom Smasher <atom@smasher.org>
In-Reply-To: <chaz20090325122302.GB5054@seebyte.com>
MIME-Version: 1.0
OpenPGP: id=0xB88D52E4D9F57808; algo=1 (RSA); size=4096; url=http://atom.smasher.org/pgp.txt
References: <20090324101411.66890.qmail@smasher.org> <chaz20090324114727.GA5144@seebyte.com>
 <20090324213624.93603.qmail@smasher.org> <alpine.LNX.2.00.0903250227080.3609@averatec>
 <chaz20090325122302.GB5054@seebyte.com>
Subject: Re: freebsd problems with carriage return
To: Stephane Chazelas <stephane_chazelas@yahoo.fr>
X-POM: The Moon is New
X-Hashcash: 1:20:0903260810:stephane_chazelas@yahoo.fr::fUoMbIYzWsttgdq9:0000000
	0000000000000000000000000ZGg
X-Hashcash: 1:20:0903260810:zsh-users@sunsite.dk::Z7gP0Zy0gLkNv1g+:0000000000000
	000000000000000000000000C8A7
X-Virus-Scanned: ClamAV 0.92.1/9169/Thu Mar 26 05:13:48 2009 on bifrost
X-Virus-Status: Clean

On Wed, 25 Mar 2009, Stephane Chazelas wrote:

> Except that as far as I can see from the source code, it does an 
> explicit fflush() after each progress line, so it shouldn't be a stdio 
> buffering issue. Unless the OP's using an old version of rsync on 
> FreeBSD?
==================

freebsd:
 	rsync  version 3.0.2
 	rsync  version 3.0.5
linux:
 	rsync  version 2.6.9


> The fact that you don't get the output when stdout is a pipe is probably 
> the place to look at. But I don't know why rsync would decide not to 
> output the progress when stdout is pipe as opposed to when it's a 
> regular file.
====================

hhmmm... it may be related to a pipe (but it works as expected on linux, 
with a pipe or redirect)... so maybe i can use a redirect as if it's a 
pipe...
 	http://smasher.org/tmp/snapshot154.png

the top half of that split screen is `tr` converting carriage returns into 
newlines, and reading stdin from a fifo. the bottom half is rsync, with 
stdout redirected into the fifo. it's working as desired and expected, 
even on freebsd.

what seems to me like just a slight variation of that, once again works on 
linux and fails on freebsd:
 	tr '\r' '\n' < <( rsync --progress --bwlimit=5 foo_in foo_out )
  or:
 	rsync --progress --bwlimit=5 foo_in foo_out > >( tr '\r' '\n' )

my understanding of zsh; process substitution should operate as a fifo. so 
i really don't get why it works as desired in the screen-shot, but not 
with process substitution.


-- 
         ...atom

  ________________________
  http://atom.smasher.org/
  762A 3B98 A3C3 96C9 C6B7 582A B88D 52E4 D9F5 7808
  -------------------------------------------------

 	"Only when the last tree has died,
 	 And the last river poisoned,
 	 And the last fish been caught,
 	 Will the white man realize that he cannot eat money"
 		--19th Century Cree Indian Proverb

