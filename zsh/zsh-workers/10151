From zsh-workers-return-10151-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Mar 15 18:15:36 2000
Return-Path: <zsh-workers-return-10151-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6256 invoked from network); 15 Mar 2000 18:15:35 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 Mar 2000 18:15:35 -0000
Received: (qmail 18578 invoked by alias); 15 Mar 2000 18:15:29 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10151
Received: (qmail 18560 invoked from network); 15 Mar 2000 18:15:28 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000315181505.ZM23749@candle.brasslantern.com>
Date: Wed, 15 Mar 2000 18:15:05 +0000
In-Reply-To: <200003151557.QAA27085@beta.informatik.hu-berlin.de>
Comments: In reply to Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
        "Re: Default fpath" (Mar 15,  4:57pm)
References: <200003151557.QAA27085@beta.informatik.hu-berlin.de>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>,
        zsh-workers@sunsite.auc.dk
Subject: Re: Default fpath
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Mar 15,  4:57pm, Sven Wischnowsky wrote:
} Subject: Re: Default fpath
}
} Bart Schaefer wrote:
} > Hmm, maybe autoload should have the `k' and `z' opts,
} > too, but they only work with +X (the load-it now option).  That would
} > fix something that's been bugging me for a while.
} 
} I haven't added that for autoload yet and there is another thing:
} loadautofn() should probably make use of this too, maybe execute the
} Eprog it gets from getfpfunc() when it knows that the function should
} be ksh-autoloaded (either because the dump file said so or because
} `autoload +x' said so). But then, it doesn't do that if KSHAUTOLOAD is 
} set. I guess that's some security issue?

It's not exactly a security issue; that's the "something that's been
bugging me for a while."

Autoload +X is supposed to promise that the autoloaded function is not
executed.  Unfortunately, in the kshautoload style, you have to execute
the code in order to get the function defined, which may mean executing
other code that's in the file but not inside any function body.

For at least one intended use of "autoload +X" -- finding out whether
the function is in fpath and is syntactically correct -- other code in
the file should NOT be executed; rather, you want the effect of the
`[[ -o kshautoload ]] && run-myself "$@"' trick to take effect at the
time an actual *call* to the function is made.

At the time that I added loadautofn() there wasn't any way to achieve
that result, but perhaps now with wordcode it'll be possible.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

