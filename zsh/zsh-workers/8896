From zsh-workers-return-8896-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Dec 05 12:34:55 1999
Return-Path: <zsh-workers-return-8896-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24672 invoked from network); 5 Dec 1999 12:34:54 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 5 Dec 1999 12:34:54 -0000
Received: (qmail 13122 invoked by alias); 5 Dec 1999 12:34:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8896
Received: (qmail 13115 invoked from network); 5 Dec 1999 12:34:48 -0000
Subject: Re: PATCH: Previous zsh.yo.in patch wasn't good enough
In-Reply-To: <991203170925.ZM18217@candle.brasslantern.com> from Bart Schaefer at "Dec 3, 1999  5: 9:25 pm"
To: schaefer@candle.brasslantern.com (Bart Schaefer)
Date: Sun, 5 Dec 1999 12:34:46 +0000 (GMT)
Cc: zsh-workers@sunsite.auc.dk
X-Mailer: ELM [version 2.4ME+ PL48 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Message-Id: <E11uasI-0003R0-00@crucigera.fysh.org>
From: Zefram <zefram@fysh.org>

Bart Schaefer wrote:
>My thought (which I now see to have been half-formed) was that the docs
>were architecture-independent and hence the same for all builds

They are.  There used to be some configure-specific variable
interpolations, but they were all removed so that the documentation would
be the same everywhere.  This is a necessity, because we can't rely on the
availability of yodl to build a localised version of the documentation.
It is also useful in that people can refer to "page <X> of the Z Shell
Manual" and so on.

>of course it's possible to have two build trees with different name
>transforms.

Yes.  So far that's the only reason why we now need localised
documentation.

>This leads me to conclude that the $(tzsh).info change is either going
>too far, or not far enough:  If we're renaming zsh.info, why aren't we
>renaming zsh.1 and zshall.1 and zshbuiltins.1 etc?

Yes, we should.

>I *think* -- based on looking at automake-generated Makefile.in files --
>that program name transforms are intended strictly as an install-time
>thing, and should not affect compile-time file generation.  Its too bad
>that info format requires the files to reference their own names.

This suggests that we can do the variable replacement on the .texi file,
and then change the names only in the install.  We'd have the .yo files
generating zsh.texi.in in the source tree, and that gets distributed.
Then a sed over that generates zsh.texi in the build tree, with the
transformed name in the appropriate place.  We run makeinfo on that.
Then rename everything (executable, man pages, info files) as its being
installed.

We should probably also rename the lib directory, though this would
require additional effort to compile the transformed name into the
executable.  Same for the share directory.

-zefram

