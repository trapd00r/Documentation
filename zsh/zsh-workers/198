From zsh-workers-request@math.gatech.edu  Wed Jul 12 07:01:20 1995
Received: from gatech.edu (gatech.edu [130.207.244.244]) by werple.mira.net.au (8.6.12/8.6.9) with SMTP id HAA20818 for <mason@werple.mira.net.au>; Wed, 12 Jul 1995 07:01:17 +1000
Received: from math (math.skiles.gatech.edu) by gatech.edu with SMTP id AA12077
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Tue, 11 Jul 1995 17:01:08 -0400
Received: by math (5.x/SMI-SVR4)
	id AA06537; Tue, 11 Jul 1995 16:57:21 -0400
Resent-Date: Tue, 11 Jul 1995 21:58:05 +0100 (BST)
Old-Return-Path: <zefram@dcs.warwick.ac.uk>
From: Zefram <A.Main@dcs.warwick.ac.uk>
Message-Id: <1995.199507112058@stone.dcs.warwick.ac.uk>
Subject: AUTO_LIST patch
To: zsh-workers@math.gatech.edu (Z Shell workers mailing list)
Date: Tue, 11 Jul 1995 21:58:05 +0100 (BST)
X-Loop: zefram@dcs.warwick.ac.uk
X-Stardate: [-31]5964.36
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-Id: <"dlG0E1.0._b1.mMk0m"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/198
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

-----BEGIN PGP SIGNED MESSAGE-----

The patch below prevents a superfluous display of a completion list,
which can occur if AUTO_LIST and ALWAYS_LAST_PROMPT are set.  For
example, with some kind of menu completion enabled, and not in a large
directory, do a list-choices (there is now a valid list on the screen),
followed by complete-word (the list is needlessly redrawn).  Note that
the first hunk just gets rid of a superfluous "else" in a related bit
of code.

This patch depends, of course, upon my previous patches to the listing
code.

 -zefram

      *** Src/zle_tricky.c.old	Tue Jul 11 20:39:19 1995
      --- Src/zle_tricky.c	Tue Jul 11 21:46:45 1995
      ***************
      *** 526,532 ****
            
            /* Check if we have to start a menu-completion (via automenu). */
        
      !     else if ((amenu = (isset(AUTOMENU) &&
        		       (lastcmd & ZLE_MENUCMP) &&
        		       lastambig)))
        	usemenu = 1;
      --- 526,532 ----
            
            /* Check if we have to start a menu-completion (via automenu). */
        
      !     if ((amenu = (isset(AUTOMENU) &&
        		       (lastcmd & ZLE_MENUCMP) &&
        		       lastambig)))
        	usemenu = 1;
      ***************
      *** 3234,3240 ****
        	if (unset(NOLISTBEEP))
        	    feep();
        	/* And finally list the matches if needed (and requested). */
      ! 	if (isset(AUTOLIST) && !amenu)
        	    showinglist = -2;
            }
        }
      --- 3234,3240 ----
        	if (unset(NOLISTBEEP))
        	    feep();
        	/* And finally list the matches if needed (and requested). */
      ! 	if (isset(AUTOLIST) && !amenu && !showinglist)
        	    showinglist = -2;
            }
        }

-----BEGIN PGP SIGNATURE-----
Version: 2.6.i

iQBVAgUBMALlzWWJ8JfKi+e9AQE8WgH/XeOVQQ7dXxWk/paufPJBTzKAn7FT6Vdx
UILR5BtppAc7yPI3wngvEBKnqrS0UKGEOFJZ5il5l6/5ucBv7Q3nlg==
=DJvN
-----END PGP SIGNATURE-----

