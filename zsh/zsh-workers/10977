From zsh-workers-return-10977-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Apr 27 12:42:47 2000
Return-Path: <zsh-workers-return-10977-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16361 invoked from network); 27 Apr 2000 12:42:42 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 27 Apr 2000 12:42:42 -0000
Received: (qmail 9541 invoked by alias); 27 Apr 2000 12:42:24 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10977
Received: (qmail 9528 invoked from network); 27 Apr 2000 12:42:23 -0000
Date: Thu, 27 Apr 2000 14:42:13 +0200 (MET DST)
Message-Id: <200004271242.OAA15739@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Thu, 27 Apr 2000 16:29:44 +0400
Subject: Re: PATCH: RE: _make error


Andrej Borsenkow wrote:

> > In Zsh top level directory (gmake is GNU make)
> >
> > sudo gmake install.moTAB
> >
> > resulted in (long long - already scrolled away)
> >
> > ........
> >
> > make: Fatal error: don't know how to make .PHONY (bu42).
> > dules
> 
> It called ``make'' instead of $words[1]. Patch attached because of line
> length as usual.

The patch below contains Andrej's change and some more from me.

It should *at least* use _call. And I'm *very* tempted to add a style
to keep it from calling make even when it's a GNU make. Somehow I was
asleep when this was added, it seems, although I remember that there
was a lot of discussion.

Heck, doing `make <TAB>' just made it run config.status or
something. That's *completely* unacceptable.

Bye
 Sven

Index: Completion/User/_make
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/User/_make,v
retrieving revision 1.6
diff -u -r1.6 _make
--- Completion/User/_make	2000/04/25 04:50:53	1.6
+++ Completion/User/_make	2000/04/27 12:41:35
@@ -33,7 +33,7 @@
 
   if [[ -n "$file" ]] && _tags targets; then
     if [[ -n "$_is_gnu[$words[1]]" ]]; then
-      tmp=( $(make -nsp --no-print-directory -f "$file" .PHONY | awk '/^[a-zA-Z0-9][^\/\t=]+:/ {print $1}' FS=:) )
+      tmp=( $(_call targets "$words[1]" -nsp --no-print-directory -f "$file" .PHONY 2> /dev/null | awk '/^[a-zA-Z0-9][^\/\t=]+:/ {print $1}' FS=:) )
     else
       tmp=(
             $(awk '/^[a-zA-Z0-9][^\/\t=]+:/ {print $1}

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

