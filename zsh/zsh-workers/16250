From zsh-workers-return-16250-mason-zsh=primenet.com.au@sunsite.dk Thu Nov 15 08:17:22 2001
Return-Path: <zsh-workers-return-16250-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8220 invoked from network); 15 Nov 2001 08:17:20 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 15 Nov 2001 08:17:20 -0000
Received: (qmail 21977 invoked by alias); 15 Nov 2001 08:17:10 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16250
Received: (qmail 21958 invoked from network); 15 Nov 2001 08:17:10 -0000
Message-Id: <7D865FB0D0A1D5118B6E000347055BBB148483@G9JNT.mgb01.telekom.de>
From: "Wischnowsky, Sven" <Sven.Wischnowsky@t-systems.de>
To: zsh-workers@sunsite.dk
Subject: Re: [bug report] 4.0.2 / 4.0.4 dumps core
Date: Thu, 15 Nov 2001 09:16:59 +0100
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: text/plain;
	charset="ISO-8859-1"


I wrote:

> > schaefer[524] Src/zsh -f
> > zagzig% setopt extendedglob globcomplete nobanghist
> > zagzig% !^<TAB>zsh: segmentation fault (core dumped)  Src/zsh -f
> 
> I had a patch for this, too, that just made the shell use 
> duplicates in the
> reswdtab - it isn't that much memory being wasted (but of 
> course I forgot
> to bring that patch together with the other one).

Here's that patch.

Bye
  Sven

diff -ur ../oz/Src/hashtable.c ./Src/hashtable.c
--- ../oz/Src/hashtable.c	Tue Nov 13 19:13:45 2001
+++ ./Src/hashtable.c	Tue Nov 13 19:26:12 2001
@@ -975,7 +975,7 @@
     reswdtab->printnode   = printreswdnode;
 
     for (rw = reswds; rw->nam; rw++)
-	reswdtab->addnode(reswdtab, rw->nam, rw);
+	reswdtab->addnode(reswdtab, ztrdup(rw->nam), rw);
 }
 
 /* Print a reserved word */

