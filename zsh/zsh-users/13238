From zsh-users-return-13238-mason-zsh=primenet.com.au@sunsite.dk Thu Sep 18 10:22:00 2008
Return-Path: <zsh-users-return-13238-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26788 invoked from network); 18 Sep 2008 10:21:58 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 18 Sep 2008 10:21:58 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 36197 invoked from network); 18 Sep 2008 10:21:34 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 18 Sep 2008 10:21:34 -0000
Received: (qmail 3485 invoked by alias); 18 Sep 2008 10:21:18 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13238
Received: (qmail 3476 invoked from network); 18 Sep 2008 10:21:17 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 18 Sep 2008 10:21:17 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [208.87.233.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 76432802720D
	for <zsh-users@sunsite.dk>; Thu, 18 Sep 2008 12:20:56 +0200 (CEST)
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly19g.srv.mailcontrol.com (MailControl) with ESMTP id m8IAK1r4028390
	for <zsh-users@sunsite.dk>; Thu, 18 Sep 2008 11:20:39 +0100
Received: from news01 ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 18 Sep 2008 11:20:08 +0100
Date: Thu, 18 Sep 2008 11:20:03 +0100
From: Peter Stephenson <pws@csr.com>
To: zsh users <zsh-users@sunsite.dk>
Subject: Re: Submitting vcs_info function
Message-ID: <20080918112003.45911104@news01>
In-Reply-To: <20080917201859.GU2182@fsst.voodoo.lan>
References: <20080917201859.GU2182@fsst.voodoo.lan>
Organization: CSR
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.8; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 18 Sep 2008 10:20:08.0700 (UTC) FILETIME=[20648BC0:01C91978]
X-Scanned-By: MailControl A-08-50-14 (www.mailcontrol.com) on 10.71.0.129
X-Virus-Scanned: ClamAV 0.92.1/8277/Thu Sep 18 10:36:44 2008 on bifrost
X-Virus-Status: Clean

On Wed, 17 Sep 2008 22:18:59 +0200
Frank Terbeck <ft@bewatermyfriend.org> wrote:
> I've been working on this for quite some time now. vcs_info is a
> function that is able to get information about directories under
> version control. That information can be used in prompts, for example.
> 
> I am submitting this for inclusion in the next zsh release - if the
> developers deem it to be worthy. I think Functions/Misc/vcs_info would
> be a proper place.

Thanks.  This will be useful.

I'd like to suggest a slightly different interface (internally, this
wouldn't affect the use).  I think it would be best if it lived in
Functions/VCS_Info with a single central function in one file, backends in
VCS_INFO_BACKEND_<backend>, and any utility functions in other files
(though small ones could be in the main function file).  Then you don't
need to load a backend you're not using and the central function can query
backends by searching the function path for files of that name (the sort of
thing that's easy in zsh) and autoloading the function in question so you
wouldn't need an explicit list.  I'd suggest that functions for each
backend be done as arguments "VCS_INFO_BACKEND_<backend> get_data", but it
could equally be something like VCS_INFO_backend_<backend>_get_data or
anything explicit enough that wouldn't get confused with another
backend.

I'd also suggest it would be more useful to enable, rather than disable,
backends.  I tend to know which archiving systems I'm using and it's not
particular convenient to have to disable a whole series I may never even
have heard of, and which may well be extended in future versions so is a
moving target.  However, there's nothing to stop you having both with
"enable" taking preference.

It should be possible to use the new prompt colouring features in the
version that goes into the archive (%F{red}...%f), so explicit escapes can
be avoided.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

