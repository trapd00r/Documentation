From zsh-workers-request@math.gatech.edu Sat Oct 31 10:19:39 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1288 invoked from network); 31 Oct 1998 10:19:38 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 31 Oct 1998 10:19:38 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id FAA09446;
	Sat, 31 Oct 1998 05:15:00 -0500 (EST)
Resent-Date: Sat, 31 Oct 1998 05:15:00 -0500 (EST)
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <981031021323.ZM12234@candle.brasslantern.com>
Date: Sat, 31 Oct 1998 02:13:23 -0800
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: zsh-workers@math.gatech.edu
Subject: PATCH: 3.1.5 - Small Src/ patches that were overlooked
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"Yq86m3.0.XJ2.aCkEs"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4473
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Fix whitespace in builtins.c.

My patch from zsh-workers/4421 for restore_params() segfault.

PWS's patch from zsh-workers/4250 to regenerate signal names on reconfigure.

Goran Larsson's patch from zsh-workers/4105 to nul-terminate a string in
the stat module.

Index: Src/builtin.c
===================================================================
diff -u -r1.1.1.2 builtin.c
--- builtin.c	1998/10/30 15:57:01	1.1.1.2
+++ builtin.c	1998/10/31 09:03:10
@@ -2627,14 +2627,14 @@
     if(opch == ':' || !(p = memchr(optstr, opch, lenoptstr))) {
 	p = "?";
 err:
-      zsfree(zoptarg);
+	zsfree(zoptarg);
 	if(quiet) {
 	    setsparam(var, ztrdup(p));
 	    zoptarg = metafy(optbuf, lenoptbuf, META_DUP);
 	} else {
 	    zerr(*p == '?' ? "bad option: -%c" :
 		"argument expected after -%c option", NULL, opch);
-          zoptarg=ztrdup("");
+	    zoptarg=ztrdup("");
 	    errflag = 0;
 	}
 	return 0;
Index: Src/exec.c
===================================================================
diff -u -r1.1.1.2 -r1.6
--- exec.c	1998/10/30 15:57:02	1.1.1.2
+++ exec.c	1998/10/30 17:52:43	1.6
@@ -1992,8 +1992,8 @@
 		}
 	    } else
 		paramtab->addnode(paramtab, pm->nam, pm);
-	    if (pm->flags & PM_EXPORTED)
-		pm->env = addenv(pm->nam, getsparam(pm->nam));
+	    if ((pm->flags & PM_EXPORTED) && ((s = getsparam(pm->nam))))
+		pm->env = addenv(pm->nam, s);
 	}
     }
 }
Index: Src/zsh.mdd
===================================================================
diff -u -r1.1.1.2 -r1.3
--- zsh.mdd	1998/10/30 15:57:08	1.1.1.2
+++ zsh.mdd	1998/10/30 17:52:47	1.3
@@ -12,7 +12,7 @@
 prototypes.h hashtable.h ztype.h"
 
 :<<\Make
-signames.c: signames.awk @SIGNAL_H@
+signames.c: signames.awk ../config.h @SIGNAL_H@
 	$(AWK) -f $(sdir)/signames.awk @SIGNAL_H@ > $@
 
 sigcount.h: signames.c
Index: Src/Modules/stat.c
===================================================================
diff -u -r1.1.1.2 -r1.3
--- stat.c	1998/10/30 15:57:11	1.1.1.2
+++ stat.c	1998/10/30 17:52:47	1.3
@@ -85,6 +85,7 @@
 
 	for (i = 1; i <= 9; i++)
 	    pm[i] = (mode & *mfp++) ? modes[i] : '-';
+	pm[10] = '\0';
 
 	if (mode & S_ISUID)
 	    pm[3] = (mode & S_IXUSR) ? 's' : 'S';

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

