From zsh-users-return-15747-mason-zsh=primenet.com.au@zsh.org Tue Feb 01 19:22:35 2011
Return-Path: <zsh-users-return-15747-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5835 invoked by alias); 1 Feb 2011 19:22:35 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15747
Received: (qmail 23112 invoked from network); 1 Feb 2011 19:22:33 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at benizi.com designates 64.130.10.15 as permitted sender)
Date: Tue, 1 Feb 2011 14:16:10 -0500 (EST)
From: "Benjamin R. Haskell" <zsh@benizi.com>
To: Anonymous bin Ich <ichbinanon@gmail.com>
cc: zsh-users@zsh.org
Subject: Re: Check existence of a program
In-Reply-To: <4D4850F7.6060205@gmail.com>
Message-ID: <alpine.LNX.2.01.1102011405310.2792@hp>
References: <4D4850F7.6060205@gmail.com>
User-Agent: Alpine 2.01 (LNX 1266 2009-07-14)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed

On Tue, 1 Feb 2011, Anonymous bin Ich wrote:

> Hello!
>
> I am having trouble checking for existence of a program.
>
> This works:
>
> % cat working.zsh
> #!/bin/zsh
> set -x
> prog="identify"
> path=$(which ${prog})
> %
> % ./working.zsh
> +./working.zsh:3> prog=identify
> +./working.zsh:4> path=+./working.zsh:4> which identify
> +./working.zsh:4> path=/usr/bin/identify
> %
>
> But this doesn't:
>
> % cat notworking.zsh
> #!/bin/zsh
> set -x
> prog="exiftime"
> path=$(which ${prog})
> if [[ ${?} -ne 0 ]]; then
>    prog="identify"
>    path=$(which ${prog})
> fi
> %
> % ./notworking.zsh
> +./notworking.zsh:3> prog=exiftime
> +./notworking.zsh:4> path=+./notworking.zsh:4> which exiftime
> +./notworking.zsh:4> path='exiftime not found'
> +./notworking.zsh:5> [[ 1 -ne 0 ]]
> +./notworking.zsh:6> prog=identify
> +./notworking.zsh:7> path=+./notworking.zsh:7> which identify
> +./notworking.zsh:7> path='identify not found'
> %
>
> Any idea?
>

You shouldn't use a variable named 'path', is perhaps what's going on 
here.  That one bites me occasionally: $path is an array whose contents 
are specially tied to $PATH.  So, by setting path=$(which $prog), you're 
setting your $PATH parameter, which is probably undesirable.

I tend to use this idiom for checking that a command exists:

if (( $+commands[command-name] )) ; then
 	# it exists
fi

In general, (( $+param )) returns true if param is set.  $commands is an 
associative array that lists commands.  (Provided by the zsh/param 
module, IIRC.)  (( $+commands[command-name] )) returns true if the key 
'command-name' exists.

So, e.g.:

#!/bin/zsh
set -x
unset touse
for prog in exiftime identify ; do
 	(( $+commands[$prog] )) || continue
 	touse=$prog
 	break
done
(( $+touse )) || { echo "Couldn't find a usable EXIF info program" ; return 1 }
$touse /path/to/image.jpg

-- 
Best,
Ben

