From zsh-workers-return-22280-mason-zsh=primenet.com.au@sunsite.dk Sat Feb 18 12:58:01 2006
Return-Path: <zsh-workers-return-22280-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9130 invoked from network); 18 Feb 2006 12:57:58 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 18 Feb 2006 12:57:58 -0000
Received: (qmail 4935 invoked from network); 18 Feb 2006 12:57:52 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 18 Feb 2006 12:57:52 -0000
Received: (qmail 23733 invoked by alias); 18 Feb 2006 12:57:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22280
Received: (qmail 23722 invoked from network); 18 Feb 2006 12:57:49 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 18 Feb 2006 12:57:49 -0000
Received: (qmail 4684 invoked from network); 18 Feb 2006 12:57:49 -0000
Received: from mta07-winn.ispmail.ntl.com (81.103.221.47)
  by a.mx.sunsite.dk with SMTP; 18 Feb 2006 12:57:48 -0000
Received: from aamta11-winn.ispmail.ntl.com ([81.103.221.35])
          by mta07-winn.ispmail.ntl.com with ESMTP
          id <20060218125747.GTHB15056.mta07-winn.ispmail.ntl.com@aamta11-winn.ispmail.ntl.com>
          for <zsh-workers@sunsite.dk>; Sat, 18 Feb 2006 12:57:47 +0000
Received: from pwslaptop.csr.com ([81.105.238.64])
          by aamta11-winn.ispmail.ntl.com with ESMTP
          id <20060218125747.EXIK11424.aamta11-winn.ispmail.ntl.com@pwslaptop.csr.com>
          for <zsh-workers@sunsite.dk>; Sat, 18 Feb 2006 12:57:47 +0000
Received: from pwslaptop.csr.com (pwslaptop.csr.com [127.0.0.1])
	by pwslaptop.csr.com (8.13.4/8.13.4) with ESMTP id k1ICvde8028622
	for <zsh-workers@sunsite.dk>; Sat, 18 Feb 2006 12:57:40 GMT
Received: from pwslaptop.csr.com (pws@localhost)
	by pwslaptop.csr.com (8.13.4/8.13.4/Submit) with ESMTP id k1ICvcnk028384
	for <zsh-workers@sunsite.dk>; Sat, 18 Feb 2006 12:57:39 GMT
Message-Id: <200602181257.k1ICvcnk028384@pwslaptop.csr.com>
X-Authentication-Warning: pwslaptop.csr.com: pws owned process doing -bs
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: Re: newuser in 4.3.0-dev-4 (Was: PATCH: newuser system) 
In-Reply-To: Your message of "Sat, 18 Feb 2006 08:42:37 GMT."
             <slrndvdnft.h55.mason@g.primenet.com.au> 
Date: Sat, 18 Feb 2006 12:57:37 +0000

Geoff Wing wrote:
> Geoff Wing <gcw@zsh.org> typed:
> : I think it should abort in a couple of cases:
> : a) when run as root.  root should probably have to make his/her own changes
> :    manually (though maybe other people would think otherwise)
> : b) when we don't have write access to the HOME directory, say, after an su
> 
> Currently, for "b)", I get the effect of "which zsh-newuser-install" to the
> screen twice.

I wasn't able to reproduce that.  I created a new user with zsh as the
login shell and the directory owned by root.  Nothing showed up.  Then I
changed the directory to the new user and tried again.  It ran the
script.

My guess is that somewhere there is some hairy interaction between
function definitions and the code in the newuser script which is what is
directly run by the zsh/newuser module:

if functions zsh-newuser-install >/dev/null 2>&1 ||
   autoload -U +X zsh-newuser-install; then
   zsh-newuser-install
fi

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page still at http://www.pwstephenson.fsnet.co.uk/

