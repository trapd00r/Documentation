From zsh-users-return-10986-mason-zsh=primenet.com.au@sunsite.dk Wed Nov 15 05:31:20 2006
Return-Path: <zsh-users-return-10986-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5265 invoked from network); 15 Nov 2006 05:31:15 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 15 Nov 2006 05:31:15 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 77404 invoked from network); 15 Nov 2006 05:31:09 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 15 Nov 2006 05:31:09 -0000
Received: (qmail 28484 invoked by alias); 15 Nov 2006 05:31:01 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10986
Received: (qmail 28468 invoked from network); 15 Nov 2006 05:31:00 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 15 Nov 2006 05:31:00 -0000
Received: (qmail 76296 invoked from network); 15 Nov 2006 05:31:00 -0000
Received: from nf-out-0910.google.com (64.233.182.191)
  by a.mx.sunsite.dk with SMTP; 15 Nov 2006 05:30:56 -0000
Received: by nf-out-0910.google.com with SMTP id m19so548299nfc
        for <zsh-users@sunsite.dk>; Tue, 14 Nov 2006 21:30:55 -0800 (PST)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:reply-to:to:subject:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references;
        b=D1tNPaara4W33SyDXgLI+4lVzuytgGHz5EIV4b0s5XfWH3rcKknWZSx+mk22NA191GnO/cfCWQFJhxRMnHiRQwhDcEEuMnYeeYIxqIPFQJJv+oLrPQ4dDQyLmt04cCvmVtZdJIQ3UscaPFgw4FhXngZLAkwR6tg2xcQ/euIVz7c=
Received: by 10.82.179.9 with SMTP id b9mr248492buf.1163568655082;
        Tue, 14 Nov 2006 21:30:55 -0800 (PST)
Received: by 10.82.164.2 with HTTP; Tue, 14 Nov 2006 21:30:54 -0800 (PST)
Message-ID: <17393e3e0611142130n799fa986x312f4053f8b58a70@mail.gmail.com>
Date: Wed, 15 Nov 2006 00:30:54 -0500
From: "Matt Wozniski" <godlygeek@gmail.com>
Reply-To: mjw@drexel.edu
To: zsh-users@sunsite.dk
Subject: Re: getting zle vi-modes to show the current mode
In-Reply-To: <061114111310.ZM20545@torch.brasslantern.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
References: <17393e3e0611131127h75caa46es184b80fe17f13c49@mail.gmail.com>
	 <061114111310.ZM20545@torch.brasslantern.com>

For the purpose of the archives (that I didn't manage to search well
enough in the first place), I thought it might be a good idea to show
the solution I eventually came to.  The following will print the
current mode on the line below the prompt.  The only flaw I know of is
that a long line that wraps at the edge of the terminal will overwrite
the mode indicator until either the next line or the next mode change.

If anyone can make any suggestions for improvements, I'd be happy to hear them.

Thanks for the help, all!

--------------------------

bindkey -v

function my-accept-line {
  POSTDISPLAY=""
  zle .accept-line
}
zle -N my-accept-line
bindkey "^M" my-accept-line
bindkey "^J" my-accept-line

setopt prompt_subst;
PS1=$'%{\e7\e[${COLUMNS}G \e[K-- INSERT --\e8\e[B\e[A%}'"$PS1"
PS2=$'%{\e7\e[${COLUMNS}G \e[K-- INSERT --\e8\e[B\e[A%}'"$PS2"
PS3=$'%{\e7\e[${COLUMNS}G \e[K-- INSERT --\e8\e[B\e[A%}'"$PS3"
PS4=$'%{\e7\e[${COLUMNS}G \e[K-- INSERT --\e8\e[B\e[A%}'"$PS4"

function zle-keymap-select {
  if [[ "$KEYMAP" == vicmd ]]; then
    POSTDISPLAY=$'\n'"-- NORMAL --"
  else
    POSTDISPLAY=$'\n'"-- INSERT --"
  fi
}
zle -N zle-keymap-select

