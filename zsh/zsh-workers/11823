From zsh-workers-return-11823-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Jun 08 14:31:37 2000
Return-Path: <zsh-workers-return-11823-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14943 invoked from network); 8 Jun 2000 14:31:36 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 8 Jun 2000 14:31:36 -0000
Received: (qmail 26218 invoked by alias); 8 Jun 2000 14:31:05 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11823
Received: (qmail 26209 invoked from network); 8 Jun 2000 14:31:04 -0000
Message-ID: <393FAE25.4759316A@u.genie.co.uk>
Date: Thu, 08 Jun 2000 15:31:01 +0100
From: Oliver Kiddle <opk@u.genie.co.uk>
X-Mailer: Mozilla 4.73 [en] (Win95; I)
X-Accept-Language: en
MIME-Version: 1.0
To: Zsh workers <zsh-workers@sunsite.auc.dk>
Subject: PATCH: Re: Compilation on IRIX 5.3
References: <393C148A.741A4904@u.genie.co.uk> <000605163843.ZM25737@candle.brasslantern.com>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

Bart Schaefer wrote:
> >
> > Can't open -e
> > Can't open /^!MOD!)$/q;p
> My only guess is that IRIX sed does not understand '-ne' and requires that
> there be two options '-n -e' instead.  Could you try that?

That was the problem. The IRIX sed does actually allow '-ne' as long as
there isn't another -e later on the line. The patch fixes our Makefile.

With the other problem with sys/types.h, I've been wasting your time
again so sorry about that. After removing certain entries from my
autoconf cache which were wrong, they were correctly determined when
rerunning configure so another program or older version of Zsh must have
got it wrong. I'll have to remember to try a clear cache before
reporting these build problems.

An unrelated point which I though I should mention is that if you run
the tests as root (which I did accidentally because I'd been root for
make install), you will get a failure for -r in the 07cond tests because
a file can be read as root even if the permissions are 000. I can't
think what the best way to deal with this is, maybe a check at the start
of the tests which displays a warning message.

I've also included a small change to _urls to use Sven's new -K option
to zparseopts. Is there a good reason why the -f options to _urls
completes files _first_ as opposed to together with URLs? I'd prefer to
be reminded by completion that urls would be valid in the current
context and anyone who likes the URLs first can always use a tag-order
style.

Oliver

Index: Completion/User/_urls
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/User/_urls,v
retrieving revision 1.12
diff -u -r1.12 _urls
--- Completion/User/_urls       2000/06/06 19:43:30     1.12
+++ Completion/User/_urls       2000/06/08 13:52:39
@@ -52,8 +52,8 @@
   _wanted -C -f files expl file _files "$@" && return 0
 fi

-zparseopts -D -E g:=glob
-: ${(A)=glob:=-g '*(^/)'}
+glob=(-g '*(^/)')
+zparseopts -D -K -E g:=glob

 ipre="$IPREFIX"

Index: Doc/Makefile.in
===================================================================
RCS file: /cvsroot/zsh/zsh/Doc/Makefile.in,v
retrieving revision 1.3
diff -u -r1.3 Makefile.in
--- Doc/Makefile.in     2000/06/02 17:22:50     1.3
+++ Doc/Makefile.in     2000/06/08 13:52:39
@@ -193,7 +193,7 @@
        ( \
            echo "startitem()"; \
            for modfile in $(MODDOCSRC); do \
-               sed -ne '1{s|^COMMENT(!MOD!\(.*\)$$|item(tt(\1))(|;p;d;}' \
+               sed -n -e '1{s|^COMMENT(!MOD!\(.*\)$$|item(tt(\1))(|;p;d;}' \
                    -e '/^!MOD!)$$/q;p' \
                    < $(sdir)/$$modfile; \
                echo ")"; \

