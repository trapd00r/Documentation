From zsh-users-return-8928-mason-zsh=primenet.com.au@sunsite.dk Wed Jun 01 14:47:55 2005
Return-Path: <zsh-users-return-8928-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29236 invoked from network); 1 Jun 2005 14:47:54 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 1 Jun 2005 14:47:54 -0000
Received: (qmail 33346 invoked from network); 1 Jun 2005 14:47:47 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 1 Jun 2005 14:47:47 -0000
Received: (qmail 21325 invoked by alias); 1 Jun 2005 14:47:36 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8928
Received: (qmail 21316 invoked from network); 1 Jun 2005 14:47:35 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 1 Jun 2005 14:47:35 -0000
Received: (qmail 31796 invoked from network); 1 Jun 2005 14:47:35 -0000
Received: from vms042pub.verizon.net (206.46.252.42)
  by a.mx.sunsite.dk with SMTP; 1 Jun 2005 14:47:31 -0000
Received: from candle.brasslantern.com ([4.11.1.68])
 by vms042.mailsrvcs.net (Sun Java System Messaging Server 6.2 HotFix 0.04
 (built Dec 24 2004)) with ESMTPA id <0IHE00KZEUF4XE10@vms042.mailsrvcs.net> for
 zsh-users@sunsite.dk; Wed, 01 Jun 2005 09:47:29 -0500 (CDT)
Received: from candle.brasslantern.com (IDENT:schaefer@localhost [127.0.0.1])
	by candle.brasslantern.com (8.12.11/8.12.11) with ESMTP id j51ElSqG011061	for
 <zsh-users@sunsite.dk>; Wed, 01 Jun 2005 07:47:28 -0700
Received: (from schaefer@localhost)	by candle.brasslantern.com
 (8.12.11/8.12.11/Submit) id j51ElSal011060	for zsh-users@sunsite.dk; Wed,
 01 Jun 2005 07:47:28 -0700
Date: Wed, 01 Jun 2005 14:47:28 +0000
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: named pipes blocking zsh
In-reply-to: <d7kfuc$gem$1@sea.gmane.org>
To: zsh-users@sunsite.dk
Message-id: <1050601144728.ZM11059@candle.brasslantern.com>
MIME-version: 1.0
X-Mailer: Z-Mail (5.0.0 30July97)
Content-type: text/plain; charset=us-ascii
References: <d7kfuc$gem$1@sea.gmane.org>
Comments: In reply to "Tim K. (Gmane)" <tk-gmane+at@idpax.com>
 "named pipes blocking zsh" (Jun  1,  7:18am)
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On Jun 1,  7:18am, Tim K. (Gmane) wrote:
}
} I have a situtation with zsh: I use pine as my mail reader and it has a 
} feature where it can create a named pipe (FIFO) and write to it when new 
} mail arrives.
} 
} This all seems to work, except when I quit pine, hence terminating the 
} main "parent" script, the child "notify" script does not exit, it's 
} stuck reading from the pipe (even though the pipe is deleted).

I think this qualifies as a pine bug.  Removing a named pipe will not
by itself send an EOF to any processes that are listening on it.  The
right way for pine to shut down the connection would be to open the fifo,
remove the disk file, then send a final EOF by closing the descriptor.

Anything else is a race condition with the listening process, which may
re-open the fifo for reading before pine has removed it.

