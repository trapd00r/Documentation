From zsh-workers-return-8308-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Oct 17 22:22:39 1999
Return-Path: <zsh-workers-return-8308-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19727 invoked from network); 17 Oct 1999 22:22:38 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Oct 1999 22:22:38 -0000
Received: (qmail 6179 invoked by alias); 17 Oct 1999 22:22:27 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8308
Received: (qmail 6171 invoked from network); 17 Oct 1999 22:22:25 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <991017222221.ZM21530@candle.brasslantern.com>
Date: Sun, 17 Oct 1999 22:22:20 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: 3.1.6-bart-7: `checkjobs' option
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

This replaces patches 8109 and 8110, as per the ensuing conversation in
8111-8113.

Index: Doc/Zsh/options.yo
===================================================================
@@ -239,6 +239,14 @@
 will be treated as referring to the physical parent, even if the preceeding
 path segment is a symbolic link.
 )
+pindex(CHECK_JOBS)
+cindex(exiting, checking jobs when)
+cindex(logging out, checking jobs when)
+item(tt(CHECK_JOBS) <Z>)(
+Report the status of background and suspended jobs before exiting a shell
+with job control.  tt(NO_CHECK_JOBS) is best used only in combination with
+tt(NO_HUP), else such jobs will be killed automatically.
+)
 pindex(CLOBBER)
 cindex(clobbering, of files)
 cindex(file clobbering, allowing)
Index: Src/builtin.c
===================================================================
@@ -3153,7 +3153,8 @@
     HEAPALLOC {
 	if (isset(MONITOR) && !stopmsg && !from_signal) {
 	    scanjobs();    /* check if jobs need printing           */
-	    checkjobs();   /* check if any jobs are running/stopped */
+	    if (isset(CHECKJOBS))
+	        checkjobs();   /* check if any jobs are running/stopped */
 	    if (stopmsg) {
 		stopmsg = 2;
 		LASTALLOC_RETURN;
Index: Src/options.c
===================================================================
@@ -93,6 +93,7 @@
 {NULL, "cdablevars",	      OPT_EMULATE,		 CDABLEVARS},
 {NULL, "chasedots",	      OPT_EMULATE,		 CHASEDOTS},
 {NULL, "chaselinks",	      OPT_EMULATE,		 CHASELINKS},
+{NULL, "checkjobs",	      OPT_EMULATE|OPT_ZSH,	 CHECKJOBS},
 {NULL, "clobber",	      OPT_EMULATE|OPT_ALL,	 CLOBBER},
 {NULL, "completealiases",     0,			 COMPLETEALIASES},
 {NULL, "completeinword",      0,			 COMPLETEINWORD},
Index: Src/zsh.h
===================================================================
@@ -1267,6 +1267,7 @@
     CDABLEVARS,
     CHASEDOTS,
     CHASELINKS,
+    CHECKJOBS,
     CLOBBER,
     COMPLETEALIASES,
     COMPLETEINWORD,

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

