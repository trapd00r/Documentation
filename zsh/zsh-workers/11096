From zsh-workers-return-11096-mason-zsh=primenet.com.au@sunsite.auc.dk Wed May 03 09:14:27 2000
Return-Path: <zsh-workers-return-11096-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17758 invoked from network); 3 May 2000 09:14:25 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 3 May 2000 09:14:25 -0000
Received: (qmail 11909 invoked by alias); 3 May 2000 09:14:11 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11096
Received: (qmail 11845 invoked from network); 3 May 2000 09:14:06 -0000
Date: Wed, 03 May 2000 10:13:33 +0100
From: Peter Stephenson <pws@cambridgesiliconradio.com>
Subject: Re: PATCH: Re: Test failures
In-reply-to: "Your message of Wed, 03 May 2000 10:34:03 +0200."
 <200005030834.KAA22713@beta.informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Message-id: <0FTZ007AK8AKKU@la-la.cambridgesiliconradio.com>
Content-transfer-encoding: 7BIT

> Felix Rosencrantz wrote:
> > I'm seeing a couple test failures.
> > *** /tmp/zsh.ztst.out.8907      Tue May  2 10:13:07 2000
> > --- /tmp/zsh.ztst.tout.8907     Tue May  2 10:13:07 2000
> > ***************
> > *** 1,4 ****
> >   be could I I programme recorded that watching
> > ! be could I I programme recorded that watching
> > ! watching that recorded programme I I could be
> >   watching that recorded programme I I could be
> > --- 1,4 ----
> > + I I be could programme recorded that watching
> >   be could I I programme recorded that watching
> > ! watching that recorded programme could be I I
> >   watching that recorded programme I I could be
> 
> Oh, look, the strings in the test are sorted with a locale that makes
> the order AaBbCc and so on. Either we should make the tests respect
> the locale setting or enforce the normal ordering (and change the
> strings above).

This restores the C order and sanitises the locale.

Index: Test/13parameter.ztst
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/13parameter.ztst,v
retrieving revision 1.1
diff -u -r1.1 13parameter.ztst
--- Test/13parameter.ztst	2000/04/19 19:03:09	1.1
+++ Test/13parameter.ztst	2000/05/03 09:10:50
@@ -229,9 +229,9 @@
   print ${(O)foo}
   print ${(Oi)foo}
 0:${(o)...}, ${(O)...}
+>I I be could programme recorded that watching
 >be could I I programme recorded that watching
->be could I I programme recorded that watching
->watching that recorded programme I I could be
+>watching that recorded programme could be I I
 >watching that recorded programme I I could be
 
   foo=(yOU KNOW, THE ONE WITH wILLIAM dALRYMPLE)
Index: Test/ztst.zsh
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/ztst.zsh,v
retrieving revision 1.3
diff -u -r1.3 ztst.zsh
--- Test/ztst.zsh	2000/04/19 19:03:09	1.3
+++ Test/ztst.zsh	2000/05/03 09:10:50
@@ -22,6 +22,11 @@
 # still not be good enough.  Maybe we should trick it somehow.
 emulate -R zsh
 
+# Ensure the locale does not screw up sorting.  Don't supply a locale
+# unless there's one set, to minimise problems.
+[[ -n $LC_ALL ]] && LC_ALL=C
+[[ -n $LANG ]] && LANG=C
+
 # Set the module load path to correspond to this build of zsh.
 # This Modules directory should have been created by "make check".
 [[ -d Modules/zsh ]] && module_path=( $PWD/Modules )

-- 
Peter Stephenson <pws@cambridgesiliconradio.com>
Cambridge Silicon Radio, Unit 300, Science Park, Milton Road,
Cambridge, CB4 0XL, UK                          Tel: +44 (0)1223 392070

