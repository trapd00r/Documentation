From zsh-workers-return-25254-mason-zsh=primenet.com.au@sunsite.dk Fri Jun 27 09:15:37 2008
Return-Path: <zsh-workers-return-25254-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 757 invoked from network); 27 Jun 2008 09:15:34 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 27 Jun 2008 09:15:34 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 6459 invoked from network); 27 Jun 2008 09:15:25 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 27 Jun 2008 09:15:25 -0000
Received: (qmail 25317 invoked by alias); 27 Jun 2008 09:15:22 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25254
Received: (qmail 25302 invoked from network); 27 Jun 2008 09:15:22 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 27 Jun 2008 09:15:22 -0000
Received: from cork.scru.org (cork.scru.org [209.20.67.2])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 62A4780561C1
	for <zsh-workers@sunsite.dk>; Fri, 27 Jun 2008 11:15:18 +0200 (CEST)
Received: by cork.scru.org (Postfix, from userid 1000)
	id 3F297104090; Fri, 27 Jun 2008 09:15:16 +0000 (UTC)
Date: Fri, 27 Jun 2008 09:15:16 +0000
From: Clint Adams <schizo@debian.org>
To: Peter Stephenson <p.w.stephenson@ntlworld.com>
Cc: zsh-workers@sunsite.dk, 486785@bugs.debian.org
Subject: Re: Bug#486785: tab completion broken
Message-ID: <20080627091516.GA18735@scru.org>
Mail-Followup-To: Peter Stephenson <p.w.stephenson@ntlworld.com>,
	zsh-workers@sunsite.dk, 486785@bugs.debian.org
References: <20080619211539.GA5218@scru.org> <20080622232342.756e9d4b@pws-pc>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20080622232342.756e9d4b@pws-pc>
User-Agent: Mutt/1.5.18 (2008-05-17)
X-Virus-Scanned: ClamAV 0.92.1/7575/Fri Jun 27 01:08:06 2008 on bifrost
X-Virus-Status: Clean

On Sun, Jun 22, 2008 at 11:23:42PM +0100, Peter Stephenson wrote:
> It's something to do with using the -U argument to compadd when you've
> got ambiguous completions: it works fine when there's only a single
> completion.  It was triggered by adding the -U's to do approximation in
> non-final path segments (even before the compmatch change).  The initial
> "." is a red herring.  However, I don't know where it's going wrong
> since when I do approximation after normal completion (but lots of other
> options set, too) it works fine.  This triggers a different part of
> _path_files which has compadd -U but slight differences in the other
> arguments.  Internally the Cline struct that's used for generating the
> command line looks a bit spartan in the failed case.  Needless to say I
> haven't the faintest clue where this is leading.

Further clues:

1) these behave the same way

zstyle ':completion:*' completer _complete _ignored _match _approximate

zstyle ':completion:*' completer _complete _correct _approximate        

zstyle ':completion:*' completer _complete _approximate

2) this one behaves the same way on the second tab

zstyle ':completion:*' completer _list _expand _complete _ignored _match _correct _approximate _prefix

I have not performed an exhaustive search by any means, but I have not
yet run across a combination where the inclusion of _approximate doesn't
trigger the surprise elision.

