From zsh-workers-return-25653-mason-zsh=primenet.com.au@sunsite.dk Thu Sep 11 23:52:45 2008
Return-Path: <zsh-workers-return-25653-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27809 invoked from network); 11 Sep 2008 23:52:32 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 11 Sep 2008 23:52:32 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 2229 invoked from network); 11 Sep 2008 23:52:13 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 11 Sep 2008 23:52:13 -0000
Received: (qmail 7174 invoked by alias); 11 Sep 2008 23:51:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25653
Received: (qmail 7156 invoked from network); 11 Sep 2008 23:51:58 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 11 Sep 2008 23:51:58 -0000
Received: from mx.spodhuis.org (redoubt.spodhuis.org [193.202.115.177])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id D93E6802710A
	for <zsh-workers@sunsite.dk>; Fri, 12 Sep 2008 01:51:53 +0200 (CEST)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws; s=d200807; d=spodhuis.org;
	h=Received:Date:From:To:Cc:Subject:Message-ID:Mail-Followup-To:References:MIME-Version:Content-Type:Content-Disposition:Content-Transfer-Encoding:In-Reply-To;
	b=nxekYuFss6YOGpu0gDtQTZfRDl/RljxYDlxql3l0Qm8BRy2745mPuWiAjuJJlH3ezl2Cv7+XR+0m0KEVHQN0n288K4ir7mu/1/X5mgsXLsEjYKaeDVE4+MGuXp04XSjlBcytx4x2IUCCpy/thWiGEIvSfhDOC0Uqo0cvDBay/ws=;
Received: by smtp.spodhuis.org with local 
	id 1Kdvx0-000ABx-MV; Thu, 11 Sep 2008 23:51:50 +0000
Date: Thu, 11 Sep 2008 16:51:50 -0700
From: Phil Pennock <zsh-workers+phil.pennock@spodhuis.org>
To: =?utf-8?B?eFJhaWNoW29dwrJ4?= <raichoo@googlemail.com>
Cc: zsh-workers@sunsite.dk
Subject: Re: [PATCH] make _file_systems know zfs on solaris
Message-ID: <20080911235150.GA38617@redoubt.spodhuis.org>
Mail-Followup-To: =?utf-8?B?eFJhaWNoW29dwrJ4?= <raichoo@googlemail.com>,
	zsh-workers@sunsite.dk
References: <48C96700.7080202@gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <48C96700.7080202@gmail.com>
X-Virus-Scanned: ClamAV 0.92.1/8220/Thu Sep 11 23:27:09 2008 on bifrost
X-Virus-Status: Clean

On 2008-09-11 at 20:44 +0200, "xRaich[o]Â²x" wrote:
> --- ../4.3.6/functions/_file_systems    Sun Sep  7 09:35:43 2008
> +++ _file_systems    Thu Sep 11 20:30:27 2008
> @@ -15,7 +15,7 @@
>          fss+=( ${$(</etc/filesystems)#\*} )
>    ;;
>    osf*) fss=( advfs ufs nfs mfs cdfs ) ;;
> -  solaris*) fss=( ufs nfs hsfs s5fs pcfs cachefs tmpfs ) ;;
> +  solaris*) fss=( ufs nfs hsfs s5fs pcfs cachefs tmpfs zfs ) ;;
>    freebsd*|dragonfly*)
>      fss=( cd9660 devfs ext2fs fdesc kernfs linprocfs mfs msdos nfs
>            ntfs null nwfs portal procfs std udf ufs umap union )

I happen to know that FreeBSD 7 onwards also has zfs.

Using Wikipedia seems reasonable for finding out the current known
spread of a filesystem; NetBSD port started, MacOS port available, Linux
port in beta stage as of March 2008.

So this is probably worth adding to 4 of the explicit cases handled in
Completion/Unix/Type/_file_systems and at this stage, safest to also add
it to the default case, or start another book-keeping hassle by
expanding the number of OSes explicitly tracked.  I say this with a
practicality hat on, no advocacy -- I don't currently use ZFS (the
FreeBSD port doesn't yet support ACLs, which I use extensively).

In fact, since NFS is standards-specified and supported to some degree
or another on a wide variety of Unices, should 'nfs' be in the * case?
(Although FreeBSD has both 'nfs' and 'nfs4').

While the spelling used for the ISO 9660 FS varies between platforms,
the UDF format used on DVDs is widely supported and not likely to vary
much, so that should probably go in too.

So the *) branch should IMO set fss=( nfs udf ufs zfs )

Possibly also NTFS which is fairly widespread and consistently named.

FreeBSD supports more FSes than listed above.  Missing are:
  nfs4 reiserfs smbfs 
and both 'msdos' and 'portal' should be spelt with a trailing 'fs'.

With zsh/parameter loaded, ${commands[(R)*/mount_*]##*/mount_} gets all
the filesystems mounted with a mount_* command, and I believe that
there's a mount_<fstype> command for all filesystems except 'ufs', the
default FS.  ("mount -t foo" will work if there's a mount_foo).  (I used
to be sure here, but I haven't looked into how things have changed with
the new nmount(2) interface and if that affects things).

Off the top of my head, I don't know how widespread the mount_* command
system is, besides that it's not used by Linux.

-Phil

