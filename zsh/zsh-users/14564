From zsh-users-return-14564-mason-zsh=primenet.com.au@zsh.org Thu Nov 12 19:50:51 2009
Return-Path: <zsh-users-return-14564-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 213 invoked by alias); 12 Nov 2009 19:50:49 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14564
Received: (qmail 14202 invoked from network); 12 Nov 2009 19:50:45 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at benizi.com does not designate permitted sender hosts)
Date: Thu, 12 Nov 2009 14:51:12 -0500 (EST)
From: "Benjamin R. Haskell" <zsh@benizi.com>
To: Zsh Users <zsh-users@zsh.org>
Subject: Problem with 'env' completion (was: Using another command's completion
 function with an alias)
Message-ID: <alpine.LNX.2.01.0911121446150.26715@hp.internal>
User-Agent: Alpine 2.01 (LNX 1266 2009-07-14)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 12 Nov 2009, Benjamin R. Haskell wrote:

> [...]
>
> alias noagent='env -u SSH_AGENT_PID -u SSH_AUTH_SOCK'
> 
> But, compdef noagent=-command-  doesn't have the desired effect.  I 
> instead get the completion for 'env':
> 
> $ noagent <C-x><h>
> tags in context :completion::complete:-u::
>     all-files  (_files _default (eval))
> tags in context :completion::complete:env::
>     argument-rest  (_arguments _env (eval))

Upon further tinkering, I think this might (additionally) be a problem 
with the completion for 'env'...

It doesn't seem to like more than one '-u' argument:

$ env -u <C-x><h>
tags in context :completion::complete:env::
    option-u-1  (_arguments _env (eval))

$ env -u SSH_AUTH_SOCK -u <C-x><h>
tags in context :completion::complete:-u::
    all-files  (_files _default (eval))
tags in context :completion::complete:env::
    argument-rest  (_arguments _env (eval))

But (as an example showing that multiple '-u' args are fine):

$ export A=1 B=2
$ env | grep '^[A-Z]='
A=1
B=2
$ env -u A | grep '^[A-Z]='
B=2
$ env -u A -u B | grep '^[A-Z]='
$

Best,
Ben

