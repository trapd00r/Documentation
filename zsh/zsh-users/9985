From zsh-users-return-9985-mason-zsh=primenet.com.au@sunsite.dk Fri Mar 03 06:01:34 2006
Return-Path: <zsh-users-return-9985-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27379 invoked from network); 3 Mar 2006 06:01:30 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 3 Mar 2006 06:01:30 -0000
Received: (qmail 13590 invoked from network); 3 Mar 2006 06:01:23 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 3 Mar 2006 06:01:23 -0000
Received: (qmail 29330 invoked by alias); 3 Mar 2006 06:01:14 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 9985
Received: (qmail 29321 invoked from network); 3 Mar 2006 06:01:13 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 3 Mar 2006 06:01:13 -0000
Received: (qmail 12346 invoked from network); 3 Mar 2006 06:01:13 -0000
Received: from vms046pub.verizon.net (206.46.252.46)
  by a.mx.sunsite.dk with SMTP; 3 Mar 2006 06:01:11 -0000
Received: from torch.brasslantern.com ([71.116.81.225])
 by vms046.mailsrvcs.net (Sun Java System Messaging Server 6.2-4.02 (built Sep
 9 2005)) with ESMTPA id <0IVJ00APPFDXLD14@vms046.mailsrvcs.net> for
 zsh-users@sunsite.dk; Fri, 03 Mar 2006 00:01:10 -0600 (CST)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id k2361pNn020279	for
 <zsh-users@sunsite.dk>; Thu, 02 Mar 2006 22:02:00 -0800
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id k2361oPu020278	for zsh-users@sunsite.dk; Thu,
 02 Mar 2006 22:01:50 -0800
Date: Thu, 02 Mar 2006 22:01:48 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: Installing zsh-4.3.1
In-reply-to: <0dc952111d6c7539ef19f7ef2331db46@gmail.com>
To: zsh-users@sunsite.dk
Message-id: <060302220150.ZM20277@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <0dc952111d6c7539ef19f7ef2331db46@gmail.com>
Comments: In reply to FX Coudert <fxcoudert@gmail.com>
 "Installing zsh-4.3.1" (Mar  1,  8:42am)

On Mar 1,  8:42am, FX Coudert wrote:
}
} 1. the make process doesn't support parallel building.

This has been noted a number of times dating back at least to three
years ago.  One problem (as Wayne observed then) is with the "prep"
target, which the structure of the generated Makefile/Makemod files
falsely indicates can be built in parallel with some other targets
that, in reality, depend upon "prep" having completed first.

The following minimal patch fixes this to the first order.  I'm a
little concerned that it will break something in the case where
"make -f Makemod prep" would fail, because Makemod is then created
by "make Makemod" but removed by "make prep".

Index: Src/Makefile.in
===================================================================
retrieving revision 1.6
diff -c -r1.6 Src/Makefile.in
--- Src/Makefile.in	24 Sep 2005 17:48:35 -0000	1.6
+++ Src/Makefile.in	3 Mar 2006 05:27:19 -0000
@@ -109,7 +109,7 @@
 
 @CONFIG_MK@
 
-Makemod prep: $(CONFIG_INCS) $(dir_top)/config.modules
+Makemod: $(CONFIG_INCS) $(dir_top)/config.modules
 	@case $(sdir_top) in \
 	    /*) top_srcdir=$(sdir_top) ;; \
 	    *) top_srcdir=$(subdir)/$(sdir_top) ;; \
@@ -119,6 +119,7 @@
 	    '$$top_srcdir/$(subdir)/mkmakemod.sh $(subdir) Makemod'; \
 	cd $(dir_top) && \
 	    $(SHELL) $$top_srcdir/$(subdir)/mkmakemod.sh $(subdir) Makemod
+prep: Makemod
 	@$(MAKE) -f Makemod $(MAKEDEFS) prep || rm -f Makemod
 .PHONY: prep
 


However, there is yet another problem, which is that several targets in
Makefile are built by invoking "make -f Makemod", and Makemod itself is
not re-entrant.  This seems mainly to be because of zsh.mdd, which
contains instructions for making signames.c and sigcount.h.  I think
those rules should be moved out of zsh.mdd and into Makefile.in, but
perhaps there's another way to get them pre-built.

-- 

