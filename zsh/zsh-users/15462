From zsh-users-return-15462-mason-zsh=primenet.com.au@zsh.org Tue Oct 19 16:36:28 2010
Return-Path: <zsh-users-return-15462-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22618 invoked by alias); 19 Oct 2010 16:36:28 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15462
Received: (qmail 19273 invoked from network); 19 Oct 2010 16:36:26 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_NONE
	autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at closedmail.com does not designate permitted sender hosts)
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <101019093559.ZM26751@torch.brasslantern.com>
Date: Tue, 19 Oct 2010 09:35:56 -0700
In-reply-to: <20101019153258.GD2149@one.monetra.com>
Comments: In reply to Brian Lewis <brian@lorf.org>
 "zle clear-screen, exit status" (Oct 19, 11:32am)
References: <20101019153258.GD2149@one.monetra.com>
	<AANLkTinvgTGC7+dKKCR17vzmCxufy7zPDeaL=oFOzZj+@mail.gmail.com>
	<20101019155310.GE2149@one.monetra.com>
In-reply-to: <20101019155310.GE2149@one.monetra.com>
Comments: In reply to Brian Lewis <brian@lorf.org>
 "Re: zle clear-screen, exit status" (Oct 19, 11:53am)
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: zsh-users@zsh.org
Subject: Re: zle clear-screen, exit status
MIME-version: 1.0
Content-type: text/plain; charset=iso-8859-1
Content-transfer-encoding: quoted-printable

On Oct 19, 11:32am, Brian Lewis wrote:
}
} My prompt displays $?, the program exit status. When I hit Ctrl-L, I'd
} like $? to be set to 0 somehow before the prompt is redisplayed.
}=20
} I can't figure out how to do it. It is as if $? is saved before my
} widget is called, and restored after.

Yes, that's intentional.  Under normal circumstances the editor should
behave entirely independently of the input command stream.

On Oct 19, 11:53am, Brian Lewis wrote:
}
} On Tuesday, 19.10.10 at 17:47, J=E9r=E9mie Roquet wrote:
} > bindkey -s "^L" "clear\n"
} > is enough :)
}=20
} That's not quite as good as zle clear-screen:
}=20
} $ asdf^Lclear
} zsh: command not found: asdfclear

This should almost do it:

function clear2 { zle -U $'clear\n'; zle push-line-or-edit }
zle -N clear2
bindkey '^L' clear2

Where that fails is for a multi-line buffer (i.e., you're at the PS2
prompt or deeper).  In that case push-line-or-edit simply moves up to
the PS1 prompt and the "zle -U" input is discarded, so you'll have to
press ^L a second time.

Optional tweak to avoid having "clear" in the shell history:

setopt hist_ignore_space
function clear2 { zle -U $' clear\n'; zle push-line-or-edit }

--=20

