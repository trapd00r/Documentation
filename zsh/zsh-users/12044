From zsh-users-return-12044-mason-zsh=primenet.com.au@sunsite.dk Thu Oct 18 13:41:28 2007
Return-Path: <zsh-users-return-12044-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12269 invoked from network); 18 Oct 2007 13:41:20 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 18 Oct 2007 13:41:20 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 59116 invoked from network); 18 Oct 2007 13:41:13 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 18 Oct 2007 13:41:13 -0000
Received: (qmail 24510 invoked by alias); 18 Oct 2007 13:41:04 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12044
Received: (qmail 24478 invoked from network); 18 Oct 2007 13:41:02 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 18 Oct 2007 13:41:02 -0000
Received: (qmail 57723 invoked from network); 18 Oct 2007 13:41:02 -0000
Received: from vms040pub.verizon.net (206.46.252.40)
  by a.mx.sunsite.dk with SMTP; 18 Oct 2007 13:40:56 -0000
Received: from torch.brasslantern.com ([71.116.76.59])
 by vms040.mailsrvcs.net (Sun Java System Messaging Server 6.2-6.01 (built Apr
 3 2006)) with ESMTPA id <0JQ400G4N0KQZH79@vms040.mailsrvcs.net> for
 zsh-users@sunsite.dk; Thu, 18 Oct 2007 08:38:56 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id l9IDcoYF011701	for
 <zsh-users@sunsite.dk>; Thu, 18 Oct 2007 06:38:50 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id l9IDcnko011700	for zsh-users@sunsite.dk; Thu,
 18 Oct 2007 06:38:49 -0700
Date: Thu, 18 Oct 2007 06:38:49 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: trick: up-to-the-minute time in prompt
In-reply-to: <20071018114641.12315.qmail@smasher.org>
To: zsh-users@sunsite.dk
Message-id: <071018063849.ZM11699@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <20071018114641.12315.qmail@smasher.org>
Comments: In reply to Atom Smasher <atom@smasher.org>
 "trick: up-to-the-minute time in prompt" (Oct 19, 12:46am)

On Oct 19, 12:46am, Atom Smasher wrote:
}
} here's a neat trick i just figured out... have the time that's displayed 
} in your prompt update itself!

Yep; I've been having TRAPALRM update a clock in my xterm title for ages.
The reset-prompt function is recent, and necessary to get the prompt to
change, which is why I used the title bar.

Here's what I have:

# Update title bar periodically if it has been idle a long time (10 min).
# Otherwise let precmd() do it, so we don't cause unwanted scroll-to-bot.
TRAPALRM() { TMOUT=60 ; title }
precmd() { TMOUT=600 ; title }

I have xterm set for "scroll to bottom on tty output" so I don't want
the time/title updated between commands in case I'm paging through the
scrollback buffer.

The "title" function does a print -nP with terminal-specific titlebar
escapes.  I've been thinking about changing it to fiddle with the
prompt if the version of zsh supports reset-prompt, but I kind of like
having the time of each terminal show up in my icon panel.

} ## this PS1 will use the `uptime` command to display system stats,
} ## updated every $TMOUT seconds
} ## example of prompt command substitution
} setopt PROMPT_SUBST
} PS1='%S$(uptime)
} %#%s '

Might I suggest:

TRAPALRM () { psvar[1]="$(uptime)"; zle reset-prompt }
PS1=$'%S%1v\n%#%s '
TMOUT=30

Then you don't need PROMPT_SUBST.

You could also do

TRAPALRM () {
  psvar=(${(s:,:)$(uptime)})
  psvar[1,2]=(${${=psvar[1]}[1]} "${${=psvar[1]}[2,-1]}, ${psvar[2]}")
  psvar[4,-1]=("${(j:,:)psvar[4,-1]}")
  zle reset-prompt
}

and then you have the clock in %1v, the uptime in %2v, the number of
users in %3v, and load average in %4v and you can do stuff like:

PS1=$'%S%2v,%4v\n%#%s '
RPS1="%B%1v%b"

