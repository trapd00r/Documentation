From zsh-users-return-13083-mason-zsh=primenet.com.au@sunsite.dk Fri Aug 01 16:52:11 2008
Return-Path: <zsh-users-return-13083-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1476 invoked from network); 1 Aug 2008 16:52:09 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.0 required=5.0 tests=AWL,BAYES_00,MISSING_HEADERS
	autolearn=no version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 1 Aug 2008 16:52:09 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 36037 invoked from network); 1 Aug 2008 16:51:58 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 1 Aug 2008 16:51:58 -0000
Received: (qmail 17350 invoked by alias); 1 Aug 2008 16:51:39 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13083
Received: (qmail 17334 invoked from network); 1 Aug 2008 16:51:39 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 1 Aug 2008 16:51:39 -0000
Received: from momoland.openchat.com (p84-72.acedsl.com [66.114.84.72])
	by bifrost.dotsrc.org (Postfix) with ESMTP id EAAFC806EFB1
	for <zsh-users@sunsite.dk>; Fri,  1 Aug 2008 18:51:35 +0200 (CEST)
Received: from momoland.openchat.com (localhost [127.0.0.1])
	by momoland.openchat.com (Postfix) with ESMTP id 9F4F8F45674B
	for <zsh-users@sunsite.dk>; Fri,  1 Aug 2008 12:51:33 -0400 (EDT)
Date: Fri, 01 Aug 2008 12:51:33 -0400
Message-ID: <873alowuei.wl%max@openchat.com>
From: Max Mikhanosha <max@openchat.com>
Cc: zsh-users@sunsite.dk
Subject: Re: Setting the cursor position upon completion
In-Reply-To: <759002.77468.qm@web24402.mail.ird.yahoo.com>
References: <759002.77468.qm@web24402.mail.ird.yahoo.com>
User-Agent: Wanderlust/2.15.3 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.8 (=?ISO-8859-4?Q?Shij=F2?=) APEL/10.6 Emacs/22.0.51
 (x86_64-unknown-linux-gnu) MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Scanned: ClamAV 0.92.1/7911/Fri Aug  1 14:10:36 2008 on bifrost
X-Virus-Status: Clean

Hi,

I had finally sat down and configured zsh new completion system to
somewhat my liking, and yes its seems to take a lot of trial and
errors to get the behaviour one wants.

My configuration I think does the 3 things that you mentioned:=20

1. If there is single match, it just inserts
2. If there are more then 1 match, it adds the common prefix, then stops.
3. If you press TAB one more time, menu selection is entered, where
you can use arrow keys to select the match, Enter keys exits selection
_and_ executes the command line
4. While at menu selection you can press ^Z or Alt-backspace, which does
undo, and brings you back to step 2, with the common prefix displayed.
5. If you press Tab on a glob pattern, then the selection menu offers
all the files matching pattern as the first choice, followed by each
file matched by pattern individually, ex:
  echo /usr/s*<TAB>

  gives menu selection of items
  /usr/sbin /usr/src /usr/share
  /usr/sbin
  /usr/src
  /usr/share

6. Unambiguous matches on a glob in the middle get inserted immediately:
   cd /usr/s*/lo*/zsh<TAB> gets expanded

7. Ambiguous matches on a glob in the middle enter menu selection:
  cd /usr/s*/loca<Tab>

  Enters menu selection with: /usr/src/local /usr/share/locale and
  /usr/s*/loca (orig string)
 =20
# control the menu completion with zstyle
setopt no_menu_complete nolistbeep
zmodload zsh/complist
# ksh like binding
bindkey -M viins "\e\\" complete-word
# without this everything gets mixed up for _expand
zstyle ':completion:*:*:*:*' group-name ''
zstyle ':completion:*' completer _expand _complete _match _correct _approxi=
mate
# below may need adjusting, if you type ae<tab> it gives bad results
# giving you all 2 letter commands
zstyle ':completion:*' max-errors 4 not-numeric
# I never seen this prompt, where should it appear?
# corrections still work, ie cd /u/l/s/zsh<Tab> works
zstyle ':completion:*' prompt 'Made %e corrections'
zstyle ':completion:*:expand:*:*' tag-order 'all-expansions expansions'
zstyle ':completion:*:*:*:*' group-order all-expansions expansions=20
# this enables menu completion, but on the 2nd tab only
# select without =3D1 does not work the same way
zstyle ':completion:*:*:*:*' menu select=3D1
zstyle ':completion:*:*:*:*' verbose yes
# without below glob in the middle does not work
zstyle ':completion:*:*:*:*' list-suffixes yes

# Alt-backspace to undo
bindkey -M menuselect "\M-^?" undo
bindkey -M menuselect "^Z" undo
# Incremental search forward and backward like in emacs=20
# (requires stty -ixon)
bindkey -M menuselect "^S" history-incremental-search-forward
bindkey -M menuselect "^R" history-incremental-search-backward
bindkey -M menuselect "^N" vi-insert
# shift-tab go backward
bindkey -M menuselect "\e[Z" up-line-or-history
# C-Space
bindkey -M menuselect "^@"  accept-and-infer-next-history
# Make enter exit menu selection and do actual command
# instead of just exiting the menu selection
bindkey -M menuselect "^M" .accept-line
# sort files by date and follow symlinks
zstyle ':completion:*:*:*:*' file-sort date follow
compinit -C
# I like my Esc/ search very much, put it back
bindkey -rM viins "\e/"=20

Hopefully this helps,
  Max


At Fri, 1 Aug 2008 13:09:07
+0000 (GMT), Julien Duval wrote:
>=20
> Hi,                                                                      =
                                =20
> I've come to you cause I'm having some trouble setting the cursor positio=
n upon completion, and I didn't =20
> find a satisfying solution on the web.                                   =
                                =20
> My TAB key is bound to the expand-or-complete-prefix widget and I've set =
the MENU_COMPLETE option in order
> to cycle through all the matches right from the first TAB hit.           =
                                =20
> The thing is, when cycling through the matches, the cursor is always move=
d to the end of each match, which
> I don't want.                                                            =
                                =20
>=20
> Here is the behaviour I'm looking for:                                   =
                                =20
>                                                                          =
                                =20
> When hitting TAB for the first time and the first match is inserted,     =
                                =20
>                                                                          =
                                =20
> (1) if there is more than one match and all of them share a common unambi=
guous prefix, then move the     =20
> cursor to the position immediately following the prefix (that is the firs=
t ambiguous character).         =20
>                                                                          =
                                =20
> (2) if there is more than one match but they do not ALL share a common pr=
efix, then leave the cursor where
> it was before hitting TAB. This is actually implied by (1).              =
                                =20
>                                                                          =
                                =20
> (3) if there is only one single match, then move the cursor to the end of=
 the match inserted.            =20
>=20
> The default behaviour already satisfies (3). But I can't seem to find a s=
olution for the other two.      =20
>                                                                          =
                                =20
> I've tried the following command to solve (1), but unfortunately it didn'=
t help and I don't understand   =20
> why.                                                                     =
                                =20
> zstyle ':completion:*' ambiguous true                                    =
                                =20
>                                                                          =
                                =20
> I've unset the ALWAYS_TO_END option (even though it's already the case by=
 default) but it didn't change  =20
> anything. Set or unset, the cursor is always moved to the end of the matc=
h. Does anyone know the point of=20
> this option ?                                                            =
                                =20
>=20
> Hope the description and my English weren't too confusing.               =
                                =20
> Any help would be greatly appreciated.                                   =
                                =20
>                                                                          =
                                =20
> Thanks,                                                                  =
                                =20
> Julien                                                                   =
                                =20
>=20
> -------------------------------------------------------------------------=
---------------------------------
> Envoy=E9 avec Yahoo! Mail.
> Une boite mail plus intelligente.
>=20
>=20

