From zsh-workers-return-21253-mason-zsh=primenet.com.au@sunsite.dk Tue May 10 18:48:29 2005
Return-Path: <zsh-workers-return-21253-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25496 invoked from network); 10 May 2005 18:48:28 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 10 May 2005 18:48:28 -0000
Received: (qmail 32168 invoked from network); 10 May 2005 18:48:22 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 May 2005 18:48:22 -0000
Received: (qmail 13015 invoked by alias); 10 May 2005 18:48:15 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21253
Received: (qmail 13004 invoked from network); 10 May 2005 18:48:14 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 10 May 2005 18:48:14 -0000
Received: (qmail 31605 invoked from network); 10 May 2005 18:48:14 -0000
Received: from lakermmtao04.cox.net (68.230.240.35)
  by a.mx.sunsite.dk with SMTP; 10 May 2005 18:48:09 -0000
Received: from quark.hightek.org ([68.12.75.33]) by lakermmtao04.cox.net
          (InterMail vM.6.01.04.00 201-2131-118-20041027) with ESMTP
          id <20050510184804.OXNC20878.lakermmtao04.cox.net@quark.hightek.org>
          for <zsh-workers@sunsite.dk>; Tue, 10 May 2005 14:48:04 -0400
Received: by quark.hightek.org (Postfix, from userid 501)
	id 0E121458F9; Tue, 10 May 2005 13:46:01 -0500 (CDT)
Date: Tue, 10 May 2005 13:46:01 -0500
From: Vincent Stemen <vince@hightek.org>
To: zsh-workers@sunsite.dk
Subject: Re: localtraps and signal handling on NetBSD
Message-ID: <20050510184600.GA67763@quark.hightek.org>
References: <20050425063521.GA17598@quark.hightek.org> <1050425163202.ZM25027@candle.brasslantern.com> <20050426030308.GA21501@quark.hightek.org> <200504261834.j3QIYHSa018951@news01.csr.com> <1050427053638.ZM28743@candle.brasslantern.com> <200504270954.j3R9sujP029445@news01.csr.com> <20050507171938.GA51740@quark.hightek.org> <5415.1115631148@csr.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <5415.1115631148@csr.com>
User-Agent: Mutt/1.4.1i
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On Mon, May 09, 2005 at 10:32:28AM +0100, Peter Stephenson wrote:
> Vincent Stemen wrote:
> > I was just wondering if you are planning to do any further work on the
> > signal/localtrap code.
> 
> As far as I've followed the problems, they're mostly system specific.
> I'm sure there's more that can be done but I'm not really clear what.
> I'm not a great expert on signals anyway (traps are a  little
> different).
> 
> pws

Ok.  For now, I found a not so clean work around for the code I am
working on, that would not necessarily work in other situations.  

If you come up with any other ideas to try, I am willing to test for
you and assist in any way I can.

I did notice in the zsh source that it sets an intrap flag once a
signal has been received, which apparently causes it to treat the next
signal special by queuing it and waiting until it exits the signal
handler before processing it.

I have an idea, that might not be to difficult to implement, that I
think would solve the problem, unless you know of other problems it
would create.

If, inside the signal handler, I execute the trap statement on the
same signal, turn off the intrap status because the signal is now
re-trapped.

I don't know the zsh source well enough to be sure where to make that
change, but from initial browsing, it looks like it might be easy to
do.

Does that sound like something you would be willing to try, and send
me a patch to test on NetBSD?

-- 
Vincent Stemen
Avoid the VeriSign/Network Solutions domain registration trap!
Read how Network Solutions (NSI) was involved in stealing our domain name.
http://inetaddresses.net/about_NSI.html

