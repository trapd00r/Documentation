From zsh-workers-request@math.gatech.edu Thu Jan 21 09:45:03 1999
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19385 invoked from network); 21 Jan 1999 09:45:01 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 21 Jan 1999 09:45:01 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id EAA23694;
	Thu, 21 Jan 1999 04:43:03 -0500 (EST)
Resent-Date: Thu, 21 Jan 1999 04:43:03 -0500 (EST)
Message-Id: <9901210926.AA53747@ibmth.df.unipi.it>
To: gray.watson@digits.com, zsh-workers@math.gatech.edu
Subject: PATCH: 3.1.5*: bsdi configuration problem 
In-Reply-To: "Gray Watson"'s message of "Wed, 20 Jan 1999 22:27:26 NFT."
             <m103AmE-000AqKC@burger.letters.com> 
Date: Thu, 21 Jan 1999 10:26:34 +0100
From: Peter Stephenson <pws@ibmth.df.unipi.it>
Resent-Message-ID: <"3vS3Q.0.9o5.dQlfs"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4939
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Gray Watson wrote:
> I've had problems compiling 3.1.5 on BSD/OS.  It seems that the
> tgetent accepts NULL as the buffer argument however then tgetstr will
> core dump.  I had to manually undef the TGETENT_ACCEPTS_NULL flag in
> the config.h file.

Is this enough to fix the problem?  I can send a configure patch as
well, except the line numbers will be out.

*** configure.in.tget	Thu Jan 21 09:51:19 1999
--- configure.in	Thu Jan 21 10:02:34 1999
***************
*** 467,475 ****
  fi
  
  dnl  Check if tgetent accepts NULL (and will allocate its own termcap buffer)
  AC_CACHE_CHECK(if tgetent accepts NULL,
  zsh_cv_func_tgetent_accepts_null,
! [AC_TRY_RUN([main(){int i = tgetent((char*)0,"vt100");exit(!i || i == -1);}],
    zsh_cv_func_tgetent_accepts_null=yes,
    zsh_cv_func_tgetent_accepts_null=no,
    zsh_cv_func_tgetent_accepts_null=no)])
--- 467,488 ----
  fi
  
  dnl  Check if tgetent accepts NULL (and will allocate its own termcap buffer)
+ dnl  Some termcaps reportedly accept a zero buffer, but then dump core
+ dnl  in tgetstr().
  AC_CACHE_CHECK(if tgetent accepts NULL,
  zsh_cv_func_tgetent_accepts_null,
! [AC_TRY_RUN([
! main()
! {
!     int i = tgetent((char*)0,"vt100");
!     if (i > 0) {
! 	char tbuf[1024], *u;
!     	u = tbuf;
!     	tgetstr("cl", &u);
!     }
!     exit(!i || i == -1);
! }
! ],
    zsh_cv_func_tgetent_accepts_null=yes,
    zsh_cv_func_tgetent_accepts_null=no,
    zsh_cv_func_tgetent_accepts_null=no)])

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

