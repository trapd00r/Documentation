From zsh-users-return-2659-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Oct 05 01:23:41 1999
Return-Path: <zsh-users-return-2659-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17965 invoked from network); 5 Oct 1999 01:23:39 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 5 Oct 1999 01:23:39 -0000
Received: (qmail 24215 invoked by alias); 5 Oct 1999 01:23:24 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 2659
Received: (qmail 24205 invoked from network); 5 Oct 1999 01:23:22 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <991005012311.ZM3789@candle.brasslantern.com>
Date: Tue, 5 Oct 1999 01:23:11 +0000
In-Reply-To: <991004184232.ZM3484@candle.brasslantern.com>
Comments: In reply to "Bart Schaefer" <schaefer@candle.brasslantern.com>
        "Re: coproc tutorial (Re: questions)" (Oct  4,  6:42pm)
References: <199910041610.MAA20728@betelgeuse.ccs.neu.edu> 
	<991004184232.ZM3484@candle.brasslantern.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-users@sunsite.auc.dk
Subject: Elusive coproc bug (Re: coproc tutorial (Re: questions))
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Oct 4 I wrote:
} Subject: Re: coproc tutorial (Re: questions)
}
}     coproc tr a-z A-Z
}     exec 5>&p			;: descriptor 5 is now the input of tr
}     exec 6<&p			;: descriptor 6 is now the output of tr
}     coproc sed s/DOG/CAT/ 5>&-
}     exec 7>&p			;: descriptor 7 is now the input of sed
}     exec 8<&p			;: descriptor 8 is now the output of sed
}     coproc exit		;: close p
}     cat <&6 >&7 5>&- 7>&- &	 : tr is now connected to sed
}     exec 6<&- 7>&-		;: close shell copies of descriptors
}     echo dog >&5		;: send tr some input
}     exec 5>&-			;: close 5 so tr will exit
}     cat <&8			;: should print CAT
} 
} [...] this doesn't actually work in 3.0.6, because zsh "leaks" copies of
} descriptors 5 and 7 as descriptors 13 and 14 ("strace" is your friend)

I've now completely failed to duplicate this bug both on the machine where
I first noticed it and on my machine at home, so it must depend on some
other thing that I did earlier within that same shell.  That worries me
a bit, so if any of you happen to feel like experimenting with this (or
have any idea what may be going on), I'd appreciate hearing about it.

Meanwhile, the above appears to work as expected in a freshly-started zsh
of either version series.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

