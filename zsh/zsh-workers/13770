From zsh-workers-return-13770-mason-zsh=primenet.com.au@sunsite.dk Mon Mar 26 10:01:47 2001
Return-Path: <zsh-workers-return-13770-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22769 invoked from network); 26 Mar 2001 10:01:46 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 26 Mar 2001 10:01:46 -0000
Received: (qmail 8286 invoked by alias); 26 Mar 2001 10:01:37 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13770
Received: (qmail 8271 invoked from network); 26 Mar 2001 10:01:37 -0000
Date: Mon, 26 Mar 2001 12:01:37 +0200 (MET DST)
Message-Id: <200103261001.MAA13793@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.dk
In-reply-to: Oliver Kiddle's message of Sat, 24 Mar 2001 15:03:52 +0000
Subject: PATCH: Re: Completing option/value pairs without space


Oliver Kiddle wrote:

> Sven Wischnowsky wrote:
> > 
> > And one remark to all -workers: with the function below completion
> > after `ecasound -efs:<TAB>' makes _arguments report (and show) `-efs:'
> > as a possible completion.  That's correct somehow, but looks very
> > weird in this case.  Hm.
> 
> I don't really understand why it is "correct somehow". It seems to occur
> only with options ending in a colon and there shouldn't be anything
> special about the colon, only that if not quoted, it would mean
> something different. Isn't this _arguments failing to account for the
> quoting somewhere?

Argh.  Yes, you are right.  Why did I think I had tested that?


The problem was that the C-code didn't strip the backslashes before
colon before putting options into their own xor-lists.  That made
later tests fail.


Bye
 Sven

Index: Src/Zle/computil.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/computil.c,v
retrieving revision 1.45
diff -u -r1.45 computil.c
--- Src/Zle/computil.c	2001/01/16 13:44:20	1.45
+++ Src/Zle/computil.c	2001/03/26 10:00:58
@@ -821,7 +821,7 @@
 		    xor = (char **) zalloc(2 * sizeof(char *));
 		    xor[1] = NULL;
 		}
-		xor[xnum] = ztrdup(name);
+		xor[xnum] = ztrdup(rembslashcolon(name));
 	    }
 	    if (c == ':') {
 		/* There's at least one argument. */

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

