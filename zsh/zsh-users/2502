From zsh-users-return-2502-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Aug 23 14:11:26 1999
Return-Path: <zsh-users-return-2502-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11185 invoked from network); 23 Aug 1999 14:11:24 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 23 Aug 1999 14:11:24 -0000
Received: (qmail 6277 invoked by alias); 23 Aug 1999 14:11:09 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 2502
Received: (qmail 6270 invoked from network); 23 Aug 1999 14:11:09 -0000
Date: Mon, 23 Aug 1999 16:09:59 +0200 (MET DST)
Message-Id: <199908231409.QAA03473@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-users@sunsite.auc.dk
In-reply-to: Matthew Lovell's message of Fri, 20 Aug 1999 13:19:38 -0600 (MDT)
Subject: Re: compctl for export (with PATCH)


Matthew Lovell wrote:

> I'm using the following setup for completion on 'export':
> 
>   # for export, complete environment variables before the equal (=) sign, normal
>   # file system completion afterwards 
>   compctl -E -S '=' -x 'n[1,=]' -f -- export
> 
> If I wanted to extend MANPATH, for example, I could get completion on
> MANPATH before the equal sign, then $MANPATH after the equals and
> continue with some path specification afterwards.  This worked under
> zsh-3.1.4.
> 
> Under 3.1.6, however, adding a $ after the equals sign and asking for
> a completion erases _everything_ after 'export'.  Not quite the
> behavior I wanted.  
> 
> Does anyone have suggestions on how to cure this ill or pointers to
> relevant documentation for me?

That's a bug and below is the patch to fix this (I hope it's ok to
post this patch to zsh-users).

Bye
 Sven

diff -u os/Zle/zle_tricky.c Src/Zle/zle_tricky.c
--- os/Zle/zle_tricky.c	Mon Aug 23 11:42:11 1999
+++ Src/Zle/zle_tricky.c	Mon Aug 23 16:05:26 1999
@@ -801,9 +801,9 @@
 		isuf = dupstring(e);
 		untokenize(isuf);
 		*e = '\0';
-		ripre = dupstring(s);
+		ripre = dyncat((ripre ? ripre : ""), s);
+		ipre = dyncat((ipre ? ipre : ""), s);
 		ripre[b - s] = '\0';
-		ipre = dupstring(ripre);
 		untokenize(ipre);
 	    }
 	    else

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

