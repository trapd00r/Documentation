From zsh-workers-request@math.gatech.edu Thu Nov 20 13:24:36 1997
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 21324 invoked from network); 20 Nov 1997 13:24:35 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 20 Nov 1997 13:24:35 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id IAA25224;
	Thu, 20 Nov 1997 08:11:38 -0500 (EST)
Resent-Date: Thu, 20 Nov 1997 08:11:38 -0500 (EST)
Sender: rz2a022@rrz.uni-hamburg.de
Message-ID: <34743720.833FF333@rrz.uni-hamburg.de>
Date: Thu, 20 Nov 1997 14:12:00 +0100
From: Bernd Eggink <eggink@rrz.uni-hamburg.de>
Organization: RRZ Uni Hamburg
X-Mailer: Mozilla 4.03 [en] (X11; I; AIX 4.1)
MIME-Version: 1.0
To: zsh-workers mailing list <zsh-workers@math.gatech.edu>
Subject: vared bug in 3.1.2 found
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"4uUGU2.0.3A6.9S3Tq"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3625
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

This patch corrects a bug in zle_main.c which causes 'vared' to crash
when being called in a subshell (as variable 'curkeymapname' is
undefined):

*** zle_main.c.old      Thu Nov 20 13:54:41 1997
--- zle_main.c  Thu Nov 20 13:55:19 1997
***************
*** 386,391 ****
--- 386,392 ----
        addedsuffix = complexpect = vichgflag = 0;
        viinsbegin = 0;
        statusline = NULL;
+       selectkeymap("main", 1);
        if ((s = (unsigned char *)getlinknode(bufstack))) {
            setline((char *)s);
            zsfree((char *)s);
***************
*** 412,418 ****
        initmodifier(&zmod);
        prefixflag = 0;
        feepflag = 0;
-       selectkeymap("main", 1);
        refresh();
        while (!done && !errflag) {
  
--- 413,418 ----

Regards,
	Bernd

--
Bernd Eggink
Regionales Rechenzentrum der Uni Hamburg
eggink@rrz.uni-hamburg.de
http://www.rrz.uni-hamburg.de/eggink/BEggink.html

