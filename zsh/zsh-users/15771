From zsh-users-return-15771-mason-zsh=primenet.com.au@zsh.org Sat Feb 05 17:22:40 2011
Return-Path: <zsh-users-return-15771-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24795 invoked by alias); 5 Feb 2011 17:22:39 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15771
Received: (qmail 26364 invoked from network); 5 Feb 2011 17:22:37 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_LOW
	autolearn=ham version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.160.171 as permitted sender)
Date: Sat, 5 Feb 2011 11:22:40 -0600 (CST)
From: Rory Mulvaney <rory1@umbc.edu>
X-X-Sender: rm@MyComp2.rgm-web.net
To: zsh-users@zsh.org
Subject: I/O to shell function in zsh coproc
Message-ID: <alpine.DEB.2.00.1102051117470.6077@MyComp2.rgm-web.net>
User-Agent: Alpine 2.00 (DEB 1167 2008-08-23)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; format=flowed; charset=US-ASCII

I think this is a bug in zsh (4.3.10), I can't figure out what is wrong:

function wcFunc() {
   wc
}

# coproc wc : works with plain wc
coproc wcFunc
wcf=$!
# copy the write and read fd's for the coproc
exec 5>&p 6<&p
# start another null coproc to get a new target for the p fd
coproc exit
echo hi there >&5
# close the fd, so hopefully the coproc would exit, but it doesn't
exec 5>&-
# sleep $LONGTIME
# kill $wcf
var=$( cat <&6 )
echo $var

As noted, it works when I use plain wc, rather than wcFunc.  Of course, 
it's a lot more useful if it would work with shell functions.  It also 
works if you kill the coproc, but in the general case you'd need to first 
wait for the estimated time it takes for the coproc to complete, and you 
might not be at all sure how long it will take.

Thanks and regards,
Rory

