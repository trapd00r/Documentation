From zsh-workers-return-12938-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Oct 10 08:12:21 2000
Return-Path: <zsh-workers-return-12938-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24508 invoked from network); 10 Oct 2000 08:12:20 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 10 Oct 2000 08:12:20 -0000
Received: (qmail 15255 invoked by alias); 10 Oct 2000 08:11:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12938
Received: (qmail 15248 invoked from network); 10 Oct 2000 08:11:48 -0000
Date: Tue, 10 Oct 2000 10:11:41 +0200 (MET DST)
Message-Id: <200010100811.KAA22890@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Tue, 10 Oct 2000 12:03:54 +0400
Subject: RE: all completions


Andrej Borsenkow wrote:

> > The patch also contains a completer, _all_matches,
> 
> Pardon me, it does not :-) This is the problem with newly added files - you
> have first to 'cvs add' them; then you can generate patch with 'cvs diff -N'.
> Else 'cvs diff -N' ingnores newly born files.

Since this is a test-patch which isn't committed, this hasn't anything 
to do with cvs. It's a matter of my little brain forgatting to create
an empty file in the directory I'm diffing against. Sigh.

Bye
 Sven

--- ../oz/Completion/Core/_all_matches	Tue Oct 10 10:07:05 2000
+++ Completion/Core/_all_matches	Mon Oct  9 21:15:04 2000
@@ -0,0 +1,35 @@
+#autoload
+
+_all_matches() {
+  local old
+
+  zstyle -s ":completion:${curcontext}:" old-matches old
+
+  if [[ "$old" = (only|true|yes|1|on) ]]; then
+
+    if [[ -n "$compstate[old_list]" ]]; then
+      compstate[insert]=all
+      compstate[old_list]=keep
+      return 0
+    fi
+
+    [[ "$old" = *only* ]] && return 1
+  fi
+
+  (( $comppostfuncs[(I)_all_matches_end] )) ||
+      comppostfuncs=( "$comppostfuncs[@]" _all_matches_end )
+
+  return 1
+}
+
+_all_matches_end() {
+  if [[ "$compstate[nmatches]" -gt 1 ]]; then
+    local disp expl
+
+    _description all-matches expl 'all matches'
+    disp=('all matches...')
+    compadd "$expl[@]" -C -d disp
+  fi
+}
+
+_all_matches "$@"

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

