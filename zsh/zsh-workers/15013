From zsh-workers-return-15013-mason-zsh=primenet.com.au@sunsite.dk Thu Jun 21 03:19:01 2001
Return-Path: <zsh-workers-return-15013-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8306 invoked from network); 21 Jun 2001 03:19:00 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 21 Jun 2001 03:19:00 -0000
Received: (qmail 12926 invoked by alias); 21 Jun 2001 03:18:19 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15013
Received: (qmail 12907 invoked from network); 21 Jun 2001 03:18:18 -0000
Sender: ethersoft@rcn.com
To: teg@redhat.com (Trond Eivind =?iso-8859-1?q?Glomsr=F8d?=)
Cc: Jason Price <jprice@cyberbuzz.gatech.edu>, zsh-workers@sunsite.dk
Subject: Re: gcc 3.0 produces broken zsh
References: <20010619235049.A20425@oobleck.gatech.edu>
	<xuybsnjiyue.fsf@halden.devel.redhat.com>
From: Vin Shelton <acs@alumni.princeton.edu>
Organization: EtherSoft, Inc
Date: 20 Jun 2001 23:19:40 -0400
In-Reply-To: <xuybsnjiyue.fsf@halden.devel.redhat.com>
Message-ID: <m266dqwmcz.fsf@zion.rcn.com>
Lines: 91
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit

teg@redhat.com (Trond Eivind Glomsrød) writes:
> Jason Price <jprice@cyberbuzz.gatech.edu> writes:
> 
> > Out of morbid curiosity, I built gcc3 and installed it somewhere out of the
> > way (like $HOME/gcc3) on my redhat 7.1 linux box.  Then I tried to build
> > zsh with it.
> > 
> > It configured and compiled with hardly any errors.  The only build errors
> > were:
> > 
> > math.c: In function `zzlex':
> > math.c:382: warning: operation on `ptr' may be undefined
> > utils.o: In function `gettempname':
> > utils.o(.text+0x1de2): the use of `mktemp' is dangerous, better use `mkstemp'
> > 
> > However, when I install it, it doesn't seem to be able to find or load any
> > modules.  Building with stock gcc's of the 2.95.* variety work
> 
> It seems to work nicely with the compiler we ship, 2.96RH, as well
> (downgrading to 2.95? Yick)


I am having similar problems here.  zsh from CVS built with gcc-2.95.3
works as expected and passes all tests, but when I build with gcc-3.0,
I get the following testsuite failures, which indicate problems with
the module subsystem, IIRC:

    /usr/local/src/zsh-2001-06-20/Test/V01zmodload.ztst: starting.
    Warning: zsh/example not linked: not checking autoloading
    /usr/local/src/zsh-2001-06-20/Test/V01zmodload.ztst: all tests successful.
    /usr/local/src/zsh-2001-06-20/Test/V02zregexparse.ztst: starting.
    /usr/local/src/zsh-2001-06-20/Test/V02zregexparse.ztst: all tests successful.
    /usr/local/src/zsh-2001-06-20/Test/Y01completion.ztst: starting.
    comptestinit:7: failed to load module: zsh/zpty
    comptestinit:19: command not found: zpty
    comptestinit:21: command not found: zpty
    Test /usr/local/src/zsh-2001-06-20/Test/Y01completion.ztst failed: non-zero status from preparation code:
      comptestinit -z $ZTST_testdir/../Src/zsh
    /usr/local/src/zsh-2001-06-20/Test/Y01completion.ztst: test failed.
    Test /usr/local/src/zsh-2001-06-20/Test/Y01completion.ztst failed: bad status 1, expected 0 from:
      comptest $': \t\t\t\t\t\t\t'
    Error output:
    comptest:2: command not found: zpty
    comptest:3: command not found: zpty
    Was testing: directories and files
    /usr/local/src/zsh-2001-06-20/Test/Y01completion.ztst: test failed.
    /usr/local/src/zsh-2001-06-20/Test/Y02compmatch.ztst: starting.
    comptestinit:7: failed to load module: zsh/zpty
    comptestinit:19: command not found: zpty
    comptestinit:21: command not found: zpty
    Test /usr/local/src/zsh-2001-06-20/Test/Y02compmatch.ztst failed: non-zero status from preparation code:
      comptestinit -z $ZTST_testdir/../Src/zsh
    /usr/local/src/zsh-2001-06-20/Test/Y02compmatch.ztst: test failed.
    Test /usr/local/src/zsh-2001-06-20/Test/Y02compmatch.ztst failed: bad status 1, expected 0 from:
     test_code z: list1
     comptest  $'tst \t'
    Error output:
    comptesteval:4: command not found: zpty
    comptesteval:5: command not found: zpty
    comptest:2: command not found: zpty
    comptest:3: command not found: zpty
    Was testing: Match Error for "z:"
    /usr/local/src/zsh-2001-06-20/Test/Y02compmatch.ztst: test failed.
    /usr/local/src/zsh-2001-06-20/Test/Y03arguments.ztst: starting.
    comptestinit:7: failed to load module: zsh/zpty
    comptestinit:19: command not found: zpty
    comptestinit:21: command not found: zpty
    comptesteval:4: command not found: zpty
    comptesteval:5: command not found: zpty
    Test /usr/local/src/zsh-2001-06-20/Test/Y03arguments.ztst failed: bad status 1, expected 0 from:
     tst_arguments ':desc1:(arg1)'
     comptest $'tst \t\C-wa\t\C-war\t\C-warg\t\C-warg1\t\C-wr\t\C-wx\t \ty \t'
    Error output:
    comptesteval:4: command not found: zpty
    comptesteval:5: command not found: zpty
    comptest:2: command not found: zpty
    comptest:3: command not found: zpty
    Was testing: one non-option argument
    /usr/local/src/zsh-2001-06-20/Test/Y03arguments.ztst: test failed.
    make[1]: [check] Error 1 (ignored)
    rm -rf Modules .zcompdump
    make[1]: Leaving directory `/usr/local/build/zsh-2001-06-20/Test'


Here are my zsh config options:
  /usr/local/src/zsh-2001-06-20/configure  --prefix=/usr/local/zsh-2001-06-20 --datadir=/usr/local/share --enable-zsh-mem --enable-etcdir=/usr/local/etc --enable-dynamic --disable-nls --disable-locale

This is on a linux-2.4.6-pre4 686 system, with glibcglibc-2.2.2-5mdk.
The system is based on Mandrake 8.0.

  - vin

