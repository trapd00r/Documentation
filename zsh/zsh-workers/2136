From zsh-workers-request@euclid.skiles.gatech.edu  Fri Sep 13 08:25:16 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by coral.primenet.com.au (8.7.5/8.7.3) with ESMTP id IAA07618 for <mason@primenet.com.au>; Fri, 13 Sep 1996 08:25:13 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id SAA22127; Thu, 12 Sep 1996 18:10:02 -0400 (EDT)
Resent-Date: Thu, 12 Sep 1996 18:10:02 -0400 (EDT)
Message-Id: <199609122207.SAA02092@smiley.Princeton.EDU>
X-Authentication-Warning: smiley.Princeton.EDU: rdslater owned process doing -bs
To: zsh-workers@math.gatech.edu
cc: rdslater@splash.Princeton.EDU
Subject: Zsh on Cray T90
X-uri: http://www2.aos.Princeton.EDU/rdslater/orienteering/
Date: Thu, 12 Sep 1996 18:07:16 -0400
From: "Richard D. Slater" <rdslater@splash.Princeton.EDU>
Resent-Message-ID: <"EXBFQ3.0.fP5.we8Eo"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2136
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

I have gotten zsh-3.0.0 running on our Cray T90 (IEEE processors).  I
needed to make three changes: add code to config.guess to recognize the
machine, add code to config.sub to recognize the machine, and
initialize the variable "val" to 0 in routine getquery in Src/utils.c.
Without doing the latter the routine would always immediately return
with a value 'n' (not a fatal flaw, but annoying).  I've also modified
config.(guess|sub) to recognize the C90 (I think).  I had built
zsh-2.5.03 on our previous C90, but it always had the "getquery" bug.

One further change needs to be run on our machine after running
configure.  Configure finds that our machine has NIS+, but doesn't find
the appropriate libraries (also, we may not have all of them
installed).  Since we do not run NIS+, but just NIS, I just commented
out that NIS+ exists.  A minor point is that Configure somehow finds
-ldir, but it never finds it when linking (gets a CAUTION).  Builds OK,
though.

One other point which is likely a problem with UNICOS 9.0.xxx's make is
that I can do a "make -n" in the top-level directory and it says
everything that it will do, but when I run "make" it cd's to Src and
says it will make "FORCE" but then doesn't execute any commands.  I end
up having to cd to Src myself and run make, which then works.

I do not subcribe to this list.  Thanks for all of your work and for a
great shell.

Rick Slater

--------here's the patch
diff -P -C 2 -r /ftmp/rdslater/tmpdir.096286a/zsh-3.0.0/Src/utils.c zsh-3.0.0/Src/utils.c
*** /ftmp/rdslater/tmpdir.096286a/zsh-3.0.0/Src/utils.c	Thu Sep 12 16:13:28 1996
--- zsh-3.0.0/Src/utils.c	Tue Sep 10 18:01:08 1996
***************
*** 1119,1123 ****
  
  #ifdef FIONREAD
!     int val;
  #endif
  
--- 1119,1123 ----
  
  #ifdef FIONREAD
!     int val = 0;
  #endif
  
diff -P -C 2 -r /ftmp/rdslater/tmpdir.096286a/zsh-3.0.0/config.guess zsh-3.0.0/config.guess
*** /ftmp/rdslater/tmpdir.096286a/zsh-3.0.0/config.guess	Thu Sep 12 16:13:34 1996
--- zsh-3.0.0/config.guess	Tue Sep 10 19:04:49 1996
***************
*** 308,311 ****
--- 308,314 ----
  	echo c90-cray-unicos${UNAME_RELEASE}
  	exit 0 ;;
+     CRAY*TS:*:*:*)
+ 	echo t90-cray-unicos${UNAME_RELEASE}
+ 	exit 0 ;;
      CRAY-2:*:*:*)
  	echo cray2-cray-unicos
diff -P -C 2 -r /ftmp/rdslater/tmpdir.096286a/zsh-3.0.0/config.sub zsh-3.0.0/config.sub
*** /ftmp/rdslater/tmpdir.096286a/zsh-3.0.0/config.sub	Thu Sep 12 16:13:34 1996
--- zsh-3.0.0/config.sub	Tue Sep 10 19:57:58 1996
***************
*** 151,154 ****
--- 151,155 ----
  	      | hppa1.0-* | hppa1.1-* | alpha-* | we32k-* | cydra-* | ns16k-* \
  	      | pn-* | np1-* | xps100-* | clipper-* | orion-* | sparclite-* \
+ 	      | c90-* | t90-* \
  	      | pdp11-* | sh-* | powerpc-* | powerpcle-* | sparc64-* | mips64-* | mipsel-* \
  	      | mips64el-* | mips64orion-* | mips64orionel-*)
***************
*** 214,217 ****
--- 215,226 ----
  		basic_machine=c38-convex
  		os=-bsd
+ 		;;
+ 	c90 )
+ 		basic_machine=c90-cray
+ 		os=-unicos
+ 		;;
+ 	t90 )
+ 		basic_machine=t90-cray
+ 		os=-unicos
  		;;
  	cray | ymp)

