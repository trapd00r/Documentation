From zsh-workers-return-17928-mason-zsh=primenet.com.au@sunsite.dk Tue Nov 12 10:39:48 2002
Return-Path: <zsh-workers-return-17928-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10669 invoked from network); 12 Nov 2002 10:39:47 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 12 Nov 2002 10:39:47 -0000
Received: (qmail 22447 invoked by alias); 12 Nov 2002 10:39:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 17928
Received: (qmail 22437 invoked from network); 12 Nov 2002 10:39:39 -0000
Date: Tue, 12 Nov 2002 12:39:31 +0200
From: "Zvi Har'El" <rl@math.technion.ac.il>
To: Zsh hackers list <zsh-workers@sunsite.dk>
Cc: "Nadav Har'El" <nyh@math.technion.ac.il>
Subject: edit-command-line
Message-ID: <20021112103931.GB16493@fermat.math.technion.ac.il>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4i
Hebrew-Date: 7 Kislev 5763
X-PGP-Public-Key: http://www.math.technion.ac.il/~rl/pubkey.html

Hi,

The function edit-command-line, which implements the ksh-like editing of the
command line using $EDITOR when v is hit, has a bug, which makes backslashes
escapes evaluated. You can try this by entering the command 

echo 'a\nb'

and hitting escape and v. You enter your $EDITOR, and when you leave it the
command is changed to

echo 'a
b'

which is of course wrong.

The following patch, which adds a -R (raw) option to a print, solves the
problem:

--- /usr/local/share/zsh/4.0.6/functions/edit-command-line.orig
2002-08-14 22:54:06.000000000 +0300
+++ /usr/local/share/zsh/4.0.6/functions/edit-command-line      2002-11-12
12:27:58.000000000 +0200
@@ -11,7 +11,7 @@
 print -R - "$PREBUFFER$BUFFER" >$tmpfile
 exec </dev/tty
 ${VISUAL:-${EDITOR:-vi}} $tmpfile
-print -z - "$(<$tmpfile)" 
+print -Rz - "$(<$tmpfile)" 
 
 command rm -f $tmpfile
 zle send-break         # Force reload from the buffer stack


Best,

Zvi.

-- 
Dr. Zvi Har'El     mailto:rl@math.technion.ac.il     Department of Mathematics
tel:+972-54-227607                   Technion - Israel Institute of Technology
fax:+972-4-8324654 http://www.math.technion.ac.il/~rl/     Haifa 32000, ISRAEL
"If you can't say somethin' nice, don't say nothin' at all." -- Thumper (1942)
                             Tuesday, 7 Kislev 5763, 12 November 2002, 12:32PM

