From zsh-workers-request@euclid.skiles.gatech.edu Thu Jun 05 12:39:39 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 26013 invoked from network); 5 Jun 1997 12:39:36 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 5 Jun 1997 12:39:36 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id IAA18916; Thu, 5 Jun 1997 08:30:45 -0400 (EDT)
Resent-Date: Thu, 5 Jun 1997 08:30:45 -0400 (EDT)
Message-Id: <m0wZbjV-0005u1C@tweedledee.amp.york.ac.uk>
From: wjf103@york.ac.uk (Wez Furlong)
Date: Thu, 5 Jun 1997 13:33:37 +0100
In-Reply-To: Zoltan Hidvegi <hzoli@ny.frontiercomm.net>
       "Re: modules!??" (Jun  5,  1:45am)
X-Mailer: Mail User's Shell (7.2.6 beta(3) 11/17/96)
To: Zoltan Hidvegi <hzoli@ny.frontiercomm.net>
Subject: Re: modules!??
Cc: zsh-workers@math.gatech.edu
Resent-Message-ID: <"E48L_2.0.Sd4.q5hbp"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3208
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On Jun 5,  1:45am, Zoltan Hidvegi wrote:
: [I wrote]
: > On IRIX zsh 'goes away' when it loads the comp1 module on startup. If it
: > can't find the comp1 module, it carries on without zle or compctl.

: > Under SunOS, the modules work fine, except:
: > When you explicitly zmodload comp1:
: > 	ld.so: Undefined symbol: _fallback_compctlread
: > The shell then exits.
: > also,
: > 	% zmodload deltochar
: > 	ld.so: Undefined symbol: _zmod
: 
: Perhaps I should have mentioned this in the readme.  On some systems
: modules cannot export symbols to other modules, so the comp1 module has to
: be compiled into the main binary.  configure autodetects these systems, and
: if you do not create modules-bltin manually, make will create it with comp1
: which forces comp1 into the main binary.

Is it safe to remove the redundant comp1.so that is created in this
case? Also, is it possible to have the Makefile not install it if its
not needed?

: But really you should never load comp1 manually.  Zsh knows that zle needs
: comp1 and if you try to load zle it will load comp1 first if it doesn't
: already have it.

I was only explicitly loading it in an attempt to narrow down the cause
of the problem.

: Perhaps the output of zmodload should include the
: statically linked modules as well (with some indication that this module is
: static).  This would give the user a more clear picture.

That would be a good thing :)

: The IRIX crash is probably caused by the duplication of the comp1 module.

The IRIX version loads the comp1 module on startup itself; this leads me
to believe that comp1 is not builtin to the IRIX binary. When it
successfully loads the comp1.so, it seg-faults; without it it carries on
happily.

: Deltochar have a similar problem, it wants to use the zmod symbol exported
: by the zle module.  The symbols defined by a module can be discovered using
: dlsym even on these systems, so we may find some way to overcome this
: limitation.  I think it is possible to do that with some script-generated C
: code.  For that we also need a list of exported and imported function for
: each module and for the main binary, which is also needed for dynamic
: loading on AIX.  The imported function list is hard to portably generate
: automatically, so these lists will probably have to be maintained by hand
: (with the help of a script, which can generate this list automatically
: using nm, ld or some other tool on an OS I have access to).

I hope it all comes together soon!

Cheers,



-- 
Wez - Electronics Undergraduate at the University of York
URL : http://www.twinklestar.demon.co.uk/

Insult Of The Day: Thou vain spur-galled foot-licker!

