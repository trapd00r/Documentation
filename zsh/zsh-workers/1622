From borsenkow.msk@sni.de Fri Jul 12 23:15:58 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3/2) with ESMTP id XAA15418 for <mason@werple.mira.net.au>; Fri, 12 Jul 1996 23:15:56 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id JAA10912; Fri, 12 Jul 1996 09:09:07 -0400 (EDT)
Resent-Date: Fri, 12 Jul 1996 09:09:07 -0400 (EDT)
Date: Fri, 12 Jul 1996 17:07:16 +0400 (MOW)
From: Andrej Borsenkow <borsenkow.msk@sni.de>
X-Sender: bor@itsrm1
Reply-To: borsenkow.msk@sni.de
To: Zsh workers mailing list <zsh-workers@math.gatech.edu>
Subject: Re: Small problem with typeset -U.
In-Reply-To: <Pine.SV4.3.94.960712165030.23028C-100000@itsrm1>
Message-ID: <Pine.SV4.3.94.960712170546.23028D-100000@itsrm1>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Resent-Message-ID: <"lJ0Z13.0.Ng2.ovavn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1622
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 1565
Status: O

Sorry, just found, that it was not the best diff format. Once more ;)

-------------------------------------------------------------------------
Andrej Borsenkow 		Fax:   +7 (095) 252 01 05
SNI ITS Moscow			Tel:   +7 (095) 252 13 88

NERV:  borsenkow.msk		E-Mail: borsenkow.msk@sni.de
-------------------------------------------------------------------------
==========================================================
--- Src/builtin.c.org	Thu Jul  4 20:05:16 1996
+++ Src/builtin.c	Fri Jul 12 16:38:49 1996
@@ -2799,6 +2799,16 @@
 				!(pm->flags & PM_READONLY & ~off))
 				uniqarray((*pm->gets.afn) (pm));
 			    pm->flags = (pm->flags | on) & ~off;
+			    if ((pm->flags & PM_SPECIAL) && pm->ename) {
+				Param	pme;
+
+				pme = (Param) paramtab->getnode(paramtab, pm->ename);
+				if (pme)
+				    if (on & PM_UNIQUE)
+					pme->flags |= PM_UNIQUE;
+				    else
+					pme->flags &= ~PM_UNIQUE;
+			    };
 			    if (PM_TYPE(pm->flags) != PM_ARRAY) {
 				if (on & (PM_LEFT | PM_RIGHT_B | PM_RIGHT_Z | PM_INTEGER))
 				    pm->ct = auxlen;
@@ -2868,6 +2878,16 @@
 		!(pm->flags & PM_READONLY & ~off))
 		uniqarray((*pm->gets.afn) (pm));
 	    pm->flags = (pm->flags | on) & ~off;
+	    if ((pm->flags & PM_SPECIAL) && pm->ename) {
+		Param	pme;
+
+		pme = (Param) paramtab->getnode(paramtab, pm->ename);
+		if (pme)
+		    if (on & PM_UNIQUE)
+			pme->flags |= PM_UNIQUE;
+		    else
+			pme->flags &= ~PM_UNIQUE;
+	    };
 	    if (on & (PM_LEFT | PM_RIGHT_B | PM_RIGHT_Z | PM_INTEGER))
 		pm->ct = auxlen;
 	    if (PM_TYPE(pm->flags) != PM_ARRAY) {



