From zsh-workers-request@euclid.skiles.gatech.edu Mon Feb 03 18:39:27 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 24084 invoked from network); 3 Feb 1997 18:39:25 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 3 Feb 1997 18:39:25 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id NAA10029; Mon, 3 Feb 1997 13:32:34 -0500 (EST)
Resent-Date: Mon, 3 Feb 1997 13:32:34 -0500 (EST)
From: gwing@primenet.com.au
Message-ID: <19970203183419.24003.qmail@primenet.com.au>
Subject: Re: zle_refresh patch 2
To: schaefer@nbn.com
Date: Tue, 4 Feb 1997 05:34:19 +1100 (EST)
Cc: zsh-workers@math.gatech.edu (zsh-workers)
In-Reply-To: <970203100507.ZM10555@candle.brasslantern.com> from "Bart Schaefer" at Feb 3, 97 10:05:07 am
X-Mailer: ELM [version 2.4 PL25]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"6beUR3.0.eS2.1zYzo"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2867
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Bart Schaefer wrote:
:On Feb 3,  9:55pm, gwing@primenet.com.au wrote:
:} Subject: zle_refresh patch 2
:} It fixes coredumps and bad displays when terms are 1 or 2 lines.
:} When a terminal is 1 or 2 lines high, the terminal will act as if 
:} SINGLE_LINE_ZLE is set.  This avoids many problems with the status line.
:There's already code that causes SINGLE_LINE_ZLE to become set if the
:terminal starts out at, or is shrunk to, 1 line high or 1 column wide.
:(It happens when $COLUMNS or $LINES changes.)  Some of that code is a
:few lines above your changes to test (lines < 3).

:If it's necessary to
:behave as SINGLE_LINE_ZLE for 2 lines as well, the other code should be
:changed so that SINGLE_LINE_ZLE *is* set when zsh is `acting as if' it
:is set.

I was slightly uncertain about the correct behaviour here: should
SINGLE_LINE_ZLE be set when it is `acting as if' it is set?  If it is set,
then if it stops acting as if it is set, does it go back to the previous
value?  I believe if yes to the former, then yes to the latter.  But then,
I don't necessarily believe yes to the former.

Another thing - I suggest you don't set your xterm to 2 columns or less and
setopt SINGLE_LINE_ZLE - I'll have to fix that coredump too.

I just tried your patch on my *old* source - ouch - coredump in setintenv() 
884   if ((pm = (Param) paramtab->getnode(paramtab, s)) && pm->env) {
(gdb) print paramtab
$1 = (struct hashtable *) 0x0

Hope it works OK for you.
-- 
Geoff Wing [gwing@primenet.com.au]   Technical Manager
  Phone    : +61-3-9818 2977         PrimeNet - Internet Consultancy
  Facsimile: +61-3-9819 3788         Web : <URL:http://www.primenet.com.au/>
  Mobile   : 0412 162 441

