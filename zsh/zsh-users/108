From zsh-workers-request@math.gatech.edu  Sun Oct 22 01:39:13 1995
Received: from gatech.edu (gatech.edu [130.207.244.244]) by werple.net.au (8.7/8.7.1) with SMTP id BAA28355 for <mason@werple.mira.net.au>; Sun, 22 Oct 1995 01:38:06 +1000 (EST)
Received: from euclid (euclid.skiles.gatech.edu) by gatech.edu with SMTP id AA05797
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Sat, 21 Oct 1995 11:28:17 -0400
Received: by euclid (5.x/SMI-SVR4)
	id AA06597; Sat, 21 Oct 1995 11:26:39 -0400
Old-Return-Path: <zsh-users-request@math.gatech.edu>
Resent-Date: Sat, 21 Oct 1995 09:27:24 -0600
Old-Return-Path: <mdb@cdc.noaa.gov>
Date: Sat, 21 Oct 1995 09:27:24 -0600
Message-Id: <9510211527.AA20687@charney.cdc.noaa.gov>
From: Mark Borges <mdb@cdc.noaa.gov>
To: duvall@dhduvall.student.Princeton.EDU
Cc: zsh-users@math.gatech.edu
Subject: Re: appendhistory and history file truncation
In-Reply-To: <199510210758.DAA01183@dhduvall.student.Princeton.EDU>
References: <199510210758.DAA01183@dhduvall.student.Princeton.EDU>
Organization: CIRES, University of Colorado
X-Attribution: mb
Resent-Message-Id: <"ndEwN1.0.mc1.d4HYm"@euclid>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/108
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

>> On Sat, 21 Oct 1995 03:58:32 -0400,
>> Danek Duvall(DD) wrote:
DD> I'm having a problem wherein whenever I start up an invocation of zsh
DD> (2.6 beta10), my history file gets wiped.  It doesn't happen when
DD> NO_RCS is set (if I do zsh -f).  It seems that even though
DD> APPENDHISTORY is set, savehistfile() ends up opening the file mode
DD> O_TRUNC on line 1471 of hist.c (at least, I think this is the
DD> culprit).  Perhaps this line should be rewritten as the block in lines
DD> 1420-1423.

DD> I checked beta11-test10, and it hasn't been fixed.

Zoltan and Peter have sent fixes for this in

	archive/latest/373 (also in 337)
	archive/latest/376 

respectively.

Please try to incorparate these in beta11, Richard. For those of us
who are exec'ing the latest betas out of a startup script it's very
unpleasant to lose your history each time you log in. It's very
difficult to do my real work without history, consequently I haven't
been stress testing the baseline betas since this bug appeared.

  -mb-

