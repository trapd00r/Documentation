<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux/x86 (vers 25 March 2009), see www.w3.org">
  <meta http-equiv="Content-Type" content=
  "text/html; charset=utf-8">

  <title>Git Magic - 第&nbsp;8&nbsp;章&nbsp;揭开面纱</title>
  <link rel="stylesheet" href="default.css" type="text/css">
  <meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
  <link rel="home" href="index.html" title="Git 魔法">
  <link rel="up" href="index.html" title="Git 魔法">
  <link rel="prev" href="ch07.html" title=
  "第&nbsp;7&nbsp;章&nbsp;Git大师技">
  <link rel="next" href="ch09.html" title=
  "第&nbsp;9&nbsp;章&nbsp;附录 A: Git的缺点">
</head>

<body bgcolor="white" text="black" link="#0000FF" vlink="#840084"
alink="#0000FF">
    <div class="toc">
      <ul>
<li><b>Git Magic</b></li>
        <li>
          <span class="preface"><a href="index.html">前言</a></span>

          <ul>
            <li><span class="section"><a href=
            "index.html#__2">致谢！</a></span></li>

            <li><span class="section"><a href=
            "index.html#__3">许可</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch01.html">1.
          入门</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch01.html#__5">工作是玩</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#__6">版本控制</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#__7">分布控制</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#__8">一个误区</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#__9">合并冲突</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch02.html">2.
          基本技巧</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch02.html#__11">保存状态</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__12">添加、删除、重命名</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__13">进阶撤销/重做</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__14">撤销</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__15">变更日志生成</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__16">下载文件</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__17">到最新</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__18">快速发布</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__19">我们已经做了什么？</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__20">练习</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch03.html">3.
          克隆周边</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch03.html#__22">计算机间同步</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__23">典型源码控制</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__24">封闭源码</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__25">裸仓库</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__26">推还是拽</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__27">项目分叉</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__28">终极备份</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__29">轻快多任务</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__30">游击版本控制</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_mercurial">Mercurial</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_bazaar">Bazaar</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_git">我偏爱Git的原因</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch04.html">4.
          分支巫术</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch04.html#__32">老板键</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__33">肮脏的工作</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__34">快速修订</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__35">合并</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__36">不间断工作流</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__37">重组杂乱</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__38">管理分支</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__39">临时分支</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__40">按你希望的方式工作</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch05.html">5.
          关于历史</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch05.html#__42">我认错</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__43">更复杂情况</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__44">本地变更之后</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__45">重写历史</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__46">制造历史</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__47">哪儿错了？</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__48">谁让事情变糟了？</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__49">个人经验</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch06.html">6.
          多人Git</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch06.html#__50">我是谁？</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_git_ssh_http">Git在SSH,
            HTTP上</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_git_3">Git在随便什么上</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__51">补丁：全球货币</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__52">对不起，移走了</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__53">远端分支</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__54">多远端</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__55">我的喜好</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch07.html">7.
          Git大师技</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch07.html#__56">源码发布</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#__57">提交变更</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#__58">我的提交太大了！</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_git_5">索引：Git的中转区域</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_head">别丢了你的HEAD</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_head_2">HEAD捕猎</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_git_6">基于Git构建</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#__59">大胆的特技</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#__60">阻止坏提交</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch08.html">8.
          揭开面纱</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch08.html#__62">大象无形</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__63">数据完整性</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__64">智能</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__65">索引</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_git_7">Git的源起</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__66">对象数据库</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_blob">Blob对象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_tree">Tree对象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_commit">Commit对象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__67">没那么神</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch09.html">9. 附录 A:
          Git的缺点</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch09.html#_sha1">SHA1 的弱点</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_windows">微软 Windows</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__68">不相关的文件</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__69">谁在编辑什么？</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__70">文件历史</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__71">初始克隆</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__72">不稳定的项目</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__73">全局计数器</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__74">空子目录</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__75">初始提交</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__76">接口怪癖</a></span></li>
          </ul>
        </li>

        <li><span class="chapter"><a href="ch10.html">10. 附录 B:
        本指南的翻译</a></span></li>
      </ul>
    </div>
<div class="content">
  <div class="chapter" title="第&nbsp;8&nbsp;章&nbsp;揭开面纱">
    <div class="titlepage">
      <div>
        <div>
          <h2 class="title"><a name=
          "__61"></a>第&nbsp;8&nbsp;章&nbsp;揭开面纱</h2>
        </div>
      </div>
    </div>

    <p>我们揭开Git神秘面纱，往里瞧瞧它是如何创造奇迹的。我会跳过细节。更深入的描述参 见 <a class="ulink"
    href=
    "http://www.kernel.org/pub/software/scm/git/docs/user-manual.html"
    target="_top">用户手 册</a>。</p>

    <div class="section" title="大象无形">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__62"></a>大象无形</h2>
          </div>
        </div>
      </div>

      <p>Git怎么这么谦逊寡言呢？除了偶尔提交和合并外，你可以如常工作，就像不知道版本控
      制系统存在一样。那就是，直到你需要它的时候，而且那是你欢欣的时候，Git一直默默 注视着你。</p>

      <p>其他版本控制系统强迫你与繁文缛节和官僚主义不断斗争。文件的权限可能是只读的，
      除非你显式地告诉中心服务器哪些文件你打算编辑。即使最基本的命令，随着用户数目
      的增多，也会慢的像爬一样。中心服务器可能正跟踪什么人，什么时候check out了什么
      代码。当网络连接断了的时候，你就遭殃了。开发人员不断地与这些版本控制系统的种
      种限制作斗争。一旦网络或中心服务器瘫痪，工作就嘎然而止。</p>

      <p>与之相反，Git简单地在你工作目录下的<code class=
      "literal">.git`目录保存你项目的历史。这是你自己的历
      史拷贝，因此你可以保持离线，直到你想和他人沟通为止。你拥有你的文件命运完全的
      控制权，因为Git可以轻易在任何时候从</code>.git`重建一个保存状态。</p>
    </div>

    <div class="section" title="数据完整性">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__63"></a>数据完整性</h2>
          </div>
        </div>
      </div>

      <p>很多人把加密和保持信息机密关联起来，但一个同等重要的目标是保证信息安全。合理
      使用哈希加密功能可以防止无意或有意的数据损坏行为。</p>

      <p>一个SHA1哈希值可被认为是一个唯一的160位ID数，用它可以唯一标识你一生中遇到的每 个字节串。
      实际上不止如此：每个字节串可供任何人用好多辈子。</p>

      <p>对一个文件而言，其整体内容的哈希值可以被看作这个文件的唯一标识ID数。</p>

      <p>因为一个SHA1哈希值本身也是一个字节串，我们可以哈希包括其他哈希值的字节串。这
      个简单的观察出奇地有用：查看“哈希链”。我们之后会看Git如何利用这一点来高效地 保证数据完整性。</p>

      <p>简言之，Git把你数据保存在`.git/objects`子目录，那里看不到正常文件名，相反你只
      看到ID。通过用ID作为文件名，加上一些文件锁和时间戳技巧，Git把任意一个原始的文
      件系统转化为一个高效而稳定的数据库。</p>
    </div>

    <div class="section" title="智能">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__64"></a>智能</h2>
          </div>
        </div>
      </div>

      <p>Git是如何知道你重命名了一个文件，即使你从来没有明确提及这个事实？当然，你或许 是运行了 <span class=
      "strong"><strong>git mv</strong></span> ，但这个命令和 <span class=
      "strong"><strong>git add</strong></span> 紧接 <span class=
      "strong"><strong>git rm</strong></span> 是完全一样的。</p>

      <p>Git启发式地找出相连版本之间的重命名和拷贝。实际上，它能检测文件之间代码块的移
      动或拷贝！尽管它不能覆盖所有的情况，但它已经做的很好了，并且这个功能也总在改
      进中。如果它在你那儿不工作的话，可以尝试打开开销更高的拷贝检测选项，并考虑升 级。</p>
    </div>

    <div class="section" title="索引">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__65"></a>索引</h2>
          </div>
        </div>
      </div>

      <p>为每个加入管理的文件，Git在一个名为“index”的文件里记录统计信息，诸如大小，
      创建时间和最后修改时间。为了确定文件是否更改，Git比较其当前统计信息与那些在索
      引里的统计信息。如果一致，那Git就跳过重新读文件。</p>

      <p>因为统计信息的调用比读文件内容快的很多，如果你仅仅编辑了少数几个文件，Git几乎
      不需要什么时间就能更新他们的统计信息。</p>

      <p>我们前面讲过索引是一个中转区。为什么一堆文件的统计数据是一个中转区？因为添加
      命令将文件放到Git的数据库并更新它们的统计信息，而无参数的提交命令创建一个提交，
      只基于这些统计信息和已经在数据库里的文件。</p>
    </div>

    <div class="section" title="Git的源起">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="_git_7"></a>Git的源起</h2>
          </div>
        </div>
      </div>

      <p>这个 <a class="ulink" href=
      "http://lkml.org/lkml/2005/4/6/121" target=
      "_top">Linux内核邮件列表帖子</a> 描述了导致Git
      的一系列事件。整个讨论线索是一个令人着迷的历史探究过程，对Git史学家而言。</p>
    </div>

    <div class="section" title="对象数据库">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__66"></a>对象数据库</h2>
          </div>
        </div>
      </div>

      <p>你数据的每个版本都保存在“对象数据库”里，其位于子目录<code class=
      "literal">.git/objects`；其他位
      于</code>.git/`的较少数据：索引，分支名，标签，配置选项，日志，头提交的当前位置等。
      对象数据库朴素而优雅，是Git的力量之源。</p>

      <p>`.git/objects`里的每个文件是一个对象。有3中对象跟我们有关：“blob”对象，
      “tree”对象，和“commit”对象。</p>
    </div>

    <div class="section" title="Blob对象">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="_blob"></a>Blob对象</h2>
          </div>
        </div>
      </div>

      <p>首先来一个小把戏。去一个文件名，任意文件名。在一个空目录：</p>
      <pre class="literallayout">
$ echo sweet &gt; YOUR_FILENAME
$ git init
$ git add .
$ find .git/objects -type f
</pre>

      <p>你将看到 <code class=
      "literal">.git/objects/aa/823728ea7d592acc69b36875a482cdf3fd5c8d</code>
      。</p>

      <p>我如何在不知道文件名的情况下知道这个？这是因为以下内容的SHA1哈希值：</p>
      <pre class="literallayout">
"blob" SP "6" NUL "sweet" LF
</pre>

      <p>是
      aa823728ea7d592acc69b36875a482cdf3fd5c8d，这里SP是一个空格，NUL是一个0字节，
      LF是一个换行符。你可以验证这一点，键入：</p>
      <pre class="literallayout">
$ printf "blob 6\000sweet\n" | sha1sum
</pre>

      <p>Git基于“内容寻址”：文件并不按它们的文件名存储，而是按它们包含内容的哈希值，
      在一个叫“blob对象”的文件里。我们可以把文件内容的哈希值看作一个唯一ID，这样
      在某种意义上我们通过他们内容放置文件。开始的“blob 6”只是一个包含对象类型与 其长度的头；它简化了内部存储。</p>

      <p>这样我可以轻易语言你所看到的。文件名是无关的：只有里面的内容被用作构建blob对象。</p>

      <p>你可能想知道对相同的文件什么会发生。试图加一个你文件的拷贝，什么文件名都行。 在 <code class=
      "literal">.git/objects</code> 的内容保持不变，不管你加了多少。Git只存储一次数据。</p>

      <p>顺便说一句，在 <code class="literal">.git/objects</code>
      里的文件用zlib压缩，因此你不应该直接查看他们。 可以通过<a class="ulink" href=
      "http://www.zlib.net/zpipe.c" target="_top">zpipe -d</a> 管道，
      或者键入：</p>
      <pre class="literallayout">
$ git cat-file -p aa823728ea7d592acc69b36875a482cdf3fd5c8d
</pre>

      <p>这漂亮地打印出给定的对象。</p>
    </div>

    <div class="section" title="Tree对象">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="_tree"></a>Tree对象</h2>
          </div>
        </div>
      </div>

      <p>但文件名在哪？它们必定在某个阶段保存在某个地方。Git在提交时得到文件名：</p>
      <pre class="literallayout">
$ git commit  # 输入一些信息。
$ find .git/objects -type f
</pre>

      <p>你应看到3个对象。这次我不能告诉你这两个新文件是什么，因为它部分依赖你选择的文
      件名。我继续进行，假设你选了‘`rose’'。如果你没有，你可以重写历史以让它看起来 像似你做了：</p>
      <pre class="literallayout">
$ git filter-branch --tree-filter 'mv YOUR_FILENAME rose'
$ find .git/objects -type f
</pre>

      <p>现在你硬看到文件 <code class=
      "literal">.git/objects/05/b217bb859794d08bb9e4f7f04cbda4b207fbe9</code>
      ，因为这是以下内容的SHA1哈希值：</p>
      <pre class="literallayout">
"tree" SP "32" NUL "100644 rose" NUL 0xaa823728ea7d592acc69b36875a482cdf3fd5c8d
</pre>

      <p>检查这个文件真的包含上面内容通过键入：</p>
      <pre class="literallayout">
$ echo 05b217bb859794d08bb9e4f7f04cbda4b207fbe9 | git cat-file --batch
</pre>

      <p>使用zpipe，验证哈希值是容易的：</p>
      <pre class="literallayout">
$ zpipe -d &lt; .git/objects/05/b217bb859794d08bb9e4f7f04cbda4b207fbe9 | sha1sum
</pre>

      <p>与查看文件相比，哈希值验证更技巧一些，因为其输出不止包含原始未压缩文件。</p>

      <p>这个文件是一个“tree”对象：一组数据包含文件类型，文件名和哈希值。在我们的例
      子里，文件类型是100644，这意味着“rose”是一个一般文件，并且哈希值指blob对象，
      包含“rose”的内容。其他可能文件类型有可执行，链接或者目录。在最后一个例子里， 哈希值指向一个tree对象。</p>

      <p>在一些过渡性的分支，你会有一些你不在需要的老的对象，尽管有宽限过期之后，它们
      会被自动清除，现在我们还是将其删除，以使我们比较容易跟上这个玩具例子。</p>
      <pre class="literallayout">
$ rm -r .git/refs/original
$ git reflog expire --expire=now --all
$ git prune
</pre>

      <p>在真实项目里你通常应该避免像这样的命令，因为你在破换备份。如果你期望一个干净
      的仓库，通常最好做一个新的克隆。还有，直接操作 <code class="literal">.git</code>
      时一定要小心：如果 Git命令同时也在运行会怎样，或者突然停电？一般，引用应由 <span class=
      "strong"><strong>git update-ref -d</strong></span>
      删除，尽管通常手工删除 <code class="literal">refs/original</code>
      也是安全的。</p>
    </div>

    <div class="section" title="Commit对象">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="_commit"></a>Commit对象</h2>
          </div>
        </div>
      </div>

      <p>我们已经解释了三个对象中的两个。第三个是“commit”对象。其内容依赖于提交信息
      以及其创建的日期和时间。为满足这里我们所有的，我们不得不调整一下：</p>
      <pre class="literallayout">
$ git commit --amend -m Shakespeare  # 改提交信息
$ git filter-branch --env-filter 'export
    GIT_AUTHOR_DATE="Fri 13 Feb 2009 15:31:30 -0800"
    GIT_AUTHOR_NAME="Alice"
    GIT_AUTHOR_EMAIL="alice@example.com"
    GIT_COMMITTER_DATE="Fri, 13 Feb 2009 15:31:30 -0800"
    GIT_COMMITTER_NAME="Bob"
    GIT_COMMITTER_EMAIL="bob@example.com"'  # Rig timestamps and authors.
$ find .git/objects -type f
</pre>

      <p>你现在应看到 <code class=
      "literal">.git/objects/49/993fe130c4b3bf24857a15d7969c396b7bc187</code>
      是下列 内容的SHA1哈希值：</p>
      <pre class="literallayout">
"commit 158" NUL
"tree 05b217bb859794d08bb9e4f7f04cbda4b207fbe9" LF
"author Alice &lt;alice@example.com&gt; 1234567890 -0800" LF
"committer Bob &lt;bob@example.com&gt; 1234567890 -0800" LF
LF
"Shakespeare" LF
</pre>

      <p>和前面一样，你可以运行zpipe或者cat-file来自己看。</p>

      <p>这是第一个提交，因此没有父提交，但之后的提交将总有至少一行，指定一个父提交。</p>
    </div>

    <div class="section" title="没那么神">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__67"></a>没那么神</h2>
          </div>
        </div>
      </div>

      <p>Git的秘密似乎太简单。看起来似乎你可以整合几个shell脚本，加几行C代码来弄起来，
      也就几个小时的事：一个基本文件操作和SHA1哈希化的混杂，用锁文件装饰一下，文件
      同步保证健壮性。实际上，这准确描述了Git的最早期版本。尽管如此，除了巧妙地打包
      以节省空间，巧妙地索引以省时间，我们现在知道Git如何灵巧地改造文件系统成为一个 对版本控制完美的数据库。</p>

      <p>例如，如果对象数据库里的任何一个文件由于硬盘错误损毁，那么其哈希值将不再匹配，
      这个错误会报告给我们。通过哈希化其他对象的哈希值，我们在所有层面维护数据完整
      性。Commit对象是原子的，也就是说，一个提交永远不会部分地记录变更：在我们已经
      存储所有相关tree对象，blob对象和父commit对象之后，我们才可以计算提交的的哈希
      值并将其存储在数据库，对象数据库不受诸如停电之类的意外中断影响。</p>

      <p>我们打败即使是最狡猾的对手。假设有谁试图悄悄修改一个项目里一个远古版本文件的
      内容。为使对象据库看起来健康，他们也必须修改相应blob对象的哈希值，既然它现在
      是一个不同的字节串。这意味着他们讲不得不引用这个文件的tree对象的哈希值，并反
      过来改变所有与这个tree相关的commit对象的哈希值，还要加上这些提交所有后裔的哈
      希值。这暗示官方head的哈希值与这个坏仓库不同。通过跟踪不匹配哈希值线索，我
      们可以查明残缺文件，以及第一个被破坏的提交。</p>

      <p>总之，只要20个字节代表最后一次提交的是安全的，不可能篡改一个Git仓库。</p>

      <p>那么Git的著名功能怎样呢？分支？合并？标签？单纯的细节。当前head保存在文件 <code class=
      "literal">.git /HEAD</code>
      ，其中包含了一个commit对象的哈希值。该哈希值在运行提交以及其他命 令是更新。分支几乎一样：它们是保存在
      <code class="literal">.git/refs/heads</code> 的文件。标签也是：它们 住在住在
      <code class="literal">.git/refs/tags</code>
      ，但它们由一套不同的命令更新。</p>
    </div>
  </div><script type="text/javascript" src="find_selflink.js">
</script><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
  </script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1901330-2");
  pageTracker._initData();
  pageTracker._trackPageview();
  </script>
</div>
</div><div class="footer"><a href="/~blynn/">Ben Lynn</a></div>
</body>
</html>
