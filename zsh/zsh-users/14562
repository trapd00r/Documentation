From zsh-users-return-14562-mason-zsh=primenet.com.au@zsh.org Thu Nov 12 19:32:11 2009
Return-Path: <zsh-users-return-14562-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4007 invoked by alias); 12 Nov 2009 19:32:11 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14562
Received: (qmail 7388 invoked from network); 12 Nov 2009 19:32:08 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00,
	UNPARSEABLE_RELAY autolearn=ham version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at yahoo.fr does not designate permitted sender hosts)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.fr;
  h=Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Date:From:To:Cc:Subject:Message-ID:Mail-Followup-To:References:MIME-Version:Content-Type:Content-Disposition:In-Reply-To:User-Agent;
  b=gQJnVcMZPxsWYTCfzApexbcsMKs1ebVqaX7kHgF0rc45OvqVKLd8axl9krvPra3jcxj+VYAtj76o9pBmhR0f0/d3bdfsZAyqSwfcpnwZqOl6qe8MmidTJ+asxOe99jxEudbmS+fIjOLcSdRJJhQanJftuNKXnroQCFgU6mVm1bk=  ;
X-Yahoo-SMTP: V1UR0WuswBDVD1eFhM33188Ir8ciBckz4W8ZMsAh
X-YMail-OSG: LMC0vH8VM1kSDMrW6_bWxep_CUkyAOijT928C9rUTvGl8Pl.ssEVWYCVExO1JKYluWpbNwpDhiO44FLid3lEpIEIqi.ETGxoNx9MeXb2iXWtRqQjg6JyAqHC.Ii0pygt0xKS24RligOfwwJVLBmqf0gbQEeGQ7viCokTYDXhz0l_nVlX1jly6dA41Vrz2MPMEPJC8m_hqwlkgCRp5HXC188YAbaAe7BZ2_vsnKX5QP6jaSEdURqdlAPPTVXcraWyr_KH2tkkN0aw0Rp9GQFyzz_Ya7QY9zzV9qk-
X-Yahoo-Newman-Property: ymail-3
Date: Thu, 12 Nov 2009 19:25:23 +0000
From: Stephane Chazelas <stephane_chazelas@yahoo.fr>
To: "Benjamin R. Haskell" <zsh@benizi.com>
Cc: Zsh Users <zsh-users@zsh.org>
Subject: Re: Using another command's completion function with an alias
Message-ID: <chaz20091112192523.GA4367@seebyte.com>
Mail-Followup-To: "Benjamin R. Haskell" <zsh@benizi.com>,
	Zsh Users <zsh-users@zsh.org>
References: <alpine.LNX.2.01.0911121316020.26715@hp.internal>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <alpine.LNX.2.01.0911121316020.26715@hp.internal>
User-Agent: Mutt/1.5.16 (2007-09-19)

2009-11-12 14:00:56 -0500, Benjamin R. Haskell:
[...]
> alias noagent='env -u SSH_AGENT_PID -u SSH_AUTH_SOCK'
> 
> But, compdef noagent=-command-  doesn't have the desired effect.  I 
> instead get the completion for 'env':
> 
> $ noagent <C-x><h>
> tags in context :completion::complete:-u::
>     all-files  (_files _default (eval))
> tags in context :completion::complete:env::
>     argument-rest  (_arguments _env (eval))
> 
> Obviously my completion-fu is still in its infancy.  Is there something 
> simple to fix the 'alias' version?
[...]

I don't have the answer to that exact question, but I think that
if you used a function instead of an alias, your compdef trick
would work. Like:

noagent() env -u SSH_AGENT_PID -u SSH_AUTH_SOCK "$@"
compdef noagent=-command-

BTW:

Manual> 6.7 Aliasing
Manual> ============
Manual>
Manual> Every token in the shell input is checked to see if there
Manual> is an alias defined for it.  If so, it is replaced by the
Manual> text of the alias if it is in command position (if it
Manual> could be the first word of a simple command), or if the
Manual> alias is global.  If the text ends with a space, the next
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Manual> word in the shell input is treated as though it were in
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Manual> command position for purposes of alias expansion.
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

So you may prefer:

alias noagent='env -u SSH_AGENT_PID -u SSH_AUTH_SOCK '

-- 
Stephane

