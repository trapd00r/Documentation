From zsh-users-return-15036-mason-zsh=primenet.com.au@zsh.org Fri Apr 30 23:06:06 2010
Return-Path: <zsh-users-return-15036-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28907 invoked by alias); 30 Apr 2010 23:06:05 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15036
Received: (qmail 11398 invoked from network); 30 Apr 2010 23:06:04 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at smileystation.com does not designate permitted sender hosts)
Date: Fri, 30 Apr 2010 18:38:57 -0400
From: Omari Norman <omari@smileystation.com>
To: zsh-users@zsh.org
Subject: Bug with trap?
Message-ID: <20100430223857.GA4782@cameron>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.18 (2008-05-17)
X-AntiAbuse: This header was added to track abuse, please include it with any abuse report
X-AntiAbuse: Primary Hostname - hanley.site5.com
X-AntiAbuse: Original Domain - zsh.org
X-AntiAbuse: Originator/Caller UID/GID - [47 12] / [47 12]
X-AntiAbuse: Sender Address Domain - smileystation.com
X-Source: 
X-Source-Args: 
X-Source-Dir: 

It seems that the trap builtin with the EXIT argument does not work
properly if you have a list inside curly braces and the output is piped
to another command. For example:

~ % zsh <<EOF  
trap "echo exit trap running" EXIT
EOF
exit trap running
~ % zsh <<EOF
{ trap "echo exit trap running" EXIT}
EOF
exit trap running
~ % zsh <<EOF
{ trap "echo exit trap running" EXIT} | cat
EOF
~ % 

Thus the trap in the last example simply did not run. You can try this
with another command in the trap (e.g. touch, or rm) and you will get
the same result: the trap does not run.

This is zsh 4.3.6 on Debian 5.0. Is this a bug or am I missing
something?

Thanks.
Omari

