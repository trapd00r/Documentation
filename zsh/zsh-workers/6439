From zsh-workers-return-6439-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Jun 03 01:57:32 1999
Return-Path: <zsh-workers-return-6439-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19521 invoked from network); 3 Jun 1999 01:57:30 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 3 Jun 1999 01:57:30 -0000
Received: (qmail 26327 invoked by alias); 3 Jun 1999 01:57:19 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6439
Received: (qmail 26316 invoked from network); 3 Jun 1999 01:57:18 -0000
Message-Id: <199906030157.SAA09589@bebop.clari.net>
To: "ZSH workers mailing list" <zsh-workers@sunsite.auc.dk>
Subject: PATCH: 3.0.6-pre-3: minor tweaks after last patch
Date: Wed, 02 Jun 1999 18:57:16 -0700
From: Wayne Davison <wayne@clari.net>

These simple changes follow-up my just-released patch for 3.0.6-pre-3:

I failed to include a minor tweak from my history changes that made
the hasher() function use a slightly different character-casting
syntax (since I have a dim recollection that the new way avoids a
sign-extension problem on certain systems).

Also, I failed to notice that I left a trailing period on a couple
of debug error messages (the new strings now match pws-20).

..wayne..

---8<------8<------8<------8<---cut here--->8------>8------>8------>8---
--- zsh-3.0.5/Src/hashtable.c	Wed Jun  2 18:14:21 1999
+++ ./Src/hashtable.c	Wed Jun  2 18:36:41 1999
@@ -42,7 +42,7 @@
     unsigned hashval = 0;
 
     while (*str)
-	hashval += (hashval << 5) + ((unsigned) *str++);
+	hashval += (hashval << 5) + *(unsigned char *)str++;
 
     return hashval;
 }
--- zsh-3.0.5/Src/hist.c	Wed Jun  2 18:14:22 1999
+++ ./Src/hist.c	Wed Jun  2 18:37:25 1999
@@ -834,12 +834,12 @@
     /* debugging only */
     if (hwgetword == -1 && !chwordpos) {
 	/* no words available */
-	DPUTS(1, "BUG: hwget() called with no words.");
+	DPUTS(1, "BUG: hwget() called with no words");
 	*startptr = "";
 	return;
     } 
     else if (hwgetword == -1 && chwordpos%2) {
-	DPUTS(1, "BUG: hwget() called in middle of word.");
+	DPUTS(1, "BUG: hwget() called in middle of word");
 	*startptr = "";
 	return;
     }
---8<------8<------8<------8<---cut here--->8------>8------>8------>8---

