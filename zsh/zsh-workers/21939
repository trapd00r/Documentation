From zsh-workers-return-21939-mason-zsh=primenet.com.au@sunsite.dk Wed Oct 26 09:59:35 2005
Return-Path: <zsh-workers-return-21939-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26128 invoked from network); 26 Oct 2005 09:59:33 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 26 Oct 2005 09:59:33 -0000
Received: (qmail 68838 invoked from network); 26 Oct 2005 09:59:26 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 26 Oct 2005 09:59:26 -0000
Received: (qmail 4679 invoked by alias); 26 Oct 2005 09:59:24 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21939
Received: (qmail 4665 invoked from network); 26 Oct 2005 09:59:23 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 26 Oct 2005 09:59:23 -0000
Received: (qmail 68563 invoked from network); 26 Oct 2005 09:59:23 -0000
Received: from cluster-c.mailcontrol.com (HELO rly09c.srv.mailcontrol.com) (168.143.177.190)
  by a.mx.sunsite.dk with SMTP; 26 Oct 2005 09:59:23 -0000
Received: from exchange03.csr.com (mailhost1.csr.com [81.105.217.43])
	by rly09c.srv.mailcontrol.com (MailControl) with ESMTP id j9Q9xKNS030511
	for <zsh-workers@sunsite.dk>; Wed, 26 Oct 2005 10:59:20 +0100
Received: from news01.csr.com ([10.103.143.38]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Wed, 26 Oct 2005 11:01:38 +0100
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.1/8.12.11) with ESMTP id j9Q9xIRd018882
	for <zsh-workers@sunsite.dk>; Wed, 26 Oct 2005 10:59:19 +0100
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.1/8.13.1/Submit) with ESMTP id j9Q9xISV018878
	for <zsh-workers@sunsite.dk>; Wed, 26 Oct 2005 10:59:18 +0100
Message-Id: <200510260959.j9Q9xISV018878@news01.csr.com>
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: PATCH: unmetacheck revisited
Date: Wed, 26 Oct 2005 10:59:18 +0100
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 26 Oct 2005 10:01:38.0103 (UTC) FILETIME=[41616470:01C5DA14]
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A-05-40-01 (www.mailcontrol.com) on 10.67.0.119
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.4

I was too pessimistic about the check for an unmetafied line on a call
to zle: the case I was really worried about was an otherwise successful
call to a widget.  Otherwise you can get unnecessary warnings with
a redisplay etc.

Index: Src/Zle/zle_thingy.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_thingy.c,v
retrieving revision 1.20
diff -u -r1.20 zle_thingy.c
--- Src/Zle/zle_thingy.c	23 Oct 2005 17:43:00 -0000	1.20
+++ Src/Zle/zle_thingy.c	26 Oct 2005 09:57:03 -0000
@@ -358,8 +358,6 @@
     struct opn const *op, *opp;
     int n;
 
-    UNMETACHECK();
-
     /* select operation and ensure no clashing arguments */
     for(op = opns; op->o && !OPT_ISSET(ops,STOUC(op->o)); op++) ;
     if(op->o)
@@ -659,6 +657,8 @@
 	return 1;
     }
 
+    UNMETACHECK();
+
     while (*args && **args == '-') {
 	char *num;
 	if (!args[0][1] || args[0][1] == '-') {

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


This message has been scanned for viruses by BlackSpider MailControl - www.blackspider.com

