From zsh-users-return-10860-mason-zsh=primenet.com.au@sunsite.dk Fri Oct 13 12:18:39 2006
Return-Path: <zsh-users-return-10860-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26166 invoked from network); 13 Oct 2006 12:18:33 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.6 (2006-10-03) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.6
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 13 Oct 2006 12:18:33 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 68019 invoked from network); 13 Oct 2006 12:18:26 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 13 Oct 2006 12:18:26 -0000
Received: (qmail 10773 invoked by alias); 13 Oct 2006 12:18:18 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10860
Received: (qmail 10763 invoked from network); 13 Oct 2006 12:18:17 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 13 Oct 2006 12:18:17 -0000
Received: (qmail 66876 invoked from network); 13 Oct 2006 12:18:17 -0000
Received: from s1tank.virtdom.com (216.240.101.50)
  by a.mx.sunsite.dk with SMTP; 13 Oct 2006 12:18:09 -0000
Received: (qmail 25507 invoked by uid 89); 13 Oct 2006 13:17:06 -0000
Received: from ool-44c5ae3c.dyn.optonline.net (HELO venti) (brian@aljex.com@68.197.174.60)
  by s1tank.virtdom.com with SMTP; 13 Oct 2006 13:17:06 -0000
Message-ID: <041001c6eec1$9f346df0$6400000a@venti>
From: "Brian K. White" <brian@aljex.com>
To: <zsh-users@sunsite.dk>
References: <F7507090F1A72B43A51444325DFBE43101391E41@MCHP7R6A.ww002.siemens.net> <200610121216.28334.cht@chello.at>
Subject: Re: logout from interactive subshell
Date: Fri, 13 Oct 2006 08:17:59 -0400
Organization: Aljex Software
MIME-Version: 1.0
Content-Type: text/plain;
	format=flowed;
	charset="iso-8859-1";
	reply-type=original
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.2869
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.2962


----- Original Message ----- 
From: "Christian Taylor" <cht@chello.at>
To: <zsh-users@sunsite.dk>
Sent: Thursday, October 12, 2006 6:16 AM
Subject: Re: logout from interactive subshell


>> A typical application would go like this:
>>
>>    rlogin foobar
>>    DO SOME STUFF
>>    cleartool setview myview # this creates a subshell
>>    DO MORE STUFF
>>    cleartool setview yourview # now I'm two subshells deep
>>    DO STILL MORE STUFF
>>    # Now I want to exit
>>    exit
>>    exit
>>    logout
>>
>> I would like to have a (interactive) command which does the final two
>> exits plus
>> a logout for me.
>
> I don't know how to do exactly what you have in mind, but I can think of 
> two
> methods that may be of use to you. Both should (usually) work independent 
> of
> which shell you use. The second is close to what you asked for.
>
> 1. Shortcut
> You can hit "^D" instead of typing exit (or logout) to terminate the 
> current
> shell. If you are three subshells deep, holding Ctrl and hitting "d" three
> times is quite a lot faster, but you still have to keep track of how many
> subshells you want to exit.
>
> 2. Screen
> After you log into the remote box, start a screen session (simply
> type "screen"). Proceed to do your stuff. After you're done, hit "^A"
> followed by "k". Screen will ask you to confirm and then terminates all 
> your
> subshells, as well as itself.
> To logout automatically as well, I suggest you create an alias for the
> command "screen; logout" and run that after login.
>
> (Screen is capable of much more, have a look at the man page if you're
> interested.)
>
> hope this helps,
> Christian

These answers come the closest to sanity in my opinion.
They don't exactly do what he wants but the fault lies in the request not in 
the shell or anyones knowledge of how to use it.

I'd have said there is no answer. Ultimately there is no way for any given 
process to know how far you mean when you say you want to log "all the way 
out" except it would/should be possible to say "all the way off this host" 
by talking to the daemon you logged in via. In fact that is possible but 
it's not garunteed to always work completely and there is one desireable 
level of control missing. (or, if what I'm about to describe is possible I 
hope to hear about it :)

rlogin, ssh, & telnet all support an escape character similar to classic cu.
Sometimes it's optional and not used by default, and it takes different 
forms between say telnet & ssh, but in some form, if desired, it's always 
available as an option.

In the case of ssh, On a new line (or hit enter blindly if you're terminal 
is messed up) type ~.
and you are disconnected from the ssh session.
sshd on the remote host then sends a HUP to all child processes of that 
session and in a perfect world they all react to this in a sane manner by 
cleaning up shop and exiting.

The problems are:
1) this isn't a perfect world and lots of apps don't die. you'll have to 
just try and see if you are stuck with any like that.
2) if you are connected from host to host to host, this breaks your closest 
connection, not your furthest one.
In a perfect world again, this does end up cleanly breaking all the 
subsequent connections and killing all the child processes on the the whole 
train of hosts all in one easy shot. Maybe thats what you wanted, in which 
case, fine, problem solved.

But if you only want to back out of your lest leg of the chain of 
connections and not destroy the whole chain, I don't know how to do that 
except by manually specifying a different escape character or sequence for 
each new connection, so the the escape code for one connection gets ignored 
and passed along as ordinary data by all the rest.

The I think it's outside the shells area of responsibility to even attempt 
to keep track of such things.

Brian K. White  --  brian@aljex.com  --  http://www.aljex.com/bkw/
+++++[>+++[>+++++>+++++++<<-]<-]>>+.>.+++++.+++++++.-.[>+<---]>++.
filePro  BBx    Linux  SCO  FreeBSD    #callahans  Satriani  Filk!

