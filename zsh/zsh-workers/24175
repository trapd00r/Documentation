From zsh-workers-return-24175-mason-zsh=primenet.com.au@sunsite.dk Fri Dec 07 10:36:15 2007
Return-Path: <zsh-workers-return-24175-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25610 invoked from network); 7 Dec 2007 10:36:06 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 7 Dec 2007 10:36:06 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 1261 invoked from network); 7 Dec 2007 10:36:02 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 Dec 2007 10:36:02 -0000
Received: (qmail 12631 invoked by alias); 7 Dec 2007 10:35:58 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24175
Received: (qmail 12618 invoked from network); 7 Dec 2007 10:35:58 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 7 Dec 2007 10:35:58 -0000
Received: (qmail 891 invoked from network); 7 Dec 2007 10:35:58 -0000
Received: from cluster-g.mailcontrol.com (85.115.41.190)
  by a.mx.sunsite.dk with SMTP; 7 Dec 2007 10:35:52 -0000
Received: from rly08g.srv.mailcontrol.com (localhost.localdomain [127.0.0.1])
	by rly08g.srv.mailcontrol.com (MailControl) with ESMTP id lB7AZlA0014555
	for <zsh-workers@sunsite.dk>; Fri, 7 Dec 2007 10:35:48 GMT
Received: from submission.mailcontrol.com (submission.mailcontrol.com [86.111.216.190])
	by rly08g.srv.mailcontrol.com (MailControl) id lB7AZbcF014121
	for zsh-workers@sunsite.dk; Fri, 7 Dec 2007 10:35:37 GMT
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly08g-eth0.srv.mailcontrol.com (envelope-sender Peter.Stephenson@csr.com) (MIMEDefang) with ESMTP id lB7AZYaF013625; Fri, 07 Dec 2007 10:35:37 +0000 (GMT)
Received: from news01 ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Fri, 7 Dec 2007 10:35:33 +0000
Date: Fri, 7 Dec 2007 10:35:33 +0000
From: Peter Stephenson <pws@csr.com>
To: Guillaume Chazarain <guichaz@yahoo.fr>,
        "Zsh Hackers' List"
 <zsh-workers@sunsite.dk>
Subject: Re: deadlock caused by gettext usage in a signal handler
Message-ID: <20071207103533.47776664@news01>
In-Reply-To: <20071207000207.2eb7e5e7@inria.fr>
References: <20071130203534.1d1ea29c@inria.fr>
	<20071204203017.35a29727.p.w.stephenson@ntlworld.com>
	<20071207000207.2eb7e5e7@inria.fr>
Organization: CSR
X-Mailer: Claws Mail 3.0.2 (GTK+ 2.10.14; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 07 Dec 2007 10:35:33.0946 (UTC) FILETIME=[E5BD61A0:01C838BC]
X-Scanned-By: MailControl A-06-00-00 (www.mailcontrol.com) on 10.71.1.118

On Fri, 7 Dec 2007 00:02:07 +0100
Guillaume Chazarain <guichaz@yahoo.fr> wrote:
> It appears that glibc's fork is playing with locks:
>
> This patch solved the problem for me:

Thanks for looking at that.  The traditional zsh way is to queue signals
around an operation, but fork() is atomic to the calling code and blocking
should be quicker, so your patch is fine and I've committed it.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

