From zsh-users-return-13718-mason-zsh=primenet.com.au@sunsite.dk Fri Jan 16 16:27:23 2009
Return-Path: <zsh-users-return-13718-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19407 invoked from network); 16 Jan 2009 16:27:19 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Jan 2009 16:27:19 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 95253 invoked from network); 16 Jan 2009 16:27:09 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Jan 2009 16:27:09 -0000
Received: (qmail 16597 invoked by alias); 16 Jan 2009 16:26:53 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13718
Received: (qmail 16580 invoked from network); 16 Jan 2009 16:26:53 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 16 Jan 2009 16:26:53 -0000
Received: from ey-out-2122.google.com (ey-out-2122.google.com [74.125.78.27])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 3C06880271F0
	for <zsh-users@sunsite.dk>; Fri, 16 Jan 2009 17:26:47 +0100 (CET)
Received: by ey-out-2122.google.com with SMTP id 25so183049eya.3
        for <zsh-users@sunsite.dk>; Fri, 16 Jan 2009 08:26:46 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:cc:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=adUxj645jfNcwuv1FPPsQRDrrCcCH/sTlZ/K2mbwgjA=;
        b=sOt351tCu6t3uROzKwJ2pY7Fq8DANMVP4tTQPHnwdZEt7brD8kS0ooeRW1/QKUX5Vi
         N5rgpnTBMKlo8oA9U5Z/8OMW0tcZBtTI4uWXzYpAdMY3qukt9O2VpQNOiFcsbQSIwJ6I
         yE+iiPfh4mx5stPHh1xOerHuxIuvSuIC9AnC0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=cc:message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=w0uKwRdD6Uc0/X3JIiB6d1RpOl1XAd+tT7rMQSD/06ODXPoZmVO6xSlzaG6LQcL8Q4
         SBWMCsPcTWUXNCaE1rlzwSFZlDsNzbN5wFFw2p4wr4OJLmHIpbwGtR82OTzxAVO8cJyK
         g5K2O8YHvztqqqp5U4HNL2sAqw6kbj1Acrc5U=
Received: by 10.210.22.16 with SMTP id 16mr2673716ebv.61.1232123156857;
        Fri, 16 Jan 2009 08:25:56 -0800 (PST)
Received: from mac-g5horrobin.science.uva.nl (mac-g5horrobin.science.uva.nl [146.50.22.179])
        by mx.google.com with ESMTPS id 5sm2559147eyf.57.2009.01.16.08.25.55
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Fri, 16 Jan 2009 08:25:56 -0800 (PST)
Cc: zsh-users@sunsite.dk
Message-Id: <2A4B2637-13CD-46E1-8A92-BF1F71A2FF10@gmail.com>
From: Evert Rol <evert.rol@gmail.com>
To: Peter Stephenson <pws@csr.com>
In-Reply-To: <200901161619.n0GGJ37U024322@news01.csr.com>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v930.3)
Subject: Re: sourcing a sh file in zsh
Date: Fri, 16 Jan 2009 17:25:55 +0100
References: <BD9D2405-AD6A-4336-9C8A-85149165B6B8@gmail.com> <2d460de70901160716ke6e1f86xe49ccc6391feef2d@mail.gmail.com> <09EB3187-4928-4F3D-8B14-427ACA93F790@gmail.com> <200901161619.n0GGJ37U024322@news01.csr.com>
X-Mailer: Apple Mail (2.930.3)
X-Virus-Scanned: ClamAV 0.92.1/8871/Fri Jan 16 05:16:59 2009 on bifrost
X-Virus-Status: Clean

>
>> It turns out the error is indeed not in line #1, but a bit later:
>>
>>   a_temp=`egrep "^[  ]*$a_host[    ]" "$a_root/somefile"`
>>
>> If I change that line to
>>
>>   a_temp=`egrep "^[  ]*${a_host}[    ]" "$a_root/somefile"`
>>
>> the script passes fine, with exit code 0.
>>
>> So perhaps sh/bash are more lenient towards the use of braces in
>> variables. At least a quick'n'dirty test script shows this.
>> I don't know; anyway can comment on that?
>
> It's the opposite: zsh is more lenient about braces, turning  
> $a_host[ ]
> into an array expression with an incorrect subscript.  So your fix is
> fine.  Having "setopt ksharrays" would fix this, and this option is  
> used
> in compatibility modes, so indeed if you were in sh emulation as
> explained by Bart this will work without modification.  The  
> emulation is
> a much better general solution---there are other compatibility issues,
> many of the most important of which are listed in the FAQ
> (http://zsh.dotsrc.org/FAQ/zshfaq02.html#l10).

Brilliant!
Thanks all. I'm happy using zsh, but occasionally these things catch  
me out, and I find there are too many little things to learn about  
than I'm actually willing to, this being one example.
But the ksharrays option and sh emulation I'll try to keep in mind.

   Evert

