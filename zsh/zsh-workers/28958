From zsh-workers-return-28958-mason-zsh=primenet.com.au@zsh.org Wed Mar 30 20:46:22 2011
Return-Path: <zsh-workers-return-28958-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11259 invoked by alias); 30 Mar 2011 20:46:22 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28958
Received: (qmail 13726 invoked from network); 30 Mar 2011 20:46:19 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_NONE,
	SPF_HELO_PASS autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at bewatermyfriend.org does not designate permitted sender hosts)
From: Frank Terbeck <ft@bewatermyfriend.org>
To: zsh-workers@zsh.org
Subject: PATCH: (1/4) vcs_info: Support registering hooks independent of the context
Date: Wed, 30 Mar 2011 22:37:13 +0200
Message-Id: <1301517436-11451-2-git-send-email-ft@bewatermyfriend.org>
X-Mailer: git-send-email 1.7.4.1.140.g89781
In-Reply-To: <1301517436-11451-1-git-send-email-ft@bewatermyfriend.org>
References: <1301517436-11451-1-git-send-email-ft@bewatermyfriend.org>
X-Df-Sender: 430444

---
 Functions/VCS_Info/VCS_INFO_hook |   18 +++++++++++++++---
 1 files changed, 15 insertions(+), 3 deletions(-)

diff --git a/Functions/VCS_Info/VCS_INFO_hook b/Functions/VCS_Info/VCS_INFO_hook
index 7274d72..479f596 100644
--- a/Functions/VCS_Info/VCS_INFO_hook
+++ b/Functions/VCS_Info/VCS_INFO_hook
@@ -2,24 +2,36 @@
 ## Written by Frank Terbeck <ft@bewatermyfriend.org>
 ## Distributed under the same BSD-ish license as zsh itself.
 
-local hook func
+local hook static func
 local -x context hook_name
 local -xi ret
-local -a hooks
+local -a hooks tmp
 local -i debug
 
 ret=0
 hook_name="$1"
 shift
 context=":vcs_info:${vcs}+${hook_name}:${usercontext}:${rrn}"
+static=":vcs_info-static_hooks:${hook_name}"
 
 zstyle -t "${context}" debug && debug=1 || debug=0
 if (( debug )); then
     printf 'VCS_INFO_hook: running hook: "%s"\n' "${hook_name}"
     printf 'VCS_INFO_hook: current context: "%s"\n' "${context}"
+    printf 'VCS_INFO_hook: static context: "%s"\n' "${static}"
 fi
 
-zstyle -a "${context}" hooks hooks || return 0
+zstyle -a "${static}" hooks hooks
+if (( debug )); then
+    printf '+ static hooks: %s\n' "${(j:, :)hooks}"
+fi
+zstyle -a "${context}" hooks tmp
+if (( debug )); then
+    printf '+ context hooks: %s\n' "${(j:, :)tmp}"
+fi
+hooks+=( "${tmp[@]}" )
+(( ${#hooks} == 0 )) && return 0
+
 # Protect some internal variables in hooks. The `-g' parameter to
 # typeset does *not* make the parameters global here (they are already
 # "*-local-export). It prevents typeset from creating *new* *local*
-- 
1.7.4.1.140.g89781

