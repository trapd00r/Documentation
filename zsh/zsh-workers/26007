From zsh-workers-return-26007-mason-zsh=primenet.com.au@sunsite.dk Tue Nov 04 13:01:31 2008
Return-Path: <zsh-workers-return-26007-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6505 invoked from network); 4 Nov 2008 13:01:27 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.7 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 4 Nov 2008 13:01:27 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 54895 invoked from network); 4 Nov 2008 13:01:18 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Nov 2008 13:01:18 -0000
Received: (qmail 28389 invoked by alias); 4 Nov 2008 13:01:13 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26007
Received: (qmail 28370 invoked from network); 4 Nov 2008 13:01:12 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 4 Nov 2008 13:01:12 -0000
Received: from rex11.flatbooster.com (rex11.flatbooster.com [80.82.215.11])
	by bifrost.dotsrc.org (Postfix) with ESMTP id C176880524C0
	for <zsh-workers@sunsite.dk>; Tue,  4 Nov 2008 14:01:06 +0100 (CET)
Received: from [85.216.2.186] (HSI-KBW-085-216-002-186.hsi.kabelbw.de [85.216.2.186])
	by rex11.flatbooster.com (Postfix) with ESMTP id 5E9471AF6C09
	for <zsh-workers@sunsite.dk>; Tue,  4 Nov 2008 14:01:05 +0100 (CET)
Message-ID: <49104781.6010603@bernd-steinhauser.de>
Date: Tue, 04 Nov 2008 14:00:49 +0100
From: Bernd Steinhauser <linux@bernd-steinhauser.de>
User-Agent: Thunderbird 2.0.0.17 (X11/20081020)
MIME-Version: 1.0
To: zsh-workers@sunsite.dk
Subject: Re: zsh-4.3.9 test failure due to localization
References: <490F9DDD.2090801@bernd-steinhauser.de> <20081104094854.31a0a2b5@news01>
In-Reply-To: <20081104094854.31a0a2b5@news01>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: ClamAV 0.92.1/8563/Tue Nov  4 12:08:19 2008 on bifrost
X-Virus-Status: Clean

Thanks, all tests pass now. :)

Regards,
Bernd

Peter Stephenson wrote:
> On Tue, 04 Nov 2008 01:57:01 +0100
> Bernd Steinhauser <linux@bernd-steinhauser.de> wrote:
>> sorry to bother you again with a test failure bug. :)
>> One of the tests fails if the output is localized:
>>
>> ./C05debug.ztst: starting. 
>> ! ./zsh-trapreturn-bug2:5: no such file or directory: ./fdasfsdafd 
>> --- 1 ---- 
>> ! ./zsh-trapreturn-bug2:5: datei oder Verzeichnis nicht gefunden: 
> 
> Thanks, that's worth knowing about.
> 
> We sanitize the locale if it's been tinkered with but starting a new shell
> even with "zsh -f" is particularly susceptible to problems.  Anyway, we
> shouldn't be relying on details of system error messages.
> 
> Index: Test/C05debug.ztst
> ===================================================================
> RCS file: /cvsroot/zsh/zsh/Test/C05debug.ztst,v
> retrieving revision 1.3
> diff -u -r1.3 C05debug.ztst
> --- Test/C05debug.ztst	1 Oct 2008 11:34:48 -0000	1.3
> +++ Test/C05debug.ztst	4 Nov 2008 09:47:46 -0000
> @@ -52,9 +52,15 @@
>  	# Failure
>  	exit 10
>  	HERE
> -  $ZTST_testdir/../Src/zsh -f ./zsh-trapreturn-bug2
> +  $ZTST_testdir/../Src/zsh -f ./zsh-trapreturn-bug2 2>erroutput.dif
> +  mystat=$?
> +  (
> +   setopt extendedglob
> +   print ${"$(< erroutput.dif)"%%:[^:]#: ./fdasfsdafd}
> +  )
> +  (( mystat == 0 ))
>  0: trapreturn handling bug is properly fixed
> -?./zsh-trapreturn-bug2:5: no such file or directory: ./fdasfsdafd
> +>./zsh-trapreturn-bug2:5
>  
>    fn() {
>      setopt localtraps localoptions debugbeforecmd
> 
> 

