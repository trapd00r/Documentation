From zsh-workers-return-7713-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Sep 08 08:27:41 1999
Return-Path: <zsh-workers-return-7713-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1543 invoked from network); 8 Sep 1999 08:27:39 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 8 Sep 1999 08:27:39 -0000
Received: (qmail 4728 invoked by alias); 8 Sep 1999 08:27:22 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7713
Received: (qmail 4721 invoked from network); 8 Sep 1999 08:27:21 -0000
Date: Wed, 8 Sep 1999 10:27:16 +0200 (MET DST)
Message-Id: <199909080827.KAA05096@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 08 Sep 1999 07:58:06 +0900
Subject: Re: PATCH: Completion/User/_cvs again.


Tanaka Akira wrote:

> Also, I found that `cvs diff <TAB>' causes core dump.
> 
> Z(2):akr@is27e1u11% Src/zsh -f                          
> is27e1u11% bindkey -e; fpath=($PWD/Completion/*(/)); autoload -U compinit; compinit -D; compdef _tst tst
> is27e1u11% compconf group_matches=yes message_format='%d' description_format='%d' describe_options=yes   
> is27e1u11% cvs diff zsh: segmentation fault (core dumped)  Src/zsh -f

Whoa! `bslashquote()' used a static buffer -- too short for long lists 
like these (called via the `(q)' param flag).

Bart: `bslashquote()' is basically the `quotename()' from zle_tricky.c,
      I think we should change it there, too.


Bye
 Sven

diff -u os/utils.c Src/utils.c
--- os/utils.c	Tue Sep  7 13:15:41 1999
+++ Src/utils.c	Wed Sep  8 10:15:50 1999
@@ -2963,7 +2963,8 @@
 bslashquote(const char *s, char **e, int instring)
 {
     const char *u, *tt;
-    char *v, buf[PATH_MAX * 2];
+    char *v;
+    VARARR(char, buf, 2 * strlen(s) + 1);
     int sf = 0;
 
     tt = v = buf;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

