From zsh-workers-return-12885-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Oct 04 13:52:28 2000
Return-Path: <zsh-workers-return-12885-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21057 invoked from network); 4 Oct 2000 13:52:26 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 4 Oct 2000 13:52:26 -0000
Received: (qmail 2867 invoked by alias); 4 Oct 2000 13:52:12 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12885
Received: (qmail 2860 invoked from network); 4 Oct 2000 13:52:11 -0000
Date: Wed, 4 Oct 2000 15:52:09 +0200 (MET DST)
Message-Id: <200010041352.PAA10341@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "E. Jay Berkenbilt"'s message of Wed, 13 Sep 2000 13:06:51 -0400
Subject: PATCH: Re: 3.1.9-dev-6 completion problem: `a | b`


E. Jay Berkenbilt wrote:

> If I say any of the following:
> 
> a | TAB
> `TAB
> a; TAB
> `a; TAB
> 
> I get a list of commands.  However, if I say
> 
> `a | TAB
> 
> I get a list of files.  In fact, even if I say
> 
> `a | junkTAB
> 
> I get a list of files.  I haven't studied the code enough to know what
> the problem is.  Changing ` to $( in all above cases does not change
> the behavior.

Ah, my favorite pastime: fiddling with get_comp_string(). Urgh.

It appears that this was a bad interaction with the code for control
structures. When reaching the word the cursor is on, it tested if it
had reached that before and if it had, it stopped looking
further. This was wrong when it was working on a `...` or $(...) string.

Bye
 Sven

Index: Src/Zle/zle_tricky.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_tricky.c,v
retrieving revision 1.20
diff -u -r1.20 zle_tricky.c
--- Src/Zle/zle_tricky.c	2000/08/29 08:21:00	1.20
+++ Src/Zle/zle_tricky.c	2000/10/04 13:51:47
@@ -1158,6 +1158,7 @@
 		line[ll + addedx] = '\0';
 	    }
 	    lexrestore();
+	    tt = NULL;
 	    goto start;
 	}
     }

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

