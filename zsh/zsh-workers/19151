From zsh-workers-return-19151-mason-zsh=primenet.com.au@sunsite.dk Sun Sep 28 16:20:25 2003
Return-Path: <zsh-workers-return-19151-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15273 invoked from network); 28 Sep 2003 16:20:25 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 28 Sep 2003 16:20:25 -0000
Received: (qmail 10605 invoked by alias); 28 Sep 2003 16:20:05 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19151
Received: (qmail 10562 invoked from network); 28 Sep 2003 16:20:03 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 28 Sep 2003 16:20:03 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [216.254.112.142] by sunsite.dk (MessageWall 1.0.8) with SMTP; 28 Sep 2003 16:20:0 -0000
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id F327F70088; Sun, 28 Sep 2003 12:19:59 -0400 (EDT)
Date: Sun, 28 Sep 2003 12:19:59 -0400
From: Clint Adams <clint@zsh.org>
To: zsh-workers@sunsite.dk
Subject: PATCH: $SECS
Message-ID: <20030928161959.GA29645@acolyte.scowler.net>
References: <20020430185259.GA2825@dman.com> <21763.1020245894@csr.com> <20020526215840.GA15122@dman.com> <23146.1064741224@athlon>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <23146.1064741224@athlon>
User-Agent: Mutt/1.5.4i

> Any chance we could have some documentation for this? I take it that the
> first argument is the strftime format and the second is the number of
> seconds since the epoch. Would be nice if the second argument was
> optional and defaulted to the current time.

With the following patch, you can do

strftime "%d-%m-%y" $SECS

Is it worth having the second argument be optional?  Is SECS too generic
a name?

Index: Src/Modules/datetime.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/datetime.c,v
retrieving revision 1.3
diff -u -r1.3 datetime.c
--- Src/Modules/datetime.c	27 Aug 2002 21:10:34 -0000	1.3
+++ Src/Modules/datetime.c	28 Sep 2003 16:16:56 -0000
@@ -63,10 +63,21 @@
     return 0;
 }
 
+static zlong
+getcurrentsecs()
+{
+    return (zlong) time(NULL);
+}
+
 static struct builtin bintab[] = {
     BUILTIN("strftime",    0, bin_strftime,    2,   2, 0, NULL, NULL),
 };
 
+static struct paramdef patab[] = {
+    PARAMDEF("SECS", PM_INTEGER|PM_SPECIAL|PM_READONLY,
+		    NULL, NULL, &getcurrentsecs, NULL),
+};
+
 /**/
 int
 setup_(Module m)
@@ -78,7 +89,9 @@
 int
 boot_(Module m)
 {
-    return !addbuiltins(m->nam, bintab, sizeof(bintab)/sizeof(*bintab));
+    return !(addbuiltins(m->nam, bintab, sizeof(bintab)/sizeof(*bintab)) |
+	     addparamdefs(m->nam, patab, sizeof(patab)/sizeof(*patab))
+	    );
 }
 
 /**/

