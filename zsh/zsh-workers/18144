From zsh-workers-return-18144-mason-zsh=primenet.com.au@sunsite.dk Mon Jan 27 01:45:21 2003
Return-Path: <zsh-workers-return-18144-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8285 invoked from network); 27 Jan 2003 01:45:20 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 27 Jan 2003 01:45:20 -0000
Received: (qmail 19423 invoked by alias); 27 Jan 2003 01:44:51 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18144
Received: (qmail 19409 invoked from network); 27 Jan 2003 01:44:51 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 27 Jan 2003 01:44:51 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [4.46.181.248] by sunsite.dk (MessageWall 1.0.8) with SMTP; 27 Jan 2003 1:44:51 -0000
Received: (from schaefer@localhost)
	by candle.brasslantern.com (8.11.6/8.11.6) id h0R1iqB24327
	for zsh-workers@sunsite.dk; Sun, 26 Jan 2003 17:44:52 -0800
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <1030127014451.ZM24326@candle.brasslantern.com>
Date: Mon, 27 Jan 2003 01:44:51 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.dk
Subject: PATCH: (?) Other misc. I'd like to commit
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

These are edits I've made locally but never committed.  Objections to any
of them?

- Patch discussed in zsh-workers/17989,17993,18000-18003 (long form)
  (I never got a response to 18003)
- Patch discussed in zsh-workers/17755 to allow %{ %} to put bounds
  around a prompt truncation
- Fix a couple of minor typos in zshconfig.ac

diff -ru -x CVS ../zsh-forge/current/Src/init.c ./Src/init.c
--- ../zsh-forge/current/Src/init.c	Thu Nov 14 08:23:06 2002
+++ ./Src/init.c	Sat Dec  7 09:41:51 2002
@@ -897,7 +897,10 @@
     signal_ignore(SIGQUIT);
 #endif
 
-    install_handler(SIGHUP);
+    if (signal_ignore(SIGHUP) == SIG_IGN)
+	opts[HUP] = 0;
+    else
+	install_handler(SIGHUP);
     install_handler(SIGCHLD);
 #ifdef SIGWINCH
     install_handler(SIGWINCH);
diff -ru -x CVS ../zsh-forge/current/Src/prompt.c ./Src/prompt.c
--- ../zsh-forge/current/Src/prompt.c	Wed Aug  7 09:27:32 2002
+++ ./Src/prompt.c	Tue Oct  1 23:52:21 2002
@@ -93,6 +93,10 @@
 
 static int dontcount;
 
+/* Level of %{ / %} surrounding a truncation segment. */
+
+static int trunccount;
+
 /* Strings to use for %r and %R (for the spelling prompt). */
 
 static char *rstring, *Rstring;
@@ -465,6 +469,8 @@
 		}
 		break;
 	    case /*{*/ '}':
+		if (trunccount && trunccount >= dontcount)
+		    return *fm;
 		if (dontcount && !--dontcount) {
 		    addbufspc(1);
 		    *bp++ = Outpar;
@@ -868,7 +874,9 @@
 	bp = ptr;
 	w = bp - buf;
 	fm++;
+	trunccount = dontcount;
 	putpromptchar(doprint, endchar);
+	trunccount = 0;
 	ptr = buf + w;		/* putpromptchar() may have realloc()'d */
 	*bp = '\0';
 
diff -ru -x CVS ../zsh-forge/current/zshconfig.ac ./zshconfig.ac
--- ../zsh-forge/current/zshconfig.ac	Sat May  4 13:14:24 2002
+++ ./zshconfig.ac	Fri Sep 13 10:48:49 2002
@@ -1,5 +1,5 @@
 dnl
-dnl  configure.in: Configure template for zsh.
+dnl  zshconfig.ac: Configure template for zsh.
 dnl  Process this file with autoconf to produce a configure script.
 dnl
 dnl  Copyright (c) 1995-1997 Richard Coleman
@@ -1999,7 +2010,7 @@
 AC_SUBST_FILE(VERSION_MK)dnl
 
 AC_OUTPUT(Config/defs.mk Makefile Doc/Makefile Etc/Makefile Src/Makefile \
-Test/Makefile, \
+Test/Makefile,
 [test -z "$CONFIG_HEADERS" || echo > stamp-h])
 
 eval "zshbin1=${bindir}"

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

