From zsh-users-return-13440-mason-zsh=primenet.com.au@sunsite.dk Mon Nov 10 13:47:47 2008
Return-Path: <zsh-users-return-13440-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5382 invoked from network); 10 Nov 2008 13:47:43 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 10 Nov 2008 13:47:43 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 29239 invoked from network); 10 Nov 2008 13:47:33 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 Nov 2008 13:47:33 -0000
Received: (qmail 19588 invoked by alias); 10 Nov 2008 13:47:16 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13440
Received: (qmail 19577 invoked from network); 10 Nov 2008 13:47:16 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 10 Nov 2008 13:47:16 -0000
Received: from mail.o2.co.uk (vader.london.02.net [82.132.130.150])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 83A8280308BE
	for <zsh-users@sunsite.dk>; Mon, 10 Nov 2008 14:47:10 +0100 (CET)
Received: from sc.homeunix.net (78.105.216.138) by mail.o2.co.uk (8.0.013.3) (authenticated as stephane.chazelas)
        id 4918260B0008F152; Mon, 10 Nov 2008 13:47:01 +0000
Received: from chazelas by sc.homeunix.net with local (Exim 4.69)
	(envelope-from <stephane_chazelas@yahoo.fr>)
	id 1KzX6X-00029X-2M; Mon, 10 Nov 2008 13:46:57 +0000
Date: Mon, 10 Nov 2008 13:46:57 +0000
From: Stephane Chazelas <Stephane_Chazelas@yahoo.fr>
To: lord_fleg@iinet.net.au
Cc: zsh-users@sunsite.dk
Subject: Re: xterm meta and bindkey
Message-ID: <20081110134656.GA8019@sc.homeunix.net>
Mail-Followup-To: lord_fleg@iinet.net.au, zsh-users@sunsite.dk
References: <53737.1226304418@iinet.net.au>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-15
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <53737.1226304418@iinet.net.au>
User-Agent: Mutt/1.5.16 (2007-09-19)
X-Virus-Scanned: ClamAV 0.92.1/8597/Mon Nov 10 12:55:17 2008 on bifrost
X-Virus-Status: Clean

On Mon, Nov 10, 2008 at 05:06:58PM +0900, lord_fleg@iinet.net.au wrote:
[...]
> bindkey '\C-g' describe-key-briefly
> 
> then hit CTRL-g and then when it prompts me hit META-d
> the response is "\M-C" is capitalize-word.
> 
> if i hit CTRL-g and META-<any key at all> i get the same (\M-C) response.
> 
> if i type 'read' and META-d i get the 8 bit character i expect echo'd.
> 
> if i type 'bash' and hit META-d i get the 8 bit character i expect echo'd.
> 
> i'm confused.  anyone got any ideas?
[...]

What do you get if you run

od -tx1

then type <Meta-d> and then <Ctrl-D><Ctrl-D>

What do the "locale" and "locale charmap" commands output for
you?

What do you get if you type: <Meta-d> after having run
strace -p $$ &

My suspicion is that upon <Meta-d>, your terminal doesn't send
the <Meta-d> byte (d | 0x80 == 0xc4) but the utf8 sequence that
corresponds to the unicode character <Meta-d>.

~$ echo -n '\xc4' | recode ..u8 | od -tx1
0000000 c3 84
0000002

And c3 being the <Meta-c> byte.

I wouldn't use Meta this way. I would tell xterm to send <Esc>x
upon <Meta-x> instead of sending the character <meta-x> (or its
utf8 representation). <Meta-i> is the é character in the
iso8859-1 charset but in utf8 does not correspond to any valid
character by itself which is probably why xterm chose to send
the utf8 sequence.

I suspect newer versions of zsh with multibyte charset support
would decode that c3 84 correctly into the <Meta-i> character as
long as you tell it that your terminal talks utf8 (by making
sure locale charmap returns utf8). So it may work as you expect
in newer zsh versions.

-- 
Stéphane

