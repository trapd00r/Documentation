From zsh-users-return-12546-mason-zsh=primenet.com.au@sunsite.dk Mon Feb 11 15:53:07 2008
Return-Path: <zsh-users-return-12546-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4028 invoked from network); 11 Feb 2008 15:53:05 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 11 Feb 2008 15:53:05 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 59430 invoked from network); 11 Feb 2008 15:52:28 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 11 Feb 2008 15:52:28 -0000
Received: (qmail 3455 invoked by alias); 11 Feb 2008 15:52:17 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12546
Received: (qmail 3438 invoked from network); 11 Feb 2008 15:52:17 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 11 Feb 2008 15:52:17 -0000
Received: from cluster-d.mailcontrol.com (cluster-d.mailcontrol.com [217.69.20.190])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 7864B80482A1
	for <zsh-users@sunsite.dk>; Mon, 11 Feb 2008 16:52:09 +0100 (CET)
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly50d.srv.mailcontrol.com (MailControl) with ESMTP id m1BFpx4C023789
	for <zsh-users@sunsite.dk>; Mon, 11 Feb 2008 15:52:07 GMT
Received: from news01 ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Mon, 11 Feb 2008 15:52:01 +0000
Date: Mon, 11 Feb 2008 15:52:00 +0000
From: Peter Stephenson <pws@csr.com>
To: zsh-users@sunsite.dk
Subject: Re: Phil's prompt is not working when LANG is set to UTF-8
Message-ID: <20080211155200.0a8e9ecf@news01>
In-Reply-To: <20080211150709.GA28841@localhost.localdomain>
References: <20080211033116.GD19613@phoenix.nasreddine.info>
	<237967ef0802102301i71dcd71erb1a2993a7f0bd643@mail.gmail.com>
	<20080211092021.GC6965@phoenix.nasreddine.info>
	<20080211130707.7d45f6af@news01>
	<20080211133743.GA28384@phoenix.nasreddine.info>
	<200802111407.m1BE77Lh004330@news01.csr.com>
	<20080211150709.GA28841@localhost.localdomain>
Organization: CSR
X-Mailer: Claws Mail 3.2.0 (GTK+ 2.12.5; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 11 Feb 2008 15:52:01.0113 (UTC) FILETIME=[0A3CA490:01C86CC6]
X-Scanned-By: MailControl A-08-00-01 (www.mailcontrol.com) on 10.68.0.160
X-Virus-Scanned: ClamAV 0.91.2/5775/Mon Feb 11 16:17:14 2008 on bifrost
X-Virus-Status: Clean

On Mon, 11 Feb 2008 16:07:09 +0100
antho.charles@gmail.com wrote:
> I didn't have this problem on Debian etch, but it appears when I
> upgraded to lenny. It's the same problem: if I set LANG to a non utf8
> encoding (fr_FR instead of fr_FR.UTF-8), RPROMPT is good, otherwise
> it's partially on another line and the cusor is after RPROMPT.
> (cf. http://tinyurl.com/3xjeqt)

Sounds like it ought to be fairly reproducible, but it's not happening on
Fedora 8 (and it still sounds suspiciously like the shell is getting duff
information about the environment, though that's certainly not the only
possibility).  I've tried adding multibyte characters to the command line
and complicating the RPROMPT and even adding multibyte characters to that,
but it still works OK.

Are there any particular things on the command line, forms of RPROMPT etc.
etc. that show this up?  (We really need something that narrows this down.)

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

