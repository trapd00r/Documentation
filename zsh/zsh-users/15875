From zsh-users-return-15875-mason-zsh=primenet.com.au@zsh.org Wed Mar 16 12:59:11 2011
Return-Path: <zsh-users-return-15875-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20125 invoked by alias); 16 Mar 2011 12:59:11 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15875
Received: (qmail 16437 invoked from network); 16 Mar 2011 12:59:09 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.0 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE autolearn=ham
	version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.220.171 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:in-reply-to:references:date
         :message-id:subject:from:to:cc:content-type;
        bh=JUKDoqExXFy1ELZcQgb33r7NPdHhfR1OC1P03LNusr8=;
        b=IBRTH9uLRA1SvGtstPjjbipGF5khHBXdPuhI/33jrpGnVXHKPQmA2gFuPj0w8skX+8
         uz+v85vdl6+F91VXO1IwAub14GPFatBAeL/fzQMzq7dcHw7fF2Z9EcZlM6L7Cuj9kmnB
         26sG+e9XV2KlCCl4PruMzr3mqbpX5Y1JthDQ8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :cc:content-type;
        b=Wg+B4/bVEls2k0u0HRmYcC8+DGIoqeRgA34H61AcT4UNz2maYTwvnp7U4YTX2BQAfl
         DF/XzK/xonFwEeGpnAMNE/3TyWeiY3LQVKcBE3NZ0zp0szcxCaewwUMD5efe4lPHR3H4
         U+t5ghoMY9qlvYiJK5CkyRRtl/EKqw82cclhg=
MIME-Version: 1.0
In-Reply-To: <20110315223435.GD2096@debian>
References: <20110315223435.GD2096@debian>
Date: Wed, 16 Mar 2011 13:31:43 +0100
Message-ID: <AANLkTinhw4LA929ss55uqAmPTBzQphZtwyGBa13Q1993@mail.gmail.com>
Subject: Re: completion for gpg not working
From: Mikael Magnusson <mikachu@gmail.com>
To: Philipp Hartwig <philipp.hartwig@uni-due.de>
Cc: zsh-users@zsh.org
Content-Type: text/plain; charset=UTF-8

On 15 March 2011 23:34, Philipp Hartwig <philipp.hartwig@uni-due.de> wrote:
> Hello,
>
> I'm using zsh 4.3.11-4 from Debian.
>
> With zsh -f and then
>
> $ autoload -Uz compinit
> $ compinit
> $ zstyle ':completion:*' completer _complete _approximate
>
> typing
>
> $ gpg --ver<tab>
>
> "completes" to
>
> $ gpg --armor
> zsh: do you wish to see all 217 possibilities (78 lines)?
>
> The _gpg completion file distributed with Debian is identical to the one
> distributed with the official Zsh 4.3.11.
>
> It would be great if this could be fixed.


http://cgit.mika.l3ib.org/cgit/zsh-cvs/patch/?id=223537ef09490f5fdeba8941a058047755c658cf

diff --git a/Completion/Unix/Command/_gpg b/Completion/Unix/Command/_gpg
index 3f86411..3043f7a 100644
--- a/Completion/Unix/Command/_gpg
+++ b/Completion/Unix/Command/_gpg
@@ -193,15 +193,15 @@ gpgextra=('--decrypt-files[decrypt multiple files]'

 case "$service" in
   gpg)
-    _arguments -C -s -S -A "-*" $gpgbasic $gpgextra $gpgv '*:args:->args'
+    _arguments -C -s -S -A "-*" $gpgbasic $gpgextra $gpgv
'*:args:->args' && ret=0
     ;;

   gpgv)
-    _arguments -C -s -S -A "-*" $gpgv '*:args:->args'
+    _arguments -C -s -S -A "-*" $gpgv '*:args:->args' && ret=0
     ;;

   gpg-zip)
-    _arguments -C -s -S -A "-*" $gpgbasic $gpgzip '*:args:->args'
+    _arguments -C -s -S -A "-*" $gpgbasic $gpgzip '*:args:->args' && ret=0
     ;;
 esac

-- 
Mikael Magnusson

