From zsh-users-return-4405-mason-zsh=primenet.com.au@sunsite.dk Fri Oct 19 16:38:49 2001
Return-Path: <zsh-users-return-4405-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26952 invoked from network); 19 Oct 2001 16:38:47 -0000
Received: from unknown (HELO sunsite.dk) (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 19 Oct 2001 16:38:47 -0000
Received: (qmail 1938 invoked by alias); 19 Oct 2001 16:38:21 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4405
Received: (qmail 1926 invoked from network); 19 Oct 2001 16:38:20 -0000
Date: Fri, 19 Oct 2001 18:38:18 +0200
To: zsh-users <zsh-users@sunsite.dk>
Subject: Re: Number of jobs in prompt
Message-ID: <20011019183818.A15827@Amber.lab.icm.edu.pl>
Mail-Followup-To: zsh-users <zsh-users@sunsite.dk>
References: <20011018234853.C5311@strindberg.maisel.enst-bretagne.fr> <20011019000105.A13783@Amber.lab.icm.edu.pl> <20011019112509.B2300@strindberg.maisel.enst-bretagne.fr> <3BCFF6C6.D38F9CCC@yahoo.co.uk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <3BCFF6C6.D38F9CCC@yahoo.co.uk>
User-Agent: Mutt/1.3.23i
X-PGP: 1024D/D619540D; A0E5 7DA4 56B5 8171 42FA  8F8F BED1 B3E7 D619 540D; 2000-03-17 -- 2002-03-17
From: Michal Politowski <mpol@charybda.icm.edu.pl>

On Fri, 19 Oct 2001 10:47:50 +0100, Oliver Kiddle wrote:
> Jesper Holmberg wrote:
> > 
> > * On Fri Oct 19, Michal Politowski wrote:
> > > have in my prompt the sequence:
> > > %(1v.(bg %v%).)
> > >
> > > and have the following precmd defined:
> > > precmd() { psvar[1]=$#jobtexts; [[ $#jobtexts -eq 0 ]] && psvar[1]=(); }
> > 
> > I don't think I understand this solution, and my initial attempts to
> > implement it have been unsuccessful. But I'll take a look at it during
> > the weekend. Thanks.
> 
> An easier solution to understand would be to use setopt promptsubst and include '$#jobtexts' in your PS1 parameter. $#jobtexts expands to the number of elements in the jobtexts array so will give you the number of jobs.

Yes. I guess I should have written it explicitely instead of presenting my
solution.

> Michal's solution is a bit more clever as it only puts the number of jobs in the prompt if there are more than zero jobs. To do this he uses a ternary expression to test the contents of the psvar array which is set to $#jobtexts from the precmd() function.

Actually with promptsubst I could use
${${${#jobtexts}:#0}/?*/(bg $#jobtexts)}
which looks even more unparsable than the original, but leaves psvar and
precmd free.
I even think I'll make the change.

> Would it be a good idea to add a %j prompt expansion and j test character to prompt expansion to make this easier?

I can say, I'd use it instead of my inventions.

-- 
Michal Politowski -- mpol@lab.icm.edu.pl
Warning: this is a memetically modified message

