From zsh-workers-return-21403-mason-zsh=primenet.com.au@sunsite.dk Wed Jul 06 15:41:35 2005
Return-Path: <zsh-workers-return-21403-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22591 invoked from network); 6 Jul 2005 15:41:34 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 6 Jul 2005 15:41:34 -0000
Received: (qmail 64531 invoked from network); 6 Jul 2005 15:41:29 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 6 Jul 2005 15:41:29 -0000
Received: (qmail 22693 invoked by alias); 6 Jul 2005 15:41:26 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21403
Received: (qmail 22684 invoked from network); 6 Jul 2005 15:41:26 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 6 Jul 2005 15:41:26 -0000
Received: (qmail 64245 invoked from network); 6 Jul 2005 15:41:26 -0000
Received: from vms046pub.verizon.net (206.46.252.46)
  by a.mx.sunsite.dk with SMTP; 6 Jul 2005 15:41:17 -0000
Received: from candle.brasslantern.com ([71.116.88.149])
 by vms046.mailsrvcs.net
 (Sun Java System Messaging Server 6.2 HotFix 0.04 (built Dec 24 2004))
 with ESMTPA id <0IJ700M9IQ8QD9Q3@vms046.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Wed, 06 Jul 2005 10:41:15 -0500 (CDT)
Received: from candle.brasslantern.com (IDENT:schaefer@localhost [127.0.0.1])
	by candle.brasslantern.com (8.12.11/8.12.11) with ESMTP id j66FfEnR014536	for
 <zsh-workers@sunsite.dk>; Wed, 06 Jul 2005 08:41:14 -0700
Received: (from schaefer@localhost)	by candle.brasslantern.com
 (8.12.11/8.12.11/Submit) id j66FfDsb014535	for zsh-workers@sunsite.dk; Wed,
 06 Jul 2005 08:41:13 -0700
Date: Wed, 06 Jul 2005 15:41:12 +0000
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: email to zsh
In-reply-to: <200507060950.j669oQlo014789@news01.csr.com>
To: zsh-workers@sunsite.dk (Zsh hackers list)
Message-id: <1050706154112.ZM14534@candle.brasslantern.com>
MIME-version: 1.0
X-Mailer: Z-Mail (5.0.0 30July97)
Content-type: text/plain; charset=us-ascii
References: <9CCCEC33-E17A-4C35-B51E-E41231ABE9BA@softhome.net>
	<200507011444.j61EiuMN021566@news01.csr.com>
	<200507060950.j669oQlo014789@news01.csr.com>
Comments: In reply to Peter Stephenson <pws@csr.com>        "Re: email to zsh"
 (Jul  6, 10:50am)
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On Jul 6, 10:50am, Peter Stephenson wrote:
} Subject: Re: email to zsh
}
} Peter Stephenson wrote:
} This seems to fix the problem, and allow the completion to work as
} expected, though I haven't a clue what the code I've fixed is doing.

As best I can tell, ow and w are supposed to bound a region of the
original string (from the command line) that is being added as a match;
add_match_str() sets up the fragment that matched the pattern, and
add_match_sub() sets up the fragment that should be inserted into the
command line to replace it (which in this case is the original text,
so the calls are the same).

sfx indicates whether this is a prefix or suffix match.  In that case
w should be tracking backwards from ow towards the beginning of the
string, otherwise w should be tracking forwards from ow.  At the end
of the inner loop ow = w is assigned, so the only way they ever move
apart is if one of the "continue" statements is hit.

So if you arrive at this point with (sfx && w > ow) || (!sfx && ow > w)
then there has already been an error somewhere else, and all that this
patch will do is mask that error to prevent a crash.

I don't have time right now to look at it any more closely ...

