From zsh-workers-request@euclid.skiles.gatech.edu  Tue Jan 16 02:09:19 1996
Received: from euclid.skiles.gatech.edu (euclid.skiles.gatech.edu [130.207.146.50]) by werple.net.au (8.7/8.7.1) with ESMTP id CAA22966 for <mason@werple.mira.net.au>; Tue, 16 Jan 1996 02:09:15 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id JAA23813; Mon, 15 Jan 1996 09:42:24 -0500 (EST)
Resent-Date: Mon, 15 Jan 1996 09:42:24 -0500 (EST)
From: Geoff Wing <mason@werple.net.au>
Message-Id: <199601151442.BAA21834@werple.net.au>
Subject: zle_refresh.c patch on beta13
To: zsh-workers@math.gatech.edu (zsh-list)
Date: Tue, 16 Jan 1996 01:42:06 +1100 (EST)
X-Mailer: ELM [version 2.4 PL23]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"PhiF71.0._p5.GVc-m"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/737
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Heyla, this should (hopefully) fix the problems with line refresh.
It's a diff on zle_refresh.c with beta13.
am_char has been removed and nbuf is accessed directly.

44c44
<    any queries about updates to mason@werple.mira.net.au */
---
>    any queries about updates to mason@werple.apana.org.au */
58a59
> static char am_char = ' ';	/* first col char if needed for automargin  */
105c106
<     if (showinglist > 0)
---
>     if(showinglist > 0)
174c175
<     if (inlist)
---
>     if(inlist)
409c410
<     if (showinglist == -2 || (showinglist > 0 && showinglist < nlnct)) {
---
>     if(showinglist == -2 || (showinglist > 0 && showinglist < nlnct)) {
415c416
<     if (showinglist == -1)
---
>     if(showinglist == -1)
482c483,487
< /* 3: main display loop - write out the buffer using whatever tricks we can */
---
> /* 3: set character for first column, in case automargin stuff needs doing:
>    to begin with, this is the first char of the old screen line, if any. */
>     am_char = *ol ? *ol : *nl;
> 
> /* 4: main display loop - write out the buffer using whatever tricks we can */
492,493c497
< 		if (tccan(TCCLEAREOL) && (char_ins >= tclen[TCCLEAREOL]) &&
< 	    	    (!hasam || ln == nlnct - 1))
---
> 		if (tccan(TCCLEAREOL) && (char_ins >= tclen[TCCLEAREOL]))
601,604c605
< 	    if ((vln < nlnct - 1) && *nbuf[vln + 1])
< 		putc(*nbuf[vln + 1], shout);
< 	    else
< 		putc(' ', shout);
---
> 	    putc(am_char, shout);
609a611
>     am_char = ' ';

-- 
Mason [G.C.W]  mason@werple.mira.net.au    "Hurt...Agony...Pain...LOVE-IT"

