From zsh-workers-return-27400-mason-zsh=primenet.com.au@zsh.org Thu Nov 12 21:16:41 2009
Return-Path: <zsh-workers-return-27400-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25409 invoked by alias); 12 Nov 2009 21:16:41 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 27400
Received: (qmail 19497 invoked from network); 12 Nov 2009 21:16:37 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at exherbo.org does not designate permitted sender hosts)
Content-Type: text/plain; charset=utf8
Subject: Re: [PATCH] env completion: add missing explanation of --unset option, fixes alignment of completed arguments
From: Ingmar Vanhassel <ingmar@exherbo.org>
To: zsh-workers <zsh-workers@zsh.org>
In-reply-to: <alpine.LNX.2.01.0911121548300.26715@hp.internal>
References: <alpine.LNX.2.01.0911121446150.26715@hp.internal> <1258056819-4409-1-git-send-email-ingmar@exherbo.org> <alpine.LNX.2.01.0911121548300.26715@hp.internal>
Date: Thu, 12 Nov 2009 22:16:25 +0100
Message-Id: <1258060512-sup-2464@cannonball>
User-Agent: Sup/git
Content-Transfer-Encoding: 8bit

Excerpts from Benjamin R. Haskell's message of Thu Nov 12 21:52:50 +0100 2009:
> On Thu, 12 Nov 2009, Ingmar Vanhassel wrote:
> 
> > ---
> >  Completion/Unix/Command/_env |    2 +-
> >  1 files changed, 1 insertions(+), 1 deletions(-)
> > 
> > I was getting a few patch series ready to send, but I guess I can fire this one
> > off already, it probably fixes your issue.
> > 
> > What I've not figured out, is how to make 'env FOO=bar quux <TAB>' complete
> > options to 'quux'. I guess that'll take someone with more experience than me.
> 
> Took a hint from _xargs...  Attached patch incorporates:

Thanks :)

> 1. my fix to allow multiple '-u/--unset=' args
> 2. Ingmar's documentation fix
> 3. the fix to complete arguments to the command passed to 'env'

This doesn't fix 'env FOO=bar quux <TAB>' here.

> Does not include the '(--unset= -u)' Ingmar had prepended to the '-u' 
> line.  (I think that would explicitly prevent multiple -u/--unset args.)
> 
> Best,
> Ben
> Index: Completion/Unix/Command/_env
> ===================================================================
> RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_env,v
> retrieving revision 1.1
> diff -u -r1.1 _env
> --- Completion/Unix/Command/_env        13 Apr 2006 02:46:50 -0000        1.1
> +++ Completion/Unix/Command/_env        12 Nov 2009 20:47:25 -0000
> @@ -3,9 +3,10 @@
>  if _pick_variant gnu=Free\ Soft unix --version; then
>    _arguments \
>      '(--ignore-environment -i)'{-i,--ignore-environment}'[start with empty
> environment]' \
> -    {-u,--unset=}':env var to remove:compadd ${(k)parameters[(R)*export*]}' \
> +    '*'{-u,--unset=}'[remove variable from the environment]:env var to
> remove:compadd ${(k)parameters[(R)*export*]}' \
>      '--help[help]' \
>      '--version[version]' \
> +    '(-):command: _command_names -e' \
>      '*::arguments: _normal'
>  else
>    _precommand
-- 
Exherbo KDE, X.org maintainer

