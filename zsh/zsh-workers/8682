From zsh-workers-return-8682-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Nov 19 10:55:57 1999
Return-Path: <zsh-workers-return-8682-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 549 invoked from network); 19 Nov 1999 10:55:56 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 19 Nov 1999 10:55:56 -0000
Received: (qmail 24454 invoked by alias); 19 Nov 1999 10:55:52 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8682
Received: (qmail 24447 invoked from network); 19 Nov 1999 10:55:51 -0000
To: zsh-workers@sunsite.auc.dk
Subject: Re: PATCH: prompt theme system improvements
References: <199911191034.LAA02428@beta.informatik.hu-berlin.de>
MIME-Version: 1.0 (generated by AKEMI 1.13.2 - =?ISO-2022-JP?B?Ig==?=
 =?ISO-2022-JP?B?GyRCQTA0Y0s8GyhCIg==?=)
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@jaist.ac.jp>
Date: 19 Nov 1999 19:55:45 +0900
In-Reply-To: Sven Wischnowsky's message of "Fri, 19 Nov 1999 11:34:08 +0100 (MET)"
Message-ID: <rsq7ljeg37y.fsf@crane.jaist.ac.jp>
Lines: 49
User-Agent: Chao-gnus/6.12.5 AKEMI/1.13.2 (=?ISO-2022-JP?B?GyRCQTAbKEI=?=
 =?ISO-2022-JP?B?GyRCNGNLPBsoQg==?=) FLAM-DOODLE/1.12.6
 (=?ISO-2022-JP?B?GyRCM3cbKEI=?= 10R4.0/5.0) Emacs/20.4
 (sparc-sun-solaris2.6) MULE/4.0 (HANANOEN)

In article <199911191034.LAA02428@beta.informatik.hu-berlin.de>,
  Sven Wischnowsky <wischnow@informatik.hu-berlin.de> writes:

> while we're at it... does the automatic updating of .distfiles work?
> Or do you need patches like the one below which Sven constantly keeps
> forgetting to build?

.distfiles are handled as usual files.  So it is not updated
automatically.  I don't plan automatic update for .distfiles.  But if
patches for .distfiles are posted as well as for other files, it is
useful to check consistency of the repository.  Also, package makers
need up-to-date .distfiles, I think.

And this is my consistency checker between .distfiles and CVS/Entries.
Currently, this reports only one problem: _funcall is forgotten.

#!/bin/sh

tmp1=/tmp/z-cd-distfiles.$$
tmp2=/tmp/z-cd-cvs.$$
trap  'rm -f $tmp1 $tmp2' 0 1 2 3 15

find . -name .distfiles -print |sort |
while read f; do
d="`dirname $f`"
. $f

GENERATED_SRC=
case "$d" in
".") GENERATED_SRC='
  META-FAQ config.h.in configure stamp-h.in' ;;
"./Doc") GENERATED_SRC='
  version.yo zsh.1 zsh.texi zshall.1 zshbuiltins.1 zshcompctl.1
  zshcompsys.1 zshcompwid.1 zshexpn.1 zshmisc.1 zshmodules.1
  zshoptions.1 zshparam.1 zshzftpsys.1 zshzle.1';;
"./Etc") GENERATED_SRC='
  FAQ';;
*) GENERATED_SRC= ;;
esac

echo $DISTFILES_SRC|awk '{for(i=1;i<=NF;i++)print $i}'|sort>$tmp1
(
  echo $GENERATED_SRC|awk '{for(i=1;i<=NF;i++)print $i}'
  awk -F/ '/^\// {print $2}' $d/CVS/Entries
)|sort>$tmp2
diff -u -L "$f" -L "$d/CVS/Entries" $tmp1 $tmp2
done
-- 
Tanaka Akira

