From zsh-workers-return-24673-mason-zsh=primenet.com.au@sunsite.dk Mon Mar 03 16:08:14 2008
Return-Path: <zsh-workers-return-24673-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20865 invoked from network); 3 Mar 2008 16:08:12 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 3 Mar 2008 16:08:12 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 94158 invoked from network); 3 Mar 2008 16:08:06 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 3 Mar 2008 16:08:06 -0000
Received: (qmail 1021 invoked by alias); 3 Mar 2008 16:08:02 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24673
Received: (qmail 993 invoked from network); 3 Mar 2008 16:08:00 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 3 Mar 2008 16:08:00 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [85.115.41.190])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 0B5CD8029404
	for <zsh-workers@sunsite.dk>; Mon,  3 Mar 2008 17:07:52 +0100 (CET)
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly17g.srv.mailcontrol.com (MailControl) with ESMTP id m23G5ogI026306
	for <zsh-workers@sunsite.dk>; Mon, 3 Mar 2008 16:07:32 GMT
Received: from news01 ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Mon, 3 Mar 2008 16:06:57 +0000
Date: Mon, 3 Mar 2008 16:06:57 +0000
From: Peter Stephenson <pws@csr.com>
To: "zsh workers" <zsh-workers@sunsite.dk>
Subject: Re: New D07 test failure
Message-ID: <20080303160657.0e70c1a7@news01>
In-Reply-To: <080302223056.ZM12892@torch.brasslantern.com>
References: <20a807210802271448h2d05993bt6576067b4dd0b9ef@mail.gmail.com>
	<200802280951.m1S9pCn1015387@news01.csr.com>
	<080302223056.ZM12892@torch.brasslantern.com>
Organization: CSR
X-Mailer: Claws Mail 3.3.1 (GTK+ 2.12.5; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-OriginalArrivalTime: 03 Mar 2008 16:06:57.0693 (UTC) FILETIME=[9B50A4D0:01C87D48]
X-Scanned-By: MailControl A-08-00-04 (www.mailcontrol.com) on 10.71.0.127
X-Virus-Scanned: ClamAV 0.91.2/6093/Mon Mar  3 16:03:18 2008 on bifrost
X-Virus-Status: Clean

On Sun, 02 Mar 2008 22:30:56 -0800
Bart Schaefer <schaefer@brasslantern.com> wrote:
> On Feb 28,  9:51am, Peter Stephenson wrote:
> }
> } OK, so we can't rely on the collation sequence in UTF-8 being consistent
> } across implementations, and we can't rely on "sort" either.  Any other
> } ideas before I simply remove the sort tests?
>=20
> Maybe you just need to choose the inputs more carefully?

Yes, maybe it's worth trying with a different well-ordered alphabet before
giving up.  Note those really are Greek upper case letters even though some
may be rendered the same as Roman.  (And people still say a classical
education is useless.  Sheesh.)

Ismail's later problem looked like it was to do with "0" sorting before
".".  Perhaps not making assumptions about punctuation symbols also
helps...  If "0" doesn't come before "t", I will lose interest in fixing
this.

Index: Test/D07multibyte.ztst
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /cvsroot/zsh/zsh/Test/D07multibyte.ztst,v
retrieving revision 1.23
diff -u -r1.23 D07multibyte.ztst
--- Test/D07multibyte.ztst	27 Feb 2008 20:03:23 -0000	1.23
+++ Test/D07multibyte.ztst	3 Mar 2008 16:03:28 -0000
@@ -322,16 +322,10 @@
 # We ask for case-insensitive sorting here (and supply upper case
 # characters) so that we exercise the logic in the shell that lowers the
 # case of the string for case-insensitive sorting.
-# As all letters are upper case, however, sort should produce the same ord=
er.
-  print -loi HAH HUH HEH H=C3=89H H=C3=88H >zshsort.txt
-  print -l HAH HUH HEH H=C3=89H H=C3=88H | sort >sortsort.txt
-  print Diff output should be empty
-  diff zshsort.txt sortsort.txt
-  print Sort in C locale
+  print -oi H=CE=95H H=CE=94H H=CE=93H H=CE=92H H=CE=91H
   (LC_ALL=3DC; print -oi HAH HUH HEH H=C3=89H H=C3=88H)
 0:Multibyte characters in print sorting
->Diff output should be empty
->Sort in C locale
+>H=CE=91H H=CE=92H H=CE=93H H=CE=94H H=CE=95H
 >HAH HEH HUH H=C3=88H H=C3=89H
=20
 # These are control characters in Unicode, so don't show up.
@@ -366,24 +360,24 @@
 >1 149
 >1 150
=20
-  touch ngs1.txt ngs2.txt ngs10.txt ngs20.txt ngs100.txt ngs200.txt
+  touch ngs1txt ngs2txt ngs10txt ngs20txt ngs100txt ngs200txt
   setopt numericglobsort
   print -l ngs*
   unsetopt numericglobsort
   print -l ngs*
 0:NUMERIC_GLOB_SORT option in UTF-8 locale
->ngs1.txt
->ngs2.txt
->ngs10.txt
->ngs20.txt
->ngs100.txt
->ngs200.txt
->ngs100.txt
->ngs10.txt
->ngs1.txt
->ngs200.txt
->ngs20.txt
->ngs2.txt
+>ngs1txt
+>ngs2txt
+>ngs10txt
+>ngs20txt
+>ngs100txt
+>ngs200txt
+>ngs100txt
+>ngs10txt
+>ngs1txt
+>ngs200txt
+>ngs20txt
+>ngs2txt
=20
 # Not strictly multibyte, but gives us a well-defined locale for testing.
   foo=3D$'X\xc0Y\x07Z\x7fT'


--=20
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

