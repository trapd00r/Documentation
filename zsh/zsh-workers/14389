From zsh-workers-return-14389-mason-zsh=primenet.com.au@sunsite.dk Sat May 19 08:58:53 2001
Return-Path: <zsh-workers-return-14389-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5207 invoked from network); 19 May 2001 08:58:51 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 19 May 2001 08:58:51 -0000
Received: (qmail 20116 invoked by alias); 19 May 2001 08:58:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14389
Received: (qmail 20077 invoked from network); 19 May 2001 08:58:36 -0000
Date: Fri, 18 May 2001 19:04:38 -0700 (PDT)
From: Wayne Davison <wayned@users.sourceforge.net>
X-X-Sender:  <wayne@phong.blorf.net>
To: Zsh Workers <zsh-workers@sunsite.dk>
Subject: A couple history bugfixes
Message-ID: <Pine.LNX.4.33L2.0105181854380.4777-200000@phong.blorf.net>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-1463796991-424028723-990237878=:4777"

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---1463796991-424028723-990237878=:4777
Content-Type: TEXT/PLAIN; charset=US-ASCII

I noticed that the code that merges identical, adjacent entries could
merge a HIST_TMPSTORE entry with the previous line if it only differed
by the leading spacing, so I fixed this.

Also, if the delayed-drop line is a dup of an older entry (ignoring
leading spaces, as the duplicate-detection code does) and you have
hist_find_no_dups on, history searching would not find the delayed-
drop line.  My fix is to never call addhistnode() or removehashnode()
on a HIST_TMPSTORE item, so the line is never marked as a dup (and is
also never entered into the history hash table).

..wayne..

---1463796991-424028723-990237878=:4777
Content-Type: TEXT/PLAIN; charset=US-ASCII; name="hist.patch"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.33L2.0105181904381.4777@phong.blorf.net>
Content-Description: Bugfixes
Content-Disposition: attachment; filename="hist.patch"

SW5kZXg6IFNyYy9oYXNodGFibGUuYw0KQEAgLTE0ODAsNyArMTQ4MCw3IEBA
DQogICAgIEhhc2hOb2RlIG9sZG5vZGUgPSBhZGRoYXNobm9kZTIoaHQsIG5h
bSwgbm9kZXB0cik7DQogICAgIEhpc3RlbnQgaGUgPSAoSGlzdGVudClub2Rl
cHRyOw0KICAgICBpZiAob2xkbm9kZSAmJiBvbGRub2RlICE9IChIYXNoTm9k
ZSlub2RlcHRyKSB7DQotCWlmIChoZS0+ZmxhZ3MgJiAoSElTVF9NQUtFVU5J
UVVFIHwgSElTVF9UTVBTVE9SRSkNCisJaWYgKGhlLT5mbGFncyAmIEhJU1Rf
TUFLRVVOSVFVRQ0KIAkgfHwgKGhlLT5mbGFncyAmIEhJU1RfRk9SRUlHTiAm
JiAoSGlzdGVudClvbGRub2RlID09IGhlLT51cCkpIHsNCiAJICAgICh2b2lk
KSBhZGRoYXNobm9kZTIoaHQsIG9sZG5vZGUtPm5hbSwgb2xkbm9kZSk7IC8q
IHJlc3RvcmUgaGFzaCAqLw0KIAkgICAgaGUtPmZsYWdzIHw9IEhJU1RfRFVQ
Ow0KQEAgLTE1MTEsNyArMTUxMSw3IEBADQogICAgIGlmICghaGUpDQogCXJl
dHVybjsNCiANCi0gICAgaWYgKCEoaGUtPmZsYWdzICYgSElTVF9EVVApKQ0K
KyAgICBpZiAoIShoZS0+ZmxhZ3MgJiAoSElTVF9EVVAgfCBISVNUX1RNUFNU
T1JFKSkpDQogCXJlbW92ZWhhc2hub2RlKGhpc3R0YWIsIGhlLT50ZXh0KTsN
CiANCiAgICAgenNmcmVlKGhlLT50ZXh0KTsNCkluZGV4OiBTcmMvaGlzdC5j
DQpAQCAtMTA5Niw4ICsxMDk2LDggQEANCiAJCWhpc3RyZWR1Y2VibGFua3Mo
KTsNCiAJfQ0KIAluZXdmbGFncyA9IHNhdmUgPiAwPyAwIDogSElTVF9PTEQg
fCBISVNUX1RNUFNUT1JFOw0KLQlpZiAoKGlzc2V0KEhJU1RJR05PUkVEVVBT
KSB8fCBpc3NldChISVNUSUdOT1JFQUxMRFVQUykpICYmIGhpc3RfcmluZw0K
LQkgJiYgaGlzdHN0cmNtcChjaGxpbmUsIGhpc3RfcmluZy0+dGV4dCkgPT0g
MCkgew0KKwlpZiAoKGlzc2V0KEhJU1RJR05PUkVEVVBTKSB8fCBpc3NldChI
SVNUSUdOT1JFQUxMRFVQUykpICYmIHNhdmUgPiAwDQorCSAmJiBoaXN0X3Jp
bmcgJiYgaGlzdHN0cmNtcChjaGxpbmUsIGhpc3RfcmluZy0+dGV4dCkgPT0g
MCkgew0KIAkgICAgLyogVGhpcyBoaXN0b3J5IGVudHJ5IGNvbXBhcmVzIHRo
ZSBzYW1lIGFzIHRoZSBwcmV2aW91cy4NCiAJICAgICAqIEluIGNhc2UgbWlu
b3IgY2hhbmdlcyB3ZXJlIG1hZGUsIHdlIG92ZXJ3cml0ZSB0aGUNCiAJICAg
ICAqIHByZXZpb3VzIG9uZSB3aXRoIHRoZSBjdXJyZW50IG9uZS4gIFRoaXMg
YWxzbyBnZXRzIHRoZQ0KQEAgLTExMTksNyArMTExOSw4IEBADQogCSAgICBo
ZS0+d29yZHMgPSAoc2hvcnQgKil6YWxsb2MoY2h3b3JkcG9zICogc2l6ZW9m
KHNob3J0KSk7DQogCSAgICBtZW1jcHkoaGUtPndvcmRzLCBjaHdvcmRzLCBj
aHdvcmRwb3MgKiBzaXplb2Yoc2hvcnQpKTsNCiAJfQ0KLQlhZGRoaXN0bm9k
ZShoaXN0dGFiLCBoZS0+dGV4dCwgaGUpOw0KKwlpZiAoIShuZXdmbGFncyAm
IEhJU1RfVE1QU1RPUkUpKQ0KKwkgICAgYWRkaGlzdG5vZGUoaGlzdHRhYiwg
aGUtPnRleHQsIGhlKTsNCiAgICAgfQ0KICAgICB6ZnJlZShjaGxpbmUsIGhs
aW5lc3opOw0KICAgICB6ZnJlZShjaHdvcmRzLCBjaHdvcmRsZW4qc2l6ZW9m
KHNob3J0KSk7DQo=
---1463796991-424028723-990237878=:4777--

