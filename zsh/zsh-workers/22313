From zsh-workers-return-22313-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 01 10:09:15 2006
Return-Path: <zsh-workers-return-22313-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22720 invoked from network); 1 Mar 2006 10:09:13 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 1 Mar 2006 10:09:13 -0000
Received: (qmail 87065 invoked from network); 1 Mar 2006 10:09:07 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 1 Mar 2006 10:09:07 -0000
Received: (qmail 3525 invoked by alias); 1 Mar 2006 10:09:05 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22313
Received: (qmail 3516 invoked from network); 1 Mar 2006 10:09:04 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 1 Mar 2006 10:09:04 -0000
Received: (qmail 86760 invoked from network); 1 Mar 2006 10:09:04 -0000
Received: from zproxy.gmail.com (64.233.162.198)
  by a.mx.sunsite.dk with SMTP; 1 Mar 2006 10:09:02 -0000
Received: by zproxy.gmail.com with SMTP id v1so103229nzb
        for <zsh-workers@sunsite.dk>; Wed, 01 Mar 2006 02:09:01 -0800 (PST)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:to:subject:mime-version:content-type:content-transfer-encoding:content-disposition;
        b=b8B1qTdKYlauWBAIeYRb6zLzfl3e0l79ZN/GINa+1ZRKSTRhMjwyjk2zj4wJTTHXx6kiBbcxtIoPZfOpNv9Jzj/fYXpbrcxn/qhjTIFgK9VNrzoE8sFZkC5wcjG+7FkS2PHJXjy/gPHz/eQRLHxXmb4hOLSv+EfHqJD2+EUYG7k=
Received: by 10.36.50.8 with SMTP id x8mr7498nzx;
        Wed, 01 Mar 2006 02:09:00 -0800 (PST)
Received: by 10.37.13.46 with HTTP; Wed, 1 Mar 2006 02:09:00 -0800 (PST)
Message-ID: <19c433eb0603010209t17047996qc29b623e6ff2e490@mail.gmail.com>
Date: Wed, 1 Mar 2006 11:09:00 +0100
From: "=?ISO-8859-1?Q?Fran=E7ois-Xavier_Coudert?=" <fxcoudert@gmail.com>
To: zsh-workers@sunsite.dk
Subject: zsh-4.3.1 build failure on AIX
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline

Trying to build zsh-4.3.1 on AIX 5.3, with either gcc (3.2.3) or xlc,
leads to a build failure:

gcc  -s -shared -o zle.so -Wl,-bI:../../Src/zsh.export
-Wl,-bE:zle.export -emodentry zle_bindings..o zle_hist..o
zle_keymap..o zle_main..o zle_misc..o zle_move..o zle_params..o
zle_refresh..o zle_thingy..o zle_tricky..o zle_utils..o zle_vi..o
zle_word..o  ../../Src/modentry..o  -liconv -ldl -lcurses -lm  -lc
ld: 0711-317 ERROR: Undefined symbol: .makecommaspecial
ld: 0711-345 Use the -bloadmap or -bnoquiet option to obtain more informati=
on.
collect2: ld returned 8 exit status
gmake[3]: *** [zle.so] Error 1
gmake[3]: Leaving directory `/tmp/zsh-4.3.1-gcc/Src/Zle'
gmake[2]: *** [modules] Error 1
gmake[2]: Leaving directory `/tmp/zsh-4.3.1-gcc/Src'
gmake[1]: *** [modules] Error 2
gmake[1]: Leaving directory `/tmp/zsh-4.3.1-gcc/Src'
gmake: *** [all] Error 1

or

xlc  -s -bM:SRE -o zle.so -bI:../../Src/zsh.export -bE:zle.export
-emodentry zle_bindings..o zle_hist..o zle_keymap..o zle_main..o
zle_misc..o zle_move..o zle_params..o zle_refresh..o zle_thingy..o
zle_tricky..o zle_utils..o zle_vi..o zle_word..o=20
../../Src/modentry..o  -liconv -ldl -lcurses -lm  -lc
ld: 0711-317 ERROR: Undefined symbol: .makecommaspecial
ld: 0711-345 Use the -bloadmap or -bnoquiet option to obtain more informati=
on.
gmake[3]: *** [zle.so] Error 8
gmake[3]: Leaving directory `/tmp/zsh-4.3.1-xlc/Src/Zle'
gmake[2]: *** [modules] Error 1
gmake[2]: Leaving directory `/tmp/zsh-4.3.1-xlc/Src'
gmake[1]: *** [modules] Error 2
gmake[1]: Leaving directory `/tmp/zsh-4.3.1-xlc/Src'
gmake: *** [all] Error 1

Both are configured with "./configure
--prefix=3D/regatt/lcp/coudert/local --enable-multibyte", the first one
with CC=3Dgcc and the second one with CC=3Dxlc.

Adding a line with "makecommaspecial" in Src/zsh.export makes the
compilation work again. I  think the correct patch would be to change
(in Src/utils.c):

*** ../zsh-4.3.1-xlc/Src/utils.c        Tue Feb 14 11:39:00 2006
--- Src/utils.c Wed Mar  1 11:09:10 2006
***************
*** 2623,2629 ****
  }

  /**/
! void
  makecommaspecial(int yesno)
  {
      if ((specialcomma =3D yesno) !=3D 0)
--- 2623,2629 ----
  }

  /**/
! mod_export void
  makecommaspecial(int yesno)
  {
      if ((specialcomma =3D yesno) !=3D 0)



Once compiled with that patch applied, zsh-4.3.1 seems to work fine
(for both compilers).

FX

