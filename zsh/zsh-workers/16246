From zsh-workers-return-16246-mason-zsh=primenet.com.au@sunsite.dk Wed Nov 14 09:03:57 2001
Return-Path: <zsh-workers-return-16246-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3814 invoked from network); 14 Nov 2001 09:03:57 -0000
Received: from ns2.primenet.com.au (HELO primenet.com.au) (?WWqYlvY0TCBzm21FdfygyfNr72nRWqKV?@203.24.36.3)
  by ns1.primenet.com.au with SMTP; 14 Nov 2001 09:03:57 -0000
Received: (qmail 4608 invoked from network); 14 Nov 2001 09:03:55 -0000
Received: from sunsite.dk (130.225.247.90)
  by proxy.melb.primenet.com.au with SMTP; 14 Nov 2001 09:03:55 -0000
Received: (qmail 20441 invoked by alias); 14 Nov 2001 09:03:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16246
Received: (qmail 20429 invoked from network); 14 Nov 2001 09:03:49 -0000
Message-Id: <7D865FB0D0A1D5118B6E000347055BBB14847B@G9JNT.mgb01.telekom.de>
From: "Wischnowsky, Sven" <Sven.Wischnowsky@t-systems.de>
To: zsh-workers@sunsite.dk
Subject: Re: [bug report] 4.0.2 / 4.0.4 dumps core
Date: Wed, 14 Nov 2001 10:03:33 +0100
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: text/plain


> On Nov 12, 11:39am, Akitoshi MORISHIMA wrote:
> }
> } ...
> }
> } Type:
> } 	!^ then [TAB]
> } 
> } then zsh dumps core...
> } 
> } I guess "!^" accesses to "previous command line", which is 
> expectd to
> } be always present even without history-related settings, but this
> } isn't true in this "special" case...
> 
> This is a mis-diagnosis.
> 
> Zsh is attempting to complete reserved words (in this case, 
> the word "!").
> The reswords table contains static strings, but the 
> completion code tries
> to poke '\0' byte in at the end of the word, resulting in a 
> segfault on any
> platform where static strings aren't writable.
> 
> The combination of extendedglob and globcomplete (which makes "^" mean
> something), plus lack of history, tickles the bug, but is not 
> the reason
> for it:
> 
> schaefer[524] Src/zsh -f
> zagzig% setopt extendedglob globcomplete nobanghist
> zagzig% !^<TAB>zsh: segmentation fault (core dumped)  Src/zsh -f

I had a patch for this, too, that just made the shell use duplicates in the
reswdtab - it isn't that much memory being wasted (but of course I forgot
to bring that patch together with the other one).

Bye
  Sven

P.S.: Oh look, Outlook garbled Bart's message. Oh look, Sven's using Outlook.
      Urgh, that's so embarassing.

