From zsh-workers-request@euclid.skiles.gatech.edu  Tue Jan 16 03:26:02 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by werple.net.au (8.7/8.7.1) with ESMTP id DAA26215 for <mason@werple.mira.net.au>; Tue, 16 Jan 1996 03:25:58 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id LAA25053; Mon, 15 Jan 1996 11:10:31 -0500 (EST)
Resent-Date: Mon, 15 Jan 1996 11:10:31 -0500 (EST)
Message-Id: <9601151610.AA09130@sgi.ifh.de>
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: Re: multi-line history storing bug (beta13) 
In-Reply-To: "mason@werple.net.au"'s message of "Tue, 16 Jan 1996 01:45:06 MET."
             <199601151445.BAA21991@werple.net.au> 
Date: Mon, 15 Jan 1996 17:10:15 +0100
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"fklyE1.0.N76.snd-m"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/741
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

mason@werple.net.au wrote:
> Heyla, doing this on my machine loses the last line in the history list.
> 
> % for I in test
> do echo hi
> #test
> done
> %
> 
> It seems to happen in multiline editing when I put in a comment. Anyone else
> get this?

It needs to pretend the newline character at the end of the comment is
a word, like other newlines.  (If it doesn't count the newline as a
word, it'll assume that the text ends with the previous word.)  I
didn't do that much detailed checking with multi line buffers, or with
interactivecomments.

*** Src/lex.c.icom	Thu Dec 21 23:44:21 1995
--- Src/lex.c	Mon Jan 15 16:49:00 1996
***************
*** 379,384 ****
--- 379,385 ----
  	    peek = LEXERR;
  	else {
  	    hwend();
+ 	    hwbegin(0);
  	    hwaddc('\n');
  	    peek = NEWLIN;
  	}


-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77330
Deutches Electronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.

