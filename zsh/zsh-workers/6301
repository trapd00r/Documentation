From zsh-workers-return-6301-mason-zsh=primenet.com.au@sunsite.auc.dk Tue May 18 09:10:44 1999
Return-Path: <zsh-workers-return-6301-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17594 invoked from network); 18 May 1999 09:10:43 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 18 May 1999 09:10:43 -0000
Received: (qmail 6937 invoked by alias); 18 May 1999 08:50:19 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6301
Received: (qmail 6930 invoked from network); 18 May 1999 08:50:18 -0000
Date: Tue, 18 May 1999 09:15:03 +0200 (MET DST)
Message-Id: <199905180715.JAA15766@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 18 May 1999 15:27:47 +0900
Subject: Re: compadd -f with IPREFIX.


Tanaka Akira wrote:

> is27e1u11% cat <<'End' > Completion/User/_tst
> heredoc> #compdef tst
> heredoc> compset -P :
> heredoc> compadd -f - *
> heredoc> End
> 
> then, I get following.
> 
> is27e1u11% tst :Completion
> 
> I think zsh should complete a suffix "/".

addmatches() used the IPREFIX it got also as `ripre' (the expanded
form of the ignored prefix -- this is used for things like `~' and
`$foo/<TAB>'). The patch makes it use a NULL pointer there.

Bye
 Sven

diff -u os/Zle/zle_tricky.c Src/Zle/zle_tricky.c
--- os/Zle/zle_tricky.c	Sat May  8 14:31:49 1999
+++ Src/Zle/zle_tricky.c	Tue May 18 09:07:49 1999
@@ -3734,7 +3735,7 @@
 		    continue;
 		}
 		if (doadd) {
-		    cm = add_match_data(isalt, ms, lc, dat->ipre, dat->ipre,
+		    cm = add_match_data(isalt, ms, lc, dat->ipre, NULL,
 					dat->isuf, dat->pre, dat->prpre,
 					dat->ppre, dat->psuf, dat->suf,
 					bpl, bsl, dat->flags, isexact);

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

