From zsh-users-return-4027-mason-zsh=primenet.com.au@sunsite.dk Thu Jul 12 03:30:39 2001
Return-Path: <zsh-users-return-4027-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26629 invoked from network); 12 Jul 2001 03:30:38 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 12 Jul 2001 03:30:38 -0000
Received: (qmail 18740 invoked by alias); 12 Jul 2001 03:30:26 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4027
Received: (qmail 18729 invoked from network); 12 Jul 2001 03:30:25 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010712033003.ZM31613@candle.brasslantern.com>
Date: Thu, 12 Jul 2001 03:30:02 +0000
In-Reply-To: <20010712015910.A24326@greux.loria.fr>
Comments: In reply to Vincent Lefevre <vincent@vinc17.org>
        "Re: [4.0.2 bug] commands not written to history" (Jul 12,  1:59am)
References: <20010629163348.A9632@greux.loria.fr> 
	<1010629155017.ZM14989@candle.brasslantern.com> 
	<4a9256987fvincent@vinc17.org> 
	<1010630160614.ZM21128@candle.brasslantern.com> 
	<20010712003459.A24126@greux.loria.fr> 
	<20010712015910.A24326@greux.loria.fr>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Vincent Lefevre <vincent@vinc17.org>, zsh-users@sunsite.dk
Subject: Re: [4.0.2 bug] commands not written to history
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Jul 12,  1:59am, Vincent Lefevre wrote:
} Subject: Re: [4.0.2 bug] commands not written to history
}
} There is another problem. For instance, when I want to backward-search
} for `file.', nothing is found, though there is a matching line in the
} history:
} 
} greux:~out> grep "zip -r" $HISTFILE                                    <1:48:28
} : 994891028:0;zip -r file.zip *
} : 994895233:0;grep "zip -r" $HISTFILE
} greux:~out> grep "zip -r" $HISTFILE                                    <1:48:29
} failing bck-i-search: file._

Hrm.  Just because there's an entry in $HISTFILE doesn't mean that it's
present in the shell history, of course.  With INC_APPEND_HISTORY set
(as I believe you have), $HISTFILE may have up to $[SAVEHIST/5] extra
commands stored in it.  (This is to avoid having to rewrite the entire
file too frequently.)  But only $HISTSIZE of those commands is actually
in memory (and thus searchable) at any given time.

Next time you see this happen, try running `fc -W temphistfile' and then
`diff $HISTFILE temphistfile'.  You should see differences only at the
beginning and possibly one or two commands at the end, not in the middle.
If there are commands missing (or misordered) in the middle, then we'll
have evidence of a real bug.
 
} It seems to be due to the fact that the time stamps are not in the
} increasing order.

Can you show an example of this, please?

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

