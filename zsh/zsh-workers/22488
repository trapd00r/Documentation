From zsh-workers-return-22488-mason-zsh=primenet.com.au@sunsite.dk Mon Jun 12 16:11:13 2006
Return-Path: <zsh-workers-return-22488-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20946 invoked from network); 12 Jun 2006 16:11:09 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.3 (2006-06-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 12 Jun 2006 16:11:09 -0000
Received: (qmail 56049 invoked from network); 12 Jun 2006 16:10:59 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 12 Jun 2006 16:10:59 -0000
Received: (qmail 12979 invoked by alias); 12 Jun 2006 16:10:56 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22488
Received: (qmail 12969 invoked from network); 12 Jun 2006 16:10:56 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 12 Jun 2006 16:10:56 -0000
Received: (qmail 55681 invoked from network); 12 Jun 2006 16:10:56 -0000
Received: from beaver.spamt.net (212.75.36.182)
  by a.mx.sunsite.dk with SMTP; 12 Jun 2006 16:10:54 -0000
Received: by beaver.spamt.net (Postfix, from userid 1000)
	id A239F701C1; Mon, 12 Jun 2006 18:10:52 +0200 (CEST)
Date: Mon, 12 Jun 2006 18:10:52 +0200
From: Ulrich Dangel <ml-lists@spamt.net>
To: zsh-workers@sunsite.dk
Subject: Bug in url-quote-magic?
Message-ID: <20060612161052.GG27340@beaver.spamt.net>
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="ADZbWkCsHQ7r3kzd"
Content-Disposition: inline
Organization: I don't know
User-Agent: Mutt/1.5.9i
X-Editor: Vim-603 http://www.vim.org


--ADZbWkCsHQ7r3kzd
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hi,
while using url-quote-magic i discoverd a strange behaviour.
If i enter an url, followed by space, and after that a semicolon, the
semicolon is escaped. This is really ugly if i use something like
,----
| while mplayer $url ; do 
|    sleep 10 ; 
| done 
`----

because this gets to, 

,----
| while mplayer $url \; do ..
`----

I attached the diff, hope it helps someone :)

Uli

--ADZbWkCsHQ7r3kzd
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename=url-quote-diff

--- /usr/share/zsh/4.3.2/functions/Zle/url-quote-magic  2006-05-20 19:55:36.000000000 +0200
+++ url-quote-magic     2006-06-06 01:36:56.332676750 +0200
@@ -108,7 +108,7 @@
 function url-quote-magic {
     setopt localoptions noksharrays extendedglob
     local qkey="${(q)KEYS}"
-    if [[ "$KEYS" != "$qkey" ]]
+    if [[ "$KEYS" != "$qkey" && "$LBUFFER[-1]" != " " ]] 
     then
        local lbuf="$LBUFFER$qkey"
        if [[ "${(Q)LBUFFER}$KEYS" == "${(Q)lbuf}" ]]


--ADZbWkCsHQ7r3kzd--

