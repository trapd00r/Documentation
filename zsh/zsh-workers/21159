From zsh-workers-return-21159-mason-zsh=primenet.com.au@sunsite.dk Sat Apr 23 03:14:42 2005
Return-Path: <zsh-workers-return-21159-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29882 invoked from network); 23 Apr 2005 03:14:41 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 Apr 2005 03:14:41 -0000
Received: (qmail 35663 invoked from network); 23 Apr 2005 03:14:35 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 Apr 2005 03:14:35 -0000
Received: (qmail 21557 invoked by alias); 23 Apr 2005 03:14:31 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21159
Received: (qmail 21539 invoked from network); 23 Apr 2005 03:14:29 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 23 Apr 2005 03:14:29 -0000
Received: (qmail 35343 invoked from network); 23 Apr 2005 03:14:29 -0000
Received: from vms048pub.verizon.net (206.46.252.48)
  by a.mx.sunsite.dk with SMTP; 23 Apr 2005 03:14:25 -0000
Received: from candle.brasslantern.com ([4.11.1.68])
 by vms048.mailsrvcs.net (Sun Java System Messaging Server 6.2 HotFix 0.04
 (built Dec 24 2004)) with ESMTPA id <0IFD003S6QBZFW42@vms048.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Fri, 22 Apr 2005 22:14:24 -0500 (CDT)
Received: from candle.brasslantern.com (IDENT:schaefer@localhost [127.0.0.1])
	by candle.brasslantern.com (8.12.11/8.12.11) with ESMTP id j3N3ENb2003883	for
 <zsh-workers@sunsite.dk>; Fri, 22 Apr 2005 20:14:23 -0700
Received: (from schaefer@localhost)	by candle.brasslantern.com
 (8.12.11/8.12.11/Submit) id j3N3EM2B003882	for zsh-workers@sunsite.dk; Fri,
 22 Apr 2005 20:14:22 -0700
Date: Sat, 23 Apr 2005 03:14:22 +0000
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: replacement slowdown
In-reply-to: <20050422232316.GA27665@scowler.net>
To: zsh-workers@sunsite.dk
Message-id: <1050423031422.ZM3881@candle.brasslantern.com>
MIME-version: 1.0
X-Mailer: Z-Mail (5.0.0 30July97)
Content-type: text/plain; charset=us-ascii
References: <20050422232316.GA27665@scowler.net>
Comments: In reply to Clint Adams <clint@zsh.org>        "replacement slowdown"
 (Apr 22,  7:23pm)
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On Apr 22,  7:23pm, Clint Adams wrote:
}
} ${(f)"$(</tmp/blah)"//,/x}
} 
} is much slower (23 secs vs. 0.8 secs) in 4.2.2 than it was in 4.2.1

This coincides with the change to introduce the "gsu" structure for
storing functions that perform the get/set/unset of parameters, and
to the addition of the gettimeofday() call in zfork().

Also to the change from times() to getrusage() for timing child jobs,
and to some changes in pattern matching to handle metafied strings
properly:

+       * 20522: Src/glob.c, Test/D02glob.ztst: must-match optimisation
+       was broken for pattern substitutions in parameters.

+       * 20500: Misc/globtests, Src/glob.c, Src/pattern.c, Src/zsh.h,
+       Src/Zle/complist.c, Test/D02glob.ztst: Use unmetafied strings
+       in patterns more;

+       * 20490: Src/pattern.c, Src/zsh.h: use lengths for test strings in
+       patterns instead of null termination.

Any or all of those could be contributing to slowness in the example you
gave.  Someone will have to run both versions through a profiler.

BTW, did you check that both builds used the same compiler optimization
settings?

