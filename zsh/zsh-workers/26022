From zsh-workers-return-26022-mason-zsh=primenet.com.au@sunsite.dk Mon Nov 10 17:09:35 2008
Return-Path: <zsh-workers-return-26022-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28312 invoked from network); 10 Nov 2008 17:09:32 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 10 Nov 2008 17:09:32 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 93832 invoked from network); 10 Nov 2008 17:09:25 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 Nov 2008 17:09:25 -0000
Received: (qmail 23756 invoked by alias); 10 Nov 2008 17:09:19 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26022
Received: (qmail 23746 invoked from network); 10 Nov 2008 17:09:19 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 10 Nov 2008 17:09:19 -0000
Received: from n7a.bullet.ukl.yahoo.com (n7a.bullet.ukl.yahoo.com [217.146.183.155])
	by bifrost.dotsrc.org (Postfix) with SMTP id 5672C80308BE
	for <zsh-workers@sunsite.dk>; Mon, 10 Nov 2008 18:09:14 +0100 (CET)
Received: from [217.146.182.179] by n7.bullet.ukl.yahoo.com with NNFMP; 10 Nov 2008 17:09:14 -0000
Received: from [87.248.111.150] by t5.bullet.ukl.yahoo.com with NNFMP; 10 Nov 2008 17:09:14 -0000
Received: from [127.0.0.1] by omp207.mail.ukl.yahoo.com with NNFMP; 10 Nov 2008 17:09:14 -0000
X-Yahoo-Newman-Id: 359180.19919.bm@omp207.mail.ukl.yahoo.com
Received: (qmail 27527 invoked from network); 10 Nov 2008 17:09:14 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.co.uk;
  h=Received:X-YMail-OSG:X-Yahoo-Newman-Property:Received:From:To:Subject:Date:Message-ID;
  b=1/ExJlxTlnrf8U6pmzrTrveK0151Eg+RUO6kEIZo1L7RTOITwuMC9DcINC2MEFgvMe0+0mXfkHs/V/9WFnCuYDBQJm1W8Wf1Q6XfE6f2LNK2Ypn/dGdEtc9/wSnGGFrbunRwbaOzhBIPyJrUu4f2j0AGPIRW2zhBplQzUU/DeIg=  ;
Received: from unknown (HELO thecus) (okiddle@89.48.51.75 with plain)
  by smtp102.mail.ukl.yahoo.com with SMTP; 10 Nov 2008 17:09:13 -0000
X-YMail-OSG: JeBc36oVM1nNBQiMQVWkzz0hgE8EulC0toCXUwXEe0tDA3AJOHxoqBu5yRbszna5PIogKjSIpsEND6Zvxnhhd5Xkg45_sof5ahdDhD934OCKl8i.vhvIIP61f7J6l4sicNS59Uk5EBFgpUnabxotjXEoPe6OxOJxR0Iw0jY-
X-Yahoo-Newman-Property: ymail-3
Received: from localhost ([127.0.0.1] helo=thecus)
	by thecus with esmtp (Exim 4.63)
	(envelope-from <okiddle@yahoo.co.uk>)
	id 1KzaGG-0006N2-1c
	for zsh-workers@sunsite.dk; Mon, 10 Nov 2008 18:09:12 +0100
From: Oliver Kiddle <okiddle@yahoo.co.uk>
To: Zsh workers <zsh-workers@sunsite.dk>
Subject: PATCH: file descriptor completion
Date: Mon, 10 Nov 2008 18:09:11 +0100
Message-ID: <24491.1226336951@thecus>
X-Virus-Scanned: ClamAV 0.92.1/8598/Mon Nov 10 16:37:36 2008 on bifrost
X-Virus-Status: Clean

_file_descriptors wasn't working properly on Solaris where /proc/$$/fd
exists but it's contents are not symbolic links. This fixes it.

Oliver

Index: Completion/Zsh/Type/_file_descriptors
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Zsh/Type/_file_descriptors,v
retrieving revision 1.6
diff -u -r1.6 _file_descriptors
--- Completion/Zsh/Type/_file_descriptors	3 Jun 2008 09:30:58 -0000	1.6
+++ Completion/Zsh/Type/_file_descriptors	10 Nov 2008 17:03:08 -0000
@@ -2,9 +2,9 @@
 
 local i fds expl list link sep
 
-for i in {0..9}; [[ -e /dev/fd/$i ]] && fds+=( $i )
+fds=( /dev/fd/<0-9>(N:t) )
 
-if zstyle -T ":completion:${curcontext}:" verbose && [[ -e /proc/$$/fd ]]; then
+if zstyle -T ":completion:${curcontext}:" verbose && [[ -h /proc/$$/fd/$fds[1] ]]; then
   zstyle -s ":completion:${curcontext}:" list-separator sep || sep=--
 
   if zmodload -F zsh/stat b:zstat; then

