From zsh-workers-return-8488-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Nov 02 13:00:32 1999
Return-Path: <zsh-workers-return-8488-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29107 invoked from network); 2 Nov 1999 13:00:30 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 2 Nov 1999 13:00:30 -0000
Received: (qmail 24230 invoked by alias); 2 Nov 1999 13:00:21 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8488
Received: (qmail 24222 invoked from network); 2 Nov 1999 13:00:20 -0000
Date: Tue, 2 Nov 1999 14:00:13 +0100 (MET)
Message-Id: <199911021300.OAA31323@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 02 Nov 1999 21:50:41 +0900
Subject: Re: PATCH: _value


Tanaka Akira wrote:

> I wrote _value to complete values for parameter assignments.
> 
> And I found a problem with this.  When I try the completion by _value
> first time, it is failed and "funcstack wrapper with wrong function"
> is displayed.  Since second time, there is no problem.

And thus the parameter module revealed a bug in the function calling
code: it didn't dup the name and when the function was re-defined, the 
name in use by the wrappers was freed.

Bye
 Sven

--- oldsrc/exec.c	Mon Nov  1 09:03:16 1999
+++ Src/exec.c	Tue Nov  2 13:57:30 1999
@@ -3018,7 +3018,7 @@
 		argzero = ztrdup(argzero);
 	    }
 	}
-	runshfunc(list, wrappers, name);
+	runshfunc(list, wrappers, dupstring(name));
 	if (retflag) {
 	    retflag = 0;
 	    breaks = obreaks;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

