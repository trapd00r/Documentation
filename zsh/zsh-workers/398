From zsh-workers-request@math.gatech.edu  Sat Sep 23 02:34:16 1995
Received: from gatech.edu (gatech.edu [130.207.244.244]) by werple.mira.net.au (8.6.12/8.6.12) with SMTP id CAA08508 for <mason@werple.mira.net.au>; Sat, 23 Sep 1995 02:34:11 +1000
Received: from math (math.skiles.gatech.edu) by gatech.edu with SMTP id AA02319
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Fri, 22 Sep 1995 12:33:52 -0400
Received: by math (5.x/SMI-SVR4)
	id AA23014; Fri, 22 Sep 1995 12:26:07 -0400
Resent-Date: Fri, 22 Sep 1995 18:09:11 +0200 (MET DST)
Old-Return-Path: <hzoli@cs.elte.hu>
From: hzoli@cs.elte.hu (Zoltan Hidvegi)
Message-Id: <9509221625.AA02039@turan.elte.hu>
Subject: Re: input.c and here documents bugfixes
To: schaefer@z-code.com
Date: Fri, 22 Sep 1995 18:09:11 +0200 (MET DST)
In-Reply-To: <950921110903.ZM9297@zyrcon.z-code.com> from "Barton E. Schaefer" at Sep 21, 95 11:09:02 am
X-Mailer: ELM [version 2.4 PL23]
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Sender: hzoli@cs.elte.hu
Resent-Message-Id: <"BqpT02.0.Sd5.UEkOm"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/398
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Barton E. Schaefer wrote:
> 
> I think Zoltan's input.c patch was incorrect.  The exec.c part of the
> patch is OK.  Here's the relevant bit:
> 
-- patch deleted ---

Sorry, I forgot the semicolon at the end. The patch below should be correct.

The problem with the original file is that is can exit from the for loop on
two conditions.  If it exits when the buffer is filled up, the l counter is
one more than otherwise.

Zoltan

*** 1.2	1995/09/19 17:57:52
--- input.c	1995/09/22 14:59:56
***************
*** 274,283 ****
  {
      int l;
  
!     for (l = 0; l < n - 1; l++)
! 	if ((buf[l] = ingetc()) == '\n' || lexstop)
! 	    break;
!     buf[l + (lexstop ? 0 : 1)] = 0;
  
      return (!lexstop || l) ? buf : NULL;
  }
--- 274,283 ----
  {
      int l;
  
!     for (l = 0; l < n - 1 && (buf[l++] = ingetc()) != '\n' && !lexstop;);
!     if (lexstop)
! 	l--;
!     buf[l] = '\0';
  
      return (!lexstop || l) ? buf : NULL;
  }

