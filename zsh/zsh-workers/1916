From zsh-workers-request@euclid.skiles.gatech.edu  Sun Aug  4 18:40:09 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by coral.primenet.com.au (8.7.5/8.7.3) with ESMTP id SAA02156 for <mason@primenet.com.au>; Sun, 4 Aug 1996 18:40:06 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id EAA08990; Sun, 4 Aug 1996 04:06:39 -0400 (EDT)
Resent-Date: Sun, 4 Aug 1996 04:06:39 -0400 (EDT)
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <960804010736.ZM4136@candle.brasslantern.com>
Date: Sun, 4 Aug 1996 01:07:35 -0700
Reply-To: schaefer@nbn.com
X-Mailer: Z-Mail (4.0b.702 02jul96)
To: zsh-workers@math.gatech.edu
Subject: unset and locals
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"s35u31.0.OC2.9e51o"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1916
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

This is so weird I'm having a hard time coming up with an example.  Consider
these two functions:

one() {
  local x=1
  echo one $x before two
  two
  echo one $x after two
}

two() {
   local x=2
   echo two $x before unset
   unset x
   echo two $x after unset
   unset x
   echo two $x after repeat of unset
}

Executing "one" in zsh produces the output:

one 1 before two
two 2 before unset
two after unset
two after repeat of unset
one 1 after two

Now consider changing "two" as follows:

unlocal() {
  unset $1
}

two() {
   local x=2
   echo two $x before unlocal
   unlocal x
   echo two $x after unlocal
   unlocal x
   echo two $x after repeat of unlocal
}

This produces the output:

one 1 before two
two 2 before unlocal
two 1 after unlocal
two after repeat of unlocal
one after two

Egad!  By this strategem, "two" has succeeded in first unhiding (which is
good) and then unsetting (which in this instance is bad) a local variable
scoped in "one"!

Is there another way to "unhide" a variable from a higher scope?  A way
that is guaranteed not to accidentally *unset* that same variable?

-- 
Bart Schaefer                             Brass Lantern Enterprises
http://www.well.com/user/barts            http://www.nbn.com/people/lantern

New male in /home/schaefer:
>N  2 Justin William Schaefer  Sat May 11 03:43  53/4040  "Happy Birthday"

