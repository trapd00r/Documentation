From zsh-workers-return-11836-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Jun 09 11:13:36 2000
Return-Path: <zsh-workers-return-11836-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6341 invoked from network); 9 Jun 2000 11:13:33 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 9 Jun 2000 11:13:33 -0000
Received: (qmail 13993 invoked by alias); 9 Jun 2000 11:13:24 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11836
Received: (qmail 13949 invoked from network); 9 Jun 2000 11:13:03 -0000
Date: Fri, 9 Jun 2000 13:12:48 +0200 (MET DST)
Message-Id: <200006091112.NAA23243@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Peter Stephenson's message of Fri, 09 Jun 2000 10:11:10 +0100
Subject: Re: PATCH: faster filenames


Peter Stephenson wrote:

> > Here is the first patch to make _path_files faster.
> 
> % cd ~/src/zsh/Src
> % zsh -f
> % autoload -U compinit
> % compinit -D
> % zstyle ':completion:*' menu select=1
> % setopt menucomplete
> % echo <TAB until Zle/ comes up>
>        <^D to get listing of Zle/ (OK)>
>        <TAB to do menu selection in Zle/>
> % echo Zle/zsh: bus error (core dumped)  zsh -f

[That wasn't caused by the speedup patch.]

Oops. When stopping menu-completion we should invalidate the
current-match pointer, too, if another completion attempt is
imminent.

Bye
 Sven

Index: Src/Zle/compcore.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compcore.c,v
retrieving revision 1.30
diff -u -r1.30 compcore.c
--- Src/Zle/compcore.c	2000/06/07 08:39:57	1.30
+++ Src/Zle/compcore.c	2000/06/09 11:11:44
@@ -512,6 +512,7 @@
 	if ((ret = runhookdef(MENUSTARTHOOK, (void *) &cdat))) {
 	    dat[1] = 0;
 	    menucmp = menuacc = 0;
+	    minfo.cur = NULL;
 	    if (ret == 2) {
 		fixsuffix();
 		cs = 0;
Index: Src/Zle/complist.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/complist.c,v
retrieving revision 1.22
diff -u -r1.22 complist.c
--- Src/Zle/complist.c	2000/06/07 08:39:57	1.22
+++ Src/Zle/complist.c	2000/06/09 11:11:45
@@ -1778,6 +1778,7 @@
 	    s->origcs = origcs;
 	    s->origll = origll;
 	    menucmp = menuacc = hasoldlist = 0;
+	    minfo.cur = NULL;
 	    fixsuffix();
 	    validlist = 0;
 	    amatches = pmatches = lastmatches = NULL;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

