From zsh-workers-return-13384-mason-zsh=primenet.com.au@sunsite.dk Thu Jan 25 09:19:23 2001
Return-Path: <zsh-workers-return-13384-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8184 invoked from network); 25 Jan 2001 09:19:22 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 25 Jan 2001 09:19:22 -0000
Received: (qmail 9156 invoked by alias); 25 Jan 2001 09:19:16 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13384
Received: (qmail 9145 invoked from network); 25 Jan 2001 09:19:15 -0000
Date: Thu, 25 Jan 2001 10:19:12 +0100 (MET)
Message-Id: <200101250919.KAA19039@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Thu, 25 Jan 2001 12:11:25 +0300
Subject: Re: Curent CVS crash on Cygwin


Andrej Borsenkow wrote:

> I got around to checking if zsh still runs on Cygwin. Looks, like no more :)
> It outputs prompt and immediately crashes after I press RETURN (or any key for
> that matter). It crashes with and without -f. I'm still struggling with this
> gdb GUI, but stack trace is:
> 
> ...
> 
> specifically it is a line with queue_signals()
> 
> I completely missed all this discussion about signal queuing - Sven, where is
> the next place to look?

It's a macro in signals.h.

Erm, I forgot to add the `mod_export's to the signal-queue-variables.

Does this patch fix it?

Bye
 Sven

Index: Src/signals.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/signals.c,v
retrieving revision 1.14
diff -u -r1.14 signals.c
--- Src/signals.c	2001/01/16 13:44:20	1.14
+++ Src/signals.c	2001/01/25 09:18:49
@@ -44,11 +44,11 @@
 /* Variables used by signal queueing */
 
 /**/
-int queueing_enabled, queue_front, queue_rear;
+mod_export int queueing_enabled, queue_front, queue_rear;
 /**/
-int signal_queue[MAX_QUEUE_SIZE];
+mod_export int signal_queue[MAX_QUEUE_SIZE];
 /**/
-sigset_t signal_mask_queue[MAX_QUEUE_SIZE];
+mod_export sigset_t signal_mask_queue[MAX_QUEUE_SIZE];
 
 /* This is only used on machines that don't understand signal sets.  *
  * On SYSV machines this will represent the signals that are blocked *

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

