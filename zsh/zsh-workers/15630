From zsh-workers-return-15630-mason-zsh=primenet.com.au@sunsite.dk Wed Aug 15 13:29:17 2001
Return-Path: <zsh-workers-return-15630-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24122 invoked from network); 15 Aug 2001 13:29:16 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 Aug 2001 13:29:16 -0000
Received: (qmail 21856 invoked by alias); 15 Aug 2001 13:29:03 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15630
Received: (qmail 21843 invoked from network); 15 Aug 2001 13:29:01 -0000
Date: Wed, 15 Aug 2001 14:28:56 +0100
From: Adam Spiers <adam@spiers.net>
To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Subject: PATCH: fix rpm caching with newer rpm
Message-ID: <20010815142856.A13416@thelonious.new.ox.ac.uk>
Reply-To: Adam Spiers <adam@spiers.net>
Mail-Followup-To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
X-Home-Page: http://www.new.ox.ac.uk/~adam/
X-OS: RedHat Linux

They changed the name of the package index.

Index: Completion/Redhat/Command/_rpm
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Redhat/Command/_rpm,v
retrieving revision 1.3
diff -u -r1.3 _rpm
--- Completion/Redhat/Command/_rpm	2001/06/05 13:48:09	1.3
+++ Completion/Redhat/Command/_rpm	2001/08/15 13:28:05
@@ -272,7 +272,10 @@
   oldp=( "$1"(mw+1) )
   (( $#oldp )) && return 0
 
-  [[ /var/lib/rpm/packages.rpm -nt "$1" ]]
+  pkg_indices=( /var/lib/rpm/{packages.rpm,Packages}(N) )
+  for pkg_index in $pkg_indices; do
+    [[ "$pkg_index" -nt "$1" ]] && return 0
+  done
 }
 
 _rpm "$@"

