From zsh-workers-return-22584-mason-zsh=primenet.com.au@sunsite.dk Fri Aug 04 11:28:20 2006
Return-Path: <zsh-workers-return-22584-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22034 invoked from network); 4 Aug 2006 11:28:17 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.4 (2006-07-25) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.7 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO,RCVD_IN_SORBS_WEB autolearn=no version=3.1.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 4 Aug 2006 11:28:17 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 84214 invoked from network); 4 Aug 2006 11:28:09 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Aug 2006 11:28:09 -0000
Received: (qmail 7409 invoked by alias); 4 Aug 2006 11:28:07 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22584
Received: (qmail 7399 invoked from network); 4 Aug 2006 11:28:07 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 4 Aug 2006 11:28:07 -0000
Received: (qmail 83942 invoked from network); 4 Aug 2006 11:28:07 -0000
Received: from ms-2.rz.rwth-aachen.de (HELO ms-dienst.rz.rwth-aachen.de) (134.130.3.131)
  by a.mx.sunsite.dk with SMTP; 4 Aug 2006 11:28:05 -0000
Received: from r220-1 (r220-1.rz.RWTH-Aachen.DE [134.130.3.31])
 by ms-dienst.rz.rwth-aachen.de
 (iPlanet Messaging Server 5.2 Patch 2 (built Jul 14 2004))
 with ESMTP id <0J3H00EPY16HNR@ms-dienst.rz.rwth-aachen.de> for
 zsh-workers@sunsite.dk; Fri, 04 Aug 2006 13:27:54 +0200 (MEST)
Received: from relay.rwth-aachen.de ([134.130.3.1])
	by r220-1 (MailMonitor for SMTP v1.2.2 ) ; Fri,
 04 Aug 2006 13:27:53 +0200 (MEST)
Received: from fsst.voodoo.lan (i577BD373.versanet.de [87.123.211.115])
	by relay.rwth-aachen.de (8.13.7/8.13.3/1) with ESMTP id k74BRq4p016414	for
 <zsh-workers@sunsite.dk>; Fri, 04 Aug 2006 13:27:53 +0200 (MEST)
Received: from hawk by fsst.voodoo.lan with local (Exim 4.62)
	(envelope-from <frank.terbeck@rwth-aachen.de>)
	id 1G8xpZ-0008Ff-BN	for zsh-workers@sunsite.dk; Fri, 04 Aug 2006 13:27:05 +0200
Date: Fri, 04 Aug 2006 13:27:05 +0200
From: Frank Terbeck <frank.terbeck@rwth-aachen.de>
Subject: _tar_archive completion with uncompressed archives && GNU tar
To: zsh workers <zsh-workers@sunsite.dk>
Mail-followup-to: zsh workers <zsh-workers@sunsite.dk>
Message-id: <20060804112705.GK30953@fsst.voodoo.lan>
MIME-version: 1.0
Content-type: text/plain; charset=iso-8859-1
Content-transfer-encoding: 7BIT
Content-disposition: inline
Operating-System: Linux 2.6.16.16 i686
User-Agent: Mutt/1.5.12-2006-07-14

Hello workers!

I experienced a problem with the completion of uncompressed tar
archives:

[snip]
zsh% autoload compinit && compinit
zsh% touch test.tar{,.gz,.bz2}
zsh% tar tvf test.tar.<TAB>
test.tar.bz2  test.tar.gz
[snap]

As you can see it doesn't complete 'test.tar'.
The _tar_archive function checks for $_cmd_variant to figure out if
the system uses the GNU version of tar and selects all compressed
archive files it finds, because GNU tar does some autosensing based on
the filename extension.
Anyway, I think that '.tar' files should be added as well.
This patch adds this behaviour:

--- _tar_archive.orig   2006-08-04 12:49:10.000000000 +0200
+++ _tar_archive        2006-08-04 12:47:48.000000000 +0200
@@ -19,7 +19,7 @@
   elif [[ "$1" = *[Ijy]* ]]; then
     _files "$expl[@]" -g '*.(tar|TAR).bz2(-.)'
   elif [[ "$_cmd_variant[$service]" == gnu ]]; then
-    _files "$expl[@]" -g '*.((tar|TAR).(gz|GZ|Z|bz2)|tgz)(-.)'
+    _files "$expl[@]" -g '*.((tar|TAR)(.gz|.GZ|.Z|.bz2|)|tgz)(-.)'
   else
     _files "$expl[@]" -g '*.(tar|TAR)(-.)'
   fi


Regards, Frank

