From zsh-workers-return-19350-mason-zsh=primenet.com.au@sunsite.dk Thu Jan 08 13:18:54 2004
Return-Path: <zsh-workers-return-19350-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24090 invoked from network); 8 Jan 2004 13:18:54 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 8 Jan 2004 13:18:54 -0000
Received: (qmail 4602 invoked by alias); 8 Jan 2004 13:18:45 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19350
Received: (qmail 4551 invoked from network); 8 Jan 2004 13:18:45 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 8 Jan 2004 13:18:45 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [202.214.225.228] by sunsite.dk (MessageWall 1.0.8) with SMTP; 8 Jan 2004 13:18:44 -0000
Received: from exchangejp.csr.com (unverified) by mailsweeperjp.CSR.COM
 (Content Technologies SMTPRS 4.3.1) with ESMTP id <T6703fb17ddc0a87901358@mailsweeperjp.CSR.COM> for <zsh-workers@sunsite.dk>;
 Thu, 8 Jan 2004 22:20:18 +0900
Received: from EXCHANGE02.csr.com ([192.168.137.45]) by exchangejp.csr.com with Microsoft SMTPSVC(5.0.2195.5329);
	 Thu, 8 Jan 2004 13:20:39 +0000
Received: from csr.com ([192.168.144.127]) by EXCHANGE02.csr.com with Microsoft SMTPSVC(5.0.2195.5329);
	 Thu, 8 Jan 2004 13:17:28 +0000
To: "Zsh hackers list" <zsh-workers@sunsite.dk>
Subject: Re: autoconf 2.5 (Re: PATCH: terminfo horor) 
In-reply-to: "Oliver Kiddle"'s message of "Thu, 08 Jan 2004 13:25:41 +0100."
             <7407.1073564741@gmcs3.local> 
Date: Thu, 08 Jan 2004 13:15:30 +0000
Message-ID: <10678.1073567730@csr.com>
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 08 Jan 2004 13:17:28.0059 (UTC) FILETIME=[C380A4B0:01C3D5E9]

Oliver Kiddle wrote:
> On 25 Dec, Andrey wrote:
> 
> > - autoconf 2.5 does not create anything in configure. Instead the sole poin
> t
> > of configure script is to create config.status - and it is config.status
> > that finally does (should do) the job of creating files, making
> > substitutions etc
> 
> Taking that, what we should probably do is have configure not create
> any config.modules files but have it do the work of config.modules.sh,
> putting the results directly into config.status in such a way that
> config.status will create the config.modules file.

That sounds reasonable.  The ac_cv_* values used in the .mdd tests
can only change if configure is rerun, so the result of the tests
is fixed.  config.modules already claims you need to rerun
`config.status --recheck' when you add a new module.

> I suggest you go ahead with the rest of the patch. Except there's a
> typo (arlier) and you could also merge zshconfig.ac into configure.ac -
> there's no need for a separate file.

I've committed it, so it's time for everyone to upgrade to 2.50 or later
(the latest is 2.59).  I have not altered the offending (or inoffensive,
depending on your point of view) three lines.

Things we should do to smooth out the use of 2.50, apart from the
config.modules problem:

- Replace acconfig.h by chunks defined within configure.ac.
- Remove AC_CYGWIN which causes 2.59 to complain.  I think it's that
  simple --- all it does is rerun AC_CANONICAL_HOST and define
  the variable CYGWIN which we don't use.  We use the host_os, which
  is the right thing to do.
- Fix problems reported with sys/ptem.h and term.h by 2.59.  These are
  relatively minor --- we are already checking for usability and
  prerequisites for these files, we just need to do it in an order
  that causes configure not to scream.  (The message doesn't turn
  up on all systems.  It says that the file was found but couldn't
  be compiled.)
- Replace the chunks in configure.ac and Src/mkmakemod.sh which handle this:

    # The standard config.status requires the pathname for the .in file to
    # be relative to the top of the source tree.  As we have it in the build
    # tree, this is a problem.  zsh's configure script edits config.status,
    # adding the feature that an input filename starting with "!" has the
    # "!" removed and is not mangled further.

  with some suitable 2.50 feature.  I think it was rumoured there was
  such a feature.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR Ltd., Science Park, Milton Road,
Cambridge, CB4 0WH, UK                          Tel: +44 (0)1223 692070


**********************************************************************
The information transmitted is intended only for the person or
entity to which it is addressed and may contain confidential 
and/or privileged material. 
Any review, retransmission, dissemination or other use of, or
taking of any action in reliance upon, this information by 
persons or entities other than the intended recipient is 
prohibited. 
If you received this in error, please contact the sender and 
delete the material from any computer.
**********************************************************************

