From zsh-users-return-15871-mason-zsh=primenet.com.au@zsh.org Tue Mar 15 18:47:38 2011
Return-Path: <zsh-users-return-15871-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26249 invoked by alias); 15 Mar 2011 18:47:38 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15871
Received: (qmail 15261 invoked from network); 15 Mar 2011 18:47:36 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at benizi.com designates 64.130.10.15 as permitted sender)
Date: Tue, 15 Mar 2011 14:40:02 -0400 (EDT)
From: "Benjamin R. Haskell" <zsh@benizi.com>
To: Lewis Thompson <purple@lewiz.net>
cc: zsh-users@zsh.org
Subject: Re: zsh doesn't complete for tar, zip, possibly other files
In-Reply-To: <AANLkTi=uth8SAmJC5yxUkzBYHAB-aMyPbpYhBUVPGiky@mail.gmail.com>
Message-ID: <alpine.LNX.2.01.1103151420350.2792@hp>
References: <AANLkTi=uth8SAmJC5yxUkzBYHAB-aMyPbpYhBUVPGiky@mail.gmail.com>
User-Agent: Alpine 2.01 (LNX 1266 2009-07-14)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed

On Tue, 15 Mar 2011, Lewis Thompson wrote:

> partlow ~ % tar xvf [hammering TAB]
>
> So clearly completion is trying to do something.  Other useful info:

If you type <ctrl+x><h> at the point where you're hammering TAB, you'll 
get some debugging information that could be useful.


> I believe these are all of my completion settings in .zshrc:
>
> [...]
> zstyle ':completion:*' matcher-list '' 'l:|=* r:|=*' 'r:|[._-]=**
> r:|=**' 'm:{[:lower:][:up
> per:]}={[:upper:][:lower:]}'

I assume this was mangled by mailing (extra newlines)?  But, even that line when 
demangled, along with this other line you listed:

> zstyle ':completion:*' file-sort access

causes the problems you describe.  I have no idea what that matcher-list 
is trying to do, but this is a full, reproducible test-case for me:

==> badzshrc <==
zstyle ':completion:*' file-sort access
zstyle ':completion:*' matcher-list '' 'l:|=* r:|=*' 'r:|[._-]=** r:|=**' 'm:{[:lower:][:upper:]}={[:upper:][:lower:]}'
autoload -Uz compinit
compinit
================

$ zsh -f
$ . ./badzshrc
$ tar xvf [Tab]

At that point, ^xh produces:

tags in context :completion::complete:tar::
     globbed-files  (_files _tar_archive _tar (eval))

Whereas the working case produces:

tags in context :completion::complete:tar::
     globbed-files  (_files _tar_archive _tar (eval))
     directories    (_files _tar_archive _tar (eval))
     all-files      (_files _tar_archive _tar (eval))

-- 
Best,
Ben

