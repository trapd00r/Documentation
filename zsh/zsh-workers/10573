From zsh-workers-return-10573-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Apr 07 09:14:51 2000
Return-Path: <zsh-workers-return-10573-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15137 invoked from network); 7 Apr 2000 09:14:50 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 7 Apr 2000 09:14:50 -0000
Received: (qmail 27939 invoked by alias); 7 Apr 2000 09:14:14 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10573
Received: (qmail 27926 invoked from network); 7 Apr 2000 09:14:13 -0000
Date: Fri, 7 Apr 2000 11:14:06 +0200 (MET DST)
Message-Id: <200004070914.LAA24126@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Fri, 7 Apr 2000 11:13:02 +0400
Subject: PATCH: Re: Path completion - cursor misplaced


Andrej Borsenkow wrote:

> With current CVS:
> 
> bor@itsrm2% gzcat /u/p/u/t/.gz<TAB>
> 
> bor@itsrm2% gzcat /u2/pub/unix/texi2html/texi2html.tar<CURSOR>.gz
> Completing file
> texi2html-1.61.tar.gz   texi2html.tar.gz
> 
> But the common prefix is texi2html?
> 
> ...
>
> zstyle ':completion:*:*:all-files' matcher 'r:|[.-]=**'
> zstyle ':completion:*:cd:*' matcher 'r:|[.-]=**'

Urgh, again trouble with that. I was always against it...

Bye
 Sven

Index: Src/Zle/compmatch.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compmatch.c,v
retrieving revision 1.3
diff -u -r1.3 compmatch.c
--- Src/Zle/compmatch.c	2000/04/03 12:14:52	1.3
+++ Src/Zle/compmatch.c	2000/04/07 09:10:58
@@ -1705,11 +1705,17 @@
 	    a->prefix = cp_cline(ca, 0);
 
 	    if (anew) {
+		int f = e->flags;
+
 		join_psfx(e, a, NULL, NULL, 0);
+		e->flags = f;
 		if (e->prefix)
 		    return max - min;
 	    } else {
+		int f = e->flags;
+
 		join_psfx(a, e, NULL, NULL, 0);
+		e->flags = f;
 		if (a->prefix)
 		    return max - min;
 	    }

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

