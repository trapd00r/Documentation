From zsh-workers-request@math.gatech.edu Thu Aug 20 19:00:26 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14692 invoked from network); 20 Aug 1998 19:00:24 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 20 Aug 1998 19:00:24 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id OAA13813;
	Thu, 20 Aug 1998 14:45:21 -0400 (EDT)
Resent-Date: Thu, 20 Aug 1998 14:45:21 -0400 (EDT)
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <980820114632.ZM4043@candle.brasslantern.com>
Date: Thu, 20 Aug 1998 11:46:32 -0700
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: zsh-workers@math.gatech.edu
Subject: Another multicomp nit
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"l8UFC.0.mN3.1x6tr"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4343
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

This bit of code:

  if [[ -n "$pref" && -z $sofar[2] && -d "${sofar}$head" ]]; then
    # Exactly matched directory: don't try to glob
    reply=("${sofar}$head")

Is obviously supposed to implement this behavior:

# Note that exactly matched directories are not expanded, e.g.
# s/zsh-2.4/s<TAB> will not expand to src/zsh-2.4old/src.

There seem to be an extremely limited number of cases where this applies.
For example,

zagzig% ls /u/s/l/z/zsh-3.1.4/s<TAB>

produces

zagzig% ls /usr/src/local/zsh/zsh-3.1.4-build/Src                     
/usr/src/local/zsh/zsh-3.1.4-build/Src
/usr/src/local/zsh/zsh-3.1.4-build/stamp-h.in
/usr/src/local/zsh/zsh-3.1.4-orig/Src
/usr/src/local/zsh/zsh-3.1.4-orig/StartupFiles
/usr/src/local/zsh/zsh-3.1.4-orig/stamp-h.in
/usr/src/local/zsh/zsh-3.1.4/Src
/usr/src/local/zsh/zsh-3.1.4/StartupFiles

Clearly, it expanded zsh-3.1.4, even though that's an exactly matched
directory.  The reason it doesn't work seems to be that, one level up,
/usr/src/local/zip also matches /u/s/l/z/.  See:

zagzig% ls /u/s/l/zsh/zsh-3.1.4/s<TAB>

produces

zagzig% ls /usr/src/local/zsh/zsh-3.1.4/Src                           
/usr/src/local/zsh/zsh-3.1.4/Src
/usr/src/local/zsh/zsh-3.1.4/StartupFiles

Is the exact-match test even worthwhile?

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

