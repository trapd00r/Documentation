From zsh-workers-return-8438-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Oct 27 08:25:52 1999
Return-Path: <zsh-workers-return-8438-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19753 invoked from network); 27 Oct 1999 08:25:43 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 27 Oct 1999 08:25:43 -0000
Received: (qmail 26210 invoked by alias); 27 Oct 1999 08:24:55 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8438
Received: (qmail 26203 invoked from network); 27 Oct 1999 08:24:55 -0000
Date: Wed, 27 Oct 1999 10:20:39 +0200 (MET DST)
Message-Id: <199910270820.KAA15249@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: re-calc list for listlist()


An another problem I found when looking at the menu-select problem:
listlist() didn't force a re-calculation either (it's used, for
example, when completing inside execute-named-command).

Bye
 Sven

diff -u oldsrc/Zle/zle_tricky.c Src/Zle/zle_tricky.c
--- oldsrc/Zle/zle_tricky.c	Tue Oct 26 20:53:21 1999
+++ Src/Zle/zle_tricky.c	Tue Oct 26 21:36:44 1999
@@ -7814,6 +7814,9 @@
     int vl = validlist, sm = smatches, nm = nmatches;
     char *oclp = complastprompt;
     Cmgroup am = amatches;
+    struct cldata odat;
+
+    memcpy(&odat, &listdat, sizeof(struct cldata));
 
     if (listshown)
 	showagain = 1;
@@ -7825,6 +7828,7 @@
     dg.ylist = (char **) makearray(l, 0, 1, &(dg.lcount), NULL, NULL);
     nmatches = dg.lcount;
     amatches = &dg;
+    listdat.valid = 0;
     ilistmatches(NULL, NULL);
     amatches = am;
 
@@ -7832,6 +7836,7 @@
     smatches = sm;
     nmatches = nm;
     complastprompt = oclp;
+    memcpy(&listdat, &odat, sizeof(struct cldata));
 
     return !dg.lcount;
 }

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

