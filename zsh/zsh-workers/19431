From zsh-workers-return-19431-mason-zsh=primenet.com.au@sunsite.dk Tue Feb 17 22:14:53 2004
Return-Path: <zsh-workers-return-19431-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1638 invoked from network); 17 Feb 2004 22:14:52 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 17 Feb 2004 22:14:52 -0000
Received: (qmail 7276 invoked by alias); 17 Feb 2004 22:14:43 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19431
Received: (qmail 7239 invoked from network); 17 Feb 2004 22:14:42 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 17 Feb 2004 22:14:42 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [4.11.9.147] by sunsite.dk (MessageWall 1.0.8) with SMTP; 17 Feb 2004 22:14:42 -0000
Received: (from schaefer@localhost)
	by candle.brasslantern.com (8.11.6/8.11.6) id i1HMEeo12331
	for zsh-workers@sunsite.dk; Tue, 17 Feb 2004 14:14:40 -0800
X-Authentication-Warning: candle.brasslantern.com: schaefer set sender to schaefer@closedmail.com using -f
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <1040217221439.ZM12330@candle.brasslantern.com>
Date: Tue, 17 Feb 2004 22:14:39 +0000
In-Reply-To: <20040217075827.1498.qmail@web10410.mail.yahoo.com>
Comments: In reply to Felix Rosencrantz <f_rosencrantz@yahoo.com>
        "jobs not listing all commands" (Feb 16, 11:58pm)
References: <20040217075827.1498.qmail@web10410.mail.yahoo.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zw <zsh-workers@sunsite.dk>
Subject: Re: jobs not listing all commands
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

Peter already patched this, but I wanted to comment on ...

On Feb 16, 11:58pm, Felix Rosencrantz wrote:
}
} ps also note another "bug" with "%j" and the prompt. when the sleep
} finishes, the prompt doesn't update.

Prompts don't update between two interactive commands, ever, no matter
what the reason.  The prompt string is computed when ZLE initializes
(just before it is first printed) and is thereafter used verbatim until
the next re-initialize.

The PS2 prompt is recomputed after each accept-line, but not while the
current line is still being edited.  So if you put %j in PS2 you can see
it change every time you hit enter with an unclosed quote or brace, but
it still doesn't change when the job status notification is printed.

Also, with respect to Peter's patch, I now get:

../../../zsh-4.0/Src/Modules/zpty.c: In function `get_pty':
../../../zsh-4.0/Src/Modules/zpty.c:176: warning: implicit declaration of function `grantpt'
../../../zsh-4.0/Src/Modules/zpty.c:176: warning: implicit declaration of function `unlockpt'
../../../zsh-4.0/Src/Modules/zpty.c:176: warning: implicit declaration of function `ptsname'
../../../zsh-4.0/Src/Modules/zpty.c:176: warning: assignment makes pointer from integer without a cast

And during "make test", the completion tests hang forever in comptestinit.
I have to manually #undef HAVE_DEV_PTMX in config.h (I have the device but
not the library routines for manipulating it, apparently).

