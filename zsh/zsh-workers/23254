From zsh-workers-return-23254-mason-zsh=primenet.com.au@sunsite.dk Sat Mar 31 23:58:07 2007
Return-Path: <zsh-workers-return-23254-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2250 invoked from network); 31 Mar 2007 23:58:05 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.8 (2007-02-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,FORGED_RCVD_HELO
	autolearn=ham version=3.1.8
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 31 Mar 2007 23:58:05 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 60510 invoked from network); 31 Mar 2007 18:31:18 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 31 Mar 2007 18:31:18 -0000
Received: (qmail 23912 invoked by alias); 31 Mar 2007 18:31:15 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23254
Received: (qmail 23900 invoked from network); 31 Mar 2007 18:31:14 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 31 Mar 2007 18:31:14 -0000
Received: (qmail 60103 invoked from network); 31 Mar 2007 18:31:14 -0000
Received: from vms044pub.verizon.net (206.46.252.44)
  by a.mx.sunsite.dk with SMTP; 31 Mar 2007 18:31:08 -0000
Received: from torch.brasslantern.com ([71.116.70.212])
 by vms044.mailsrvcs.net (Sun Java System Messaging Server 6.2-6.01 (built Apr
 3 2006)) with ESMTPA id <0JFS0086863I5C61@vms044.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Sat, 31 Mar 2007 13:30:55 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id l2VIUqpP006991; Sat,
 31 Mar 2007 11:30:53 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id l2VIUpS4006990; Sat, 31 Mar 2007 11:30:51 -0700
Date: Sat, 31 Mar 2007 11:30:51 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: Bug#416441: Patch
In-reply-to: <20070331170150.GA7626@scowler.net>
To: Clint Adams <schizo@debian.org>, zsh-workers@sunsite.dk
Cc: Erik Johansson <debian@ejohansson.se>, 416441@bugs.debian.org
Message-id: <070331113051.ZM6989@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <200703311841.27521.debian@ejohansson.se>
	<20070331170150.GA7626@scowler.net>
Comments: In reply to Clint Adams <schizo@debian.org>
 "Re: Bug#416441: Patch" (Mar 31,  1:01pm)

On Mar 31,  1:01pm, Clint Adams wrote:
} Subject: Re: Bug#416441: Patch
}
} On Sat, Mar 31, 2007 at 06:41:27PM +0200, Erik Johansson wrote:
} > The attached patch fixes the problem for me.
} 
} Thanks.
} 
} > --- _module.ORG	2007-03-31 17:47:42.000000000 +0200
} > +++ _module	2007-03-31 17:55:08.000000000 +0200
} > @@ -83,7 +83,7 @@
} >  # Fills the available modules cache
} >  _module_available_modules()
} >  {
} > -  if (( [[ -n "$MODULEPATH" ]] && [[ ${+_available_modules} -eq 0 ]] ));
} > +  if (( [[ -n $MODULEPATH ]] && [[ ${+_available_modules} -eq 0 ]] ));
} >    then
} >      _available_modules=($(find ${(e)=MODULEPATH//:/ } -xtype f -print 2>/dev/null | grep -v \.version | sed -e 's,\('${${(e)=MODULEPATH//:/\/\\\|}%\\\|}'\),,g' -e 's,^/*,,g'))
} >    fi
} 
} Why would this break zcompile?

What's up with the double parens?

    if (( ... this is parsed as a math expression ... ))

I don't know why zcompile chokes on that when the regular interpreter
does not, but it almost certainly ought to be a syntax error long before
the unmatched double-quote error that zcompile coughs up.

    if [[ -n $MODULEPATH ]] && [[ ${+_available_modules} -eq 0 ]]

without the excess parens and trailing semicolon, ought to be sufficient.

