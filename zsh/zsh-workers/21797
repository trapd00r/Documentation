From zsh-workers-return-21797-mason-zsh=primenet.com.au@sunsite.dk Sat Oct 01 22:12:09 2005
Return-Path: <zsh-workers-return-21797-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10984 invoked from network); 1 Oct 2005 22:12:06 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 1 Oct 2005 22:12:06 -0000
Received: (qmail 40765 invoked from network); 1 Oct 2005 22:12:00 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 1 Oct 2005 22:12:00 -0000
Received: (qmail 5306 invoked by alias); 1 Oct 2005 22:11:58 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21797
Received: (qmail 5296 invoked from network); 1 Oct 2005 22:11:57 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 1 Oct 2005 22:11:57 -0000
Received: (qmail 40536 invoked from network); 1 Oct 2005 22:11:57 -0000
Received: from zproxy.gmail.com (64.233.162.204)
  by a.mx.sunsite.dk with SMTP; 1 Oct 2005 22:11:56 -0000
Received: by zproxy.gmail.com with SMTP id 13so121040nzn
        for <zsh-workers@sunsite.dk>; Sat, 01 Oct 2005 15:11:55 -0700 (PDT)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:reply-to:to:subject:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references;
        b=YqIVYrCE2BFi6Az7odSI7DGfbBactR+R0WZDRICjEFZZ6HcUg0se/iiXS8SzeTg4JxHbwCGA3AhWSgakp3KB556J0Rs9q7gnYZZ8WZ8w7Jt3MYPKE9tSv68LpYZe5dE3iZ4Ny7gZDRWFGqoTgCzC7E6uUVG/39wH7/nsyImMrdo=
Received: by 10.36.10.16 with SMTP id 16mr2823457nzj;
        Sat, 01 Oct 2005 15:11:55 -0700 (PDT)
Received: by 10.36.23.13 with HTTP; Sat, 1 Oct 2005 15:11:55 -0700 (PDT)
Message-ID: <237967ef0510011511i3ae0dabcscddeb4519c7c58a5@mail.gmail.com>
Date: Sun, 2 Oct 2005 00:11:55 +0200
From: Mikael Magnusson <mikachu@gmail.com>
Reply-To: Mikael Magnusson <mikachu@gmail.com>
To: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: PATCH: source tree documentation
In-Reply-To: <200509301207.j8UC7GFk032331@news01.csr.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-2022-JP
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
References: <200509301207.j8UC7GFk032331@news01.csr.com>
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,RCVD_BY_IP 
	autolearn=ham version=3.0.4

On 9/30/05, Peter Stephenson <pws@csr.com> wrote:
> Initial go at enhancing documentation for 4.3.
>
> +The support can be explicitly enabled or disable with --enable-multibyte or
> +--disable-multibyte.  Reports of systems where multibyte support was not
> +enabled by default but --enable-multibyte resulted in a usable shell would
> +be appreciated.  The developers are not aware of any need to use
> +--disable-multibyte and this should be reported as a bug.

Using the prompt truncation things with multibyte crashes for me, or
rather some sort of busyloop occurs. It seems to only happen with
setopt printeightbit lately.


{0:09:54:~www/a}9% cd さくはらちちとれはしりちとのまはしちりれとまはし
{0:09:55:...c\M-^A\M->\M-c\M-^A\M-/\M-c\M-^A\M-^W}9% setopt printeightbit
<in other shell>
% gdb zsh 495
etc
prompttrunc (arg=34, truncchar=60, doprint=1, endchar=0) at prompt.c:1003
1003				if (*p == Inpar)
(gdb) bt
#0  prompttrunc (arg=34, truncchar=60, doprint=1, endchar=0) at prompt.c:1003
#1  0x080c68f2 in putpromptchar (doprint=1, endchar=0) at prompt.c:467
#2  0x080c86fb in promptexpand (
    s=0x8116e58
"%{\033[0m%}%{\033[1;32m%}{%{\033[0;32m%}%*%{\033[0;39m%}:%{\033[0;31m%}%40<...<%{\033[1;31m%}%~%<<%{\033[1;32m%}}%{\033[1;34m%}9%#
%(1j.%{\033[1;33m%}%j jobs
.)%(?.%{\033[0m%}.%{\033[1;31;40m%}%?%{\033[0m%} )", ns=1, rs=0x1
<Address 0x1 out of bounds>,
    Rs=0x1 <Address 0x1 out of bounds>) at prompt.c:183
#3  0xa7bab2f8 in zleread (lp=0x81031c0, rp=0x0, flags=1, context=1)
at zle_main.c:960
#4  0x0808a414 in inputline () at input.c:278
#5  0x0808aa5a in ingetc () at input.c:214
#6  0x08080f87 in ihgetc () at hist.c:240
#7  0x08096436 in gettok () at lex.c:628
#8  0x080980f6 in yylex () at lex.c:344
#9  0x080ba20a in parse_event () at parse.c:451
#10 0x080872aa in loop (toplevel=1, justonce=0) at init.c:128
#11 0x08089fc4 in zsh_main (argc=1, argv=0xafb6f6e4) at init.c:1312
#12 0x08052a6e in main (argc=1, argv=0x1) at main.c:93
(gdb) step
1008				else if (w) {
(gdb)
1003				if (*p == Inpar)
(gdb)
1008				else if (w) {
(gdb)
1003				if (*p == Inpar)

I seem to recall someone saying prompt truncation hasn't been looked
at yet, so sorry if you already know about it.

--
Mikael Magnusson

