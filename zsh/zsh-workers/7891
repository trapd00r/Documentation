From zsh-workers-return-7891-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Sep 17 02:56:15 1999
Return-Path: <zsh-workers-return-7891-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13092 invoked from network); 17 Sep 1999 02:56:12 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Sep 1999 02:56:12 -0000
Received: (qmail 15526 invoked by alias); 17 Sep 1999 02:56:05 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7891
Received: (qmail 15517 invoked from network); 17 Sep 1999 02:56:04 -0000
Date: Fri, 17 Sep 1999 03:52:38 +0100
From: Adam Spiers <adam@thelonious.new.ox.ac.uk>
To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Subject: PATCH: check for no parameters to compdef
Message-ID: <19990917035238.C23925@thelonious.new.ox.ac.uk>
Reply-To: Adam Spiers <adam@spiers.net>
Mail-Followup-To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 1.0pre2i
X-URL: http://www.new.ox.ac.uk/~adam/
X-OS: Linux 2.2.9 i686

Any call to compdef with too few parameters resulted in a rather ugly
error:

  compdef: shift: shift count must be <= $# [194]

when shift ran out of things to shift.  Here's a very crude check to
stop this happening.

Index: Completion/Core/compinit
===================================================================
RCS file: /usr/local/cvsroot/zsh/Completion/Core/compinit,v
retrieving revision 1.1.1.3
diff -u -r1.1.1.3 compinit
--- Completion/Core/compinit	1999/09/16 11:37:17	1.1.1.3
+++ Completion/Core/compinit	1999/09/17 01:43:11
@@ -152,6 +152,11 @@
 
   # Get the options.
 
+  if [[ $#* -eq 0 ]]; then
+    echo "compdef needs parameters"
+    return 1
+  fi
+  
   while getopts "anpPkd" opt; do
     case "$opt" in
     a)    autol=yes;;
@@ -175,6 +180,11 @@
   done
   shift OPTIND-1
 
+  if [[ $#* -eq 0 ]]; then
+    echo "compdef needs parameters"
+    return 1
+  fi
+  
   if [[ -z "$delete" ]]; then
     # Adding definitions, first get the name of the function name
     # and probably do autoloading.

