From zsh-workers-return-20955-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 09 17:07:39 2005
Return-Path: <zsh-workers-return-20955-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23418 invoked from network); 9 Mar 2005 17:07:37 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 9 Mar 2005 17:07:37 -0000
Received: (qmail 86035 invoked from network); 9 Mar 2005 17:07:32 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 Mar 2005 17:07:32 -0000
Received: (qmail 11090 invoked by alias); 9 Mar 2005 17:07:29 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20955
Received: (qmail 11081 invoked from network); 9 Mar 2005 17:07:29 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 9 Mar 2005 17:07:29 -0000
Received: (qmail 85753 invoked from network); 9 Mar 2005 17:07:26 -0000
Received: from mailhost1.csr.com (HELO MAILSWEEPER01.csr.com) (81.105.217.43)
  by a.mx.sunsite.dk with SMTP; 9 Mar 2005 17:07:14 -0000
Received: from exchange03.csr.com (unverified [10.100.137.60]) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.12) with ESMTP id <T6f94b020a30a6c8d01628@MAILSWEEPER01.csr.com> for <zsh-workers@sunsite.dk>;
 Wed, 9 Mar 2005 17:05:40 +0000
Received: from news01.csr.com ([10.103.143.38]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Wed, 9 Mar 2005 17:08:43 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.1/8.12.11) with ESMTP id j29H7Bo6008875
	for <zsh-workers@sunsite.dk>; Wed, 9 Mar 2005 17:07:11 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.1/8.13.1/Submit) with ESMTP id j29H7AoS008872
	for <zsh-workers@sunsite.dk>; Wed, 9 Mar 2005 17:07:11 GMT
Message-Id: <200503091707.j29H7AoS008872@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-workers@sunsite.dk
Subject: Re: Unsetting a variable that was not previously set [kind of update] 
In-reply-to: <2005-03-09T14-51-46@devnull.michael-prokop.at> 
References: <2005-03-09T14-51-46@devnull.michael-prokop.at>
Date: Wed, 09 Mar 2005 17:07:10 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 09 Mar 2005 17:08:43.0150 (UTC) FILETIME=[A5AD02E0:01C524CA]
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.5

Michael Prokop wrote:
> I found the thread "Unsetting a variable that was not previously
> set" -> http://www.zsh.org/mla/users/2003/msg00312.html in the
> zsh-ml-archive.

Yes, we didn't really reach a conclusion.

It looks like returning status 0 in this case is fairly standard
behaviour, so we probably ought to change it for future versions.
(This is on the basis that the next version is probably going to be
4.3.)

Index: README
===================================================================
RCS file: /cvsroot/zsh/zsh/README,v
retrieving revision 1.21
diff -u -r1.21 README
--- README	14 Jan 2005 13:04:49 -0000	1.21
+++ README	9 Mar 2005 17:03:38 -0000
@@ -24,78 +24,12 @@
 Possible incompatibilities
 ---------------------------
 
-Currently the only known incompatibilities between 4.2.0 and later
-versions are minor:
+Since 4.2:
 
-
-Since 4.2.1:
-
-The "test" and "[" builtins now behave more like relevant Unix standards
-suggest they should.  Previously they were a simple front-end to the same
-tests used by zsh's "[[" syntax.  (The documentation was previously cagey
-about what "test" and "[" actually did.)  "[[" has always been the
-recommended way of implementing tests within zsh.
-
-In recent versions of zsh, typing the end-of-file (EOF) character
-(typically ^D, although this can be altered with the "stty" command)
-repeatedly in the line editor printed a warning message, but never exited the
-shell.  This was a departure from the traditional behaviour of zsh and
-other shells where the shell would exit after 10 EOFs.  The traditional
-behaviour has been restored.  Also, binding a user-defined editor command
-to the EOF character now suppresses the EOF behaviour inside the line
-editor; it is possible to emulate it if desired.
-
-
-From 4.2.0 to 4.2.1:
-
-IPv6 addresses must be specified in square brackets in the zftp module and
-the function system built on top of the zftp module.
-
-Special traps for pseudosignals ZERR, DEBUG and EXIT are no longer executed
-inside other traps.  Users may well have assumed this was the case anyway
-since the behaviour was not explicity documented.  See the NEWS file for
-more detail.
-
-By default, a maximum function depth of 4096 is now compiled into the
-shell.  This may be altered during configuration; see `Function depth' in
-INSTALL.
-
-
-Some particular differences you may notice between the 4.0 and 4.2 series
-of releases:
-
-The bash-compatibility zle functions described in the zshcontrib manual
-page have been removed as a more configurable set of editing widgets for
-dealing with words have been added.  The following code in .zshrc will set
-up for bash-style word handling:
-  autoload -U select-word-style
-  select-word-style bash
-
-The `=prog' facility for expanding command paths (provided the EQUALS
-option is enabled, as it is by default) no longer expands aliases.  It was
-felt this feature was underused and confusing.
-
-In 4.0, a literal `/' was quoted in the `src' text of a substitution of the
-form `${foo/src/rep}' or ${foo//src/rep} with two backslashes.  This was
-documented, but inconsistent with normal quoting conventions and poorly
-implemented.  The `/' now requires only one backslash to quote it whether
-or not the expression occurs in double quotes.  For example:
-  % foo=word/bird
-  % print ${foo/\//-} "${foo/\//+}"
-  word-bird word+bird
-Note also the following workaround which is valid in all versions of the
-shell that support this syntax:
-  % slash=/
-  % foo=word/bird
-  % print ${foo/$slash/-} "${foo/$slash/+}"
-
-In 4.0, the -M option to bindkey used the first non-option argument to
-specify the keymap, whereas it now uses an argument to the option.  Hence:
-  bindkey -M -R keymap a-z self-insert
-needs to be rewritten as
-  bindkey -M keymap -R a-z self-insert
-The following form works in both versions:
-  bindkey -R -M keymap a-z self-insert
+The "unset" builtin now does not regard the unsetting of non-existent
+variables as an error, so can still return status 0 (depending on the
+handling of other arguments).  This appears to be the standard shell
+behaviour.
 
 Documentation
 -------------
Index: Src/builtin.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/builtin.c,v
retrieving revision 1.135
diff -u -r1.135 builtin.c
--- Src/builtin.c	6 Feb 2005 20:36:41 -0000	1.135
+++ Src/builtin.c	9 Mar 2005 17:03:40 -0000
@@ -2726,8 +2726,12 @@
 	pm = (Param) (paramtab == realparamtab ?
 		      gethashnode2(paramtab, s) :
 		      paramtab->getnode(paramtab, s));
+	/*
+	 * Unsetting an unset variable is not an error.
+	 * This appears to be reasonably standard behaviour.
+	 */
 	if (!pm)
-	    returnval = 1;
+	    continue;
 	else if ((pm->flags & PM_RESTRICTED) && isset(RESTRICTED)) {
 	    zerrnam(name, "%s: restricted", pm->nam, 0);
 	    returnval = 1;

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

**********************************************************************

