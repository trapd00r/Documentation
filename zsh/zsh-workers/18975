From zsh-workers-return-18975-mason-zsh=primenet.com.au@sunsite.dk Fri Aug 29 09:25:36 2003
Return-Path: <zsh-workers-return-18975-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15936 invoked from network); 29 Aug 2003 09:25:35 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 29 Aug 2003 09:25:35 -0000
Received: (qmail 3391 invoked by alias); 29 Aug 2003 09:25:28 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18975
Received: (qmail 3381 invoked from network); 29 Aug 2003 09:25:27 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 29 Aug 2003 09:25:27 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [193.109.254.211] by sunsite.dk (MessageWall 1.0.8) with SMTP; 29 Aug 2003 9:25:27 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-3.tower-36.messagelabs.com!1062149125!220539
X-StarScan-Version: 5.0.7; banners=-,-,-
Received: (qmail 29432 invoked from network); 29 Aug 2003 09:25:25 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-3.tower-36.messagelabs.com with SMTP; 29 Aug 2003 09:25:25 -0000
Received: from gmcs3.local ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id h7T9PPHM015251;
	Fri, 29 Aug 2003 10:25:25 +0100
Received: from gmcs3.local (localhost [127.0.0.1])
	by gmcs3.local (8.11.6/8.11.6/SuSE Linux 0.5) with ESMTP id h7T9RMk02144;
	Fri, 29 Aug 2003 11:27:23 +0200
cc: zsh-workers@sunsite.dk
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <D0124136-D990-11D7-AC81-0003930A2D56@ittpoi.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <CF1EFB86-D75A-11D7-982B-0003930A2D56@ittpoi.com> <20424.1061889099@gmcs3.local> <D0124136-D990-11D7-AC81-0003930A2D56@ittpoi.com>
To: David Remahl <david@ittpoi.com>
Subject: Re: Complicated Completions 
Date: Fri, 29 Aug 2003 11:27:22 +0200
Message-ID: <2142.1062149242@gmcs3.local>

David Remahl wrote:
> Thanks for your help!
> 
> I've now gotten started on something that I hope will work out...But  
> why doesn't this work? I have only written a small part of the  
> completion, for just the attach subcommand (verb). Try this:
> 
> type: hdiutil attach abc.dmg <tab>
> 
> Why doesn't it show the three switches -quiet, -debug and -verbose?

_arguments looks at the $words array and expects to find the command
name in the first element and other arguments thereafter. So in this
case, you need to add:
  shift 2 words
  (( CURRENT-=2 ))
before the call to _arguments.

Is it not possible for the -quiet, -debug and -verbose options to
appear before the .dmg file on the command-line though?

If so, you should be able to use just:

  attach)
    shift words
    (( CURRENT-- ))
    _arguments \
       '(-quiet -debug)-verbose' \
       '(-verbose -debug)-quiet' \
       '(-quiet -verbose)-debug' \
       '1:disk image file:_files -g  "*.(dmg|img|smi|dmgz)"' && ret=0

  ;;

I you are wondering why _xauth and _sccs don't need to shift the words
array, it is because they they have a previous call to
_arguments with this rule:
       '*::command:->subcmd' && ret=0

And the documentation for *::MESSAGE:ACTION spec says:

          With two colons before the MESSAGE, the words special array
          and the CURRENT special parameter are modified to refer only
          to the normal arguments when the ACTION is executed or
          evaluated.


>      curcontext="${curcontext%:*:*}:xauth-${cmd}:"

don't forget to change xauth to hdiutil

>              if (( CURRENT == 3 )); then
>                  _arguments \
>                      '2:disk image file:_files -g "*.(dmg|img|smi|dmgz)"' && ret=0

If this does need to stay (if the switches can only be after the .dmg
file), then you can write it as:

  _wanted files expl 'disc image file' \
      _files -g "*.(dmg|img|smi|dmgz)" && ret=0

>                           _arguments \
>                               '(-quiet -debug)-verbose'
>                               '(-verbose -debug)-quiet'


Don't forget the backslash (\) at the end of each of these lines so
that it knows to continue on the next line. I expect you copied this
over from the alwaysargs array assignment where you don't need them.

Oliver

