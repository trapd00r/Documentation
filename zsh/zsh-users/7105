From zsh-users-return-7105-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 03 19:39:28 2004
Return-Path: <zsh-users-return-7105-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13818 invoked from network); 3 Mar 2004 19:39:28 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 3 Mar 2004 19:39:28 -0000
Received: (qmail 11426 invoked by alias); 3 Mar 2004 19:39:04 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 7105
Received: (qmail 11401 invoked from network); 3 Mar 2004 19:39:03 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 3 Mar 2004 19:39:03 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [63.249.88.2] by sunsite.dk (MessageWall 1.0.8) with SMTP; 3 Mar 2004 19:39:3 -0000
Received: by binome.blorf.net (Postfix, from userid 1000)
	id 455FB20B; Wed,  3 Mar 2004 11:39:02 -0800 (PST)
Date: Wed, 3 Mar 2004 11:39:02 -0800
From: Wayne Davison <wayned@users.sourceforge.net>
To: Zsh users list <zsh-users@sunsite.dk>
Subject: Re: 4.2.0-pre-2
Message-ID: <20040303193902.GF9561@blorf.net>
References: <17958.1078322407@csr.com> <20040303185321.GE9561@blorf.net>
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="EgVrEAR5UttbsTXg"
Content-Disposition: inline
In-Reply-To: <20040303185321.GE9561@blorf.net>
User-Agent: Mutt/1.5.5.1+cvs20040105i


--EgVrEAR5UttbsTXg
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

On Wed, Mar 03, 2004 at 10:53:21AM -0800, Wayne Davison wrote:
> I noticed that someone removed the stamp-h idiom from the Makefile
> recently.

I'm attaching a better patch for Makefile.in.  The old rules had
config.h and config.modules intertwined, and this one breaks them
apart so that config.h doesn't get rebuilt when it doesn't need
to be.

Q: Does "config.modules" need to depend on config.h.in?

..wayne..

--EgVrEAR5UttbsTXg
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="stamp.patch"

--- Makefile.in	14 Feb 2004 18:50:16 -0000	1.12
+++ Makefile.in	3 Mar 2004 19:28:47 -0000
@@ -134,7 +134,11 @@ config.status: $(sdir)/configure
 $(sdir)/configure: $(sdir)/aclocal.m4 $(sdir)/aczsh.m4 $(sdir)/configure.ac
 	cd $(sdir) && autoconf
 
-config.h config.modules: $(sdir)/config.h.in config.status
+config.h: stamp-h
+stamp-h: $(sdir)/config.h.in config.status
+	cd $(dir_top) && $(SHELL) ./config.status config.h $@
+
+config.modules: $(sdir)/config.h.in config.status
 	cd $(dir_top) && $(SHELL) ./config.status $@
 
 $(sdir)/config.h.in: $(sdir)/stamp-h.in
--- configure.ac	1 Mar 2004 17:58:55 -0000	1.11
+++ configure.ac	3 Mar 2004 19:28:48 -0000
@@ -2379,6 +2379,7 @@ AC_SUBST_FILE(VERSION_MK)dnl
 AC_CONFIG_FILES(Config/defs.mk Makefile Doc/Makefile Etc/Makefile \
 Src/Makefile Test/Makefile)
 AC_CONFIG_COMMANDS([config.modules], [. ./config.modules.sh])
+AC_CONFIG_COMMANDS([stamp-h], [echo >stamp-h])
 
 AC_OUTPUT
 

--EgVrEAR5UttbsTXg--

