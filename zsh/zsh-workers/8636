From zsh-workers-return-8636-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Nov 14 17:10:50 1999
Return-Path: <zsh-workers-return-8636-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19119 invoked from network); 14 Nov 1999 17:10:49 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 14 Nov 1999 17:10:49 -0000
Received: (qmail 22652 invoked by alias); 14 Nov 1999 17:10:40 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8636
Received: (qmail 22641 invoked from network); 14 Nov 1999 17:10:38 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <991114170935.ZM27626@candle.brasslantern.com>
Date: Sun, 14 Nov 1999 17:09:35 +0000
In-Reply-To: <19991113194512.A15965@calloway.dr.lucent.com>
Comments: In reply to Dave Gaulke <gaulke@lucent.com>
        "array bug" (Nov 13,  7:45pm)
References: <19991113194512.A15965@calloway.dr.lucent.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Dave Gaulke <gaulke@lucent.com>, zsh-workers@sunsite.auc.dk
Subject: Re: array bug
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Nov 13,  7:45pm, Dave Gaulke wrote:
} Subject: array bug
}
} function arrtest
} {
} 	set -A myarray
} 	typeset -x myarray
} 	myarray[1]=arrtest
} 	print ${myarray[1]}
} }
} 
} When I run this it prints only "a" and not the expected "arrtest".

This is not the bug you think it is.

"set -A myarray" is declaring a *global* (not local to "arrtest") array
named "myarray".  It's exactly equivalent to writing

	myarray=()

"typeset -x myarray" then declares a local scalar, also named "myarray",
which hides the global.  This is a result of a recent change that makes
"export" equivalent to "typeset -gx" and not equivalent to "typeset -x".
This is a known bug.  For the time being, you should use "export" when
you mean "export".

    function arrtest
    {
    	set -A myarray
	export myarray
	myarray[1]=arrtest
	print $myarray
    }

However, since arrays can't be exported in the first place (zsh marks
them exported internally, but does not put them in the environment) it's
almost certainly the case that you shouldn't have used "typeset -x" in
the first place.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

