From zsh-workers-return-8752-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Nov 23 15:41:09 1999
Return-Path: <zsh-workers-return-8752-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10044 invoked from network); 23 Nov 1999 15:41:08 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 23 Nov 1999 15:41:08 -0000
Received: (qmail 25476 invoked by alias); 23 Nov 1999 15:40:52 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8752
Received: (qmail 25468 invoked from network); 23 Nov 1999 15:40:50 -0000
To: zsh-workers@sunsite.auc.dk
Subject: Re: PATCH: was: oops, a set -x
References: <199911231412.PAA09062@beta.informatik.hu-berlin.de>
MIME-Version: 1.0 (generated by AKEMI 1.13.2 - =?ISO-2022-JP?B?Ig==?=
 =?ISO-2022-JP?B?GyRCQTA0Y0s8GyhCIg==?=)
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@jaist.ac.jp>
Date: 24 Nov 1999 00:40:23 +0900
In-Reply-To: Sven Wischnowsky's message of "Tue, 23 Nov 1999 15:12:12 +0100 (MET)"
Message-ID: <rsqn1s543o8.fsf@crane.jaist.ac.jp>
Lines: 75
User-Agent: Chao-gnus/6.12.5 AKEMI/1.13.2 (=?ISO-2022-JP?B?GyRCQTAbKEI=?=
 =?ISO-2022-JP?B?GyRCNGNLPBsoQg==?=) FLAM-DOODLE/1.12.6
 (=?ISO-2022-JP?B?GyRCM3cbKEI=?= 10R4.0/5.0) Emacs/20.4
 (sparc-sun-solaris2.6) MULE/4.0 (HANANOEN)

In article <199911231412.PAA09062@beta.informatik.hu-berlin.de>,
  Sven Wischnowsky <wischnow@informatik.hu-berlin.de> writes:

> However, I have *not* change _telnet because, as I said, I don't have
> a version with these options. Tanaka, could you...? If I'm not
> completely mistaken it should just make it much simpler.

In reality, I don't have such telnet too.  So, I test _telnet with
following function.  I think _arguments works well.

telnet () {
  print -r - \
'Usage: telnet [-8] [-E] [-K] [-L] [-N] [-S tos] [-X atype] [-a] [-c] [-d]
	[-e char] [-k realm] [-l user] [-f/-F] [-n tracefile] [-noasynch] [-noasynctty]
	[-noasyncnet] [-r] [-s src_addr] [-t transcom] [host-name [port]]' >&2
}

Index: Completion/User/_telnet
===================================================================
RCS file: /projects/zsh/zsh/Completion/User/_telnet,v
retrieving revision 1.1.1.11
diff -u -r1.1.1.11 _telnet
--- Completion/User/_telnet	1999/11/22 13:31:19	1.1.1.11
+++ Completion/User/_telnet	1999/11/23 15:28:53
@@ -8,7 +8,7 @@
 local curcontext="$curcontext" state line expl
 typeset -A opt_args
 
-if (( ! $+_telnet_short )); then
+if (( ! $+_telnet_args )); then
   local k help="$(telnet -\? < /dev/null 2>&1)"
   local -A optionmap
   optionmap=( "[-8]" '-8[allow 8-Bit data]' \
@@ -30,34 +30,21 @@
               "[-r]" '-r[rlogin like user interface]' \
               "[-s src_addr]" '-s+[set source IP address]:src_addr:' \
               "[-x]" '-x' \
-              "[-t transcom]" '-t+:transcom:' )
-
-  _telnet_short=()
-  for k in ${(k)optionmap}
-  do
-    [[ "$help" = *"$k"* ]] &&
-      _telnet_short=( "$_telnet_short[@]" "$optionmap[$k]" )
-  done
-
-  # _arguments cannot handle following three options.
-  optionmap=( "[-noasynch]" '-noasynch' \
+              "[-t transcom]" '-t+:transcom:' \
+              "[-noasynch]" '-noasynch' \
               "[-noasyncnet]" '-noasyncnet' \
               "[-noasynctty]" '-noasynctty' )
 
-  _telnet_long=()
+  _telnet_args=()
   for k in ${(k)optionmap}
   do
     [[ "$help" = *"$k"* ]] &&
-      _telnet_long=( "$_telnet_long[@]" "$optionmap[$k]" )
+      _telnet_args=( "$_telnet_args[@]" "$optionmap[$k]" )
   done
 fi
 
-(( $#_telnet_long )) && _wanted options expl option &&
-   { ! _style options prefix-needed || [[ "$PREFIX" = [-+]* ]] } &&
-    _describe -o option _telnet_long "$expl[@]"
-
 _arguments -C -s \
-  "$_telnet_short[@]" \
+  "$_telnet_args[@]" \
   ':host:->hosts' \
   ':port:->ports'
 
-- 
Tanaka Akira

