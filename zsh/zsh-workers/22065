From zsh-workers-return-22065-mason-zsh=primenet.com.au@sunsite.dk Fri Dec 09 19:02:41 2005
Return-Path: <zsh-workers-return-22065-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4278 invoked from network); 9 Dec 2005 19:02:39 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 9 Dec 2005 19:02:39 -0000
Received: (qmail 60869 invoked from network); 9 Dec 2005 19:02:33 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 Dec 2005 19:02:33 -0000
Received: (qmail 20197 invoked by alias); 9 Dec 2005 19:02:30 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22065
Received: (qmail 20180 invoked from network); 9 Dec 2005 19:02:29 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 9 Dec 2005 19:02:29 -0000
Received: (qmail 60566 invoked from network); 9 Dec 2005 19:02:29 -0000
Received: from acolyte.scowler.net (216.254.112.45)
  by a.mx.sunsite.dk with SMTP; 9 Dec 2005 19:02:28 -0000
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id B2D1F70046; Fri,  9 Dec 2005 14:02:26 -0500 (EST)
Date: Fri, 9 Dec 2005 14:02:26 -0500
From: Clint Adams <clint@zsh.org>
To: zsh-workers@sunsite.dk
Subject: PATCH: tcp troubles
Message-ID: <20051209190226.GA6809@scowler.net>
Mail-Followup-To: zsh-workers@sunsite.dk
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.11

With the attached script, I get

Session yahoo (host www.yahoo.com, port 80 fd 3) opened OK.
Setting default TCP session yahoo
tcp_output:6: bad option: --

This is due to
+tcp_read:216> tcp_output -P '' -S yahoo -F 3 -q '--></script><script language=javascript>'


This patch solves that problem, though tcp_read fails.  A
nearly-identical script works, for reasons that elude me completely.

Index: Functions/TCP/tcp_read
===================================================================
RCS file: /cvsroot/zsh/zsh/Functions/TCP/tcp_read,v
retrieving revision 1.6
diff -u -r1.6 tcp_read
--- Functions/TCP/tcp_read	8 Aug 2005 16:49:10 -0000	1.6
+++ Functions/TCP/tcp_read	9 Dec 2005 19:00:43 -0000
@@ -216,7 +216,7 @@
     fi
 
     tcp_output -P "${TCP_PROMPT=<-[%s] }" -S $sess -F $read_fd \
-        $noprint "$line"
+        $noprint -- "$line"
     # REPLY is now set to the line with an appropriate prompt.
     tcp_lines+=($REPLY)
     typeset -g TCP_LINE="$REPLY" TCP_LINE_FD="$read_fd"

