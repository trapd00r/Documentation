From zsh-workers-return-16776-mason-zsh=primenet.com.au@sunsite.dk Thu Mar 07 08:37:50 2002
Return-Path: <zsh-workers-return-16776-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12141 invoked from network); 7 Mar 2002 08:37:49 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 7 Mar 2002 08:37:49 -0000
Received: (qmail 400 invoked by alias); 7 Mar 2002 08:37:43 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16776
Received: (qmail 389 invoked from network); 7 Mar 2002 08:37:43 -0000
From: Sven Wischnowsky <wischnow@berkom.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <15495.9839.167283.468407@wischnow.berkom.de>
Date: Thu, 7 Mar 2002 09:35:59 +0100
To: zsh-workers@sunsite.dk
Subject: Re: Core dump on completion after `for'
In-Reply-To: <7819.1015442376@csr.com>
References: <7819.1015442376@csr.com>
X-Mailer: VM 6.95 under 21.5 (patch 3) "asparagus" XEmacs Lucid


Peter Stephenson wrote:

> % ./zsh -f
> % for f in <TAB>zsh: segmentation fault (core dumped)  ./zsh -f
> 
> ...
> 
> so there are two ways to handle it:  make these three tokens special
> cases of redirections, or simply ignore the inredir flag for them.

Oh, sorry.  I've done the latter.

Bye
  Sven

Index: Src/Zle/zle_tricky.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_tricky.c,v
retrieving revision 1.33
diff -u -r1.33 zle_tricky.c
--- Src/Zle/zle_tricky.c	1 Mar 2002 10:42:02 -0000	1.33
+++ Src/Zle/zle_tricky.c	7 Mar 2002 08:36:18 -0000
@@ -1086,7 +1086,7 @@
 	    else
 		linarr = 0;
 	}
-	if (inredir) {
+	if (inredir && IS_REDIROP(tok)) {
             rdstr = rdstrbuf;
             if (tokfd >= 0)
                 sprintf(rdop, "%d%s", tokfd, tokstrings[tok]);

-- 
Sven Wischnowsky                          wischnow@berkom.de

