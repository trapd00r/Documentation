From zsh-workers-request@math.gatech.edu Mon Dec 08 19:31:03 1997
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 26548 invoked from network); 8 Dec 1997 19:31:01 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 8 Dec 1997 19:31:01 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id OAA15995;
	Mon, 8 Dec 1997 14:11:24 -0500 (EST)
Resent-Date: Mon, 8 Dec 1997 14:10:46 -0500 (EST)
Sender: rz2a022@rrz.uni-hamburg.de
Message-ID: <348C0A52.9D868E10@rrz.uni-hamburg.de>
Date: Mon, 08 Dec 1997 15:55:14 +0100
From: Bernd Eggink <eggink@rrz.uni-hamburg.de>
Organization: RRZ Uni Hamburg
X-Mailer: Mozilla 4.03 [en] (X11; I; AIX 4.1)
MIME-Version: 1.0
To: zsh-users mailing list <zsh-users@math.gatech.edu>
Subject: typeset -U broken in 3.1.2?
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"jwEHC.0.Bv3.rO4Zq"@math>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/1190
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

With respect to 'typeset -U', the manual says: "For arrays keep only the
first element of each duplications". 
This would be nice if you could define arrays with 'typedef', but you
can't, because in contrast to 'set', 'typeset' has no '-A' option (BTW,
why not??) and doesn't treat brace expressions specially.

After some experimenting I found that

1. outside a function, 'typeset -U x' works _only_ if 'x' has already
been defined as  an array;
2. inside a function, 'typeset -U x' doesn't work at all.

Look at this script:

	function f
	{
	   typeset a	# 1
	   a=(x y x y)
	   print "f: a=$a"
	   typeset -U a	# 2
	   print "f: a=$a"
	}

	unset a
	f
	print "t: a=$a"

It prints: 

	f: a=x y x y
	f: a=
	t: a=x y x y

Instead of sorting the array and discarding the duplications, the second
typeset _destroys_ the value of 'a'. And the last output line reveals
that 'a' is not local to the function, as it should be.

Any comments (or, preferably, patches)?

	Bernd
--
Bernd Eggink
Regionales Rechenzentrum der Uni Hamburg
eggink@rrz.uni-hamburg.de
http://www.rrz.uni-hamburg.de/eggink/BEggink.html

