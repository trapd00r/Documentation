From zsh-workers-return-12193-mason-zsh=primenet.com.au@sunsite.auc.dk Sat Jul 08 08:43:04 2000
Return-Path: <zsh-workers-return-12193-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2256 invoked from network); 8 Jul 2000 08:43:04 -0000
Received: from ns2.primenet.com.au (HELO primenet.com.au) (?FpexQiu0bD8sPylqldjKYzfAREIkCcqi?@203.24.36.3)
  by ns1.primenet.com.au with SMTP; 8 Jul 2000 08:43:04 -0000
Received: (qmail 1321 invoked from network); 7 Jul 2000 16:43:01 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns2.primenet.com.au with SMTP; 7 Jul 2000 16:43:01 -0000
Received: (qmail 29696 invoked by alias); 7 Jul 2000 16:42:07 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12193
Received: (qmail 29688 invoked from network); 7 Jul 2000 16:42:04 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000707163839.ZM1350@candle.brasslantern.com>
Date: Fri, 7 Jul 2000 16:38:39 +0000
In-Reply-To: <000301bfe7ec$755bc5b0$21c9ca95@mow.siemens.ru>
Comments: In reply to "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
        "RE: rlimits.c recompiled on every make" (Jul  7, 12:22pm)
References: <000301bfe7ec$755bc5b0$21c9ca95@mow.siemens.ru>
X-Mailer: Z-Mail (5.0.0 30July97)
To: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>,
        "ZSH workers mailing list" <zsh-workers@sunsite.auc.dk>
Subject: PATCH: Re: rlimits.c recompiled on every make
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Jul 7, 12:22pm, Andrej Borsenkow wrote:
} Subject: RE: rlimits.c recompiled on every make
}
} > Here's the problem.  @RLIMITS_INC_H@ is being replaced by /dev/null; I
} > suspect the mod time of /dev/null changes whenever it's written-to, so
} > it's almost always newer than rlimits.h -- hence rlimits.h is remade,
} > and so rlimits.o is also remade.
} >
} > Please re-run configure and let me know whether you see the message
} >
} >     RLIMIT MACROS NOT FOUND:  please report to developers
} 
} No, I do no get this message. It is output only if getrlimit() is found
} but RLIMIT_* macros are missing. On Cygwin there is no getrlimit() at
} all and no message.

That is as I suspected.  OK, then, the patch below should handle it.
 
} In this case it is pretty useless to build rlimit module?

All of the rlimit commands get replaced with the `bin_notavail' stub, so
that you get a more informative error message than "command not found."

Index: configure.in
===================================================================
@@ -963,6 +963,9 @@
   AC_MSG_WARN(RLIMIT MACROS NOT FOUND:  please report to developers)
 fi])
 RLIMITS_INC_H=$zsh_cv_path_rlimit_h
+if test "$RLIMITS_INC_H" = "/dev/null"; then
+  RLIMITS_INC_H=''
+fi
 dnl rlimits.h only appears in dependencies if we are actually using it.
 dnl We are using it any time we have getrlimit, though if the macros were
 dnl not found we simply awk through /dev/null and fail to find them.
Index: Src/Builtins/rlimits.mdd
===================================================================
@@ -9,7 +9,7 @@
 
 # this file will not be made if limits are unavailable
 rlimits.h: rlimits.awk @RLIMITS_INC_H@
-	$(AWK) -f $(sdir)/rlimits.awk @RLIMITS_INC_H@ > rlimits.h
+	$(AWK) -f $(sdir)/rlimits.awk @RLIMITS_INC_H@ /dev/null > rlimits.h
 	@if grep ZLIMTYPE_UNKNOWN rlimits.h >/dev/null; then \
 	    echo >&2 WARNING: unknown limits: mail rlimits.h to developers; \
 	else :; fi

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

