From zsh-workers-return-20835-mason-zsh=primenet.com.au@sunsite.dk Mon Feb 21 13:52:16 2005
Return-Path: <zsh-workers-return-20835-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25854 invoked from network); 21 Feb 2005 13:52:14 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 21 Feb 2005 13:52:14 -0000
Received: (qmail 54013 invoked from network); 21 Feb 2005 13:52:05 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 21 Feb 2005 13:52:05 -0000
Received: (qmail 26882 invoked by alias); 21 Feb 2005 13:51:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20835
Received: (qmail 26865 invoked from network); 21 Feb 2005 13:51:59 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 21 Feb 2005 13:51:59 -0000
Received: (qmail 53689 invoked from network); 21 Feb 2005 13:51:59 -0000
Received: from morda.newmail.ru (HELO flock1.newmail.ru) (212.48.140.150)
  by a.mx.sunsite.dk with SMTP; 21 Feb 2005 13:51:51 -0000
Received: (qmail 27648 invoked by alias); 21 Feb 2005 13:37:00 -0000
Message-ID: <20050221133700.27647.qmail@flock1.newmail.ru>
From: Borzenkov Andrey <arvidjaar@newmail.ru>
To: <zsh-workers@sunsite.dk>
Subject: Re: Latest CVS + ZLE_UNICODE_SUPPORT on RHEL3 
X-Priority: 3
MIME-Version: 1.0
X-Mailer: DenMail v1.0 by ORC
X-Uid: 1148242
X-RemoteIP: 212.248.25.26 (unknown)
Date: Mon, 21 Feb 2005 16:37:00 +0300
In-Reply-To: <E1D3Ddp-000JDB-00.arvidjaar-mail-ru@f30.mail.ru>
X-DWM-In-Reply-To: <1108993020.27633.denwebmail-1-INBOX@arvidjaar@newmail.ru>
Content-type: text/plain; charset="koi8-r"
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.1

Пн, 21.02.2005 17:30:25 you wrote:
>> Bart Schaefer wrote:
>> I tried defining ZLE_UNICODE_SUPPORT and building on RHEL3 (really CentOS,
>> but that shouldn't matter)

> Generally speaking, I'm not that suprised, since there are large numbers
> of odds and ends still to clear up (I haven't tried turning it on yet).
> 
> > and the build died on a syntax error in zle.h
> > (apparently the "int_t" typedef does not exist?).
> 
> That should have been wint_t.  That's guaranteed to hold either a
> wchar_t or a WEOF.
> 
> Clint and I have added various type and functions like this without there
> being any tests in configure: this is one reason we're currently relying
> on the compiler offering support. 

BTW wctype.h was missing

 If we want to relax that assumption
> later, we'll probably have to work out what to do if wchar_t is defined
> and wint_t isn't, etc.  I suppose the answer in this case is probably
> just stick with wchar_t.  But that's all Zukunftsmusik.
>

I played with this patch over weekend (with fixed wint_t and couple of other obvious mismatches). So far I was not able to make zsh work with ZLE_UNICODE_SUPPORT.

The problem seems to be that currently zle returns to zsh array of wchar_t; and zsh of course has no idea what to do with it (and treats it as array of char anyway). I started to attempt to fix it but then I realized I do not know (and there is nothing in patch) what was intended:

- convert the whole zsh to operate on wchar_t instead of char
- convert wchar_t to something else (mbchar back? UTF-8?) before passing it to main zsh code.

I would rather prefer the latter and make it UTF-8. This retains maximum compatibility, allows keep string processing functions and allows definition of character constants (zsh is full of them). It is not possible to portably define constant with wchar_t because run-time locale is not neccessarily the same as compile-time locale (consider ASCII vs EBCDIC).

BTW I finally switched to UTF-8 and stock zsh (without ZLE_UNICODE_SUPPORT enabled) displayes garbage instead of Russian file names and crashes when I attempt to complete them. Is it expected? IIRC there were some patches to allow at least passing multibyte through.

Regards

-andrey

PS Would somebody kindly look into the issue with mail.ru addresses? I can subscribe from this address and get list messages but apparently nothing I post using "arvidjaar (at) mail dot ru" ever gets posted. Thank you.
__________
www.newmail.ru -- бесплатная почта, бесплатный хостинг.

