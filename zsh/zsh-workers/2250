From zsh-workers-request@euclid.skiles.gatech.edu  Thu Oct 17 23:36:50 1996
Return-Path: zsh-workers-request@euclid.skiles.gatech.edu
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by coral.primenet.com.au (8.7.5/8.7.3) with ESMTP id XAA06911 for <mason@primenet.com.au>; Thu, 17 Oct 1996 23:36:48 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id JAA08258; Thu, 17 Oct 1996 09:22:45 -0400 (EDT)
Resent-Date: Thu, 17 Oct 1996 09:22:45 -0400 (EDT)
From: Anthony Heading <aheading@jpmorgan.com>
Message-Id: <199610171322.OAA10786@gmp-etpres1.uk.jpmorgan.com>
Subject: Re: pushd
To: schaefer@nbn.com
Date: Thu, 17 Oct 1996 14:22:37 +0100 (BST)
Cc: zefram@dcs.warwick.ac.uk, zsh-workers@math.gatech.edu
In-Reply-To: <961016141659.ZM31300@candle.brasslantern.com> from Bart Schaefer at "Oct 16, 96 02:16:58 pm"
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"Kk8Ao3.0.y02.bCZPo"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2250
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Bart wrote:
> } I have to say, the cd functions are a real mess.
> 
> There are several confusing things here.  (1) The current directory isn't
> kept on the stack (so the stack really is empty if you've never pushd'd);
> but (2) the first thing bin_cd() does is put the current directory on the
> stack; so (3) none of the functions that manipulate the stack ever see it
> in empty state, *except* (4) bin_dirs(), printdirstack(), and dstackent()
> [in subst.c], which all have to special case ~0 as equivalent to $PWD; and
> (5) all of this means that cd_new_pwd() and/or bin_cd() have to discard
> the top of the stack once the other routines are finished.
> 
> Add to this the ability to shovel random tripe into the stack with:
> [...] 
> and I agree you have a bit of a mess.

Hmmph.  I guess I'm not supposed to take that personally. :-)

Seriously, the explanation above is exactly right, and I don't think
it's as messy as all that -- it's just not documented or restructured.
And BTW the reason that it's not documented is that RC didn't want to
incorporate any of the versions of this patch that I produced, so I tried
to keep the patch as small as possible so that it wouldn't cause Zoltan
too much trouble in maintaining his releases.  But once you've got the
hang of the fact that $PWD is pushed onto the stack, the rest follows. And
pushing $PWD is a good idea, since you might be executing pushd, or have
AUTOPUSHD set, or whatever, and you don't need to specialcase.

But Bart's changes to popd make complete sense -- in retrospect I've no
idea why I didn't do the obvious optimisation.

I'm still puzzled, though, as to why Peter et al want this PUSHD_CYCLE option.
The reason it's so easy to implement is that it is, in effect, simply
aliasing pushd=cd.  Completely altering the de-facto standard definition of a
shell command is something on balance to be avoided.  To repeat my suggestion,
why not just make cd +n push the current directory?  Then it'll do exactly
the same as pushd, while being two less chars to type, and not requiring
extra emulation parameters.

Anthony

