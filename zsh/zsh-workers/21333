From zsh-workers-return-21333-mason-zsh=primenet.com.au@sunsite.dk Tue Jun 14 15:40:40 2005
Return-Path: <zsh-workers-return-21333-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19748 invoked from network); 14 Jun 2005 15:40:39 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 14 Jun 2005 15:40:39 -0000
Received: (qmail 69224 invoked from network); 14 Jun 2005 15:40:33 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 14 Jun 2005 15:40:33 -0000
Received: (qmail 17583 invoked by alias); 14 Jun 2005 15:40:30 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21333
Received: (qmail 17573 invoked from network); 14 Jun 2005 15:40:30 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 14 Jun 2005 15:40:30 -0000
Received: (qmail 68923 invoked from network); 14 Jun 2005 15:40:30 -0000
Received: from wproxy.gmail.com (64.233.184.200)
  by a.mx.sunsite.dk with SMTP; 14 Jun 2005 15:40:23 -0000
Received: by wproxy.gmail.com with SMTP id 69so1407573wra
        for <zsh-workers@sunsite.dk>; Tue, 14 Jun 2005 08:40:22 -0700 (PDT)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:reply-to:to:subject:cc:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references;
        b=O87I96ppIa0AmJVzfTBpC9ZWV+huzH9jGu1z3fN5o5Lp+hRr6vWvUV7wfUED7UDHWmlNO5OAOSkZCLpaQgKCNjYLZD1Uq5ZPvgojcqau+rWJEZcuvjX7WBH8uuKr3qLfbU6yT3fGpkFpCpewS5YGSzap1pUroqr2DpSMuSqvzIs=
Received: by 10.54.41.32 with SMTP id o32mr3285078wro;
        Tue, 14 Jun 2005 08:40:22 -0700 (PDT)
Received: by 10.54.37.58 with HTTP; Tue, 14 Jun 2005 08:40:21 -0700 (PDT)
Message-ID: <cf7bbda905061408401b223287@mail.gmail.com>
Date: Tue, 14 Jun 2005 17:40:22 +0200
From: Ulf Magnusson <ulfalizer@gmail.com>
Reply-To: Ulf Magnusson <ulfalizer@gmail.com>
To: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: Wierd autoload problems with nested directories
Cc: zsh-workers@sunsite.dk
In-Reply-To: <1050614030540.ZM6143@candle.brasslantern.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline
References: <cf7bbda9050613175557b9c4a@mail.gmail.com>
	 <1050614030540.ZM6143@candle.brasslantern.com>
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.3 required=6.0 tests=AWL,BAYES_00,RCVD_BY_IP 
	autolearn=ham version=3.0.2
X-Spam-Hits: -2.3

On 6/14/05, Bart Schaefer <schaefer@brasslantern.com> wrote:
> On Jun 14,  2:55am, Ulf Magnusson wrote:
> }
> } fpath=3D(/home/ulf/lib/zsh/completions $fpath)
> } autoload -U $fpath[1]/*(:t)
> }
> } fpath=3D(/home/ulf/lib/zsh $fpath)
> } autoload -U $fpath[1]/*(:t)
>=20
> You might note that this will result in the "completions" subdirectory
> being treated as the name of a function for autoloading.  You probably
> should be doing
>=20
>     autoload -U $fpath[1]/*(.:t)
>=20

You're right of course.

> Also please note that the location from which the function is loaded
> depends on the value of $fpath at the time you call the function, NOT
> upon the value of $fpath at the time you run "autoload".
>=20
> } print -l ${fpath[1,3]} yields
> }
> } /home/ulf/lib/zsh/completions
> } /home/ulf/lib/zsh
> } /usr/local/share/zsh/site-functions
> }
> } , as expected.
>=20
> That's certainly not what *I* would have expected.  If the two fpath
> assignments really do appear in the order that you show them, I would
> expect:
>=20
>     /home/ulf/lib/zsh
>     /home/ulf/lib/zsh/completions
>     /usr/local/share/zsh/site-functions
>=20

Another mistake there, the two fpath=3D / autoload pairs appear in the
opposite order in my .zshrc.

> Also, I'd have expected /usr/local/share/zsh/$ZSH_VERSION/functions
> (for suitable expansion of $ZSH_VERSION) to appear in the list.

/usr/local/share/zsh/$ZSH_VERSION/functions doesn't show up in my
fpath even if I comment out all fpath-altering lines in my .zshrc.
Only the subdirectories of /usr/local/share/zsh/$ZSH_VERSION/functions
do. It shouldn't be a problem though, since no functions are stored it
the base directory anyway.

>=20
> } For some reason, my completions will only work ('work' as in zsh not
> } using its default completion behaviour for the context in question) if
> } I place them in /home/ulf/lib/zsh.
>=20
> At what point amidst all of this do you run "compinit"?
>=20
> Merely autoloading a completion function isn't good enough -- compinit
> has to examine the file and read the #compdef line.  That means you must
> not run compinit until after you've added to fpath all the directories
> where completion functions might be found.
>=20

I ran compinit before autoload:ing the functions in
/home/ulf/lib/zsh/completions. Moving the call after the autoload
fixed my problems. The user-friendly guide could have been clearer in
telling you that you need to call compinit after setting up fpath. I
only skimmed the manual (it's often way over my head as a zsh newbie),
so I don't know if it's clearer on this point. Thanks for the help!

Ulf

