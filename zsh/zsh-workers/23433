From zsh-workers-return-23433-mason-zsh=primenet.com.au@sunsite.dk Sun May 13 18:38:59 2007
Return-Path: <zsh-workers-return-23433-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10447 invoked from network); 13 May 2007 18:38:57 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.0 (2007-05-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=no
	version=3.2.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 13 May 2007 18:38:57 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 19899 invoked from network); 13 May 2007 18:38:50 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 13 May 2007 18:38:50 -0000
Received: (qmail 17053 invoked by alias); 13 May 2007 18:38:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23433
Received: (qmail 17043 invoked from network); 13 May 2007 18:38:47 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 13 May 2007 18:38:47 -0000
Received: (qmail 19609 invoked from network); 13 May 2007 18:38:47 -0000
Received: from mtaout02-winn.ispmail.ntl.com (81.103.221.48)
  by a.mx.sunsite.dk with SMTP; 13 May 2007 18:38:43 -0000
Received: from aamtaout02-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout02-winn.ispmail.ntl.com with ESMTP
          id <20070513183842.OUFA12560.mtaout02-winn.ispmail.ntl.com@aamtaout02-winn.ispmail.ntl.com>
          for <zsh-workers@sunsite.dk>; Sun, 13 May 2007 19:38:42 +0100
Received: from pwslaptop.csr.com ([81.107.45.67])
          by aamtaout02-winn.ispmail.ntl.com with ESMTP
          id <20070513183842.ZPND17393.aamtaout02-winn.ispmail.ntl.com@pwslaptop.csr.com>
          for <zsh-workers@sunsite.dk>; Sun, 13 May 2007 19:38:42 +0100
Received: from pwslaptop.csr.com (pwslaptop.csr.com [127.0.0.1])
	by pwslaptop.csr.com (8.13.8/8.13.7) with ESMTP id l4DIb5I1004229
	for <zsh-workers@sunsite.dk>; Sun, 13 May 2007 19:37:07 +0100
Message-Id: <200705131837.l4DIb5I1004229@pwslaptop.csr.com>
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: PATCH: Max timeout in ZLE type wrong
Date: Sun, 13 May 2007 19:37:05 +0100

My smart new 64-bit laptop is running Fedora Core 6 X86_64 (everything
works!  Printing over Bluetooth, 802.11a with AES encryption, the SD
card reader, playing DVDs, the mute button at the top...) and gcc
pointed out that I'm shifting an int by the size of a long.  This made
ZMAXTIMEOUT 0 if ints were 32 bits and longs 64 bits.  The cast is in
the wrong place.

I believe this was new in 4.3.3/4.

Index: Src/Zle/zle_main.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_main.c,v
retrieving revision 1.95
diff -u -r1.95 zle_main.c
--- Src/Zle/zle_main.c	8 Feb 2007 10:43:30 -0000	1.95
+++ Src/Zle/zle_main.c	13 May 2007 18:30:49 -0000
@@ -425,7 +425,7 @@
      * there's no general way to fix up if that's wrong.
      */
     ZTM_MAX
-#define	ZMAXTIMEOUT	((time_t)(1 << (sizeof(time_t)*8-11)))
+#define	ZMAXTIMEOUT	((time_t)1 << (sizeof(time_t)*8-11))
 };
 
 struct ztmout {

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

