From zsh-workers-return-15056-mason-zsh=primenet.com.au@sunsite.dk Sun Jun 24 03:25:50 2001
Return-Path: <zsh-workers-return-15056-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10302 invoked from network); 24 Jun 2001 03:25:49 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 24 Jun 2001 03:25:49 -0000
Received: (qmail 22031 invoked by alias); 24 Jun 2001 03:25:04 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15056
Received: (qmail 22007 invoked from network); 24 Jun 2001 03:25:03 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010624032357.ZM8627@candle.brasslantern.com>
Date: Sun, 24 Jun 2001 03:23:57 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.dk
Subject: PATCH: magic-space improvement
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

This was originally posted in 14497, at which time I said I'd commit it
after the 4.0.1 release; it makes magic-space respect !".

Index: Src/Zle/zle_tricky.c
===================================================================
RCS file: /extra/cvsroot/zsh/zsh-4.0/Src/Zle/zle_tricky.c,v
retrieving revision 1.3
retrieving revision 1.4
diff -c -r1.3 -r1.4
--- Src/Zle/zle_tricky.c	2001/05/17 15:58:42	1.3
+++ Src/Zle/zle_tricky.c	2001/05/28 05:30:55	1.4
@@ -2239,9 +2239,13 @@
 int
 magicspace(char **args)
 {
+    char *bangq;
     int ret;
     c = ' ';
-    if (!(ret = selfinsert(args)))
+    for (bangq = (char *)line; (bangq = strchr(bangq, bangchar)); bangq += 2)
+	if (bangq[1] == '"' && (bangq == (char *)line || bangq[-1] != '\\'))
+	    break;
+    if (!(ret = selfinsert(args)) && (!bangq || bangq + 2 > (char *)line + cs))
 	doexpandhist();
     return ret;
 }

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

