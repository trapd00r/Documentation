From zsh-users-return-6761-mason-zsh=primenet.com.au@sunsite.dk Tue Nov 11 16:10:52 2003
Return-Path: <zsh-users-return-6761-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18335 invoked from network); 11 Nov 2003 16:10:51 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 11 Nov 2003 16:10:51 -0000
Received: (qmail 2175 invoked by alias); 11 Nov 2003 16:10:30 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 6761
Received: (qmail 2113 invoked from network); 11 Nov 2003 16:10:29 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 11 Nov 2003 16:10:29 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [193.109.254.211] by sunsite.dk (MessageWall 1.0.8) with SMTP; 11 Nov 2003 16:10:29 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-15.tower-36.messagelabs.com!1068567028!1754896
X-StarScan-Version: 5.1.13; banners=-,-,-
Received: (qmail 12413 invoked from network); 11 Nov 2003 16:10:28 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-15.tower-36.messagelabs.com with SMTP; 11 Nov 2003 16:10:28 -0000
Received: from gmcs3.local ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id hABGAOAb008560
	for <zsh-users@sunsite.dk>; Tue, 11 Nov 2003 16:10:27 GMT
Received: from gmcs3.local (localhost [127.0.0.1])
	by gmcs3.local (8.11.6/8.11.6/SuSE Linux 0.5) with ESMTP id hABGDrQ11781
	for <zsh-users@sunsite.dk>; Tue, 11 Nov 2003 17:13:53 +0100
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <8193.1068564272@csr.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <8193.1068564272@csr.com>
To: Zsh users <zsh-users@sunsite.dk>
Subject: Re: Completion function for bitkeeper? 
Date: Tue, 11 Nov 2003 17:13:53 +0100
Message-ID: <11779.1068567233@gmcs3.local>

Peter wrote:

> Hmm... isn't the problem that the $expl set at this point and passed
> down to _bar ultimately ends up getting passed to compadd (maybe
> indirectly), while _bar may add its own options?  I've seen this sort of

It never should be passed to compadd. _bar or some other function would
have to use $expl without declaring it local and setting it itself.

If you've seen problems, there must be a missing local declaration for
expl somewhere.

If you look inside _all_labels and _description, you will see that any
existing value in expl (assuming that is what is passed as the name
parameter) is thrown away with the new value assigned to it. So the
only way that an old $expl can get used is by some other completion
function using "$expl[@]" without declaring expl local.

expl is only ever intended to be used temporarily. It is not part of
any mechanism by which information is passed down through the
completion system.

> thing when trying to sort out the sorting, i.e. the -J and -V options to
> compadd.  Often one of them's already lurking in $expl at the point
> where I want to propagate my choice of option down through the system.

Are you sure it isn't lurking in the positional parameters.

Oliver

