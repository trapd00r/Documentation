From zsh-workers-return-25103-mason-zsh=primenet.com.au@sunsite.dk Sun May 25 10:09:00 2008
Return-Path: <zsh-workers-return-25103-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20517 invoked from network); 25 May 2008 10:08:58 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 May 2008 10:08:58 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 60121 invoked from network); 25 May 2008 10:08:53 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 25 May 2008 10:08:53 -0000
Received: (qmail 4579 invoked by alias); 25 May 2008 10:08:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25103
Received: (qmail 4562 invoked from network); 25 May 2008 10:08:49 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 25 May 2008 10:08:49 -0000
Received: from mail.o2.co.uk (sidious.london.02.net [82.132.130.152])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 81A7D8059114
	for <zsh-workers@sunsite.dk>; Sun, 25 May 2008 12:08:45 +0200 (CEST)
Received: from sc.homeunix.net (78.105.216.138) by mail.o2.co.uk (8.0.013.3) (authenticated as stephane.chazelas)
        id 480CEB800714280D; Sun, 25 May 2008 11:08:45 +0100
Received: from chazelas by sc.homeunix.net with local (Exim 4.69)
	(envelope-from <stephane_chazelas@yahoo.fr>)
	id 1K0D9g-0008G7-Ek; Sun, 25 May 2008 11:08:44 +0100
Date: Sun, 25 May 2008 11:08:44 +0100
From: Stephane Chazelas <Stephane_Chazelas@yahoo.fr>
To: zsh-workers@sunsite.dk, 482346@bugs.debian.org
Subject: Re: Bug#482346: zsh doesn't always wait for its children (->
	zombie)
Message-ID: <20080525100844.GA31642@sc.homeunix.net>
Mail-Followup-To: zsh-workers@sunsite.dk, 482346@bugs.debian.org
References: <20080521235008.GA5600@ay.vinc17.org> <20080521235930.GW7056@prunille.vinc17.org> <20080522233327.GA24953@scru.org> <080523073940.ZM13804@torch.brasslantern.com> <20080523145722.GA12096@scru.org> <20080523224305.GN7056@prunille.vinc17.org> <20080524025556.GA30511@scru.org> <20080524124445.GQ7056@prunille.vinc17.org> <20080524234002.GA35143@redoubt.spodhuis.org> <20080525004101.GT7056@prunille.vinc17.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-15
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <20080525004101.GT7056@prunille.vinc17.org>
User-Agent: Mutt/1.5.16 (2007-09-19)
X-Virus-Scanned: ClamAV 0.91.2/7231/Sun May 25 04:38:20 2008 on bifrost
X-Virus-Status: Clean

On Sun, May 25, 2008 at 02:41:01AM +0200, Vincent Lefevre wrote:
> On 2008-05-24 16:40:02 -0700, Phil Pennock wrote:
> > Since you're on a rarer architecture that doesn't see so much Linux
> > kernel debugging, I'd be inclined to look at what has changed in the
> > kernel's architecture-specific signal handling code.  (But see below).
> 
> I don't know if the bug is new. I've never killed vlc in such a way
> in the past. The current kernel is linux-image-2.6.24-1-powerpc
> 2.6.24-7.
> 
> > Further, it's strange that zombies are contributing to load average; if
> > zsh is gone (killed off and no longer even possibly stuck in a tight
> > loop)  and there's the zombie and init left, then there shouldn't be
> > anything contributing to load avg.
> 
> Yes, that's strange.

Now, what happens if the main thread in a multithread
process dies and other threads remain?

Anyway one process can at most contribute 1 point to the load
average, so there must be more, if they don't show in top, that
could be either that they are created and destroyed too fast or
that they are threads.

zombies are not processes so cannot contribute to load average.

> 
> > If you use tools such as top(1), what processes are they attributing the
> > load to?
> 
> None, and the CPU is idle:
> 
> top - 02:31:55 up 22:19,  6 users,  load average: 4.09, 4.24, 4.25
> Tasks: 117 total,   1 running, 115 sleeping,   0 stopped,   1 zombie

Could you try top -H (to see threads) and the same thing with
pdksh?

I'd bet for a kernel and/or pthread and/or vlc issue.

-- 
Stéphane

