From zsh-users-return-3167-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Jun 15 08:14:58 2000
Return-Path: <zsh-users-return-3167-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18158 invoked from network); 15 Jun 2000 08:14:56 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 Jun 2000 08:14:56 -0000
Received: (qmail 12927 invoked by alias); 15 Jun 2000 08:14:29 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 3167
Received: (qmail 12920 invoked from network); 15 Jun 2000 08:14:26 -0000
Date: Thu, 15 Jun 2000 10:14:24 +0200 (MET DST)
Message-Id: <200006150814.KAA05453@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-users@sunsite.auc.dk
In-reply-to: Andy Spiegl's message of Wed, 14 Jun 2000 19:08:12 +0200
Subject: Re: menu-select in 3.1.9


Andy Spiegl wrote:

> > } I just upgraded from 3.1.7-pre4 to 3.1.9 and menu-selection isn't working
> > } anymore. :-(
> > 
> > I think it's working in the release version of 3.1.9, but not in the most
> > recent CVS snapshot.
> Actually I thought I installed the release version.  Hm...
> So, it's bug, not my problem?

Yes, fixed by the patch below (workers/11890).

Bye
 Sven

Index: Src/Zle/complist.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/complist.c,v
retrieving revision 1.26
diff -u -r1.26 complist.c
--- Src/Zle/complist.c	2000/06/13 10:49:19	1.26
+++ Src/Zle/complist.c	2000/06/14 06:37:56
@@ -1493,6 +1493,8 @@
 
     amatches = dat->matches;
 
+    noselect = 0;
+
     if ((minfo.asked == 2 && mselect < 0) || nlnct >= lines) {
 	showinglist = 0;
 	amatches = oamatches;
@@ -1629,8 +1631,6 @@
     int space, lbeg = 0, step = 1, wrap, pl = nlnct, broken = 0, first = 1;
     char *s;
 
-    if (!mtab)
-	return 0;
     if (fdat || (dummy && (!(s = getsparam("MENUSELECT")) ||
 			   (dat && dat->num < atoi(s))))) {
 	if (fdat) {
@@ -1651,7 +1651,7 @@
     mhasstat = (mstatus && *mstatus);
     fdat = dat;
     selectlocalmap(mskeymap);
-    noselect = 0;
+    noselect = 1;
     while ((menuacc &&
 	    !hasbrpsfx(*(minfo.cur), minfo.prebr, minfo.postbr)) ||
 	   (((*minfo.cur)->flags & (CMF_NOLIST | CMF_MULT)) &&

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

