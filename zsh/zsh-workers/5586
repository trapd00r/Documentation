From zsh-workers-return-5586-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Mar 01 15:33:22 1999
Return-Path: <zsh-workers-return-5586-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29893 invoked from network); 1 Mar 1999 15:33:20 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 1 Mar 1999 15:33:20 -0000
Received: (qmail 11900 invoked by alias); 1 Mar 1999 15:32:54 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5586
Received: (qmail 11884 invoked from network); 1 Mar 1999 15:32:52 -0000
Date: Mon, 1 Mar 1999 16:32:09 +0100 (MET)
Message-Id: <199903011532.QAA15535@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: jarausch@numa1.igpm.rwth-aachen.de's message of Mon, 1 Mar 1999
	16:12:11 +0100 (CST)
Subject: Re: pws-10 +  completion broken ?


Helmut Jarausch wrote:

> Hi,
> I've just install pws-10 plus patches upto 5579.
> 
> Now the (simplest) completion seems broken.
> 
> Assume there is a file  ChangeLog
> 
> typing
> 
> cat Chan<Tab>
> just clears the command line.
> 
> Have I missed something?

No, I have missed something, two braces to be more exact. But that
also revealed another bug in addmatch().

Sorry!

Bye
 Sven

diff -u os/Zle/zle_tricky.c Src/Zle/zle_tricky.c
--- os/Zle/zle_tricky.c	Mon Mar  1 13:20:07 1999
+++ Src/Zle/zle_tricky.c	Mon Mar  1 16:28:36 1999
@@ -4347,6 +4347,7 @@
 
     if (incompfunc)
 	s = dupstring(s);
+    e = s + sl;
     if (!addwhat) {
 	test = 1;
     } else if (addwhat == -1 || addwhat == -5 || addwhat == -6 ||
@@ -6580,11 +6581,12 @@
     if ((t = cc->mask & CC_BUILTINS))
 	/* Add builtins. */
 	dumphashtable(builtintab, t | (cc->mask & (CC_DISCMDS|CC_EXCMDS)));
-    if ((t = cc->mask & CC_EXTCMDS))
+    if ((t = cc->mask & CC_EXTCMDS)) {
 	/* Add external commands */
 	if (isset(HASHLISTALL))
 	    cmdnamtab->filltable(cmdnamtab);
 	dumphashtable(cmdnamtab, t | (cc->mask & (CC_DISCMDS|CC_EXCMDS)));
+    }
     if ((t = cc->mask & CC_RESWDS))
 	/* Add reserved words */
 	dumphashtable(reswdtab, t | (cc->mask & (CC_DISCMDS|CC_EXCMDS)));

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

