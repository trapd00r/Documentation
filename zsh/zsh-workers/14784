From zsh-workers-return-14784-mason-zsh=primenet.com.au@sunsite.dk Thu Jun 07 09:41:25 2001
Return-Path: <zsh-workers-return-14784-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28620 invoked from network); 7 Jun 2001 09:41:24 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 7 Jun 2001 09:41:24 -0000
Received: (qmail 9468 invoked by alias); 7 Jun 2001 09:41:03 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14784
Received: (qmail 9444 invoked from network); 7 Jun 2001 09:41:02 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer goliath.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: <zsh-workers@sunsite.dk>
Subject: Modules dependencies RE: PATCH: zftp/tcp abstraction
Date: Thu, 7 Jun 2001 13:41:10 +0400
Message-ID: <000701c0ef35$fc04ebe0$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
Importance: Normal
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4522.1200
In-Reply-To: <000601c0ef29$cd081350$21c9ca95@mow.siemens.ru>


>
> bor@itsrm2% zmodload -u zsh/zftp
> bor@itsrm2% zsh
> bor@itsrm2% zmodload zsh/zftp
> bor@itsrm2% zftp open localhost
> ld.so: zsh: symbol not found: zsh_getipnodebyname
> zsh: killed     zsh
>

Index: Src/Modules/zftp.mdd
+moddeps="zsh/net/tcp"

The problem is, it is currently ignored for modules without auto stuff.
Dependencies are put only in main zsh in Src/bltinmods.list.

To make it work in general every module needs a standard function, let's
call it dep_, that is autogenerated out of moddeps and called before module
is attempted to be loaded to register dependencies. We may need the
counterpart to remove dependencies when module is unloaded (seems
reasonable).

-andrej

