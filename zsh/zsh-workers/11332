From zsh-workers-return-11332-mason-zsh=primenet.com.au@sunsite.auc.dk Fri May 12 01:46:55 2000
Return-Path: <zsh-workers-return-11332-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1467 invoked from network); 12 May 2000 01:46:53 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 12 May 2000 01:46:53 -0000
Received: (qmail 25016 invoked by alias); 12 May 2000 01:46:40 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11332
Received: (qmail 24985 invoked from network); 12 May 2000 01:46:38 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000512014633.ZM181@candle.brasslantern.com>
Date: Fri, 12 May 2000 01:46:32 +0000
In-Reply-To: <hvoln1gam07.fsf@serein.m17n.org>
Comments: In reply to Tanaka Akira <akr@m17n.org>
        "_complete_debug causes core dump." (May 12,  5:07am)
References: <hvoln1gam07.fsf@serein.m17n.org>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: Re: _complete_debug causes core dump.
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On May 12,  5:07am, Tanaka Akira wrote:
} Subject: _complete_debug causes core dump.
}
} _complete_debug causes core dump as follows.

It's not _complete_debug, it's _message.  If you call _message when there
are no matches (which _complete_debug does in this case), makecomplist()
returns 1 and docompletion() derefs a null pointer.  If you don't call
_message (the case when _main_complete is called directly) makecomplist()
returns 0 and most of docompletion() is bypassed by a goto.

This did lead me to find a problem with _complete_debug, though.  The
change to the value of $w is just because I decided it looks nicer.

Index: Completion/Commands/_complete_debug
===================================================================
@@ -5,8 +5,9 @@
 
 (( $+_debug_count )) || integer -g _debug_count
 local tmp=${TMPPREFIX}${$}${words[1]:t}$[++_debug_count]
-local w="${(qqq)words}"
+local w="${(qq)words}"
 
+exec 3>&-	# Too bad if somebody else is using it ...
 [[ -t 2 ]] && exec 3>&2 2>| $tmp
 
 setopt xtrace
@@ -14,7 +15,7 @@
 integer ret=$?
 unsetopt xtrace
 
-[[ -t 2 ]] || {
+[[ -t 3 ]] && {
     ## Calling "print -s" during completion is presently broken.
     # _message -r "Trace output left in $tmp (up-history to view)"
     # print -sR "${VISUAL:-${EDITOR:-${PAGER:-more}}} $tmp ;: $w"



-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

