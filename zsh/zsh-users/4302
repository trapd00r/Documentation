From zsh-users-return-4302-mason-zsh=primenet.com.au@sunsite.dk Mon Oct 01 06:38:12 2001
Return-Path: <zsh-users-return-4302-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19755 invoked from network); 1 Oct 2001 06:38:11 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 1 Oct 2001 06:38:11 -0000
Received: (qmail 22372 invoked by alias); 1 Oct 2001 06:38:00 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4302
Received: (qmail 22359 invoked from network); 1 Oct 2001 06:37:59 -0000
Date: Mon, 1 Oct 2001 08:37:58 +0200
From: Phil Pennock <Phil.Pennock@globnix.org>
To: zsh-users@sunsite.dk
Subject: Re: get the number of active jobs to show in the prompt?
Message-ID: <20011001083758.A12916@globnix.org>
Mail-Followup-To: zsh-users@sunsite.dk
References: <200110010600.f9160iq10821@bang.houseoflove> <20011001021221.A4623@astaroth.sweth.net>
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-md5;
	protocol="application/pgp-signature"; boundary="zhXaljGHf11kAtnf"
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <20011001021221.A4623@astaroth.sweth.net>; from svc@sweth.net on Mon, Oct 01, 2001 at 02:12:22AM -0400
X-Disclaimer: Any views expressed in this message, where not explicitly
	attributed otherwise, are mine and mine alone.  Such views
	do not necessarily coincide with those of any organisation
	or company with which I am or have been affiliated.
X-No-Archive: yes


--zhXaljGHf11kAtnf
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

On 2001-10-01 at 02:12 -0400, Sweth Chandramouli wrote:
> 	zsh spawns a subshell for the LHS of a pipe, rather than
> the RHS, which lets you do things like=20
>=20
> $ do_something | read VAR
>=20
> 	and have VAR still be set.  That means that jobs in your
> example is being run in a subshell where there _aren't_ any background
> jobs.  The only way I can think of offhand to get the info from jobs
> would be to redirect the output of jobs to a temp file and then use that
> to build your prompt; that's not very efficient, however.  I don't know
> if there's some other way to get that info from the shell.

I picked this up from zefram, I think:

 jobs % >& /dev/null && psvar[1]=3D"" || psvar[1]=3D()

Actually, what I have is this:
precmd () {
	local exitstatus=3D$?
	psvar[1]=3DSIG=20
	[[ $exitstatus -ge 128 ]] && psvar[1]=3DSIG$signals[$exitstatus-127]=20
	[[ $psvar[1] =3D SIG ]] && psvar[1]=3D$exitstatus=20
	jobs % >& /dev/null && psvar[2]=3D""  || psvar[2]=3D()=20
}
[ switch PS1 depending upon $TERM, but for xterm: ]
PS1=3D': %2(L.%U[%L]%u.)%(?..%B{%v}%b)%(2v:+:-)%n@%m:%l(%!)%30<..<%~%#; '

The key thing is the %(2v:+:-)  --  psvar[2] was set depending upon
whether or not there are background jobs, %(2v:+:-) therefore gives a
'+' if there are background jobs, or a '-' if not.

I _really_ miss having +/- indication of background jobs when forced to
use bash.
--=20
<-------- The information went data way

--zhXaljGHf11kAtnf
Content-Type: application/pgp-signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.6 (OpenBSD)

iD8DBQE7uA9GfDS04Uzk9lURAhqnAJ9krMHG4gIllVoW+C1gEx7I+rG67wCffjhk
K6n+uq/G8zqwbJIraw+UeTs=
=0nYe
-----END PGP SIGNATURE-----

--zhXaljGHf11kAtnf--

