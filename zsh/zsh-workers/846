From hzoli@cs.elte.hu Fri Mar 22 09:09:04 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3) with ESMTP id JAA04666 for <mason@werple.mira.net.au>; Fri, 22 Mar 1996 09:08:53 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id QAA07058; Thu, 21 Mar 1996 16:42:14 -0500 (EST)
Resent-Date: Thu, 21 Mar 1996 16:42:14 -0500 (EST)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199603212141.WAA06949@bolyai.cs.elte.hu>
Subject: Re: zsh on IRIX 6.1
To: jmm@herakles.jpl.nasa.gov (Jan Martin)
Date: Thu, 21 Mar 1996 22:41:29 +0100 (MET)
Cc: zsh-workers@math.gatech.edu
In-Reply-To: <9603201333.ZM13337@herakles.jpl.nasa.gov> from Jan Martin at "Mar 20, 96 01:33:49 pm"
Organization: Dept. of Comp. Sci., Eotvos University, Budapest, Hungary
Phone: (36 1)2669833 ext: 2667, home phone: (36 1) 2752368
X-Mailer: ELM [version 2.4ME+ PL11 (25)]
MIME-Version: 1.0
Content-Type: application/pgp; format=text; x-action=sign
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"qzgaI1.0.Ck1.rqSKn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/846
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 3041
Status: OR

-----BEGIN PGP SIGNED MESSAGE-----

> auroch% ./zsh
> ~/zsh-2.6-beta13-hzoli13/Src
> auroch% print $ZSH_VERSION
> 2.6-beta13-hzoli13
> auroch% set
> zsh: bus error (core dumped)  ./zsh
> 
> This error also occurs in version 2.6-beta10, but not on our other
> SGIs running IRIX 5.3.  I have a feeling the problem could be related
> to the fact that 6.1 is a 64-bit operating system with 64-bit pointers
> while 5.3 is still 32-bit, but the compiler doesn't seem to complain
> about any mismatch of pointers to ints, as happened with an earlier
> version of zsh.

Try this patch, and tell me if it solves your problem.  This patch should
apply cleanly to the vanilla version (probably with some offsets).

Zoltan

 *** Src/globals.h	1996/03/05 01:44:31	1.12
 --- Src/globals.h	1996/03/05 21:10:05
 ***************
 *** 321,329 ****
   
   EXTERN char *underscore;	/* $_          */
   EXTERN long lastval;            /* $?          */
 ! EXTERN pid_t mypid;		/* $$          */
 ! EXTERN pid_t lastpid;		/* $!          */
 ! EXTERN pid_t ppid;		/* $PPID       */
   EXTERN char *ifs;		/* $IFS        */
   EXTERN char *pwd;		/* $PWD        */
   EXTERN char *oldpwd;		/* $OLDPWD     */
 --- 321,329 ----
   
   EXTERN char *underscore;	/* $_          */
   EXTERN long lastval;            /* $?          */
 ! EXTERN long mypid;		/* $$          */
 ! EXTERN long lastpid;		/* $!          */
 ! EXTERN long ppid;		/* $PPID       */
   EXTERN char *ifs;		/* $IFS        */
   EXTERN char *pwd;		/* $PWD        */
   EXTERN char *oldpwd;		/* $OLDPWD     */
 *** Src/init.c	1996/03/19 20:22:11	1.14
 --- Src/init.c	1996/03/21 21:28:18
 ***************
 *** 598,605 ****
       zoptind = 1;
       schedcmds = NULL;
   
 !     ppid  = getppid();
 !     mypid = getpid();
       term  = ztrdup("");
       baud  = getbaudrate(&shttyinfo);  /* get the output baudrate */
   
 --- 598,605 ----
       zoptind = 1;
       schedcmds = NULL;
   
 !     ppid  = (long) getppid();
 !     mypid = (long) getpid();
       term  = ztrdup("");
       baud  = getbaudrate(&shttyinfo);  /* get the output baudrate */
   
 *** Src/exec.c	1996/03/12 14:08:12	1.14
 --- Src/exec.c	1996/03/21 21:27:49
 ***************
 *** 1360,1366 ****
   	    read(synch[0], &dummy, 1);
   	    close(synch[0]);
   	    if (how & Z_ASYNC) {
 ! 		lastpid = pid;
   	    } else if (!jobtab[thisjob].stty_in_env && nonempty(cmd->vars)) {
   		/* search for STTY=... */
   		while (nonempty(cmd->vars))
 --- 1360,1366 ----
   	    read(synch[0], &dummy, 1);
   	    close(synch[0]);
   	    if (how & Z_ASYNC) {
 ! 		lastpid = (long) pid;
   	    } else if (!jobtab[thisjob].stty_in_env && nonempty(cmd->vars)) {
   		/* search for STTY=... */
   		while (nonempty(cmd->vars))

-----BEGIN PGP SIGNATURE-----
Version: 2.6.3i
Charset: noconv

iQCVAwUBMVHNBwupSCiLN749AQGUIQP/eS/fPkHLFTPcHIKkd3NzpvAWP0ibn60I
jesQXWabRqsQ1leYVQINJnZwacoL/oLeoUVxY5+/TrcozdoCcgRtUfdFkOBXO0LG
Q66DoXTLtkiUuAVMHnm01rVYfl2F+hvTvSsrw4IC9vJZGsf6nyo6e0RZgI9kEVpq
DwXgVvpyQ1s=
=ZqpJ
-----END PGP SIGNATURE-----


