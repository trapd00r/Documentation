From zsh-workers-return-8247-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Oct 14 08:52:05 1999
Return-Path: <zsh-workers-return-8247-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 743 invoked from network); 14 Oct 1999 08:52:04 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 14 Oct 1999 08:52:04 -0000
Received: (qmail 4440 invoked by alias); 14 Oct 1999 08:51:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8247
Received: (qmail 4432 invoked from network); 14 Oct 1999 08:51:48 -0000
Date: Thu, 14 Oct 1999 10:51:46 +0200 (MET DST)
Message-Id: <199910140851.KAA13538@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: unambiguous string heuristic


With a match spec such as `r:|.=*' and trying `Zle/zle_t<TAB>' one
gets `Zle/zle_t.' (note the dot). This patch avoids inserting such
small unambiguous anchors if there are characters missing before them
(and they are at the end of the string, inside words older code takes
care of them).

Bye
 Sven

diff -u oldsrc/Zle/zle_tricky.c Src/Zle/zle_tricky.c
--- oldsrc/Zle/zle_tricky.c	Thu Oct 14 08:43:42 1999
+++ Src/Zle/zle_tricky.c	Thu Oct 14 10:50:17 1999
@@ -7801,7 +7801,7 @@
 static Cline
 cut_cline(Cline l)
 {
-    Cline p, e = NULL, maxp = NULL;
+    Cline q, p, e = NULL, maxp = NULL;
     int sum = 0, max = 0, tmp, ls = 0;
 
     /* If no match was added with matching, we don't really know
@@ -7819,10 +7819,17 @@
     /* First, search the last struct for which we have something on
      * the line. Anything before that is kept. */
 
-    for (p = l; p; p = p->next)
+    for (q = NULL, p = l; p; p = p->next) {
 	if (p->orig || p->olen || !(p->flags & CLF_NEW))
 	    e = p->next;
-
+	if (!p->suffix && (p->wlen || p->llen || p->prefix))
+	    q = p;
+    }
+    if (!e && q && !q->orig && !q->olen && (q->flags & CLF_MISS) &&
+	(q->word ? q->wlen : q->llen) < 3) {
+	q->word = q->line = NULL;
+	q->wlen = q->llen = 0;
+    }
     /* Then keep all structs without missing characters. */
 
     while (e && !(e->flags & CLF_MISS))

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

