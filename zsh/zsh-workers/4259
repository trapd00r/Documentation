From zsh-workers-request@math.gatech.edu Mon Aug 03 08:45:49 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7649 invoked from network); 3 Aug 1998 08:45:47 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 3 Aug 1998 08:45:47 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id EAA14849;
	Mon, 3 Aug 1998 04:35:33 -0400 (EDT)
Resent-Date: Mon, 3 Aug 1998 04:35:33 -0400 (EDT)
Message-Id: <199808030837.KAA19702@hydra.ifh.de>
X-Authentication-Warning: hydra.ifh.de: pws owned process doing -bs
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Cc: heiko_elger@arburg.com
Subject: Re: bindkey: up-line-or-history: difference V3.0.5 <-> V3.1.4 
In-reply-to: "heiko_elger@arburg.com"'s message of "Mon, 03 Aug 1998 06:48:43 MST."
             <0000581E.@arburg.com> 
Date: Mon, 03 Aug 1998 10:37:32 +0200
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"8fjOk.0.yd3.LPNnr"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4259
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

heiko_elger@arburg.com wrote:
> Hello,
> today I upgrade form V3.0.5 to V3.1.4 cause of some new needed functions.
> 
> All works fine, but I problems in using the bindkey command.
> 
> The command 'bindkey "$(echotc ku)" up-line-or-search' don't work with versio
> n 
> 3.1.4.

I presume from your previous message that you're using AIX (it always helps
to know that sort of thing).  In that case, this may be an ncurses problem:
in fact, I see the same thing.  What's happening in my case is that
termcap.h is found in /usr/local/include, where it comes from ncurses;
this is being included and defining NCURSES_VERSION, which messes things up
in bin_echotc().  You can check this by looking to see if HAVE_TERMCAP_H
is defined in config.h.  If it is, try changing the line to
/*#undef HAVE_TERMCAP_H*/
and recompiling.

Does anyone know if ncurses is 100% guaranteed to fail on AIX, given that
the search order for libraries puts curses before ncurses?  If so, then
the following patch would be OK.  (We're stuck on AIX 3.2.)

*** Src/builtin.c~	Sun May 31 12:26:12 1998
--- Src/builtin.c	Mon Aug  3 10:04:02 1998
***************
*** 2425,2431 ****
      /* if the specified termcap is boolean, and set, say so  *
       * ncurses can tell if an existing boolean capability is *
       * off so in this case we print "no".                    */
! #ifndef NCURSES_VERSION
      if (tgetflag(s) > 0) {
  	puts("yes");
  	return (0);
--- 2425,2431 ----
      /* if the specified termcap is boolean, and set, say so  *
       * ncurses can tell if an existing boolean capability is *
       * off so in this case we print "no".                    */
! #if !defined(NCURSES_VERSION) || defined(_AIX)
      if (tgetflag(s) > 0) {
  	puts("yes");
  	return (0);

-- 
Peter Stephenson <pws@ifh.de>       Tel: +39 50 844536
WWW:  http://www.ifh.de/~pws/
Gruppo Teorico, Dipartimento di Fisica
Piazza Torricelli 2, 56100 Pisa, Italy

