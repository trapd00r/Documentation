From zsh-users-return-8831-mason-zsh=primenet.com.au@sunsite.dk Sun May 15 18:48:51 2005
Return-Path: <zsh-users-return-8831-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11318 invoked from network); 15 May 2005 18:48:50 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 15 May 2005 18:48:50 -0000
Received: (qmail 71883 invoked from network); 15 May 2005 18:48:42 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 15 May 2005 18:48:42 -0000
Received: (qmail 18848 invoked by alias); 15 May 2005 18:48:35 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8831
Received: (qmail 18831 invoked from network); 15 May 2005 18:48:34 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 15 May 2005 18:48:34 -0000
Received: (qmail 70942 invoked from network); 15 May 2005 18:48:34 -0000
Received: from vms042pub.verizon.net (206.46.252.42)
  by a.mx.sunsite.dk with SMTP; 15 May 2005 18:48:30 -0000
Received: from candle.brasslantern.com ([4.11.1.68])
 by vms042.mailsrvcs.net (Sun Java System Messaging Server 6.2 HotFix 0.04
 (built Dec 24 2004)) with ESMTPA id <0IGJ009EWO8RIU64@vms042.mailsrvcs.net> for
 zsh-users@sunsite.dk; Sun, 15 May 2005 13:48:28 -0500 (CDT)
Received: from candle.brasslantern.com (IDENT:schaefer@localhost [127.0.0.1])
	by candle.brasslantern.com (8.12.11/8.12.11) with ESMTP id j4FImQDt025301	for
 <zsh-users@sunsite.dk>; Sun, 15 May 2005 11:48:26 -0700
Received: (from schaefer@localhost)	by candle.brasslantern.com
 (8.12.11/8.12.11/Submit) id j4FImQJ9025300	for zsh-users@sunsite.dk; Sun,
 15 May 2005 11:48:26 -0700
Date: Sun, 15 May 2005 18:48:25 +0000
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: Little problem while converting from bash (quoting/splitting?)
In-reply-to: <20050515134623.M88380@2-0.pl>
To: zsh-users@sunsite.dk
Message-id: <1050515184826.ZM25299@candle.brasslantern.com>
MIME-version: 1.0
X-Mailer: Z-Mail (5.0.0 30July97)
Content-type: text/plain; charset=us-ascii
References: <20050512060921.M13778@2-0.pl>
	<1050512162911.ZM17235@candle.brasslantern.com>	<20050515134623.M88380@2-0.pl>
Comments: In reply to "krasnal" <krasnal@2-0.pl>
 "Re: Little problem while converting from bash (quoting/splitting?)" (May 15,
 4:48pm)
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On May 15,  4:48pm, krasnal wrote:
} Subject: Re: Little problem while converting from bash (quoting/splitting?
}
} On Thu, 12 May 2005 16:29:11 +0000, Bart Schaefer wrote
} > Bash apparently reads stdin/stdout pipes in text mode, whereas zsh 
} > does so in binary mode.
} 
} I understand the difference but I'm not sure I follow your arguments
} here :)).  Why reading in text mode would be problematic?

Suppose you have 7663 bytes of data containing 97 \r\n sequences.  You
don't know whether it's text or binary data.

Read it in text mode, where \r\n is automatically converted to \n, and
stuff the entire contents into a variable.  That variable will contain
only 7566 bytes.  Information has been lost.

Zsh is capable of dealing sensibly with non-text values stored in
variables, so it was deemed more appropriate to treat text as binary
(no information loss) than the other way around.  The exception for
reading files is made because the Cygwin platform supports filesystems
that force all reads and writes to be in text mode.  Zsh doesn't know
what kind of filesystem it's reading/writing for any given file, so the
only way to assure that all file reads and writes behave the same is
to treat them all as text, regardless of the filesystem type.

Once the data is in a pipe, though, all filesystem-enforced conversions
can be assumed already to have occured, so it's safer to treat the data
as binary, and not convert it any further.

