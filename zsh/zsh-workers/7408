From zsh-workers-return-7408-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Aug 09 14:34:38 1999
Return-Path: <zsh-workers-return-7408-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21062 invoked from network); 9 Aug 1999 14:34:36 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 9 Aug 1999 14:34:36 -0000
Received: (qmail 10118 invoked by alias); 9 Aug 1999 14:34:27 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7408
Received: (qmail 10111 invoked from network); 9 Aug 1999 14:34:27 -0000
Date: Mon, 9 Aug 1999 16:34:34 +0200
From: Jos Backus <Jos.Backus@nl.origin-it.com>
To: zsh-workers@sunsite.auc.dk
Subject: Re: zsh-3.0.6 on BSD/OS
Message-ID: <19990809163434.H14467@hal.mpn.cp.philips.com>
Reply-To: Jos Backus <Jos.Backus@nl.origin-it.com>
References: <19990809122557.B14467@hal.mpn.cp.philips.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 0.95.6i
In-Reply-To: <19990809122557.B14467@hal.mpn.cp.philips.com>; from Jos Backus on Mon, Aug 09, 1999 at 12:25:57PM +0200

On Mon, Aug 09, 1999 at 12:25:57PM +0200, Jos Backus wrote:
> 1) On both BSD/OS 3.1 and 4.0.1, configure erroneously #defines
>    TGETENT_ACCEPTS_NULL, leading to a coredump later on in tgetstr() in
>    init.c:489:

The problem lies in the way configure tests this flag:

3.0.6 does

	#include "confdefs.h"
	main(){int i = tgetent((char*)0,"vt100");exit(!i || i == -1);}

whereas 3.1.6 does

	#include "confdefs.h"

	main()
	{
    		int i = tgetent((char*)0,"vt100");
    		if (i > 0) {
        		char tbuf[1024], *u;
        		u = tbuf;
        		tgetstr("cl", &u);
    		}
    		exit(!i || i == -1);
	}

The latter test yields the correct result, and 3.1.6 works out of the box.
Maybe 3.0.6 should be changed?

Regarding problem 2: compiling 3.1.6 gives the same warning on 4.0.1 (hardly
surprising in my view).


Cheers,
-- 
Jos Backus                          _/ _/_/_/  "Reliability means never
                                   _/ _/   _/   having to say you're sorry."
                                  _/ _/_/_/             -- D. J. Bernstein
                             _/  _/ _/    _/
Jos.Backus@nl.origin-it.com  _/_/  _/_/_/      use Std::Disclaimer;

