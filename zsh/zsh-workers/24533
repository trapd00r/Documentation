From zsh-workers-return-24533-mason-zsh=primenet.com.au@sunsite.dk Tue Feb 05 14:43:05 2008
Return-Path: <zsh-workers-return-24533-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10433 invoked from network); 5 Feb 2008 14:43:02 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 Feb 2008 14:43:02 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 35347 invoked from network); 5 Feb 2008 14:42:57 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 Feb 2008 14:42:57 -0000
Received: (qmail 28940 invoked by alias); 5 Feb 2008 14:42:54 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24533
Received: (qmail 28923 invoked from network); 5 Feb 2008 14:42:53 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 5 Feb 2008 14:42:53 -0000
Received: from cluster-d.mailcontrol.com (cluster-d.mailcontrol.com [217.69.20.190])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 1811180482A1
	for <zsh-workers@sunsite.dk>; Tue,  5 Feb 2008 15:42:46 +0100 (CET)
Received: from rly06d.srv.mailcontrol.com (localhost.localdomain [127.0.0.1])
	by rly06d.srv.mailcontrol.com (MailControl) with ESMTP id m15EghfL031300
	for <zsh-workers@sunsite.dk>; Tue, 5 Feb 2008 14:42:44 GMT
Received: from submission.mailcontrol.com (submission.mailcontrol.com [86.111.216.190])
	by rly06d.srv.mailcontrol.com (MailControl) id m15Eg6Ej029124
	for zsh-workers@sunsite.dk; Tue, 5 Feb 2008 14:42:06 GMT
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly06d-eth0.srv.mailcontrol.com (envelope-sender Peter.Stephenson@csr.com) (MIMEDefang) with ESMTP id m15Eg1Uo027934; Tue, 05 Feb 2008 14:42:06 +0000 (GMT)
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Tue, 5 Feb 2008 14:41:58 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.2/8.13.4) with ESMTP id m15EfuGM029064;
	Tue, 5 Feb 2008 14:41:56 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.2/8.14.2/Submit) with ESMTP id m15EftTc029061;
	Tue, 5 Feb 2008 14:41:56 GMT
Message-Id: <200802051441.m15EftTc029061@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: agcosta@gis.net, 463507@bugs.debian.org, zsh-workers@sunsite.dk
Subject: Re: Bug#463507: zsh: Completion fails with: "_main_complete:161: permission denied:"
In-reply-to: <20080205141957.GA17778@scowler.net>
References: <20080131221535.c1aa6f7c.agcosta@gis.net> <20080201133818.GA28192@scowler.net> <20080201173143.2a7ec474.agcosta@gis.net> <20080202030920.GA2099@scowler.net> <20080202014728.9aeb3310.agcosta@gis.net> <20080202184123.GA20032@scowler.net> <20080203004905.a85d2c3c.agcosta@gis.net> <20080205033050.GA4729@scowler.net> <20080205024651.ea4026a1.agcosta@gis.net> <20080205141957.GA17778@scowler.net>
Comments: In-reply-to Clint Adams <schizo@debian.org>
   message dated "Tue, 05 Feb 2008 09:19:57 -0500."
Date: Tue, 05 Feb 2008 14:41:55 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 05 Feb 2008 14:41:58.0591 (UTC) FILETIME=[42DC2CF0:01C86805]
X-Scanned-By: MailControl A-08-00-01 (www.mailcontrol.com) on 10.68.1.116
X-Virus-Scanned: ClamAV version 0.91.2, clamav-milter version 0.91.2 on bifrost
X-Virus-Status: Clean

Clint Adams wrote:
> On Tue, Feb 05, 2008 at 02:46:51AM -0500, A. Costa wrote:
> > 'zsh-newuser-install' gave me:
> >
> > 	% zstyle -L | grep completer
> > 	zstyle ':completion:*' completer ''
>
> I think maybe it should prevent that from ever happening.
>
> You probably want
>
> zstyle ':completion:*' completer _complete

I presume the problem is that it's not set by default, rather than that
the user explicitly unset the completions?  I think this should fix it.

Index: Completion/compinstall
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/compinstall,v
retrieving revision 1.10
diff -u -r1.10 compinstall
--- Completion/compinstall	21 Aug 2006 19:40:34 -0000	1.10
+++ Completion/compinstall	5 Feb 2008 14:38:01 -0000
@@ -506,7 +506,7 @@
 		      ;;
 		[sS]) olist=
 		      tmparr=(_complete _approximate _correct _match _expand)
-		      while true; do
+		      while true; do
 			clear
 			print "\
      *** compinstall:  choosing completers to have _oldlist behaviour ***
@@ -839,7 +839,10 @@
   for c in ${=newc}; do
     completers[$c]=1
   done
-  clist=(_list _oldlist _menu _expand _complete _ignored
+  if (( ${#completers} == 0 )); then
+    completers[_complete]=1
+  fi
+  clist=(_list _oldlist _menu _expand _complete _ignored
          _match _correct _approximate _prefix)

   # TODO: these are a bit brief, so could provide some more detailed help.

--
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

