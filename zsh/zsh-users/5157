From zsh-users-return-5157-mason-zsh=primenet.com.au@sunsite.dk Sat Jul 13 07:29:03 2002
Return-Path: <zsh-users-return-5157-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1227 invoked from network); 13 Jul 2002 07:29:02 -0000
Received: from ns2.primenet.com.au (HELO primenet.com.au) (203.24.36.3)
  by ns1.primenet.com.au with SMTP; 13 Jul 2002 07:29:02 -0000
Received: (qmail 3490 invoked from network); 12 Jul 2002 18:58:12 -0000
Received: from sunsite.dk (130.225.247.90)
  by proxy.melb.primenet.com.au with SMTP; 12 Jul 2002 18:58:12 -0000
Received: (qmail 7484 invoked by alias); 12 Jul 2002 18:46:48 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 5157
Received: (qmail 7473 invoked from network); 12 Jul 2002 18:46:47 -0000
From: Borsenkow Andrej <Andrej.Borsenkow@mow.siemens.ru>
To: GoTaR <gotar@poczta.onet.pl>
Cc: zsh-users@sunsite.dk
Subject: Re: completions issues
In-Reply-To: <20020710204701.GA3362@os>
References: <20020710204701.GA3362@os>
Content-Type: text/plain; charset=KOI8-R
Content-Transfer-Encoding: quoted-printable
X-Mailer: Ximian Evolution 1.0.8-1mdk 
Date: 12 Jul 2002 22:44:56 +0400
Message-Id: <1026499603.2775.6.camel@localhost.localdomain>
Mime-Version: 1.0

=F7 =FE=D4=D7, 11.07.2002, =D7 00:47, GoTaR =CE=C1=D0=C9=D3=C1=CC:
> Hi!
>=20
> I've got some problems with creating my own rule for sms sending
> program. Here comes the significant part:
>=20
> _sms_aliases () {
> 	compadd "$@" $(print ${(f)"$(smsaddr -l | cut -f1)"})
> }
> [...]
> 		_arguments -C \
>                         '-r[remove existing entry]:SMS =
alias:_sms_aliases'
>=20
> smsaddr returns two columns, completion should be done from both, but
> treated as one entry, e. g.:
>=20
> $ smsaddr -l
> alias1		608612341
> alias2		504147432
> blias3		603648734
>=20
> $ smsaddr -r a[tab]... lias2
> alias1          608612341
> alias2          504147432
>=20
> $ smsaddr -r 6[tab]... 08612341
> alias1          608612341
> blias3          603648734
>=20
> so one column will be used as comment.
>=20
> I will be very grateful for help.
>=20

_sms_aliases should check both fields and add the first if any matches.
To prevent completion using own matching use -U flag to compadd.
Something like

ret=3D1
smsaddr -l  | while read alias number; do
  if [[ $alias =3D=3D $PREFIX*$SUFFIX || $number =3D=3D $PREFIX*$SUFFIX =
]]; then
     compadd -U -- $alias
     ret=3D0
   fi
done

return $ret

with obvious error checking. If you want to add numbers as =
descriptions,
somebody else better explains how to do it :-)=20

-andrej

