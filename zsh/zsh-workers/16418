From zsh-workers-return-16418-mason-zsh=primenet.com.au@sunsite.dk Tue Jan 08 15:32:51 2002
Return-Path: <zsh-workers-return-16418-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29018 invoked from network); 8 Jan 2002 15:32:50 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 8 Jan 2002 15:32:50 -0000
Received: (qmail 8095 invoked by alias); 8 Jan 2002 15:32:45 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16418
Received: (qmail 8083 invoked from network); 8 Jan 2002 15:32:45 -0000
From: Sven Wischnowsky <wischnow@berkom.de>
To: zsh-workers@sunsite.dk
Subject: PATCH: completion after x+=
Message-Id: <20020108153107.C951A245CE@wischnow.berkom.de>
Date: Tue,  8 Jan 2002 16:31:07 +0100 (CET)


And another thing Oliver pointed out: completion after `var+=<TAB>'
didn't use the `value' context.

(Oliver, I had to look, too, to find the right place and then it was
easier to fix it than to desribe it ;-)


I'm aware of Bart's comments on `+=', but since this is currently in
the CVS-version, we'd better keep the completion code in sync, having
to remember to change that, too, if something happens to `+='.


Bye
  Sven

Index: Src/lex.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/lex.c,v
retrieving revision 1.21
diff -u -r1.21 lex.c
--- Src/lex.c	2001/12/17 17:17:38	1.21
+++ Src/lex.c	2002/01/08 15:30:04
@@ -1140,7 +1140,8 @@
 			skipparens(Inbrack, Outbrack, &t);
 		    }
 		}
-		if (*t == '+') t++;
+		if (*t == '+')
+                    t++;
 		if (t == bptr) {
 		    e = hgetc();
 		    if (e == '(' && incmdpos) {
Index: Src/Zle/zle_tricky.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_tricky.c,v
retrieving revision 1.31
diff -u -r1.31 zle_tricky.c
--- Src/Zle/zle_tricky.c	2001/07/10 09:25:43	1.31
+++ Src/Zle/zle_tricky.c	2002/01/08 15:30:04
@@ -1215,6 +1215,8 @@
 	zsfree(varname);
 	varname = ztrdup(tt);
 	*s = sav;
+        if (*s == '+')
+            s++;
 	if (skipparens(Inbrack, Outbrack, &s) > 0 || s > tt + cs - wb) {
 	    s = NULL;
 	    inwhat = IN_MATH;

-- 
Sven Wischnowsky                           wischnow@berkom.de

