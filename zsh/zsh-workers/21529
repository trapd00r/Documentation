From zsh-workers-return-21529-mason-zsh=primenet.com.au@sunsite.dk Tue Jul 26 14:59:43 2005
Return-Path: <zsh-workers-return-21529-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29195 invoked from network); 26 Jul 2005 14:59:41 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 26 Jul 2005 14:59:41 -0000
Received: (qmail 21475 invoked from network); 26 Jul 2005 14:59:35 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 26 Jul 2005 14:59:35 -0000
Received: (qmail 15057 invoked by alias); 26 Jul 2005 14:59:32 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21529
Received: (qmail 15048 invoked from network); 26 Jul 2005 14:59:32 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 26 Jul 2005 14:59:32 -0000
Received: (qmail 21163 invoked from network); 26 Jul 2005 14:59:32 -0000
Received: from acolyte.scowler.net (216.254.112.45)
  by a.mx.sunsite.dk with SMTP; 26 Jul 2005 14:59:27 -0000
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id 299C970057; Tue, 26 Jul 2005 10:59:25 -0400 (EDT)
Date: Tue, 26 Jul 2005 10:59:25 -0400
From: Clint Adams <clint@zsh.org>
To: zsh-workers@sunsite.dk
Subject: PATCH: scriptdir and Scripts
Message-ID: <20050726145925.GA16515@scowler.net>
Mail-Followup-To: zsh-workers@sunsite.dk
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.9i
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.4

This may be misguided, but sticking newuser in the parent dir of
functions/ seems ugly, and having Scripts/ in $fpath when it doesn't
exist seems pointless at best.

Index: configure.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.ac,v
retrieving revision 1.35
diff -u -r1.35 configure.ac
--- configure.ac	20 Jul 2005 16:08:18 -0000	1.35
+++ configure.ac	26 Jul 2005 14:56:44 -0000
@@ -293,19 +293,19 @@
 [  --enable-scriptdir=DIR     the directory in which to install scripts],
 dnl ${VERSION} to be determined at compile time.
 [if test $enableval = yes; then
-  scriptdir=${datadir}/${tzsh_name}/'${VERSION}'
+  scriptdir=${datadir}/${tzsh_name}/'${VERSION}'/scripts
 else
   scriptdir="$enableval"
-fi], [scriptdir=${datadir}/${tzsh_name}/'${VERSION}'])
+fi], [scriptdir=${datadir}/${tzsh_name}/'${VERSION}'/scripts])
 
 ifdef([sitescriptdir],[undefine([sitescriptdir])])dnl
 AC_ARG_ENABLE(site-scriptdir,
 [  --enable-site-scriptdir=DIR  same for site scripts (not version specific)],
 [if test $enableval = yes; then
-  sitescriptdir=${datadir}/${tzsh_name}
+  sitescriptdir=${datadir}/${tzsh_name}/scripts
 else
   sitescriptdir="$enableval"
-fi], [sitescriptdir=${datadir}/${tzsh_name}])
+fi], [sitescriptdir=${datadir}/${tzsh_name}/scripts])
 
 AC_SUBST(scriptdir)dnl
 AC_SUBST(sitescriptdir)dnl
Index: Src/zsh.mdd
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/zsh.mdd,v
retrieving revision 1.13
diff -u -r1.13 zsh.mdd
--- Src/zsh.mdd	20 Jul 2005 16:08:22 -0000	1.13
+++ Src/zsh.mdd	26 Jul 2005 14:56:44 -0000
@@ -49,14 +49,14 @@
 	fi
 	@if test x$(fndir) != xno; then \
 	  echo '#define FPATH_DIR "'$(fndir)'"' >> zshpaths.h.tmp; \
-	  if test x$(FUNCTIONS_SUBDIRS) != x -a \
-	  x$(FUNCTIONS_SUBDIRS) != xno; then \
+	  if test x$(FUNCTIONS_SUBDIRS) != x && \
+	     test x$(FUNCTIONS_SUBDIRS) != xno; then \
 	    fpath_tmp="`grep ' functions=.' \
 	    $(dir_top)/config.modules | sed -e '/^#/d' -e '/ link=no/d' \
 	    -e 's/^.* functions=//'`"; \
 	    fpath_tmp=`for f in $$fpath_tmp; do \
 	      echo $$f | sed -e 's%^Functions/%%' -e 's%/[^/]*$$%%' -e 's%/\*%%'; \
-	    done | sort | uniq`; \
+	    done | grep -v Scripts | sort | uniq`; \
 	    fpath_tmp=`echo $$fpath_tmp | sed 's/ /\", \"/g'`; \
 	    echo "#define FPATH_SUBDIRS { \"$$fpath_tmp\" }" \
 	    >>zshpaths.h.tmp; \

