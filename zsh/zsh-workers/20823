From zsh-workers-return-20823-mason-zsh=primenet.com.au@sunsite.dk Fri Feb 18 13:54:03 2005
Return-Path: <zsh-workers-return-20823-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22376 invoked from network); 18 Feb 2005 13:54:02 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 18 Feb 2005 13:54:02 -0000
Received: (qmail 11237 invoked from network); 18 Feb 2005 13:53:56 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 18 Feb 2005 13:53:56 -0000
Received: (qmail 22018 invoked by alias); 18 Feb 2005 13:53:51 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20823
Received: (qmail 22005 invoked from network); 18 Feb 2005 13:53:50 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 18 Feb 2005 13:53:50 -0000
Received: (qmail 10973 invoked from network); 18 Feb 2005 13:53:50 -0000
Received: from mailhost1.csr.com (HELO MAILSWEEPER01.csr.com) (81.105.217.43)
  by a.mx.sunsite.dk with SMTP; 18 Feb 2005 13:53:39 -0000
Received: from exchange03.csr.com (unverified [10.100.137.60]) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.12) with ESMTP id <T6f322627070a6c8d013bc@MAILSWEEPER01.csr.com>;
 Fri, 18 Feb 2005 13:52:11 +0000
Received: from news01.csr.com ([10.103.143.38]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Fri, 18 Feb 2005 13:54:21 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.1/8.12.11) with ESMTP id j1IDrcEr031309;
	Fri, 18 Feb 2005 13:53:38 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.1/8.13.1/Submit) with ESMTP id j1IDrbgF031306;
	Fri, 18 Feb 2005 13:53:38 GMT
Message-Id: <200502181353.j1IDrbgF031306@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: Vincent Lefevre <vincent@vinc17.org>,
        zsh-workers@sunsite.dk (Zsh hackers list)
Subject: Re: stat on Linux/x86_64 (was: zsh on Opteron (Linux) and limit) 
In-reply-to: <20050218134534.GA25272@ay.vinc17.org> 
References: <20050215125144.GI19378@ay.vinc17.org> <20050215125815.GA17248@scowler.net> <20050215155912.GN19378@ay.vinc17.org> <20050217165423.GN19378@ay.vinc17.org> <20050218134534.GA25272@ay.vinc17.org>
Date: Fri, 18 Feb 2005 13:53:37 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 18 Feb 2005 13:54:21.0825 (UTC) FILETIME=[5922C710:01C515C1]
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.5

Vincent Lefevre wrote:
> In the Src/Modules/stat.c file:
> 
>     case ST_INO:
> #ifdef INO_T_IS_64_BIT
>         convbase(optr, sbuf->st_ino, 0);
> #else
>         DPUTS(sizeof(sbuf->st_ino) > 4,
>               "Shell compiled with wrong ino_t size");
>         statulprint((unsigned long)sbuf->st_ino, optr);
> #endif
>         break;

Thanks for noticing.

Looks like that debugging test is wrong; presumably sizeof(unsigned
long) is 8 and the error message goes away.  Indeed, != might have been
better than > but I'm too cowardly.

Index: Src/Modules/stat.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/stat.c,v
retrieving revision 1.7
diff -u -r1.7 stat.c
--- Src/Modules/stat.c	2 Jun 2004 22:15:00 -0000	1.7
+++ Src/Modules/stat.c	18 Feb 2005 13:51:26 -0000
@@ -239,7 +239,7 @@
 #ifdef INO_T_IS_64_BIT
 	convbase(optr, sbuf->st_ino, 0);
 #else
-	DPUTS(sizeof(sbuf->st_ino) > 4,
+	DPUTS(sizeof(sbuf->st_ino) > sizeof(unsigned long),
 	      "Shell compiled with wrong ino_t size");
 	statulprint((unsigned long)sbuf->st_ino, optr);
 #endif
@@ -269,7 +269,7 @@
 #ifdef OFF_T_IS_64_BIT
 	convbase(optr, sbuf->st_size, 0);
 #else
-	DPUTS(sizeof(sbuf->st_size) > 4,
+	DPUTS(sizeof(sbuf->st_size) > sizeof(unsigned long),
 	      "Shell compiled with wrong off_t size");
 	statulprint((unsigned long)sbuf->st_size, optr);
 #endif

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

**********************************************************************

