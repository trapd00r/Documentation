From zsh-workers-return-9732-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Feb 15 09:12:40 2000
Return-Path: <zsh-workers-return-9732-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17201 invoked from network); 15 Feb 2000 09:12:38 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 Feb 2000 09:12:38 -0000
Received: (qmail 9779 invoked by alias); 15 Feb 2000 09:12:33 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9732
Received: (qmail 9766 invoked from network); 15 Feb 2000 09:12:33 -0000
Date: Tue, 15 Feb 2000 10:12:32 +0100 (MET)
Message-Id: <200002150912.KAA11318@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 14 Feb 2000 23:16:18 +0900
Subject: Re: noalwayslastprompt


Tanaka Akira wrote:

> Z(2):akr@is27e1u11% Src/zsh -f
> is27e1u11% bindkey -e; autoload -U compinit; compinit -D
> is27e1u11% setopt noalwayslastprompt
> is27e1u11% ls <TAB>
> ->
> is27e1u11% ls
> 
> No lists are displayed.

Yes, with complist loaded (without the default-styles change I just
sent it was always loaded).

Put that !clearflag test in the wrong test. Sorry.

Bye
 Sven

diff -ru ../z.old/Src/Zle/complist.c Src/Zle/complist.c
--- ../z.old/Src/Zle/complist.c	Tue Feb 15 10:03:59 2000
+++ Src/Zle/complist.c	Tue Feb 15 10:06:57 2000
@@ -780,7 +780,7 @@
     if (inselect)
 	clearflag = 0;
 
-    if (asklist() || !clearflag) {
+    if (asklist()) {
 	amatches = oamatches;
 	return (noselect = 1);
     }
@@ -800,7 +800,8 @@
     last_cap = (char *) zhalloc(max_caplen + 1);
     *last_cap = '\0';
 
-    if (!printlist(1, clprintm, (mselect >= 0)) || listdat.nlines >= lines)
+    if (!printlist(1, clprintm, (mselect >= 0)) || listdat.nlines >= lines ||
+	!clearflag)
 	noselect = 1;
 
     amatches = oamatches;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

