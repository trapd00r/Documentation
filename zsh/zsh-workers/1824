From zsh-workers-request@euclid.skiles.gatech.edu  Tue Jul 30 02:17:59 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by coral.primenet.com.au (8.7.5/8.7.3) with ESMTP id CAA01633 for <mason@primenet.com.au>; Tue, 30 Jul 1996 02:17:57 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id MAA19915; Mon, 29 Jul 1996 12:00:32 -0400 (EDT)
Resent-Date: Mon, 29 Jul 1996 12:00:32 -0400 (EDT)
Message-Id: <199607291559.RAA10028@hydra.ifh.de>
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: Lethal option-related bug
Date: Mon, 29 Jul 1996 17:59:28 +0200
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"h7EmQ.0.2t4.W0E_n"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1824
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

I just submitted a batch job for the first time with an unpatched
3.0-pre4 and it dumped core straight away.  (I think the shell is
still yelling out `Don't release me!  Don't release me!'.)

It turns out to be easy to reproduce:

./zsh -s
zsh: 7863 segmentation fault (core dumped)  ./zsh -s

The backtrace is

#0  0x47d9b4 in inittyptab () at utils.c:2510
#1  0x47fed4 in dosetopt (optno=92, value=1, force=268534416) at utils.c:3330
#2  0x447094 in parseargs (argv=0x7fffaf48) at init.c:242
#3  0x4463f0 in main (argc=0, argv=0x7fffaf44) at init.c:60

and the problem is that ifs is null in inittyptab; possibly not too
surprising, since it gets initialised in setupvals(), which is called
a few lines after parseargs() in main().  It looks like SHINSTDIN
wants inittytab set up before the shell's set up enough for it.

I could probably hack round this, but I'm not confident of producing
the right fix, so I'll leave it.

-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77330
Deutches Electronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.

