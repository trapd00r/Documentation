From pmutsaer@hzscg01.nl.lucent.com Thu Jul 25 17:33:28 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3/2) with ESMTP id RAA07918 for <mason@werple.mira.net.au>; Thu, 25 Jul 1996 17:33:25 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id DAA18963; Thu, 25 Jul 1996 03:25:04 -0400 (EDT)
Resent-Date: Thu, 25 Jul 1996 03:25:04 -0400 (EDT)
From: pmutsaer@hzscg01.nl.lucent.com
Date: Thu, 25 Jul 96 09:24:00 +0200
Message-Id: <9607250724.AA20306@hzscg01.nl.lucent.com.nl.lucent.com>
Original-From: Peter Mutsaers <pmutsaer@hzscg01.lucent.com>
To: zsh-workers@math.gatech.edu
Sent-Via: zsh-workers@math.gatech.edu
Subject: zsh 3.0 pre3 dumps core when... And a ksh emulation mode problem
Resent-Message-ID: <"a5pAy.0.De4.F5ozn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1761
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 1551
Status: O

Hello,

zsh 3.0 on SunOS 4.1.4, compiled with gcc 2.7.2 (both with and without
optimization) dumps core when called wish a shell script as argument.

e.g. if file tst contains only the line 'ps', then
'zsh tst' causes a core dump.

Note that . tst, or simply 'tst' (implicitly calling zsh) do not dump
core.

The report script also dumps core, so I cannot send a standard report.

Note that I use ksh emulation mode.

The stack trace (from gdb):

#0  0xef76f7b8 in fflush ()
#1  0x40a8c in printjob (jn=0xb3900, lng=0, synch=0) at jobs.c:343
#2  0x3fa68 in update_job (jn=0xb3900) at jobs.c:176
#3  0x59e18 in handler (sig=20) at signals.c:508
#4  <signal handler called>
#5  0xef76e898 in sigpause ()
#6  0x598ec in signal_suspend (sig=20, sig2=0) at signals.c:321
#7  0x413d8 in waitjob (job=1, sig=0) at jobs.c:510
#8  0x416b0 in waitjobs () at jobs.c:560
#9  0x1e860 in execpline (l=0xc13f8, how=2, last1=0) at exec.c:697
#10 0x1dfc4 in execlist (list=0xc1464, dont_change_job=0, exiting=0)
    at exec.c:522
#11 0x3ba04 in loop (toplevel=1) at init.c:129
#12 0x3b788 in main (argc=2, argv=0xeffff4d4) at init.c:77

I hope you can see something from this.


Another thing, concering ksh emulation mode:

On SunOS 4.1.4 ksh will call /bin/ksh on executable shell scripts
without #! on the first line. zsh will allways call /bin/sh.

This breaks some ksh scripts for me.

Is it possible to call /bin/ksh for such subshells instead of /bin/sh,
when in ksh emulation mode? (For now I simply modified /bin/sh in exec.c)


Regards,

-- 
Peter Mutsaers


