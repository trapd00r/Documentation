From zsh-users-return-10943-mason-zsh=primenet.com.au@sunsite.dk Mon Nov 06 11:11:50 2006
Return-Path: <zsh-users-return-10943-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2749 invoked from network); 6 Nov 2006 11:11:44 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 6 Nov 2006 11:11:44 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 38953 invoked from network); 6 Nov 2006 11:11:35 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 6 Nov 2006 11:11:35 -0000
Received: (qmail 16430 invoked by alias); 6 Nov 2006 11:11:24 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10943
Received: (qmail 16420 invoked from network); 6 Nov 2006 11:11:23 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 6 Nov 2006 11:11:23 -0000
Received: (qmail 37596 invoked from network); 6 Nov 2006 11:11:23 -0000
Received: from flock1.newmail.ru (80.68.241.157)
  by a.mx.sunsite.dk with SMTP; 6 Nov 2006 11:11:21 -0000
Received: (qmail 16135 invoked from network); 6 Nov 2006 11:11:20 -0000
Received: from unknown (HELO cooker.local) (arvidjaar@newmail.ru@83.237.61.178)
  by smtpd.newmail.ru with SMTP; 6 Nov 2006 11:11:20 -0000
From: Andrey Borzenkov <arvidjaar@newmail.ru>
To: zsh-users@sunsite.dk
Subject: Re: is a key of pointed key set ? (where is the + )
Date: Mon, 6 Nov 2006 14:11:41 +0300
User-Agent: KMail/1.9.5
References: <20061106080431.GA17141@ulpmm.u-strasbg.fr> <200611061120.14277.arvidjaar@newmail.ru> <20061106101336.GA17485@ulpmm.u-strasbg.fr>
In-Reply-To: <20061106101336.GA17485@ulpmm.u-strasbg.fr>
Content-Type: text/plain;
  charset="iso-8859-15"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
Message-Id: <200611061411.44526.arvidjaar@newmail.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Monday 06 November 2006 13:13, Marc Chantreux wrote:
> le 06/11/2006,
>
> Andrey Borzenkov nous écrivait :
> > > pnt=h
> > > typeset -A h
> > > h=( k1 value )
> > >
> > > so :
> > >
> > > echo ${${(P)pnt}[k1]}
> > > prints value
> > >
> > > but how to know if the key itself is set ?
> >
> > {pts/0}% typeset -A h
> > {pts/0}% h=(k v)
> > {pts/0}% print -- ${(k)h[k]+set}
> > set
> > {pts/0}% print -- ${(k)h[k1]-unset}
> > unset
>
> well .. (( $+h[k] )) does the same. You missed a part of the problem :
> my associative array is "Pointed" (P).
>

Somewhat kludgy but

{pts/0}% typeset -A h
{pts/0}% h=(k1 v1 k2 v2)
{pts/0}% p=h
{pts/0}% print -- ${${(Pk)p}[(r)k3]-unset}
unset
{pts/0}% print -- ${${(Pk)p}[(r)k2]+set}
set


> so we can imagine :
>
> [[ -n ${(k)${(P)pnt}[k1]} ]] && print "${pnt}[k1] is set"
>
> but it doesn't work.
>

I believe this was discussed recently. Parameter type is not propagated from 
nested substitutions, so this is not going to work. Outside of innermost 
${...} you just get list of values. Even without (P):

{pts/0}% print -- ${(k)${h}}
v1 v2
{pts/0}% print -- ${(k)${(kv)h}}
k1 v1 k2 v2

- -andrey
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.5 (GNU/Linux)

iD8DBQFFTxhwR6LMutpd94wRApfCAJ9Q3/5QdxdTGPmBQIm3cn9YqItL3ACfeZpZ
70APA+FBiocoEIHj/NY7Mpk=
=Y63j
-----END PGP SIGNATURE-----

