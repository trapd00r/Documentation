From zsh-workers-return-19320-mason-zsh=primenet.com.au@sunsite.dk Thu Dec 18 22:01:11 2003
Return-Path: <zsh-workers-return-19320-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9481 invoked from network); 18 Dec 2003 22:01:11 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 18 Dec 2003 22:01:11 -0000
Received: (qmail 7451 invoked by alias); 18 Dec 2003 22:01:04 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19320
Received: (qmail 7436 invoked from network); 18 Dec 2003 22:01:03 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 18 Dec 2003 22:01:03 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [195.135.220.2] by sunsite.dk (MessageWall 1.0.8) with SMTP; 18 Dec 2003 22:1:2 -0000
Received: from Hermes.suse.de (Hermes.suse.de [195.135.221.8])
	(using TLSv1 with cipher EDH-RSA-DES-CBC3-SHA (168/168 bits))
	(No client certificate requested)
	by Cantor.suse.de (Postfix) with ESMTP id 858F119145F0
	for <zsh-workers@sunsite.dk>; Thu, 18 Dec 2003 22:58:11 +0100 (CET)
Received: by bragg.suse.de (Postfix, from userid 30022)
	id 382F58D9BC; Thu, 18 Dec 2003 22:58:11 +0100 (CET)
Date: Thu, 18 Dec 2003 22:58:10 +0100
From: Mads Martin Joergensen <mmj@suse.de>
To: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: PATCH: terminfo horor
Message-ID: <20031218215810.GB8263@suse.de>
References: <20031218185248.GA13185@suse.de> <15381.1071776149@csr.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <15381.1071776149@csr.com>
User-Agent: Mutt/1.5.5.1i

* Peter Stephenson <pws@csr.com> [Dec 18. 2003 20:37]:
> > How can I test this patch? I can build zsh packages both with and
> > without ncurses, but I don't know how to test if they work or not?
> > 
> > If all the make test tests are successful?
> 
> If you don't have curses, the shell should build successfully without
> building terminfo.so --- nothing more to test.

Ok, I've tweaked the buildenvironment to not having ncurses-devel, and
without it:

gcc  -s -rdynamic -o zsh main.o  `cat stamp-modobjs`   -ldl -lnsl -lm -lc
utils.o(.text+0x2aa9): In function `gettempname':
: the use of `mktemp' is dangerous, better use `mkstemp'
init.o(.text+0x1277): In function `init_term':
: undefined reference to `tgetent'
init.o(.text+0x132a): In function `init_term':
: undefined reference to `tgetstr'
init.o(.text+0x1398): In function `init_term':
: undefined reference to `tgetflag'
init.o(.text+0x13af): In function `init_term':
: undefined reference to `tgetnum'
init.o(.text+0x13c6): In function `init_term':
: undefined reference to `tgetnum'
prompt.o(.text+0x24f6): In function `tsetcap':
: undefined reference to `tputs'
prompt.o(.text+0x2560): In function `tsetcap':
: undefined reference to `tputs'
prompt.o(.text+0x2637): In function `tsetcap':
: undefined reference to `tgetnum'
prompt.o(.text+0x2693): In function `tsetcap':
: undefined reference to `tgetnum'
prompt.o(.text+0x26d5): In function `tsetcap':
: undefined reference to `tputs'
collect2: ld returned 1 exit status
make[1]: *** [zsh] Error 1

zsh configuration
-----------------
zsh version               : 4.1.1
host operating system     : x86_64-suse-linux
source code location      : .
compiler                  : gcc
preprocessor flags        : 
executable compiler flags : -O2 -Wall -pipe
module compiler flags     : -O2 -Wall -pipe -fPIC
executable linker flags   :   -s -rdynamic
module linker flags       :   -s -shared
library flags             : -ldl -lnsl -lm  -lc
installation basename     : zsh
binary install path       : //bin
man page install path     : /usr/share/man
info install path         : /usr/share/info
functions install path    : /usr/share/zsh/4.1.1/functions


> If you do have curses, it should build successfully and produce a
> terminfo.so which, after installation, is loadable.  You can test it
> from the newly installed shell like this:
> 
> zmodload zsh/terminfo
> echoti cols
> 
> which should output a number, but anything other than a linking error or
> `feature not available' is good news.

This is with ncurses-devel in the build environment:

# zsh
# zmodload zsh/terminfo
# echoti cols
80

So that works at least.

> Any feedback is very useful.

Hope you can use it. It's build on a SuSE Linux 9.0 on a dual Opteron,
and the breakage is confirmed and look the same on SuSE Linux 9.0 i386.

-- 
Mads Martin Joergensen, http://mmj.dk
"Why make things difficult, when it is possible to make them cryptic
 and totally illogical, with just a little bit more effort?"
                                -- A. P. J.

