From zsh-workers-return-15541-mason-zsh=primenet.com.au@sunsite.dk Mon Jul 30 20:19:14 2001
Return-Path: <zsh-workers-return-15541-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29006 invoked from network); 30 Jul 2001 20:19:12 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 30 Jul 2001 20:19:12 -0000
Received: (qmail 29747 invoked by alias); 30 Jul 2001 20:19:04 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15541
Received: (qmail 29736 invoked from network); 30 Jul 2001 20:19:03 -0000
To: "Bart Schaefer" <schaefer@candle.brasslantern.com>
cc: zsh-workers@sunsite.dk
Subject: Re: fatal flaw zsh 4.0.1 on irix 6.3 & 6.5: suspend "ls -l|less" then resume hangs
References: <200106140732.JAA08108@beta.informatik.hu-berlin.de> <yehvgl0kdvm.fsf@water.cs.brown.edu> <1010710162547.ZM29353@candle.brasslantern.com> <yehofqsjx1a.fsf@water.cs.brown.edu> <010710162700.ZM30017@candle.brasslantern.com> <yehg0c3jnq8.fsf@water.cs.brown.edu> <1010712033907.ZM31622@candle.brasslantern.com>
From: Timothy Miller <tsm@cs.brown.edu>
Date: 30 Jul 2001 16:18:02 -0400
In-Reply-To: "Bart Schaefer"'s message of "Thu, 12 Jul 2001 03:39:07 +0000"
Message-ID: <yehhevugohx.fsf@water.cs.brown.edu>
Lines: 92
User-Agent: Gnus/5.0802 (Gnus v5.8.2) XEmacs/21.1 (Big Bend)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Thu, 12 Jul 2001 03:39:07 +0000, "Bart Schaefer" <schaefer@candle.brasslantern.com> wrote:
> Yes, there was at least one other bug fix after -pws-3:
> 
>         * Sven: 9345: Src/exec.c, Src/jobs.c, Src/zsh.h:
>         bug with job control when group leader exits; other problems
>         with subshells.
> 
> So it would be more helpful to see the `ps' output for 4.0.2 (say) than
> for 3.1.6-pws-3.

4.0.2 zsh +Z -f, ps -fljt ttyq4 with irrelevant procs removed:

initial prompt
  F S      UID   PID  PPID  PGID   SID  C PRI NI  P    SZ:RSS      WCHAN    STIME TTY     TIME CMD
 b0 S      tsm  8561   915  8561   915  5  28 20  *   593:218   8039e0b0 16:02:16 ttyq4   0:00 ./Src/zsh +Z -f 

ls -lR /|cat running
 b0 S      tsm  8564  8561  8564   915  3  61 20  *    45:25    c0d1261c 16:02:54 ttyq4   0:00 cat 
 b0 S      tsm  8561   915  8561   915  0  39 20  *   609:232   8039d510 16:02:16 ttyq4   0:00 ./Src/zsh +Z -f 
 b8 S      tsm  8563  8561  8563   915 24  20 20  *   394:114   803fe164 16:02:54 ttyq4   0:00 ls -lR / 

after ^Z
 b0 T      tsm  8564  8561  8564   915  0  60 20  *    45:25           - 16:02:54 ttyq4   0:00 cat 
 b0 S      tsm  8561   915  8561   915  0  39 20  *   609:233   8039d510 16:02:16 ttyq4   0:00 ./Src/zsh +Z -f 
 b0 S      tsm  8563  8561  8563   915  0  60 20  *   394:114   c0d12620 16:02:54 ttyq4   0:01 ls -lR / 

At this point it's hung. Actually, on examining the mail I sent when I first 
tried the |cat (Jun 12) it had the same hang-on-first-suspend, which I had
forgotten, so it's not different behavior after all.

> However, I note that in -pws-2, both `cat' and `ls' are in the same pgrp
> but it is `ls' that is stopped.  Did you try either of the patches that
> Sven sent?

Yes, and even sent out a reply (Jul 6): separately or together, they didn't
affect the problem. ps outputs (which I didn't include originally) follow. I 
am assuming, by the way, that the only thing I need to do after applying the 
patch is type "make".

first patch only:
initial prompt
 b0 S      tsm  8684   915  8684   915  0  28 20  *   593:218   8039e0b0 16:09:37 ttyq4   0:00 ./Src/zsh +Z -f 

ls -lR /|cat running
 b8 R      tsm  8686  8684  8686   915 29  20 20  *   394:114          - 16:09:51 ttyq4   0:00 ls -lR / 
 b0 S      tsm  8687  8684  8687   915  1  60 20  *    45:25    c0d1261c 16:09:51 ttyq4   0:00 cat 
 b0 S      tsm  8684   915  8684   915  0  39 20  *   609:232   8039d510 16:09:37 ttyq4   0:00 ./Src/zsh +Z -f 

after ^Z
 b0 S      tsm  8686  8684  8686   915  0  60 20  *   394:114   c0d12620 16:09:51 ttyq4   0:01 ls -lR / 
 b0 T      tsm  8687  8684  8687   915  0  60 20  *    45:25           - 16:09:51 ttyq4   0:00 cat 
 b0 S      tsm  8684   915  8684   915  0  39 20  *   609:233   8039d510 16:09:37 ttyq4   0:00 ./Src/zsh +Z -f 

It's now hung.

-----

both first and second patches:
initial prompt
 b0 S      tsm  8752   915  8752   915  0  28 20  *   593:219   8039e0b0 16:12:10 ttyq4   0:00 ./Src/zsh +Z -f 

running
 b0 S      tsm  8752   915  8752   915  0  39 20  *   609:233   8039d510 16:12:10 ttyq4   0:00 ./Src/zsh +Z -f 
 b0 R      tsm  8754  8752  8754   915 30  75 20  *   394:114          - 16:12:31 ttyq4   0:01 ls -lR / 
 b0 S      tsm  8755  8752  8755   915  2  61 20  *    45:25    c0d1261c 16:12:31 ttyq4   0:00 cat 

^Z
 b0 S      tsm  8752   915  8752   915  0  39 20  *   609:234   8039d510 16:12:10 ttyq4   0:00 ./Src/zsh +Z -f 
 b0 S      tsm  8754  8752  8754   915  0  60 20  *   394:114   c0d12620 16:12:31 ttyq4   0:01 ls -lR / 
 b0 T      tsm  8755  8752  8755   915  0  60 20  *    45:25           - 16:12:31 ttyq4   0:00 cat 

hung

-----

second patch only:
initial prompt
 b0 S      tsm  8819   915  8819   915  0  28 20  *   593:219   8039e0b0 16:14:23 ttyq4   0:00 ./Src/zsh +Z -f 

running
 b0 S      tsm  8822  8819  8822   915  1  60 20  *    45:25    c0d1261c 16:14:35 ttyq4   0:00 cat 
 b0 S      tsm  8819   915  8819   915  0  39 20  *   609:233   8039d510 16:14:23 ttyq4   0:00 ./Src/zsh +Z -f 
 b0 R      tsm  8821  8819  8821   915 39  79 20  *   394:114          - 16:14:35 ttyq4   0:00 ls -lR / 

^Z
 b0 T      tsm  8822  8819  8822   915  0  60 20  *    45:25           - 16:14:35 ttyq4   0:00 cat 
 b0 S      tsm  8819   915  8819   915  0  39 20  *   609:234   8039d510 16:14:23 ttyq4   0:00 ./Src/zsh +Z -f 
 b0 S      tsm  8821  8819  8821   915  0  60 20  *   394:114   c0d12620 16:14:35 ttyq4   0:01 ls -lR / 

hung

   Tim

