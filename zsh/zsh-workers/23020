From zsh-workers-return-23020-mason-zsh=primenet.com.au@sunsite.dk Tue Nov 28 10:50:34 2006
Return-Path: <zsh-workers-return-23020-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24948 invoked from network); 28 Nov 2006 10:50:26 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 28 Nov 2006 10:50:26 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 62743 invoked from network); 28 Nov 2006 10:50:15 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Nov 2006 10:50:15 -0000
Received: (qmail 5977 invoked by alias); 28 Nov 2006 10:50:09 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23020
Received: (qmail 5965 invoked from network); 28 Nov 2006 10:50:08 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 28 Nov 2006 10:50:08 -0000
Received: (qmail 62021 invoked from network); 28 Nov 2006 10:50:08 -0000
Received: from cluster-d.mailcontrol.com (217.69.20.190)
  by a.mx.sunsite.dk with SMTP; 28 Nov 2006 10:50:04 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly13d.srv.mailcontrol.com (MailControl) with ESMTP id kASAkPjU021535
	for <zsh-workers@sunsite.dk>; Tue, 28 Nov 2006 10:50:00 GMT
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Tue, 28 Nov 2006 10:49:08 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.8/8.13.4) with ESMTP id kASAn8Em014326
	for <zsh-workers@sunsite.dk>; Tue, 28 Nov 2006 10:49:08 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.8/8.13.8/Submit) with ESMTP id kASAn7lN014323
	for <zsh-workers@sunsite.dk>; Tue, 28 Nov 2006 10:49:08 GMT
Message-Id: <200611281049.kASAn7lN014323@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-workers@sunsite.dk
Subject: Re: (zsh-4.3.2) Y03 test failure under Slackware Linux 9.0.0 
In-reply-to: <1164616792.5558@bear.he.net> 
References: <1164616792.5558@bear.he.net>
Comments: In-reply-to Eric De Mund <ead@ixian.com>
   message dated "Mon, 27 Nov 2006 00:39:52 -0800."
Date: Tue, 28 Nov 2006 10:49:07 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 28 Nov 2006 10:49:08.0172 (UTC) FILETIME=[D48FE8C0:01C712DA]
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A-07-06-80 (www.mailcontrol.com) on 10.68.0.123

Eric De Mund wrote:
> I'm experiencing a "make check" failure in test Y03 when building
> zsh-4.3.2 under Slackware Linux 9.0.0 on a i686-pc-linux-gnu host, as I
> experienced back in March of this year (Message-ID:
> <17433.46602.590991.508063@bear.he.net>).

The failure is this:

*** /tmp/zsh.ztst.out.9272	Mon Nov 27 00:13:12 2006
--- /tmp/zsh.ztst.tout.9272	Mon Nov 27 00:13:12 2006
***************
*** 2,8 ****
  line: {tst -o +o }{}
  line: {tst -o +o }{}
  MESSAGE:{no arguments}
! line: {tst +o }{}
! line: {tst +o -o }{}
! line: {tst +o -o }{}
  MESSAGE:{no arguments}
--- 2,10 ----
  line: {tst -o +o }{}
  line: {tst -o +o }{}
  MESSAGE:{no arguments}
! line: {tst -+}{}
! MESSAGE:{no arguments}
! line: {tst -+}{}
! MESSAGE:{no arguments}
! line: {tst -+}{}
  MESSAGE:{no arguments}
Test ./Y03arguments.ztst failed: output differs from expected as shown above for:
 tst_arguments -+o
 comptest $'tst -\t\t\t\C-w\C-w+\t\t\t'
Was testing: option beginning with + and -.
./Y03arguments.ztst: test failed.

I can't this to happen with 4.3.2 on my Fedora machine, or with the
latest shell there or on Solaris.  It would be interesting to know if
it's still present in the version in the archive at the moment.

My best guess is that the two \C-w's in the test aren't wiping the -
from the previous line, "tst -o +o ".  That suggests $WORDCHARS doesn't
include "-" or it isn't having an effect for some reason.  That would
mean the test actually started the second set of completions with "tst
-+" on the line, which then behaved the way you'd expect, so the failure
isn't in the completion part at all.  This seems more likely than the
"-+" popping out of a failed completion.

What happens if you start from "zsh -f" (and "bindkey -e" if necessary)
and type:

% tst -o +o\C-w\C-w

does the - disappear (as it should)?  If not, what does "print -r
$WORDCHARS" show?

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


To access the latest news from CSR copy this link into a web browser:  http://www.csr.com/email_sig.php

