From zsh-workers-return-13372-mason-zsh=primenet.com.au@sunsite.dk Thu Jan 18 12:38:24 2001
Return-Path: <zsh-workers-return-13372-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24031 invoked from network); 18 Jan 2001 12:38:23 -0000
Received: from sunsite.dk (HELO sunsite.auc.dk) (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 18 Jan 2001 12:38:23 -0000
Received: (qmail 18442 invoked by alias); 18 Jan 2001 12:38:03 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13372
Received: (qmail 18417 invoked from network); 18 Jan 2001 12:38:03 -0000
Sender: kvho@sebb.bel.alcatel.be
Message-ID: <3A66E2CC.4D890D59@alcatel.be>
Date: Thu, 18 Jan 2001 13:34:21 +0100
From: koen van hoof <koen.van_hoof@alcatel.be>
Reply-To: koen.van_hoof@alcatel.be
Organization: Alcatel Bell
X-Mailer: Mozilla 4.7 [en] (X11; I; SunOS 5.6 sun4u)
X-Accept-Language: en
MIME-Version: 1.0
To: Andrej Borsenkow <Andrej.Borsenkow@mow.siemens.ru>
CC: Zsh hackers list <zsh-workers@sunsite.auc.dk>
Subject: Re: Some general problems with exporting cariables (Was: TERMCAP 
 problem. )
References: <001201c080b5$2be27070$21c9ca95@mow.siemens.ru>
Content-Type: multipart/mixed;
 boundary="------------C814CD9589CACC488DC587C4"

This is a multi-part message in MIME format.
--------------C814CD9589CACC488DC587C4
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

Andrej Borsenkow wrote:

>
> Koen, could you test if it helps? It appears to work here, but so did
> unmodified Zsh as well. I appreciate, if anybody could review memory
> allocation usage here - I still do not grok completely Zsh memory usage.
>
> The patch is against current CVS.
>
> -andrej
>
>   --------------------------------------------------------------------------------
>                        Name: zsh.replenv.diff
>    zsh.replenv.diff    Type: unspecified type (application/octet-stream)
>                    Encoding: quoted-printable

I made a new executable from the current CVS, and even without the patch it did not
crash anymore.
For some reason, it how uses '-lcurses' instead of '-ltermcap'.

I did some tests with the debugger.
The crash happened because getenv("TERM") returned 0 during the call to tgetent from
the termcap library.
Whithout the patch, getenv("TERM") still returns 0, but now tgetent from libcursus.a
is used.
With the patch, getenv("TERM") returns "dumb" before tgetent is called, so I guess it
will also be fine for tgetent from the termcap library

Andrey,
thank you very much for your time and effort.

--
==========================================================
Koen Van Hoof    koen.van_hoof@alcatel.be   32 3 451 60 31
==========================================================



--------------C814CD9589CACC488DC587C4
Content-Type: text/x-vcard; charset=us-ascii;
 name="koen.van_hoof.vcf"
Content-Transfer-Encoding: 7bit
Content-Description: Card for koen van hoof
Content-Disposition: attachment;
 filename="koen.van_hoof.vcf"

begin:vcard 
n:Van Hoof;Koen
x-mozilla-html:TRUE
adr:;;;;;;
version:2.1
email;internet:koen.van_hoof@alcatel.be
x-mozilla-cpt:;0
fn:Koen Van Hoof
end:vcard

--------------C814CD9589CACC488DC587C4--

