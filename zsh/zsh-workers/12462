From zsh-workers-return-12462-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Aug 01 11:19:39 2000
Return-Path: <zsh-workers-return-12462-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1951 invoked from network); 1 Aug 2000 11:19:38 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 1 Aug 2000 11:19:38 -0000
Received: (qmail 17483 invoked by alias); 1 Aug 2000 11:19:16 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12462
Received: (qmail 17474 invoked from network); 1 Aug 2000 11:19:12 -0000
Date: Tue, 1 Aug 2000 13:18:59 +0200 (MET DST)
Message-Id: <200008011118.NAA06931@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Tue, 1 Aug 2000 14:03:33 +0400
Subject: Re: _arguments broken again


Andrej Borsenkow wrote:

> bor@itsrm2%
> /tools/src/zsh/configure  --prefix=/tools --enable-zsh-debug --en-f-
> sTAB
> Completing
> 
> The first parameter was entered explicitly; the second was completed
> from --en-z-d; third parameter cannot be completed. The same with zsh -f.

Oops. Messed up description for automatically generated option specs.

Bye
 Sven

Index: Completion/Base/_arguments
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Base/_arguments,v
retrieving revision 1.29
diff -u -r1.29 _arguments
--- Completion/Base/_arguments	2000/08/01 07:18:43	1.29
+++ Completion/Base/_arguments	2000/08/01 11:18:27
@@ -87,9 +87,11 @@
     done
 
     # Then we walk through the descriptions plus a few builtin ones.
+    # The last one matches all options; the `special' description and action
+    # makes those options be completed without an argument description.
 
     set -- "$@" '*=FILE*:file:_files' \
-           '*=(DIR|PATH)*:directory:_files -/' '*: :'
+           '*=(DIR|PATH)*:directory:_files -/' '*: :  '
 
     while (( $# )); do
 
@@ -147,7 +149,7 @@
 
       if (( $#tmp )); then
         tmp=("${(@)tmp//[^a-zA-Z0-9-]}")
-        if [[ -n "$descr" ]]; then
+        if [[ -n "$descr" && "$descr" != ': :  ' ]]; then
 	  cache=( "$cache[@]" "${(@)^tmp}${descr}" )
         else
 	  cache=( "$cache[@]" "$tmp[@]" )

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

