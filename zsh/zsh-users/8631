From zsh-users-return-8631-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 23 16:13:49 2005
Return-Path: <zsh-users-return-8631-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29480 invoked from network); 23 Mar 2005 16:13:48 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 Mar 2005 16:13:48 -0000
Received: (qmail 59574 invoked from network); 23 Mar 2005 16:13:41 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 Mar 2005 16:13:41 -0000
Received: (qmail 19093 invoked by alias); 23 Mar 2005 16:13:34 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8631
Received: (qmail 19079 invoked from network); 23 Mar 2005 16:13:33 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 23 Mar 2005 16:13:33 -0000
Received: (qmail 58457 invoked from network); 23 Mar 2005 16:13:33 -0000
Received: from vms040pub.verizon.net (206.46.252.40)
  by a.mx.sunsite.dk with SMTP; 23 Mar 2005 16:13:22 -0000
Received: from candle.brasslantern.com ([4.11.1.68])
 by vms040.mailsrvcs.net (Sun Java System Messaging Server 6.2 HotFix 0.04
 (built Dec 24 2004)) with ESMTPA id <0IDT00754BQ8XBG0@vms040.mailsrvcs.net> for
 zsh-users@sunsite.dk; Wed, 23 Mar 2005 10:13:22 -0600 (CST)
Received: from candle.brasslantern.com (IDENT:schaefer@localhost [127.0.0.1])
	by candle.brasslantern.com (8.12.11/8.12.11) with ESMTP id j2NGDJBN015447;
 Wed, 23 Mar 2005 08:13:20 -0800
Received: (from schaefer@localhost)	by candle.brasslantern.com
 (8.12.11/8.12.11/Submit) id j2NGDJl5015446; Wed, 23 Mar 2005 08:13:19 -0800
Date: Wed, 23 Mar 2005 16:13:19 +0000
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: (P) param expansion with assoc-arrays
In-reply-to: <44613de0050323063910991816@mail.gmail.com>
To: Shawn Halpenny <paxunix@gmail.com>, zsh-users@sunsite.dk
Message-id: <1050323161319.ZM15445@candle.brasslantern.com>
MIME-version: 1.0
X-Mailer: Z-Mail (5.0.0 30July97)
Content-type: text/plain; charset=us-ascii
References: <44613de0050323063910991816@mail.gmail.com>
Comments: In reply to Shawn Halpenny <paxunix@gmail.com>
 "(P) param expansion with assoc-arrays" (Mar 23,  9:39am)
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On Mar 23,  9:39am, Shawn Halpenny wrote:
} 
} typeset -A hash
} hash=( a 1 b 2 c 3 )
} 
} blah="hash"
} 
} echo ${${(P)blah}[b]}
} 
} How can I get that expression to return '2'?

${(P)blah} expands to the value of the variable whose name is the value
of blah -- NOT to the variable whose name is the value of blah.  Note
the not-so-subtle difference.  Thus the following outputs "2":

blah="hash[b]"
echo ${(P)blah}

So you first have to paste together the value of blah with the [b] and
then apply (P) to the result.  This can be done in a non-obvious way:

echo $((P)${:-${blah}[b]}}

The :- is "substitute the string to my right if the variable to my left
has no value."  As there is no variable name to the left, there is no
value, and hence the string consisting of the expansion of ${blah} and
the so-far-meaningless [b] is substituted.  Then (P) applies, and the
substituted string is given the meaning you wanted.

