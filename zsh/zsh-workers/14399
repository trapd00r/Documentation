From zsh-workers-return-14399-mason-zsh=primenet.com.au@sunsite.dk Sun May 20 09:22:48 2001
Return-Path: <zsh-workers-return-14399-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22346 invoked from network); 20 May 2001 09:22:47 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 20 May 2001 09:22:47 -0000
Received: (qmail 23715 invoked by alias); 20 May 2001 09:22:41 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14399
Received: (qmail 23697 invoked from network); 20 May 2001 09:22:39 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer goliath.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "ZSH Workers Mailing List" <zsh-workers@sunsite.dk>
Subject: PATCH: workaround for "config.status not found" on Cygwin
Date: Sun, 20 May 2001 13:22:36 +0400
Message-ID: <000201c0e10e$687feda0$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----=_NextPart_000_0003_01C0E12F.EF918DA0"
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
Importance: Normal
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4522.1200

This is a multi-part message in MIME format.

------=_NextPart_000_0003_01C0E12F.EF918DA0
Content-Type: text/plain;
	charset="koi8-r"
Content-Transfer-Encoding: 7bit

Cygwin can optionally use NTFS attributes to emulate Unix file permissions
(CYGWIN=...ntea...). In this case file on NTFS must have x bit to be
considered executable. There is something fishy still:

- writing to a file resets all x bits. That accounts for a chmod line in
configure.in (we change file after it was created). But

- it did not help (God knows why). ls -l at the very end of configure shows
config.status with x bits set and ls -l immediately after configure runs
shows no x bits. It smells very much like a Cygwin bug, but for now I just
changed mkmakemod.sh to use /bin/sh config.status.

-andrej

------=_NextPart_000_0003_01C0E12F.EF918DA0
Content-Type: application/octet-stream;
	name="zsh.config.status.diff"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename="zsh.config.status.diff"

Index: configure.in=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /cvsroot/zsh/zsh/configure.in,v=0A=
retrieving revision 1.57=0A=
diff -u -r1.57 configure.in=0A=
--- configure.in	2001/05/10 07:13:41	1.57=0A=
+++ configure.in	2001/05/20 09:13:53=0A=
@@ -1913,6 +1913,7 @@=0A=
 cp $CONFIG_STATUS $CONFIG_STATUS.old=0A=
 sed '1,$s@^\( *ac_file_inputs=3D\).*$@\1`echo $ac_file_in | sed -e =
"s%^%:%" -e "s%:\\([^!]\\)% $ac_given_srcdir/\\1%g" -e "s%:!% %"`@' \=0A=
  $CONFIG_STATUS.old >$CONFIG_STATUS=0A=
+ chmod +x $CONFIG_STATUS=0A=
  rm -f $CONFIG_STATUS.old]=0A=
 =0A=
 test "$real_no_create" =3D yes || ${CONFIG_SHELL-/bin/sh} =
$CONFIG_STATUS || exit 1=0A=
Index: Src/mkmakemod.sh=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /cvsroot/zsh/zsh/Src/mkmakemod.sh,v=0A=
retrieving revision 1.10=0A=
diff -u -r1.10 mkmakemod.sh=0A=
--- Src/mkmakemod.sh	2001/04/23 19:59:04	1.10=0A=
+++ Src/mkmakemod.sh	2001/05/20 09:13:55=0A=
@@ -472,7 +472,7 @@=0A=
     # tree, this is a problem.  zsh's configure script edits =
config.status,=0A=
     # adding the feature that an input filename starting with "!" has =
the=0A=
     # "!" removed and is not mangled further.=0A=
-    =
CONFIG_FILES=3D$the_subdir/${the_makefile}:\!$the_subdir/${the_makefile}.=
in CONFIG_HEADERS=3D ./config.status=0A=
+    =
CONFIG_FILES=3D$the_subdir/${the_makefile}:\!$the_subdir/${the_makefile}.=
in CONFIG_HEADERS=3D ${CONFIG_SHELL-/bin/sh} ./config.status=0A=
 =0A=
 fi=0A=
 =0A=

------=_NextPart_000_0003_01C0E12F.EF918DA0--

