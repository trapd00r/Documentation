From zsh-users-return-14944-mason-zsh=primenet.com.au@zsh.org Tue Mar 16 05:35:27 2010
Return-Path: <zsh-users-return-14944-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10576 invoked by alias); 16 Mar 2010 05:35:27 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14944
Received: (qmail 28731 invoked from network); 16 Mar 2010 05:35:16 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received-SPF: pass (ns1.primenet.com.au: SPF record at benizi.com designates 64.130.10.15 as permitted sender)
Date: Tue, 16 Mar 2010 01:35:10 -0400 (EDT)
From: "Benjamin R. Haskell" <zsh@benizi.com>
To: zsh-users@zsh.org
Subject: Re: zsh sometimes freezes when completing a command
In-Reply-To: <20100316035049.GD1761@prunille.vinc17.org>
Message-ID: <alpine.LNX.2.01.1003160115050.31893@hp.internal>
References: <20100315101546.GA28047@prunille.vinc17.org> <100315085820.ZM6723@torch.brasslantern.com> <20100316001319.GC1761@prunille.vinc17.org> <100315185415.ZM7280@torch.brasslantern.com> <20100316035049.GD1761@prunille.vinc17.org>
User-Agent: Alpine 2.01 (LNX 1266 2009-07-14)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Tue, 16 Mar 2010, Vincent Lefevre wrote:

> On 2010-03-15 18:54:15 -0700, Bart Schaefer wrote:
> > On Mar 16,  1:13am, Vincent Lefevre wrote:
> > } tags in context :completion::complete:-command-::
> > } 
> > } I wonder why zsh tries to complete on users.
> > 
> > Targets for autocd, I suspect.
> 
> Yes. But can't these targets be disabled for completion, or used only 
> if the other completions failed?

>From a similar discussion w/ subject: 'Avoid LDAP hit during 
completion'[1], Peter's suggestion lead me tangentially to this section, 
from somewhere in zshall (zstyle(?) .. Standard styles):

users  This may be set to a list of usernames to be completed.   If  it
	   is  not set all usernames will be completed.  Note that if it is 
	   set only that list of users will be completed; this  is  because 
	   on some systems querying all users can take a prohibitive amount 
	   of time.

E.g.: The following sets '~user' expansion to only use 'bhaskell' and 
'dovecot' (random selection from my system):

zstyle ':completion:*' users {bhaskell,dovecot}

(OT: also surprised me to realize I have 30 'named directories' at this 
point... ls ~<TAB> shows 32 items.)

As pws explained in much more detail in that thread, that might not be 
the only place users would be generated.  But, things also may have been 
cleaned up since 2005.

And, you might also be better served changing this at a different level.  
(Zsh isn't the only thing that can trigger a listing of usernames.)  My 
work computer is a Linux machine joined to a Windows Domain, and ls 
~<Tab> didn't trigger any slowness.  My Samba configuration there 
(/etc/samba/smb.conf) has the following settings:

winbind enum users = No
winbind enum groups = No
winbind separator = .

getent passwd doesn't return the DOMAIN.username entries (due to the 
'No' enum), but they're still perfectly usable as normal(-ish) system 
users.  (I can log in as DOMAIN.bhaskell via SSH, for example.)

Changing those lines got me back to slowness.  (But even 280 domain 
users doesn't take terribly long to enumerate there.)

-- 
Best,
Ben

[1] http://www.zsh.org/mla/users/2005/msg00659.html

