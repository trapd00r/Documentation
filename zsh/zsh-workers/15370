From zsh-workers-return-15370-mason-zsh=primenet.com.au@sunsite.dk Wed Jul 11 07:20:58 2001
Return-Path: <zsh-workers-return-15370-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25343 invoked from network); 11 Jul 2001 07:20:56 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 11 Jul 2001 07:20:56 -0000
Received: (qmail 14194 invoked by alias); 11 Jul 2001 07:20:27 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15370
Received: (qmail 14183 invoked from network); 11 Jul 2001 07:20:26 -0000
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
Date: Wed, 11 Jul 2001 09:18:01 +0200 (MET DST)
Message-Id: <200107110718.JAA17016@beta.informatik.hu-berlin.de>
To: zsh-workers@sunsite.dk
Subject: Re: PATCH: doshfunc
In-Reply-To: <1010710160616.ZM29244@candle.brasslantern.com>

Bart Schaefer wrote:

> ...
> 
> The code that does `name "$@"' in eval_autoload() is assembling a command
> to pass to bin_eval().  It doesn't append anything to the function def'n.

Err, right, sorry.  I was far too hasty yesterday.  It's printshfuncnode().

> ...
> 
> That error message came from line 3253, not line 3381.

No, 3278 (in an unpatched exec.c).

> } or:
> } 
> }   % rm -f foo.zwc
> }   % echo 'bar() { echo foobar }' >foo
> }   % setopt kshautoload
> }   % fpath=(. $fpath)
> }   % autoload foo
> }   % foo
> }   zsh: foo: function not defined by file
> 
> Same thing there; the error is from line 3253.
> 
> Once again, what I want to know is how you reach line 3372 with EF_RUN in
> the Eprog flags, and hence get the error from line 3381.

You need an autoloaded function that unfunctions itself:

  % echo 'foo() { echo foo }' >foo
  % echo 'unfunction foo' >> foo
  % fpath=(. $fpath)
  % autoload +Xk foo
  % foo
  zsh: foo: function not defined by file

And this time it's the one on line 3381.


Bye
  Sven


-- 
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

