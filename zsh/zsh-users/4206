From zsh-users-return-4206-mason-zsh=primenet.com.au@sunsite.dk Sat Sep 08 07:12:34 2001
Return-Path: <zsh-users-return-4206-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7920 invoked from network); 8 Sep 2001 07:12:33 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 8 Sep 2001 07:12:33 -0000
Received: (qmail 25553 invoked by alias); 8 Sep 2001 07:12:15 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4206
Received: (qmail 25542 invoked from network); 8 Sep 2001 07:12:13 -0000
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <1010908071206.ZM18774@candle.brasslantern.com>
Date: Sat, 8 Sep 2001 07:12:05 +0000
In-Reply-To: <20010908021331.A14998@astaroth.sweth.net>
Comments: In reply to Sweth Chandramouli <svc@sweth.net>
        "Re: zsh dumping core because I don't grok TRAPEXIT" (Sep  8,  2:13am)
References: <20010907180418.A13819@astaroth.sweth.net> 
	<1010908055006.ZM18450@candle.brasslantern.com> 
	<20010908021331.A14998@astaroth.sweth.net>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Sweth Chandramouli <svc@sweth.net>, ZSH Users <zsh-users@sunsite.dk>
Subject: Re: zsh dumping core because I don't grok TRAPEXIT
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Sep 8,  2:13am, Sweth Chandramouli wrote:
}
} 	OK.  The more I think about it, though, the less I see
} when TRAPEXIT would really be useful.  How would
} 
} function TRAPEXIT {
}    do_something
} }
} do_other_thing
} 
} 	ever be different than
} 
} do_other_thing ; do_something

When do_other_thing is a shell function, and do_something wants to use
the local variables of that function.

Also, it's an encapsulation issue: inside do_other_thing may be the best
place to control which do_something to do.

Finally, and a point I forgot to mention:  TRAPEXIT preserves $?, so
it's actually like writing

	do_other_thing; x=$? ; do_something ; return $x

For example:

	getpass() {
	    TRAPEXIT() { stty echo }
	    stty -echo
	    read passwd || return 1
	    print
	}

Without the trap, you'd at the least have to write something like

	getpass() {
	    stty -echo
	    read passwd || { stty echo ; return 1 }
	    print
	    stty echo
	}

Note that you can also do

	TRAPINT TRAPQUIT TRAPEXIT () { stty echo }

to create three traps at once, although unless you `setopt localtraps'
only the TRAPEXIT will automatically remove itself.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

