From zsh-workers-return-24506-mason-zsh=primenet.com.au@sunsite.dk Fri Feb 01 02:54:54 2008
Return-Path: <zsh-workers-return-24506-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6403 invoked from network); 1 Feb 2008 02:54:52 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 1 Feb 2008 02:54:52 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 84795 invoked from network); 1 Feb 2008 02:54:46 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 1 Feb 2008 02:54:46 -0000
Received: (qmail 27078 invoked by alias); 1 Feb 2008 02:54:42 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24506
Received: (qmail 27064 invoked from network); 1 Feb 2008 02:54:41 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 1 Feb 2008 02:54:41 -0000
Received: from acolyte.scowler.net (acolyte.scowler.net [216.254.112.45])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 1C98280482A1
	for <zsh-workers@sunsite.dk>; Fri,  1 Feb 2008 03:54:32 +0100 (CET)
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id D8B865C1A4; Thu, 31 Jan 2008 21:54:28 -0500 (EST)
Date: Thu, 31 Jan 2008 21:54:28 -0500
From: Clint Adams <clint@zsh.org>
To: zsh-workers@sunsite.dk
Subject: ZSH_VERSIONSUFFIX [was Re: ZSH_EXTRAVERSION [was Re: Segfault with
	newer .zwc]]
Message-ID: <20080201025428.GA17388@scowler.net>
Mail-Followup-To: zsh-workers@sunsite.dk
References: <slrnfo4ov7.cgh.joerg@alea.gnuu.de> <20080108095306.5475d009@news01> <20080109191236.GB32394@scowler.net> <200801100950.m0A9oN9T015070@news01.csr.com> <20080115020642.GA5306@scowler.net> <200801150910.m0F9AP0f026468@news01.csr.com> <20080118170223.GA32039@scowler.net> <20080121014801.GA1242@primenet.com.au> <20080122013517.GD16813@scowler.net>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20080122013517.GD16813@scowler.net>
User-Agent: Mutt/1.5.17+20080114 (2008-01-14)
X-Virus-Scanned: ClamAV 0.91.2/5629/Thu Jan 31 23:21:01 2008 on bifrost
X-Virus-Status: Clean

On Mon, Jan 21, 2008 at 08:35:17PM -0500, Clint Adams wrote:
> +VERSION="$VERSION$ZSH_VERSIONSUFFIX"

So this actually doesn't work for reasons that should be obvious from
the ugly patch below. The suffix is lost in a ./config.status --recheck;
I don't know whether to view this as a feature or a bug.

Index: Makefile.in
===================================================================
RCS file: /cvsroot/zsh/zsh/Makefile.in,v
retrieving revision 1.17
diff -u -r1.17 Makefile.in
--- Makefile.in	16 Sep 2006 15:53:03 -0000	1.17
+++ Makefile.in	1 Feb 2008 02:49:07 -0000
@@ -29,6 +29,7 @@
 SUBDIRS = Doc Etc Src Test
 
 @VERSION_MK@
+VERSION = @VERSION@
 
 # source/build directories
 VPATH           = @srcdir@
Index: configure.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.ac,v
retrieving revision 1.89
diff -u -r1.89 configure.ac
--- configure.ac	22 Jan 2008 01:59:26 -0000	1.89
+++ configure.ac	1 Feb 2008 02:49:08 -0000
@@ -33,6 +33,7 @@
 . ${srcdir}/Config/version.mk
 VERSION="$VERSION$ZSH_VERSIONSUFFIX"
 echo "configuring for zsh $VERSION"
+AC_SUBST(VERSION)
 
 dnl ----------------------------------------------
 dnl CHECK FOR MACHINE/VENDOR/OPERATING SYSTEM TYPE
Index: Doc/Makefile.in
===================================================================
RCS file: /cvsroot/zsh/zsh/Doc/Makefile.in,v
retrieving revision 1.38
diff -u -r1.38 Makefile.in
--- Doc/Makefile.in	20 Nov 2007 14:20:00 -0000	1.38
+++ Doc/Makefile.in	1 Feb 2008 02:49:09 -0000
@@ -28,6 +28,7 @@
 dir_top = ..
 
 @VERSION_MK@
+VERSION = @VERSION@
 
 # source/build directories
 VPATH           = @srcdir@
Index: Etc/Makefile.in
===================================================================
RCS file: /cvsroot/zsh/zsh/Etc/Makefile.in,v
retrieving revision 1.2
diff -u -r1.2 Makefile.in
--- Etc/Makefile.in	3 Jul 2007 17:06:05 -0000	1.2
+++ Etc/Makefile.in	1 Feb 2008 02:49:09 -0000
@@ -29,6 +29,7 @@
 SUBDIRS =
 
 @VERSION_MK@
+VERSION = @VERSION@
 
 # source/build directories
 VPATH           = @srcdir@
Index: Src/Makefile.in
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Makefile.in,v
retrieving revision 1.13
diff -u -r1.13 Makefile.in
--- Src/Makefile.in	24 Jul 2005 04:47:57 -0000	1.13
+++ Src/Makefile.in	1 Feb 2008 02:49:09 -0000
@@ -29,6 +29,7 @@
 SUBDIRS =
 
 @VERSION_MK@
+VERSION = @VERSION@
 
 # source/build directories
 VPATH           = @srcdir@
Index: Src/Makemod.in.in
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Makemod.in.in,v
retrieving revision 1.5
diff -u -r1.5 Makemod.in.in
--- Src/Makemod.in.in	20 Dec 2001 23:48:39 -0000	1.5
+++ Src/Makemod.in.in	1 Feb 2008 02:49:09 -0000
@@ -31,6 +31,7 @@
 # SUBDIRS is done by mkmakemod.sh
 
 @VERSION_MK@
+VERSION = @VERSION@
 
 # source/build directories
 VPATH           = @srcdir@
Index: Test/Makefile.in
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/Makefile.in,v
retrieving revision 1.9
diff -u -r1.9 Makefile.in
--- Test/Makefile.in	18 Dec 2007 21:16:30 -0000	1.9
+++ Test/Makefile.in	1 Feb 2008 02:49:09 -0000
@@ -29,6 +29,7 @@
 SUBDIRS = 
 
 @VERSION_MK@
+VERSION = @VERSION@
 
 # source/build directories
 VPATH           = @srcdir@

