From zsh-workers-return-7312-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Jul 28 17:59:10 1999
Return-Path: <zsh-workers-return-7312-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5933 invoked from network); 28 Jul 1999 17:59:09 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 28 Jul 1999 17:59:09 -0000
Received: (qmail 12770 invoked by alias); 28 Jul 1999 17:52:30 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7312
Received: (qmail 12751 invoked from network); 28 Jul 1999 17:52:29 -0000
To: zsh-workers@sunsite.auc.dk
Subject: Re: PATCH: _cvs
References: <rsqvhb4bsdi.fsf@crane.jaist.ac.jp>
MIME-Version: 1.0 (generated by AKEMI 1.13.2 - =?ISO-2022-JP?B?Ig==?=
 =?ISO-2022-JP?B?GyRCQTA0Y0s8GyhCIg==?=)
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@jaist.ac.jp>
Date: 29 Jul 1999 02:50:31 +0900
In-Reply-To: Tanaka Akira's message of "29 Jul 1999 02:23:37 +0900"
Message-ID: <rsqso68br4o.fsf@crane.jaist.ac.jp>
Lines: 107
User-Agent: Chao-gnus/6.12.5 AKEMI/1.13.2 (=?ISO-2022-JP?B?GyRCQTAbKEI=?=
 =?ISO-2022-JP?B?GyRCNGNLPBsoQg==?=) FLAM-DOODLE/1.12.6
 (=?ISO-2022-JP?B?GyRCM3cbKEI=?= 10R4.0/5.0) Emacs/20.4
 (sparc-sun-solaris2.6) MULE/4.0 (HANANOEN)

In article <rsqvhb4bsdi.fsf@crane.jaist.ac.jp>,
  Tanaka Akira <akr@jaist.ac.jp> writes:

> Hm. Since cvsignore may have patterns instead of concrete filenames, 
> _cvs should not quote them.

Sorry, I found more simple fix on second thoughts.
This revert previous patch and fix it by simple way.

--- Completion/User/_cvs	Thu Jul 29 02:34:48 1999
+++ Completion/User/_cvs	Thu Jul 29 02:35:26 1999
@@ -198,7 +198,7 @@
 _cvsdirentries () {
   setopt localoptions nullglob unset
   if [[ -f ${pref}CVS/Entries ]]; then
-    entries=( ${${${${(M)${(f)"$(<${pref}CVS/Entries)"}:#D/*}#D/}%%/*}:q} )
+    entries=( ${${${(M)${(f)"$(<${pref}CVS/Entries)"}:#D/*}#D/}%%/*} )
   else
     entries=()
   fi
@@ -207,7 +207,7 @@
 _cvsentries () {
   setopt localoptions nullglob unset
   if [[ -f ${pref}CVS/Entries ]]; then
-    entries=( ${${${${${(f)"$(<${pref}CVS/Entries)"}:#D}#(D|)/}%%/*}:q} )
+    entries=( ${${${${(f)"$(<${pref}CVS/Entries)"}:#D}#(D|)/}%%/*} )
   else
     entries=()
   fi
@@ -234,13 +234,13 @@
   local OLDTZ="$TZ"; if ! (( $+TZ )); then unset OLDTZ; fi; export TZ=GMT
 
   mtime=( ${(s:/:)${(j:/:)${${${${(M)${(f)Entries}:#/*}#/}%/*/*}/\\/*\\///}}} )
-  entries=( ${${${${(M)${(f)Entries}:#D/*}#D/}%%/*}:q} )
+  entries=( ${${${(M)${(f)Entries}:#D/*}#D/}%%/*} )
   builtin stat -n +mtime -F '%a %b %e %T %Y' "$pref${(@k)^mtime}" |
   while read line
   do
     line=${line#$pref}
     if [[ x"$mtime[${line%% *}]" != x"${line#* }" ]]; then
-      entries=($entries "${${line%% *}:q}")
+      entries=($entries "${line%% *}")
     fi
   done
 
@@ -252,8 +252,8 @@
     _cvsdirentries
     case $#entries in
       0) false;;
-      1) compgen "$@" -g "$entries";;
-      *) compgen "$@" -g '('${(j:|:)entries}')';;
+      1) compgen "$@" -g "${entries:q}";;
+      *) compgen "$@" -g '('${(j:|:)entries:q}')';;
     esac
   else
     _files
@@ -267,8 +267,8 @@
     _cvsentries
     case $#entries in
       0) false;;
-      1) compgen -g "$entries";;
-      *) compgen -g '('${(j:|:)entries}')';;
+      1) compgen -g "${entries:q}";;
+      *) compgen -g '('${(j:|:)entries:q}')';;
     esac
   else
     _files
@@ -282,8 +282,8 @@
     _cvsentries_modified
     case $#entries in
       0) false;;
-      1) compgen -g "$entries";;
-      *) compgen -g '('${(j:|:)entries}')';;
+      1) compgen -g "${entries:q}";;
+      *) compgen -g '('${(j:|:)entries:q}')';;
     esac
   else
     _files 
@@ -297,9 +297,9 @@
     _cvsentries
     setopt localoptions unset
     local omit
-    omit=( ${pref}*(D:t:q) )
-    eval 'entries=( ${entries:#('${(j:|:)omit}')} )'
-    compadd -P "$qpref" - ${entries} ||
+    omit=( ${pref}*(D:t) )
+    eval 'entries=( ${entries:#('${(j:|:)omit:q}')} )'
+    compadd -P "$qpref" - ${entries:q} ||
     _cvsdirs
   else
     _files
@@ -313,11 +313,11 @@
     _cvsentries
     setopt localoptions unset
     local omit
-    omit=( CVS $entries ${=cvsignore} )
+    omit=( CVS ${entries:q} ${=cvsignore} )
     [[ -r ~/.cvsignore ]] && omit=( $omit $(<~/.cvsignore) )
     [[ -r ${pref}.cvsignore ]] && omit=( $omit $(<${pref}.cvsignore) )
     compgen -g '*~(*/|)('${(j:|:)omit}')(D)' ||
-    { _cvsdirentries; compgen -g '('${(j:|:)entries}')(D)' }
+    { _cvsdirentries; compgen -g '('${(j:|:)entries:q}')(D)' }
   else
     _files
   fi
-- 
Tanaka Akira

