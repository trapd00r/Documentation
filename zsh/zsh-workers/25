From zsh-workers-request@math.gatech.edu  Tue May 23 20:06:37 1995
Received: from gatech.edu (gatech.edu [128.61.1.1]) by werple.mira.net.au (8.6.10/8.6.9) with SMTP id UAA28548 for <mason@werple.mira.net.au>; Tue, 23 May 1995 20:06:33 +1000
Received: from math (math.skiles.gatech.edu) by gatech.edu with SMTP id AA21689
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Tue, 23 May 1995 06:05:56 -0400
Received: by math (5.x/SMI-SVR4)
	id AA03699; Tue, 23 May 1995 06:04:02 -0400
Resent-Date: Tue, 23 May 1995 11:04:04 +0100 (BST)
Old-Return-Path: <zefram@dcs.warwick.ac.uk>
From: Zefram <A.Main@dcs.warwick.ac.uk>
Message-Id: <17426.199505231004@stone.dcs.warwick.ac.uk>
Subject: Esoteric zsh bug
To: zsh-workers@math.gatech.edu (Z Shell workers mailing list)
Date: Tue, 23 May 1995 11:04:04 +0100 (BST)
X-Stardate: [-31]5717.09
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-Id: <"-GBWj2.0.jv.HCRml"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/25
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

-----BEGIN PGP SIGNED MESSAGE-----

>>> Warning: nothing above this line is part of the message. <<<

A bit of maltreatment of zsh:

% cat >xyzzy.c
main(c,v)char**v;{execlp(*++v,0);}
^D
% cc xyzzy.c
% ./a.out zsh
zsh: segmentation fault  ./a.out zsh

zsh falls over if argc is 0, as does ksh, and bash, and csh, and tcsh, and sh.
Not to mention sed, cut, grep, and in fact just about anything that cares about
its command-line arguments.  If anyone is actually interested in making zsh
survive this, here's the patch:

      *** Src/init.c.old	Tue May 23 10:50:26 1995
      --- Src/init.c	Tue May 23 10:52:49 1995
      ***************
      *** 42,47 ****
      --- 42,48 ----
        void
        main(int argc, char **argv, char **envp)
        {
      +     static char *defargv[2] = {"zsh", (char *)NULL};
            char *zshname;
        
        #ifdef LC_ALL
      ***************
      *** 49,54 ****
      --- 50,57 ----
        #endif
            environ = envp;
            permalloc();
      +     if (!argc)
      + 	argv = defargv;
            if (!(zshname = strrchr(argv[0], '/')))
        	zshname = argv[0];
            else

-----BEGIN PGP SIGNATURE-----
Version: 2.6.i

iQBVAgUBL8GzEWWJ8JfKi+e9AQEPjAIAk6y9H2cgU3MvuNndoezF77T16aDeh0Sx
vkK3CnvVfGizluoUkhtySP5DPhqOYPYFo0qhg/3YUipglCik9L5jHw==
=N3DP
-----END PGP SIGNATURE-----

