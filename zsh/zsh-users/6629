From zsh-users-return-6629-mason-zsh=primenet.com.au@sunsite.dk Thu Oct 02 17:18:08 2003
Return-Path: <zsh-users-return-6629-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13374 invoked from network); 2 Oct 2003 17:18:07 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 2 Oct 2003 17:18:07 -0000
Received: (qmail 29875 invoked by alias); 2 Oct 2003 17:05:54 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 6629
Received: (qmail 29829 invoked from network); 2 Oct 2003 17:05:52 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 2 Oct 2003 17:05:52 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [193.109.254.211] by sunsite.dk (MessageWall 1.0.8) with SMTP; 2 Oct 2003 17:5:52 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-3.tower-36.messagelabs.com!1065114350!913814
X-StarScan-Version: 5.1.9.3; banners=-,-,-
Received: (qmail 8034 invoked from network); 2 Oct 2003 17:05:51 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-3.tower-36.messagelabs.com with SMTP; 2 Oct 2003 17:05:51 -0000
Received: from gmcs3.local ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id h92H5of7006067;
	Thu, 2 Oct 2003 18:05:50 +0100
Received: from gmcs3.local (localhost [127.0.0.1])
	by gmcs3.local (8.11.6/8.11.6/SuSE Linux 0.5) with ESMTP id h92H8TV13974;
	Thu, 2 Oct 2003 19:08:29 +0200
cc: Zsh Users <zsh-users@sunsite.dk>
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <20031002155306.GA26812@DervishD> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <20031001221753.GA23189@DervishD> <1031002023639.ZM22046@candle.brasslantern.com> <20031002080358.GA23230@DervishD> <1031002142928.ZM22765@candle.brasslantern.com> <20031002155306.GA26812@DervishD>
To: DervishD <raul@pleyades.net>
Subject: Re: Emulating 'locate' 
Date: Thu, 02 Oct 2003 19:08:29 +0200
Message-ID: <13972.1065114509@gmcs3.local>

DervishD wrote:

>     Well, the localoptions is for making option changes local, so
> options are restored ;) The nullglob and nocshnullglob are for making
> sure that zsh won't barf if no matches are found. In fact, something
> like this would be better for users:
> 
>     locate () {
>         setopt localoptions nullglob nocshnullglob rcexpandparam
>         local -a matches
> 
>         matches=(/**/*${*}*{,/**/*})
> 
>         if [[ -z "$matches" ]]
>         then
>             print "Sorry, no matches found for '$*'"
>         else
>             print -l $matches
>         fi

What? So instead of zsh barfing on no matches, your script goes and
does the barfing for it: if I'm not missing the plot entirely here
you've basically just undone the effect of the nullglob options
manually.

You'd only want to do this if this locate() function is really part of
something bigger and the error message is indicating something really
is wrong. In which case you might want to send it to stderr with >&2.

There are good reasons why commands like locate and grep don't print
silly messages when nothing is found. The one useful improvement you
might make would be to return 1 if no matches are found. The zsh "no
matches found" error is a different case because the command isn't even
run: something that wouldn't otherwise be obvious.

Oliver

