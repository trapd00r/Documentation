From zsh-workers-return-21134-mason-zsh=primenet.com.au@sunsite.dk Tue Apr 12 17:35:50 2005
Return-Path: <zsh-workers-return-21134-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18031 invoked from network); 12 Apr 2005 17:35:49 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 12 Apr 2005 17:35:49 -0000
Received: (qmail 11140 invoked from network); 12 Apr 2005 17:35:43 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 12 Apr 2005 17:35:43 -0000
Received: (qmail 16176 invoked by alias); 12 Apr 2005 17:35:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21134
Received: (qmail 16162 invoked from network); 12 Apr 2005 17:35:39 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 12 Apr 2005 17:35:39 -0000
Received: (qmail 10826 invoked from network); 12 Apr 2005 17:35:39 -0000
Received: from mailhost1.csr.com (HELO MAILSWEEPER01.csr.com) (81.105.217.43)
  by a.mx.sunsite.dk with SMTP; 12 Apr 2005 17:35:34 -0000
Received: from exchange03.csr.com (unverified [10.100.137.60]) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.12) with ESMTP id <T7044191f690a6c8d017f4@MAILSWEEPER01.csr.com> for <zsh-workers@sunsite.dk>;
 Tue, 12 Apr 2005 18:33:54 +0100
Received: from news01.csr.com ([10.103.143.38]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Tue, 12 Apr 2005 18:38:29 +0100
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.1/8.12.11) with ESMTP id j3CHZWFL008898
	for <zsh-workers@sunsite.dk>; Tue, 12 Apr 2005 18:35:32 +0100
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.1/8.13.1/Submit) with ESMTP id j3CHZVPV008895
	for <zsh-workers@sunsite.dk>; Tue, 12 Apr 2005 18:35:32 +0100
Message-Id: <200504121735.j3CHZVPV008895@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: Re: PATCH: allocating a new file descriptor 
In-reply-to: <200504121257.j3CCvkXr003286@news01.csr.com> 
References: <200504121257.j3CCvkXr003286@news01.csr.com>
Date: Tue, 12 Apr 2005 18:35:30 +0100
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 12 Apr 2005 17:38:30.0022 (UTC) FILETIME=[70C78A60:01C53F86]
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

The error message from a bad file descriptor is the system error
message, so it can change.  We can work it out by using a file
descriptor which is almost certainly invalid.

Index: Test/A04redirect.ztst
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/A04redirect.ztst,v
retrieving revision 1.6
diff -u -r1.6 A04redirect.ztst
--- Test/A04redirect.ztst	12 Apr 2005 15:11:12 -0000	1.6
+++ Test/A04redirect.ztst	12 Apr 2005 17:33:43 -0000
@@ -3,6 +3,10 @@
 %prep
   mkdir redir.tmp && cd redir.tmp
 
+  myfd=99
+  (echo >&$myfd) 2>msg
+  bad_fd_msg="${$(<msg)##*:}"
+
 %test
 
   print 'This is file redir' >redir  &&  cat redir
@@ -247,7 +251,7 @@
   exec {myfd}>&-
   print This message should disappear >&$myfd
 1q:Closing file descriptor using brace syntax
-?(eval):2: $myfd: bad file descriptor
+?(eval):2: $myfd:$bad_fd_msg
 
   typeset -r myfd
   echo This should not appear {myfd}>nologfile

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

**********************************************************************

