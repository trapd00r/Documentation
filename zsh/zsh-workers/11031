From zsh-workers-return-11031-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Apr 30 17:54:36 2000
Return-Path: <zsh-workers-return-11031-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25286 invoked from network); 30 Apr 2000 17:54:34 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 30 Apr 2000 17:54:34 -0000
Received: (qmail 21843 invoked by alias); 30 Apr 2000 17:54:27 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11031
Received: (qmail 21824 invoked from network); 30 Apr 2000 17:54:27 -0000
Date: Sun, 30 Apr 2000 18:54:25 +0100 (BST)
From: Oliver Kiddle <kiddleo@frankie.logica.co.uk>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: AIX dependencies and AIX compile problem
Message-ID: <Pine.LNX.3.96.1000430184456.24933A-100000@frankie.logica.co.uk>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

This patch fixes AIX compile dependencies introduced since 3.1.6-dev-21.
There may be more to come because I haven't yet got a clean compile: I get
an error message for lines 925 and 968 of init.c saying 'Operands must be
pointers to compatible types' and I haven't got time at the moment to look
into that in more detail.

Oliver

Index: Src/glob.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/glob.c,v
retrieving revision 1.4
diff -u -r1.4 glob.c
--- Src/glob.c	2000/04/14 11:49:31	1.4
+++ Src/glob.c	2000/04/30 17:52:52
@@ -1514,7 +1514,7 @@
 /* check to see if str is eligible for brace expansion */
 
 /**/
-int
+mod_export int
 hasbraces(char *str)
 {
     char *lbr, *mbr, *comma;
@@ -1696,7 +1696,7 @@
 /* brace expansion */
 
 /**/
-void
+mod_export void
 xpandbraces(LinkList list, LinkNode *np)
 {
     LinkNode node = (*np), last = prevnode(node);
Index: Src/math.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/math.c,v
retrieving revision 1.1.1.30
diff -u -r1.1.1.30 math.c
--- Src/math.c	2000/03/15 09:36:28	1.1.1.30
+++ Src/math.c	2000/04/30 17:52:52
@@ -943,7 +943,7 @@
 }
 
 /**/
-zlong
+mod_export zlong
 mathevali(char *s)
 {
     mnumber x = matheval(s);
Index: Src/module.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/module.c,v
retrieving revision 1.2
diff -u -r1.2 module.c
--- Src/module.c	2000/04/19 13:42:51	1.2
+++ Src/module.c	2000/04/30 17:52:52
@@ -666,7 +666,7 @@
 }
 
 /**/
-int
+mod_export int
 load_module(char const *name)
 {
     Module m;
Index: Src/Zle/compcore.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compcore.c,v
retrieving revision 1.11
diff -u -r1.11 compcore.c
--- Src/Zle/compcore.c	2000/04/27 08:21:10	1.11
+++ Src/Zle/compcore.c	2000/04/30 17:52:53
@@ -42,13 +42,12 @@
 /* Non-zero if we should go back to the last prompt. */
 
 /**/
-int dolastprompt;
+mod_export int dolastprompt;
 
 /* Non-zero if we should keep an old list. */
 
 /**/
-mod_export
-int oldlist, oldins;
+mod_export int oldlist, oldins;
 
 /* This is used to decide when the cursor should be moved to the end of    *
  * the inserted word: 0 - never, 1 - only when a single match is inserted, *
Index: Src/Zle/compresult.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compresult.c,v
retrieving revision 1.12
diff -u -r1.12 compresult.c
--- Src/Zle/compresult.c	2000/04/27 08:21:10	1.12
+++ Src/Zle/compresult.c	2000/04/30 17:52:53
@@ -540,7 +540,7 @@
  * braces. */
 
 /**/
-int
+mod_export int
 hasbrpsfx(Cmatch m, char *pre, char *suf)
 {
     char *op = lastprebr, *os = lastpostbr;
@@ -1148,7 +1148,7 @@
 /* This skips over matches that are not to be listed. */
 
 /**/
-Cmatch *
+mod_export Cmatch *
 skipnolist(Cmatch *p, int showall)
 {
     int mask = (showall ? 0 : (CMF_NOLIST | CMF_MULT)) | CMF_HIDE;


