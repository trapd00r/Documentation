From zsh-users-return-14789-mason-zsh=primenet.com.au@zsh.org Wed Feb 03 22:35:39 2010
Return-Path: <zsh-users-return-14789-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9940 invoked by alias); 3 Feb 2010 22:35:39 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14789
Received: (qmail 3740 invoked from network); 3 Feb 2010 22:35:38 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00,DKIM_SIGNED,
	DKIM_VERIFIED autolearn=ham version=3.2.5
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.218.227 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:cc:content-type;
        bh=eWWLMdKHzAZVacoa0X+HLn/TVXFypkPAjULP0MmOmxo=;
        b=pW2sTCrO/2k8GR5NxeZk38/YkUEVjhkBf6YvKxGwTNrKJ57xPmL9w7FrlMohn0jFWH
         ELClIiXcBBdCAi7XWgOG0HFjvJZw4C5CFQGAaCDGyS8y/8gogBI6QQ1x0yPiLDhpnzTA
         Gxne9yXGfLeduP9HPe5WvdFo4iFievfkfOPDI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :cc:content-type;
        b=no4hnPlPbBCrEgUt2bLKRprmM/MrcXcAqo8uTYqlZRtRPberaJNKJmhh7KLXW6kDyF
         MdURhhkpEQKcCWleWtNE+ZAAMQ1T9JPZ3+tIi6joyqegbeU7hNoLwxG35ZwWQkaAqAeA
         pQtytWLApz9TNAnaygMJ+K0BHLYNp8YMNkvX0=
MIME-Version: 1.0
In-Reply-To: <201002021250.17528.joke@seiken.de>
References: <20100202081546.GA5930@panix.com>
	 <201002021007.35234.joke@seiken.de>
	 <2d460de71002020211y57ef49eaq32bfd97403dd7d25@mail.gmail.com>
	 <201002021250.17528.joke@seiken.de>
Date: Wed, 3 Feb 2010 23:29:50 +0100
Message-ID: <2d460de71002031429v170babd3i9f26d9887a45b768@mail.gmail.com>
Subject: Re: Want to replace bash w zsh as system shell on Ubuntu
From: Richard Hartmann <richih.mailinglist@gmail.com>
To: Joke de Buhr <joke@seiken.de>
Cc: zsh-users@zsh.org
Content-Type: text/plain; charset=UTF-8

On Tue, Feb 2, 2010 at 12:50, Joke de Buhr <joke@seiken.de> wrote:

> It should be easier on ubuntu because they switched their default system shell
> from bash to dash and had to change some init scripts to posix sh compliant
> syntax.

Or not. Guess why dash expands to _Debian_ alquemist shell ;)


> Second they use upstart scripts to replace some common sysv init scripts.
> These upstart scripts were rewritten from scratch and are posix sh compliant
> too.

Debian uses a different system, but is basically doing the same thing.


> Zsh runs in sh compatibility mode if it's executable was called via symlink
> from /bin/sh. But the problem is most distribution's init scripts are only
> bash compliant but are called via symlink from /bin/sh.
>
> Sh compliant shell scripting can't use stuff like associative arrays,
> subshell commands like "echo $(date -R)" or "[["-style tests. But some init
> scripts do.

Not really, as Bash is also in compatible mode when called as /bin/sh,
everything _should_ work. Fact it, it does not. In neither shell.
This is part of the reason why dash was needed.


>> Also, please note that you need to link to /bin/zsh not /usr/bin/zsh or
>> you _might_ break stuff (admittedly unlikely on today's single-user
>> systems).
>
> Dynamic linking problems (libpcre) have been fixed in recent ubuntu zsh
> releases. Probable the same in debian (unstable) releases. It's save to link
> to /bin/zsh.

I was referring to the fact that /usr can be loaded via network, whereas
/bin is required to be saved locally. Thus, having root's default shell to
anything in /usr can leave you with a non-working rescue shell and
simply rebooting with init=/bin/zsh may not be an option at that time.


> There's a difference between running "sudo -s" and changing the shell via
> "chsh" and using "su". Sudo doesn't change the HOME environmental variable to
> HOME=/root. It's set to "HOME=$HOME" so the root session uses the
> configuration files of the user. That's why you don't have to copy your
> ~/.vimrc configuration to /root/.vimrc.
>
> This behavior is very important if you're running a system with multiple
> admins.

True, but same as the /usr issue I don't think it's applicable in his case.


Richard

