From zsh-users-return-11055-mason-zsh=primenet.com.au@sunsite.dk Tue Dec 05 15:21:15 2006
Return-Path: <zsh-users-return-11055-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21362 invoked from network); 5 Dec 2006 15:21:09 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 Dec 2006 15:21:09 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 75016 invoked from network); 5 Dec 2006 15:21:02 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 Dec 2006 15:21:02 -0000
Received: (qmail 8957 invoked by alias); 5 Dec 2006 15:20:51 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11055
Received: (qmail 8947 invoked from network); 5 Dec 2006 15:20:50 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 5 Dec 2006 15:20:50 -0000
Received: (qmail 73716 invoked from network); 5 Dec 2006 15:20:50 -0000
Received: from cluster-d.mailcontrol.com (217.69.20.190)
  by a.mx.sunsite.dk with SMTP; 5 Dec 2006 15:20:47 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly28d.srv.mailcontrol.com (MailControl) with ESMTP id kB5FJfTf026561
	for <zsh-users@sunsite.dk>; Tue, 5 Dec 2006 15:20:42 GMT
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Tue, 5 Dec 2006 15:20:20 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.8/8.13.4) with ESMTP id kB5FKDnX010907
	for <zsh-users@sunsite.dk>; Tue, 5 Dec 2006 15:20:13 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.8/8.13.8/Submit) with ESMTP id kB5FKDfu010904
	for <zsh-users@sunsite.dk>; Tue, 5 Dec 2006 15:20:13 GMT
Message-Id: <200612051520.kB5FKDfu010904@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: Zsh Users <zsh-users@sunsite.dk>
Subject: Re: passing partial command arguments to completion functions 
In-reply-to: <200612050754.10233.steve@borho.org> 
References: <200612050754.10233.steve@borho.org>
Comments: In-reply-to Steve Borho <steve@borho.org>
   message dated "Tue, 05 Dec 2006 07:54:10 -0600."
Date: Tue, 05 Dec 2006 15:20:12 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 05 Dec 2006 15:20:20.0248 (UTC) FILETIME=[E05DE980:01C71880]
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A-07-06-80 (www.mailcontrol.com) on 10.68.0.138

Steve Borho wrote:
> hg add ../foo/bar<TAB>
> 
> I need to be able to pass the partial path to hg status, but this is
> one notch above my current belt level :)   Can anyone give me some
> hints, or point me at some completion functions which do something similar?

The usual way of doing this is to look at $PREFIX in the completion
function.  This contains the part of the word to be completed that's
before the cursor.

There are all sorts of uses in the completion system already, though
none of them are particularly simple.  See, for example, the
_remote_files function in the _ssh function (Completion/Unix/Command in
the source tree) which tries to get a list of remote files that can be
completed using the existing prefix.

The special parameters used there are described in the zshcompwid manual
page.  The code is complicated by subtleties to do with quoting and
whether some part of the prefix is being ignored --- for example, it
assumes the remote host has already been transferred to $IPREFIX because
it's no longer being completed.  That's probably not relevant in your
case.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


To access the latest news from CSR copy this link into a web browser:  http://www.csr.com/email_sig.php

