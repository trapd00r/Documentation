From zsh-workers-return-19815-mason-zsh=primenet.com.au@sunsite.dk Thu Apr 22 10:17:55 2004
Return-Path: <zsh-workers-return-19815-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8887 invoked from network); 22 Apr 2004 10:17:54 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 22 Apr 2004 10:17:54 -0000
Received: (qmail 25451 invoked by alias); 22 Apr 2004 10:17:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19815
Received: (qmail 25430 invoked from network); 22 Apr 2004 10:17:48 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 22 Apr 2004 10:17:48 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [130.225.247.86] by sunsite.dk (MessageWall 1.0.8) with SMTP; 22 Apr 2004 10:17:48 -0000
Received: (qmail 10730 invoked from network); 22 Apr 2004 10:17:47 -0000
Received: from lhuumrelay3.lnd.ops.eu.uu.net (62.189.58.19)
  by a.mx.sunsite.dk with SMTP; 22 Apr 2004 10:17:46 -0000
Received: from MAILSWEEPER01.csr.com (mailhost1.csr.com [62.189.183.235])
	by lhuumrelay3.lnd.ops.eu.uu.net (8.11.0/8.11.0) with ESMTP id i3MAHJv11949
	for <zsh-workers@sunsite.dk>; Thu, 22 Apr 2004 10:17:19 GMT
Received: from EXCHANGE02.csr.com (unverified [192.168.137.45]) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.12) with ESMTP id <T691e576df7c0a88d01634@MAILSWEEPER01.csr.com>;
 Thu, 22 Apr 2004 11:16:52 +0100
Received: from csr.com ([192.168.144.127]) by EXCHANGE02.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Thu, 22 Apr 2004 11:18:04 +0100
To: Vincent Stemen <zsh@hightek.org>,
   Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: PATCH: (2) Re: FreeBSD compatability feature request 
In-reply-to: "Peter Stephenson"'s message of "Thu, 22 Apr 2004 10:59:57 BST."
             <17122.1082627997@csr.com> 
Date: Thu, 22 Apr 2004 11:17:19 +0100
Message-ID: <10937.1082629039@csr.com>
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 22 Apr 2004 10:18:04.0312 (UTC) FILETIME=[192EF180:01C42853]
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.2 required=6.0 tests=EXCUSE_16 autolearn=no 
	version=2.63
X-Spam-Hits: 0.2

Peter Stephenson wrote:
> However, that now gives us three different modes: the original zsh one,
> POSIX where all traps are deferred, and this mode where signals are
> delivered straight through.  So one option isn't enough.  Presumably
> TRAPS_ASYNC should be off for the standard zsh behaviour, on for the new
> behaviour, and we need another option for POSIX which will be overridden
> if TRAPS_ASYNC is set.  Yuk.

Actually (sorry to generate all the traffic) it's possible I was getting
confused...

Zsh will usually block other signals while waiting for SIGCHLD.  This
may be all that POSIX requires.  What it doesn't do (and why I was able
to get asynchronous traps working) is ensure that traps don't run if it
stops waiting, for example because a different process exited.  I
originally tested this by running a background functions which exited,
generating a SIGCHLD, which caused all queued signals to be delivered.

Hence it's possible that the queueing traps thing is a red herring, that
zsh is sufficiently POSIX compliant by default, and all we need is the
ability to receive signals other than SIGCHLD while waiting for a child.
(It's a bit late to back out now.)

If anybody actually knows anything about all this, their views would be
especially welcome.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR Ltd., Science Park, Milton Road,
Cambridge, CB4 0WH, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

This footnote also confirms that this email message has been swept by
MIMEsweeper for the presence of computer viruses.

www.mimesweeper.com
**********************************************************************

