From zsh-workers-request@math.gatech.edu Thu Feb 19 20:31:45 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 24998 invoked from network); 19 Feb 1998 20:31:44 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 19 Feb 1998 20:31:44 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id PAA18270;
	Thu, 19 Feb 1998 15:10:37 -0500 (EST)
Resent-Date: Thu, 19 Feb 1998 15:10:03 -0500 (EST)
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <980219121138.ZM31922@candle.brasslantern.com>
Date: Thu, 19 Feb 1998 12:11:38 -0800
In-Reply-To: <Pine.SV4.3.95.980219140249.22897B-100000@itsrm1>
Comments: In reply to Andrej Borsenkow <borsenkow.msk@sni.de>
        "How to strip off common prefix for array elements?" (Feb 19,  2:10pm)
References: <Pine.SV4.3.95.980219140249.22897B-100000@itsrm1>
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: borsenkow.msk@sni.de, Zsh users mailing list <zsh-users@math.gatech.edu>
Subject: Re: How to strip off common prefix for array elements?
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"B1PnS.0.qS4.Q69xq"@math>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/1330
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On Feb 19,  2:10pm, Andrej Borsenkow wrote:
} Subject: How to strip off common prefix for array elements?
}
} Consider the case:
} 
} cdpath=(~ ~/src ~/build/mips)
} cd zshTAB -> gives me zsh-3.1.2 which is O.K., but I don't have any chance
} to cd into build, because ~/src stays in the way.

So what you're trying to do is use completion to disambiguate when two or
more cdpath directories have same-named subdirectories?

Try this variant:

# Start of cdmatch.
# Save in your functions directory and autoload, then do
# compctl -x 'S[/][~][./][../]' -g '*(-/)' - \
#         'n[-1,/], s[]' -K cdmatch -U -- cd pushd
#
# Completes directories for cd, pushd, ... anything which knows about cdpath.
# You do not have to include `.' in your cdpath.
#
# It works properly only if $ZSH_VERSION > 3.0-pre4.  Remove `emulate -R zsh'
# for all other values of $ZSH_VERSION > 2.6-beta2. For earlier versions
# it still works if RC_EXPAND_PARAM is not set or when cdpath is empty.
emulate -R zsh
setopt localoptions
local narg pref cdp

read -nc narg
read -Ac pref

cdp=(. $cdpath)
reply=( ${^cdp}/${pref[$narg]}*$2(-/DN^M) )

return
# End of cdmatch.

It could use some work, but the basic idea is that you don't remove any
prefixes, and use -U to replace the entire word with the full completion.
As is, the above is really only usable with menucomplete set, but it's a
start in the right direction.


-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

