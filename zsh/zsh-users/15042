From zsh-users-return-15042-mason-zsh=primenet.com.au@zsh.org Mon May 03 19:00:53 2010
Return-Path: <zsh-users-return-15042-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18881 invoked by alias); 3 May 2010 19:00:53 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15042
Received: (qmail 3968 invoked from network); 3 May 2010 19:00:51 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at math.technion.ac.il does not designate permitted sender hosts)
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: AvsEAPK33kuERHMG/2dsb2JhbACdJHG9VwKFEASDOQ
X-IronPort-AV: E=Sophos;i="4.52,320,1270414800"; 
   d="scan'208";a="1260118"
X-Authentication-Warning: fermat.math.technion.ac.il: nyh set sender to nyh@math.technion.ac.il using -f
Date: Mon, 3 May 2010 21:49:50 +0300
From: "Nadav Har'El" <nyh@math.technion.ac.il>
To: Omari Norman <omari@smileystation.com>
Cc: zsh-users@zsh.org
Subject: Re: Bug with trap?
Message-ID: <20100503184950.GA21369@fermat.math.technion.ac.il>
References: <20100430223857.GA4782@cameron>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20100430223857.GA4782@cameron>
User-Agent: Mutt/1.4.2.2i
Hebrew-Date: 20 Iyyar 5770

On Fri, Apr 30, 2010, Omari Norman wrote about "Bug with trap?":
> It seems that the trap builtin with the EXIT argument does not work
> properly if you have a list inside curly braces and the output is piped
> to another command. For example:
>...
> { trap "echo exit trap running" EXIT} | cat
>...
> Thus the trap in the last example simply did not run. You can try this
> with another command in the trap (e.g. touch, or rm) and you will get
> the same result: the trap does not run.
> 
> This is zsh 4.3.6 on Debian 5.0. Is this a bug or am I missing
> something?

This is not a bug, but rather a result of the way that shells (not just zsh)
do pipes. When you have the pipe

	a | b

the command "a" runs in a subshell (a child process), while the command "b"
runs in the current shell, and they communicate through a pipe. Because "a"
runs in a separate process, one of the results is that it cannot influence
settings of the current shells - it cannot set environment variables, traps,
and so on.

For example if you do
	a=3
	echo $a

Obviously, you get 3

But if you do
	{ a=3 } | cat
	echo $a

a is not set.

On the other hand if you do
	echo | {a=3;}
	echo $a

Again, a is set to 3. This goes to show you that it is the second part of
the pipe, not the first, which runs in the current shell, and only this part
of the pipe can influence things like traps or variables.

Nadav.

-- 
Nadav Har'El                        |       Monday, May  3 2010, 20 Iyyar 5770
nyh@math.technion.ac.il             |-----------------------------------------
Phone +972-523-790466, ICQ 13349191 |I had a lovely evening. Unfortunately,
http://nadav.harel.org.il           |this wasn't it. - Groucho Marx

