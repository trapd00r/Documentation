From zsh-workers-return-19705-mason-zsh=primenet.com.au@sunsite.dk Tue Mar 30 02:14:53 2004
Return-Path: <zsh-workers-return-19705-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16777 invoked from network); 30 Mar 2004 02:14:53 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 30 Mar 2004 02:14:53 -0000
Received: (qmail 2698 invoked by alias); 30 Mar 2004 02:14:47 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19705
Received: (qmail 2640 invoked from network); 30 Mar 2004 02:14:47 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 30 Mar 2004 02:14:47 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [130.225.247.86] by sunsite.dk (MessageWall 1.0.8) with SMTP; 30 Mar 2004 2:14:46 -0000
Received: (qmail 24947 invoked from network); 30 Mar 2004 02:14:46 -0000
Received: from mclean.mail.mindspring.net (207.69.200.57)
  by a.mx.sunsite.dk with SMTP; 30 Mar 2004 02:14:44 -0000
Received: from user-2injqff.dialup.mindspring.com ([165.121.233.239])
	by mclean.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 1B88m2-000764-00
	for zsh-workers@sunsite.dk; Mon, 29 Mar 2004 21:14:43 -0500
From: Jonathan Hankins <jonathan-hankins@mindspring.com>
To: zsh-workers@sunsite.dk
Subject: Bug with associative array and P flag?
Date: Mon, 29 Mar 2004 20:14:40 -0600
User-Agent: KMail/1.5.4
MIME-Version: 1.0
Content-Type: text/plain;
  charset="us-ascii"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
Message-Id: <200403292014.40540.jonathan-hankins@mindspring.com>
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: *
X-Spam-Status: No, hits=1.6 required=6.0 tests=RCVD_IN_NJABL,RCVD_IN_SORBS 
	autolearn=no version=2.63
X-Spam-Hits: 1.6

Hi,

Below are two examples of using the P flag to variable expansion to access an 
array indirectly.  When using a regular array (foo), this works correctly.  
However, when using an associative array in the same way, I get the value of 
the first (alphabetically? randomly?) key (animal) regardless of the key I 
use.  Should the P flag work with the associative array in the same way as it 
does with the regular array?

I have tested with 4.2.0, 4.1.1 and 4.0.9 on Debian GNU/Linux.

% typeset -a foo
% typeset -A bar
%
% foo=(this is an array)
%
% bar[color]=red
% bar[animal]=cat
% bar[fruit]=apple
%
%
% ref=foo
% print ${${(P)ref}[1]}
this
% print ${${(P)ref}[2]}
is
% print ${${(P)ref}[3]}
an
% print ${${(P)ref}[4]}
array
%
% ref=bar
% print ${${(P)ref}[color]}
cat
% print ${${(P)ref}[animal]}
cat
% print ${${(P)ref}[fruit]}
cat
%

Just for kicks, this works as expected:

% print ${${(P)ref}}
cat apple red
% print ${${(Pk)ref}}                                               
animal fruit color
% print ${${(Pkv)ref}}
animal cat fruit apple color red

Thanks,

-Jonathan Hankins

