From zsh-workers-return-22210-mason-zsh=primenet.com.au@sunsite.dk Fri Feb 10 11:33:32 2006
Return-Path: <zsh-workers-return-22210-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18148 invoked from network); 10 Feb 2006 11:33:30 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 10 Feb 2006 11:33:30 -0000
Received: (qmail 73001 invoked from network); 10 Feb 2006 11:33:22 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 Feb 2006 11:33:22 -0000
Received: (qmail 462 invoked by alias); 10 Feb 2006 11:33:15 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22210
Received: (qmail 451 invoked from network); 10 Feb 2006 11:33:14 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 10 Feb 2006 11:33:14 -0000
Received: (qmail 72370 invoked from network); 10 Feb 2006 11:33:14 -0000
Received: from ns9.hostinglmi.net (213.194.149.146)
  by a.mx.sunsite.dk with SMTP; 10 Feb 2006 11:33:13 -0000
Received: from 212.red-80-35-44.staticip.rima-tde.net ([80.35.44.212]:33158 helo=localhost)
	by ns9.hostinglmi.net with esmtpa (Exim 4.52)
	id 1F7WWZ-0001NV-8r
	for zsh-workers@sunsite.dk; Fri, 10 Feb 2006 12:33:15 +0100
Date: Fri, 10 Feb 2006 12:34:19 +0100
From: DervishD <zsh@dervishd.net>
To: Zsh-workers <zsh-workers@sunsite.dk>
Subject: Re: Libtool/zsh quoting problem
Message-ID: <20060210113419.GA2750@DervishD>
Mail-Followup-To: Zsh-workers <zsh-workers@sunsite.dk>
References: <20060209233201.GA5875@fargo> <20060210084630.GA189@DervishD> <20060210094805.GA6357@fargo>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <20060210094805.GA6357@fargo>
User-Agent: Mutt/1.4.2.1i
Organization: DervishD
X-AntiAbuse: This header was added to track abuse, please include it with any abuse report
X-AntiAbuse: Primary Hostname - ns9.hostinglmi.net
X-AntiAbuse: Original Domain - sunsite.dk
X-AntiAbuse: Originator/Caller UID/GID - [0 0] / [47 12]
X-AntiAbuse: Sender Address Domain - dervishd.net
X-Source: 
X-Source-Args: 
X-Source-Dir: 

    Hi David :)

 * David <david@pleyades.net> dixit:
> On Feb 10 at 09:46:30, DervishD wrote:
> >     But the problem is a bit more subtle ;) Look at the "libtool"
> > invocation:
> 
> I know. Libtool is quoting positional parameters which has shell
> metacharacters in them. But it's no working because the string is
> already split in that point. I've been looking at the libtool
> script and i think the problem is in a 'for arg in' that it's
> failing with zsh in doing the right splitting.

    That's weird, because zsh doesn't split arguments at spaces in
arguments to the for loop, unless SH_WORDSPLIT is set.

    Anyway, not doing that splitting is the right thing to do if I
understand correctly the SUS standard :?

    Obviously, Bash doesn't do that splitting no matter if invoked as
/bin/sh or not. The problem is that libtool shouldn't be assuming
that the splitting is not done.
 
> > > Is there any option in zsh to avoid this problem?
> > 
> >     Not that I know of, because I think that SH_WORDSPLIT doesn't
> > apply here.
> 
> No, i've already tested that option.

    Please note that if you just did:

    setopt SH_WORDSPLIT
    make

    that won't work!. The option will be reset as soon as zsh is
invoked again as /bin/sh because it will be running in "sh" emulation
mode (so to say).

    You can try to set SH_WORDSPLIT in your RC files only when zsh is
invoked as /bin/sh, but anyway I think that the behaviour of libtool
is wrong regarding word splitting assumptions. Maybe a standard
expertise in this list can clarify that, but anyway in SUS you can
read that the list given to the "for" loop is expanded (chapter 2 of
"Shell & Utilities", tag 02_09_04_03). Expansion consists on
parameter expansion, command substitution, arithmetic expansion and
field splitting, so the list MUST be expanded on the value of IFS
unless quoted.

    I think that both bash and zsh doesn't do such splitting
internally, but zsh forces such splitting if SH_WORDSPLIT is set.

    Do you want me to take a look at libtool sources? If yes, which
version are you using?
 
    Raúl Núñez de Arenas Coronado

-- 
Linux Registered User 88736 | http://www.dervishd.net
http://www.pleyades.net & http://www.gotesdelluna.net
It's my PC and I'll cry if I want to... RAmen!

