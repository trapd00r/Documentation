From zsh-workers-return-10524-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Apr 05 19:24:06 2000
Return-Path: <zsh-workers-return-10524-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1023 invoked from network); 5 Apr 2000 19:24:01 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 5 Apr 2000 19:24:01 -0000
Received: (qmail 22886 invoked by alias); 5 Apr 2000 19:23:52 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10524
Received: (qmail 22778 invoked from network); 5 Apr 2000 19:23:36 -0000
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: PATCH: making distributions
Date: Wed, 05 Apr 2000 20:22:14 +0100
From: Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Message-Id: <E12cvOk-0000s7-00.2000-04-05-20-23-30@cmailg4.svr.pol.co.uk>

Given we're now going to be making distributions in the common sourceforge
directories, it's idiotic to try too hard to get mkdisttree.sh to be
optimal anywhere else.  This simply comments out the `ln's in favour of
`cp's to get round the permissions problem with linking to other people's
files.  It also chmods away the sticky groups on the directories.

--- Util/mkdisttree.sh.old	Wed Apr  5 20:03:08 2000
+++ Util/mkdisttree.sh	Wed Apr  5 20:03:18 2000
@@ -63,10 +63,10 @@
 	$sdir_top/mkinstalldirs $disttree/$subdir || exit 1
 	for f in $deplist `test -z "$globlist" || ( cd $dir_top/$subdir && eval "echo $globlist")`; do
 	    if test -f $dir_top/$subdir/$f; then
-		ln $dir_top/$subdir/$f $disttree/$subdir/$f || \
+#		ln $dir_top/$subdir/$f $disttree/$subdir/$f || \
 		    cp -p $dir_top/$subdir/$f $disttree/$subdir/$f || exit 1
 	    elif test -f $sdir_top/$subdir/$f; then
-		ln $sdir_top/$subdir/$f $disttree/$subdir/$f || \
+#		ln $sdir_top/$subdir/$f $disttree/$subdir/$f || \
 		    cp -p $sdir_top/$subdir/$f $disttree/$subdir/$f || exit 1
 	    else
 		echo >&2 "$0: can't find file $subdir/$f"
@@ -84,4 +84,4 @@
     exit $status
 fi
 
-exec chmod -R a+rX,u+w,go-w $disttree
+exec chmod -R a+rX,u+w,g-s,go-w $disttree

-- 
Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Work: pws@CambridgeSiliconRadio.com
Web: http://www.pwstephenson.fsnet.co.uk

