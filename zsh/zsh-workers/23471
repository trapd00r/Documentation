From zsh-workers-return-23471-mason-zsh=primenet.com.au@sunsite.dk Sat May 26 20:16:05 2007
Return-Path: <zsh-workers-return-23471-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4682 invoked from network); 26 May 2007 20:15:59 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.0 (2007-05-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=no
	version=3.2.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 26 May 2007 20:15:59 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 75246 invoked from network); 26 May 2007 20:15:53 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 26 May 2007 20:15:53 -0000
Received: (qmail 23257 invoked by alias); 26 May 2007 20:15:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23471
Received: (qmail 23247 invoked from network); 26 May 2007 20:15:49 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 26 May 2007 20:15:49 -0000
Received: (qmail 74950 invoked from network); 26 May 2007 20:15:49 -0000
Received: from mtaout01-winn.ispmail.ntl.com (81.103.221.47)
  by a.mx.sunsite.dk with SMTP; 26 May 2007 20:15:40 -0000
Received: from aamtaout02-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout01-winn.ispmail.ntl.com with ESMTP
          id <20070526201540.YOBR12936.mtaout01-winn.ispmail.ntl.com@aamtaout02-winn.ispmail.ntl.com>
          for <zsh-workers@sunsite.dk>; Sat, 26 May 2007 21:15:40 +0100
Received: from pws-pc.ntlworld.com ([81.107.45.67])
          by aamtaout02-winn.ispmail.ntl.com with ESMTP
          id <20070526201539.BTNS17393.aamtaout02-winn.ispmail.ntl.com@pws-pc.ntlworld.com>
          for <zsh-workers@sunsite.dk>; Sat, 26 May 2007 21:15:39 +0100
Received: from pws-pc.ntlworld.com (pws-pc.ntlworld.com [127.0.0.1])
	by pws-pc.ntlworld.com (8.13.8/8.13.8) with ESMTP id l4QKFGov028626
	for <zsh-workers@sunsite.dk>; Sat, 26 May 2007 21:15:17 +0100
Message-Id: <200705262015.l4QKFGov028626@pws-pc.ntlworld.com>
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: PATCH: System error names, again.
Date: Sat, 26 May 2007 21:15:16 +0100

The generation of names for system errors is broken on Linux again.
We restrict the list of files which may contain error
number definitions to the longest list yet found.  This means
asm-generic/errno-base.h doesn't get included.

I don't think that test is necessary, but have a careful look to see if
this is broken on any system (Src/Modules/errnames.c; you may have to
remove it to regenerate it).

Index: configure.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.ac,v
retrieving revision 1.62
diff -u -r1.62 configure.ac
--- configure.ac	1 May 2007 22:05:03 -0000	1.62
+++ configure.ac	26 May 2007 20:15:00 -0000
@@ -1325,7 +1325,6 @@
 $AWK '{ if ($1 ~ /err/) files[[$1]] = $1 }
   END { for (var in files) print var }'`"
 rm -f nametmp.c
-lnerrs=0
 for ERRNO_TRY_H in $errfile_list /dev/null
 do
   dnl Try to make sure it doesn't get confused by files that don't
@@ -1337,9 +1336,8 @@
   nerrs=`test -f $ERRNO_TRY_H && \
   $EGREP '#[ 	]*define[ 	][ 	]*E[0-9A-Z]*[ 	]*(_HURD_ERRNO )?\(?[_A-Z0-9]' $ERRNO_TRY_H | \
   wc -l | sed 's/[ 	]//g'`
-  if test "x$nerrs" != x && test "$nerrs" -ge 1 && test "$nerrs" -gt "$lnerrs"
+  if test "x$nerrs" != x && test "$nerrs" -ge 1
   then
-    lnerrs=$nerrs
     ERRNO_H="$ERRNO_H $ERRNO_TRY_H"
   fi
 done

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

