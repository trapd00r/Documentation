From zsh-workers-return-9684-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Feb 11 18:45:40 2000
Return-Path: <zsh-workers-return-9684-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15437 invoked from network); 11 Feb 2000 18:45:39 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 11 Feb 2000 18:45:39 -0000
Received: (qmail 10255 invoked by alias); 11 Feb 2000 18:45:34 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9684
Received: (qmail 10245 invoked from network); 11 Feb 2000 18:45:32 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000211184527.ZM32351@candle.brasslantern.com>
Date: Fri, 11 Feb 2000 18:45:26 +0000
In-Reply-To: <20000210195143.A26109@br-online.de>
Comments: In reply to Andy Spiegl <zsh.Andy@spiegl.de>
        "Re: completion but extra options allowed" (Feb 10,  7:51pm)
References: <20000210153411.A27005@fruitcom.com> 
	<1000210175857.ZM6927@candle.brasslantern.com> 
	<20000210195143.A26109@br-online.de>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: Re: completion but extra options allowed
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Feb 10,  7:51pm, Andy Spiegl wrote:
} Subject: Re: completion but extra options allowed
}
} > This means that you type "mutt -f +<TAB>" and zsh will complete files in
} > your $HOME/Mail directory following the + sign.  Mutt understands the + as
} > an abbreviation for the mail directory.  In the absence of a +, zsh just
} > completes file names after "mutt -f".
} This is exactly what I am trying to teach zsh-3.1.6.pws16 to do.

The follow only sort of accomplishes it.  I now get:

zagzig[166] mutt -f +z<TAB>
zagzig[166] mutt -f /home/schaefer/Mail/z<TAB>
/home/schaefer/Mail/zanshin           /home/schaefer/Mail/zsh-maintenance 
/home/schaefer/Mail/zsh
<BEEP>

That is, the first TAB replaces the + with the $maildirectory path, the
second TAB lists the completions.

There has to be a better way.

One thing that makes this difficult is that _path_files does not accept
the -i option of compadd, only the -P option.  However, even calling

compadd -i + -f -W ~/Mail

directly does not accomplish what I expected it to.  Is this a bug, or am
I missing something?  What IS the compadd equivalent of

compctl -x 's[+] c[-1,-f],s[-f+]' -W ~/Mail -f ...

Index: Completion/User/_mailboxes
===================================================================
@@ -38,5 +38,9 @@
   _mailbox_cache=($_mailbox_cache $mboxes $maildirboxes $MHboxes)
 fi
 
-_wanted files expl 'mailbox specification' &&
+if _wanted files expl 'mailbox specification'; then
+    local opre=$PREFIX
+    [[ $PREFIX = +* ]] && PREFIX="$~maildirectory/${PREFIX#+}"
     compadd "$@" "$expl[@]" - "$_mailbox_cache[@]"
+    PREFIX=$opre
+fi

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

