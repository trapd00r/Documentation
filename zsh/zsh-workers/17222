From zsh-workers-return-17222-mason-zsh=primenet.com.au@sunsite.dk Fri May 24 15:01:37 2002
Return-Path: <zsh-workers-return-17222-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5859 invoked from network); 24 May 2002 15:01:35 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 24 May 2002 15:01:35 -0000
Received: (qmail 17485 invoked by alias); 24 May 2002 15:01:20 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 17222
Received: (qmail 17474 invoked from network); 24 May 2002 15:01:19 -0000
From: Sven Wischnowsky <wischnow@berkom.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <15598.21936.357147.720741@wischnow.berkom.de>
Date: Fri, 24 May 2002 17:01:04 +0200
To: zsh-workers@sunsite.dk
Subject: RE: Menu-selection screen refresh slowness
In-Reply-To: <6134254DE87BD411908B00A0C99B044F02E89AF2@mowd019a.mow.siemens.ru>
References: <15597.65133.916597.845112@wischnow.berkom.de>
	<6134254DE87BD411908B00A0C99B044F02E89AF2@mowd019a.mow.siemens.ru>
X-Mailer: VM 6.95 under 21.5 (patch 3) "asparagus" XEmacs Lucid


Borsenkow Andrej wrote:

> > 
> > Here is the (almost) promised patch for this. It makes the menu
> > selection code try to only re-display the previously and the newly
> > highlighted matches. Andrej, are you still using a dtterm? If yes, is
> > it bettern now?
> > 
> 
> Looks like menu selection stopped to work properly now:
> 
> ls TAB
> bor@itsrm2% ls xaa
> Completing files
> xaa  xab  xac  xad  xae  xaf  xag
> ^^^ selection here
> 
> a-a-m-c
> 
> bor@itsrm2% ls xaa xab
> Completing files
> xaa  xab  xac  xad  xae  xaf  xag
> ^^^ selection still here

I just noted this myself, sorry. The code for some of the keys doesn't
set up the variables we need for the optimisation. We have to disable
the faster display code for them (for now, I'll have a look at what we
can do to improve the code). Unfortunately, we have to disable it even
for TAB.


Bye
  Sven

Index: Src/Zle/complist.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/complist.c,v
retrieving revision 1.47
diff -u -r1.47 complist.c
--- Src/Zle/complist.c	24 May 2002 08:50:12 -0000	1.47
+++ Src/Zle/complist.c	24 May 2002 14:57:28 -0000
@@ -1919,6 +1919,7 @@
 	    mselect = (*(minfo.cur))->gnum;
 	    setwish = wasnext = 1;
 	    mline = 0;
+            molbeg = -42;
 	    continue;
 	} else if (cmd == Th(z_acceptandhold) ||
 		   cmd == Th(z_acceptandmenucomplete)) {
@@ -1970,6 +1971,7 @@
 		break;
 	    }
 	    setwish = 1;
+            molbeg = -42;
 	    continue;
 	} else if (cmd == Th(z_undo)) {
 	    int l;
@@ -2012,11 +2014,14 @@
 	    clearlist = 1;
 	    setwish = 1;
 	    listdat.valid = 0;
+            molbeg = -42;
 	} else if (cmd == Th(z_redisplay)) {
 	    redisplay(zlenoargs);
+            molbeg = -42;
 	    continue;
 	} else if (cmd == Th(z_clearscreen)) {
 	    clearscreen(zlenoargs);
+            molbeg = -42;
 	    continue;
 	} else if (cmd == Th(z_downhistory) ||
 		   cmd == Th(z_downlineorhistory) ||
@@ -2322,6 +2327,7 @@
 	    mselect = (*(minfo.cur))->gnum;
 	    setwish = 1;
 	    mline = -1;
+            molbeg = -42;
 	    continue;
 	} else if (cmd == Th(z_reversemenucomplete) ||
 		   !strcmp(cmd->nam, "reverse-menu-complete")) {
@@ -2330,6 +2336,7 @@
 	    mselect = (*(minfo.cur))->gnum;
 	    setwish = 1;
 	    mline = -1;
+            molbeg = -42;
 	    continue;
 	} else if (cmd == Th(z_undefinedkey)) {
 	    continue;

-- 
Sven Wischnowsky                          wischnow@berkom.de

