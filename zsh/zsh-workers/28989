From zsh-workers-return-28989-mason-zsh=primenet.com.au@zsh.org Tue Apr 12 12:10:10 2011
Return-Path: <zsh-workers-return-28989-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23364 invoked by alias); 12 Apr 2011 12:10:10 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28989
Received: (qmail 29350 invoked from network); 12 Apr 2011 12:10:07 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at 0au.de does not designate permitted sender hosts)
Date: Tue, 12 Apr 2011 13:51:21 +0200
From: Valentin Ochs <a@0au.de>
To: zsh-workers@zsh.org
Subject: [PATCH] define _GNU_SOURCE for sigset_t test
Message-ID: <20110412115120.GE5881@erwin>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.21 (2010-09-15)

Hi,

the current configure script does not define _GNU_SOURCE when testing
for the presence of sigset_t. This breaks compatibility with musl
(http://www.etalabs.net/musl/). The attached patch fixes that.

Best regards,
Valentin

---
diff -upr zsh-4.3.11/configure.ac zsh/configure.ac
--- zsh-4.3.11/configure.ac     2010-09-23 11:42:05.000000000 +0200
+++ zsh/configure.ac    2011-04-12 13:13:30.942000061 +0200
@@ -983,7 +983,8 @@ dnl <sys/types.h> and <signal.h>.  Other
 dnl to be added.
 AC_CACHE_CHECK(for sigset_t, zsh_cv_type_sigset_t,
 [AC_TRY_COMPILE(
-[#include <sys/types.h>
+[#define _POSIX_C_SOURCE 200809L
+#include <sys/types.h>
 #include <signal.h>], [sigset_t tempsigset;],
   zsh_cv_type_sigset_t=yes, zsh_cv_type_sigset_t=no)])
 AH_TEMPLATE([sigset_t],

