From zsh-users-return-10897-mason-zsh=primenet.com.au@sunsite.dk Wed Oct 25 08:31:45 2006
Return-Path: <zsh-users-return-10897-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13254 invoked from network); 25 Oct 2006 08:31:43 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 Oct 2006 08:31:43 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 30249 invoked from network); 25 Oct 2006 08:31:32 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 25 Oct 2006 08:31:32 -0000
Received: (qmail 17773 invoked by alias); 25 Oct 2006 08:31:24 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10897
Received: (qmail 17763 invoked from network); 25 Oct 2006 08:31:24 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 25 Oct 2006 08:31:24 -0000
Received: (qmail 29050 invoked from network); 25 Oct 2006 08:31:23 -0000
Received: from berd.itl.waw.pl (193.110.137.5)
  by a.mx.sunsite.dk with SMTP; 25 Oct 2006 08:31:22 -0000
Received: by berd.itl.waw.pl (Postfix, from userid 33)
	id C998542A41; Wed, 25 Oct 2006 10:27:59 +0200 (CEST)
Received: from jawor.itl.waw.pl (jawor.itl.waw.pl [172.16.7.6])
	by berd.itl.waw.pl (Postfix) with ESMTP id 10CD9428B8
	for <zsh-users@sunsite.dk>; Wed, 25 Oct 2006 10:27:59 +0200 (CEST)
Received: (from wojtek@localhost)
	by jawor.itl.waw.pl (8.12.6/8.12.6) id k9P8VFNM029932
	for zsh-users@sunsite.dk; Wed, 25 Oct 2006 10:31:15 +0200 (CEST)
X-Authentication-Warning: jawor.itl.waw.pl: wojtek set sender to W.Pietron@itl.waw.pl using -f
Date: Wed, 25 Oct 2006 10:31:15 +0200
From: Wojciech Pietron <W.Pietron@itl.waw.pl>
To: zsh-users@sunsite.dk
Subject: Passing parameters between noninteractive shells
Message-ID: <20061025083114.GA29910@itl.waw.pl>
Mail-Followup-To: zsh-users@sunsite.dk
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-2
Content-Disposition: inline
User-Agent: Mutt/1.4.1i
X-Virus-Scanned: by amavisd-new at itl.waw.pl

Hello,

I have access to two version of zsh: /bin/zsh (v. 3.0.6) and $HOME/bin/zsh
(v.4.0.2). /bin/zsh is my login prompt and I am unable to change it.

So I have the following section at the beginning of
my .zshenv:

===============.zshrc================
if [[ $ZSH_VERSION == 3.<->* ]]; then
     if [[ -x $HOME/bin/zsh && -o interactive ]]; then
        exec $HOME/bin/zsh
     else 
       if [[ -x $HOME/bin/zsh && ! -o interactive ]]; then
         exec $HOME/bin/zsh +o interactive
       fi
     fi
fi
#
# A lot of specific ZSH 4.0.2 commands:
# [...] 
===============.zshrc================

With a such a solution switching between v3.0.6 and 4.0.2 passes with no
problem in the interactive sessions.  

The problem is with non-interactive sessions such as remote scp or cvs. This
configuration makes such sessions hang because a new zsh is run and it does not
know what it should do until I send 'exit' command. This is because the
new shell is not given any parameters that had been passed to the
previous instance of the shell - I believe so.

Is there any way to pass parameters of non-interactive sessions to new
instance of zsh? I would also appreciate another workarounds of that
problem. Making the whole .zshrc compatible with 3.0.6 is out of the
question.

Thank you in advance
Wojciech Pietron

