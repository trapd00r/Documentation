From pbray@ind.tansu.com.au Wed May 15 12:32:35 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3) with ESMTP id MAA11083 for <mason@werple.mira.net.au>; Wed, 15 May 1996 12:32:32 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id WAA28683; Tue, 14 May 1996 22:17:56 -0400 (EDT)
Resent-Date: Tue, 14 May 1996 22:17:56 -0400 (EDT)
From: Peter Bray <pbray@ind.tansu.com.au>
Message-Id: <199605150215.MAA11431@cod.ind.tansu.com.au>
Subject: zsh-2.6-beta17 : compiling on SCO - results
To: zsh-workers@math.gatech.edu
Date: Wed, 15 May 1996 12:15:43 +1000 (EST)
Cc: pbray@ind.tansu.com.au (Peter Bray)
X-Mailer: ELM [version 2.4 PL24]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"5ii8O1.0.507.KxJcn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1073
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 5537
Status: OR


Note : Not list member (zsh-workers)

Greetings,

	I have grabbed beta17 and compiled it on

		SunOS 4.1.3_U1
		Solaris 2.4
		Solaris 2.5
		SCO 3.2v4.2 (Pentium/EISA/1 CPU)

	with ./configure --prefix=/opt/utils using gcc 2.7.2

	The Sun based platforms as expected compile without problem,
but as is usual SCO is another matter.

zsh configuration
-----------------
zsh version           : 2.6-beta17
host operating system : sco3.2v4.2
source code location  : .
compiler              : gcc
compiler flags        : -D__sco  -Wall -Wno-implicit -Wmissing-prototypes -O2
binary install path   : /opt/utils/bin
man page install path : /opt/utils/man
info install path     : /opt/utils/info

Unfortunately this gives the following when compiling

        gcc -c -I.. -I. -I.  -DHAVE_CONFIG_H -D__sco  -Wall -Wno-implicit -Wmissing-prototypes -O2 builtin.c
In file included from zsh.h:35,
                 from builtin.c:32:
system.h:114: redefinition of `struct timezone'
In file included from system.h:219,
                 from zsh.h:35,
                 from builtin.c:32:
/usr/include/sys/select.h:41: redefinition of `struct timeval'
builtin.c: In function `bin_kill':
builtin.c:663: warning: left-hand operand of comma expression has no effect
builtin.c: In function `bin_pwd':
builtin.c:872: warning: left-hand operand of comma expression has no effect
builtin.c: In function `bin_dirs':
builtin.c:897: warning: left-hand operand of comma expression has no effect
builtin.c: In function `cd_new_pwd':
builtin.c:1242: warning: left-hand operand of comma expression has no effect
builtin.c: In function `printdirstack':
builtin.c:1271: warning: left-hand operand of comma expression has no effect
builtin.c:1274: warning: left-hand operand of comma expression has no effect
builtin.c: In function `printcompctl':
builtin.c:2212: warning: left-hand operand of comma expression has no effect
builtin.c:2215: warning: left-hand operand of comma expression has no effect
builtin.c:2255: warning: left-hand operand of comma expression has no effect
builtin.c:2259: warning: left-hand operand of comma expression has no effect
builtin.c:2272: warning: left-hand operand of comma expression has no effect
builtin.c:2279: warning: left-hand operand of comma expression has no effect
builtin.c:2282: warning: left-hand operand of comma expression has no effect
builtin.c:2287: warning: left-hand operand of comma expression has no effect
builtin.c:2308: warning: left-hand operand of comma expression has no effect
builtin.c:2311: warning: left-hand operand of comma expression has no effect
builtin.c: In function `printqt':
builtin.c:2336: warning: left-hand operand of comma expression has no effect
builtin.c: In function `fclist':
builtin.c:2631: warning: left-hand operand of comma expression has no effect
builtin.c: In function `bin_times':
builtin.c:5222: warning: left-hand operand of comma expression has no effect
builtin.c:5224: warning: left-hand operand of comma expression has no effect
builtin.c:5226: warning: left-hand operand of comma expression has no effect
builtin.c:5228: warning: left-hand operand of comma expression has no effect
builtin.c: In function `printquoted':
builtin.c:5531: warning: left-hand operand of comma expression has no effect
builtin.c:5534: warning: left-hand operand of comma expression has no effect
builtin.c:5536: warning: left-hand operand of comma expression has no effect
builtin.c:5537: warning: left-hand operand of comma expression has no effect
builtin.c:5539: warning: left-hand operand of comma expression has no effect
builtin.c:5545: warning: left-hand operand of comma expression has no effect
builtin.c:5548: warning: left-hand operand of comma expression has no effect
builtin.c:5549: warning: left-hand operand of comma expression has no effect
builtin.c:5552: warning: left-hand operand of comma expression has no effect
builtin.c:5556: warning: left-hand operand of comma expression has no effect
builtin.c:5557: warning: left-hand operand of comma expression has no effect
builtin.c:5561: warning: left-hand operand of comma expression has no effect
*** Error code 1
 
Stop.
*** Error code 1
 
Stop.


Now am not going to say that I know the cause of the problems, but the 
fix which seemed to work for me is the following

In Src/Makefile change :

CFLAGS   = -D__sco  -Wall -Wno-implicit -Wmissing-prototypes -O2

to

CFLAGS   = -D__sco -O2

this seems to get rid of the 
 warning: left-hand operand of comma expression has no effect

and in Src/system.h to comment out the following sections :

/* PDB Modification for SCO
#ifdef __sco
struct timezone {
    short minutes;
};
#endif
*/

/* PDB Modification for SCO
#ifdef HAVE_SYS_SELECT_H
# include <sys/select.h>
#endif
*/

It would seem that sys/select.h redefines timeval and that timezone is
already defined. I think that some a little more fundamental may be wrong
(ie the configure on SCO) but I thought I share these experiences to
hopely leave someone who knows what they are doing to investiage the real
problems.

Remember this is SCO 3.2v4.2

Regards,
Peter
------------------------------------------------------------------------------
Peter Bray: Intelligent Network Development           Phone : (02) 395 3958
            Network Technology Group - Telstra        Fax   : (02) 395 3225
Street    : Lvl 9, Telecom Plaza, 320 Pitt St, Sydney Email : 
Mail      : Locked Bag 6581, GPO Sydney, NSW, 1100     pbray@ind.tansu.com.au
------------------------------------------------------------------------------


