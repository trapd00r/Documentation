From zsh-workers-return-28361-mason-zsh=primenet.com.au@zsh.org Sat Oct 23 13:10:14 2010
Return-Path: <zsh-workers-return-28361-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11782 invoked by alias); 23 Oct 2010 13:10:14 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28361
Received: (qmail 16591 invoked from network); 23 Oct 2010 13:10:11 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,RCVD_IN_DNSWL_NONE autolearn=ham version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.161.43 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:sender:received:date
         :x-google-sender-auth:message-id:subject:from:to:content-type;
        bh=fkVOIAOxWOY+AEG5WN8k2nq2UNWJSOE3dwqXfSQ3Tpk=;
        b=rpkHprJvh8Q/4aZrb1kCEvFFIMEbLwCA0rb4iTXKpwDtkuwBB0Wc09YoMUTV1NgfHU
         28ZNtR0IT0wJBjIx8Y1hp0uc8Dc5ZRJfXDuwmGbeb8H93YJWHa4WtdqjHjEcIIdpNc4F
         Ct9dZp5UhVz+K//bPYgV4jhXOH4wcxVTNetiQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:date:x-google-sender-auth:message-id:subject
         :from:to:content-type;
        b=MH0gOHJtY2OpVSulX7rCVyasSEtfhykXcUNWCztdNn8r89DX0kQo4OqtnN3ddEK8h8
         VNbtajXNtiUm3zAsYBOh87kd2fvS3mDPibdLXH8FasKeQtLbY6j7/ppGY1Bq33uo5Jjm
         53oBTFxW7XSQaHL1AGJ7iSlhA06tgbSayl7XQ=
MIME-Version: 1.0
Sender: ethersoft@gmail.com
Date: Sat, 23 Oct 2010 09:04:00 -0400
X-Google-Sender-Auth: SfLl5VACKFKbK57_iq4bJeEZYcc
Message-ID: <AANLkTikfte4uDyDsVwp6_cP11C708JgdPQ+Oa1jDmtk8@mail.gmail.com>
Subject: Y01 Test Failure on cygwin-1.7
From: Vin Shelton <acs@alumni.princeton.edu>
To: zsh-workers@zsh.org
Content-Type: text/plain; charset=ISO-8859-1

Greetings -

When building the latest sources under the latest cygwin 1.7.7, the
test Y01 hangs.  A detailed traceback is below.

FYI, I uncommented the configure test that inhibits DEV_FD checking
under cygwin before getting here, but that doesn't make a difference
to this test.

ZTST_verbose=3 TESTNUM=Y01 make check  ==>

cd Test ; make check
make[1]: Entering directory `/usr/local/build/zsh-2010-10-23/Test'
if test -n "gcc"; then \
          cd .. && DESTDIR= \
          make MODDIR=`pwd`/Test/Modules install.modules > /dev/null; \
        fi
if ZTST_testlist="`for f in /usr/local/src/zsh-2010-10-23/Test/Y01*.ztst; \
           do echo $f; done`" \
         ZTST_srcdir="/usr/local/src/zsh-2010-10-23/Test" \
         ZTST_exe=../Src/zsh.exe \
         ../Src/zsh.exe +Z -f
/usr/local/src/zsh-2010-10-23/Test/runtests.zsh; then \
         stat=0; \
        else \
         stat=1; \
        fi; \
        sleep 1; \
        rm -rf Modules .zcompdump; \
        exit $stat
/usr/local/src/zsh-2010-10-23/Test/Y01completion.ztst: starting.
ZTST_getsect: read section name: prep
ZTST_getchunk: read code chunk:
  if ( zmodload -i zsh/zpty ) >/dev/null 2>&1; then
    . $ZTST_srcdir/comptest
    mkdir comp.tmp
    cd comp.tmp
    comptestinit -z $ZTST_testdir/../Src/zsh &&
    {
      mkdir dir1 &&
      mkdir dir2 &&
      touch file1 &&
      touch file2
    }
  else
    ZTST_unimplemented="the zsh/zpty module is not available"
  fi
ZTST_execchunk: status 0
ZTST_getchunk: read code chunk:

ZTST_getsect: read section name: test
ZTST_test: looking for new test
ZTST_test: examining line:

ZTST_test: examining line:
  comptest $': \t\t\t\t\t\t\t'
ZTST_getchunk: read code chunk:
  comptest $': \t\t\t\t\t\t\t'
ZTST_test: examining line:
>line: {: }{}
ZTST_getredir: read redir for '>':
line: {: }{}
DESCRIPTION:{file}
DI:{dir1}
DI:{dir2}
FI:{file1}
FI:{file2}
line: {: dir1/}{}
line: {: dir2/}{}
line: {: file1}{}
line: {: file2}{}
line: {: dir1/}{}
line: {: dir2/}{}
ZTST_test: examining line:

Running test: directories and files
ZTST_test: expecting status: 0
Input: /tmp/zsh.ztst.in.3620, output: /tmp/zsh.ztst.out.3620, error:
/tmp/zsh.ztst.terr.3620
ZTST_execchunk: status 0
ZTST_test: test produced standard output:
line: {: }{}
DESCRIPTION:{file}
DI:{dir1}
DI:{dir2}
FI:{file1}
FI:{file2}
line: {: dir1/}{}
line: {: dir2/}{}
line: {: file1}{}
line: {: file2}{}
line: {: dir1/}{}
line: {: dir2/}{}
ZTST_test: and standard error:

Test successful.
ZTST_test: looking for new test
ZTST_test: examining line:

ZTST_test: examining line:
  comptesteval '_users () { compadd user1 user2 }'
ZTST_getchunk: read code chunk:
  comptesteval '_users () { compadd user1 user2 }'
  comptest $': ~\t\t\t\t\t'
ZTST_test: examining line:
>line: {: ~user}{}
ZTST_getredir: read redir for '>':
line: {: ~user}{}
line: {: ~user}{}
NO:{user1}
NO:{user2}
line: {: ~user1}{}
line: {: ~user2}{}
line: {: ~user1}{}
ZTST_test: examining line:

Running test: tilde
ZTST_test: expecting status: 0
Input: /tmp/zsh.ztst.in.3620, output: /tmp/zsh.ztst.out.3620, error:
/tmp/zsh.ztst.terr.3620
ZTST_execchunk: status 0
ZTST_test: test produced standard output:
line: {: ~user}{}
line: {: ~user}{}
NO:{user1}
NO:{user2}
line: {: ~user1}{}
line: {: ~user2}{}
line: {: ~user1}{}
ZTST_test: and standard error:

Test successful.
ZTST_test: looking for new test
ZTST_test: examining line:

ZTST_test: examining line:
  comptest $'echo ;:\C-b\C-b\t'
ZTST_getchunk: read code chunk:
  comptest $'echo ;:\C-b\C-b\t'
ZTST_test: examining line:
>line: {echo }{;:}
ZTST_getredir: read redir for '>':
line: {echo }{;:}
DESCRIPTION:{file}
DI:{dir1}
DI:{dir2}
FI:{file1}
FI:{file2}
ZTST_test: examining line:

Running test: tilde
ZTST_test: expecting status: 0
Input: /tmp/zsh.ztst.in.3620, output: /tmp/zsh.ztst.out.3620, error:
/tmp/zsh.ztst.terr.3620
ZTST_execchunk: status 0
ZTST_test: test produced standard output:
line: {echo }{;:}
DESCRIPTION:{file}
DI:{dir1}
DI:{dir2}
FI:{file1}
FI:{file2}
ZTST_test: and standard error:

Test successful.
ZTST_test: looking for new test
ZTST_test: examining line:

ZTST_test: examining line:
%clean
ZTST_test: all tests successful
ZTST_getsect: read section name: clean
ZTST_getchunk: read code chunk:
  zmodload -ui zsh/zpty


Also FYI, unloading the modules in test V01 fails before getting here.
 This seems like it could be a DLL rebasing problem.

Running test: Unload the modules loaded by this test suite
ZTST_test: expecting status: 0
Input: /tmp/zsh.ztst.in.3332, output: /tmp/zsh.ztst.out.3332, error:
/tmp/zsh.ztst.terr.3332
ZTST_execchunk: status 1
Test /usr/local/src/zsh-2010-10-23/Test/V01zmodload.ztst failed: bad
status 1, expected 0 from:
 mods[(r)zsh/main]=()
 zmodunload $mods
 zmodload zsh/parameter
Error output:
      7 [main] zsh 1948
C:\cygwin\usr\local\build\zsh-2010-10-23\Src\zsh.exe: *** fatal error
- unable to remap
\\?\C:\cygwin\usr\local\build\zsh-2010-10-23\Test\Modules\zsh\zselect.dll
to same address as parent: 0x18CA0000 != 0x6E900000
Stack trace:
Frame     Function  Args
002284A8  6102749B  (002284A8, 00000000, 00000000, 00000000)
00228798  6102749B  (61177B80, 00008000, 00000000, 61179977)
002297C8  61004AFB  (611A136C, 61242C5C, 18CA0000, 6E900000)
End of stack trace
      3 [main] zsh 3332 fork: child 1948 - died waiting for dll
loading, errno 11
zmodunload:5: fork failed: resource temporarily unavailable
Was testing: Unload the modules loaded by this test suite
/usr/local/src/zsh-2010-10-23/Test/V01zmodload.ztst: test failed.
ZTST_getsect: read section name: clean
ZTST_getchunk: read code chunk:
 eval "$deps"
 unset deps name modfile link auto load funcs mods moddeps
 unfunction zmodunload
ZTST_execchunk: status 0
ZTST_getchunk: read code chunk:

  55179 [main] zsh 3104
C:\cygwin\usr\local\build\zsh-2010-10-23\Src\zsh.exe: *** fatal error
- unable to remap
\\?\C:\cygwin\usr\local\build\zsh-2010-10-23\Test\Modules\zsh\zselect.dll
to same address as parent: 0x18CA0000 != 0x6E900000
Stack trace:
Frame     Function  Args
0022AE08  6102749B  (0022AE08, 00000000, 00000000, 00000000)
0022B0F8  6102749B  (61177B80, 00008000, 00000000, 61179977)
0022C128  61004AFB  (611A136C, 61242C5C, 18CA0000, 6E900000)
End of stack trace
  57599 [main] zsh 3332 fork: child 3104 - died waiting for dll
loading, errno 11
ZTST_cleanup:2: fork failed: resource temporarily unavailable
**************************************
0 successful test scripts, 1 failure, 0 skipped
**************************************


Please let me know if you need more information.

  - Vin

