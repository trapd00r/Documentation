From zsh-workers-return-6601-mason-zsh=primenet.com.au@sunsite.auc.dk Sat Jun 12 15:25:58 1999
Return-Path: <zsh-workers-return-6601-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2758 invoked from network); 12 Jun 1999 15:25:57 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 12 Jun 1999 15:25:57 -0000
Received: (qmail 28716 invoked by alias); 12 Jun 1999 15:25:45 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6601
Received: (qmail 28709 invoked from network); 12 Jun 1999 15:25:45 -0000
Message-Id: <9906121457.AA38928@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: PATCH: pws-21: make distclean
Date: Sat, 12 Jun 1999 16:57:11 +0200
From: Peter Stephenson <pws@ibmth.df.unipi.it>

This removes the dependency on Makemod when making distclean.  This has two
effects: first, don't remake it if it's older just to delete things (the
desired effect); second, don't actually remake it at all, so if it's been
delete the module bits of zsh don't get deleted.  This seems to fit in with
the fact that there is no dependency on any other Makefiles, so I suppose
this is right.  It would be a little more like the current behaviour if it
made Makemod when it didn't exist at all, but my attitude is `stuff that'.

--- Src/Makefile.in.dc	Mon May 24 17:08:34 1999
+++ Src/Makefile.in	Sat Jun 12 16:55:31 1999
@@ -205,8 +205,12 @@
 distclean: distclean-modules
 realclean: realclean-modules
 
-mostlyclean-modules clean-modules distclean-modules realclean-modules: Makemod
-	@$(MAKE) -f Makemod $(MAKEDEFS) `echo $@ | sed 's/-modules//'`
+# Don't remake Makemod just to delete things, even if it doesn't exist.
+mostlyclean-modules clean-modules distclean-modules realclean-modules:
+	if test -f Makemod; then \
+	  @$(MAKE) -f Makemod $(MAKEDEFS) `echo $@ | sed 's/-modules//'`; \
+	fi; \
+	exit 0
 
 @CLEAN_MK@
 

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

