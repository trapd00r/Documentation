From zsh-workers-return-28970-mason-zsh=primenet.com.au@zsh.org Fri Apr 01 22:12:02 2011
Return-Path: <zsh-workers-return-28970-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21210 invoked by alias); 1 Apr 2011 22:12:02 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28970
Received: (qmail 4244 invoked from network); 1 Apr 2011 22:12:00 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-4.2 required=5.0 tests=BAYES_00,MIME_QP_LONG_LINE,
	RCVD_IN_DNSWL_MED autolearn=ham version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at spf.postini.com designates 64.18.3.32 as permitted sender)
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset=utf-8
Content-Transfer-Encoding: quoted-printable
Subject: RE: zsh hangs sometimes continued.
Date: Fri, 1 Apr 2011 23:33:06 +0200
Message-ID: <1B2B2EF98D55CB41BD16F13B18B9B0080EA2086B@FFBRUE001.cfmu.corp.eurocontrol.int>
In-Reply-To: <110401071802.ZM3412@torch.brasslantern.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: zsh hangs sometimes continued.
Thread-Index: Acvwd+NjEzJ4AxCoRJCa63AZPZvDEwAJbnOw
References: <1301593035.6016.ezmlm@zsh.org><1B2B2EF98D55CB41BD16F13B18B9B0080EA2084C@FFBRUE001.cfmu.corp.eurocontrol.int><20110401102846.482a9165@pwslap01u.europe.root.pri> <110401071802.ZM3412@torch.brasslantern.com>
From: "VAN VLIERBERGHE Stef" <stef.van-vlierberghe@eurocontrol.int>
To: "Bart Schaefer" <schaefer@brasslantern.com>, <zsh-workers@zsh.org>
X-OriginalArrivalTime: 01 Apr 2011 21:33:07.0593 (UTC) FILETIME=[64316790:01CBF0B4]

Thanks for fixing, Peter.

Bart, the kernel will not re-use a pid until the parent process collects
the
state change by a wait system call (zsh uses wait4()) so it is
impossible for
a process with the same pid to exist when the wait returns. As long as
the 
parent process (usually inside the zhandler catching the SIGCHLD)
updates the
job table and pid state before the process forks a new child there is no
additional problem I believe. A new process with the same pid could
appear before
the job table update is complete, but it won't be a child of this same
parent
process.

-----Original Message-----
From: Bart Schaefer [mailto:schaefer@brasslantern.com] 
Sent: Friday 1 April 2011 16:18
To: zsh-workers@zsh.org
Subject: Re: zsh hangs sometimes continued.

On Apr 1, 10:28am, Peter Stephenson wrote:
} Subject: Re: zsh hangs sometimes continued.
}
} On Thu, 31 Mar 2011 20:32:58 +0200
} VAN VLIERBERGHE Stef <stef.van-vlierberghe@eurocontrol.int> wrote:
} > After adding more and more debug info to the zsh-4.3.10 sources I
} > figured out that the problem is in the findjob returning the pid of
} > a terminated process.
} 
} Thanks for the investigation and the explanation.  I agree the uses of
} findproc() all appear to assume the process is still marked 
as running,
} since they are all about to update it.  Here's the patch I'll apply.

Reading the explanation left me wondering whether there's an additional
problem in the event that the shell is spawning processes fast enough
for the PID of a terminated-but-not-yet-reaped job to have been re-used
in a new still-running job?

____
=C2=A0
This message and any files transmitted with it are legally privileged and in=
tended for the sole use of the individual(s) or entity to whom they are addr=
essed. If you are not the intended recipient, please notify the sender by re=
ply and delete the message and any attachments from your system. Any unautho=
rised use or disclosure of the content of this message is strictly prohibite=
d and may be unlawful.
=C2=A0
Nothing in this e-mail message amounts to a contractual or legal commitment =
on the part of EUROCONTROL, unless it is confirmed by appropriately signed h=
ard copy.
=C2=A0
Any views expressed in this message are those of the sender.

