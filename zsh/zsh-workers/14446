From zsh-workers-return-14446-mason-zsh=primenet.com.au@sunsite.dk Wed May 23 03:04:40 2001
Return-Path: <zsh-workers-return-14446-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18487 invoked from network); 23 May 2001 03:04:40 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 23 May 2001 03:04:40 -0000
Received: (qmail 28444 invoked by alias); 23 May 2001 03:04:32 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14446
Received: (qmail 28415 invoked from network); 23 May 2001 03:04:30 -0000
Date: Tue, 22 May 2001 20:04:26 -0700
From: Paul Ackersviller <paulda@alumni.uwo.ca>
Subject: Re: vi editting troubles
To: Peter Stephenson <pws@csr.com>,
 Bart Schaefer <schaefer@candle.brasslantern.com>
Cc: zsh-workers@sunsite.dk
Message-id: <20010522200425.A9730@flora01.SLAC.Stanford.EDU>
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii
Content-disposition: inline
Content-transfer-encoding: 7BIT
User-Agent: Mutt/1.2.5i

Bart Schaefer wrote:
> > } > Does a command such as `echo =(echo foo)' work?  That should use the same
> > } > temp file mechanism as fc.
> > } 
> > } % echo =(echo foo)
> > } Segmentation fault (core dumped)
> > 
> > Looks like you've got some sort of serious memory allocation problem
> > going on -- probably some kind of word-alignment issue -- with the heap
> > allocation code.  You're going to have to give us details of your OS and
> > build environment.  Did you configure with --enable-zsh-mem?

No, I didn't configure with --enable-zsh-mem, but it turns out not to make a
difference.  What does make a difference is simply generating default 32-bit
sparc instructions.  I'd negelected to mention that I was using Sun's
compiler and 64-bit code.  I suppose it's fair to blame this one on Sun.

Peter Stephenson wrote:
> > Another strange thing I notice when I turn on shell tracing is that my
> > TRAPZERR function runs in the middle of _history_complete_word -- is
> > there something I should be doing to avoid this?
> 
> Oh, yuk.  We really need some way of getting the effect of `setopt
> localtraps; unfunction TRAPZERR' in all completion functions.  I suppose
> that means adding it everywhere we already have `setopt localoptions'
> or `emulate -L zsh' (the latter already sets localtraps).  If anybody sees
> this as their mission in life...

Are you saying this is still a potential problem in a general sense?

If it helps to know, _history_complete_word no longer shows me any
errors and this behaviour goes away with Bart's suggestion of moving
`bindkey -v' after `compinit'.  You could document this as a bug, but
how can you ensure people always use this ordering?

-- 
Paul Ackersviller

