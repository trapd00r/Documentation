From zsh-workers-return-12955-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Oct 11 07:45:12 2000
Return-Path: <zsh-workers-return-12955-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26580 invoked from network); 11 Oct 2000 07:45:11 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 11 Oct 2000 07:45:11 -0000
Received: (qmail 25084 invoked by alias); 11 Oct 2000 07:44:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12955
Received: (qmail 25077 invoked from network); 11 Oct 2000 07:44:39 -0000
Date: Wed, 11 Oct 2000 09:44:37 +0200 (MET DST)
Message-Id: <200010110744.JAA26012@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
Subject: completion widgets in menu selection


[The last uncommitted patch.]

As promised, here is the patch that makes completion widgets that are
not directly handled by the menu selection code leave menu selection
without accepting the match currently selected.

Together with the _all_matches stuff, this allows one to use a
key-binding that inserts all matches from within menu selection
without having to fiddle with key bindings.

The more I think about this, the more sense does it seem to make,
especially because this allows everything that was possible before
plus some.

Bye
 Sven

diff -u -r ../oz/Src/Zle/complist.c ./Src/Zle/complist.c
--- ../oz/Src/Zle/complist.c	Tue Oct 10 21:38:58 2000
+++ ./Src/Zle/complist.c	Tue Oct 10 21:55:20 2000
@@ -2237,7 +2237,11 @@
 	    continue;
 	} else {
 	    ungetkeycmd();
-	    acc = 1;
+	    if (cmd->widget && (cmd->widget->flags & WIDGET_NCOMP)) {
+		acc = 0;
+		broken = 1;
+	    } else
+		acc = 1;
 	    break;
 	}
 	do_single(**p);
@@ -2260,6 +2264,7 @@
 	menucmp = 2;
 	showinglist = -2;
 	minfo.asked = 0;
+	zrefresh();
     }
     if (!noselect && (!dat || acc)) {
 	showinglist = -2;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

