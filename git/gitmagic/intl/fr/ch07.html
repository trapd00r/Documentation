<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux (vers 25 March 2009), see www.w3.org">
  <meta http-equiv="Content-Type" content=
  "text/html; charset=utf-8">

  <title>Git Magic - Chapitre&nbsp;7.&nbsp;La maîtrise de Git</title>
  <link rel="stylesheet" href="default.css" type="text/css">
  <meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
  <link rel="home" href="index.html" title="Git Magique">
  <link rel="up" href="index.html" title="Git Magique">
  <link rel="prev" href="ch06.html" title=
  "Chapitre&nbsp;6.&nbsp;Git multijoueur">
  <link rel="next" href="ch08.html" title=
  "Chapitre&nbsp;8.&nbsp;Les secrets révélés">
</head>

<body bgcolor="white" text="black" link="#0000FF" vlink="#840084"
alink="#0000FF">
    <div class="toc">
      <ul>
<li><b>Git Magic</b></li>
        <li>
          <span class="preface"><a href=
          "index.html">Préface</a></span>

          <ul>
            <li><span class="section"><a href=
            "index.html#_merci">Merci&nbsp;!</a></span></li>

            <li><span class="section"><a href=
            "index.html#_licence">Licence</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch01.html">1.
          Introduction</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch01.html#_le_travail_comme_un_jeu">Le travail comme
            un jeu</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_gestion_de_versions">Gestion de
            versions</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_gestion_distribu%C3%A9e">Gestion
            distribuée</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_une_superstition_idiote">Une superstition
            idiote</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_conflits_fusionnels">Conflits
            fusionnels</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch02.html">2. Astuces de
          base</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch02.html#_enregistrer_l_%C3%A9tat_courant">Enregistrer
            l'état courant</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_ajouter_supprimer_renommer">Ajouter,
            supprimer, renommer</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_annuler_reprendre_avanc%C3%A9">Annuler/Reprendre
            avancé</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_reprise_revert">Reprise
            (revert)</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_g%C3%A9n%C3%A9ration_du_journal_des_modifications_changelog">
            Génération du journal des modifications
            (changelog)</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_t%C3%A9l%C3%A9charger_des_fichiers">Télécharger
            des fichiers</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_le_dernier_cri">Le dernier
            cri</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_publication_instantan%C3%A9e">Publication
            instantanée</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_qu_8217_ai_je_fait">Qu’ai-je
            fait&nbsp;?</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_exercice">Exercice</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch03.html">3. Clonons
          gaiement</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch03.html#_synchronisation_entre_machines">Synchronisation
            entre machines</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_gestion_classique_des_sources">Gestion
            classique des sources</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_d%C3%A9p%C3%B4ts_nus">Dépôts
            nus</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_envoi_vs_rapatriement_push_vs_pull">Envoi
            vs rapatriement (push vs pull)</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_forker_un_projet">Forker un
            projet</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_syst%C3%A8me_ultime_de_sauvegarde">Système
            ultime de sauvegarde</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_le_multi_t%C3%A2che_%C3%A0_la_vitesse_de_la_lumi%C3%A8re">
            Le multi-tâche à la vitesse de la
            lumière</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_gu%C3%A9rilla_de_la_gestion_de_versions">Guérilla
            de la gestion de versions</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_mercurial">Mercurial</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_bazaar">Bazaar</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_pourquoi_j_8217_utilise_git">Pourquoi
            j’utilise Git</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch04.html">4. La
          sorcellerie des branches</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch04.html#_la_touche_du_chef">La touche du
            chef</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_travail_temporaire">Travail
            temporaire</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_corrections_rapides">Corrections
            rapides</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_fusionner">Fusionner</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_workflow_sans_interruption">Workflow sans
            interruption</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_r%C3%A9organiser_le_foutoir">Réorganiser le
            foutoir</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_gestion_des_branches">Gestion des
            branches</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_les_branches_temporaires">Les branches
            temporaires</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_travailler_comme_il_vous_chante">Travailler
            comme il vous chante</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch05.html">5. Les leçons
          de l’histoire</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch05.html#_je_me_corrige_8230">Je me
            corrige…</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_8230_et_bien_plus">… et bien
            plus</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_les_changements_locaux_en_dernier">Les
            changements locaux en dernier</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_r%C3%A9%C3%A9criture_de_l_8217_histoire">Réécriture
            de l’histoire</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_faire_l_8217_histoire">Faire
            l’histoire</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_qu_8217_est_ce_qui_a_tout_cass%C3%A9">Qu’est-ce
            qui a tout cassé&nbsp;?</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_qui_a_tout_cass%C3%A9">Qui a tout
            cassé&nbsp;?</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_exp%C3%A9rience_personnelle">Expérience
            personnelle</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch06.html">6. Git
          multijoueur</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch06.html#_qui_suis_je">Qui
            suis-je&nbsp;?</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_git_via_ssh_et_http">Git via SSH et
            HTTP</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_git_via_n_8217_importe_quoi">Git via
            n’importe quoi</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_les_patches_la_monnaie_d_%C3%A9change_globale">
            Les patches&nbsp;: la monnaie d'échange
            globale</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_le_num%C3%A9ro_de_votre_correspondant_a_chang%C3%A9">
            Le numéro de votre correspondant a
            changé</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_les_branches_distantes">Les branches
            distantes</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_d%C3%A9p%C3%B4ts_distants_multiples">Dépôts
            distants multiples</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_mes_pr%C3%A9f%C3%A9rences">Mes
            préférences</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch07.html">7. La maîtrise
          de Git</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch07.html#_publication_de_sources">Publication de
            sources</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_g%C3%A9rer_le_changement">Gérer le
            changement</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_mon_commit_est_trop_gros">Mon commit est
            trop gros&nbsp;!</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_l_8217_index_l_8217_aire_d_8217_assemblage">
            L’index&nbsp;: l’aire d’assemblage</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_ne_perdez_pas_la_t%C3%AAte">Ne perdez pas
            la tête</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_chasseur_de_t%C3%AAte">Chasseur de
            tête</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_construire_au_dessus_de_git">Construire
            au-dessus de Git</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_audacieuses_acrobaties">Audacieuses
            acrobaties</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_se_pr%C3%A9munir_des_commits_erron%C3%A9s">Se
            prémunir des commits erronés</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch08.html">8. Les secrets
          révélés</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch08.html#_l_8217_invisibilit%C3%A9">L’invisibilité</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_l_8217_int%C3%A9grit%C3%A9">L’intégrité</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_l_8217_intelligence">L’intelligence</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_l_8217_indexation">L’indexation</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_les_origines_de_git">Les origines de
            Git</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_la_base_d_8217_objets">La base
            d’objets</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_les_blobs">Les blobs</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_les_arbres_literal_trees_literal">Les
            arbres (<code class=
            "literal">trees</code>)</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_les_commits">Les commits</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_indiscernable_de_la_magie">Indiscernable de
            la magie</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch09.html">9. Appendix A:
          Les lacunes de Git</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch09.html#_les_faiblesses_de_sha1">Les faiblesses de
            SHA1</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_microsoft_windows">Microsoft
            Windows</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_des_fichiers_sans_relation">Des fichiers
            sans relation</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_qui_modifie_quoi">Qui modifie
            quoi&nbsp;?</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_l_8217_historique_d_8217_un_fichier">L’historique
            d’un fichier</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_le_clone_initial">Le clone
            initial</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_les_projets_versatiles">Les projets
            versatiles</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_compteur_global">Compteur
            global</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_les_dossiers_vides">Les dossiers
            vides</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_le_premier_commit">Le premier
            commit</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_bizarreries_de_l_8217_interface">Bizarreries
            de l’interface</a></span></li>
          </ul>
        </li>

        <li><span class="chapter"><a href="ch10.html">10. Appendix
        B: Traduire ce guide</a></span></li>
      </ul>
    </div>
<div class="content">
  <div class="chapter" title=
  "Chapitre&nbsp;7.&nbsp;La maîtrise de Git">
    <div class="titlepage">
      <div>
        <div>
          <h2 class="title"><a name=
          "_la_ma%C3%AEtrise_de_git"></a>Chapitre&nbsp;7.&nbsp;La
          maîtrise de Git</h2>
        </div>
      </div>
    </div>

    <p>À ce stade, vous devez être capable de parcourir les pages
    de <span class="strong"><strong>git help</strong></span> et
    comprendre presque tout (en supposant que vous lisez
    l’anglais). En revanche, retrouver la commande exacte qui
    résoudra un problème précis peut être fastidieux. Je peux sans
    doute vous aider à gagner un peu de temps&nbsp;: vous trouverez
    ci-dessous quelques-unes des recettes dont j’ai déjà eu
    besoin.</p>

    <div class="section" title="Publication de sources">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_publication_de_sources"></a>Publication de
            sources</h2>
          </div>
        </div>
      </div>

      <p>Dans mes projets, Git gère exactement tous les fichiers
      que je veux placer dans une archive afin de la publier. Pour
      créer une telle archive, j’utilise&nbsp;:</p>
      <pre class="literallayout">
$ git archive --format=tar --prefix=proj-1.2.3/ HEAD
</pre>
    </div>

    <div class="section" title="Gérer le changement">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_g%C3%A9rer_le_changement"></a>Gérer le
            changement</h2>
          </div>
        </div>
      </div>

      <p>Indiquer à Git quels fichiers ont été ajoutés, supprimés
      ou renommés est parfois pénible pour certains projets. À la
      place, vous pouvez faire&nbsp;:</p>
      <pre class="literallayout">
$ git add .
$ git add -u
</pre>

      <p>Git cherchera les fichiers du dossier courant et gérera
      tous les détails tout seul. En remplacement de la deuxième
      commande <span class="emphasis"><em>add</em></span>, vous
      pouvez utiliser <code class="literal">git commit -a</code>
      pour créer un nouveau commit directement. Lisez <span class=
      "strong"><strong>git help ignore</strong></span> pour savoir
      comment spécifier les fichiers qui doivent être ignorés.</p>

      <p>Vous pouvez effectuer tout cela en une seule passe grâce
      à&nbsp;:</p>
      <pre class="literallayout">
$ git ls-files -d -m -o -z | xargs -0 git update-index --add --remove
</pre>

      <p>Les options <span class=
      "strong"><strong>-z</strong></span> et <span class=
      "strong"><strong>-0</strong></span> empêchent les effets
      secondaires imprévus dûs au noms de fichiers contenant des
      caractères étranges. Comme cette commande ajoutent aussi les
      fichiers habituellement ignorés, vous voudrez sûrement
      utiliser les options <code class="literal">-x</code> ou
      <code class="literal">-X</code>.</p>
    </div>

    <div class="section" title="Mon commit est trop gros&nbsp;!">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_mon_commit_est_trop_gros"></a>Mon commit est trop
            gros&nbsp;!</h2>
          </div>
        </div>
      </div>

      <p>Avez-vous négligé depuis longtemps de faire un
      commit&nbsp;? Avez-vous codé furieusement et tout oublié de
      la gestion de versions jusqu'à présent&nbsp;? Faites-vous
      plein de petits changements sans rapport entre eux parce que
      c’est votre manière de travailler&nbsp;?</p>

      <p>Pas de soucis. Faites&nbsp;:</p>
      <pre class="literallayout">
$ git add -p
</pre>

      <p>Pour chacune des modifications que vous avez faites, Git
      vous montrera le bout de code qui a changé et vous demandera
      si elle doit faire partie du prochain commit. Répondez par
      "y" (oui) ou par "n" (non). Vous avez aussi d’autres options
      comme celle vous permettant de reporter votre décision&nbsp;;
      tapez "?" pour en savoir plus.</p>

      <p>Une fois satisfait, tapez&nbsp;:</p>
      <pre class="literallayout">
$ git commit
</pre>

      <p>pour faire un commit incluant exactement les modifications
      qui vous avez sélectionnées (les modifications indexées).
      Soyez certain de ne pas utiliser l’option <span class=
      "strong"><strong>-a</strong></span> sinon Git fera un commit
      incluant toutes vos modifications.</p>

      <p>Que faire si vous avez modifié de nombreux fichiers en de
      nombreux endroits&nbsp;? Vérifier chaque modification
      individuellement devient alors rapidement frustrant et
      abrutissant. Dans ce cas, utilisez la commande <span class=
      "strong"><strong>git add -i</strong></span> dont l’interface
      est moins facile mais beaucoup plus souple. En quelques
      touches vous pouvez ajouter ou retirer de votre index (voir
      ci-dessous) plusieurs fichiers d’un seul coup mais aussi
      valider ou non chacune des modifications individuellement
      pour certains fichiers. Vous pouvez aussi utiliser en
      remplacement la commande <span class="strong"><strong>git
      commit --interactive</strong></span> qui effectuera un commit
      automatiquement quand vous aurez terminé.</p>
    </div>

    <div class="section" title=
    "L’index&nbsp;: l’aire d’assemblage">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_l_8217_index_l_8217_aire_d_8217_assemblage"></a>L’index&nbsp;:
            l’aire d’assemblage</h2>
          </div>
        </div>
      </div>

      <p>Jusqu’ici nous avons réussi à éviter de parler du fameux
      <span class="emphasis"><em>index</em></span> de Git mais nous
      devons maintenant le présenter pour mieux comprendre ce qui
      précède. L’index est une aire d’assemblage temporaire. Git ne
      transfert que très rarement de données depuis votre dossier
      de travail directement vers votre historique. En fait, Git
      copie d’abord ces données dans l’index puis il copie toutes
      ces données depuis l’index vers leur destination finale.</p>

      <p>Un <span class="strong"><strong>commit -a</strong></span>,
      par exemple, est en fait un processus en deux temps. La
      première étape consiste à construire dans l’index un
      instantané de l'état actuel de tous les fichiers suivis par
      Git. La seconde étape enregistre cet instantané de manière
      permanente dans l’historique. Effectuer un commit sans
      l’option <span class="strong"><strong>-a</strong></span>
      réalise uniquement cette deuxième étape et cela n’a de sens
      qu’après avoir effectué des commandes qui change l’index,
      telle que <span class="strong"><strong>git
      add</strong></span>.</p>

      <p>Habituellement nous pouvons ignorer l’index et faire comme
      si nous échangions directement avec l’historique. Dans
      certaines occasions, nous voulons un contrôle fin et nous
      gérons donc l’index. Nous plaçons dans l’index un instantané
      de certaines modifications (mais pas toutes) et enregistrons
      de manière permanente cet instantané soigneusement
      construit.</p>
    </div>

    <div class="section" title="Ne perdez pas la tête">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_ne_perdez_pas_la_t%C3%AAte"></a>Ne perdez pas la
            tête</h2>
          </div>
        </div>
      </div>

      <p>Le tag HEAD est comme un curseur qui pointe habituellement
      vers le tout dernier commit et qui avance à chaque commit.
      Certaines commandes Git vous permettent de le déplacer. Par
      exemple&nbsp;:</p>
      <pre class="literallayout">
$ git reset HEAD~3
</pre>

      <p>déplacera HEAD trois commits en arrière. À partir de là,
      toutes les commandes Git agiront comme si vous n’aviez jamais
      fait ces trois commits, même si vos fichier restent dans leur
      état présent. Voir les pages d’aide pour quelques usages
      intéressants.</p>

      <p>Mais comment faire pour revenir vers le futur&nbsp;? Les
      commits passés ne savent rien du futur.</p>

      <p>Si vous connaissez l’empreinte SHA1 du HEAD original,
      faites alors&nbsp;:</p>
      <pre class="literallayout">
$ git reset 1b6d
</pre>

      <p>Mais que faire si vous ne l’avez pas regardé&nbsp;? Pas de
      panique&nbsp;: pour des commandes comme celle-ci, Git
      enregistre la valeur originale de HEAD dans un tag nommé
      ORIG_HEAD et vous pouvez revenir sain et sauf via&nbsp;:</p>
      <pre class="literallayout">
$ git reset ORIG_HEAD
</pre>
    </div>

    <div class="section" title="Chasseur de tête">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_chasseur_de_t%C3%AAte"></a>Chasseur de tête</h2>
          </div>
        </div>
      </div>

      <p>Peut-être que ORIG_HEAD ne vous suffit pas. Peut-être
      venez-vous de vous apercevoir que vous avez fait une
      monumentale erreur et que vous devez revenir à une ancienne
      version d’une branche oubliée depuis longtemps.</p>

      <p>Par défaut, Git conserve un commit au moins deux semaine
      même si vous avez demandé à Git de détruire la branche qui le
      contient. La difficulté consiste à retrouver l’empreinte
      appropriée. Vous pouvez toujours explorer les différentes
      valeurs d’empreinte trouvées dans <code class=
      "literal">.git/objects</code> et retrouver celle que vous
      cherchez par essais et erreurs. Mais il existe un moyen plus
      simple.</p>

      <p>Git enregistre l’empreinte de chaque commit qu’il traite
      dans <code class="literal">.git/logs</code>. La sous-dossier
      <code class="literal">refs</code> contient l’historique de
      toute l’activité de chaque branche alors que le fichier
      <code class="literal">HEAD</code> montre chaque valeur
      d’empreinte que HEAD a pu prendre. Ce dernier peut donc
      servir à retrouver les commits d’une branche qui a été
      accidentellement élaguée.</p>

      <p>La commande reflog propose une interface sympa vers ces
      fichiers de log. Essayez:</p>
      <pre class="literallayout">
$ git reflog
</pre>

      <p>Au lieu de copier/coller une empreinte listée par reflog,
      essayez&nbsp;:</p>
      <pre class="literallayout">
$ git checkout "@{10 minutes ago}"
</pre>

      <p>Ou basculez vers le cinquième commit précédemment visité
      via&nbsp;:</p>
      <pre class="literallayout">
$ git checkout "@{5}"
</pre>

      <p>Voir la section «Specifying Revisions» de <span class=
      "strong"><strong>git help rev-parse</strong></span> pour en
      savoir plus.</p>

      <p>Vous pouvez configurer une plus longue période de
      rétention pour les commits condamnés. Par exemple&nbsp;:</p>
      <pre class="literallayout">
$ git config gc.pruneexpire "30 days"
</pre>

      <p>signifie qu’un commit effacé ne le sera véritablement
      qu’après 30 jours et lorsque $git gc* tournera.</p>

      <p>Vous pouvez aussi désactiver le déclenchement automatique
      de <span class="strong"><strong>git
      gc</strong></span>&nbsp;:</p>
      <pre class="literallayout">
$ git config gc.auto 0
</pre>

      <p>auquel cas les commits ne seront véritablement effacés que
      lorsque vous lancerez <span class="strong"><strong>git
      gc</strong></span> manuellement.</p>
    </div>

    <div class="section" title="Construire au-dessus de Git">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_construire_au_dessus_de_git"></a>Construire au-dessus
            de Git</h2>
          </div>
        </div>
      </div>

      <p>À la manière UNIX, la conception de Git permet son
      utilisation comme un composant de bas niveau d’autres
      programmes tels que des interfaces graphiques ou web, des
      interfaces en ligne de commandes alternatives, des outils de
      gestion de patch, des outils d’importation et de conversion,
      etc. En fait, certaines commandes Git sont de simples scripts
      s’appuyant sur les commandes de base, comme des nains sur des
      épaules de géants. Avec un peu de bricolage, vous pouvez
      adapter Git à vos préférences.</p>

      <p>Une astuce facile consiste à créer des alias Git pour
      raccourcir les commandes que vous utilisez le plus
      fréquemment&nbsp;:</p>
      <pre class="literallayout">
$ git config --global alias.co checkout
$ git config --global --get-regexp alias  # affiche les alias connus
alias.co checkout
$ git co foo                              # identique à 'git checkout foo'
</pre>

      <p>Une autre astuce consiste à intégrer le nom de la branche
      courant dans votre prompt ou dans le titre de la fenêtre.
      L’invocation de&nbsp;:</p>
      <pre class="literallayout">
$ git symbolic-ref HEAD
</pre>

      <p>montre le nom complet de la branche courante. En pratique,
      vous souhaiterez probablement enlever "refs/heads/" et
      ignorer les erreurs&nbsp;:</p>
      <pre class="literallayout">
$ git symbolic-ref HEAD 2&gt; /dev/null | cut -b 12-
</pre>

      <p>Le sous-dossier <code class="literal">contrib</code> de
      Git est une mine d’outils construits au-dessus de Git. Un
      jour, certains d’entre eux pourraient être promus au rang de
      commandes officielles. Dans Debian et Ubuntu, ce dossier est
      <code class=
      "literal">/usr/share/doc/git-core/contrib</code>.</p>

      <p>L’un des plus populaires de ces scripts est <code class=
      "literal">workdir/git-new-workdir</code>. Grâce à des liens
      symboliques intelligents, ce script crée un nouveau dépôt
      dont l’historique est partagé avec le dépôt original.</p>
      <pre class="literallayout">
$ git-new-workdir un/existant/depot nouveau/repertoire
</pre>

      <p>Le nouveau dossier et ses fichiers peuvent être vus comme
      un clone, sauf que l’historique est partagé et que les deux
      arbres des versions restent automatiquement synchrones. Nul
      besoin de merge, push ou pull.</p>
    </div>

    <div class="section" title="Audacieuses acrobaties">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_audacieuses_acrobaties"></a>Audacieuses
            acrobaties</h2>
          </div>
        </div>
      </div>

      <p>À ce jour, Git fait tout son possible pour que
      l’utilisateur ne puisse pas effacer accidentellement des
      données. Mais si vous savez ce que vous faites, vous pouvez
      passer outre les garde-fous des principales commandes.</p>

      <p><span class=
      "strong"><strong>Checkout</strong></span>&nbsp;: des
      modifications non intégrées (via commit) peuvent causer
      l'échec d’un checkout. Pour détruire vos modifications et
      réussir quoi qu’il arrive un checkout d’un commit donné,
      utilisez l’option d’obligation&nbsp;:</p>
      <pre class="literallayout">
$ git checkout -f HEAD^
</pre>

      <p>Inversement, si vous spécifiez des chemins particuliers
      pour un checkout alors il n’y a pas de garde-fous. Le contenu
      des chemins est silencieusement réécrit. Faites attention
      lorsque vous utilisez un checkout de cette manière.</p>

      <p><span class="strong"><strong>Reset</strong></span>&nbsp;:
      un reset échoue aussi en présence de modifications non
      intégrées. Pour passer outre, faites&nbsp;:</p>
      <pre class="literallayout">
$ git reset --hard 1b6d
</pre>

      <p><span class="strong"><strong>Branch</strong></span>&nbsp;:
      la suppression de branches échoue si cela implique la perte
      de certains commits. Par forcer la suppression,
      tapez&nbsp;:</p>
      <pre class="literallayout">
$ git branch -D branche_morte  # à la place de -d
</pre>

      <p>De manière similaire, une tentative visant à renommer une
      branche existante vers le nom d’une autre branche échoue si
      cela amène la perte de commits. Pour forcer le changement de
      nom, tapez&nbsp;:</p>
      <pre class="literallayout">
$ git branch -M source target  # à la place de -m
</pre>

      <p>Contrairement à checkout et reset, ces deux dernières
      commandes n’effectuent pas la suppression des informations
      immédiatement. Les commits destinés à disparaître sont encore
      disponibles dans le sous-dossier .git et peuvent encore être
      retrouvés grâce aux empreintes appropriées tel que retrouvées
      dans <code class="literal">.git/logs</code> (voir "Chasseur
      de tête" ci-dessus). Par défaut, ils sont conservés au moins
      deux semaines.</p>

      <p><span class="strong"><strong>Clean</strong></span>&nbsp;:
      certaines commandes Git refusent de s’exécuter pour ne pas
      écraser des fichiers non suivis. Si vous êtes certain que
      tous ces fichiers et dossiers peuvent être sacrifiés alors
      effacez-les sans pitié via&nbsp;:</p>
      <pre class="literallayout">
$ git clean -f -d
</pre>

      <p>Ensuite, la commande trop prudente fonctionnera !</p>
    </div>

    <div class="section" title="Se prémunir des commits erronés">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_se_pr%C3%A9munir_des_commits_erron%C3%A9s"></a>Se
            prémunir des commits erronés</h2>
          </div>
        </div>
      </div>

      <p>Des erreurs stupides encombrent mes dépôts. Les plus
      effrayantes sont dues à des fichiers manquants car oubliés
      lors des <span class="strong"><strong>git
      add</strong></span>. D’autres erreurs moins graves concernent
      les espaces blancs inutiles ou les conflits de fusion non
      résolus&nbsp;: bien qu’inoffensives, j’aimerais qu’elles
      n’apparaissent pas dans les versions publiques.</p>

      <p>Si seulement je m’en étais prémuni en utilisant un
      <span class="emphasis"><em>hook</em></span> (un crochet) pour
      m’alerter de ces problèmes&nbsp;:</p>
      <pre class="literallayout">
$ cd .git/hooks
$ cp pre-commit.sample pre-commit  # Vieilles versions de Git : chmod +x pre-commit
</pre>

      <p>Maintenant Git empêchera un commit s’il détecte des espace
      inutiles ou s’il reste des conflits de fusion non
      résolus.</p>

      <p>Pour gérer ce guide, j’ai aussi ajouté les lignes
      ci-dessous au début de mon hook <span class=
      "strong"><strong>pre-commit</strong></span> pour me prémunir
      de mes inattentions&nbsp;:</p>
      <pre class="literallayout">
if git ls-files -o | grep '\.txt$'; then
  echo FAIL! Untracked .txt files.
  exit 1
fi
</pre>

      <p>Plusieurs opération de Git acceptent les hooks&nbsp;; voir
      <span class="strong"><strong>git help hooks</strong></span>.
      Nous avons déjà utilisé le hook <span class=
      "strong"><strong>post-update</strong></span> lorsque nous
      avons parlé de Git au-dessus de HTTP. Celui-ci se déclenche à
      chaque mouvement de HEAD. Le script d’exemple post-update met
      à jour les fichiers Git nécessaires à une communication
      au-dessus de transports agnostiques tels que HTTP.</p>
    </div>
  </div><script type="text/javascript" src="find_selflink.js">
</script><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
  </script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1901330-2");
  pageTracker._initData();
  pageTracker._trackPageview();
  </script>
</div>
</div><div class="footer"><a href="/~blynn/">Ben Lynn</a></div>
</body>
</html>
