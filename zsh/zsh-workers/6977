From zsh-workers-return-6977-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Jul 05 11:56:43 1999
Return-Path: <zsh-workers-return-6977-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24011 invoked from network); 5 Jul 1999 11:56:41 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 5 Jul 1999 11:56:41 -0000
Received: (qmail 8804 invoked by alias); 5 Jul 1999 11:56:17 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6977
Received: (qmail 8797 invoked from network); 5 Jul 1999 11:56:17 -0000
Date: Mon, 5 Jul 1999 13:56:13 +0200 (MET DST)
Message-Id: <199907051156.NAA07626@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Sat, 3 Jul 1999 16:49:10 +0400
Subject: Re: Something odd in _match


Andrej Borsenkow wrote:

> Is it really supposed to be so:
> 
>   if (( ret )); then
>     [[ "$compconfig[match_insert]" = unambig* &&
>        $#compstate[unambiguous] -ge ${#:-${PREFIX}${SUFFIX}} ]] && 
>                                                              ^^^^^^^
>         compstate[pattern_insert]=unambiguous
>     return 0
>   fi

What's wrong with that?

> and in another place (near the end) the same and even worse :-)
> 
> if (( ! ret )); then
>   [[ "$compconfig[match_insert]" = unambig* &&
>      $#compstate[unambiguous] -ge ${#:-${PREFIX}${SUFFIX}} ]] && 
>       compstate[pattern_insert]=unambiguous
> fi
> 
> In this case we don't even have a command to execute after condition.

Ok, I was just too lazy when copying that down from the other place.

Bye
 Sven

diff -u oc/Core/_match Completion/Core/_match
--- oc/Core/_match	Mon Jul  5 10:24:15 1999
+++ Completion/Core/_match	Mon Jul  5 13:54:32 1999
@@ -60,10 +60,8 @@
 compstate[pattern_match]="$opm"
 compstate[matcher]="$compstate[total_matchers]"
 
-if (( ! ret )); then
-  [[ "$compconfig[match_insert]" = unambig* &&
-     $#compstate[unambiguous] -ge ${#:-${PREFIX}${SUFFIX}} ]] && 
-      compstate[pattern_insert]=unambiguous
-fi
+[[ ret -eq 0 && "$compconfig[match_insert]" = unambig* &&
+   $#compstate[unambiguous] -ge ${#:-${PREFIX}${SUFFIX}} ]] && 
+    compstate[pattern_insert]=unambiguous
 
 return 1-ret

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

