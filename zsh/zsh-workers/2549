From zsh-workers-request@euclid.skiles.gatech.edu Mon Dec 09 14:08:09 1996
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 1588 invoked from network); 9 Dec 1996 14:08:08 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 9 Dec 1996 14:08:08 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id IAA04888; Mon, 9 Dec 1996 08:55:53 -0500 (EST)
Resent-Date: Mon, 9 Dec 1996 08:55:53 -0500 (EST)
From: gwing@primenet.com.au
Message-ID: <19961209125706.1358.qmail@primenet.com.au>
Subject: Re: Bug in 3.0.2-test1 (no 'erase char' if zle off)
To: zsh-workers@math.gatech.edu
Date: Mon, 9 Dec 1996 23:57:05 +1100 (EST)
Cc: stucki@math.fu-berlin.de
In-Reply-To: <19961209115418.1199.qmail@primenet.com.au> from "gwing@primenet.com.au" at Dec 9, 96 10:54:18 pm
X-Mailer: ELM [version 2.4 PL25]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"6eoHp2.0.JC1.ff1ho"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2549
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

I wrote:
:C. v. Stuckrad found some bugs.
:Hopefully a patch will follow soon.

Here it is.  It should be against 3.0.2-test1 (I think).  
One test I put in recently was a bit overeager.


*** zle_refresh.c.1	Mon Dec  9 23:20:27 1996
--- zle_refresh.c	Mon Dec  9 23:35:46 1996
***************
*** 58,64 ****
      pptw, rpw,                  /* prompt widths on screen                  */
      vcs, vln,			/* video cursor position column & line	    */
      vmaxln,			/* video maximum number of lines	    */
!     winw, winh,			/* window width & height		    */
      winpos;			/* singlelinezle: line's position in window */
  static unsigned pmpt_attr = 0,	/* text attributes after displaying prompt  */
      rpmpt_attr = 0;		/* text attributes after displaying rprompt */
--- 58,64 ----
      pptw, rpw,                  /* prompt widths on screen                  */
      vcs, vln,			/* video cursor position column & line	    */
      vmaxln,			/* video maximum number of lines	    */
!     winw, winh, rwinh,		/* window width & height		    */
      winpos;			/* singlelinezle: line's position in window */
  static unsigned pmpt_attr = 0,	/* text attributes after displaying prompt  */
      rpmpt_attr = 0;		/* text attributes after displaying rprompt */
***************
*** 76,81 ****
--- 76,82 ----
  	winh = 1;
      else
  	winh = (lines < 2) ? 24 : lines;
+     rwinh = lines;		/* keep the real number of lines */
      winpos = vln = vmaxln = 0;
      if (lwinw != winw || lwinh != winh) {
  	if (nbuf) {
***************
*** 275,281 ****
  	}
  	fflush(shout);
  	clearf = clearflag;
!     } else if (winw != columns || winh != lines)
  	resetvideo();
  
  /* now winw equals columns and winh equals lines 
--- 276,282 ----
  	}
  	fflush(shout);
  	clearf = clearflag;
!     } else if (winw != columns || rwinh != lines)
  	resetvideo();
  
  /* now winw equals columns and winh equals lines 

-- 
Geoff Wing [gwing@primenet.com.au]   Technical Manager
  Phone    : +61-3-9818 2977	     PrimeNet - Internet Consultancy
  Facsimile: +61-3-9819 3788	     Web : <URL:http://www.primenet.com.au/>
  Mobile   : 0412 162 441

