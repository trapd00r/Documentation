From zsh-workers-return-12150-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Jul 03 18:02:04 2000
Return-Path: <zsh-workers-return-12150-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29884 invoked from network); 3 Jul 2000 18:02:04 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 3 Jul 2000 18:02:04 -0000
Received: (qmail 13325 invoked by alias); 3 Jul 2000 18:01:56 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12150
Received: (qmail 13317 invoked from network); 3 Jul 2000 18:01:54 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000703180143.ZM2794@candle.brasslantern.com>
Date: Mon, 3 Jul 2000 18:01:43 +0000
In-Reply-To: <m2d7kv2k5e.fsf@zion.rcn.com>
Comments: In reply to Vin Shelton <acs@alumni.princeton.edu>
        "Failing make check" (Jul  3,  1:33pm)
References: <m2d7kv2k5e.fsf@zion.rcn.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Vin Shelton <acs@alumni.princeton.edu>,
        zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: Re: Failing make check
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Jul 3,  1:33pm, Vin Shelton wrote:
} Subject: Failing make check
}
} I build my zsh in a separate directory from the sources [...]

So do I.

} For a few days now, make check has been failing in this configuration
} as follows:
} 
} comptestinit:5: failed to load module: zsh/zpty
} comptestinit:18: command not found: zpty
} comptestinit:20: command not found: zpty
} Test /usr/local/src/zsh-2000-07-03/Test/53completion.ztst failed: non-zero status from preparation code:
}   comptestinit -z $ZTST_testdir/../Src/zsh

This is working fine for me.

The first question is, are you sure you're building a dynamically-linked
shell?  The zpty module is not included by default in static builds.

At the very beginning of the test process, you should have seen something
like:

if test -n "gcc"; then \
  cd .. && \
  make MODDIR=`pwd`/Test/Modules install.modules > /dev/null; \
fi
mkdir /usr/local/build/zsh-2000-07-03/Test/Modules
mkdir /usr/local/build/zsh-2000-07-03/Test/Modules/zsh

This is copying the modules into a local directory at which module_path
is later pointed, to be sure the right modules are loaded.  If you don't
see that install step, you have a statically-linked shell.  If that step
is failing, perhaps because there's a stray Test/Modules directory with
the wrong permissions, then the tests could fail in unpredictable ways.

If that doesn't seem related to the problem, you could try

	ZTST_verbose=2 make TESTNUM=53 check

to see if that reveals anything; but I suspect you're going to have to put
a `set -x' into the prep section of Test/53completion.ztst to get the real
scoop.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

