From zsh-workers-request@math.gatech.edu Fri Jun 19 19:02:05 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5141 invoked from network); 19 Jun 1998 19:02:04 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 19 Jun 1998 19:02:04 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id OAA05073;
	Fri, 19 Jun 1998 14:54:55 -0400 (EDT)
Resent-Date: Fri, 19 Jun 1998 14:54:55 -0400 (EDT)
From: Zefram <zefram@tao.co.uk>
Message-Id: <199806191853.TAA17801@taos.demon.co.uk>
Subject: Re: REC_EXACT and AUTO_MENU, and compctl -U too
To: schaefer@brasslantern.com (Bart Schaefer)
Date: Fri, 19 Jun 1998 19:53:49 +0100 (BST)
Cc: zsh-workers@math.gatech.edu
In-Reply-To: <980619111459.ZM9964@candle.brasslantern.com> from "Bart Schaefer" at Jun 19, 98 11:14:59 am
X-Mailer: ELM [version 2.4 PL25]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"R597h3.0.CF1.-FhYr"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4133
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Bart Schaefer wrote:
>What I'd like is to have recexact behavior when I type the entire prefix
>and automenu behavior when zsh supplies the prefix.

Interesting.  At the moment, zle makes absolutely no distinction
between text inserted by the user and text inserted by completion.
It also does not consider itself to be in the middle of a completion
immediately after completion inserts text (other than in menu completion).
I suppose an extra state flag, to disable REC_EXACT would be reasonable.
Set the flag when completion inserts text, and clear it when any other
editing action occurs.  Would this give the semantics you want?

>While I'm on the subject of mildly stupid completion behavior, automenu
>in conjunction with compctl -U could do with a bit of work.  It'd be a
>lot more useful if menu completion kicked in immediately when compctl -U
>returns multiple matches and automenu is set.  Otherwise you lose both
>the set of completions and the nonunique suffix as soon as the first TAB
>is pressed.

I see what you mean.  I think common prefix recognition should be
disabled when using a -U compctl.  The effect of -U is to disable the
use of existing prefixes, so trying to take advantage of the usual prefix
semantics under such circumstances is pretty stupid.

>                                         Any remarks on how difficult they
>are to pull off?

Neither of them seems particularly difficult to implement, but they
won't exactly make zle_tricky any less _tricky.  Testing will be tedious.

-zefram

