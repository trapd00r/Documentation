From zsh-workers-return-28088-mason-zsh=primenet.com.au@zsh.org Sun Jul 18 18:21:49 2010
Return-Path: <zsh-workers-return-28088-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26553 invoked by alias); 18 Jul 2010 18:21:49 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28088
Received: (qmail 27522 invoked from network); 18 Jul 2010 18:21:46 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_NONE
	autolearn=ham version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at ntlworld.com designates 81.103.221.48 as permitted sender)
Date: Sun, 18 Jul 2010 19:21:30 +0100
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-workers@zsh.org
Subject: Re: autocompletion with ssh and .ssh/config
Message-ID: <20100718192130.43f373fe@pws-pc>
In-Reply-To: <AANLkTilb8o0zusxIkGj1kEDP74JtcwatdWbUtnOUYJHd@mail.gmail.com>
References: <AANLkTikyZ8XZ_A8yGIQN2PRSXoA1Un6ZNdI6GLDzQpNN@mail.gmail.com>
	<alpine.LNX.2.01.1007180109520.14779@hp.internal>
	<AANLkTilb8o0zusxIkGj1kEDP74JtcwatdWbUtnOUYJHd@mail.gmail.com>
X-Mailer: Claws Mail 3.7.6 (GTK+ 2.18.9; x86_64-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Cloudmark-Analysis: v=1.1 cv=4QByPj+6Iq2k/6L54d+eVKTdgQxdscpRskJJReCfdXo= c=1 sm=0 a=BWuJ54wIqXoA:10 a=DogomfpGjd0A:10 a=kj9zAlcOel0A:10 a=pGLkceISAAAA:8 a=YQfN4TnuAAAA:8 a=FP58Ms26AAAA:8 a=HYshxDoSAAAA:8 a=NLZqzBF-AAAA:8 a=FiQj1NxTR8IorVg6E20A:9 a=FFCrTbXpI2ZagJqFqWYA:7 a=TQFRncNRJRymZAec_mV3cMC87Z4A:4 a=CjuIK1q_8ugA:10 a=g4Pr9CvUGCYA:10 a=MSl-tDqOz04A:10 a=bxnOgZBHIjQA:10 a=_dQi-Dcv4p4A:10 a=HpAAvcLHHh0Zw7uRqdWCyQ==:117

On Sun, 18 Jul 2010 10:51:32 +0200
Mikael Magnusson <mikachu@gmail.com> wrote:
> On 18 July 2010 07:21, Benjamin R. Haskell <zsh@benizi.com> wrote:
> > On Sun, 18 Jul 2010, David Duponchel wrote:
> >> I have some hosts defined in my .ssh/config file. Example :
> >> Host bar
> >>     HostName 1.2.3.4
> >>
> >> Host baz
> >>     HostName 2.3.4.5
> >>
> >> When I type ssh <tab>, only my users and hosts in /etc/hosts are
> >> displayed (my .ssh/config is ignored).
> >> With ssh ba<tab> the autocompletion is correctly done and propose bar
> >> and baz.
> >
> > Host from ~/.ssh/config aren't proposed until hosts found from other
> > methods are exhausted.  The biggest reason that seems wrong (IMO) is
> > that 'other methods' includes ~/.ssh/known_hosts.  So, a host I've never
> > ssh'ed to won't be offered until I've ssh'ed to it.
> 
> Here's the commit that introduced the &&returns,
> http://zsh.git.sourceforge.net/git/gitweb.cgi?p=zsh/zsh;a=commitdiff;h=7072c10ae223e24f601b3

... which contains little useful information but at least refers to where
the information is.  The correct reference is zsh-users/11333:

http://www.zsh.org/mla/users/2007/msg00233.html

This fixed a problem that user@... completed machines that weren't
associated with that username even though the association is explicit.

The problem seems to be that user completion is being assumed even if it
hasn't happened, i.e. user@host completion is treated as succesful even
if there's no user@ bit.

The fix would be to separate these cases, i.e. ensure the return only
happens if a user was actually matched.  Simply removing the returns
would reintroduce the user-host completion bug.  I haven't probed any
deeper, but presumably _combination isn't up to the job on its own, and
it'll need an extra test somewhere.  Examination suggests the problem's
probably in the second branch, where there's no existing "@".  However,
I can't see offhand what the command is trying to do.

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

