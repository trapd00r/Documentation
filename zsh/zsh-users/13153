From zsh-users-return-13153-mason-zsh=primenet.com.au@sunsite.dk Fri Aug 22 05:20:01 2008
Return-Path: <zsh-users-return-13153-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11054 invoked from network); 22 Aug 2008 05:19:46 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 22 Aug 2008 05:19:46 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 37704 invoked from network); 22 Aug 2008 05:18:48 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 22 Aug 2008 05:18:47 -0000
Received: (qmail 10076 invoked by alias); 22 Aug 2008 05:17:58 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13153
Received: (qmail 10065 invoked from network); 22 Aug 2008 05:17:56 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 22 Aug 2008 05:17:56 -0000
Received: from vms046pub.verizon.net (vms046pub.verizon.net [206.46.252.46])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 0A29F801E2B4
	for <zsh-users@sunsite.dk>; Fri, 22 Aug 2008 07:17:50 +0200 (CEST)
Received: from torch.brasslantern.com ([96.238.220.178])
 by vms046.mailsrvcs.net
 (Sun Java System Messaging Server 6.2-6.01 (built Apr  3 2006))
 with ESMTPA id <0K5Z00HGBLDDW1Y4@vms046.mailsrvcs.net> for
 zsh-users@sunsite.dk; Fri, 22 Aug 2008 00:17:38 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id m7M5HZsI002749	for
 <zsh-users@sunsite.dk>; Thu, 21 Aug 2008 22:17:36 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id m7M5HZKj002748	for zsh-users@sunsite.dk; Thu,
 21 Aug 2008 22:17:35 -0700
Date: Thu, 21 Aug 2008 22:17:35 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: rfc patch, abort rm instead of only removing the * from the cmdline
In-reply-to: <20080821165814.0f107293@pws-pc>
To: zsh-users <zsh-users@sunsite.dk>
Message-id: <080821221735.ZM2747@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <237967ef0808151649j1d14ce23s1acad02da98fdfdf@mail.gmail.com>
	<2d460de70808160858p5312805dlf1c9976a9b702a51@mail.gmail.com>
	<237967ef0808160902p4dbc6d73w6620f6c69471ea20@mail.gmail.com>
	<2d460de70808160914h2c3706ebs312a0bbd62afbf57@mail.gmail.com>
	<20080816205209.GA5176@sc.homeunix.net>
	<237967ef0808161358y5deae840xe3bd399d01d198f@mail.gmail.com>
	<20080817065717.GA5175@sc.homeunix.net>
	<080817134217.ZM29726@torch.brasslantern.com>	<20080821165814.0f107293@pws-pc>
Comments: In reply to Peter Stephenson <p.w.stephenson@ntlworld.com>
 "Re: rfc patch, abort rm instead of only removing the * from the cmdline" (Aug
 21,  4:58pm)
X-Virus-Scanned: ClamAV 0.92.1/8069/Thu Aug 21 19:36:55 2008 on bifrost
X-Virus-Status: Clean

On Aug 21,  4:58pm, Peter Stephenson wrote:
} Subject: Re: rfc patch, abort rm instead of only removing the * from the c
}
} On Sun, 17 Aug 2008 13:42:15 -0700
} Bart Schaefer <schaefer@brasslantern.com> wrote:
} > Ideally I suppose this prompt should work like the prompt for "correct",
} > giving you "nyae" as choices so you can choose to abort or to edit
} 
} That would certainly make things more consistent; I'm not sure how easy
} that is at this point in the code, however, which I think (without
} checking) is quite late into execution.  Does anyone want to look?

It can't be that late, as it has to happen before globbing in order to
find the Star token.  However, correction aborts by making hend() return
false, and relative to that in init.c:loop(), checkrmall() is down in
execode() which is after hend() has finished and even after preexec has
been run.  So the [yna] part would be easy (use Stephane's patch exept
only on a response of "a"), but it would have to unwind (or re-instate)
a fair bit of state to get back to the same command line for "e".

(This thread should probably move to zsh-workers at this point.)

