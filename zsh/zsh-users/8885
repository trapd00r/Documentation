From zsh-users-return-8885-mason-zsh=primenet.com.au@sunsite.dk Sun May 22 06:05:05 2005
Return-Path: <zsh-users-return-8885-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10068 invoked from network); 22 May 2005 06:05:04 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 22 May 2005 06:05:04 -0000
Received: (qmail 12982 invoked from network); 22 May 2005 06:04:58 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 22 May 2005 06:04:58 -0000
Received: (qmail 1150 invoked by alias); 22 May 2005 06:04:52 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8885
Received: (qmail 1136 invoked from network); 22 May 2005 06:04:51 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 22 May 2005 06:04:51 -0000
Received: (qmail 11968 invoked from network); 22 May 2005 06:04:51 -0000
Received: from vms046pub.verizon.net (206.46.252.46)
  by a.mx.sunsite.dk with SMTP; 22 May 2005 06:04:48 -0000
Received: from candle.brasslantern.com ([4.11.1.68])
 by vms046.mailsrvcs.net (Sun Java System Messaging Server 6.2 HotFix 0.04
 (built Dec 24 2004)) with ESMTPA id <0IGV00A77NJNJCAC@vms046.mailsrvcs.net> for
 zsh-users@sunsite.dk; Sun, 22 May 2005 01:04:37 -0500 (CDT)
Received: from candle.brasslantern.com (IDENT:schaefer@localhost [127.0.0.1])
	by candle.brasslantern.com (8.12.11/8.12.11) with ESMTP id j4M64ZMZ009849;
 Sat, 21 May 2005 23:04:35 -0700
Received: (from schaefer@localhost)	by candle.brasslantern.com
 (8.12.11/8.12.11/Submit) id j4M64ZQT009848; Sat, 21 May 2005 23:04:35 -0700
Date: Sun, 22 May 2005 06:04:34 +0000
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: zsh login coredump
In-reply-to: <1116731745.6855.13.camel@localhost.localdomain>
To: mneptok <mneptok@mneptok.com>
Cc: zsh-users@sunsite.dk
Message-id: <1050522060434.ZM9847@candle.brasslantern.com>
MIME-version: 1.0
X-Mailer: Z-Mail (5.0.0 30July97)
Content-type: text/plain; charset=us-ascii
References: <1116717823.6855.8.camel@localhost.localdomain>
	<050521171740.ZM9619@candle.brasslantern.com>
	<1116731745.6855.13.camel@localhost.localdomain>
Comments: In reply to mneptok <mneptok@mneptok.com>
 "Re: zsh login coredump" (May 21,  8:15pm)
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On May 21,  8:15pm, mneptok wrote:
} Subject: Re: zsh login coredump
}
} On Sat, 2005-05-21 at 17:17 -0700, Bart Schaefer wrote:
} 
} > Did it occur to you to look at /etc/profile line 33 or perhaps at
} > /etc/profile.d/krb5.sh line 5, to see what's causing the parse errors?
} > 
} > Has /etc/profile or /etc/profile.d/krb5.sh changed recently?  Why?
} 
} Yes, it did occur to me, but nothing jumped out at me:
} 
} 33 if [ `id -u` = 0 ]; then
} 
} 5         if [ `id -u` = 0 ] ; then

OK, so ...

If you're getting a parse error on that line, the problem must be that
`id -u` is returning *nothing* (it might very well be dumping core as
well).  Since `id -u` only prints an integer, it must be the case that
it's unable even to obtain that integer, which means that one of

      euid = geteuid ();
      ruid = getuid ();
      egid = getegid ();
      rgid = getgid ();

is failing catastrophically.

As zsh also calls these library routines, that's probably the cause of
the crash.

