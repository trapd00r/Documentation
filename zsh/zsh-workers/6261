From zsh-workers-return-6261-mason-zsh=primenet.com.au@sunsite.auc.dk Tue May 11 14:54:16 1999
Return-Path: <zsh-workers-return-6261-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13960 invoked from network); 11 May 1999 14:54:15 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 11 May 1999 14:54:15 -0000
Received: (qmail 10807 invoked by alias); 11 May 1999 14:54:07 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6261
Received: (qmail 10597 invoked from network); 11 May 1999 14:53:43 -0000
Message-Id: <199905111453.XAA21645@pop1.ngy.3web.ne.jp>
From: Tatsuo Furukawa <frkwtto@osk3.3web.ne.jp>
To: schaefer@brasslantern.com
CC: zsh-workers@sunsite.auc.dk
In-reply-to: <990504094850.ZM28177@candle.brasslantern.com>
	(schaefer@brasslantern.com)
Subject: Re: PATCH: Re: zsh hangs (3.0.6-pre-2, 3.1.5-pws-16)
Mime-Version: 1.0 (generated by tm-edit 7.52)
Content-Type: text/plain; charset=US-ASCII
Date: Tue, 11 May 1999 23:41:22 +0900
X-Dispatcher: impost version 0.99i (Apr. 6, 1997)
Lines: 29


Hello, Bart,

I applied your patch for fixing zsh hang problem patch issued in 6213.
And I tested.  This problem is too difficult to understand for me, but
patched zsh works well.  The patched zsh doesn't hang any more!!
(I tested 3.1.5-pws-17 in HP-UX 9.07).

So, I hope that this patch will be incorporated! :-)

Bart> Index: Src/exec.c
Bart> ===================================================================
Bart> RCS file: /extra/cvsroot/zsh/zsh-3.0/Src/exec.c,v
Bart> retrieving revision 1.1.1.5.2.3
Bart> diff -u -r1.1.1.5.2.3 exec.c
Bart> --- exec.c	1999/04/28 05:21:34	1.1.1.5.2.3
Bart> +++ exec.c	1999/05/04 16:34:15
Bart> @@ -2071,7 +2071,7 @@
Bart>  	zclose(pipes[1]);
Bart>  	retval = readoutput(pipes[0], qt);
Bart>  	fdtable[pipes[0]] = 0;
Bart> -	child_suspend(0);		/* unblocks */
Bart> +	waitforpid(pid);		/* unblocks */
Bart>  	lastval = cmdoutval;
Bart>  	return retval;
Bart>      }

-- 
Tatsuo Furukawa (frkwtto@osk3.3web.ne.jp)

