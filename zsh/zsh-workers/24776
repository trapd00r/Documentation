From zsh-workers-return-24776-mason-zsh=primenet.com.au@sunsite.dk Fri Mar 28 14:57:42 2008
Return-Path: <zsh-workers-return-24776-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3511 invoked from network); 28 Mar 2008 14:57:39 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 28 Mar 2008 14:57:39 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 68616 invoked from network); 28 Mar 2008 14:57:34 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Mar 2008 14:57:34 -0000
Received: (qmail 19505 invoked by alias); 28 Mar 2008 14:57:31 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24776
Received: (qmail 19491 invoked from network); 28 Mar 2008 14:57:30 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 28 Mar 2008 14:57:30 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [85.115.41.190])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 4E78E82CD273
	for <zsh-workers@sunsite.dk>; Fri, 28 Mar 2008 15:57:26 +0100 (CET)
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly10g.srv.mailcontrol.com (MailControl) with ESMTP id m2SEtc1J029043
	for <zsh-workers@sunsite.dk>; Fri, 28 Mar 2008 14:57:19 GMT
Received: from news01 ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Fri, 28 Mar 2008 14:55:37 +0000
Date: Fri, 28 Mar 2008 14:55:37 +0000
From: Peter Stephenson <pws@csr.com>
To: "Zsh hackers list" <zsh-workers@sunsite.dk>
Subject: Re: Misleading/not-as-useful-as-it-could-be error message
Message-ID: <20080328145537.3e3e8ee6@news01>
In-Reply-To: <2d460de70803280544ub409dfn4dc454433b6ba271@mail.gmail.com>
References: <2d460de70803280544ub409dfn4dc454433b6ba271@mail.gmail.com>
Organization: CSR
X-Mailer: Claws Mail 3.3.1 (GTK+ 2.12.5; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 28 Mar 2008 14:55:37.0026 (UTC) FILETIME=[C82A7220:01C890E3]
X-Scanned-By: MailControl A-08-00-04 (www.mailcontrol.com) on 10.71.0.120
X-Virus-Scanned: ClamAV 0.91.2/6440/Fri Mar 28 14:37:20 2008 on bifrost
X-Virus-Status: Clean

On Fri, 28 Mar 2008 13:44:11 +0100
"Richard Hartmann" <richih.mailinglist@gmail.com> wrote:
> I just found out about a neat feature: When a completion function is
> writeable by non-root, zsh will complain about the fact.
> 
> You get:
> Ignore insecure files and continue [ny]?
> 
> I see two problems with this:
> 1) The user does not know it is zsh saying this, it could be anything,
> really.
> 2) The user is not told _what_ files are considered insecure and why.
> 
> Adding a note on where & why the files were sourced/loaded would
> be an optional extra.

People have complained before (now in the dim distant past, I think even
before I became responsible for this by default) that this is a bit terse.
If you type 'n' it tells you to run compaudit to see what was wrong, but
(a) it's not very clear what 'n' means (b) you can run it if you type 'y',
too, which is still as safe since it ignores the files in question.  The
reason for typing 'n' wouldn't be security, it would be the worry that you
haven't got a complete completion system, although if you fix the problem
you can run compinit again.

Index: Completion/compinit
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/compinit,v
retrieving revision 1.18
diff -u -r1.18 compinit
--- Completion/compinit	1 Nov 2007 10:56:39 -0000	1.18
+++ Completion/compinit	28 Mar 2008 14:48:46 -0000
@@ -417,8 +417,9 @@
   if ! eval compaudit; then
     if [[ -n "$_i_q" ]]; then
       if [[ "$_i_fail" = ask ]]; then
-        if ! read -q "?Ignore insecure $_i_q and continue [ny]? "; then
-	  print -u2 "run compaudit to see list of insecure $_i_q"
+        if ! read -q \
+"?zsh compinit: insecure $_i_q, run compaudit for list.
+Ignore insecure $_i_q and continue [y] or abort compinit [n]? "; then
 	  print -u2 "$0: initialization aborted"
           unfunction compinit compdef
           unset _comp_dumpfile _comp_secure compprefuncs comppostfuncs \


-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

