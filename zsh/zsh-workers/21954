From zsh-workers-return-21954-mason-zsh=primenet.com.au@sunsite.dk Sun Oct 30 16:33:48 2005
Return-Path: <zsh-workers-return-21954-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28582 invoked from network); 30 Oct 2005 16:33:42 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 30 Oct 2005 16:33:42 -0000
Received: (qmail 98792 invoked from network); 30 Oct 2005 16:33:35 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 30 Oct 2005 16:33:35 -0000
Received: (qmail 18168 invoked by alias); 30 Oct 2005 16:33:33 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21954
Received: (qmail 18158 invoked from network); 30 Oct 2005 16:33:32 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 30 Oct 2005 16:33:32 -0000
Received: (qmail 98560 invoked from network); 30 Oct 2005 16:33:32 -0000
Received: from mta09-winn.ispmail.ntl.com (81.103.221.49)
  by a.mx.sunsite.dk with SMTP; 30 Oct 2005 16:33:30 -0000
Received: from aamta10-winn.ispmail.ntl.com ([81.103.221.35])
          by mta09-winn.ispmail.ntl.com with ESMTP
          id <20051030163329.XDLK8609.mta09-winn.ispmail.ntl.com@aamta10-winn.ispmail.ntl.com>;
          Sun, 30 Oct 2005 16:33:29 +0000
Received: from pwslaptop.csr.com ([81.105.238.64])
          by aamta10-winn.ispmail.ntl.com with SMTP
          id <20051030163329.WQQM26459.aamta10-winn.ispmail.ntl.com@pwslaptop.csr.com>;
          Sun, 30 Oct 2005 16:33:29 +0000
Date: Sun, 30 Oct 2005 16:33:05 +0000
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: Steve Atwell <satwell@disjoint.net>, zsh-workers@sunsite.dk
Subject: Re: FreeBSD process substitution bug
Message-Id: <20051030163305.3c89b2ea.p.w.stephenson@ntlworld.com>
In-Reply-To: <20051029212156.GA57823@stripped.disjoint.net>
References: <20051029070656.GA77326@stripped.disjoint.net>
	<200510291002.j9TA2Q5P003942@pwslaptop.csr.com>
	<20051029212156.GA57823@stripped.disjoint.net>
X-Mailer: Sylpheed version 0.9.12 (GTK+ 1.2.10; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.4

> I did a little more investigation and found the problem.  FreeBSD 5.x by 
> default only provides file descriptors 0, 1, and 2 for the current 
> process in /dev/fd.  If you want to be able to access other file 
> descriptors, you have to mount the special fdescfs filesystem on 
> /dev/fd.  The configure test to see if zsh can use /dev/fd succeeds 
> because it only tests /dev/fd/0.

Thanks for the research.  Can you see if the following gives you a
working command substitution in this case?

Index: configure.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.ac,v
retrieving revision 1.41
diff -u -r1.41 configure.ac
--- configure.ac	28 Oct 2005 17:34:33 -0000	1.41
+++ configure.ac	30 Oct 2005 16:31:06 -0000
@@ -1603,7 +1603,7 @@
 [Define to the path of the /dev/fd filesystem.])
 AC_CACHE_CHECK(for /dev/fd filesystem, zsh_cv_sys_path_dev_fd,
 [for zsh_cv_sys_path_dev_fd in /proc/self/fd /dev/fd no; do
-   test x`echo ok|cat $zsh_cv_sys_path_dev_fd/0 2>/dev/null` = xok && break
+   test x`echo ok|(exec 3<&0; cat $zsh_cv_sys_path_dev_fd/3 2>/dev/null;)` = xok && break
  done])
 if test $zsh_cv_sys_path_dev_fd != no; then
   AC_DEFINE_UNQUOTED(PATH_DEV_FD, "$zsh_cv_sys_path_dev_fd")


-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page still at http://www.pwstephenson.fsnet.co.uk/

