From zsh-workers-request@math.gatech.edu Thu Nov 12 17:08:55 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28907 invoked from network); 12 Nov 1998 17:08:54 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 12 Nov 1998 17:08:54 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id MAA08160;
	Thu, 12 Nov 1998 12:00:39 -0500 (EST)
Resent-Date: Thu, 12 Nov 1998 12:00:39 -0500 (EST)
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <981112085514.ZM11755@candle.brasslantern.com>
Date: Thu, 12 Nov 1998 08:55:14 -0800
In-Reply-To: <9811121312.AA39762@ibmth.df.unipi.it>
Comments: In reply to Peter Stephenson <pws@ibmth.df.unipi.it>
        "PATCH: 3.1.5: bad handling of 8 bit character" (Nov 12,  2:12pm)
References: <9811121312.AA39762@ibmth.df.unipi.it>
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: Peter Stephenson <pws@ibmth.df.unipi.it>,
        zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: Re: PATCH: 3.1.5: bad handling of 8 bit character
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"4Ifxc1.0.R_1.tGnIs"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4616
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On Nov 12,  2:12pm, Peter Stephenson wrote:
} Subject: PATCH: 3.1.5: bad handling of 8 bit character
}
} I suspect this was my fault last time I fiddled with input.c.  It only
} shows up on machines where char is signed, so I didn't notice it.  At
} least, this seems to do the trick for SUNOS, where I was seeing the
} problem.
} 
}   int
}   ingetc(void)
}   {
} !     int lastc;
}   
}       if (lexstop)
}   	return ' ';

I'm confused.  I have this patch applied to 3.0.5:

 PWS's patch from zsh-workers 4172 to eliminate the `lastc' global
 and thereby clean up some goofy history management and a couple of
 unexpected exits.

That means that my 3.0.5-extended has `char lastc;' in ingetc() as well.
Yet 3.0.5-extended still manages to get the 8-bit characters right, even
though 3.1.5 built on the same machine gets it wrong.

What *else* changed in 3.1.5 to make it sensitive to this?

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

