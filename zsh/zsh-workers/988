From hzoli@cs.elte.hu Tue May  7 11:37:53 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3) with ESMTP id LAA04185 for <mason@werple.mira.net.au>; Tue, 7 May 1996 11:37:51 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id VAA03605; Mon, 6 May 1996 21:23:33 -0400 (EDT)
Resent-Date: Mon, 6 May 1996 21:23:33 -0400 (EDT)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199605070123.DAA07655@bolyai.cs.elte.hu>
Subject: Re: Compilation on Ultrix cc
To: hniksic@public.srce.hr
Date: Tue, 7 May 1996 03:23:37 +0200 (MET DST)
Cc: zsh-workers@math.gatech.edu
In-Reply-To: <199605062254.AAA09143@jagor.srce.hr> from Hrvoje Niksic at "May 7, 96 00:54:40 am"
Organization: Dept. of Comp. Sci., Eotvos University, Budapest, Hungary
Phone: (36 1)2669833 ext: 2667, home phone: (36 1) 2752368
X-Mailer: ELM [version 2.4ME+ PL16 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"B1rx-2.0.Cu.LOgZn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/988
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 1774
Status: O

> I had problems compiling zsh on Ultrix 4.2 with cc.

Which version?

> 1. configure determined that the compiler is non-ANSI, which is true enough,
> but ansi2knr is still unnecessary since all it does is converting the
> function declarations to ANSI-style, and the cc can handle them.

No. ansi2knr converts ANSI-style code to K&R style code.  Ultrix cc does
not understand ANSI.

> 2. In several places the name of a variable is the same as the name of a cpp
> macro. The newer cpp-s ignore the variable, whereas the Ultrix cpp gives a
> warning, but still makes the substitution with an empty argument. This
> prevents the compilation of builtin.c (because of iword macro/variables) and
> zle_tricky.c (because of nonempty macro/variables). The solution is to
> rename either the macro or the variables in both cases. Note that
> zle_tricky.c uses both forms of nonempty.

Could you be a bit more specific here?  Which macro and which wariable
causes the problem?  If you have a fix please send the patch to the list.

I admit that Ultrix cc does not work with beta17.  It uses some very stupid
and broken cpp.

c89 is probably capable to compile zsh but I'll check this tomorrow.  And I
did compile zsh with gcc on Ultix 4.2.

> 3. glob.c contains the things that make Ultrix compiler happy wrapped within
> #ifdef ULTRIX. However, the Ultrix cc defines only ultrix (lower-case),
> which is why a %s/ULTRIX/ultrix is welcome in glob.c. Without it, glob.c
> will not compile.

It seems to me that the code in the #ifdef ULTRIX part can be used on all
systems.  Does anyone know why is there this ULTRIX check?  We can define
the Statptr type on all systems and use it instead of struct stat *.  Or is
there some other compiler which does not like this?

Bye,

Zoltan


