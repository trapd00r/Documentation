From zsh-workers-return-18327-mason-zsh=primenet.com.au@sunsite.dk Fri Mar 07 15:09:00 2003
Return-Path: <zsh-workers-return-18327-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5934 invoked from network); 7 Mar 2003 15:08:59 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 7 Mar 2003 15:08:59 -0000
Received: (qmail 5769 invoked by alias); 7 Mar 2003 15:08:52 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18327
Received: (qmail 5762 invoked from network); 7 Mar 2003 15:08:51 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 7 Mar 2003 15:08:51 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [62.189.183.235] by sunsite.dk (MessageWall 1.0.8) with SMTP; 7 Mar 2003 15:8:50 -0000
Received: from exchange01.csr.com (unverified) by 
 (Content Technologies SMTPRS 4.2.1) with ESMTP id <T60d576881bc0a88d01568@> for <zsh-workers@sunsite.dk>;
 Fri, 7 Mar 2003 15:16:15 +0000
Received: from csr.com (tinky-winky.csr.com [192.168.144.127]) by exchange01.csr.com with SMTP (Microsoft Exchange Internet Mail Service Version 5.5.2650.21)
	id DQ47P8KA; Fri, 7 Mar 2003 15:08:43 -0000
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: PATCH: add preserve-prefix to compinstall
Date: Fri, 07 Mar 2003 15:08:48 +0000
Message-ID: <15356.1047049728@csr.com>
From: Peter Stephenson <pws@csr.com>

This adds preserve-prefix handling to compinstall's file section,
because I only just discovered it stopped me needing fake-files under
Cygwin.

Index: Completion/compinstall
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/compinstall,v
retrieving revision 1.6
diff -u -r1.6 compinstall
--- Completion/compinstall	9 Oct 2001 11:17:05 -0000	1.6
+++ Completion/compinstall	7 Mar 2003 15:06:34 -0000
@@ -1529,7 +1529,7 @@
 #       squeeze-slashes,
 __ci_do_file_styles() {
   local key files cursor expand speciald ignorep squeezes select
-  local prefon suffon lssuffixes
+  local prefon suffon lssuffixes preserve
 
   __ci_get_this_style file-sort files
   __ci_get_this_style ignore-parents ignorep
@@ -1537,6 +1537,8 @@
   __ci_get_this_style squeeze-slashes squeezes
   __ci_get_this_style expand expand
   __ci_get_this_style list-suffixes lssuffixes
+  __ci_get_this_style preserve-prefix preserve
+  [[ -n $preserve ]] && preserve=${(Q)preserve}
 
   while true; do
     clear
@@ -1554,6 +1556,8 @@
 5.  Configure how multiple paths are expanded and displayed, 
     e.g. /f/b -> /foo/bar
 
+6.  Keep certain prefixes unchanged, such as \`//resource/'.
+
 q.  Return without saving.
 0.  Done setting options for filename completion.
 "
@@ -1729,6 +1733,21 @@
 	    ([nN]) lssuffixes=;;
 	  esac
 	  ;;
+      (6) print "\
+On some systems, there are special forms for the start of a filename
+which should be left alone by the completion system.  For example, Cygwin
+uses a double slash to indicate a network resource, hence a prefix of
+the form \`//resource/' should be left alone.  This style gives a pattern
+to match any such prefixes; alternatives separated by \`|' are therefore
+possible.  Edit the pattern as you like.  If this is empty, the shell will not
+handle any prefixes specially."
+          if [[ -z $preserve ]]; then
+	      preserve="//[^/]##/"
+	      print "
+Accept the default to handle network resources as just described."
+	  fi
+	  vared -eh -p "pattern> " preserve
+	  ;;
       (q) return 1
 	 ;;
     esac
@@ -1741,6 +1760,9 @@
   __ci_set_this_style squeeze-slashes squeezes
   __ci_set_this_style expand expand
   __ci_set_this_style list-suffixes lssuffixes
+  # pattern, always quote
+  [[ -n $preserve ]] && preserve=${(qq)preserve}
+  __ci_set_this_style preserve-prefix preserve
 
   return 0
 }

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR Ltd., Science Park, Milton Road,
Cambridge, CB4 0WH, UK                          Tel: +44 (0)1223 692070


**********************************************************************
The information transmitted is intended only for the person or
entity to which it is addressed and may contain confidential 
and/or privileged material. 
Any review, retransmission, dissemination or other use of, or
taking of any action in reliance upon, this information by 
persons or entities other than the intended recipient is 
prohibited.  
If you received this in error, please contact the sender and 
delete the material from any computer.
**********************************************************************

