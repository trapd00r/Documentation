From zsh-users-return-14368-mason-zsh=primenet.com.au@sunsite.dk Mon Sep 14 19:48:33 2009
Return-Path: <zsh-users-return-14368-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20668 invoked from network); 14 Sep 2009 19:48:29 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 14 Sep 2009 19:48:29 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 43510 invoked from network); 14 Sep 2009 19:48:22 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 14 Sep 2009 19:48:22 -0000
Received: (qmail 6035 invoked by alias); 14 Sep 2009 19:48:05 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 14368
Received: (qmail 5983 invoked from network); 14 Sep 2009 19:48:04 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 14 Sep 2009 19:48:04 -0000
Received: from smtp.benizi.com (www5.pairlite.com [64.130.10.15])
	by bifrost.dotsrc.org (Postfix) with ESMTP id C8AEB8026E39
	for <zsh-users@sunsite.dk>; Mon, 14 Sep 2009 21:47:57 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp.benizi.com (Postfix) with ESMTPSA id D91702B059;
	Mon, 14 Sep 2009 15:49:03 -0400 (EDT)
Date: Mon, 14 Sep 2009 15:49:03 -0400 (EDT)
From: "Benjamin R. Haskell" <zsh@benizi.com>
To: Zsh Users <zsh-users@sunsite.dk>
Subject: Re: compinit and promptinit fail on virtual terminal
In-Reply-To: <4AAE9931.9030106@tu-bs.de>
Message-ID: <alpine.LNX.2.01.0909141535240.2540@hp.internal>
References: <4AAE9931.9030106@tu-bs.de>
User-Agent: Alpine 2.01 (LNX 1266 2009-07-14)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Virus-Scanned: ClamAV 0.94.2/9806/Mon Sep 14 20:37:58 2009 on bifrost
X-Virus-Status: Clean

On Mon, 14 Sep 2009, Stephan Friedrichs wrote:

> Hi,
> 
> whenever I start zsh in gnome-terminal or xterm, I get this error:
> 
> 
>  /home/igel/.zshrc:2: compinit: function definition file not found
>  /home/igel/.zshrc:3: promptinit: function definition file not found
>  /home/igel/.zshrc:3: command not found: prompt
> 
> 
> The funny thing is, that when starting zsh on a TTY, (or via 'su' in a
> 'screen' on a virtual terminal) it works just fine. A simple .zshrc to
> reproduce the problem looks like this:
> 
> 
>  autoload -U compinit promptinit
>  compinit
>  promptinit; prompt gentoo
> 
> 
> I have no clue about the origin of the error, there have been no updates
>  of zsh itself, zsh-completion or the terminals. I never modified
> /etc/zsh/zprofile. The error just started happening after a reboot.
> Rebuilding zsh didn't help.

If it helps narrow it down, I don't have this problem on Gentoo (also 
amd64) w/ app-shells/zsh-4.3.10.  But a difference is that I don't have 
zsh-completion installed (I use paludis, not portage).

I noticed that zsh-completion has a version number of '20080310', which 
predates the release of both 4.3.9 and 4.3.10 (so your downgrade to 4.3.9 
might not have avoided some interaction between the two).  Try backing off 
to 4.3.6 to see if it still occurs [scratch that, try 4.3.4-r1; even 4.3.6 
was late March, 2008].  Maybe just try removing zsh-completion entirely, 
to see if it's the problem.

Otherwise, my question would be, what other .zsh files might you have?  I 
didn't pare it down to the minimal .zshrc you posted (I've got too much 
else going on in mine), but your first post on the Gentoo forum thread 
looked like it was searching in .config/zsh/modules in your home 
directory, which seems odd to me.

Best,
Ben

