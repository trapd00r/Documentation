From zsh-workers-request@euclid.skiles.gatech.edu  Mon Jul 29 08:05:13 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by coral.primenet.com.au (8.7.5/8.7.3) with ESMTP id IAA01542 for <mason@primenet.com.au>; Mon, 29 Jul 1996 08:05:11 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id RAA04842; Sun, 28 Jul 1996 17:47:43 -0400 (EDT)
Resent-Date: Sun, 28 Jul 1996 17:47:43 -0400 (EDT)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199607282145.XAA03101@hzoli.ppp.cs.elte.hu>
Subject: Re: setopt globcomplete screws up accept-and-menu-complete
To: schaefer@nbn.com
Date: Sun, 28 Jul 1996 23:45:23 +0200 (MET DST)
Cc: zsh-workers@math.gatech.edu
In-Reply-To: <960715230556.ZM1690@candle.brasslantern.com> from Bart Schaefer at "Jul 15, 96 11:05:55 pm"
X-Mailer: ELM [version 2.4ME+ PL17 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"BO_LS.0.aB1.-_z-n"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1805
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Bart wrote:
> automenu            on
> completealiases     off
> completeinword      on
> globcomplete        on
> menucomplete        off
> 
> "^X^I"  accept-and-menu-complete

[...]

> zagzig[72] ls -l z*<TAB><TAB>
> zagzig[72] ls -l zle_bindings.c<C-x><TAB>
> zagzig[72] ls -l zle_bindings.c z\*zle_bindings.pro

The fix is included below.

Zoltan


--- zle_tricky.c	1996/07/28 21:09:40	2.68
+++ zle_tricky.c	1996/07/28 21:33:16
@@ -353,9 +353,9 @@
     inststrlen(" ", 1, 1);
     if (qparampre)
 	inststrlen(qparampre, 1, qparprelen);
-    if (lpre)
+    if (lpre && !ispattern)
 	inststrlen(lpre, 1, -1);
-    if (lsuf)
+    if (lsuf && !ispattern)
 	inststrlen(lsuf, 0, -1);
     menupos = cs;
     menuend = cs + (lsuf ? strlen(lsuf) : 0);

