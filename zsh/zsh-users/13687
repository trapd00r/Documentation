From zsh-users-return-13687-mason-zsh=primenet.com.au@sunsite.dk Fri Jan 09 12:00:29 2009
Return-Path: <zsh-users-return-13687-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24848 invoked from network); 9 Jan 2009 12:00:16 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.3 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 9 Jan 2009 12:00:16 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 5663 invoked from network); 9 Jan 2009 12:00:04 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 Jan 2009 12:00:04 -0000
Received: (qmail 17282 invoked by alias); 9 Jan 2009 11:59:47 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13687
Received: (qmail 17267 invoked from network); 9 Jan 2009 11:59:46 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 9 Jan 2009 11:59:46 -0000
Received: from cluster-d.mailcontrol.com (cluster-d.mailcontrol.com [85.115.60.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 3E12A80293D3
	for <zsh-users@sunsite.dk>; Fri,  9 Jan 2009 12:59:42 +0100 (CET)
Received: from rly21d.srv.mailcontrol.com (localhost.localdomain [127.0.0.1])
	by rly21d.srv.mailcontrol.com (MailControl) with ESMTP id n09BxJv4003371
	for <zsh-users@sunsite.dk>; Fri, 9 Jan 2009 11:59:40 GMT
Received: from submission.mailcontrol.com (submission.mailcontrol.com [86.111.216.190])
	by rly21d.srv.mailcontrol.com (MailControl) id n09BwuZl032241
	for zsh-users@sunsite.dk; Fri, 9 Jan 2009 11:58:56 GMT
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly21d-eth0.srv.mailcontrol.com (envelope-sender Peter.Stephenson@csr.com) (MIMEDefang) with ESMTP id n09Bw78c030113; Fri, 09 Jan 2009 11:58:55 +0000 (GMT)
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Fri, 9 Jan 2009 11:58:30 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.2/8.13.4) with ESMTP id n09BwPti006843;
	Fri, 9 Jan 2009 11:58:25 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.2/8.14.2/Submit) with ESMTP id n09BwPii006839;
	Fri, 9 Jan 2009 11:58:25 GMT
Message-Id: <200901091158.n09BwPii006839@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: "Richard Hartmann" <richih.mailinglist@gmail.com>
cc: "Zsh Users" <zsh-users@sunsite.dk>
Subject: Re: Getting the CVS revision of Zsh
In-reply-to: <2d460de70901090348t3ea9e25fi29a7165ee42ae5e5@mail.gmail.com>
References: <2d460de70901090301h6b309a7cm19c5ebfec989ff2c@mail.gmail.com> <200901091121.n09BLVvZ006382@news01.csr.com> <2d460de70901090348t3ea9e25fi29a7165ee42ae5e5@mail.gmail.com>
Comments: In-reply-to "Richard Hartmann" <richih.mailinglist@gmail.com>
   message dated "Fri, 09 Jan 2009 12:48:04 +0100."
Date: Fri, 09 Jan 2009 11:58:25 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 09 Jan 2009 11:58:30.0599 (UTC) FILETIME=[96E09D70:01C97251]
X-Scanned-By: MailControl A_08_51_00 (www.mailcontrol.com) on 10.68.1.131
X-Virus-Scanned: ClamAV 0.92.1/8847/Fri Jan  9 11:51:11 2009 on bifrost
X-Virus-Status: Clean

"Richard Hartmann" wrote:
> On Fri, Jan 9, 2009 at 12:21, Peter Stephenson <pws@csr.com> wrote:
> 
> >  cvs status ChangeLog | awk '/Working revision:/ { print $3 }'
> >
> > to a variable such as $ZSH_PATCHLEVEL.  However, this needs careful
> > handling to make sure it doesn't get run where CVS isn't available.
> 
> I would prefer a file like zsh-revision to be introduced (and synced
> from a CVS hook). That way, the information would make it both into
> tarballs and the various git repositories cloned from the CVS one.
> This file could then be read at compile-time.

If I were doing it, the output would go into zsh_patchlevel.h
which would be distributed and then #include'd where necessary.  The
trick is regenerating that file at the right point and only at the right
point.

Arranging for this always to be updated in CVS on all commits is another
job I would leave to someone else, but provided you "make" and re-commit
it will work.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

