From zsh-workers-return-22071-mason-zsh=primenet.com.au@sunsite.dk Mon Dec 12 14:14:23 2005
Return-Path: <zsh-workers-return-22071-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13652 invoked from network); 12 Dec 2005 14:14:21 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO,
	UNPARSEABLE_RELAY autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 12 Dec 2005 14:14:21 -0000
Received: (qmail 77399 invoked from network); 12 Dec 2005 14:14:15 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 12 Dec 2005 14:14:15 -0000
Received: (qmail 1420 invoked by alias); 12 Dec 2005 14:14:12 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22071
Received: (qmail 1409 invoked from network); 12 Dec 2005 14:14:12 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 12 Dec 2005 14:14:12 -0000
Received: (qmail 77143 invoked from network); 12 Dec 2005 14:14:11 -0000
Received: from rcpt-expgw.biglobe.ne.jp (202.225.89.178)
  by a.mx.sunsite.dk with SMTP; 12 Dec 2005 14:14:10 -0000
Received: from smtp-gw.biglobe.ne.jp
	by rcpt-expgw.biglobe.ne.jp (mssh/3613031104) with ESMTP id jBCEE8sb027119
	for <zsh-workers@sunsite.dk>; Mon, 12 Dec 2005 23:14:08 +0900 (JST)
X-Biglobe-Sender: <takimoto-j@kba.biglobe.ne.jp>
Received: from [133.24.86.96] (133.24.86.96 [133.24.86.96]) by smtp-gw.biglobe.ne.jp
	id XBARC0A8274E; Mon, 12 Dec 2005 23:14:07 +0900 (JST)
Mime-Version: 1.0
X-Mailer: QUALCOMM MacOS X Eudora Version 6.2J rev3.1
Message-Id: <a06001005bfc334dcc101@kba.biglobe.ne.jp>
Date: Mon, 12 Dec 2005 23:14:05 +0900
To: zsh-workers@sunsite.dk
From: "Jun T." <takimoto-j@kba.biglobe.ne.jp>
Subject: 4.3.0-dev-2 BUG: negative cursor position
Content-Type: text/plain; charset="us-ascii"

Hi zsh-workers,

Is this the right place to report a zsh bug?

I tried 4.3.0-dev-2 with --enable-zsh-debug.

old-zsh% /usr/local/bin/zsh -f
new-zsh% bindkey -v
new-zsh% <ESC>kj

Here, <ESC> is to go into the vi-command mode.
Then I hit 'k' to go up in history stack; it worked as expected.
Then I hit 'j' to go down in the stack, but I get the following message:

BUG: negative cursor position

With gdb, I found that zlecs becomes negative at line 674 of zle_hist.c.
Replacing

    if (invicmdmode())

by

    if (zlecs > findbol() && invicmdmode())

"apparently" fixed the problems but I know NOTHING about the zsh source code.

