From zsh-users-return-15427-mason-zsh=primenet.com.au@zsh.org Fri Sep 24 02:07:20 2010
Return-Path: <zsh-users-return-15427-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24203 invoked by alias); 24 Sep 2010 02:07:20 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15427
Received: (qmail 24854 invoked from network); 24 Sep 2010 02:07:17 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-0.9 required=5.0 tests=BAYES_00,PLING_QUERY,
	RCVD_IN_DNSWL_NONE autolearn=no version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at closedmail.com does not designate permitted sender hosts)
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <100923190658.ZM3356@torch.brasslantern.com>
Date: Thu, 23 Sep 2010 19:06:58 -0700
In-reply-to: <alpine.LNX.2.01.1009231557130.4754@hp>
Comments: In reply to "Benjamin R. Haskell" <zsh@benizi.com>
 "!$ changes when mistyped?" (Sep 23,  4:22pm)
References: <alpine.LNX.2.01.1009231557130.4754@hp>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: Zsh Users <zsh-users@zsh.org>
Subject: Re: !$ changes when mistyped?
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii

On Sep 23,  4:22pm, Benjamin R. Haskell wrote:
}
} Is this behavior expected -- should history expansion/completion 
} (terminology?)  change what '!$' references?  If so, is it configurable?

Quoth the documentation:

--- 8< ---
By default, a history reference with no event designator refers to the
same event as any preceding history reference on that command line; if
it is the only history reference in a command, it refers to the previous
command.  However, if the option CSH_JUNKIE_HISTORY is set, then every
history reference with no event specification _always_ refers to the
previous command.

For example, `!' is the event designator for the previous command, so
`!!:1' always refers to the first word of the previous command, and
`!!$' always refers to the last word of the previous command.  With
CSH_JUNKIE_HISTORY set, then `!:1' and `!$' function in the same manner
as `!!:1' and `!!$', respectively.  Conversely, if CSH_JUNKIE_HISTORY
is unset, then `!:1' and `!$' refer to the first and last words,
respectively, of the same event referenced by the nearest other history
reference preceding them on the current command line, or to the
previous command if there is no preceding reference.
--- 8< ---

What the doc doesn't say, but which is true, is that history references
expanded by magic-space or completion are considered "the nearest other
history reference preceding" for this purpose.

Hence you probably want CSH_JUNKIE_HISTORY.

