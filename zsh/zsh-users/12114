From zsh-users-return-12114-mason-zsh=primenet.com.au@sunsite.dk Thu Oct 25 15:18:03 2007
Return-Path: <zsh-users-return-12114-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8866 invoked from network); 25 Oct 2007 15:17:55 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 Oct 2007 15:17:55 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 62150 invoked from network); 25 Oct 2007 15:17:48 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 25 Oct 2007 15:17:48 -0000
Received: (qmail 27588 invoked by alias); 25 Oct 2007 15:17:39 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12114
Received: (qmail 27441 invoked from network); 25 Oct 2007 15:17:37 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 25 Oct 2007 15:17:37 -0000
Received: (qmail 60149 invoked from network); 25 Oct 2007 15:17:37 -0000
Received: from smtp.ctxuk.citrix.com (HELO SMTP.EU.CITRIX.COM) (62.200.22.115)
  by a.mx.sunsite.dk with SMTP; 25 Oct 2007 15:17:29 -0000
X-IronPort-AV: E=Sophos;i="4.21,328,1188792000"; 
   d="scan'208";a="11525660"
Received: from lonpexchmx01.citrite.net ([10.30.224.191])
  by LONPIPO01.EU.CITRIX.COM with ESMTP; 25 Oct 2007 11:17:27 -0400
Received: from lonpexch01.citrite.net ([10.30.224.136]) by lonpexchmx01.citrite.net with Microsoft SMTPSVC(6.0.3790.1830);
	 Thu, 25 Oct 2007 16:16:28 +0100
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Slow compdump on Vista - no .zcompdump created
Date: Thu, 25 Oct 2007 16:16:17 +0100
Message-ID: <DD74FBB8EE28D441903D56487861CD9D228364FA@lonpexch01.citrite.net>
In-Reply-To: <DD74FBB8EE28D441903D56487861CD9D22835ED2@lonpexch01.citrite.net>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Slow compdump on Vista - no .zcompdump created
thread-index: AcgW9CoahtrZg5c1RGuI2vHi0mpCKAAAx9SQAAiLuyA=
References: <DD74FBB8EE28D441903D56487861CD9D22719534@lonpexch01.citrite.net> <016801c8164c$301c5d70$90551850$@com> <DD74FBB8EE28D441903D56487861CD9D2271979B@lonpexch01.citrite.net> <018501c81658$6beebbc0$43cc3340$@com> <DD74FBB8EE28D441903D56487861CD9D2271A057@lonpexch01.citrite.net> <200710251044.l9PAi9Ag016224@news01.csr.com> <DD74FBB8EE28D441903D56487861CD9D22835ED2@lonpexch01.citrite.net>
From: "John Cooper" <John.Cooper@citrix.com>
To: "John Cooper" <John.Cooper@citrix.com>,
	"Peter Stephenson" <pws@csr.com>,
	"Zsh Users" <zsh-users@sunsite.dk>
X-OriginalArrivalTime: 25 Oct 2007 15:16:28.0360 (UTC) FILETIME=[03FD9C80:01C8171A]

Presumably other people using Cygwin will also experience this minor
problem (.zcompdump not being created).

Another workaround that avoids modifying the compdump function is to
"chmod +w ~".
Still, perhaps the check in compdump should be removed (or changed to
test the directory exists?) when running on Cygwin so that this works
out of the box.

    --- John.

-----Original Message-----
From: John Cooper=20
Sent: 25 October 2007 12:13
To: Peter Stephenson; Zsh Users
Cc: John Cooper
Subject: RE: Slow compdump on Vista - no .zcompdump created

For some reason the following line in compdump causes compdump to return
too early:
  [[ -w ${_d_file:h} ]] || return 1

Commenting out this line resolves the problem: .zcompdump is created and
compinit now runs in less than a second.

For me, the above line was being executed with the following path:
  +compdump:24> [[ -w /c/Users/johnc.CITRITE/Documents ]]

I can create files in this directory:
  $ touch /c/Users/johnc.CITRITE/Documents/foo=20
  $

.. although Cygwin seems to think it is not writeable:
  $ ls -ld /c/Users/johnc.CITRITE/Documents

  dr-x------+ 16 johnc mkpasswd 16384 Oct 25 12:10
/c/Users/johnc.CITRITE/Documents/

    --- John.


-----Original Message-----
From: Peter Stephenson [mailto:pws@csr.com]=20
Sent: 25 October 2007 11:44
To: Zsh Users
Subject: Re: Slow compdump on Vista - no .zcompdump created

"John Cooper" wrote:
> Still, it does seem odd that .zcompdump is not created by default.
> Presumably, if it were, compinit would likely run in a fraction of a
> second?
> Does anyone know why .zcompdump might not be getting created on
Cygwin,
> and whether I can force it?

Run "compdump" with "set -x" in effect (you'll probably have to add it
to the first "setopt" in the file) and see why it's not running the
"compdump" around line 493, or if it is why that's not doing anything.

You should be able to force a dump with "compinit -d", which takes an
option file argument to use for dumping.

--=20
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

