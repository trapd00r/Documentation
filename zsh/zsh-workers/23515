From zsh-workers-return-23515-mason-zsh=primenet.com.au@sunsite.dk Mon Jun 04 01:29:19 2007
Return-Path: <zsh-workers-return-23515-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11112 invoked from network); 4 Jun 2007 01:29:17 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.0 (2007-05-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=no
	version=3.2.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 4 Jun 2007 01:29:17 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 27373 invoked from network); 4 Jun 2007 01:29:11 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Jun 2007 01:29:11 -0000
Received: (qmail 12924 invoked by alias); 4 Jun 2007 01:29:09 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23515
Received: (qmail 12914 invoked from network); 4 Jun 2007 01:29:08 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 4 Jun 2007 01:29:08 -0000
Received: (qmail 27088 invoked from network); 4 Jun 2007 01:29:08 -0000
Received: from redoubt.spodhuis.org (HELO mx.spodhuis.org) (193.202.115.177)
  by a.mx.sunsite.dk with SMTP; 4 Jun 2007 01:29:04 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws; s=first1; d=spodhuis.org;
	h=Received:Date:From:To:Subject:Message-ID:Mail-Followup-To:MIME-Version:Content-Type:Content-Disposition;
	b=AtUiwgzpKPbEbPiy77sfHCfEyFHazF8I0AtDX2jb7EhXq3+6YKZLOBTcq+ywIbxFPPWxSV5Ur5dm2Lo0HPJo2iqlVzTEvqWIDajnSIAdABja1tyxvoNeYOfp1Qw02qMMZzSt8P4y7I9tvXPTbzO4AhUOaSyPWll0x6EdBpMhu10=;
Received: by smtp.spodhuis.org with local 
	id 1Hv1NY-000OeB-AQ; Mon, 04 Jun 2007 01:29:04 +0000
Date: Sun, 3 Jun 2007 18:29:04 -0700
From: Phil Pennock <zsh-workers+phil.pennock@spodhuis.org>
To: zsh-workers@sunsite.dk
Subject: help?  configure, non-standard prefix, linkage
Message-ID: <20070604012904.GA94660@redoubt.spodhuis.org>
Mail-Followup-To: zsh-workers@sunsite.dk
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

I build test instances of zsh to install into --prefix=$HOME/dbg, a
hierarchy which I can safely annihilate at any time.  I manually force
in /usr/local/lib/ as a library search path so that libiconv is
available.

I also apply any autotools updates which FreeBSD's Ports collection
offers, as this normally reduces pain of the "your framework of hacks
upon hacks is too old, nyer nyer nyer" variety.  I especially come
up-to-date on these before installing security updates.  Being silly and
trusting, and valuing my time, I didn't regression-test build everything
after each individual update.

At some point, "something" has changed the linkage flags passed to zsh,
so that it's specifying the system LDFLAGS -L/usr/local/lib to the build
twice, the second time as a linker -Wl,-R/usr/local/lib; this means that
a zsh installed into ~/dbg can't find libzsh.

I've searched back through zsh CVS and it's now "broken" for versions
which previously installed fine, so I don't think that this is zsh
breakage.  It's something in my build environment.  I'm hoping that
someone here with more experience of autotools can point me at what I've
broken.  I've tried using v259 instead of v261 but whatever's changed is
broken in both.

Thanks,
-Phil

----------------------------8< cut here >8------------------------------
sed -i.bak '/auto/s/$/261/' .preconfig
sh ./.preconfig
zbuildopts=(
        --build=amd64-phil-freebsd62
        --with-curses-terminfo --with-tcsetpgrp
        --enable-etcdir=/etc --enable-function-subdirs
        --enable-zsh-mem --enable-zsh-secure-free
        --enable-zsh-debug --enable-zsh-mem-debug
        --enable-dynamic
        --enable-multibyte
        --enable-pcre
        --enable-site-fndir=/usr/local/share/zsh/site-functions
        )
CPPFLAGS=-I/usr/local/include LDFLAGS=-L/usr/local/lib \
./configure $zbuildopts --prefix=$HOME/dbg \
        --enable-fndir=$HOME/dbg/share/zsh/zsh-phil-4.3.4/functions
----------------------------8< cut here >8------------------------------

