From zsh-workers-return-21302-mason-zsh=primenet.com.au@sunsite.dk Thu Jun 02 13:31:22 2005
Return-Path: <zsh-workers-return-21302-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19518 invoked from network); 2 Jun 2005 13:31:20 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 2 Jun 2005 13:31:20 -0000
Received: (qmail 45866 invoked from network); 2 Jun 2005 13:31:15 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 2 Jun 2005 13:31:15 -0000
Received: (qmail 27870 invoked by alias); 2 Jun 2005 13:31:11 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21302
Received: (qmail 27851 invoked from network); 2 Jun 2005 13:31:10 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 2 Jun 2005 13:31:10 -0000
Received: (qmail 45558 invoked from network); 2 Jun 2005 13:31:10 -0000
Received: from grunt22.ihug.com.au (203.109.249.142)
  by a.mx.sunsite.dk with SMTP; 2 Jun 2005 13:31:03 -0000
Received: from 203-217-64-202.dyn.iinet.net.au (localhost.localdomain) [203.217.64.202] 
	by grunt22.ihug.com.au with esmtp (Exim 3.35 #1 (Debian))
	id 1DdpmP-0002RB-00; Thu, 02 Jun 2005 23:30:38 +1000
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.12.8/8.12.8) with ESMTP id j52DPLZa013824
	for <zsh-workers@sunsite.dk>; Thu, 2 Jun 2005 23:25:22 +1000
Received: (from doug@localhost)
	by localhost.localdomain (8.12.8/8.12.8/Submit) id j52DPJuu013822
	for zsh-workers@sunsite.dk; Thu, 2 Jun 2005 23:25:19 +1000
X-Authentication-Warning: localhost.localdomain: doug set sender to dougkearns@gmail.com using -f
Date: Thu, 2 Jun 2005 23:25:19 +1000
From: Doug Kearns <dougkearns@gmail.com>
To: zsh-workers@sunsite.dk
Subject: PATCH: expl not always local
Message-ID: <20050602132519.GA10266@localhost.localdomain>
Mail-Followup-To: zsh-workers@sunsite.dk
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4i
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

Some completion functions aren't declaring expl as local. There may be
others that I've missed with this quick pass...

Regards,
Doug

Index: Linux/Command/_pkgtool
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Linux/Command/_pkgtool,v
retrieving revision 1.5
diff -u -r1.5 _pkgtool
--- Linux/Command/_pkgtool	21 Jan 2004 13:53:29 -0000	1.5
+++ Linux/Command/_pkgtool	2 Jun 2005 13:15:10 -0000
@@ -1,5 +1,7 @@
 #compdef installpkg upgradepkg removepkg pkgtool explodepkg makepkg 
 
+local expl
+
 case "$service" in
   installpkg)
     _arguments \
Index: Unix/Command/_ant
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_ant,v
retrieving revision 1.11
diff -u -r1.11 _ant
--- Unix/Command/_ant	2 Jun 2005 10:32:29 -0000	1.11
+++ Unix/Command/_ant	2 Jun 2005 13:15:13 -0000
@@ -2,7 +2,7 @@
 
 # Apache Ant version 1.6.4
 
-local curcontext="$curcontext" state line ret=1
+local curcontext="$curcontext" state line expl ret=1
 typeset -A opt_args
 local buildfile classpath cp userjars importedfiles target='*:target:->target' targets tmp
 
Index: Unix/Command/_bogofilter
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_bogofilter,v
retrieving revision 1.5
diff -u -r1.5 _bogofilter
--- Unix/Command/_bogofilter	27 Dec 2004 17:06:16 -0000	1.5
+++ Unix/Command/_bogofilter	2 Jun 2005 13:15:14 -0000
@@ -1,6 +1,6 @@
 #compdef bogoutil bogotune bogofilter
 
-local ret bogotokens
+local expl ret bogotokens
 
 _bogoutil_caching_policy () {
 
Index: Unix/Command/_cdrecord
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_cdrecord,v
retrieving revision 1.4
diff -u -r1.4 _cdrecord
--- Unix/Command/_cdrecord	14 Apr 2004 08:11:21 -0000	1.4
+++ Unix/Command/_cdrecord	2 Jun 2005 13:15:25 -0000
@@ -1,6 +1,6 @@
 #compdef cdrecord
 
-local curcontext="$curcontext" state line ret=1
+local curcontext="$curcontext" state line expl ret=1
 local devices btypes
 
 _arguments -C \
Index: Unix/Command/_chkconfig
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_chkconfig,v
retrieving revision 1.2
diff -u -r1.2 _chkconfig
--- Unix/Command/_chkconfig	8 May 2002 09:18:13 -0000	1.2
+++ Unix/Command/_chkconfig	2 Jun 2005 13:15:25 -0000
@@ -1,6 +1,6 @@
 #compdef chkconfig
 
-local curcontext="$curcontext" state line ret=1
+local curcontext="$curcontext" state line expl ret=1
 
 case $OSTYPE in
 linux*)
Index: Unix/Command/_chmod
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_chmod,v
retrieving revision 1.1
diff -u -r1.1 _chmod
--- Unix/Command/_chmod	1 Aug 2003 11:47:41 -0000	1.1
+++ Unix/Command/_chmod	2 Jun 2005 13:15:25 -0000
@@ -1,6 +1,6 @@
 #compdef chmod
 
-local curcontext="$curcontext" state line ret=1
+local curcontext="$curcontext" state line expl ret=1
 local -a args privs
 
 args=( '*:file:->files' )
Index: Unix/Command/_gs
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_gs,v
retrieving revision 1.2
diff -u -r1.2 _gs
--- Unix/Command/_gs	16 Apr 2002 07:48:46 -0000	1.2
+++ Unix/Command/_gs	2 Jun 2005 13:15:25 -0000
@@ -8,7 +8,7 @@
     return 1
   fi
 else
-  local curcontext="$curcontext" state line ret=1
+  local curcontext="$curcontext" state line expl ret=1
   typeset -A opt_args
 
   _x_arguments -C \
Index: Unix/Command/_look
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_look,v
retrieving revision 1.3
diff -u -r1.3 _look
--- Unix/Command/_look	25 Jun 2003 09:03:06 -0000	1.3
+++ Unix/Command/_look	2 Jun 2005 13:15:25 -0000
@@ -1,6 +1,6 @@
 #compdef look
 
-local curcontext="$curcontext" state line ret=1
+local curcontext="$curcontext" state line expl ret=1
 typeset -A opt_args
 
 _arguments -C -s \
Index: Unix/Command/_mount
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_mount,v
retrieving revision 1.20
diff -u -r1.20 _mount
--- Unix/Command/_mount	11 May 2005 09:27:10 -0000	1.20
+++ Unix/Command/_mount	2 Jun 2005 13:15:35 -0000
@@ -39,7 +39,7 @@
 # arguments for the `mount' command for different operating systems
 # are below these table.
 
-local curcontext="$curcontext" state line suf ret=1
+local curcontext="$curcontext" state line expl suf ret=1
 local args deffs=iso9660 tmp typeops=-t _fs_any _nfs_access _fs_nfs _nfs_ufs \
 _fs_ufs _fs_efs _fs_iso9660 _fs_cachefs _fs_s5fs _fs_tmpfs _fs_pcfs _fs_hsfs \
 _fs_advfs _fs_cdfs _fs_affs _fs_ext2 _fs_fat _fs_ext3 _fs_msdos _fs_umsdos \
Index: Unix/Command/_python
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_python,v
retrieving revision 1.3
diff -u -r1.3 _python
--- Unix/Command/_python	6 Dec 2004 12:51:03 -0000	1.3
+++ Unix/Command/_python	2 Jun 2005 13:15:35 -0000
@@ -2,7 +2,7 @@
 
 # Python 2.4
 
-local curcontext="$curcontext" state line
+local curcontext="$curcontext" state line expl
 typeset -A opt_args
 
 _arguments -s -S \
Index: Unix/Command/_rar
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_rar,v
retrieving revision 1.4
diff -u -r1.4 _rar
--- Unix/Command/_rar	23 Feb 2004 17:03:31 -0000	1.4
+++ Unix/Command/_rar	2 Jun 2005 13:15:35 -0000
@@ -1,6 +1,6 @@
 #compdef rar unrar
 
-local common
+local common expl
 
 common=(
   '-ad[append archive name to destination path]'
Index: Unix/Type/_file_systems
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Type/_file_systems,v
retrieving revision 1.3
diff -u -r1.3 _file_systems
--- Unix/Type/_file_systems	11 May 2005 09:27:10 -0000	1.3
+++ Unix/Type/_file_systems	2 Jun 2005 13:15:35 -0000
@@ -1,6 +1,6 @@
 #autoload
 
-local fss
+local expl fss
 
 case $OSTYPE in
   aix*) fss=( jfs nfs cdrfs ) ;;
Index: Unix/Type/_global_tags
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Type/_global_tags,v
retrieving revision 1.1
diff -u -r1.1 _global_tags
--- Unix/Type/_global_tags	31 Jul 2003 15:27:52 -0000	1.1
+++ Unix/Type/_global_tags	2 Jun 2005 13:15:35 -0000
@@ -1,4 +1,6 @@
 #autoload
 
+local expl
+
 _wanted global-tags expl 'tag' compadd -M 'm:{a-zA-Z}={A-Za-z}' \
     -a "$@" - $(_call_program global-tags global --completion $PREFIX)
Index: Unix/Type/_locales
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Type/_locales,v
retrieving revision 1.2
diff -u -r1.2 _locales
--- Unix/Type/_locales	12 Mar 2003 18:55:38 -0000	1.2
+++ Unix/Type/_locales	2 Jun 2005 13:15:35 -0000
@@ -1,6 +1,6 @@
 #compdef -value-,LANG,-default- -value-,LANGUAGE,-default- -P -value-,LC_*,-default-
 
-local locales
+local expl locales
 
 if (( $+commands[locale] )); then
   locales=( $(_call_program locales locale -a) )
Index: Unix/Type/_user_at_host
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Type/_user_at_host,v
retrieving revision 1.1
diff -u -r1.1 _user_at_host
--- Unix/Type/_user_at_host	2 Apr 2001 11:43:27 -0000	1.1
+++ Unix/Type/_user_at_host	2 Jun 2005 13:15:35 -0000
@@ -5,7 +5,7 @@
 # with `-t tag'.
 # A `-' or `--' as the first argument is ignored.
 
-local suf tag=accounts
+local expl suf tag=accounts
 
 if [[ "$1" = -t?* ]]; then
   tag="${1[3,-1]}"
Index: X/Command/_mozilla
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/X/Command/_mozilla,v
retrieving revision 1.5
diff -u -r1.5 _mozilla
--- X/Command/_mozilla	26 Feb 2004 12:57:21 -0000	1.5
+++ X/Command/_mozilla	2 Jun 2005 13:15:35 -0000
@@ -1,6 +1,6 @@
 #compdef mozilla mozilla-firefox mozilla-xremote-client
 
-local curcontext="$curcontext" state line ret=1 suf
+local curcontext="$curcontext" state line expl ret=1 suf
 typeset -A opt_args
 
 local popts="-installer -CreateProfile -P -ProfileWizard -ProfileManager -SelectProfile"
Index: X/Command/_mplayer
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/X/Command/_mplayer,v
retrieving revision 1.7
diff -u -r1.7 _mplayer
--- X/Command/_mplayer	18 Apr 2004 22:10:15 -0000	1.7
+++ X/Command/_mplayer	2 Jun 2005 13:15:39 -0000
@@ -1,7 +1,7 @@
 #compdef mplayer gmplayer
 
 local suf ret=1 curcontext="$curcontext"
-local -a vals state line
+local -a vals state line expl
 
 _x_arguments -C -s \
   '!-abs:buffer size' \
Index: X/Command/_netscape
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/X/Command/_netscape,v
retrieving revision 1.5
diff -u -r1.5 _netscape
--- X/Command/_netscape	17 Jan 2003 09:23:35 -0000	1.5
+++ X/Command/_netscape	2 Jun 2005 13:15:39 -0000
@@ -1,6 +1,6 @@
 #compdef netscape
 
-local curcontext="$curcontext" state line ret=1 suf files
+local curcontext="$curcontext" state line expl ret=1 suf files
 typeset -A opt_args
 
 _x_arguments -C \
Index: X/Type/_x_visual
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/X/Type/_x_visual,v
retrieving revision 1.1
diff -u -r1.1 _x_visual
--- X/Type/_x_visual	2 Jan 2002 14:45:23 -0000	1.1
+++ X/Type/_x_visual	2 Jun 2005 13:15:39 -0000
@@ -1,5 +1,7 @@
 #autoload
 
+local expl
+
 # with the -b option, include `Best' in the matches
 local best="${argv[(r)-b]:+Best}"
 argv[(i)-b]=()
Index: Zsh/Context/_equal
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Zsh/Context/_equal,v
retrieving revision 1.2
diff -u -r1.2 _equal
--- Zsh/Context/_equal	7 Aug 2001 11:28:13 -0000	1.2
+++ Zsh/Context/_equal	2 Jun 2005 13:15:39 -0000
@@ -1,3 +1,5 @@
 #compdef -equal-
 
+local expl
+
 _wanted commands expl command compadd -k commands

