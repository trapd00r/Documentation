From zsh-workers-return-20481-mason-zsh=primenet.com.au@sunsite.dk Wed Oct 13 16:47:50 2004
Return-Path: <zsh-workers-return-20481-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10780 invoked from network); 13 Oct 2004 16:47:49 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 13 Oct 2004 16:47:49 -0000
Received: (qmail 26196 invoked from network); 13 Oct 2004 16:47:43 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 13 Oct 2004 16:47:43 -0000
Received: (qmail 19795 invoked by alias); 13 Oct 2004 16:47:29 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20481
Received: (qmail 19781 invoked from network); 13 Oct 2004 16:47:28 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 13 Oct 2004 16:47:28 -0000
Received: (qmail 25195 invoked from network); 13 Oct 2004 16:46:29 -0000
Received: from dsl3-63-249-88-2.cruzio.com (HELO binome.blorf.net) (63.249.88.2)
  by a.mx.sunsite.dk with SMTP; 13 Oct 2004 16:46:27 -0000
Received: by binome.blorf.net (Postfix, from userid 1000)
	id 5A5A6734; Wed, 13 Oct 2004 09:46:26 -0700 (PDT)
Date: Wed, 13 Oct 2004 09:46:26 -0700
From: Wayne Davison <wayned@users.sourceforge.net>
To: zsh-workers@sunsite.dk
Subject: Re: characters not added in _rsync completion
Message-ID: <20041013164626.GA3017@blorf.net>
References: <20041013054015.GA824@blorf.net> <Pine.LNX.4.61.0410122330050.17741@toltec.zanshin.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <Pine.LNX.4.61.0410122330050.17741@toltec.zanshin.com>
User-Agent: Mutt/1.5.6+20040722i
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_44 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0

On Tue, Oct 12, 2004 at 11:41:52PM -0700, Bart Schaefer wrote:
> I'm puzzled why the version of rsync itself makes any difference,
> because _rsync specifies everything explicitly, so unless you've
> edited _rsync it won't ever complete those options.

This is not how it works on my system.  The _rsync script appears to be
querying rsync to ask it what options it supports, and combining that
list with the list in _rsync.  So, if, for instance, you've installed
the rsync 2.6.3 package from debian unstable, the new options from all
the 2.6.x versions get listed, just without descriptions.

> Similarly, I have only --links and nothing else that matches --link.

Earlier rsyncs (prior to 2.6.0) didn't list --link-dest in their help
text, even when the option was supported (and our _rsync script was
missing this option as well -- I've fixed that in the latest CVS
version).

> Yet this one works for me:
> > rsync --no<TAB>    # should add "-"

If I change rsync to 2.5.7 on my system, that one also begins to work.
However, with either a newer rsync (which lists --no-relative and
--no-implied-dirs in the help output) or if you edit the --no-relative
option into the _rsync script, it begins to fail.

> Without plunging into the why of it, a cursory inspection seems to 
> indicate that when an option has an argument (e.g., --compa completes to 
> --compare-dest= with the trailing equal sign) then zsh fails to find the 
> longest common prefix among that option and any other options that do NOT 
> have arguments (as --compress does not).  All the cases that fail appear 
> to have at least one option with, and at least one without, an argument.

It's strange that the --no<TAB> case doesn't match this idea.

..wayne..

