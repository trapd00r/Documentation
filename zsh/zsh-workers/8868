From zsh-workers-return-8868-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Dec 03 12:58:57 1999
Return-Path: <zsh-workers-return-8868-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20808 invoked from network); 3 Dec 1999 12:58:56 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 3 Dec 1999 12:58:56 -0000
Received: (qmail 100 invoked by alias); 3 Dec 1999 12:58:46 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8868
Received: (qmail 91 invoked from network); 3 Dec 1999 12:58:45 -0000
Date: Fri, 3 Dec 1999 13:58:44 +0100 (MET)
Message-Id: <199912031258.NAA00629@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: small fix for complist


After playing some more with colors...

When complist printed a list with multiple groups, the variable that
keeps track of the last color code printed could get out of sync if a
description used color codes.

This also makes the sp capability be used for the empty `slots' at the 
bottom/right of the list.

Bye
 Sven

diff -u -r oldsrc/Zle/complist.c Src/Zle/complist.c
--- oldsrc/Zle/complist.c	Fri Dec  3 10:21:47 1999
+++ Src/Zle/complist.c	Fri Dec  3 13:22:49 1999
@@ -614,6 +614,8 @@
     return 0;
 }
 
+static Cmgroup last_group;
+
 static void
 clprintm(Cmgroup g, Cmatch *mp, int mc, int ml, int lastc, int width,
 	 char *path, struct stat *buf)
@@ -621,8 +623,13 @@
     Cmatch m;
     int len, subcols = 0;
 
+    if (g != last_group)
+        *last_cap = '\0';
+
+    last_group = g;
+
     if (!mp) {
-	zcputs(&mcolors, g->name, COL_MI);
+	zcputs(&mcolors, g->name, COL_SP);
 	len = width - 2;
 	while (len-- > 0)
 	    putc(' ', shout);

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

