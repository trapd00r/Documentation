From zsh-users-return-12782-mason-zsh=primenet.com.au@sunsite.dk Sun Apr 13 16:19:29 2008
Return-Path: <zsh-users-return-12782-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11216 invoked from network); 13 Apr 2008 16:19:27 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 13 Apr 2008 16:19:27 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 63647 invoked from network); 13 Apr 2008 16:19:10 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 13 Apr 2008 16:19:10 -0000
Received: (qmail 11304 invoked by alias); 13 Apr 2008 16:18:59 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12782
Received: (qmail 11287 invoked from network); 13 Apr 2008 16:18:58 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 13 Apr 2008 16:18:58 -0000
Received: from vms173003pub.verizon.net (vms173003pub.verizon.net [206.46.173.3])
	by bifrost.dotsrc.org (Postfix) with ESMTP id B9B2C8043AC7
	for <zsh-users@sunsite.dk>; Sun, 13 Apr 2008 18:18:53 +0200 (CEST)
Received: from torch.brasslantern.com ([71.116.74.146])
 by vms173003.mailsrvcs.net
 (Sun Java System Messaging Server 6.2-6.01 (built Apr  3 2006))
 with ESMTPA id <0JZ9007H5UI6FFW3@vms173003.mailsrvcs.net> for
 zsh-users@sunsite.dk; Sun, 13 Apr 2008 11:15:43 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id m3DGIYUI032640	for
 <zsh-users@sunsite.dk>; Sun, 13 Apr 2008 09:18:34 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id m3DGIXrx032639	for zsh-users@sunsite.dk; Sun,
 13 Apr 2008 09:18:33 -0700
Date: Sun, 13 Apr 2008 09:18:32 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: buglet in zmv help
In-reply-to: <20080413121553.GA25325@miek.nl>
To: zsh users <zsh-users@sunsite.dk>
Message-id: <080413091833.ZM32638@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <20080413121553.GA25325@miek.nl>
Comments: In reply to Miek Gieben <miek@miek.nl>        "buglet in zmv help"
 (Apr 13,  2:15pm)
X-Virus-Scanned: ClamAV 0.91.2/6742/Sun Apr 13 16:13:42 2008 on bifrost
X-Virus-Status: Clean

On Apr 13,  2:15pm, Miek Gieben wrote:
} 
} If I run `run-help zmv` I see the following (only quoting the top half
} of the text):
} 
}     Usage:
}       zmv [OPTIONS] oldpattern newpattern
}     where oldpattern contains parenthesis surrounding patterns which will
}     be replaced in turn by $1, $2, ... in newpattern.  For example,
}       zmv '(*).lis' '\$1.txt'

This appears to be in the usage message in zmv itself.  I'm not sure how
you manage to get that out of "run-help zmv" (I sure don't), but that's
beside the point.

I do wonder when the extra pair of backslashes ceased to be necessary.
Or rather, I wonder when they *became* necessary, because (much) older
versions of zmv don't have five backslashes there, they have only one.
It doesn't seem to matter whether there is one or three, but five is
two too many.

CVS seems to point to this from ChangeLog-4.1:

2002-03-30  Wayne Davison  <wayned@users.sourceforge.net>

   * 16927: zsh/Functions/Misc/zmv: Added -W to auto-convert wildcards in
   both the find and replace strings.  Fixed the usage message to output
   the '$' args and '\' characters (they were getting eaten).

I wonder if there was a backslash parsing bug that was introduced and
then fixed on either side of the time of this change.

(Interestingly, that citation is wrong.  The -W patch is actually 16926,
but does not include the usage message change.  Anyway, shows just how
often anyone looks at the usage message from zmv: once in six years?)

--- ../zsh-forge/current/Functions/Misc/zmv     2007-05-21 22:22:59.000000000 -0700
+++ Functions/Misc/zmv  2008-04-13 08:59:28.000000000 -0700
@@ -148,7 +148,7 @@
   %N [OPTIONS] oldpattern newpattern
 where oldpattern contains parenthesis surrounding patterns which will
 be replaced in turn by \$1, \$2, ... in newpattern.  For example,
-  %N '(*).lis' '\\\\\$1.txt'
+  %N '(*).lis' '\$1.txt'
 renames 'foo.lis' to 'foo.txt', 'my.old.stuff.lis' to 'my.old.stuff.txt',
 and so on.  Something simpler (for basic commands) is the -W option:
   %N -W '*.lis' '*.txt'


-- 

