From zsh-workers-return-16993-mason-zsh=primenet.com.au@sunsite.dk Tue Apr 16 10:08:19 2002
Return-Path: <zsh-workers-return-16993-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8903 invoked from network); 16 Apr 2002 10:08:18 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 16 Apr 2002 10:08:18 -0000
Received: (qmail 29479 invoked by alias); 16 Apr 2002 10:08:11 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16993
Received: (qmail 29463 invoked from network); 16 Apr 2002 10:08:10 -0000
From: Borsenkow Andrej <Andrej.Borsenkow@mow.siemens.ru>
To: "'Sven Wischnowsky'" <wischnow@berkom.de>, zsh-workers@sunsite.dk
Subject: RE: _values does not quote inserted matches
Date: Tue, 16 Apr 2002 14:08:04 +0400
Message-ID: <002a01c1e52e$9a40aa30$1fc1f2a3@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook, Build 10.0.3416
In-Reply-To: <15547.55463.213608.45857@wischnow.berkom.de>
x-mimeole: Produced By Microsoft MimeOLE V6.00.2600.0000
Importance: Normal


> > I don't know why the Q is included on line 55?  It seems to all work
OK if
> > I take it out.
> 
> Same for me. And I couldn't find when we added this, so it's probably
> very old, from a time when _values was less sophisticated about
> separators with special characters or something.
> 
> So, let's try.
> 

Now, this does quote inserted string which is good. Unfortunately, it is
still confused by inserted quotes ... 

_urpmi_media() {
    local source media brace
    local -a all_sources suf
    local context state line
    typeset -A val_args
    while read source media brace; do
        [[ "$brace" != "{" ]] && continue
        all_sources=($all_sources[@] $source)
    done < /etc/urpmi/urpmi.cfg

    _values -s , 'urpmi media' $all_sources
}

bor@cooker% urpmi --media Contrib\ CD,
Completing urpmi media
Contrib CD        Installation CD

So far so good. But if I now hit ENTER and try complete again ...

bor@cooker% urpmi --media Contrib\ CD,
No matches for: `urpmi media'

Looks like _values get confused by quoting on command line?

-andrej

