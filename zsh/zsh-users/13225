From zsh-users-return-13225-mason-zsh=primenet.com.au@sunsite.dk Tue Sep 16 15:02:46 2008
Return-Path: <zsh-users-return-13225-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16587 invoked from network); 16 Sep 2008 15:02:44 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Sep 2008 15:02:44 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 49711 invoked from network); 16 Sep 2008 15:02:03 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Sep 2008 15:02:03 -0000
Received: (qmail 23273 invoked by alias); 16 Sep 2008 15:01:36 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13225
Received: (qmail 23252 invoked from network); 16 Sep 2008 15:01:35 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 16 Sep 2008 15:01:35 -0000
Received: from vms173003pub.verizon.net (unknown [206.46.173.3])
	by bifrost.dotsrc.org (Postfix) with ESMTP id D62F980271AE
	for <zsh-users@sunsite.dk>; Tue, 16 Sep 2008 17:01:00 +0200 (CEST)
Received: from torch.brasslantern.com ([96.238.220.178])
 by vms173003.mailsrvcs.net
 (Sun Java System Messaging Server 6.2-6.01 (built Apr  3 2006))
 with ESMTPA id <0K7A00KKZMYVO5G0@vms173003.mailsrvcs.net> for
 zsh-users@sunsite.dk; Tue, 16 Sep 2008 09:59:20 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id m8GExHhA025747	for
 <zsh-users@sunsite.dk>; Tue, 16 Sep 2008 07:59:19 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id m8GExC3d025746	for zsh-users@sunsite.dk; Tue,
 16 Sep 2008 07:59:12 -0700
Date: Tue, 16 Sep 2008 07:59:11 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: zsh does not start in $HOME
In-reply-to: =?iso-8859-1?Q?=3C20080916072757=2EGB22792=40speutel=2Ede=3E?=
 =?iso-8859-1?Q?Comments=3A_In_reply_to__Stephan_Windm=FCller_=3Cstephan?=
 =?iso-8859-1?Q?=2Ewindmueller=40cs=2Etu-dortmund=2Ede=3E?=
 =?iso-8859-1?Q?________=22Re=3A_zsh_does_not_start_in_$HOME=22_=28Sep_16?=
 =?iso-8859-1?Q?=2C__9=3A27am=29?=
To: zsh-users@sunsite.dk
Message-id: <080916075911.ZM25743@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=iso-8859-1
Content-transfer-encoding: quoted-printable
References: <20080908080918.GC25826@speutel.de>
	<20080908095104.7123e5f9@news01>	<20080908091856.GD25826@speutel.de>
	<080908073943.ZM15568@torch.brasslantern.com>
	<20080915133250.GC17452@speutel.de>
	<080915073455.ZM24404@torch.brasslantern.com>
	<20080916072757.GB22792@speutel.de>
X-Virus-Scanned: ClamAV 0.92.1/8259/Tue Sep 16 15:05:37 2008 on bifrost
X-Virus-Status: Clean

On Sep 16,  9:27am, Stephan Windm=FCller wrote:
}
} /etc/passwd does not contain an entry for my user.

Well, the NIS passwd map then, or the LDAP entry for your user, or ...
What's "print $HOME" say?  Zsh has to be getting /home/username from
this code in Src/init.c:

    if ((pswd =3D getpwuid(cached_uid))) {
        if (emulation =3D=3D EMULATE_ZSH)
            home =3D metafy(pswd->pw_dir, -1, META_DUP);
        cached_username =3D ztrdup(pswd->pw_name);
    }

It then initializes $PWD from $HOME, and "pwd" without the -P simply
prints $PWD.

} On Mon, 15. Sep 2008, Bart Schaefer wrote:
} > That indicates to me that:
} > -- there is a symlink from /home/username to /ldaphome/username
}=20
} No, both are separate directories.

There's a test ispwd() which checks to see whether the directory named
by $HOME is the same as the current directory, which it does by calling
stat() and examining the inode and device numbers.  This test has to be
returning success, so zsh disputes your assertion.

Run stat or zstat on the two directories and look at the device and
inode numbers.

