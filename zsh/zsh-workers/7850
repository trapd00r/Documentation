From zsh-workers-return-7850-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Sep 15 14:44:58 1999
Return-Path: <zsh-workers-return-7850-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11016 invoked from network); 15 Sep 1999 14:44:56 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 Sep 1999 14:44:56 -0000
Received: (qmail 5830 invoked by alias); 15 Sep 1999 14:44:46 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7850
Received: (qmail 5821 invoked from network); 15 Sep 1999 14:44:46 -0000
Date: Wed, 15 Sep 1999 16:44:45 +0200 (MET DST)
Message-Id: <199909151444.QAA00085@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: sorry, cleanup


Trying Clint's problem again, I found some typos and a thinko in
`_arguments'.


Bye
 Sven

diff -u -r oldcompletion/Base/_arguments Completion/Base/_arguments
--- oldcompletion/Base/_arguments	Wed Sep 15 15:52:36 1999
+++ Completion/Base/_arguments	Wed Sep 15 16:43:28 1999
@@ -848,10 +848,10 @@
         compadd "$expl[@]" -Q -M 'r:|[_-]=* r:|=*' - "${PREFIX}" && ret=0
       fi
     else
-      tmp1=( "${(k)opts[@]}" "${(@k)odopts[(I)*[^=]]}" )
-      tmp1=( "${(@M)odescr:#(${(kj:|:)~tmp1}):*}" )
+      tmp1=( "${(@k)opts}" "${(@k)odopts[(I)*[^=]]}" )
+      tmp1=( "${(@M)odescr:#(${(j:|:)~tmp1}):*}" )
       tmp2=( "${(@M)odescr:#(${(kj:|:)~dopts}):*}" )
-      tmp3=( "${(@M)odescr:#(${(kj:|:)~odopts[(I)*=]}):*}" )
+      tmp3=( "${(@M)odescr:#(${(kj:|:)~odopts[(I)*=]%=}):*}" )
       _describe -o -c "$cmd" option \
         tmp1 -Q -M 'r:|[_-]=* r:|=*' -- \
         tmp2 -QS '' -M 'r:|[_-]=* r:|=*' -- \
@@ -860,8 +860,8 @@
   fi
 
   if [[ nm -eq compstate[nmatches] && 
-        ( -z "$single" ||
-          ( $#_args_cache_long -ne 0 && "$PREFIX" = --*=* ) ) ]]; then
+        ( ( -z "$single" && "$PREFIX" = [-+]*\=* ) ||
+          ( $#_args_cache_long -ne 0 && "$PREFIX" = --*\=* ) ) ]]; then
     tmp=( "${(@Mk)odopts:#[^:]#\=}" )
     prefix="${PREFIX#*\=}"
     suffix="$SUFFIX"

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

