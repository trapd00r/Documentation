From zsh-workers-return-16827-mason-zsh=primenet.com.au@sunsite.dk Thu Mar 14 10:59:50 2002
Return-Path: <zsh-workers-return-16827-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1863 invoked from network); 14 Mar 2002 10:59:48 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 14 Mar 2002 10:59:48 -0000
Received: (qmail 6226 invoked by alias); 14 Mar 2002 10:59:41 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16827
Received: (qmail 6212 invoked from network); 14 Mar 2002 10:59:40 -0000
Date: Thu, 14 Mar 2002 02:59:32 -0800
From: Derek Peschel <dpeschel@eskimo.com>
To: zsh-workers@sunsite.dk
Subject: Re: what is removing the space after completion and before "|"?
Message-ID: <20020314025932.A29035@eskimo.eskimo.com>
References: <20020309020350.A25556@eskimo.eskimo.com> <20020309103417.GA15311@Ax9.org> <1020309182056.ZM24962@candle.brasslantern.com> <20020309214538.A9452@eskimo.eskimo.com> <15500.32490.15487.735745@wischnow.berkom.de>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 1.0i
In-Reply-To: <15500.32490.15487.735745@wischnow.berkom.de>; from wischnow@berkom.de on Mon, Mar 11, 2002 at 10:54:50AM +0100

On Mon, Mar 11, 2002 at 10:54:50AM +0100, Sven Wischnowsky wrote:
> 
> Derek Peschel wrote:
> 
> > ...
> > 
> > I'm using the old completion system and I haven't tried compctl.  I don't
> > think AUTO_REMOVE_SLASH has any effect in the particular case of spaces
> > before pipe characters (I tried it both ways).  This is with a 4.1
> > development version.
> 
> compctl is the old one, the completion system is the new one.

I mean I haven't run compinit or compctl, I'm just using the built-in
options.

> > Is compresult.c the only file that deals with suffixes?
> 
> Everthing needed for this, yes.  But we have to rely on the zle module
> to really remove the suffix (since at that time, the completion system
> isn't running any more).

Now I suspect the makesuffix function.  I think what's happening is this:

	- I hit Tab to do the completion
	- a space gets added as a suffix
	- I type an ampersand or vertical bar
	- the "remove the same character as a suffix" code runs
	- by the special cases in makesuffix the space is treated
	  as if it were an ampersand or vertical bar

Why are those special cases in makesuffix anyway?  Do "&" or "|" ever
get added as suffixes?

If we want to keep the special cases we'll probably have to arrange that
they all be equivalent to each other for makesuffix's purposes, but that
each one only be equivalent to itself for the purposes of the "remove the
same character" rule.

> But.  We had some discussion about suffix handling some time ago
> (sorry, don't have the message IDs here).  I've mostly been thinking
> (or dreaming) about moving mor of the code into shell code for more
> flexibilty and greater configurability.  I didn't have time to hack,
> though, and it isn't easy without changing several parts of the C- and
> shell-code.
> 
> I don't object if you want to hack that part of the code (everyone who
> wants to work his way into the completion code is welcome), but I
> don't want new shell options to appear for this (or I'll remove them
> again when I find the time to tackle the suffix problem).
> 
> Maybe you have other ideas about suffix handling and could tell us
> about them?  So that we could come up with a list of desired features
> to help us implement that.

I haven't spent enough time with the shell to understand the code at a
broad level.  I'm just playing with specific features to get the behavior
I want.  Though I do realize that a small change in the code can affect
lots of other things.

If I start to really understand the power of the completion system, and
come up with other ideas, I'll let the list know.

-- Derek

