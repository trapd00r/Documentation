From zsh-workers-return-14222-mason-zsh=primenet.com.au@sunsite.dk Fri May 04 16:23:22 2001
Return-Path: <zsh-workers-return-14222-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4660 invoked from network); 4 May 2001 16:23:21 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 4 May 2001 16:23:21 -0000
Received: (qmail 19358 invoked by alias); 4 May 2001 16:23:16 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14222
Received: (qmail 19321 invoked from network); 4 May 2001 16:23:15 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010504162206.ZM19282@candle.brasslantern.com>
Date: Fri, 4 May 2001 16:22:05 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.dk
Subject: Screen refresh problem with completion messages
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

I'm using (surprise) the `bart' prompt theme with an RPS1, which gives me a
two-line prompt like this:

zagzig [zed -f _cvs] /usr/src/local/zsh/zsh-4.0                01-05-04  8:53AM
schaefer[526]                                                       4.0.1-pre-3

When a failed completion produces a message that is exactly 80 columns wide,
as in this example (which you won't be able to reproduce directly because I
was using an edited _cvs, as you can see from history line in the prompt):

zagzig [zed -f _cvs] /usr/src/local/zsh/zsh-4.0                01-05-04  8:53AM
schaefer[526] cvs remove P/Q/R/t                                    4.0.1-pre-3
No matches for ` ', `removed file', `directory', `path prefix', or `corrections

Note that the final close-quote is missing (so only 79 columns of the 80-
column message were displayed).  Worse, however, is that the cursor is now
over the `c' in the word `local', on the line above where it should be.

My guess is that the zle code thinks that all 80 columns were printed and
thus that the line has wrapped, so it needed to move the cursor up two
line; but some other part of the code is suppressing the 80th character
in order to prevent the line from wrapping.  However, I'm not sure how to
track it down.  Geoff or Sven?

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

