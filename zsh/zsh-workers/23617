From zsh-workers-return-23617-mason-zsh=primenet.com.au@sunsite.dk Thu Jun 28 18:01:12 2007
Return-Path: <zsh-workers-return-23617-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22739 invoked from network); 28 Jun 2007 18:01:01 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.1 (2007-05-02) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 28 Jun 2007 18:01:01 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 4212 invoked from network); 28 Jun 2007 18:00:55 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Jun 2007 18:00:55 -0000
Received: (qmail 17918 invoked by alias); 28 Jun 2007 18:00:51 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23617
Received: (qmail 17907 invoked from network); 28 Jun 2007 18:00:49 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 28 Jun 2007 18:00:49 -0000
Received: (qmail 3905 invoked from network); 28 Jun 2007 18:00:49 -0000
Received: from redoubt.spodhuis.org (HELO mx.spodhuis.org) (193.202.115.177)
  by a.mx.sunsite.dk with SMTP; 28 Jun 2007 18:00:41 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws; s=first1; d=spodhuis.org;
	h=Received:Date:From:To:Subject:Message-ID:Mail-Followup-To:References:MIME-Version:Content-Type:Content-Disposition:In-Reply-To;
	b=cEUYnxud11dFmAZvWgQG2vZ9PeB5eJ47qqQo/uqJ3PAKZ911wHq7gNb3ZnwG+5zCqjXjKqdCWM9whVGutBqh5odiO5yr7q4hdzzA7FjF5KL2m1b+EjJ5OJLwZWp9UjShL8WFHNFCRPqnjYrIyK5aSpRL37/cXStXXyrykdZsdME=;
Received: by smtp.spodhuis.org with local 
	id 1I3yIK-000O6s-Nu; Thu, 28 Jun 2007 18:00:40 +0000
Date: Thu, 28 Jun 2007 11:00:40 -0700
From: Phil Pennock <zsh-workers+phil.pennock@spodhuis.org>
To: Zsh workers <zsh-workers@sunsite.dk>
Subject: Re: PATCH: ldd and LD_DEBUG completions
Message-ID: <20070628180040.GA89346@redoubt.spodhuis.org>
Mail-Followup-To: Zsh workers <zsh-workers@sunsite.dk>
References: <15204.1183047166@thecus> <200706281621.l5SGLHKR015636@news01.csr.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <200706281621.l5SGLHKR015636@news01.csr.com>

On 2007-06-28 at 17:21 +0100, Peter Stephenson wrote:
> Are you referring to the fact that all system libraries needed in zsh
> and its modules are linked into the main shell and all modules?  That's
> a fairly cosmetic problem requiring a rewrite of the build system that's
> likely to be 1,798,109,308th in my global list of things to worry about.

It affected me when I was creating my ruby plugin (which I haven't
worked on in weeks); I hacked around the configure/make/sh-scripts
system to let the linking be on individual modules, with better
independent configuration.  I don't remember where things _really_
broke, might have been the libcrypt pull-in.  (Of course, I later
remembered which language it was I'd been trying to remember, designed
for embedding and the one I _wanted_ to test with; lua).

I need to research what's available pre-packaged as autoconf stuff to
detect systems where everything needs to be linked into the main binary,
so that I can merge this in without killing support for some of zsh's
platforms.  I'm planning to schedule time this weekend to look at this.

Anything I offer will only have been tested on FreeBSD6/amd64 and MacOS
10.4.10/x86, so there's likely to be breakage, hence not having offered
anything before now.

Does the output below look reasonable and desirable to people?

% ldd -a bin/zsh
bin/zsh:
	libzsh-4.3.4-dev-0.so => /home/pdp/dbg/lib/zsh/libzsh-4.3.4-dev-0.so (0x800631000)
	libiconv.so.3 => /usr/local/lib/libiconv.so.3 (0x8007f6000)
	libncurses.so.6 => /lib/libncurses.so.6 (0x8009e7000)
	libm.so.4 => /lib/libm.so.4 (0x800b40000)
	libc.so.6 => /lib/libc.so.6 (0x800c5c000)
/home/pdp/dbg/lib/zsh/libzsh-4.3.4-dev-0.so:
	libiconv.so.3 => /usr/local/lib/libiconv.so.3 (0x8007f6000)
	libncurses.so.6 => /lib/libncurses.so.6 (0x8009e7000)
	libm.so.4 => /lib/libm.so.4 (0x800b40000)
	libc.so.6 => /lib/libc.so.6 (0x800c5c000)
% ldd lib/zsh/4.3.4-dev-0/zsh/pcre.so 
lib/zsh/4.3.4-dev-0/zsh/pcre.so:
	libiconv.so.3 => /usr/local/lib/libiconv.so.3 (0x80093b000)
	libncurses.so.5.6 => not found (0x0)
	libm.so.4 => /lib/libm.so.4 (0x800b2c000)
	libc.so.6 => /lib/libc.so.6 (0x800632000)
	libpcre.so.0 => /usr/local/lib/libpcre.so.0 (0x800c48000)
% ldd -a lib/zsh/4.3.4-dev-0/zsh/ruby.so
lib/zsh/4.3.4-dev-0/zsh/ruby.so:
	libiconv.so.3 => /usr/local/lib/libiconv.so.3 (0x80093c000)
	libncurses.so.5.6 => not found (0x0)
	libm.so.4 => /lib/libm.so.4 (0x800b2d000)
	libc.so.6 => /lib/libc.so.6 (0x800632000)
	libruby18.so.18 => /usr/local/lib/libruby18.so.18 (0x800c49000)
/usr/local/lib/libruby18.so.18:
	libcrypt.so.3 => /lib/libcrypt.so.3 (0x800e32000)
	libm.so.4 => /lib/libm.so.4 (0x800b2d000)

