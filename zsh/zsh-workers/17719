From zsh-workers-return-17719-mason-zsh=primenet.com.au@sunsite.dk Fri Sep 20 18:35:29 2002
Return-Path: <zsh-workers-return-17719-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14540 invoked from network); 20 Sep 2002 18:35:28 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 20 Sep 2002 18:35:28 -0000
Received: (qmail 26479 invoked by alias); 20 Sep 2002 18:35:17 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 17719
Received: (qmail 26461 invoked from network); 20 Sep 2002 18:35:15 -0000
Date: Sat, 21 Sep 2002 03:35:10 +0900
Message-ID: <86wupgldb5.wl@archon.local.idaemons.org>
From: "Akinori MUSHA" <knu@iDaemons.org>
To: Oliver Kiddle <okiddle@yahoo.co.uk>
Cc: zsh-workers <zsh-workers@sunsite.dk>
Subject: Re: adding .tbz support to _bsd_pkg
In-Reply-To: <E17befE-0006C9-00@bimbo.logica.co.uk>
References: <863ctvt1sy.wl@archon.local.idaemons.org>
	<E17befE-0006C9-00@bimbo.logica.co.uk>
User-Agent: Wanderlust/2.9.15 (Unchained Melody) EMIKO/1.14.1 (Choanoflagellata) LIMIT/1.14.7 (Fujiidera) APEL/10.3 Emacs/21.2 (i386--freebsd) MULE/5.0 (SAKAKI)
Organization: Associated I. Daemons
X-PGP-Public-Key: finger knu@FreeBSD.org
X-PGP-Fingerprint: 081D 099C 1705 861D 4B70  B04A 920B EFC7 9FD9 E1EE
MIME-Version: 1.0 (generated by EMIKO 1.14.1 - "Choanoflagellata")
Content-Type: text/plain; charset=US-ASCII

Hi,

At Mon, 05 Aug 2002 11:00:36 +0100,
Oliver Kiddle wrote:
> Would it also be useful for _bzip2 to look for .tbz files in addition to
> .bz2?

I've seen now a few tar+bzip2 tarballs suffixed with `.tbz' or
`.tbz2'.  I think they should be looked for by _bzip2.

		*		*		*

Here's another patch against _bsd_pkg, which adds support for the
pkg_create(1) command.  Please apply it if it's okay.

Note: NetBSD's pkg_create(1) has a different set of command line flags
than FreeBSD's, so NetBSD users may want to improve the minimum
ruleset written below.  Ditto for OpenBSD.

Index: Completion/BSD/Command/_bsd_pkg
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/BSD/Command/_bsd_pkg,v
retrieving revision 1.4
diff -u -r1.4 _bsd_pkg
--- Completion/BSD/Command/_bsd_pkg	5 Aug 2002 09:55:39 -0000	1.4
+++ Completion/BSD/Command/_bsd_pkg	20 Sep 2002 18:22:51 -0000
@@ -1,4 +1,4 @@
-#compdef pkg_add pkg_delete pkg_info
+#compdef pkg_add pkg_create pkg_delete pkg_info
 
 (( $+functions[_bsd_pkg_pkgfiles] )) ||
 _bsd_pkg_pkgfiles() {
@@ -78,6 +78,49 @@
       $flags[@] \
       '*:package to install:_bsd_pkg_pkgfiles'
     ;;
+
+  pkg_create)
+    case "$OSTYPE" in
+    freebsd*)
+      flags=(
+	'-f[specify plist file]:plist file:_files'
+	'(-b)-c[specify comment file]:comment file:_files'
+	'(-b)-d[specify descr file]:descr file:_files'
+	'-Y[assume YES for any questions asked]'
+	'-N[assume NO for any questions asked]'
+	'(-b)-O[packing list only mode]'
+	'-v[be verbose]'
+	'-h[force tar to follow symlinks]'
+	'(-b)-i[specify pre-install script]:pre-install script:_files'
+	'(-b)-I[specify post-install script]:post-install script:_files'
+	'(-b)-P[specify initial dependencies]:dependencies:_bsd_pkg_pkgs'
+	'(-b)-p[specify prefix]:prefix directory:_files -/'
+	'(-b)-k[specify deinstall script]:deinstall script:_files'
+	'(-b)-K[specify post-deinstall script]:post-deinstall script:_files'
+	'(-b)-r[specify req script]:req script:_files'
+	'(-b)-s[specify source directory]:source directory:_files -/'
+	'(-b)-t[specify mktemp template]:mktemp template:_files'
+	'(-b)-X[specify exclude file]:exclude file for tar:_files'
+	'(-b)-D[specify message file]:message file:_files'
+	'(-b)-m[specify mtree file]:mtree file:_files'
+	'(-b)-o[specify origin]:origin:_files -W ${PORTSDIR\:-/usr/ports} -/'
+	'-j[use bzip2]'
+	'-z[use gzip]'
+	'(-c -d -O -i -I -P -p -k -K -r -s -t -X -D -m -o)-b[specify pkgname]:pkgname:_bsd_pkg_pkgs'
+	'*:package file name:_files'
+      )
+      ;;
+    netbsd*)
+      # NetBSD users, improve me!
+      flags=(
+	'*:package name:_bsd_pkg_pkgs'
+      )
+      ;;
+    esac
+
+    _arguments -s \
+      $flags[@]
+      ;;
 
   pkg_delete)
     flags=(


-- 
                     /
                    /__  __            Akinori.org / MUSHA.org
                   / )  )  ) )  /     FreeBSD.org / Ruby-lang.org
Akinori MUSHA aka / (_ /  ( (__(  @ iDaemons.org / and.or.jp

"When I leave I don't know what I'm hoping to find
              When I leave I don't know what I'm leaving behind.."

