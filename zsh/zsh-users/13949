From zsh-users-return-13949-mason-zsh=primenet.com.au@sunsite.dk Fri Mar 20 13:38:41 2009
Return-Path: <zsh-users-return-13949-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 311 invoked from network); 20 Mar 2009 13:38:37 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 20 Mar 2009 13:38:37 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 51551 invoked from network); 20 Mar 2009 13:38:23 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 20 Mar 2009 13:38:23 -0000
Received: (qmail 12962 invoked by alias); 20 Mar 2009 13:38:05 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13949
Received: (qmail 12950 invoked from network); 20 Mar 2009 13:38:04 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 20 Mar 2009 13:38:04 -0000
Received: from prunille.vinc17.org (vinc17.pck.nerim.net [213.41.242.187])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 13C2982CF026
	for <zsh-users@sunsite.dk>; Fri, 20 Mar 2009 14:38:00 +0100 (CET)
Received: by prunille.vinc17.org (Postfix, from userid 501)
	id 1BE2434B7879; Fri, 20 Mar 2009 14:37:59 +0100 (CET)
Date: Fri, 20 Mar 2009 14:37:58 +0100
From: Vincent Lefevre <vincent@vinc17.org>
To: Zsh Users List <zsh-users@sunsite.dk>
Cc: TjL <luomat@gmail.com>
Subject: Re: up-arrow no longer works right
Message-ID: <20090320133758.GD22844@prunille.vinc17.org>
Mail-Followup-To: Zsh Users List <zsh-users@sunsite.dk>,
	TjL <luomat@gmail.com>
References: <d2ecb10b0903191838y68e1dfbbsa80289a52256eb2a@mail.gmail.com> <20090320024835.GA64103@redoubt.spodhuis.org> <d2ecb10b0903192303h1f9b0487g335cd5335f708ff@mail.gmail.com> <20090320071556.GA63370@redoubt.spodhuis.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <20090320071556.GA63370@redoubt.spodhuis.org>
X-Mailer-Info: http://www.vinc17.org/mutt/
User-Agent: Mutt/1.5.19-vl-r28329 (2009-03-19)
X-Virus-Scanned: ClamAV 0.92.1/9144/Fri Mar 20 11:51:14 2009 on bifrost
X-Virus-Status: Clean

On 2009-03-20 00:15:57 -0700, Phil Pennock wrote:
> So, if you want the up-key to always invoke a particular widgit, then
> you need to bind *two* different escape sequences: both the normal \e[A
> and also \eOA (where the escape sequence ESC is in more modern
> environments written \e but in older setups is written ^[ instead).

Alternatively, I think that something like

  [[ -n $TTY && -n $terminfo ]] && print -n "$terminfo[rmkx]" > $TTY

in precmd() should work around this problem.

Also, I've recently had a problem with the arrow keys after typing
Ctrl-Z (to background a graphical application) and "bg": sometimes
the escape sequences are output to the terminal, even though they
are interpreted by zsh; typing [Enter] is sufficient to get the
normal behavior back.

For instance:

vin:~> emacs file1                                                    <14:28:38
^Zzsh: suspended  eclient file1
zsh: exit 20
vin:~[20]> bg                                                         <14:28:47
[1]  + continued  eclient file1
vin:~>                                                                <14:28:48
[1]  + done       eclient file1
vin:~> emacs file1                                                    <14:28:51
^Zzsh: suspended  eclient file1
zsh: exit 20
vin:~[20]> bg                                                         <14:28:54
[1]  + continued  eclient file1
vin:~> ^[[A^[[A^[[A                                                   <14:28:55
bg         
bg: job already in background

As you can see, there's no problem after the first bg. But after the
second one, I get a ^[[A (in normal characters, so this is not like
quote-insert, where ^[ appears in reverse video) for each up-arrow.
When I hit [Enter], one can see that zsh recalled the first "bg"
command from the history.

This is with the zsh 4.3.9-3 Debian package.

-- 
Vincent Lefèvre <vincent@vinc17.org> - Web: <http://www.vinc17.org/>
100% accessible validated (X)HTML - Blog: <http://www.vinc17.org/blog/>
Work: CR INRIA - computer arithmetic / Arenaire project (LIP, ENS-Lyon)

