From zsh-workers-return-13084-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Oct 25 10:51:28 2000
Return-Path: <zsh-workers-return-13084-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15075 invoked from network); 25 Oct 2000 10:51:26 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 25 Oct 2000 10:51:26 -0000
Received: (qmail 12814 invoked by alias); 25 Oct 2000 10:51:21 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 13084
Received: (qmail 12806 invoked from network); 25 Oct 2000 10:51:21 -0000
Date: Wed, 25 Oct 2000 12:51:19 +0200 (MET DST)
Message-Id: <200010251051.MAA25260@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: mason@primenet.com.au's message of 25 Oct 2000 10:24:14 GMT
Subject: Re: bug with completion (after 15 oct?)


Geoff Wing wrote:

> ...
> 
> OK, if that's what you committed, then here's the next quirk:
> (continuation from same situation as before)
> 
> % ls ba<TAB><TAB><TAB><TAB><TAB>
> # gives
> % ls bar bar bar
> # when I think it should still be cycling between them.  I'll have to
> # check the setopt's I gave but historically it would.  Of course, it
> # doesn't coredump :-)  So that's better!

Ouch. There is now a cleanup-redisplay which should only be called
conditionally. It cleared `noselect', making the following tests fail.

Bye
 Sven

Index: Src/Zle/complist.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/complist.c,v
retrieving revision 1.36
diff -u -r1.36 complist.c
--- Src/Zle/complist.c	2000/10/25 08:18:45	1.36
+++ Src/Zle/complist.c	2000/10/25 10:51:02
@@ -2270,7 +2270,12 @@
 	menucmp = 2;
 	showinglist = -2;
 	minfo.asked = 0;
-	zrefresh();
+	if (!noselect) {
+	    int nos = noselect;
+
+	    zrefresh();
+	    noselect = nos;
+	}
     }
     if (!noselect && (!dat || acc)) {
 	showinglist = -2;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

