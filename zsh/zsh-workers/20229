From zsh-workers-return-20229-mason-zsh=primenet.com.au@sunsite.dk Fri Jul 30 17:13:12 2004
Return-Path: <zsh-workers-return-20229-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1952 invoked from network); 30 Jul 2004 17:13:11 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 30 Jul 2004 17:13:11 -0000
Received: (qmail 32090 invoked from network); 30 Jul 2004 17:13:05 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 30 Jul 2004 17:13:05 -0000
Received: (qmail 14230 invoked by alias); 30 Jul 2004 17:12:30 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20229
Received: (qmail 14220 invoked from network); 30 Jul 2004 17:12:30 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by 130.225.247.90 with SMTP; 30 Jul 2004 17:12:30 -0000
Received: (qmail 29913 invoked from network); 30 Jul 2004 17:10:32 -0000
Received: from mail36.messagelabs.com (193.109.254.211)
  by a.mx.sunsite.dk with SMTP; 30 Jul 2004 17:10:30 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-7.tower-36.messagelabs.com!1091207429!8099625
X-StarScan-Version: 5.2.10; banners=-,-,-
X-Originating-IP: [158.234.9.163]
Received: (qmail 22029 invoked from network); 30 Jul 2004 17:10:29 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-7.tower-36.messagelabs.com with SMTP; 30 Jul 2004 17:10:29 -0000
Received: from trentino.logica.co.uk ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id i6UHATUI025358;
	Fri, 30 Jul 2004 18:10:29 +0100
Received: from trentino.logica.co.uk (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP
	id 16819796A37E; Fri, 30 Jul 2004 19:09:45 +0200 (CEST)
Cc: Vincent Lefevre <vincent@vinc17.org>, 262157-forwarded@bugs.debian.org,
   zsh-workers@sunsite.dk
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <20040730154111.GB4059@scowler.net> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <20040729225547.GA3042@ay.vinc17.org> <20040730154111.GB4059@scowler.net>
To: Clint Adams <schizo@debian.org>
Subject: Re: Bug#262157: zsh: Missed completion for apt-get install -t unstable 
Date: Fri, 30 Jul 2004 19:09:45 +0200
Message-ID: <5843.1091207385@trentino.logica.co.uk>
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_40 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0

Clint wrote:
> >   apt-get install -t unstable pbb[TAB]
> > 
> > and zsh completed it to pbbuttonsd-dev, though I wanted to install
> > the unstable version of pbbuttonsd.
> 
> I see three options:
> 
> a) status quo
> b) complete pbuttonsd even if it's already installed and pbuttonsd-dev
>    matches

It should do that anyway! apt-get install can be used to upgrade a single
package that is already installed. If we don't take account of things
like -t unstable then this option is definitely the way to go.

> c) add intelligence to figure out whether or not one is trying to
>    install a different version of an installed package (or the same
>    version if --reinstall is given)

Good luck making sense of _regex_arguments.

We really ought to rewrite apt-get completion without using
_regex_arguments. _regex_arguments is a nice idea and if it didn't rely
on nasty things like all the nulls, it could be quite good. Would be
nice if apt completion took account of things like --reinstall and used
separate tags for already installed packages and uninstalled ones etc.

It is also the case that stuff like:
_deb_packages_cache_uninstalled=( $(print -l $_deb_packages_cache_avail $_deb_packages_cache_installed|sort|uniq -u) )
is actually faster than the zsh stuff it currently does. We ought to be
careful about blindly assuming the native zsh stuff is quicker.

I've sort of meant to do something about deb completion but I've not
had the time. I also started using aptitude's command-line interface
instead so care less about apt-get. (aptitude seems to be able to
keep track of stuff that was only installed to fulfill a dependency).

Oliver

