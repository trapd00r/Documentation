From zsh-users-return-12918-mason-zsh=primenet.com.au@sunsite.dk Fri Jun 13 19:19:39 2008
Return-Path: <zsh-users-return-12918-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2619 invoked from network); 13 Jun 2008 19:19:36 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 13 Jun 2008 19:19:36 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 17477 invoked from network); 13 Jun 2008 19:19:20 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 13 Jun 2008 19:19:20 -0000
Received: (qmail 8719 invoked by alias); 13 Jun 2008 19:19:11 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12918
Received: (qmail 8707 invoked from network); 13 Jun 2008 19:19:10 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 13 Jun 2008 19:19:10 -0000
Received: from mail.o2.co.uk (yoda.london.02.net [82.132.130.151])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 4D4418028AC3
	for <zsh-users@sunsite.dk>; Fri, 13 Jun 2008 21:19:07 +0200 (CEST)
Received: from sc.homeunix.net (78.105.216.138) by mail.o2.co.uk (8.0.013.3) (authenticated as stephane.chazelas)
        id 4851DD950024332F for zsh-users@sunsite.dk; Fri, 13 Jun 2008 20:19:06 +0100
Received: from chazelas by sc.homeunix.net with local (Exim 4.69)
	(envelope-from <stephane_chazelas@yahoo.fr>)
	id 1K7Eni-0005VD-56
	for zsh-users@sunsite.dk; Fri, 13 Jun 2008 20:19:06 +0100
Date: Fri, 13 Jun 2008 20:19:06 +0100
From: Stephane Chazelas <Stephane_Chazelas@yahoo.fr>
To: zsh-users@sunsite.dk
Subject: Re: strace completion (Re: grouping/joining _values)
Message-ID: <20080613191905.GN5113@sc.homeunix.net>
Mail-Followup-To: zsh-users@sunsite.dk
References: <20080607193937.GA14443@pepin.polanet.pl> <20080613002731.GA11526@pepin.polanet.pl> <20080613113302.GA40053@redoubt.spodhuis.org> <20080613121226.GA18890@scru.org> <20080613131851.GA12764@redoubt.spodhuis.org> <20080613160458.GM5113@sc.homeunix.net>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-15
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <20080613160458.GM5113@sc.homeunix.net>
User-Agent: Mutt/1.5.16 (2007-09-19)
X-Virus-Scanned: ClamAV 0.92.1/7469/Fri Jun 13 20:01:29 2008 on bifrost
X-Virus-Status: Clean

On Fri, Jun 13, 2008 at 05:04:58PM +0100, Stephane Chazelas wrote:
[...]
> > > > Are there any other useful strategies for extracting the real list of
> > > > syscalls at runtime, so that on systems which package up the same
> > > > version of zsh for N years the list doesn't grow stale?
[...]
> You could get the list from strace itself with:
> 
> ltrace -e strcmp strace -e xxx |& awk -F\" '
>   /xxx/&&/strcmp/{print $4}' | sort -u
[...]

It should be noted that you get a different list (at least here
on a debian system) if you build with -O0 or -O2.

With -O2, you don't get the pseudo ones:

  all
  desc
  file
  network
  none
  process

Same for the signal names for strace -e signal=xxx

Basically, those are cases where the code has

strcmp(var, "blah")
where the compiler is probably unrolling the strcmp as an
optimisation.

as opposed to strcmp(var, othervar).

Of course, you need ltrace installed and strace has to be
dynamically linked.

Another way could be to use a gdb script or a LD_PRELOAD hack.

If strace has been built with debug it's straightforward with
gdb, or with a little more effort with objdump. If not, it's
also possible to use objdump and strings but with some
heuristics to try and find where the table that holds the
syscall name list starts.

-- 
Stéphane

