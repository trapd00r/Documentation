From zsh-workers-return-22801-mason-zsh=primenet.com.au@sunsite.dk Sun Oct 01 14:49:37 2006
Return-Path: <zsh-workers-return-22801-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8722 invoked from network); 1 Oct 2006 14:49:34 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.5 (2006-08-29) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 1 Oct 2006 14:49:34 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 90289 invoked from network); 1 Oct 2006 14:49:24 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 1 Oct 2006 14:49:24 -0000
Received: (qmail 10584 invoked by alias); 1 Oct 2006 14:49:19 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22801
Received: (qmail 16768 invoked from network); 26 Sep 2006 17:27:39 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 26 Sep 2006 17:27:39 -0000
Received: (qmail 48554 invoked from network); 26 Sep 2006 17:27:39 -0000
Received: from lucien.blight.com (204.10.50.50)
  by a.mx.sunsite.dk with SMTP; 26 Sep 2006 17:27:38 -0000
Received: from lucien.blight.com (localhost [127.0.0.1])
	by lucien.blight.com (0.0.0/0.0.0) with ESMTP id k8QHQpxx032687;
	Tue, 26 Sep 2006 12:26:51 -0500
Received: (from larold@localhost)
	by lucien.blight.com (0.0.0/0.0.0) id k8QHQpJW032685;
	Tue, 26 Sep 2006 12:26:51 -0500
Date: Tue, 26 Sep 2006 12:26:51 -0500
From: "Larry P. Schrof" <larry@schrof.net>
To: Peter Stephenson <pws@csr.com>
Cc: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: (Revisited): zsh + less == hard hang of tty.
Message-ID: <20060926172651.GB29060@lucien.blight.com>
References: <20060926142946.GA1608@lucien.blight.com> <200609261700.k8QH0eVd001791@news01.csr.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <200609261700.k8QH0eVd001791@news01.csr.com>
User-Agent: Mutt/1.4.2i

I apologize - I do not have strace output yet.

Potentially useful info, however:

- zsh -c 'less <FILE>' DOES HANG

- When I get a Linux tty to hang by doing this, log in on another tty,
  and kill the *less* process, it terminates, and any I/O that was in
  the buffer (from my extra keystrokes while less was hung) get
  interpreted by the shell. zsh becomes responsive again.

  (For example, once I hang the tty, I press enter three times, then
  type 'asdf'. Then, I kill less from another tty, and zsh spits out several
  new prompts, and 'asdf' is waiting there on the command-line. Everything
  I type while less is hung eventually gets passed to zsh once I kill less.)

- I can't reproduce this on an old RedHat 7.2 box with zsh 4.0.2 and
  less 358+iso248 (version string from 'less --version')

strace output soon.

- Larry

On Tue, Sep 26, 2006 at 06:00:39PM +0100, Peter Stephenson wrote:
> "Larry P. Schrof" wrote:
> > When in zsh, if I do: less <some_file>, the terminal HARD HANGS.
> 
> It sounds like this is reproducible in your case.  Since this doesn't
> seem to be a general problem, we need to find out what's different.
> 
> Does the same happen with
> 
>   zsh -c 'less <file>'
> 
> or, if not, with
> 
>   zsh -ic 'less <file>'
> 
> (which has interactive handling turned on)?  If so, the last few entries
> you get with "strace" in front of the appropriate one might be
> interesting.  You might get a huge amount of output in the second case
> owing to initialisation files.
> 
> Otherwise, use gdb to attach to the hung process in question.  This is
> most useful if zsh was compiled with debugging (configure
> --enable-zsh-debug does that).
> 
> % gdb zsh
> (gdb) attach 14183
> (gdb) bt
> 
> However, it might actually be hung in less and zsh is simply waiting for
> that to finish.
> 
> -- 
> Peter Stephenson <pws@csr.com>                  Software Engineer
> CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
> Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070
> 
> 
> To access the latest news from CSR copy this link into a web browser:  http://www.csr.com/email_sig.php

