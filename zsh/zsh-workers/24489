From zsh-workers-return-24489-mason-zsh=primenet.com.au@sunsite.dk Tue Jan 29 22:03:33 2008
Return-Path: <zsh-workers-return-24489-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8026 invoked from network); 29 Jan 2008 22:03:30 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.7 required=5.0 tests=AWL,BAYES_00,
	RCVD_IN_NJABL_PROXY autolearn=no version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 29 Jan 2008 22:03:30 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 19281 invoked from network); 29 Jan 2008 22:03:25 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 29 Jan 2008 22:03:25 -0000
Received: (qmail 1803 invoked by alias); 29 Jan 2008 22:03:20 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24489
Received: (qmail 1790 invoked from network); 29 Jan 2008 22:03:19 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 29 Jan 2008 22:03:19 -0000
Received: from uludag.org.tr (ns2.uludag.org.tr [193.140.100.220])
	by bifrost.dotsrc.org (Postfix) with ESMTP id B821180190F6
	for <zsh-workers@sunsite.dk>; Tue, 29 Jan 2008 23:03:15 +0100 (CET)
Received: from ninjamobile.local (unknown [85.97.107.239])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by uludag.org.tr (Postfix) with ESMTP id B2D4062081E3;
	Wed, 30 Jan 2008 00:03:05 +0200 (EET)
From: Ismail =?utf-8?q?D=C3=B6nmez?= <ismail@pardus.org.tr>
Organization: Pardus / KDE
To: zsh-workers@sunsite.dk
Subject: Fwd: Re: zsh compilation problem with autoconf git
Date: Wed, 30 Jan 2008 00:03:33 +0200
User-Agent: KMail/1.9.8
MIME-Version: 1.0
Cc: Ralf Wildenhues <Ralf.Wildenhues@gmx.de>, bug-autoconf@gnu.org
Content-Type: Multipart/Mixed;
  boundary="Boundary-00=_1K6nHnBRYuCYyV6"
Message-Id: <200801300003.33400.ismail@pardus.org.tr>
X-Virus-Scanned: ClamAV 0.91.2/5599/Tue Jan 29 17:27:10 2008 on bifrost
X-Virus-Status: Clean

--Boundary-00=_1K6nHnBRYuCYyV6
Content-Type: text/plain;
  charset="utf-8"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline

Hi Ralf,

I am forwarding your message to zsh-workers list. To summarise the issue zs=
h=20
modules are not compiled with upcoming autoconf 2.62 and Ralf successfully=
=20
identified that zsh/Src/mkmakemod.sh does some unportable stuff :

=C2=A0 =C2=A0 # check 2.13, 2.50, and 2.60 syntaxes
=C2=A0 =C2=A0 if grep '%@D@%D%' config.status >/dev/null ||
=C2=A0 =C2=A0 =C2=A0 =C2=A0grep ',@D@,D,' config.status >/dev/null ||
=C2=A0 =C2=A0 =C2=A0 =C2=A0grep ',@D@,|#_!!_#|D,' config.status >/dev/null;=
 then
=C2=A0 =C2=A0 =C2=A0 =C2=A0 is_dynamic=3Dtrue
=C2=A0 =C2=A0 else
=C2=A0 =C2=A0 =C2=A0 =C2=A0 is_dynamic=3Dfalse
=C2=A0 =C2=A0 fi

So the question is, is this thing needed at all, if yes why?

=2D-=20
Never learn by your mistakes, if you do you may never dare to try again.

--Boundary-00=_1K6nHnBRYuCYyV6
Content-Type: message/rfc822;
  name="forwarded message"
Content-Transfer-Encoding: 7bit
Content-Description: Ralf Wildenhues <Ralf.Wildenhues@gmx.de>: Re: zsh compilation problem with autoconf git
Content-Disposition: inline

Return-Path: <bug-autoconf-bounces+ismail=pardus.org.tr@gnu.org>
X-Original-To: ismail@pardus.org.tr
Delivered-To: ismail@pardus.org.tr
Received: from lists.gnu.org (lists.gnu.org [199.232.76.165])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by uludag.org.tr (Postfix) with ESMTP id 98A366201651
	for <ismail@pardus.org.tr>; Tue, 29 Jan 2008 23:58:45 +0200 (EET)
Received: from localhost ([127.0.0.1] helo=lists.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.43)
	id 1JJyTj-0003SI-Su
	for ismail@pardus.org.tr; Tue, 29 Jan 2008 16:58:51 -0500
Received: from mailman by lists.gnu.org with tmda-scanned (Exim 4.43)
	id 1JJyTh-0003Rs-ME
	for bug-autoconf@gnu.org; Tue, 29 Jan 2008 16:58:49 -0500
Received: from exim by lists.gnu.org with spam-scanned (Exim 4.43)
	id 1JJyTf-0003RK-NL
	for bug-autoconf@gnu.org; Tue, 29 Jan 2008 16:58:48 -0500
Received: from [199.232.76.173] (helo=monty-python.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.43) id 1JJyTf-0003RH-Gp
	for bug-autoconf@gnu.org; Tue, 29 Jan 2008 16:58:47 -0500
Received: from merkur.ins.uni-bonn.de ([131.220.223.13])
	by monty-python.gnu.org with esmtp (Exim 4.60)
	(envelope-from <Ralf.Wildenhues@gmx.de>) id 1JJyTf-00072F-BD
	for bug-autoconf@gnu.org; Tue, 29 Jan 2008 16:58:47 -0500
Received: from localhost.localdomain (xdsl-87-78-95-82.netcologne.de
	[87.78.95.82])
	by merkur.ins.uni-bonn.de (Postfix) with ESMTP id 32B7E4000024B;
	Tue, 29 Jan 2008 22:58:45 +0100 (CET)
Received: from ralf by localhost.localdomain with local (Exim 4.63)
	(envelope-from <Ralf.Wildenhues@gmx.de>)
	id 1JJyTZ-0005ja-Fx; Tue, 29 Jan 2008 22:58:41 +0100
Date: Tue, 29 Jan 2008 22:58:41 +0100
From: Ralf Wildenhues <Ralf.Wildenhues@gmx.de>
To: Ismail =?iso-8859-1?Q?D=F6nmez?= <ismail@pardus.org.tr>
Message-ID: <20080129215840.GA11536@ins.uni-bonn.de>
Mail-Followup-To: Ismail =?iso-8859-1?Q?D=F6nmez?= <ismail@pardus.org.tr>,
	bug-autoconf@gnu.org
References: <200801290443.03504.ismail@pardus.org.tr>
	<200801292203.44329.ismail@pardus.org.tr>
	<20080129203209.GB9329@ins.uni-bonn.de>
	<200801292238.34029.ismail@pardus.org.tr>
MIME-Version: 1.0
Content-Type: text/plain;
  charset=iso-8859-1
Content-Disposition: inline
In-Reply-To: <200801292238.34029.ismail@pardus.org.tr>
Organization: Department of Numerical Simulation, University of Bonn
User-Agent: Mutt/1.5.13 (2006-08-11)
Content-Transfer-Encoding: quoted-printable
X-detected-kernel: by monty-python.gnu.org: Linux 2.6 (newer, 3)
Cc: bug-autoconf@gnu.org
Subject: Re: zsh compilation problem with autoconf git
X-BeenThere: bug-autoconf@gnu.org
X-Mailman-Version: 2.1.5
Precedence: list
List-Id: Bug reports for autoconf <bug-autoconf.gnu.org>
List-Unsubscribe: <http://lists.gnu.org/mailman/listinfo/bug-autoconf>,
	<mailto:bug-autoconf-request@gnu.org?subject=unsubscribe>
List-Archive: <http://lists.gnu.org/pipermail/bug-autoconf>
List-Post: <mailto:bug-autoconf@gnu.org>
List-Help: <mailto:bug-autoconf-request@gnu.org?subject=help>
List-Subscribe: <http://lists.gnu.org/mailman/listinfo/bug-autoconf>,
	<mailto:bug-autoconf-request@gnu.org?subject=subscribe>
X-Mailman-Copy: yes
Sender: bug-autoconf-bounces+ismail=pardus.org.tr@gnu.org
Errors-To: bug-autoconf-bounces+ismail=pardus.org.tr@gnu.org
X-Length: 5322
X-UID: 173651

* Ismail D=F6nmez wrote on Tue, Jan 29, 2008 at 09:38:33PM CET:
>=20
> Sure, just grab zsh.git and create two copies of it, and do
[...]
> now if you compare zsh & zsh2 you will see that zsh directory have bunc=
h of=20
> shared objects in Src/Modules where as zsh2 have none.

Confirmed.  But with Autoconf 2.59 vs mainline, not 2.61a.
zsh/Src/mkmakemod.sh does ugly and nonsupported things such as
grepping config.status for values:

    # check 2.13, 2.50, and 2.60 syntaxes
    if grep '%@D@%D%' config.status >/dev/null ||
       grep ',@D@,D,' config.status >/dev/null ||
       grep ',@D@,|#_!!_#|D,' config.status >/dev/null; then
        is_dynamic=3Dtrue
    else
        is_dynamic=3Dfalse
    fi

That looks dubious, and should be fixed.  Further, I don't know why it
should be needed.  When config.status' documented interfaces are used,
there is no need to grep it.  grepping it is explicitly not supported.
Autoconf 2.62's config.status will internally work differently again as
2.61a (more efficiently), and we won't hesitate to change it in again in
every future version if changes help do things better in some way.

If zsh authors can explain why the above should be needed, we may be
able to see whether there is (or was) a bug in Autoconf to be worked
around, and then we can add that to the Autoconf test suite to ensure
that we don't regress.

I can get things to work fine with a hack as below.

Cheers,
Ralf


diff --git a/Src/mkmakemod.sh b/Src/mkmakemod.sh
index d275038..8e9cee5 100644
--- a/Src/mkmakemod.sh
+++ b/Src/mkmakemod.sh
@@ -114,7 +114,8 @@ if $first_stage; then
     # check 2.13, 2.50, and 2.60 syntaxes
     if grep '%@D@%D%' config.status >/dev/null ||
        grep ',@D@,D,' config.status >/dev/null ||
-       grep ',@D@,|#_!!_#|D,' config.status >/dev/null; then
+       grep ',@D@,|#_!!_#|D,' config.status >/dev/null ||
+       :; then
 	is_dynamic=3Dtrue
     else
 	is_dynamic=3Dfalse



--Boundary-00=_1K6nHnBRYuCYyV6--

