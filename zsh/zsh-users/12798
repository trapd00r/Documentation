From zsh-users-return-12798-mason-zsh=primenet.com.au@sunsite.dk Sun Apr 20 16:42:23 2008
Return-Path: <zsh-users-return-12798-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15381 invoked from network); 20 Apr 2008 16:42:21 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 20 Apr 2008 16:42:21 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 29227 invoked from network); 20 Apr 2008 16:42:05 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 20 Apr 2008 16:42:05 -0000
Received: (qmail 17966 invoked by alias); 20 Apr 2008 16:41:55 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12798
Received: (qmail 17948 invoked from network); 20 Apr 2008 16:41:54 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 20 Apr 2008 16:41:54 -0000
Received: from mtaout01-winn.ispmail.ntl.com (mtaout01-winn.ispmail.ntl.com [81.103.221.47])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 38C2D808A37A
	for <zsh-users@sunsite.dk>; Sun, 20 Apr 2008 18:41:49 +0200 (CEST)
Received: from aamtaout01-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout01-winn.ispmail.ntl.com with ESMTP
          id <20080420164456.MFUZ27050.mtaout01-winn.ispmail.ntl.com@aamtaout01-winn.ispmail.ntl.com>
          for <zsh-users@sunsite.dk>; Sun, 20 Apr 2008 17:44:56 +0100
Received: from pws-pc ([81.107.40.67]) by aamtaout01-winn.ispmail.ntl.com
          with ESMTP
          id <20080420164600.RWNJ219.aamtaout01-winn.ispmail.ntl.com@pws-pc>
          for <zsh-users@sunsite.dk>; Sun, 20 Apr 2008 17:46:00 +0100
Date: Sun, 20 Apr 2008 17:41:16 +0100
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: "Zsh Users" <zsh-users@sunsite.dk>
Subject: Re: Some questions about Zsh internals (zmodules)
Message-ID: <20080420174116.318045a4@pws-pc>
In-Reply-To: <cb59c2d10804191804oe333786t5822d4d30ad531c3@mail.gmail.com>
References: <cb59c2d10804191804oe333786t5822d4d30ad531c3@mail.gmail.com>
X-Mailer: Claws Mail 3.3.1 (GTK+ 2.12.5; x86_64-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: ClamAV 0.91.2/6849/Sun Apr 20 17:37:54 2008 on bifrost
X-Virus-Status: Clean

On Sun, 20 Apr 2008 01:04:01 +0000
"Johann \"Myrkraverk\" Oskarsson" <johann@myrkraverk.com> wrote:
> The Zsh developers guide mentions reading about the zmodload -F but
> that is not covered in my copy of the zshmodules man page.  Is that an
> oversight, or is the documentation somewhere else?

If you've found the zmodload documentation corresponding to the version
you're talking about you should see it, but it's in the zshbuiltins
manual page.  Note this is new in 4.3.5.

> More specifically,
> that's not in the online version of the manual either.

This doesn't always get updated and it looks like it's way out of date.
Ideally we should have separate manuals for the stable and development
branches.  Could somebody volunteer for this?  I have way, way, way too
much to do already.

> When I want to create a builtin that takes integers or floating point
> (double) arguments, do I really need to parse all that stuff myself,
> or does the shell have any support for that?  Is there a zsh specific
> API for it, or is there only the C library?

It has it, but at this level you'll just have to look at the shell's
internals to get it.    The usual way of getting it would be

  mnumber mn = matheval(*args);

Note this actually allows expressions, not just numbers.  There's a kind
of unwritten convention that the shell does this, but in a module
there's no reason why you should have to go to such lengths.  One good
reason for it, however, is that fully parsing the expression in this way
is the best way of getting the shell to decide whether the number is
integer or floating point.

mnumber is a discriminated unoin defined in zsh.h.

> Shouldn't it be documented somewhere that passing a NULL for the flags
> parameter in the builtin list disables flag handling by the shell?

Yes, probably.

Index: Etc/zsh-development-guide
===================================================================
RCS file: /cvsroot/zsh/zsh/Etc/zsh-development-guide,v
retrieving revision 1.18
diff -u -r1.18 zsh-development-guide
--- Etc/zsh-development-guide	3 Feb 2008 18:17:13 -0000	1.18
+++ Etc/zsh-development-guide	20 Apr 2008 16:33:56 -0000
@@ -391,7 +391,8 @@
     implement multiple builtins
   - the options the builtin accepts, given as a string containing the
     option characters (the above example makes the builtin accept the
-    options `f', `l', `a', `g', and `s')
+    options `f', `l', `a', `g', and `s').  Passing NULL here disables
+    all flag handling, i.e. even "--".
   - and finally a optional string containing option characters that
     will always be reported as set when calling the C-function (this,
     too, can be used when using one C-function to implement multiple
-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

