From zsh-users-return-14237-mason-zsh=primenet.com.au@sunsite.dk Fri Jul 17 09:07:53 2009
Return-Path: <zsh-users-return-14237-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17624 invoked from network); 17 Jul 2009 09:07:50 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 17 Jul 2009 09:07:50 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 13397 invoked from network); 17 Jul 2009 09:07:29 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Jul 2009 09:07:29 -0000
Received: (qmail 4775 invoked by alias); 17 Jul 2009 09:07:03 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 14237
Received: (qmail 4762 invoked from network); 17 Jul 2009 09:07:03 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 17 Jul 2009 09:07:03 -0000
Received: from cluster-d.mailcontrol.com (cluster-d.mailcontrol.com [85.115.60.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 3B9658027106
	for <zsh-users@sunsite.dk>; Fri, 17 Jul 2009 11:06:59 +0200 (CEST)
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly20d.srv.mailcontrol.com (MailControl) with ESMTP id n6H96vGX015790
	for <zsh-users@sunsite.dk>; Fri, 17 Jul 2009 10:06:57 +0100
Received: from news01 ([10.99.50.25]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Fri, 17 Jul 2009 10:06:56 +0100
Date: Fri, 17 Jul 2009 10:06:56 +0100
From: Peter Stephenson <pws@csr.com>
To: zsh-users@sunsite.dk
Subject: Re: N=5 echo $[N-1] why doesn't it work as expected
Message-ID: <20090717100656.535be86b@news01>
In-Reply-To: <20090717073915.GA15461@miek.nl>
References: <tkrat.e1ca3b460deca95d@igpm.rwth-aachen.de>
	<20090717073915.GA15461@miek.nl>
Organization: CSR
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.8; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 17 Jul 2009 09:06:56.0847 (UTC) FILETIME=[EF6575F0:01CA06BD]
X-Scanned-By: MailControl A-09-20-00 (www.mailcontrol.com) on 10.68.0.130
X-Virus-Scanned: ClamAV 0.94.2/9578/Fri Jul 17 07:22:17 2009 on bifrost
X-Virus-Status: Clean

On Fri, 17 Jul 2009 09:39:15 +0200
Miek Gieben <miek@miek.nl> wrote:
> [ Quoting Helmut Jarausch in "N=5 echo $[N-1] why doesn't it work"... ]
> > Hi,
> > 
> > sorry for this very simple question.
> > 
> > N=2
> > N=5 echo $[N-1]
> > displays 1 - I'd expected 4.
> > Would anybody please explain why?
> 
> $N is evaluated first, so it says:
> N=5 echo $[2-1]

Kind of.  More precisely, the command line "echo $[N-1]" undergoes
expansion ending up with "echo 1".  At this point, if this was an external
command, a fork would take place and N=5 would be put permanently into the
background of the exec'd command---this is the point of the that notation,
for use inside the guts of the command being executed.  In this case it's a
shell internal command, so there's no fork, but the shell mimics the
behaviour with external commands by exporting the value before executing
the command, and then removing it afterwards.  In both cases it's too late
to affect expansion.  (So you get the same result with /bin/echo as with
echo.)

You can force the expansion to take place later with a function:

% fn() { echo $((N-1)) }
% N=5 fn
4

This illustrates what I meant by the value in the environment being "for
use inside the guts of the command being executed".

-- 
Peter Stephenson <pws@csr.com>            Software Engineer
Tel: +44 (0)1223 692070                   Cambridge Silicon Radio Limited
Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, UK


'member of the CSR plc group of companies. CSR plc registered in England and Wales, registered number 4187346, registered office Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, United Kingdom'

