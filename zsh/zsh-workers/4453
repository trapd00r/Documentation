From zsh-workers-request@math.gatech.edu Tue Oct 27 01:57:51 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3411 invoked from network); 27 Oct 1998 01:57:50 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 27 Oct 1998 01:57:50 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id UAA27278;
	Mon, 26 Oct 1998 20:50:44 -0500 (EST)
Resent-Date: Mon, 26 Oct 1998 20:50:44 -0500 (EST)
To: zsh-workers@math.gatech.edu
Subject: Explanation for no completion candidates.
MIME-Version: 1.0 (generated by SEMI 1.10.0 - "Tsubata")
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@jaist.ac.jp>
Date: 27 Oct 1998 10:50:46 +0900
Message-ID: <rsqemrueps9.fsf@crane.jaist.ac.jp>
Lines: 42
User-Agent: Chao-gnus/6.9.7 SEMI/1.10.0 (Tsubata) FLAM-DOODLE/1.11.1
 (=?ISO-2022-JP?B?GyRCSXJGOkNjGyhC?= 5.0R4.0/11.0) Emacs/20.3.91
 (sparc-sun-solaris2.6) MULE/4.0 (HANANOEN)
Resent-Message-ID: <"c4JV4.0.9g6.qRIDs"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4453
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Hi. I found that zsh 3.1.4 does not output a explanation given with
"-X" for compctl when there is no completion candidates.

% compctl -X explanation tst
% tst<Tab>

zsh-3.0.5 prints "explanation"
zsh-3.1.4 prints nothing

I think following patch fix this.
------------------------------------------------------------
--- Src/Zle/zle_tricky.c-	Tue Oct 13 00:37:17 1998
+++ Src/Zle/zle_tricky.c	Tue Oct 13 00:37:30 1998
@@ -2202,6 +2202,7 @@
 	    }
 	}
 
+      compend:
 	/* Print the explanation string if needed. */
 	if (!showinglist && expl && nmatches != 1) {
 	    int up;
@@ -2222,7 +2223,6 @@
 		putc('\n', shout);
 	    fflush(shout);
 	}
-      compend:
 	ll = strlen((char *)line);
 	if (cs > ll)
 	    cs = ll;
------------------------------------------------------------

However, zsh-3.0.5 and zsh-3.1.4 has different behavior on "-X". So
this patch does not provide perfect compatibility between 3.05 and
3.1.4.

% compctl -X ex1 + -X ex2 tst
% tst<Tab>

zsh-3.0.5 prints "ex1"
zsh-3.1.4 with this patch prints "ex2"
-- 
[Tanaka Akira]

