From zsh-users-return-11667-mason-zsh=primenet.com.au@sunsite.dk Wed Jul 25 04:40:46 2007
Return-Path: <zsh-users-return-11667-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4777 invoked from network); 25 Jul 2007 04:40:44 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.1 (2007-05-02) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 Jul 2007 04:40:44 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 62220 invoked from network); 25 Jul 2007 04:40:35 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 25 Jul 2007 04:40:35 -0000
Received: (qmail 29495 invoked by alias); 25 Jul 2007 04:40:26 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11667
Received: (qmail 29482 invoked from network); 25 Jul 2007 04:40:26 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 25 Jul 2007 04:40:26 -0000
Received: (qmail 60924 invoked from network); 25 Jul 2007 04:40:25 -0000
Received: from vms046pub.verizon.net (206.46.252.46)
  by a.mx.sunsite.dk with SMTP; 25 Jul 2007 04:40:22 -0000
Received: from torch.brasslantern.com ([71.116.66.200])
 by vms046.mailsrvcs.net (Sun Java System Messaging Server 6.2-6.01 (built Apr
 3 2006)) with ESMTPA id <0JLP00724WZ8G9S2@vms046.mailsrvcs.net> for
 zsh-users@sunsite.dk; Tue, 24 Jul 2007 23:40:21 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id l6P4eJUG004661	for
 <zsh-users@sunsite.dk>; Tue, 24 Jul 2007 21:40:19 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id l6P4eIEX004660	for zsh-users@sunsite.dk; Tue,
 24 Jul 2007 21:40:18 -0700
Date: Tue, 24 Jul 2007 21:40:18 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: did the way arrays get indexed change between 4.2 and 4.3?
In-reply-to: <19FD3CB1-1DA7-4FFC-B369-418748C70F73@chemistry.ucsc.edu>
To: zsh-users@sunsite.dk
Message-id: <070724214018.ZM4659@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <19FD3CB1-1DA7-4FFC-B369-418748C70F73@chemistry.ucsc.edu>
Comments: In reply to William Scott <wgscott@chemistry.ucsc.edu>
 "did the way arrays get indexed change between 4.2 and 4.3?" (Jul 24,  4:14pm)

On Jul 24,  4:14pm, William Scott wrote:
}
}          rlength="20"
}          echo -ne "\e]1;$tab_label[-$rlength,-1]\a"
} 
} On 4.3.4 this works great.  On 4.2.3, if the original string has  
} fewer than 20 characters, the tab is blank.

The flavor of this that works is very recent.  What you're seeing in
4.2.3 is what you'll find pretty much universally in "stable" versions
of the shell shipped with various OSs and Linux versions.

I'm not sure which of PWS's array changes led to this handling of out-
of-bounds indices on strings, and I'm not sure it was intentional
although it makes some sense.  Previously all invalid positions were
considered to be off the right end of the array, and a range from
right to left produces an empty result.
 
} Is there a decent work-around, as I hate to conditionally test for  
} the zsh version every time the tab dynamically updates.

There's a much simpler formulation that works the same (AFAIK) in all
versions that have the (l) (that's a lowercase L) parameter flag:

	echo -ne "\e]1;${(l:rlength:)tab_label}\a"

