From zsh-workers-return-17820-mason-zsh=primenet.com.au@sunsite.dk Mon Oct 14 08:53:11 2002
Return-Path: <zsh-workers-return-17820-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27036 invoked from network); 14 Oct 2002 08:53:10 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 14 Oct 2002 08:53:10 -0000
Received: (qmail 10535 invoked by alias); 14 Oct 2002 08:53:02 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 17820
Received: (qmail 10521 invoked from network); 14 Oct 2002 08:53:01 -0000
From: Borzenkov Andrey <Andrej.Borsenkow@mow.siemens.ru>
To: "'Hannu Koivisto'" <azure@iki.fi>, zsh-workers@sunsite.dk
Subject: RE: Cygwin 1.3.12/zsh 4.0.6/zftp.c compilation problem
Date: Mon, 14 Oct 2002 12:52:45 +0400
Message-ID: <6134254DE87BD411908B00A0C99B044F03A0B47D@mowd019a.mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook, Build 10.0.4024
In-Reply-To: <87y997eslb.fsf@lynx.ionific.com>
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2800.1106
Importance: Normal



> Greetings,
> 
> zsh 4.0.6 fails to compile under the latest Cygwin (1.3.12) because
> zftp.c includes netinet/ip.h but not netinet/in_systm.h:
> 
> #ifndef __CYGWIN__
> # include <netinet/in_systm.h>
> #endif
> #include <netinet/in.h>
> #include <netinet/ip.h>
> 
> netinet/ip.h refers to at least n_long which is defined in
> netinet/in_systm.h (or more precicely, in cygwin/in_systm.h that
> netinet/in_systm.h includes) so netinet/in_systm.h is needed.  If I
> comment out the first and the third lines in the above code, zsh
> compiles and seems to work.
> 

You sure have heard about "compatibility"? :-)

Does the following patch works?

-andrey

===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/zftp.c,v
retrieving revision 1.12.4.2
diff -u -r1.12.4.2 zftp.c
--- Src/Modules/zftp.c  25 Apr 2002 14:48:21 -0000      1.12.4.2
+++ Src/Modules/zftp.c  14 Oct 2002 08:51:50 -0000
@@ -68,9 +68,9 @@
  * __USE_LARGEFILE.  This means the problem is somewhere in the
  * header files where we can't get at it.  For now, revert to
  * not including this file only on systems where we know it's missing.
- * Currently this is just cygwin.
+ * Currently this is just older versions of cygwin.
  */
-#ifndef __CYGWIN__
+#if HAVE_NETINET_IN_SYSTM_H || !defined( __CYGWIN__)
 # include <netinet/in_systm.h>
 #endif
 #include <netinet/in.h>

