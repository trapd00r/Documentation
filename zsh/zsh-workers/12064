From zsh-workers-return-12064-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Jun 26 01:37:47 2000
Return-Path: <zsh-workers-return-12064-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2133 invoked from network); 26 Jun 2000 01:37:46 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 26 Jun 2000 01:37:46 -0000
Received: (qmail 13110 invoked by alias); 26 Jun 2000 01:37:34 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12064
Received: (qmail 13103 invoked from network); 26 Jun 2000 01:37:33 -0000
Date: Mon, 26 Jun 2000 02:37:32 +0100
From: Adam Spiers <adam@spiers.net>
To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Subject: segfault with _rpm completion
Message-ID: <20000626023732.A5352@thelonious.new.ox.ac.uk>
Reply-To: Adam Spiers <adam@spiers.net>
Mail-Followup-To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 1.0.1i
X-Home-Page: http://www.new.ox.ac.uk/~adam/
X-OS: RedHat Linux

Hi all, 

Latest cvs zsh dumps core after

  $ zsh -f
  $ autoload compinit; compinit
  $ rpm -qf /<TAB>

Here's the juicy bits.  Sorry they're so horrendously long.

GNU gdb 19991004
Copyright 1998 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i386-redhat-linux"...
Core was generated by `zsh'.
Program terminated with signal 11, Segmentation fault.
Reading symbols from /lib/libdl.so.2...done.
Reading symbols from /lib/libnsl.so.1...done.
Reading symbols from /lib/libtermcap.so.2...done.
Reading symbols from /lib/libm.so.6...done.
Reading symbols from /lib/libc.so.6...done.
Reading symbols from /lib/ld-linux.so.2...done.
Reading symbols from /lib/libnss_files.so.2...done.
Reading symbols from /usr/lib/zsh/3.1.9-dev-1/zsh/rlimits.so...done.
Reading symbols from /usr/lib/zsh/3.1.9-dev-1/zsh/parameter.so...done.
Reading symbols from /usr/lib/zsh/3.1.9-dev-1/zsh/zle.so...done.
Reading symbols from /usr/lib/zsh/3.1.9-dev-1/zsh/complete.so...done.
Reading symbols from /usr/lib/zsh/3.1.9-dev-1/zsh/zutil.so...done.
Reading symbols from /usr/lib/zsh/3.1.9-dev-1/zsh/complist.so...done.
Reading symbols from /usr/lib/zsh/3.1.9-dev-1/zsh/computil.so...done.
#0  0x401dbce9 in ca_parse_line (d=0x81513b8, multi=0, first=1)
    at computil.c:1327
1327                    zaddlinknode(state.oargs[state.curopt->num], ztrdup(line
));
(gdb) bt
#0  0x401dbce9 in ca_parse_line (d=0x81513b8, multi=0, first=1)
    at computil.c:1327
#1  0x401dd4f1 in bin_comparguments (nam=0x401d65f8 "comparguments",
    args=0xbfffc2b8, ops=0xbfffc38c "", func=0) at computil.c:1771
#2  0x80521c7 in execbuiltin (args=0x401d65c0, bn=0x401e4784) at builtin.c:368
#3  0x8062867 in execcmd (state=0xbfffc87c, input=0, output=0, how=18, last1=2)
    at exec.c:2257
#4  0x805f55e in execpline2 (state=0xbfffc87c, pcode=10819, how=18, input=0,
    output=0, last1=0) at exec.c:1183
#5  0x805eadd in execpline (state=0xbfffc87c, slcode=6146, how=18, last1=0)
    at exec.c:976
#6  0x805e4a9 in execlist (state=0xbfffc87c, dont_change_job=1, exiting=0)
    at exec.c:821
#7  0x807edad in execif (state=0xbfffc87c, do_exec=0) at loop.c:469
#8  0x80625de in execcmd (state=0xbfffc87c, input=0, output=0, how=18, last1=2)
    at exec.c:2205
#9  0x805f55e in execpline2 (state=0xbfffc87c, pcode=10819, how=18, input=0,
    output=0, last1=0) at exec.c:1183
#10 0x805eadd in execpline (state=0xbfffc87c, slcode=1074178, how=18, last1=0)
    at exec.c:976
#11 0x805e4a9 in execlist (state=0xbfffc87c, dont_change_job=1, exiting=0)
    at exec.c:821
#12 0x805e1b7 in execode (p=0x814bc08, dont_change_job=1, exiting=0)
    at exec.c:727
#13 0x80653f2 in runshfunc (prog=0x814bc08, wrap=0x0,
    name=0x401d62f8 "_arguments") at exec.c:3406
#14 0x401aa68a in comp_wrapper (prog=0x814bc08, w=0x0,
    name=0x401d62f8 "_arguments") at complete.c:1220
#15 0x8065387 in runshfunc (prog=0x814bc08, wrap=0x401c2c60,
    name=0x401d62f8 "_arguments") at exec.c:3394
#16 0x8065204 in doshfunc (name=0x81180f0 "_arguments", prog=0x814bc08,
    doshargs=0x401d5c78, flags=8192, noreturnval=0) at exec.c:3339
#17 0x8064c30 in execshfunc (shf=0x8118098, args=0x401d5c78) at exec.c:3153
#18 0x80627e0 in execcmd (state=0xbfffd140, input=0, output=0, how=2, last1=2)
    at exec.c:2246
#19 0x805f55e in execpline2 (state=0xbfffd140, pcode=7875, how=2, input=0,
    output=0, last1=0) at exec.c:1183
#20 0x805eadd in execpline (state=0xbfffd140, slcode=21538, how=2, last1=0)
    at exec.c:976
#21 0x805e4f1 in execlist (state=0xbfffd140, dont_change_job=1, exiting=0)
    at exec.c:828
#22 0x807f260 in execcase (state=0xbfffd140, do_exec=0) at loop.c:563
#23 0x80625de in execcmd (state=0xbfffd140, input=0, output=0, how=18, last1=2)
    at exec.c:2205
#24 0x805f55e in execpline2 (state=0xbfffd140, pcode=7619, how=18, input=0,
    output=0, last1=0) at exec.c:1183
#25 0x805eadd in execpline (state=0xbfffd140, slcode=486402, how=18, last1=0)
    at exec.c:976
#26 0x805e4a9 in execlist (state=0xbfffd140, dont_change_job=1, exiting=0)
    at exec.c:821
#27 0x807e9e5 in execwhile (state=0xbfffd140, do_exec=0) at loop.c:379
#28 0x80625de in execcmd (state=0xbfffd140, input=0, output=0, how=2, last1=2)
    at exec.c:2205
#29 0x805f55e in execpline2 (state=0xbfffd140, pcode=6723, how=2, input=0,
    output=0, last1=0) at exec.c:1183
#30 0x805eadd in execpline (state=0xbfffd140, slcode=524290, how=2, last1=0)
    at exec.c:976
#31 0x805e4a9 in execlist (state=0xbfffd140, dont_change_job=1, exiting=0)
    at exec.c:821
#32 0x805e1b7 in execode (p=0x8148f50, dont_change_job=1, exiting=0)
    at exec.c:727
#33 0x8064cd3 in execautofn (state=0xbfffd390, do_exec=0) at exec.c:3181
#34 0x80625de in execcmd (state=0xbfffd390, input=0, output=0, how=18, last1=2)
    at exec.c:2205
#35 0x805f55e in execpline2 (state=0xbfffd390, pcode=3, how=18, input=0,
    output=0, last1=0) at exec.c:1183
#36 0x805eadd in execpline (state=0xbfffd390, slcode=3074, how=18, last1=0)
    at exec.c:976
#37 0x805e4a9 in execlist (state=0xbfffd390, dont_change_job=1, exiting=0)
    at exec.c:821
#38 0x805e1b7 in execode (p=0x811c178, dont_change_job=1, exiting=0)
    at exec.c:727
#39 0x80653f2 in runshfunc (prog=0x811c178, wrap=0x0, name=0x401d4c38 "_rpm")
    at exec.c:3406
#40 0x401aa68a in comp_wrapper (prog=0x811c178, w=0x0, name=0x401d4c38 "_rpm")
    at complete.c:1220
#41 0x8065387 in runshfunc (prog=0x811c178, wrap=0x401c2c60,
    name=0x401d4c38 "_rpm") at exec.c:3394
#42 0x8065204 in doshfunc (name=0x811c1b8 "_rpm", prog=0x811c178,
    doshargs=0x401d4c08, flags=8704, noreturnval=0) at exec.c:3339
#43 0x8064c30 in execshfunc (shf=0x811c160, args=0x401d4c08) at exec.c:3153
#44 0x80627e0 in execcmd (state=0xbfffd9c4, input=0, output=0, how=2, last1=2)
    at exec.c:2246
#45 0x805f55e in execpline2 (state=0xbfffd9c4, pcode=5187, how=2, input=0,
    output=0, last1=0) at exec.c:1183
#46 0x805eadd in execpline (state=0xbfffd9c4, slcode=3106, how=2, last1=0)
    at exec.c:976
#47 0x805e4f1 in execlist (state=0xbfffd9c4, dont_change_job=1, exiting=0)
    at exec.c:828
#48 0x807ee97 in execif (state=0xbfffd9c4, do_exec=0) at loop.c:484
#49 0x80625de in execcmd (state=0xbfffd9c4, input=0, output=0, how=2, last1=2)
    at exec.c:2205
#50 0x805f55e in execpline2 (state=0xbfffd9c4, pcode=5059, how=2, input=0,
    output=0, last1=0) at exec.c:1183
#51 0x805eadd in execpline (state=0xbfffd9c4, slcode=56322, how=2, last1=0)
    at exec.c:976
#52 0x805e4a9 in execlist (state=0xbfffd9c4, dont_change_job=1, exiting=0)
    at exec.c:821
#53 0x805e1b7 in execode (p=0x8147570, dont_change_job=1, exiting=0)
    at exec.c:727
#54 0x8064cd3 in execautofn (state=0xbfffdc14, do_exec=0) at exec.c:3181
#55 0x80625de in execcmd (state=0xbfffdc14, input=0, output=0, how=18, last1=2)
    at exec.c:2205
#56 0x805f55e in execpline2 (state=0xbfffdc14, pcode=3, how=18, input=0,
    output=0, last1=0) at exec.c:1183
#57 0x805eadd in execpline (state=0xbfffdc14, slcode=3074, how=18, last1=0)
    at exec.c:976
#58 0x805e4a9 in execlist (state=0xbfffdc14, dont_change_job=1, exiting=0)
    at exec.c:821
#59 0x805e1b7 in execode (p=0x811b240, dont_change_job=1, exiting=0)
    at exec.c:727
#60 0x80653f2 in runshfunc (prog=0x811b240, wrap=0x0,
    name=0x401d4568 "_normal") at exec.c:3406
#61 0x401aa68a in comp_wrapper (prog=0x811b240, w=0x0,
    name=0x401d4568 "_normal") at complete.c:1220
#62 0x8065387 in runshfunc (prog=0x811b240, wrap=0x401c2c60,
    name=0x401d4568 "_normal") at exec.c:3394
#63 0x8065204 in doshfunc (name=0x811b280 "_normal", prog=0x811b240,
    doshargs=0x401d4530, flags=8704, noreturnval=0) at exec.c:3339
#64 0x8064c30 in execshfunc (shf=0x811b228, args=0x401d4530) at exec.c:3153
#65 0x80627e0 in execcmd (state=0xbfffe240, input=0, output=0, how=18, last1=2)
    at exec.c:2246
#66 0x805f55e in execpline2 (state=0xbfffe240, pcode=2947, how=18, input=0,
    output=0, last1=0) at exec.c:1183
#67 0x805eadd in execpline (state=0xbfffe240, slcode=4098, how=18, last1=0)
    at exec.c:976
#68 0x805e4a9 in execlist (state=0xbfffe240, dont_change_job=1, exiting=0)
    at exec.c:821
#69 0x807ee97 in execif (state=0xbfffe240, do_exec=0) at loop.c:484
#70 0x80625de in execcmd (state=0xbfffe240, input=0, output=0, how=2, last1=2)
    at exec.c:2205
#71 0x805f55e in execpline2 (state=0xbfffe240, pcode=2819, how=2, input=0,
    output=0, last1=0) at exec.c:1183
#72 0x805eadd in execpline (state=0xbfffe240, slcode=89090, how=2, last1=0)
    at exec.c:976
#73 0x805e4a9 in execlist (state=0xbfffe240, dont_change_job=1, exiting=0)
    at exec.c:821
#74 0x805e1b7 in execode (p=0x8146b18, dont_change_job=1, exiting=0)
#75 0x8064cd3 in execautofn (state=0xbfffe490, do_exec=0) at exec.c:3181
#76 0x80625de in execcmd (state=0xbfffe490, input=0, output=0, how=18, last1=2)
    at exec.c:2205
#77 0x805f55e in execpline2 (state=0xbfffe490, pcode=3, how=18, input=0,
    output=0, last1=0) at exec.c:1183
#78 0x805eadd in execpline (state=0xbfffe490, slcode=3074, how=18, last1=0)
    at exec.c:976
#79 0x805e4a9 in execlist (state=0xbfffe490, dont_change_job=1, exiting=0)
    at exec.c:821
#80 0x805e1b7 in execode (p=0x81189d8, dont_change_job=1, exiting=0)
    at exec.c:727
#81 0x80653f2 in runshfunc (prog=0x81189d8, wrap=0x0,
    name=0x401d4268 "_complete") at exec.c:3406
#82 0x401aa68a in comp_wrapper (prog=0x81189d8, w=0x0,
    name=0x401d4268 "_complete") at complete.c:1220
#83 0x8065387 in runshfunc (prog=0x81189d8, wrap=0x401c2c60,
    name=0x401d4268 "_complete") at exec.c:3394
#84 0x8065204 in doshfunc (name=0x8118a18 "_complete", prog=0x81189d8,
    doshargs=0x401d4228, flags=8704, noreturnval=0) at exec.c:3339
#85 0x8064c30 in execshfunc (shf=0x81189c0, args=0x401d4228) at exec.c:3153
#86 0x80627e0 in execcmd (state=0xbfffefc4, input=0, output=0, how=18, last1=2)
    at exec.c:2246
#87 0x805f55e in execpline2 (state=0xbfffefc4, pcode=9795, how=18, input=0,
    output=0, last1=0) at exec.c:1183
#88 0x805eadd in execpline (state=0xbfffefc4, slcode=3074, how=18, last1=0)
    at exec.c:976
#89 0x805e4a9 in execlist (state=0xbfffefc4, dont_change_job=1, exiting=0)
    at exec.c:821
#90 0x807edad in execif (state=0xbfffefc4, do_exec=0) at loop.c:469
#91 0x80625de in execcmd (state=0xbfffefc4, input=0, output=0, how=2, last1=2)
    at exec.c:2205
#92 0x805f55e in execpline2 (state=0xbfffefc4, pcode=9475, how=2, input=0,
    output=0, last1=0) at exec.c:1183
#93 0x805eadd in execpline (state=0xbfffefc4, slcode=48130, how=2, last1=0)
    at exec.c:976
#94 0x805e4a9 in execlist (state=0xbfffefc4, dont_change_job=1, exiting=0)
    at exec.c:821
#95 0x807ddd8 in execfor (state=0xbfffefc4, do_exec=0) at loop.c:140
#96 0x80625de in execcmd (state=0xbfffefc4, input=0, output=0, how=2, last1=2)
    at exec.c:2205
#97 0x805f55e in execpline2 (state=0xbfffefc4, pcode=9411, how=2, input=0,
    output=0, last1=0) at exec.c:1183
#98 0x805eadd in execpline (state=0xbfffefc4, slcode=59394, how=2, last1=0)
    at exec.c:976
#99 0x805e4a9 in execlist (state=0xbfffefc4, dont_change_job=1, exiting=0)
#100 0x807ddd8 in execfor (state=0xbfffefc4, do_exec=0) at loop.c:140
#101 0x80625de in execcmd (state=0xbfffefc4, input=0, output=0, how=2, last1=2)
    at exec.c:2205
#102 0x805f55e in execpline2 (state=0xbfffefc4, pcode=8195, how=2, input=0,
    output=0, last1=0) at exec.c:1183
#103 0x805eadd in execpline (state=0xbfffefc4, slcode=158722, how=2, last1=0)
    at exec.c:976
#104 0x805e4a9 in execlist (state=0xbfffefc4, dont_change_job=1, exiting=0)
    at exec.c:821
#105 0x805e1b7 in execode (p=0x8143030, dont_change_job=1, exiting=0)
    at exec.c:727
#106 0x8064cd3 in execautofn (state=0xbffff214, do_exec=0) at exec.c:3181
#107 0x80625de in execcmd (state=0xbffff214, input=0, output=0, how=18,
    last1=2) at exec.c:2205
#108 0x805f55e in execpline2 (state=0xbffff214, pcode=3, how=18, input=0,
    output=0, last1=0) at exec.c:1183
#109 0x805eadd in execpline (state=0xbffff214, slcode=3074, how=18, last1=0)
    at exec.c:976
#110 0x805e4a9 in execlist (state=0xbffff214, dont_change_job=1, exiting=0)
    at exec.c:821
#111 0x805e1b7 in execode (p=0x811aac8, dont_change_job=1, exiting=0)
    at exec.c:727
#112 0x80653f2 in runshfunc (prog=0x811aac8, wrap=0x0,
    name=0x401d3030 "_main_complete") at exec.c:3406
#113 0x401aa68a in comp_wrapper (prog=0x811aac8, w=0x0,
    name=0x401d3030 "_main_complete") at complete.c:1220
#114 0x8065387 in runshfunc (prog=0x811aac8, wrap=0x401c2c60,
    name=0x401d3030 "_main_complete") at exec.c:3394
#115 0x8065204 in doshfunc (name=0x810aef8 "_main_complete", prog=0x811aac8,
    doshargs=0x0, flags=0, noreturnval=0) at exec.c:3339
#116 0x401ad6e7 in callcompfunc (s=0x40015500 "/e",
    fn=0x810aef8 "_main_complete") at compcore.c:788
#117 0x401ae2ef in makecomplist (s=0x40015500 "/e", incmd=0, lst=0)
    at compcore.c:938
#118 0x401ab49a in do_completion (dummy=0x4019cca8, dat=0xbffff52c)
    at compcore.c:333
#119 0x8085b2e in runhookdef (h=0x4019cca8, d=0xbffff52c) at module.c:1615
#120 0x4018f3f0 in docompletion (s=0x8141e80 "/e", lst=0, incmd=0)
    at zle_tricky.c:1719
#121 0x4018c5fa in docomplete (lst=0) at zle_tricky.c:770
#122 0x4018af19 in completeword (args=0x4019cc24) at zle_tricky.c:200
#123 0x4018adfd in completecall (args=0x4019cc24) at zle_tricky.c:176
#124 0x4018027f in execzlefunc (func=0x4019a8e8, args=0x4019cc24)
    at zle_main.c:646
#125 0x4017fcaa in zleread (
    lp=0x813e8c0 "%{\e[01;36m%}.%{\e[22;36m%}-%{%}(%{\e[01;32m%}%~%{%})%{\e[22;36m%}", '-' <repeats 56 times>, "%{%}(%{\e[22;36m%}%n%{\e[01;36m%}@%{\e[22;36m%}%m%{%})%{\e[22;36m%}-\n%{\r%}%{\e[01;36m%}"..., rp=0x0, flags=3)
    at zle_main.c:564
#126 0x8075599 in inputline () at input.c:265
#127 0x8075496 in ingetc () at input.c:210
#128 0x806e4ec in ihgetc () at hist.c:242
#129 0x807a8ec in gettok () at lex.c:626
#130 0x807a11a in yylex () at lex.c:342
#131 0x808ddb0 in parse_event () at parse.c:421
#132 0x8072efe in loop (toplevel=1, justonce=0) at init.c:121
#133 0x80517c9 in main (argc=1, argv=0xbffff804) at ./main.c:98


Adam

