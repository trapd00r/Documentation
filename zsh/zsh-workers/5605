From zsh-workers-return-5605-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Mar 02 13:56:59 1999
Return-Path: <zsh-workers-return-5605-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19736 invoked from network); 2 Mar 1999 13:56:57 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 2 Mar 1999 13:56:57 -0000
Received: (qmail 8881 invoked by alias); 2 Mar 1999 13:56:24 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5605
Received: (qmail 8843 invoked from network); 2 Mar 1999 13:56:20 -0000
Date: Tue, 2 Mar 1999 14:55:37 +0100 (MET)
Message-Id: <199903021355.OAA19188@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: completion listing fix


Just discovered this one... When one has a group of matches with an
explanation string and matches, but the matches are not shown in the
list, the re-positioning of the cursor failed utterly (placing the
cursor below the old prompt, in the list).

Bye
 Sven

diff -u os/Zle/zle_tricky.c Src/Zle/zle_tricky.c
--- os/Zle/zle_tricky.c	Tue Mar  2 14:19:10 1999
+++ Src/Zle/zle_tricky.c	Tue Mar  2 14:49:51 1999
@@ -6954,7 +6954,10 @@
 	    if ((*ap)->flags & CMF_NOLIST)
 		nl++;
 	*cp = NULL;
-    }
+    } else
+	for (ap = rp; *ap; ap++)
+	    if ((*ap)->flags & CMF_NOLIST)
+		nl++;
     if (np)
 	*np = n;
     if (nlp)
@@ -7809,14 +7812,14 @@
 	char **pp = g->ylist;
 
 	if ((e = g->expls)) {
-	    if (pnl) {
-		putc('\n', shout);
-		pnl = 0;
-	    }
 	    while (*e) {
 		if ((*e)->count) {
+		    if (pnl) {
+			putc('\n', shout);
+			pnl = 0;
+		    }
 		    printfmt((*e)->str, (*e)->count, 1);
-		    putc('\n', shout);
+		    pnl = 1;
 		}
 		e++;
 	    }

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

