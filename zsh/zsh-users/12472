From zsh-users-return-12472-mason-zsh=primenet.com.au@sunsite.dk Thu Jan 24 18:18:08 2008
Return-Path: <zsh-users-return-12472-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7706 invoked from network); 24 Jan 2008 18:18:06 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 24 Jan 2008 18:18:06 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 98902 invoked from network); 24 Jan 2008 18:17:24 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 24 Jan 2008 18:17:24 -0000
Received: (qmail 21550 invoked by alias); 24 Jan 2008 18:17:15 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12472
Received: (qmail 21536 invoked from network); 24 Jan 2008 18:17:14 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 24 Jan 2008 18:17:14 -0000
Received: from virusfilter.dotsrc.org (bifrost [127.0.0.1])
	by spamfilter.dotsrc.org (Postfix) with ESMTP id EEB398058F58
	for <zsh-users@sunsite.dk>; Thu, 24 Jan 2008 19:17:10 +0100 (CET)
Received: from nf-out-0910.google.com (nf-out-0910.google.com [64.233.182.187])
	by bifrost.dotsrc.org (Postfix) with ESMTP
	for <zsh-users@sunsite.dk>; Thu, 24 Jan 2008 19:17:10 +0100 (CET)
Received: by nf-out-0910.google.com with SMTP id d21so60114nfb.11
        for <zsh-users@sunsite.dk>; Thu, 24 Jan 2008 10:17:09 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from:to:subject:mime-version:content-type:content-transfer-encoding:content-disposition;
        bh=vuksLmm/5NoLqAueIHQZDJyBQ4FQR5tJovunPOfXj7M=;
        b=tPievFmylExXvY2iNBUtzyPBX2QK25K+NQnw2gX3dq9m+I4OK7Kr1whRp4V0yfQdDVO0rs7CbezPzfwApwM1mKP1Hunb98Dq8KgBiClnJfDUsM1452HxC8lVKde0QxwBsZPxcUsryKqFjAzrL7kERlk96pWwQCqE17mrW9/a6eM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:to:subject:mime-version:content-type:content-transfer-encoding:content-disposition;
        b=AINRgDKEe1KVOq3L5kNBI3Z0ManowR04FVwwUEl6kZbajqIWf+CwemZZaxjTF8sdmeD+GLaLEEFt4OMmcUtKk4gfHW6FMqkFxYGlNIr43I0dRd2Iob5rqcrWZjk9m56e3H84o9ftfQAsYR2sc59PnnCvYETasPg4gdDJ4ic/KmI=
Received: by 10.78.81.20 with SMTP id e20mr1393163hub.60.1201198629471;
        Thu, 24 Jan 2008 10:17:09 -0800 (PST)
Received: by 10.78.152.14 with HTTP; Thu, 24 Jan 2008 10:17:09 -0800 (PST)
Message-ID: <13ed09c00801241017x1cd7c454lcbf9156b6bccd9bb@mail.gmail.com>
Date: Thu, 24 Jan 2008 18:17:09 +0000
From: "Robert Knight" <robertknight@gmail.com>
To: zsh-users@sunsite.dk
Subject: Re: idea for new feature (was: Re: sticky-note and zle bindings)
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
X-Virus-Scanned: ClamAV using ClamSMTP

Hi,

> It works with gnome-terminal, with konsole it doesn't.
> But konsole must have some kind of state management because
> my wife's KDE Desktop restores all shells including the PWD.

Konsole/KDE 3 reads the shell's current working directory from /proc
and saves that information.  When logging in again it opens each
window / tab with the same binary and with the working directory
recorded from /proc at shutdown.  This is a pretty poor solution since
information about the shell's variables (local and environment),
history, prompt etc. are not kept.

Please don't try to do window state setup from the shell.  There are a
number of reasons for this:

- gnome-terminal and Konsole both support tabs and a variety of other
window state features which cannot be controlled using escape codes
- KDE already has good built-in facilities for handling window state
between sessions, it can do a better job than zsh.  This includes
cases where windows are spread across multiple displays.
- Konsole supports additional properties for each terminal such as
color scheme, key binding, scrollback settings and font setup which
only it has access to.

In summary, the shell should remember information which it knows best
(prompt,variables,history etc.) and the terminal should keep the
information which it knows best.

I think the SHELL_SESSION_COOKIE suggestion (perhaps
SHELL_SESSION_ID?) would be best from my point of view as a Konsole
developer.  The value should be a unique ID of a known format so that
terminals don't end up generating pre-existing IDs by mistake.
The only problem with this approach is that there needs to be a way
for a particular session to be ended.  Some options:

* End a session when an explicit command is sent to it (eg. 'Ctrl+D' or 'exit')
* Don't end sessions.  Instead keep data around for the last X
sessions (where X might be 5,10 or 20).
* Define a new escape code to end a session.

Regards,
Robert.

