From zsh-workers-return-9591-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Feb 07 04:23:26 2000
Return-Path: <zsh-workers-return-9591-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9992 invoked from network); 7 Feb 2000 04:23:25 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 7 Feb 2000 04:23:25 -0000
Received: (qmail 25649 invoked by alias); 7 Feb 2000 04:23:19 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9591
Received: (qmail 25639 invoked from network); 7 Feb 2000 04:23:18 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000207042308.ZM7068@candle.brasslantern.com>
Date: Mon, 7 Feb 2000 04:23:08 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: Completion no longer enabled in zsh -f
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

I just built 3.1.6-dev-17, patched up through 9589.  Running "zsh -f":

zagzig% ls <TAB>

Nothing happens.

I just fielded a post from somebody on comp.unix.shells who was confused
because zsh didn't complete anything at all for him.  I pointed him at
compinit but said that plain file completion should still work by default,
which at the moment it doesn't.  This must have started happening after
the patch in 8770; you must run at least one "compctl" command or the
like, or "zmodload compctl", for completion to be active.

The following is the simplest fix I could think of; one shortcoming is
that the compctl module doesn't strictly need to be loaded if the complete
module has been.  However, thanks to the way load_module() works, it is
possible to prevent loading of zsh/compctl by loading zsh/zle (either
explicitly or implicitly) in your init files; zsh/zle is already loaded as
a side-effect of "compinit", so for anyone already using new completion in
their init files, this change is invisible.

Index: Src/init.c
===================================================================
@@ -1021,7 +1021,7 @@
 autoload_zleread(char *lp, char *rp, int ha)
 {
     zlereadptr = fallback_zleread;
-    load_module("zsh/zle");
+    load_module("zsh/zle") && load_module("zsh/compctl");
     return zleread(lp, rp, ha);
 }
 

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

