From zsh-workers-return-21710-mason-zsh=primenet.com.au@sunsite.dk Thu Sep 08 14:32:00 2005
Return-Path: <zsh-workers-return-21710-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24233 invoked from network); 8 Sep 2005 14:31:57 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 8 Sep 2005 14:31:57 -0000
Received: (qmail 83121 invoked from network); 8 Sep 2005 14:31:51 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 8 Sep 2005 14:31:51 -0000
Received: (qmail 16259 invoked by alias); 8 Sep 2005 14:31:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21710
Received: (qmail 16245 invoked from network); 8 Sep 2005 14:31:48 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 8 Sep 2005 14:31:48 -0000
Received: (qmail 82824 invoked from network); 8 Sep 2005 14:31:48 -0000
Received: from zproxy.gmail.com (64.233.162.204)
  by a.mx.sunsite.dk with SMTP; 8 Sep 2005 14:31:38 -0000
Received: by zproxy.gmail.com with SMTP id i11so1201660nzh
        for <zsh-workers@sunsite.dk>; Thu, 08 Sep 2005 07:31:37 -0700 (PDT)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:to:subject:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references;
        b=bK3CDGM/RcizWF4yK0J2fuBQFXJozwyihveMHC+jeRjRpmvYoEMEi27ebBuA5Vqx+jJCm6K3z1UMLkAUKgC/MgIfD1BIOPHZSBEQmpSK6LTdMAT0YYtMDIB354SIY+7rwW+wb7RbRuf/mBc3l9aye/E5Wb4aRCkbc+AUBWswRVo=
Received: by 10.36.220.69 with SMTP id s69mr4875214nzg;
        Thu, 08 Sep 2005 07:31:36 -0700 (PDT)
Received: by 10.36.23.13 with HTTP; Thu, 8 Sep 2005 07:31:35 -0700 (PDT)
Message-ID: <237967ef0509080731646f7306@mail.gmail.com>
Date: Thu, 8 Sep 2005 16:31:36 +0200
From: Mikael Magnusson <mikachu@gmail.com>
To: zsh-workers@sunsite.dk
Subject: Re: various weirdnesses with unicode support
In-Reply-To: <20050908113246.52522e05.pws@csr.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline
References: <237967ef05090713304637c1f1@mail.gmail.com>
	 <20050908085533.GA2463@fargo>
	 <200509081002.j88A215f024377@news01.csr.com>
	 <20050908113246.52522e05.pws@csr.com>
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,RCVD_BY_IP 
	autolearn=ham version=3.0.4

On 9/8/05, Peter Stephenson <pws@csr.com> wrote:
> Peter Stephenson <pws@csr.com> wrote:
> > David =3D?utf-8?B?R8OzbWV6?=3D wrote:
> > > Hi Mikael ;),
> > >
> > > On Sep 07 at 10:30:24, Mikael Magnusson wrote:
> > > > * Having zsh in utf-8 locale but the terminal inputting for example
> > > > ISO-8859-1 makes zsh enter some weird state where
> > >
> > > Yep, i noticed too this one. It becomes necessary to logout, resettin=
g
> > > the terminal doesn't fix it. From your list, i think this is the
> > > most serious problem.
> >
> > It might be because the multibyte input state never gets reset
> > (getrestchar() in zle_main.c).  How does this manifest itself?  Are you
> > unable even to generate a new line?  If you can, resetting the state fo=
r
> > each line would be enough.  Otherwise we could time out multibyte
> > characters and return, for example, a '?'.
>=20
> For example, this patch uses the existing $KEYTIMEOUT variable to time ou=
t
> the remaining bytes of a multibyte character.  If mbrtowc() reported
> there was more, but reading the next byte took more than $KEYTIMEOUT
> hundredths of a second, the character is returned as a wide '?' and
> the shift state for character input is reset.
>=20
> Much of the patch is adding the extra argument to getbyte to differentiat=
e
> a real EOF from a timeout.
>=20
> Does this help?  I suspect we probably need something like this anyway.

It seems to help a bit. If i press =E5 (a with a ring), and then press a
a few times, zle still seems to be in a mostly normal state. But if i
press several =E5 in a row i can't seem to get out.

--=20
Mikael Magnusson

