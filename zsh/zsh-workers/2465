From zsh-workers-request@euclid.skiles.gatech.edu  Mon Nov 25 02:36:44 1996
Return-Path: zsh-workers-request@euclid.skiles.gatech.edu
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by coral.primenet.com.au (8.7.6/8.7.3) with ESMTP id CAA26720 for <mason@primenet.com.au>; Mon, 25 Nov 1996 02:36:40 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id KAA29177; Sun, 24 Nov 1996 10:30:00 -0500 (EST)
Resent-Date: Sun, 24 Nov 1996 10:30:00 -0500 (EST)
From: Zefram <zefram@dcs.warwick.ac.uk>
Message-Id: <19825.199611241530@stone.dcs.warwick.ac.uk>
Subject: module installation fixes
To: zsh-workers@math.gatech.edu (Z Shell workers mailing list)
Date: Sun, 24 Nov 1996 15:30:32 +0000 (GMT)
X-Patch: 134
X-Loop: zefram@dcs.warwick.ac.uk
X-Stardate: [-31]8473.23
X-US-Congress: Moronic fuckers
Content-Type: text
Resent-Message-ID: <"UQsXG1.0.p77.td6co"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2465
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

-----BEGIN PGP SIGNED MESSAGE-----

This patch fixes a couple of problems I didn't immediately notice with
patch 2458:

* "make install" at the top level didn't install the modules.

* The generated header "paths.h" on some systems clashes with a system
  header.

 -zefram

      Index: Makefile.in
      ===================================================================
      RCS file: /home/zefram/usr/cvsroot/zsh/Makefile.in,v
      retrieving revision 1.4
      diff -c -r1.4 Makefile.in
      *** Makefile.in	1996/11/23 00:22:36	1.4
      --- Makefile.in	1996/11/24 14:16:42
      ***************
      *** 89,98 ****
        FORCE:
        
        # install everything
      ! install: install.bin install.man install.info
        
        # install/uninstall just the binary
        install.bin uninstall.bin:
        	cd Src && $(MAKE) $(MAKEDEFS) $@
        
        # install/uninstall just the man pages
      --- 89,102 ----
        FORCE:
        
        # install everything
      ! install: install.bin install.modules install.man install.info
        
        # install/uninstall just the binary
        install.bin uninstall.bin:
      + 	cd Src && $(MAKE) $(MAKEDEFS) $@
      + 
      + # install/uninstall just the modules
      + install.modules uninstall.modules:
        	cd Src && $(MAKE) $(MAKEDEFS) $@
        
        # install/uninstall just the man pages
      Index: Src/Makefile.in
      ===================================================================
      RCS file: /home/zefram/usr/cvsroot/zsh/Src/Makefile.in,v
      retrieving revision 1.9
      diff -c -r1.9 Makefile.in
      *** Src/Makefile.in	1996/11/23 00:22:41	1.9
      --- Src/Makefile.in	1996/11/24 14:14:56
      ***************
      *** 213,231 ****
        
        $(OBJS): $(HDRS)
        
      ! init.o: bltinmods.list paths.h
        
        bltinmods.list: $(MODBINS)
        	( for mod in `cat $(MODBINS)`; do \
        	    echo "DOMOD(mod_boot_$$mod, mod_cleanup_$$mod)"; \
        	done ) > $@
        
      ! paths.h.force:
      ! 	echo '#define MODULE_DIR "'$(MODDIR)'"' > paths.h.tmp
      ! 	if cmp -s paths.h paths.h.tmp; then \
      ! 	    rm -f paths.h.tmp; \
        	else \
      ! 	    mv -f paths.h.tmp paths.h; \
        	fi
        
        $(PROTO): makepro.sed
      --- 213,231 ----
        
        $(OBJS): $(HDRS)
        
      ! init.o: bltinmods.list zshpaths.h
        
        bltinmods.list: $(MODBINS)
        	( for mod in `cat $(MODBINS)`; do \
        	    echo "DOMOD(mod_boot_$$mod, mod_cleanup_$$mod)"; \
        	done ) > $@
        
      ! zshpaths.h.force:
      ! 	echo '#define MODULE_DIR "'$(MODDIR)'"' > zshpaths.h.tmp
      ! 	if cmp -s zshpaths.h zshpaths.h.tmp; then \
      ! 	    rm -f zshpaths.h.tmp; \
        	else \
      ! 	    mv -f zshpaths.h.tmp zshpaths.h; \
        	fi
        
        $(PROTO): makepro.sed
      ***************
      *** 295,301 ****
        	rm -f core stamp-modobjs* *.o $(MODULE_DIR)/*.o *~
        
        clean: mostlyclean
      ! 	rm -f zsh ansi2knr $(@D@LCLEAN) signames.h paths.h bltinmods.list *.*.c *.pro
        
        distclean: clean
        	rm -f Makefile
      --- 295,301 ----
        	rm -f core stamp-modobjs* *.o $(MODULE_DIR)/*.o *~
        
        clean: mostlyclean
      ! 	rm -f zsh ansi2knr $(@D@LCLEAN) signames.h zshpaths.h bltinmods.list *.*.c *.pro
        
        distclean: clean
        	rm -f Makefile
      Index: Src/init.c
      ===================================================================
      RCS file: /home/zefram/usr/cvsroot/zsh/Src/init.c,v
      retrieving revision 1.25
      diff -c -r1.25 init.c
      *** Src/init.c	1996/11/23 00:22:41	1.25
      --- Src/init.c	1996/11/24 14:16:56
      ***************
      *** 32,38 ****
        #define GLOBALS
        #include "zsh.h"
        
      ! #include "paths.h"
        
        int noexitct = 0;
        
      --- 32,38 ----
        #define GLOBALS
        #include "zsh.h"
        
      ! #include "zshpaths.h"
        
        int noexitct = 0;
        

-----BEGIN PGP SIGNATURE-----
Version: 2.6.2

iQCVAwUBMphaJHD/+HJTpU/hAQEtcgQAswFvej/S8WigIYsaDQyZVj8XN0961tEC
hDuq3r0Q3unnd8Vya3DlgEarEQr9sltxRdXoaPj+YuKnBJvD6gMH/Dhus+uw1h78
ulbRPqqCVWepZ4Vu6jh6HmLztzADao6D3gI5Ne0vf6oNso95kLDgVOxWLbDh1jD7
QXP0NW+kPms=
=GcEn
-----END PGP SIGNATURE-----

