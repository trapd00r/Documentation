From zsh-users-return-11166-mason-zsh=primenet.com.au@sunsite.dk Wed Jan 31 17:24:14 2007
Return-Path: <zsh-users-return-11166-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26441 invoked from network); 31 Jan 2007 17:24:08 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 31 Jan 2007 17:24:08 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 22109 invoked from network); 31 Jan 2007 17:24:01 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 31 Jan 2007 17:24:01 -0000
Received: (qmail 11545 invoked by alias); 31 Jan 2007 17:23:54 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11166
Received: (qmail 11535 invoked from network); 31 Jan 2007 17:23:53 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 31 Jan 2007 17:23:53 -0000
Received: (qmail 20826 invoked from network); 31 Jan 2007 17:23:53 -0000
Received: from unknown (HELO n066.sc1.he.tucows.com) (64.97.136.134)
  by a.mx.sunsite.dk with SMTP; 31 Jan 2007 17:23:47 -0000
Received: from sc.homeunix.net (82.26.163.123) by n066.sc1.he.tucows.com (7.2.069.1)
        id 45BD3C3C0003C4D1; Wed, 31 Jan 2007 17:23:30 +0000
Received: from chazelas by sc.homeunix.net with local (Exim 3.36 #1 (Debian))
	id 1HCJB7-00039A-00; Wed, 31 Jan 2007 17:23:25 +0000
Date: Wed, 31 Jan 2007 17:23:25 +0000
From: Stephane Chazelas <Stephane_Chazelas@yahoo.fr>
To: Bart Schaefer <schaefer@brasslantern.com>
Cc: zsh-users@sunsite.dk
Subject: Re: zsh handling of non-standard if-evaluations
Message-ID: <20070131172324.GA9255@sc.homeunix.net>
Mail-Followup-To: Bart Schaefer <schaefer@brasslantern.com>,
	zsh-users@sunsite.dk
References: <184104.7951.qm@web36811.mail.mud.yahoo.com> <070128120533.ZM730@torch.brasslantern.com> <20070128201040.GA4908@sc.homeunix.net> <070128122451.ZM805@torch.brasslantern.com> <20070129004105.GA4623@sc.homeunix.net> <070131075124.ZM15434@torch.brasslantern.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-15
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <070131075124.ZM15434@torch.brasslantern.com>
User-Agent: Mutt/1.5.6i
Sender: Stephane Chazelas <stephane_chazelas@yahoo.fr>

On Wed, Jan 31, 2007 at 07:51:24AM -0800, Bart Schaefer wrote:
> On Jan 29, 12:41am, Stephane Chazelas wrote:
> }
> } > > load-sh-profile() {
> } > >   emulate -L sh
> } > >   . /etc/profile
> } > > }
> } > 
> } > No: any "typeset" commands would create parameters that are local to the
> } > load-sh-profile function; that may have undesired consequences.
> } 
> } typeset is not sh, so there wouldn't be any in /etc/profile.
> 
> By that logic, [ "$VAR" == "VAL" ] is not sh either, so the original
> problem should not exist.  If there is one bash-ism in /etc/profile,
> then one might expect that there are others.

That's true. But on the other hand, it's often better not to
accomodate for bugs especially when they are easy to fix, as it
helps detecting them.

Using [ ... == ... ] or typeset in /etc/profile is a bug.
/etc/profile is meant to be read by all the POSIX conformant
shells (and Bourne shells AAMOF) so has to be Bourne compatible
(not only POSIX) (except maybe if you can guarantee that the
Bourne shell won't ever be installed on your system by any of
your users).

On the other hand I think both our solutions fail if
/etc/profile contains something like 

set -u
or
set -C

which are valid Bourne syntax.

In anycase, there's no much point using typeset or set or
non-Bourne syntax in /etc/profile (though you sometimes find
things like export var=value which is not Bourne and interpreted
differently by bash/ksh/pdksh/zsh).

-- 
Stéphane

