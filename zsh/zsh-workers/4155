From zsh-workers-request@math.gatech.edu Tue Jun 23 18:48:09 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14922 invoked from network); 23 Jun 1998 18:48:07 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 23 Jun 1998 18:48:07 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id OAA26234;
	Tue, 23 Jun 1998 14:42:35 -0400 (EDT)
Resent-Date: Tue, 23 Jun 1998 14:42:35 -0400 (EDT)
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <980623114349.ZM449@candle.brasslantern.com>
Date: Tue, 23 Jun 1998 11:43:49 -0700
In-Reply-To: <199806220645.IAA08265@beta.informatik.hu-berlin.de>
Comments: In reply to Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
        "PATCH: for Re:  REC_EXACT and AUTO_MENU, and compctl -U too" (Jun 22,  8:45am)
References: <199806220645.IAA08265@beta.informatik.hu-berlin.de>
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: zsh-workers@math.gatech.edu
Subject: PATCH: Re: PATCH: for Re:  REC_EXACT and AUTO_MENU, and compctl -U too
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"gk00f1.0.rP6.QS_Zr"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4155
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On Jun 22,  8:45am, Sven Wischnowsky wrote:
} Subject: PATCH: for Re:  REC_EXACT and AUTO_MENU, and compctl -U too
}
} Sounds very reasonable. And if we want to do it in the drastic way you
} described, the patch is pretty simple.

There's a missing blank line in Sven's patch, which causes it to fail.
The corrected patch follows.

*** Src/Zle/zle_tricky.c.old	Mon Jun 22 08:23:18 1998
--- Src/Zle/zle_tricky.c	Mon Jun 22 08:26:36 1998
***************
*** 2246,2252 ****
  {
      Compctl cc = NULL;
      int oloffs = offs, owe = we, owb = wb, ocs = cs, oll = ll, isf = 1;
!     int t, sf1, sf2, ooffs;
      char *p, *sd = NULL, *tt, *s1, *s2, *os = NULL;
      unsigned char *ol = NULL;
  
--- 2246,2252 ----
  {
      Compctl cc = NULL;
      int oloffs = offs, owe = we, owb = wb, ocs = cs, oll = ll, isf = 1;
!     int t, sf1, sf2, ooffs, um = usemenu;
      char *p, *sd = NULL, *tt, *s1, *s2, *os = NULL;
      unsigned char *ol = NULL;
  
***************
*** 2266,2271 ****
--- 2266,2272 ----
      if (unset(COMPLETEINWORD) && cs != we)
  	cs = we, offs = strlen(s);
  
+     usemenu = um;
      ispattern = haswhat = lastambig = 0;
      patcomp = filecomp = NULL;
      menucur = NULL;
***************
*** 2413,2418 ****
--- 2414,2420 ----
  	*delit = 1;
  	*s = '\0';
  	offs = 0;
+ 	if (isset(AUTOMENU)) usemenu = 1;
      } else
  	*delit = 0;

*** Doc/Zsh/compctl.yo.old	Mon Jun 22 08:36:59 1998
--- Doc/Zsh/compctl.yo	Mon Jun 22 08:42:43 1998
***************
*** 353,359 ****
  tt(-K) option) which can examine the word components passed to it
  (or via the tt(read) builtin's tt(-c) and tt(-l) flags) and
  use its own criteria to decide what matches.  If there is no
! completion, the original word is retained.
  )
  item(tt(-y) var(func-or-var))(
  The list provided by var(func-or-var) is displayed instead of the list
--- 353,362 ----
  tt(-K) option) which can examine the word components passed to it
  (or via the tt(read) builtin's tt(-c) and tt(-l) flags) and
  use its own criteria to decide what matches.  If there is no
! completion, the original word is retained.  Since the produced 
! possible completions seldom seldom have interesting common prefixes
! and suffixes, menucompletion is started immediatly if tt(AUTO_MENU) is
! set and this flag is used.
  )
  item(tt(-y) var(func-or-var))(
  The list provided by var(func-or-var) is displayed instead of the list

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

