From zsh-workers-request@euclid.skiles.gatech.edu  Thu Dec  7 09:29:30 1995
Received: from euclid.skiles.gatech.edu (euclid.skiles.gatech.edu [130.207.146.50]) by werple.net.au (8.7/8.7.1) with ESMTP id JAA16511 for <mason@werple.mira.net.au>; Thu, 7 Dec 1995 09:29:22 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id RAA13604; Wed, 6 Dec 1995 17:13:43 -0500 (EST)
Resent-Date: Wed, 6 Dec 1995 17:13:43 -0500 (EST)
Date: Wed, 6 Dec 1995 14:13:58 -0800
Message-Id: <199512062213.OAA23083@block.statsci.com>
From: Scott Blachowicz <scott@statsci.com>
To: zsh-workers@math.gatech.edu
Cc: scott@statsci.com
Subject: bug in Doc/Makefile when configure --srcdir used (or implied)
Reply-to: scott@statsci.com
Resent-Message-ID: <"MLHrc3.0.PK3.MMXnm"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/674
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

[NOTE: I'm not on zsh-workers, so please cc me on followups/questions.]

Hi-

Just grabbed zsh-2.6-beta12 and did the configure/make like this:

    cd zsh-2.6-beta12
    mkdir FREEBSD210_INTEL
    cd FREEBSD210_INTEL
    ../configure --prefix=/sw/local
    GNU make

which failed like this:

    ...etc...
    gcc  -o zsh builtin.o compat.o cond.o exec.o glob.o hashtable.o hist.o init.o input.o jobs.o lex.o linklist.o loop.o math.o mem.o params.o parse.o signals.o subst.o text.o utils.o watch.o zle_bindings.o zle_hist.o zle_main.o zle_misc.o zle_move.o zle_refresh.o zle_tricky.o zle_utils.o zle_vi.o zle_word.o -ltermcap
    make[1]: Leaving directory `/a/spud/users/scott/archive/new/zsh-2.6-beta12/FREEBSD210_INTEL/Src'
    make[1]: Entering directory `/a/spud/users/scott/archive/new/zsh-2.6-beta12/FREEBSD210_INTEL/Doc'
    sed -e 's|path-to-man-pages|/sw/local/man/man1|' < zshall.man > zshall.1
    cannot open zshall.man: no such file
    make[1]: *** [zshall.1] Error 2
    make[1]: Leaving directory `/a/spud/users/scott/archive/new/zsh-2.6-beta12/FREEBSD210_INTEL/Doc'
    make: *** [all] Error 1

so it looks like the Doc Makefile can't handle a redirected srcdir.  I
made these changes to get it going:

--- Makefile.in.dist	Wed Dec  6 14:08:37 1995
+++ Makefile.in	Wed Dec  6 14:10:28 1995
@@ -45,9 +45,9 @@
 .SUFFIXES:
 
 # man pages to install
-MAN = zsh.1 zshbuiltins.1 zshcompctl.1 zshexpn.1 \
-zshmisc.1 zshoptions.1 zshparam.1 zshzle.1 \
-zshall.1
+MAN = $(srcdir)/zsh.1 $(srcdir)/zshbuiltins.1 $(srcdir)/zshcompctl.1 \
+$(srcdir)/zshexpn.1 $(srcdir)/zshmisc.1 $(srcdir)/zshoptions.1 \
+$(srcdir)/zshparam.1 $(srcdir)/zshzle.1 zshall.1
 
 # man pages contained in distribution
 DISTMAN = zsh.1 zshbuiltins.1 zshcompctl.1 zshexpn.1 \
@@ -83,8 +83,8 @@
 install.man: $(MAN)
 	$(top_srcdir)/mkinstalldirs $(mandir)/man$(manext)
 	for file in $(MAN); do \
-	  man=`echo $$file | $(SED) s/\.1/\.$(manext)/`; \
-	  $(INSTALL_DATA) $(srcdir)/$$file $(mandir)/man$(manext)/$$man ; \
+	  man=`echo $$file | $(SED) -e s,.*/,, -e s/\.1/\.$(manext)/`; \
+	  $(INSTALL_DATA) $$file $(mandir)/man$(manext)/$$man ; \
 	done
 
 # install info pages, creating install directory if necessary

And I think other target(s) (e.g. uninstall.man) in there might need
adjustment too.

Here's a section of the reporter output (I figured the monster long part
describing my envar settings is irrelevant):

sab.block> zsh-reporter
/sw/local/bin/zsh-reporter: no such file or directory: /lib/cpp [202]
strings: /lib/cpp: No such file or directory
# START zsh saveset
# uname:  FreeBSD block.statsci.com 2.1.0-950928-SNAP FreeBSD 2.1.0-950928-SNAP #0: Fri Sep 29 14:43:28  1995     jkh@westhill.cdrom.com:/usr/src/sys/compile/GENERIC  i386

...etc...
# END zsh saveset

So, I suppose you could consider this a report of success building &
installing zsh-2.6-beta12 on FreeBSD 2.1.0 (the 950928-SNAP prerelease at
least).

-- 
Scott Blachowicz    Ph: 206/283-8802x240    StatSci, a div of MathSoft, Inc.
                                            1700 Westlake Ave N #500
scott@statsci.com                           Seattle, WA USA   98109
Scott.Blachowicz@seaslug.org

