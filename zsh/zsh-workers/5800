From zsh-workers-return-5800-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Mar 15 10:22:40 1999
Return-Path: <zsh-workers-return-5800-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26061 invoked from network); 15 Mar 1999 10:22:38 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 Mar 1999 10:22:38 -0000
Received: (qmail 8712 invoked by alias); 15 Mar 1999 10:22:24 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5800
Received: (qmail 8696 invoked from network); 15 Mar 1999 10:22:19 -0000
Date: Mon, 15 Mar 1999 11:21:02 +0100 (MET)
Message-Id: <199903151021.LAA22809@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Bart Schaefer"'s message of Sat, 13 Mar 1999 22:14:02 -0800
Subject: Re: BUG: 3.1.5-pws-11 completion coredumps


Bart Schaefer wrote:

> On Mar 14,  5:04am, Geoff Wing wrote:
> } Subject: BUG: 3.1.5-pws-11 completion coredumps
> }
> } may be fixed in pws-12 but nothing in pws's list seemed to indicate so.
> } 
> } Couple of core dumps with completion. pws-11 with all completion stuff
> } installed.
> } Doing ``~/src/she<TAB>'' (AUTO_CD obviously) at the prompt
> 
> I can't duplicate this in the pws-12 that I just built
> ...

Neither could I, hm.

> However, I can get this minor odd behavior:
> 
>     zsh% ~/zc<TAB>
>     zsh% ~//zc
> 
> There is no possible match for "zc", though there are three directories
> with names starting with "z".  The slash gets doubled only when there's
> no possible match.

Yup, forgot to test the other path-prefix parameter.

Bye
 Sven

diff -u oc/Core/_path_files Completion/Core/_path_files
--- oc/Core/_path_files	Mon Mar 15 10:52:18 1999
+++ Completion/Core/_path_files	Mon Mar 15 11:18:28 1999
@@ -405,6 +405,7 @@
     # No match, insert the expanded path and add the original tail.
 
     [[ "$testpath[-1]" = / ]] && testpath="$testpath[1,-2]"
+    [[ -z "$testpath" && "$linepath[-1]" = / ]] && linepath="$linepath[1,-2]"
     [[ -n "$ostr" && -n "$linepath$testpath" ]] && ostr="/$ostr"
 
     # But only if something changed.

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

