From zsh-users-return-5066-mason-zsh=primenet.com.au@sunsite.dk Mon Jun 17 16:04:18 2002
Return-Path: <zsh-users-return-5066-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7696 invoked from network); 17 Jun 2002 16:04:13 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 17 Jun 2002 16:04:13 -0000
Received: (qmail 26403 invoked by alias); 17 Jun 2002 16:03:54 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 5066
Received: (qmail 26391 invoked from network); 17 Jun 2002 16:03:53 -0000
From: v@johansen.mail.dk
To: zsh-users@sunsite.dk
Subject: compinit problems with Cygwin and Win2000
Date: Mon, 17 Jun 2002 18:03:52 +0200
MIME-Version: 1.0
X-Mailer: Opasia webmail (version opasia/3.1.0)
X-Originating-IP: 194.255.118.209
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain; charset=iso-8859-1
Message-Id: <20020617160353.EKQO27002.fepD.post.tele.dk@fepP5.im.tele.dk>

Hi

I am using cygwin zsh-4.0.4 on win2000

When I try to use the new completion system I get a huge dump of=20
functions to stdout (see below) the second time I run a shell.

My .zshrc contains just 3 lines:

   fpath=3D(~/.zfunc /cygdrive/c/vjo/cygwin/usr/share/zsh/4.0.4/functions)
   autoload -U compinit
   compinit

compinit creates a file called .zcompdump, which apparently is sourced
the next time I run a shell. The last two lines in this file are

autoload -U
autoload -U +X _call_program

The 'autoload -U' line is responsible for the dump of functions. Looking
at the compdump function I suspect that it was meant to autoload a lot
of completion functions (_* in $fpath[2])


It seems to fail in

typeset _d_als_
...
_d_als=3D($(whence -wm '_*' | sort |
while read -rA _d_line; do
  [[ ${_d_line[2]} =3D function ]] && print -r - ${_d_line[1]%:}
done))



compinit output (296 lines):

compdump () {
	# undefined
	builtin autoload -XU
}
compinit () {
	emulate -L zsh
	setopt extendedglob
	typeset _i_dumpfile _i_files _i_line _i_done _i_dir _i_autodump=3D1
	typeset _i_tag _i_file _i_addfiles _i_fail=3Dask _i_check=3Dyes _i_name
	while [[ $# -gt 0 && $1 =3D -[dDiuC] ]]
	do
		case "$1" in
			-d) _i_autodump=3D1=20
				shift
				if [[ $# -gt 0 && "$1" !=3D -[dfQC] ]]
				then

...=09=09
<cut>
...
	return 0
}
compinstall () {
	# undefined
	builtin autoload -XU
}



--
Vagn J

