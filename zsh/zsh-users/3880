From zsh-users-return-3880-mason-zsh=primenet.com.au@sunsite.dk Fri May 18 12:32:22 2001
Return-Path: <zsh-users-return-3880-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17938 invoked from network); 18 May 2001 12:32:19 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 18 May 2001 12:32:19 -0000
Received: (qmail 29697 invoked by alias); 18 May 2001 12:31:30 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 3880
Received: (qmail 29669 invoked from network); 18 May 2001 12:31:27 -0000
Recieved: from Richard.Curnow@st.com by popov with local (Exim 3.03 #5)
	id 150jOp-0006kZ-00
	for zsh-users@sunsite.auc.dk; Fri, 18 May 2001 13:30:31 +0100
Date: Fri, 18 May 2001 13:30:31 +0100
From: Richard Curnow <Richard.Curnow@st.com>
To: Zsh users list <zsh-users@sunsite.auc.dk>
Subject: zsh4.0.1-pre4 : backticks fail if SHLVL nonexistant
Message-ID: <20010518133031.E6141@popov.bri.st.com>
Mail-Followup-To: Zsh users list <zsh-users@sunsite.auc.dk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.4i-nntp

I've downloaded and built zsh4.0.1-pre4.  I was finding that any attempt to use
backtick-substitution was resulting in a core dump.  I rebuilt with -g and
tracked it down to a null pointer 'pm' in setiparam, for an attempt to set
SHLVL from line 2316 of exec.c.  Unfortunately, I had SHLVL being unset by a
line in my .zshenv.  (In order to reduce the environment to a clean initial
state before adding new defintions, I unset everything except for a defined
list of variables at the start of .zshenv.  Previously, SHLVL wasn't one of
them.  It worked OK with zsh v3.1.5).

It looks like the backticks code needs to be made robust against SHLVL not
existing (i.e. it should be created if missing, or the code shouldn't care if
it is missing.)

Cheers
Richard

-- 
Richard Curnow---by day : SuperH Core Architecture at STMicroelectronics
curnowr@bristol.st.com---------www.superh.com-------------www.st.com----
and by night >>---richard.curnow@go.to---http://go.to/richard.curnow/---

