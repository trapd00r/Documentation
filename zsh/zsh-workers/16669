From zsh-workers-return-16669-mason-zsh=primenet.com.au@sunsite.dk Mon Feb 18 14:35:00 2002
Return-Path: <zsh-workers-return-16669-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29152 invoked from network); 18 Feb 2002 14:34:59 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 18 Feb 2002 14:34:59 -0000
Received: (qmail 21076 invoked by alias); 18 Feb 2002 14:34:44 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16669
Received: (qmail 21046 invoked from network); 18 Feb 2002 14:34:43 -0000
From: Sven Wischnowsky <wischnow@berkom.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <15473.4293.796892.910269@wischnow.berkom.de>
Date: Mon, 18 Feb 2002 15:33:41 +0100
To: zsh-workers@sunsite.dk
Subject: Re: _cvs(&_arguments) bug
In-Reply-To: <20011228055923.2869.qmail@web10402.mail.yahoo.com>
References: <20011228055923.2869.qmail@web10402.mail.yahoo.com>
X-Mailer: VM 6.95 under 21.5 (patch 3) "asparagus" XEmacs Lucid


Felix Rosencrantz wrote:

> ...
> 
> Though, I think _arguments should also be modified to provide a way to say that
> there is an end to the flags being given to _arguments, and the specifications
> are starting.  It's an easy mistake to make.

Here is a patch. It uses `:' as the separator-argument (separating
options to _Arguments from specs). I hope that's ok for everyone, if
not it can easily be changed.

The patch neither cleans up the docs for _arguments nor changes it
functions using _Arguments to make use of `:'. Didn't have the time,
sorry.


Bye
  Sven

Index: Doc/Zsh/compsys.yo
===================================================================
RCS file: /cvsroot/zsh/zsh/Doc/Zsh/compsys.yo,v
retrieving revision 1.144
diff -u -r1.144 compsys.yo
--- Doc/Zsh/compsys.yo	12 Feb 2002 17:25:23 -0000	1.144
+++ Doc/Zsh/compsys.yo	18 Feb 2002 14:30:59 -0000
@@ -2996,12 +2996,15 @@
 different name for the argument context field.
 )
 findex(_arguments)
-item(tt(_arguments) [ tt(-ACS) ] [ tt(-O) var(name) ] [ tt(-M) var(matchspec) ] var(spec) ...)(
+item(tt(_arguments) [ tt(-ACS) ] [ tt(-O) var(name) ] [ tt(-M) var(matchspec) ] [ tt(:) ] var(spec) ...)(
 This function can be used to complete words on the line by describing the
 options and arguments which may be passed to the command for which
 completion is being performed.  The description is given as arguments to
 this function, with each var(spec) describing one option or normal
-argument of the command.  The forms of var(spec) understood are:
+argument of the command.  To separate these var(spec)s from the
+options given to tt(_arguments) itself, they can be preceeded by an
+argument containing a single colon.  The forms of var(spec)
+understood are:
 
 startitem()
 xitem(var(n)tt(:)var(message)tt(:)var(action))
Index: Src/Zle/computil.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/computil.c,v
retrieving revision 1.75
diff -u -r1.75 computil.c
--- Src/Zle/computil.c	7 Feb 2002 08:40:03 -0000	1.75
+++ Src/Zle/computil.c	18 Feb 2002 14:31:00 -0000
@@ -1065,6 +1065,8 @@
 
 	args++;
     }
+    if (*args && !strcmp(*args, ":"))
+        args++;
     if (!*args)
 	return NULL;
 

-- 
Sven Wischnowsky                          wischnow@berkom.de

