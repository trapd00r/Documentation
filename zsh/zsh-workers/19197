From zsh-workers-return-19197-mason-zsh=primenet.com.au@sunsite.dk Fri Oct 17 16:55:13 2003
Return-Path: <zsh-workers-return-19197-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10968 invoked from network); 17 Oct 2003 16:55:12 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 17 Oct 2003 16:55:12 -0000
Received: (qmail 20707 invoked by alias); 17 Oct 2003 16:55:02 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19197
Received: (qmail 20658 invoked from network); 17 Oct 2003 16:55:01 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 17 Oct 2003 16:55:01 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [216.27.190.146] by sunsite.dk (MessageWall 1.0.8) with SMTP; 17 Oct 2003 16:55:0 -0000
Received: from ceramic.fifi.org (mail@ceramic.fifi.org [216.27.190.147])
	by tantale.fifi.org (8.9.3p2/8.9.3/Debian 8.9.3-21) with ESMTP id JAA20004;
	Fri, 17 Oct 2003 09:54:55 -0700
Received: from phil by ceramic.fifi.org with local (Exim 4.22)
	id 1AAXsN-0008M0-7t; Fri, 17 Oct 2003 09:54:55 -0700
To: Danek Duvall <duvall@emufarm.org>
Cc: zsh-workers@sunsite.dk
Subject: Re: Subshell exiting, suspend problem
References: <20030926165251.GA14940@clipper.ens.fr>
	<20031003205809.GE4255@lorien.emufarm.org>
	<873ceaugby.fsf@ceramic.fifi.org>
	<20031003222443.GH4255@lorien.emufarm.org>
	<20031008070418.GD692@lorien.emufarm.org>
	<87llrwur5j.fsf@ceramic.fifi.org>
Mail-Copies-To: nobody
From: Philippe Troin <phil@fifi.org>
Date: 17 Oct 2003 09:54:55 -0700
In-Reply-To: <87llrwur5j.fsf@ceramic.fifi.org>
Message-ID: <87llrjby8w.fsf@ceramic.fifi.org>
Lines: 43
User-Agent: Gnus/5.09 (Gnus v5.9.0) Emacs/21.2
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="=-=-="
Sender: Philippe Troin <phil@fifi.org>


--=-=-=

Philippe Troin <phil@fifi.org> writes:

> Danek Duvall <duvall@emufarm.org> writes:
> 
> > On Fri, Oct 03, 2003 at 03:24:43PM -0700, Danek Duvall wrote:
> > 
> > > On Fri, Oct 03, 2003 at 03:06:09PM -0700, Philippe Troin wrote:
> > > 
> > > > Danek Duvall <duvall@emufarm.org> writes:
> > > >
> > > > > However, I'm now unable to suspend vi or ncftp, or, I would guess,
> > > > > any curses program.
> > > > 
> > > > That's strange: this patch only changes zsh's exit behavior.
> > > 
> > > Indeed.  I'll recompile both the patched version and the unpatched
> > > version from scratch and see if I can reproduce all this behavior.
> > 
> > Mea culpa.  I'd run configure in the background, and it failed to detect
> > tcsetpgrp properly.  Rebuilding in the foreground solved the issue.
> 
> Glad to hear that :-)
> 
> I'll see if I can fix the configure script for that case. At worst, I
> can make it fail if ran in the background.

Danek,

Can you check that you can reproduce the bit about failing to detect
tcsetpgrp properly?

If you can reproduce it, can you then try this patch and see if it
fixes the configure problem? You will need to regenerate the configure
script by running "autoconf" after patching zshconfig.ac.

BTW, I could not reproduce your problem at all. If I run configure in
the background, it just stops during the "checking if tcsetpgrp()
actually works..." test. This patch fixes this part.

Thanks,
Phil.

--=-=-=
Content-Type: text/x-patch
Content-Disposition: attachment;
  filename=zsh-tcsetgrp-bgconfigure.patch

Index: zshconfig.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/zshconfig.ac,v
retrieving revision 1.41
diff -b -u -r1.41 zshconfig.ac
--- zshconfig.ac	15 Sep 2003 09:20:21 -0000	1.41
+++ zshconfig.ac	17 Oct 2003 16:47:40 -0000
@@ -1614,6 +1614,7 @@
 dnl for instance, BeOS R4.51 does not support it yet
 dnl -----------
 if test -t 0 && test $ac_cv_func_tcsetpgrp = yes; then
+    trap "" SIGTTOU
     AC_CACHE_CHECK(if tcsetpgrp() actually works,
     zsh_cv_sys_tcsetpgrp,
     [AC_TRY_RUN([
@@ -1631,6 +1632,7 @@
     if test $zsh_cv_sys_tcsetpgrp = no; then
       AC_DEFINE(BROKEN_TCSETPGRP)
     fi
+    trap - SIGTTOU
 fi
 
 dnl -----------

--=-=-=--

