From zsh-workers-return-5596-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Mar 02 07:00:22 1999
Return-Path: <zsh-workers-return-5596-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15800 invoked from network); 2 Mar 1999 07:00:19 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 2 Mar 1999 07:00:19 -0000
Received: (qmail 5855 invoked by alias); 2 Mar 1999 06:59:52 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5596
Received: (qmail 5848 invoked from network); 2 Mar 1999 06:59:50 -0000
Message-ID: <19990302065922.24539.qmail@hotmail.com>
X-Originating-IP: [209.157.52.70]
From: "Matt Armstrong" <mattarmst@hotmail.com>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH 3.1.5-pws-10: Fix 
Date: Mon, 01 Mar 1999 22:59:21 PST
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="----=_NextPart_000_6da23525_3795bd7b$eac7132"

------=_NextPart_000_6da23525_3795bd7b$eac7132
Content-type: text/plain

> So, make first removes (among others) modules-bltin, _then_ 
> excutes distclean-modules, that depends on Makemod that 
> depends on modules-bltin ... that reruns our nice scripts 
> and leaves some files around (because they already are deleted
> from make's point of view :-).

Here is a collection of dependency fixes.

1) I made modules-bltin depend on Makefile.  This forces it to get 
re-made after a re-configure (this would have saved me a chunk of time 
the other night...)

2) I moved the module deletion stuff _above_ the @@clean.mk@@ in 
Src/Makefile.in.  This causes the module deletion dependencies to get 
entered first into the dependency graph, and so they get deleted first 
too (before Makemod does).  This gets rid of all the stupidity where 
Makemod gets created right after it is deleted.

3) I moved the deletion of modules.index and modules-bltin out of 
distclean and into clean.  I saw no compelling reason for it to be in 
distclean.  I think removing reasons for 'make distclean' is good.


--
I'm really matt_armstrong@bigfoot.com.  My ISP is blacklisted by
http://www.orbs.org, so I must use hotmail.  :-(


______________________________________________________
Get Your Private, Free Email at http://www.hotmail.com
------=_NextPart_000_6da23525_3795bd7b$eac7132
Content-Type: text/plain; name="makemod.dependency.patch.txt"
Content-Transfer-Encoding: 8bit
Content-Disposition: attachment; filename="makemod.dependency.patch.txt"

*** Src/Makefile.in.orig	Mon Mar  1 22:08:08 1999
--- Src/Makefile.in	Mon Mar  1 22:52:20 1999
***************
*** 112,118 ****
  
  # ========== LINKING IN MODULES ==========
  
! modules-bltin:
  	if test @D@ = N; then \
  	    cat $(sdir)/xmods.conf > $@; \
  	elif test @RTLD_GLOBAL_OK@ != yes; then \
--- 112,118 ----
  
  # ========== LINKING IN MODULES ==========
  
! modules-bltin: Makefile
  	if test @D@ = N; then \
  	    cat $(sdir)/xmods.conf > $@; \
  	elif test @RTLD_GLOBAL_OK@ != yes; then \
***************
*** 175,192 ****
  
  # ========== DEPENDENCIES FOR CLEANUP ==========
  
! @@clean.mk@@
  
  mostlyclean-here:
  	rm -f stamp-modobjs stamp-modobjs.tmp
  
  clean-here:
  	rm -f modules.index.tmp modules.stamp zsh ansi2knr.o ansi2knr
  	rm -f libzsh-*.$(DL_EXT)
  
  distclean-here:
  	rm -f TAGS tags
! 	rm -f modules.index modules-bltin Makefile
  
  mostlyclean: mostlyclean-modules
  clean: clean-modules
--- 175,195 ----
  
  # ========== DEPENDENCIES FOR CLEANUP ==========
  
! # Since module cleanup rules depend on Makemod, they come first.  This
! # forces module stuff to get cleaned before Makemod itself gets
! # deleted.
  
  mostlyclean-here:
  	rm -f stamp-modobjs stamp-modobjs.tmp
  
  clean-here:
  	rm -f modules.index.tmp modules.stamp zsh ansi2knr.o ansi2knr
+ 	rm -f modules.index modules-bltin
  	rm -f libzsh-*.$(DL_EXT)
  
  distclean-here:
  	rm -f TAGS tags
! 	rm -f Makefile
  
  mostlyclean: mostlyclean-modules
  clean: clean-modules
***************
*** 195,200 ****
--- 198,205 ----
  
  mostlyclean-modules clean-modules distclean-modules realclean-modules: Makemod
  	@$(MAKE) -f Makemod $(MAKEDEFS) `echo $@ | sed 's/-modules//'`
+ 
+ @@clean.mk@@
  
  # ========== RECURSIVE MAKES ==========
  

------=_NextPart_000_6da23525_3795bd7b$eac7132--

