From zsh-workers-return-22485-mason-zsh=primenet.com.au@sunsite.dk Sun Jun 11 01:31:30 2006
Return-Path: <zsh-workers-return-22485-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19831 invoked from network); 11 Jun 2006 01:31:29 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.3 (2006-06-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-0.9 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO,
	RCVD_IN_BL_SPAMCOP_NET,UPPERCASE_25_50 autolearn=no version=3.1.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 11 Jun 2006 01:31:29 -0000
Received: (qmail 75703 invoked from network); 11 Jun 2006 01:31:19 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 11 Jun 2006 01:31:19 -0000
Received: (qmail 13326 invoked by alias); 11 Jun 2006 01:31:13 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22485
Received: (qmail 13317 invoked from network); 11 Jun 2006 01:31:11 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 11 Jun 2006 01:31:11 -0000
Received: (qmail 75477 invoked from network); 11 Jun 2006 01:31:11 -0000
Received: from hu-out-0102.google.com (72.14.214.196)
  by a.mx.sunsite.dk with SMTP; 11 Jun 2006 01:31:10 -0000
Received: by hu-out-0102.google.com with SMTP id 35so152797hue
        for <zsh-workers@sunsite.dk>; Sat, 10 Jun 2006 18:31:09 -0700 (PDT)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:sender:to:subject:mime-version:content-type:content-transfer-encoding:content-disposition:x-google-sender-auth;
        b=RwPcckGARGcnYk3mz1U7pYb84Huu25UCXEVVUU0wwz/d+juNPHiwhjvQ+oh4fyrT6t21xAq3/W3SnKumRKR608I1JhNrzKGVeCqJUkDm4ymlViku7EmNlBJfuFHWbjZlq6/zHqwy1T1dE6KKCDZhlN5RGHpgJ6Yw5L8aODm7gF8=
Received: by 10.35.17.12 with SMTP id u12mr5121867pyi;
        Sat, 10 Jun 2006 18:31:09 -0700 (PDT)
Received: by 10.35.134.10 with HTTP; Sat, 10 Jun 2006 18:31:08 -0700 (PDT)
Message-ID: <20a807210606101831w3170d4aandf94ce83ac5ec8a8@mail.gmail.com>
Date: Sat, 10 Jun 2006 21:31:08 -0400
From: "Vin Shelton" <acs@alumni.princeton.edu>
Sender: ethersoft@gmail.com
To: zsh-workers@sunsite.dk
Subject: Hang on latest kubuntu linux when built with icc
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
X-Google-Sender-Auth: d0025211a4d7d0aa

Greetings -

On my new kubuntu box - uname -a reports:

Linux samwise 2.6.15-23-386 #1 PREEMPT Tue May 23 13:49:40 UTC 2006
i686 GNU/Linux

when I build the latest CVS sources with icc, the Intel C compiler,
the shell eventually hangs after running a command but before
returning to the prompt.  It usually takes only 1-5 commands before
this happens.

Here's an strace of zsh -f:

write(10, "\r\n", 2)                    = 2
alarm(0)                                = 0
ioctl(10, SNDCTL_TMR_TIMEBASE or TCGETS, {B38400 opost isig -icanon
-echo ...}) = 0
ioctl(10, SNDCTL_TMR_STOP or TCSETSW, {B38400 opost isig icanon echo ...}) = 0
ioctl(10, SNDCTL_TMR_TIMEBASE or TCGETS, {B38400 opost isig icanon
echo ...}) = 0
time(NULL)                              = 1149988783
rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0
rt_sigprocmask(SIG_BLOCK, [CHLD], [CHLD], 8) = 0
pipe([3, 4])                            = 0
gettimeofday({1149988783, 119463}, {240, 0}) = 0
clone(child_stack=0,
flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD,
child_tidptr=0xb7b8c708) = 18370
close(4)                                = 0
read(3, "", 1)                          = 0
close(3)                                = 0
rt_sigprocmask(SIG_BLOCK, [CHLD], [CHLD], 8) = 0
rt_sigprocmask(SIG_SETMASK, ~[HUP CHLD RTMIN RT_1], [CHLD], 8) = 0
--- SIGCHLD (Child exited) @ 0 (0) ---
rt_sigprocmask(SIG_BLOCK, ~[RTMIN RT_1], ~[HUP KILL STOP RTMIN RT_1], 8) = 0
rt_sigprocmask(SIG_SETMASK, ~[HUP KILL STOP RTMIN RT_1], ~[KILL STOP
RTMIN RT_1], 8) = 0
wait4(-1, [{WIFEXITED(s) && WEXITSTATUS(s) == 0}], WNOHANG|WSTOPPED,
{ru_utime={0, 999}, ru_stime={0, 999}, ...}) = 18370
gettimeofday({1149988783, 123302}, {240, 0}) = 0
ioctl(10, SNDCTL_TMR_TIMEBASE or TCGETS, {B38400 opost isig icanon
echo ...}) = 0
wait4(-1, 0xbfd3ac30, WNOHANG|WSTOPPED, 0xbfd3abd4) = -1 ECHILD (No
child processes)
sigreturn()                             = ? (mask now ~[HUP KILL CHLD
STOP RTMIN])
pause()                                 = ? ERESTARTNOHAND (To be restarted)
--- SIGHUP (Hangup) @ 0 (0) ---
rt_sigprocmask(SIG_BLOCK, ~[RTMIN RT_1], ~[KILL CHLD STOP RTMIN RT_1], 8) = 0
rt_sigprocmask(SIG_SETMASK, ~[KILL CHLD STOP RTMIN RT_1], ~[KILL STOP
RTMIN RT_1], 8) = 0
exit_group(1)                           = ?


The SIGHUP is where I killed the shell from another window.  The shell
hangs at the pause just before there.  Is there a race condition on
handling the signals?

Let me know what other info I can provide.

  - Vin
-- 
Whoever you are, no matter how lonely,
the world offers itself to your imagination,
calls to you like the wild geese, harsh and exciting--
over and over announcing your place
in the family of things.			Mary Oliver

