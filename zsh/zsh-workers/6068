From zsh-workers-return-6068-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Apr 21 09:11:32 1999
Return-Path: <zsh-workers-return-6068-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15448 invoked from network); 21 Apr 1999 09:11:31 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 21 Apr 1999 09:11:31 -0000
Received: (qmail 10168 invoked by alias); 21 Apr 1999 09:11:22 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6068
Received: (qmail 10161 invoked from network); 21 Apr 1999 09:11:21 -0000
Message-Id: <9904210847.AA26452@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk
Subject: Re: Patch available for 3.0.6-pre-0 
In-Reply-To: ""Bart Schaefer""'s message of "Wed, 21 Apr 1999 01:15:54 DFT."
             <990421011554.ZM9242@candle.brasslantern.com> 
Date: Wed, 21 Apr 1999 10:47:02 +0200
From: Peter Stephenson <pws@ibmth.df.unipi.it>

"Bart Schaefer" wrote:
> I've made up a preliminary patch for 3.0.6, which carries the version number
> 3.0.6-pre-0.  It's available at
> 	ftp://ftp.brasslantern.com/pub/zsh/zsh-3.0.5-3.0.6-pre-0.diff

First point: there's a followup to 5281, which attempted to handle an EINTR
during a query, in 5364.  The problem was you couldn't ^C a query.  I've
included it again below.

Second point: the mechanism for avoiding too many settyinfo()'s looks OK.
However, the configure test for clobbers_typeahead wouldn't work for the
last two cases.  Unless there's a good reason for not testing $host_vendor
--- in which case the sni-sysv4* test won't work --- there's a hunk to put
it back.

That was all I noticed.  I should perhaps say I haven't played around as
thoroughly with the typeset patch in 4914 as with the equivalent for 3.1,
but I have no particular worries.

--- Src/utils.c.eintr	Wed Apr 21 10:29:07 1999
+++ Src/utils.c	Wed Apr 21 10:29:47 1999
@@ -1185,7 +1185,7 @@
     char c;
 
     while (read(SHTTY, &c, 1) != 1) {
-	if (errno != EINTR)
+	if (errno != EINTR || errflag)
 	    return -1;
     }
     return STOUC(c);
--- configure.in.irix	Wed Apr 21 10:48:26 1999
+++ configure.in	Wed Apr 21 10:50:31 1999
@@ -654,8 +654,8 @@
 dnl system names directly.
 dnl The doubled square brackets are necessary because autoconf uses m4.
 AC_CACHE_CHECK(if typeahead needs FIONREAD, zsh_cv_sys_clobbers_typeahead,
-[case x-$host_os in
-    x-ultrix* | x-dgux* | x-sni-sysv4* | x-*-irix*)
+[case x-$host_vendor-$host_os in
+    x-*-ultrix* | x-*-dgux* | x-sni-sysv4* | x-*-irix*)
 	zsh_cv_sys_clobbers_typeahead=yes;;
     *)
 	zsh_cv_sys_clobbers_typeahead=no;;

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

