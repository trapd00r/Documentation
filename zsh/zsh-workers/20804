From zsh-workers-return-20804-mason-zsh=primenet.com.au@sunsite.dk Thu Feb 10 14:51:38 2005
Return-Path: <zsh-workers-return-20804-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13935 invoked from network); 10 Feb 2005 14:51:37 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 10 Feb 2005 14:51:37 -0000
Received: (qmail 16660 invoked from network); 10 Feb 2005 14:51:29 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 Feb 2005 14:51:29 -0000
Received: (qmail 5615 invoked by alias); 10 Feb 2005 14:51:27 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20804
Received: (qmail 5601 invoked from network); 10 Feb 2005 14:51:26 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 10 Feb 2005 14:51:26 -0000
Received: (qmail 16411 invoked from network); 10 Feb 2005 14:51:26 -0000
Received: from out004pub.verizon.net (HELO out004.verizon.net) (206.46.170.142)
  by a.mx.sunsite.dk with SMTP; 10 Feb 2005 14:51:22 -0000
Received: from candle.brasslantern.com ([4.11.10.129])
          by out004.verizon.net
          (InterMail vM.5.01.06.06 201-253-122-130-106-20030910) with ESMTP
          id <20050210145120.UHHT15146.out004.verizon.net@candle.brasslantern.com>
          for <zsh-workers@sunsite.dk>; Thu, 10 Feb 2005 08:51:20 -0600
Received: from candle.brasslantern.com (IDENT:schaefer@localhost [127.0.0.1])
	by candle.brasslantern.com (8.12.11/8.12.11) with ESMTP id j1AEpJfB022339
	for <zsh-workers@sunsite.dk>; Thu, 10 Feb 2005 06:51:19 -0800
Received: (from schaefer@localhost)
	by candle.brasslantern.com (8.12.11/8.12.11/Submit) id j1AEpJxi022338
	for zsh-workers@sunsite.dk; Thu, 10 Feb 2005 06:51:19 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <1050210145119.ZM22337@candle.brasslantern.com>
Date: Thu, 10 Feb 2005 14:51:19 +0000
In-Reply-To: <200502101422.j1AEM3Zx005978@news01.csr.com>
Comments: In reply to Peter Stephenson <pws@csr.com>
        "Re: UTF-8 input [was Re: PATCH: zle_params.c]" (Feb 10,  2:22pm)
References: <200501261806.j0QI6Q2d021854@news01.csr.com> 
	<20050129034740.GA21742@scowler.net> 
	<20050130010754.6F985863A@pwstephenson.fsnet.co.uk> 
	<1050130063525.ZM24312@candle.brasslantern.com> 
	<200502101422.j1AEM3Zx005978@news01.csr.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: UTF-8 input [was Re: PATCH: zle_params.c]
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Authentication-Info: Submitted using SMTP AUTH at out004.verizon.net from [4.11.10.129] at Thu, 10 Feb 2005 08:51:20 -0600
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On Feb 10,  2:22pm, Peter Stephenson wrote:
} Subject: Re: UTF-8 input [was Re: PATCH: zle_params.c]
}
} I think $KEYS is OK.  The current intention is for the input to key
} bindings to remain multibyte strings (metafied where necessary).
} Modifying BUFFER and other parameters converts from multibyte strings to
} wide characters automatically; I've already written that bit (because it
} was easy).  So if you feed back KEYS into the system from a function it
} will pass through the mbtowc stuff at the appropriate level.


So if, for example, I do

	BUFFER="$LBUFFER$KEYS$RBUFFER"

this is going to convert LBUFFER and RBUFFER from wide chars to metafied
on expansion, and then convert the whole quoted string back to wide chars
upon assignment?  Or am I missing something crucial, e.g. that BUFFER and
its L/R components are stored as raw bytes?
 
} I suspect we will want a flag such as ${(m)#KEYS} to treat the string
} as a multibyte character string instead of raw bytes and maybe a
} ${(M)#KEYS} not to.

(M) is already taken, as are (w) and (W).

I presume you mean (m) to be like (c) in that it works only with ${#...}.
Otherwise I'm even more confused.

} [...] argue for it to handle multibyte strings by default in a suitable
} locale, but when Perl did that it broke everything in sight.

I'm not arguing for that ... if anything, I'm arguing against it.

