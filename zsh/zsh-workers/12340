From zsh-workers-return-12340-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Jul 21 13:12:02 2000
Return-Path: <zsh-workers-return-12340-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10480 invoked from network); 21 Jul 2000 13:12:01 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 21 Jul 2000 13:12:01 -0000
Received: (qmail 29018 invoked by alias); 21 Jul 2000 13:11:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12340
Received: (qmail 29011 invoked from network); 21 Jul 2000 13:11:48 -0000
Date: Fri, 21 Jul 2000 14:11:20 +0100
From: Peter Stephenson <pws@cambridgesiliconradio.com>
Subject: Re: Cygwin: environ problem
In-reply-to: "Your message of Fri, 21 Jul 2000 15:56:45 +0400."
 <000101bff30a$be2cc1d0$21c9ca95@mow.siemens.ru>
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Message-id: <0FY10078PTYVGJ@la-la.cambridgesiliconradio.com>
Content-transfer-encoding: 7BIT

I'll reply to both cygwin-related messages in one go:

Andrej wrote:
> We _could_try_ to directly manipulate __cygwin_environ, but I do not
> like it - who knows, where and how it is used. BTW comments imply, that
> DLLs should actually refer to __cygwin_environ :-)

Without some major rewriting, we may have to: the export-related machinery
assumes it has direct control of the (new) environment's memory.  This is
certainly a contender for the problems people have been seeing.  Strange it
usually works, though.

>> I have English Win2k with Russian locale set, and russian
>> characters are
>> shown as ? in ls output. While this is definitely Cygwin problem, Zsh
>> (often) completely hangs when completing such name ... sorry, it just
>> takes hours (well, a bit less :-) to give listing. It is so
>> slow, that I
>> really had impression it was hung.
> 
> While figuring out environ problem, I got a look at locale
> implementation in Cygwin. There is no :-) setlocale() is just a stub
> function that accepts "C" as locale name and nothing more. It does
> nothing :-))) And locale table contains only ASCII support. So, I
> wonder, how can it work correclty even for ISO-8859-1 charset.

Is there any chance this could be network-related?  My desktop PC has lots
of Samba-mounted drives in various paths, and completion is an absolute
pig, at least until things are cached.  I installed cygwin and zsh onto
someone's notebook this week, with no network dependencies, obviously, and
it's as fast as `normal', whatever normal means for a UNIX porting layer on
top of NT.  There are no serious network problems here which could cause
the difference if everything's running properly.

-- 
Peter Stephenson <pws@cambridgesiliconradio.com>
Cambridge Silicon Radio, Unit 300, Science Park, Milton Road,
Cambridge, CB4 0XL, UK                          Tel: +44 (0)1223 392070

