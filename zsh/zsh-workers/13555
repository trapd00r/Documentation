From zsh-workers-return-13555-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 28 16:27:53 2001
Return-Path: <zsh-workers-return-13555-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17103 invoked from network); 28 Feb 2001 16:27:52 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 28 Feb 2001 16:27:52 -0000
Received: (qmail 2467 invoked by alias); 28 Feb 2001 16:27:46 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13555
Received: (qmail 2455 invoked from network); 28 Feb 2001 16:27:45 -0000
Date: Wed, 28 Feb 2001 16:27:44 +0000
From: Oliver Kiddle <opk@u.genie.co.uk>
To: zsh-workers@sunsite.dk
Subject: PATCH: Re: A few problems with 4.0.1-pre-1
Message-ID: <20010228162744.A18755@rambo.logica.co.uk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
Sender: Oliver Kiddle <kiddleo@logica.com>

Paul Ackersviller wrote:

> I just installed zsh 4.0.1-pre-1 from CVS and was getting errors from
> _main_complete.  This used to work for me a couple of months ago, so I

Thanks for the bug report. The problem is exactly as you described. The
trouble is that when ksh_arrays is set, $_comp_options only expands to the
first element of the _comp_options array - in the same way the ksh
does. This patch should fix it by using ${_comp_options[@]} instead to
expand to all elements in _comp_options.

I'm not sure about your second problem but I'll have a closer look.

The third problem is not really a problem. You don't have Yodl installed
so the documentation can't be generated. Normally these would be prebuilt
but they aren't if you download from CVS or one of the dev versions. Maybe
we should do something different here if the configure script doesn't find
Yodl because it doesn't look good. Any ideas?

Oliver Kiddle

Index: Completion/Core/_main_complete
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Core/_main_complete,v
retrieving revision 1.43
diff -u -u -r1.43 _main_complete
--- Completion/Core/_main_complete      2000/10/19 08:58:17     1.43
+++ Completion/Core/_main_complete      2001/02/28 16:19:08
@@ -16,7 +16,7 @@
 # which makes the output of setopt and unsetopt reflect a different
 # state than the global one for which you are completing.

-setopt localoptions $_comp_options
+setopt localoptions ${_comp_options[@]}

 exec </dev/null        # ZLE closes stdin, which can cause errors


