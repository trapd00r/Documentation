From zsh-workers-return-28668-mason-zsh=primenet.com.au@zsh.org Sat Jan 29 01:42:25 2011
Return-Path: <zsh-workers-return-28668-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10368 invoked by alias); 29 Jan 2011 01:42:25 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28668
Received: (qmail 26494 invoked from network); 29 Jan 2011 01:42:22 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,RCVD_IN_DNSWL_LOW autolearn=ham version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.218.43 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:cc:content-type
         :content-transfer-encoding;
        bh=ojPx5iOJGSnPyPm3FbSHsCJ1fEZ69kk5MWQBDfQvEJE=;
        b=Rj9TGlri8tJ+zY7kyBBB+MmDC2xs3zFojFH+fahlh8hHCY+LV2XECSKFvLftBgOYA8
         ZM5k7DnbRUBKp4rVAjXJcQSVDJ3pr9mTtf+NfbQ9JY5Dc0IBptjwrvmjlK+n8E3Wh/E7
         rn1BbArEehL5oqLBmKTusZFfcB++KweavXni8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:cc:content-type
         :content-transfer-encoding;
        b=claCNWSOa1Rx8L7HCwQgPOdoaeve++55jVuI6iHkQptjh9mJNHnNyEOtvARC/tt+AP
         lDzfl7bNpQaySv0/ZMxZp+lbwXz9/2nmdS3wEXlqku2xfoE+PzNQw3NPNUWy7hikOem3
         EqEAxBOeUGxa0MgHh0s/6u2wBRFvLaN/Lmxuc=
MIME-Version: 1.0
Sender: ethersoft@gmail.com
In-Reply-To: <20110128095616.18999141@pwslap01u.europe.root.pri>
References: <AANLkTin2jSQt2WSiNsnk4++pCQQmQsVB4bpYxs_HB_Co@mail.gmail.com>
	<110127193031.ZM4926@torch.brasslantern.com>
	<20110128095616.18999141@pwslap01u.europe.root.pri>
Date: Fri, 28 Jan 2011 20:42:17 -0500
X-Google-Sender-Auth: S1s--P3WQ0YToC-HmwzTfwfm8bA
Message-ID: <AANLkTikaArDyk7seZO_uy7=E=OyA9uwWkqeC_EO9AYZZ@mail.gmail.com>
Subject: Re: coredump completing scp
From: Vin Shelton <acs@alumni.princeton.edu>
To: Peter Stephenson <Peter.Stephenson@csr.com>
Cc: zsh-workers@zsh.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Peter -

On Fri, Jan 28, 2011 at 4:56 AM, Peter Stephenson
<Peter.Stephenson@csr.com> wrote:
> On Thu, 27 Jan 2011 19:30:31 -0800
> Bart Schaefer <schaefer@brasslantern.com> wrote:
>> On Jan 27, 10:13pm, Vin Shelton wrote:
>> }
>> } This shell was configured --with-zsh-mem and that seems to be
>> required } to provoke the coredump.
>> }
>> } #11 0x00007fd2d8b57ccc in setpwent () from /lib64/libc.so.6
>> } #12 0x000000000043ecb4 in fillnameddirtable (ht=3D0x6e4b08) at
>> hashtable.c:1382 }
>> } Please let me know if any further info is needed.
>
> If you have valgrind, running "valgrind zsh -f" might be useful. =A0(I
> don't think you'd need any of the options to look for leaked memory
> for something like this.)

Thanks for the suggestion.  Here's the report from valgrind.  The call
to setpwent is made from fillnameddirtable in hahstable.c.  I don't
really know what else to make of this, though.

legolas% scp --25509-- REDIR: 0x55636b0 (strcat) redirected to
0x4c27140 (strcat)
--25509-- Reading syms from
/home/acs/tst/lib/zsh/4.3.11-dev-1/zsh/computil.so (0x62ed000)
=3D=3D25509=3D=3D
=3D=3D25509=3D=3D HEAP SUMMARY:
=3D=3D25509=3D=3D     in use at exit: 0 bytes in 0 blocks
=3D=3D25509=3D=3D   total heap usage: 0 allocs, 0 frees, 0 bytes allocated
=3D=3D25509=3D=3D
=3D=3D25509=3D=3D All heap blocks were freed -- no leaks are possible
=3D=3D25509=3D=3D
=3D=3D25509=3D=3D ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 2 fr=
om 2)
--25509--
--25509-- used_suppression:      2 dl-hack3-cond-1
=3D=3D25509=3D=3D
=3D=3D25509=3D=3D ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 2 fr=
om 2)
--25509-- Reading syms from /lib64/libnss_compat-2.11.2.so (0x6502000)
--25509-- Reading syms from /lib64/libnsl-2.11.2.so (0x670b000)
--25509-- Reading syms from /lib64/libnss_nis-2.11.2.so (0x6923000)
--25509-- Reading syms from /lib64/libnss_files-2.11.2.so (0x6b2e000)
--25509-- REDIR: 0x555ff60 (free) redirected to 0x4c25ef4 (free)
=3D=3D25509=3D=3D Invalid free() / delete / delete[]
=3D=3D25509=3D=3D    at 0x4C25F7B: free (in
/usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)
=3D=3D25509=3D=3D    by 0x671AD49: init (in /lib64/libnsl-2.11.2.so)
=3D=3D25509=3D=3D    by 0x671AE79: _nsl_default_nss (in /lib64/libnsl-2.11.=
2.so)
=3D=3D25509=3D=3D    by 0x6928300: _nss_nis_setpwent (in /lib64/libnss_nis-=
2.11.2.so)
=3D=3D25509=3D=3D    by 0x6504557: internal_setpwent (in /lib64/libnss_comp=
at-2.11.2.so)
=3D=3D25509=3D=3D    by 0x6505895: _nss_compat_setpwent (in
/lib64/libnss_compat-2.11.2.so)
=3D=3D25509=3D=3D    by 0x55C9E1F: __nss_setent (in /lib64/libc-2.11.2.so)
=3D=3D25509=3D=3D    by 0x5586CCB: setpwent (in /lib64/libc-2.11.2.so)
=3D=3D25509=3D=3D    by 0x43ECB3: fillnameddirtable (hashtable.c:1382)
=3D=3D25509=3D=3D    by 0x5EE0130: scanpmuserdirs (parameter.c:1471)
=3D=3D25509=3D=3D    by 0x43D339: scanmatchtable (hashtable.c:381)
=3D=3D25509=3D=3D    by 0x43D630: scanhashtable (hashtable.c:444)
=3D=3D25509=3D=3D  Address 0x42d05e8 is not stack'd, malloc'd or (recently)=
 free'd
=3D=3D25509=3D=3D

Regards,
  Vin

