From zsh-users-return-11121-mason-zsh=primenet.com.au@sunsite.dk Wed Jan 17 01:19:56 2007
Return-Path: <zsh-users-return-11121-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13698 invoked from network); 17 Jan 2007 01:19:50 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 17 Jan 2007 01:19:50 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 15080 invoked from network); 17 Jan 2007 01:19:44 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Jan 2007 01:19:44 -0000
Received: (qmail 5683 invoked by alias); 17 Jan 2007 01:19:33 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11121
Received: (qmail 5673 invoked from network); 17 Jan 2007 01:19:31 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 17 Jan 2007 01:19:31 -0000
Received: (qmail 13716 invoked from network); 17 Jan 2007 01:19:31 -0000
Received: from s1tank.virtdom.com (216.240.101.50)
  by a.mx.sunsite.dk with SMTP; 17 Jan 2007 01:19:24 -0000
Received: (qmail 39282 invoked by uid 89); 17 Jan 2007 01:18:42 -0000
Received: from ool-4577886b.dyn.optonline.net (HELO venti) (brian@aljex.com@69.119.136.107)
  by s1tank.virtdom.com with SMTP; 17 Jan 2007 01:18:42 -0000
Message-ID: <00d801c739d5$7ce4b890$0901a8c0@venti>
From: "Brian K. White" <brian@aljex.com>
To: <zsh-users@sunsite.dk>
References: <20070116231141.GC21799@sen>
Subject: Re: recovering zombie process
Date: Tue, 16 Jan 2007 20:19:08 -0500
Organization: Aljex Software
MIME-Version: 1.0
Content-Type: text/plain;
	format=flowed;
	charset="iso-8859-1";
	reply-type=original
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.3028
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.3028


----- Original Message ----- 
From: <pizomer@myrealbox.com>
To: <zsh-users@sunsite.dk>
Sent: Tuesday, January 16, 2007 6:11 PM
Subject: recovering zombie process


>I have the following problem. I crashed an mrxvt session
> with 8 or more shells. Now all of them are zombie
>
> ps wax | grep  zsh  show :
> 5138 tty3     Ss+    0:00 -zsh
> 5269 pts/1    Ss     0:00 zsh
> 5290 pts/2    Ss     0:00 zsh
> 5314 pts/3    Ss+    0:00 zsh
> 6032 pts/0    Ss     0:00 zsh
> 6755 pts/6    Ss+    0:03 -zsh
> 7588 pts/7    Ss+    0:01 -zsh
> 1961 pts/10   S+     0:00 -zsh
> 2434 pts/11   Ss+    0:01 -zsh
> 4659 pts/13   Ss     0:00 zsh
> 8568 pts/15   Ss+    0:00 zsh
> 29073 pts/16   Ss     0:00 -zsh
> 23181 pts/17   Ss+    0:00 -zsh
> 16833 pts/9    Ss+    0:00 -zsh
> 17134 pts/8    S+     0:00 -zsh
> 17758 pts/5    Ss+    0:00 -zsh
> 17851 pts/14   Ss     0:00 -zsh
>
> The question is if someone know a way to recover them.
> Maybe something like in reverse of clone.

They are not zombies, hey are perfectly live running processes.
I don't know what official term there might be for such processes but I call 
them headless.
That is, processes which have become disconnected from their controlling tty 
and/or their parent process.
I guess orphan is already the term for when the parent process goes away.

In this case, it appears the tty has not gone away, merely the parent 
process.
what does "ps -ef" show?  or better yet "ps -o tty,pid,ppid,args -C zsh"
have all the PPID's turned to "1" ?

The only ways I know to reconnect to a session are:

1) commercial tty multiplexing/cloning software
    DoubleVision  (tridia.com)
    Peek (logmon.com)

2) freeware tty multiplexing/cloning software
    ttysnoop
    screen / mscreen

In all cases you had to be using the multiplexer before you created the tty 
so no matter what it's too late for this lot.

By rights, these processes should have all received a hangup when the parent 
went away.
Since they didn't, and if this is going to happen from time to time, then 
you might want to install autolog or idled
or other idle process killer which would send a hangup to any processes that 
appear like these automatically after they've been headless for whatever 
length of time you configure.

Perhaps the app that was managing the extra sessions (mrxvt) has a way to 
reconnect?
The fact that the tty's didn't change to "?" suggests this.

Brian K. White  --  brian@aljex.com  --  http://www.aljex.com/bkw/
+++++[>+++[>+++++>+++++++<<-]<-]>>+.>.+++++.+++++++.-.[>+<---]>++.
filePro  BBx    Linux  SCO  FreeBSD    #callahans  Satriani  Filk!

