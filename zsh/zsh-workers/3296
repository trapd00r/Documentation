From zsh-workers-request@euclid.skiles.gatech.edu Tue Jun 24 02:24:06 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 292 invoked from network); 24 Jun 1997 02:24:05 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 24 Jun 1997 02:24:05 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id WAA18210; Mon, 23 Jun 1997 22:01:49 -0400 (EDT)
Resent-Date: Mon, 23 Jun 1997 22:01:49 -0400 (EDT)
Date: Tue, 24 Jun 97 11:05:37 JST
Message-Id: <9706240205.AA02610@oz.fantasy.otsl.oki.co.jp>
To: hzoli@ny.frontiercomm.net
Cc: zsh-workers@math.gatech.edu
In-Reply-To: <199706231522.LAA00907@hzoli.home> (message from Zoltan Hidvegi on Mon, 23 Jun 1997 11:22:47 -0400 (EDT))
Subject: Re: zsh-3.0.3: another problem in Src/jobs.c
From: suzuki@otsl.oki.co.jp (SUZUKI Hisao)
Organization: Oki Technosystems Laboratory, Inc., Nagoya, Japan
Resent-Message-ID: <"n4s3p.0.TS4.Cgohp"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3296
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

>> 	% emacs -nw &
>> 	% fg
>> 	[type ^X^C to terminate the emacs]
>> 	% stty
>> 
>> 	[Note: this is not artificial.  When you forget to set
>> 	 DISPLAY, you will be put in the same situation.]
[snip]
>> If solely my patch of June 20 had applied, then this is not
>> happend when you _once_ suspend the "fg"ed emacs job before
>> terminate it.  Now that you also changed Src/jobs.c from
>
>But it did happed when you did not suspend the fg'ed job, even with your
>patch, right?

Yes, precisely.  However, suspending the fg'ed job was an _easy_
work around to do when you got into the situation.  In fact, I
and my colleagues had never noticed that problem before; we
usually suspend emacs of non x-window to switch the jobs.

>Still I think zsh is right here, and it is an emacs bug.  The problem is
>emacs leaves the tty setting in a wrong state when it exits.  I do not
>know how zsh can help here.  Note that ksh does the same, even worse,
>since after this the ksh line editor becomes unusable, and I had to kill
>ksh from an other terminal.

Well, try bash-1.14.7 or tcsh-6.06, please.  They get on well
with emacs.  It is regrettable that zsh does not.  In spite of
its _excellent_ line-editing facility and other useful features,
this particular problem may make zsh _notorious_ as a shell that
is free and powerful but cannot work well even with emacs...

Perhaps, IMHO, the better way to do is: 

(1) For zsh-3.0.X, to take a conservative patch as mine for the
    time being, and note the problem and works around (ttyctl,
    STTY, or job suspending) in Etc/BUGS.  Please do not forget
    that zsh-3.0.X is being used for _daily_ use by many users
    all over the world.

(2) For zsh-3.1.X, to devise an innovation.  I think it is best
    to make a third option for ttyctl which let the shell
    ignore stty changes under some unusual situations (as bash
    does).  And it will be nice if the new option is default.

--
Hisao Suzuki <suzuki@otsl.oki.co.jp>

