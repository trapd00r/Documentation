<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux/x86 (vers 25 March 2009), see www.w3.org">
  <meta http-equiv="Content-Type" content=
  "text/html; charset=utf-8">

  <title>Git Magic - 第&nbsp;6&nbsp;章&nbsp;多人Git</title>
  <link rel="stylesheet" href="default.css" type="text/css">
  <meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
  <link rel="home" href="index.html" title="Git 魔法">
  <link rel="up" href="index.html" title="Git 魔法">
  <link rel="prev" href="ch05.html" title=
  "第&nbsp;5&nbsp;章&nbsp;关于历史">
  <link rel="next" href="ch07.html" title=
  "第&nbsp;7&nbsp;章&nbsp;Git大师技">
</head>

<body bgcolor="white" text="black" link="#0000FF" vlink="#840084"
alink="#0000FF">
    <div class="toc">
      <ul>
<li><b>Git Magic</b></li>
        <li>
          <span class="preface"><a href="index.html">前言</a></span>

          <ul>
            <li><span class="section"><a href=
            "index.html#__2">致谢！</a></span></li>

            <li><span class="section"><a href=
            "index.html#__3">许可</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch01.html">1.
          入门</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch01.html#__5">工作是玩</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#__6">版本控制</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#__7">分布控制</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#__8">一个误区</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#__9">合并冲突</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch02.html">2.
          基本技巧</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch02.html#__11">保存状态</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__12">添加、删除、重命名</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__13">进阶撤销/重做</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__14">撤销</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__15">变更日志生成</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__16">下载文件</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__17">到最新</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__18">快速发布</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__19">我们已经做了什么？</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__20">练习</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch03.html">3.
          克隆周边</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch03.html#__22">计算机间同步</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__23">典型源码控制</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__24">封闭源码</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__25">裸仓库</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__26">推还是拽</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__27">项目分叉</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__28">终极备份</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__29">轻快多任务</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__30">游击版本控制</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_mercurial">Mercurial</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_bazaar">Bazaar</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_git">我偏爱Git的原因</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch04.html">4.
          分支巫术</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch04.html#__32">老板键</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__33">肮脏的工作</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__34">快速修订</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__35">合并</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__36">不间断工作流</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__37">重组杂乱</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__38">管理分支</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__39">临时分支</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__40">按你希望的方式工作</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch05.html">5.
          关于历史</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch05.html#__42">我认错</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__43">更复杂情况</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__44">本地变更之后</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__45">重写历史</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__46">制造历史</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__47">哪儿错了？</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__48">谁让事情变糟了？</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__49">个人经验</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch06.html">6.
          多人Git</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch06.html#__50">我是谁？</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_git_ssh_http">Git在SSH,
            HTTP上</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_git_3">Git在随便什么上</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__51">补丁：全球货币</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__52">对不起，移走了</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__53">远端分支</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__54">多远端</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__55">我的喜好</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch07.html">7.
          Git大师技</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch07.html#__56">源码发布</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#__57">提交变更</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#__58">我的提交太大了！</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_git_5">索引：Git的中转区域</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_head">别丢了你的HEAD</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_head_2">HEAD捕猎</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_git_6">基于Git构建</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#__59">大胆的特技</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#__60">阻止坏提交</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch08.html">8.
          揭开面纱</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch08.html#__62">大象无形</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__63">数据完整性</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__64">智能</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__65">索引</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_git_7">Git的源起</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__66">对象数据库</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_blob">Blob对象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_tree">Tree对象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_commit">Commit对象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__67">没那么神</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch09.html">9. 附录 A:
          Git的缺点</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch09.html#_sha1">SHA1 的弱点</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_windows">微软 Windows</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__68">不相关的文件</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__69">谁在编辑什么？</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__70">文件历史</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__71">初始克隆</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__72">不稳定的项目</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__73">全局计数器</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__74">空子目录</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__75">初始提交</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__76">接口怪癖</a></span></li>
          </ul>
        </li>

        <li><span class="chapter"><a href="ch10.html">10. 附录 B:
        本指南的翻译</a></span></li>
      </ul>
    </div>
<div class="content">
  <div class="chapter" title="第&nbsp;6&nbsp;章&nbsp;多人Git">
    <div class="titlepage">
      <div>
        <div>
          <h2 class="title"><a name=
          "_git_2"></a>第&nbsp;6&nbsp;章&nbsp;多人Git</h2>
        </div>
      </div>
    </div>

    <p>我最初在一个私人项目上使用Git，那里我是唯一的开发。在与Git分布式本性有关的命 令中，我只用到了
    <span class="strong"><strong>pull</strong></span> 和
    *clone*，用以在不同地方保持同一个项目。</p>

    <p>后来我想用Git发布我的代码，并且包括其他贡献者的变更。我不得不学习如何管理有来
    自世界各地的多个开发的项目，幸运的是，这是Git的长处，也可以说是其存在的理由。</p>

    <div class="section" title="我是谁？">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__50"></a>我是谁？</h2>
          </div>
        </div>
      </div>

      <p>每个提交都有一个作者姓名和电子信箱，这显示在 <span class="strong"><strong>git
      log</strong></span> 里。默认， Git使用系统 设定来填充这些域。要显示地设定，键入：</p>
      <pre class="literallayout">
$ git config --global user.name "John Doe"
$ git config --global user.email johndoe@example.com
</pre>

      <p>去掉global选项设定只对当前仓库生效。</p>
    </div>

    <div class="section" title="Git在SSH, HTTP上">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="_git_ssh_http"></a>Git在SSH,
            HTTP上</h2>
          </div>
        </div>
      </div>

      <p>假设你有ssh访问权限，以访问一个网页服务器，但上面并没有安装Git。尽管比着它的
      原生协议效率低，Git也是可以通过HTTP来进行通信的。</p>

      <p>那么在你的帐户下，下载，编译并安装Git。在你的网页目录里创建一个Git仓库：</p>
      <pre class="literallayout">
$ GIT_DIR=proj.git git init
$ cd proj.git
$ git --bare update-server-info
$ cp hooks/post-update.sample hooks/post-update
</pre>

      <p>对较老版本的Git，只拷贝还不够，你应运行：</p>
      <pre class="literallayout">
$ chmod a+x hooks/post-update
</pre>

      <p>现在你可以通过SSH从随便哪个克隆发布你的最新版本：</p>
      <pre class="literallayout">
$ git push web.server:/path/to/proj.git master
</pre>

      <p>那随便谁都可以通过如下命令得到你的项目：</p>
      <pre class="literallayout">
$ git clone http://web.server/proj.git
</pre>
    </div>

    <div class="section" title="Git在随便什么上">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="_git_3"></a>Git在随便什么上</h2>
          </div>
        </div>
      </div>

      <p>想无需服务器，甚至无需网络连接的时候同步仓库？需要在紧急时期凑合一下？我们 已经看过<a class="link"
      href="ch05.html#makinghistory"><span class=
      "strong"><strong>git fast-export</strong></span> 和
      <span class="strong"><strong>git fast-import</strong></span>
      可以转换资源 库到一个单一文件以及转回来</a>。 我们可以来来会会传送这些文件以传输git仓库，
      通过任何媒介，但一个更有效率的工具是 <span class="strong"><strong>git
      bundle</strong></span> 。</p>

      <p>发送者创建一个“文件包”：</p>
      <pre class="literallayout">
$ git bundle create somefile HEAD
</pre>

      <p>然后传输这个文件包， <code class="literal">somefile</code>
      ，给某个其他参与者：电子邮件，优盘，一个 <span class=
      "strong"><strong>xxd</strong></span>
      打印品和一个OCR扫描仪，通过电话读字节，狼烟，等等。接收者通过键入如下命 令从文件包获取提交：</p>
      <pre class="literallayout">
$ git pull somefile
</pre>

      <p>接收者甚至可以在一个空仓库做这个。不考虑大小， <code class=
      "literal">somefile</code> 可以包含整个原先 git仓库。</p>

      <p>在较大的项目里，可以通过只打包其他仓库缺少的变更消除浪费。例如，假设提交
      ‘`1b6d…’'是两个参与者共享的最近提交：</p>
      <pre class="literallayout">
$ git bundle create somefile HEAD ^1b6d
</pre>

      <p>如果做的频繁，人可能容易忘记刚发了哪个提交。帮助页面建议使用标签解决这个问题。
      即，在你发了一个文件包后，键入：</p>
      <pre class="literallayout">
$ git tag -f lastbundle HEAD
</pre>

      <p>并创建较新文件包，使用：</p>
      <pre class="literallayout">
$ git bundle create newbundle HEAD ^lastbundle
</pre>
    </div>

    <div class="section" title="补丁：全球货币">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__51"></a>补丁：全球货币</h2>
          </div>
        </div>
      </div>

      <p>补丁是变更的文本形式，易于计算机理解，人也类似。补丁可以通吃。你可以给开发电
      邮一个补丁，不用管他们用的什么版本控制系统。只要你的观众可以读电子邮件，他们
      就能看到你的修改。类似，在你这边，你只需要一个电子邮件帐号：不必搭建一个在线 的Git仓库。</p>

      <p>回想一下第一章：</p>
      <pre class="literallayout">
$ git diff 1b6d &gt; my.patch
</pre>

      <p>输出是一个补丁，可以粘贴到电子邮件里用以讨论。在一个Git仓库，键入：</p>
      <pre class="literallayout">
$ git apply &lt; my.patch
</pre>

      <p>来打这个补丁。</p>

      <p>在更正式些的设置里，当作者名字以及或许签名应该记录下的时候，为过去某一刻生成 补丁，键入：</p>
      <pre class="literallayout">
$ git format-patch 1b6d
</pre>

      <p>结果文件可以给 <span class=
      "strong"><strong>git-send-email</strong></span>
      发送，或者手工发送。你也可以指定一个提交范围：</p>
      <pre class="literallayout">
$ git format-patch 1b6d..HEAD^^
</pre>

      <p>在接收一端，保存邮件到一个文件，然后键入：</p>
      <pre class="literallayout">
$ git am &lt; email.txt
</pre>

      <p>这就打了补丁并创建了一个提交，包含诸如作者之类的信息。</p>

      <p>使用浏览器邮件客户端，在保存补丁为文件之前，你可能需要建一个按钮，看看邮件内 容原来的原始形式。</p>

      <p>对基于mbox的邮件客户端有些微不同，但如果你在使用的话，你可能是那种能轻易找出 答案的那种人，不用读教程。</p>
    </div>

    <div class="section" title="对不起，移走了">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__52"></a>对不起，移走了</h2>
          </div>
        </div>
      </div>

      <p>克隆一个仓库后，运行 <span class="strong"><strong>git
      push</strong></span> 或 <span class="strong"><strong>git
      pull</strong></span> 讲自动推到或从原先URL拉。Git
      如何做这个呢？秘密在和克隆一起创建的配置选项。让我们看一下：</p>
      <pre class="literallayout">
$ git config --list
</pre>

      <p>选项 <code class="literal">remote.origin.url</code>
      控制URL源；“origin” 是给源仓库的昵称。和 “master”
      分支的惯例一样，我们可以改变或删除这个昵称，但通常没有理由这么做。</p>

      <p>如果原先仓库移走，我们可以更新URL，通过：</p>
      <pre class="literallayout">
$ git config remote.origin.url git://new.url/proj.git
</pre>

      <p>选项 <code class="literal">branch.master.merge</code> 指定
      <span class="strong"><strong>git pull</strong></span>
      里的默认远端分支。在初始克隆的时候， 它被设为原仓库的当前分支，因此即使原仓库之后挪到一个不同的分支，后来的
      pull也将忠实地跟着原来的分支。</p>

      <p>这个选项只使用我们初次克隆的仓库，它的值记录在选项 <code class=
      "literal">branch.master.remote</code>
      。如果我们从其他仓库拉入，我们必须显示指定我们想要哪个分支：</p>
      <pre class="literallayout">
$ git pull git://example.com/other.git master
</pre>

      <p>以上也解释了为什么我们较早一些push和pull的例子没有参数。</p>
    </div>

    <div class="section" title="远端分支">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__53"></a>远端分支</h2>
          </div>
        </div>
      </div>

      <p>当你克隆一个仓库，你也克隆了它的所有分支。你或许没有注意到因为Git将它们隐藏
      起来了：你必须明确地要求。这使得远端仓库里的分支不至于干扰你的分支，也使 Git对初学者稍稍容易些。</p>

      <p>列出远端分支，使用：</p>
      <pre class="literallayout">
$ git branch -r
</pre>

      <p>你应该看到类似：</p>
      <pre class="literallayout">
origin/HEAD
origin/master
origin/experimental
</pre>

      <p>这显示了远端仓库的分支和HEAD，可以用在常用的Git命令里。例如，假设你已经做了
      很多提交，并希望和最后取到的版本比较一下。你可以搜索适当的SHA1哈希值，但使用 下面命令更容易些：</p>
      <pre class="literallayout">
$ git diff origin/HEAD
</pre>

      <p>或你可以看看‘`experimental’'分支都有啥：</p>
      <pre class="literallayout">
$ git log origin/experimental
</pre>
    </div>

    <div class="section" title="多远端">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__54"></a>多远端</h2>
          </div>
        </div>
      </div>

      <p>假设另两个开发在同一个项目上工作，我们希望保持两个标签。我们可以同事跟多个仓库：</p>
      <pre class="literallayout">
$ git remote add other git://example.com/some_repo.git
$ git pull other some_branch
</pre>

      <p>现在我们已经从第二个仓库合并到一个分支，并且我们已容易访问所有仓库的所有 分支。</p>
      <pre class="literallayout">
$ git diff origin/experimental^ other/some_branch~5
</pre>

      <p>但如果为了不影响自己的工作，我们只想比较他们的变更怎么办呢？换句话说，我们想
      检查一下他们的分支，又不使他们的变更入侵我们的工作目录。那不是运行pull命令， 而是运行：</p>
      <pre class="literallayout">
$ git fetch        # Fetch from origin, the default.
$ git fetch other  # Fetch from the second programmer.
</pre>

      <p>这只是获取历史。尽管工作目录维持不变，我们可以参考任何仓库的任何分支，使用
      一个Git命令，因为我们现在有一个本地拷贝。</p>

      <p>回想一下，在幕后，一个pull是简单地一个 <span class=
      "strong"><strong>fetch</strong></span> 然后 <span class=
      "strong"><strong>merge</strong></span> 。通常，我们 <span class=
      "strong"><strong>pull</strong></span>
      因为我们想在获取后合并最近提交；这个情况是一个值得注意的例外。</p>

      <p>关于如何去除远端仓库，如何忽略特定分支等更多，参见 <span class="strong"><strong>git
      help remote</strong></span> 。</p>
    </div>

    <div class="section" title="我的喜好">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__55"></a>我的喜好</h2>
          </div>
        </div>
      </div>

      <p>对我手头的项目，我喜欢贡献者去准备仓库，这样我可以从其中拉。一些Git伺服让你
      点一个按钮，拥有自己的分叉项目。</p>

      <p>在我获取一个树之后，我运行Git命令去浏览并检查这些变更，理想情况下这些变更组织
      良好，描述良好。我合并这些变更，也或许做些编辑。直到满意，我才把变更推入主资 源库。</p>

      <p>尽管我不经常收到贡献，我相信这个方法扩展性良好。参见 <a class="ulink" href=
      "http://torvalds-family.blogspot.com/2009/06/happiness-is-warm-scm.html"
      target="_top">这篇 来自Linus Torvalds的博客</a></p>

      <p>呆在Git的世界里比补丁文件稍更方便，因为不用我将补丁转换到Git提交。更进一步，
      Git处理诸如作者姓名和信箱地址的细节，还有时间和日期，以及要求作者描述他们的提 交。</p>
    </div>
  </div><script type="text/javascript" src="find_selflink.js">
</script><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
  </script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1901330-2");
  pageTracker._initData();
  pageTracker._trackPageview();
  </script>
</div>
</div><div class="footer"><a href="/~blynn/">Ben Lynn</a></div>
</body>
</html>
