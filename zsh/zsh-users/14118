From zsh-users-return-14118-mason-zsh=primenet.com.au@sunsite.dk Wed May 13 08:33:57 2009
Return-Path: <zsh-users-return-14118-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10783 invoked from network); 13 May 2009 08:33:54 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 13 May 2009 08:33:54 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 30593 invoked from network); 13 May 2009 08:33:43 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 13 May 2009 08:33:43 -0000
Received: (qmail 26988 invoked by alias); 13 May 2009 08:33:26 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 14118
Received: (qmail 26975 invoked from network); 13 May 2009 08:33:26 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 13 May 2009 08:33:26 -0000
Received: from cluster-d.mailcontrol.com (cluster-d.mailcontrol.com [85.115.60.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 01A7F82D4B6A
	for <zsh-users@sunsite.dk>; Wed, 13 May 2009 10:33:10 +0200 (CEST)
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly05d.srv.mailcontrol.com (MailControl) with ESMTP id n4D8X7dJ015160
	for <zsh-users@sunsite.dk>; Wed, 13 May 2009 09:33:07 +0100
Received: from news01 ([10.99.50.25]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Wed, 13 May 2009 09:33:07 +0100
Date: Wed, 13 May 2009 09:33:07 +0100
From: Peter Stephenson <pws@csr.com>
To: zsh-users@sunsite.dk
Subject: Re: zsh themes problem
Message-ID: <20090513093307.7ef85cdf@news01>
In-Reply-To: <090512202520.ZM17175@torch.brasslantern.com>
References: <op.utt0w7bamn8p7n@localhost>
	<090512202520.ZM17175@torch.brasslantern.com>
Organization: CSR
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.8; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 13 May 2009 08:33:07.0631 (UTC) FILETIME=[7109EBF0:01C9D3A5]
X-Scanned-By: MailControl A-06-00-00 (www.mailcontrol.com) on 10.68.0.115
X-Virus-Scanned: ClamAV 0.92.1/9356/Wed May 13 01:38:29 2009 on bifrost
X-Virus-Status: Clean

On Tue, 12 May 2009 20:25:20 -0700
Bart Schaefer <schaefer@brasslantern.com> wrote:
> However, in looking into this, I'm led to wonder about the *current*
> version of prompt_special_chars which seems to be assigning char[$code]
> where I suspect it should be assigning to schars[$code].
> 
> Can someone take a look?  PWS, you seem to have been responsible for
> the last ChangeLog entry on prompt_special_chars (25059 -- by the way,
> the CVS log says 25095, so one of those is a typo).
> 
> Also BTW, the test for UTF-8 in $LANG should probably also test for
> "utf8" per recent tweaks we had to make elsewhere, no?

I probably only tested it in en_GB.UTF-8.

Index: Functions/Prompts/prompt_special_chars
===================================================================
RCS file: /cvsroot/zsh/zsh/Functions/Prompts/prompt_special_chars,v
retrieving revision 1.2
diff -u -r1.2 prompt_special_chars
--- Functions/Prompts/prompt_special_chars	17 May 2008 22:42:17 -0000	1.2
+++ Functions/Prompts/prompt_special_chars	13 May 2009 08:32:22 -0000
@@ -8,7 +8,7 @@
 
 typeset -gA schars
 
-if [[ ${LC_ALL:-${LC_CTYPE:-$LANG}} = *UTF-8* ]]; then
+if [[ ${LC_ALL:-${LC_CTYPE:-$LANG}} = *(UTF-8|utf8)* ]]; then
   schars[300]=$'\xe2\x94\x94'
   schars[304]=$'\xe2\x94\x8c'
   schars[332]=$'\xe2\x94\x8c'
@@ -20,6 +20,6 @@
   schars[260]=$'\xe2\x96\x91'
 else
   for code in 300 304 332 333 371 372 262 261 260; do
-    eval "char[$code]=\$'\\$code'"
+    eval "schars[$code]=\$'\\$code'"
   done
 fi


-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

