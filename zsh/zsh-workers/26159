From zsh-workers-return-26159-mason-zsh=primenet.com.au@sunsite.dk Sat Dec 20 03:37:46 2008
Return-Path: <zsh-workers-return-26159-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29027 invoked from network); 20 Dec 2008 03:37:43 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 20 Dec 2008 03:37:43 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 67735 invoked from network); 20 Dec 2008 03:37:34 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 20 Dec 2008 03:37:34 -0000
Received: (qmail 24582 invoked by alias); 20 Dec 2008 03:37:28 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26159
Received: (qmail 24569 invoked from network); 20 Dec 2008 03:37:27 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 20 Dec 2008 03:37:27 -0000
Received: from QMTA07.westchester.pa.mail.comcast.net (qmta07.westchester.pa.mail.comcast.net [76.96.62.64])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 7C0DF80308BE
	for <zsh-workers@sunsite.dk>; Sat, 20 Dec 2008 04:37:22 +0100 (CET)
Received: from OMTA09.westchester.pa.mail.comcast.net ([76.96.62.20])
	by QMTA07.westchester.pa.mail.comcast.net with comcast
	id tDNo1a06V0SCNGk57FdNKV; Sat, 20 Dec 2008 03:37:22 +0000
Received: from smtp.klanderman.net ([98.217.254.247])
	by OMTA09.westchester.pa.mail.comcast.net with comcast
	id tFdM1a00U5M2Np63VFdM3g; Sat, 20 Dec 2008 03:37:22 +0000
Received: from lwm.klanderman.net (unknown [192.168.100.50])
	by smtp.klanderman.net (Postfix) with ESMTP id 7A65BB30145
	for <zsh-workers@sunsite.dk>; Fri, 19 Dec 2008 22:37:21 -0500 (EST)
Received: by lwm.klanderman.net (Postfix, from userid 500)
	id 5AC8C9FC5ED; Fri, 19 Dec 2008 22:37:21 -0500 (EST)
From: Greg Klanderman <gak@klanderman.net>
To: zsh-workers@sunsite.dk
Subject: Re: bug with kill-* commands in 4.3.9
Reply-To: gak@klanderman.net
Date: Fri, 19 Dec 2008 22:37:21 -0500
In-Reply-To: <18762.3258.446343.871151@gargle.gargle.HOWL> (Greg Klanderman's message of "Thu, 18 Dec 2008 03:41:30 -0500")
Message-ID: <m3ljubv7ny.fsf@klanderman.net>
User-Agent: Gnus/5.1007 (Gnus v5.10.7) XEmacs/21.4.17 (linux)
References: <18762.3258.446343.871151@gargle.gargle.HOWL>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Scanned: ClamAV 0.92.1/8786/Fri Dec 19 11:30:31 2008 on bifrost
X-Virus-Status: Clean

>>>>> Greg Klanderman <gak@klanderman.net> writes:

> Hi, in upgrading from 4.2.5, I notice that a sequence of kill-word or
> kill-line commands followed by a yank no longer yank back all the text
> killed by the sequence of kills, but only the text killed by the last
> kill command.  Would really appreciate if someone could fix this.

OK, so this seems to be due to Peter Stephenson's change to
zle_utils.c in revision 1.47 on 13-Apr-08 in the function cuttext():

@@ -504,7 +494,7 @@
        cutbuf.buf = (ZLE_STRING_T)zalloc(ZLE_CHAR_SIZE);
        cutbuf.buf[0] = ZWC('\0');
        cutbuf.len = cutbuf.flags = 0;
-    } else if (!(lastcmd & ZLE_KILL) || dir < 0) {
+    } else if (!(lastcmd & ZLE_KILL) || (flags & CUT_RAW)) {
        Cutbuffer kptr;
        if (!kring) {
            kringsize = KRINGCTDEF;

The CUT_RAW flag seems to be getting passed here by all the kill
commands, and cuttext() is inhibiting the behavior of appending to the
current kill ring entry when the last command was also a kill because
that flag is set.

Peter, can you give any hint what that change is supposed to be doing?

It seems that "dir < 0" should correspond with "(flags & CUT_REPLACE)";
is that what you intended?  Maybe I'll play around with that change..

thanks,
Greg

