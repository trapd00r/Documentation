From zsh-workers-return-9084-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Dec 16 13:32:36 1999
Return-Path: <zsh-workers-return-9084-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5251 invoked from network); 16 Dec 1999 13:32:31 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 16 Dec 1999 13:32:31 -0000
Received: (qmail 13149 invoked by alias); 16 Dec 1999 13:32:09 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9084
Received: (qmail 13141 invoked from network); 16 Dec 1999 13:32:08 -0000
Date: Thu, 16 Dec 1999 13:32:31 GMT
Message-Id: <199912161332.NAA24342@mango.dublin.iona.ie>
To: zsh-workers@sunsite.auc.dk
From: zefram@fysh.org
Subject: PATCH: alias modules

Here are some alias modules to let the old module names work.  The old
names are not 100% equivalent to the new names; they work for loading,
autoloading and dependencies, which I think is enough.  I made aliases
for all the module names in 3.1.2-pws-12, except for `zsh' (`zsh/main'),
which can't possibly be being used in any way affected by the renaming.
We should probably pare down the alias list a bit; the 3.1.7 release
shouldn't need backward compatibility with anything later than 3.1.6,
and so shouldn't have aliases for any names that didn't exist in 3.1.6.

Before applying the patch, you'll need a directory Src/Aliases.
After applying the patch, you need to execute the script ".preconfig" in
that directory to build the *.mdd files, which remain in the source tree.
After that you can do a "make prep" in the build tree, and then everything
should build happily.

-zefram

diff -crN ../zsh+hname/Src/Aliases/.cvsignore ./Src/Aliases/.cvsignore
*** ../zsh+hname/Src/Aliases/.cvsignore	Thu Jan  1 01:00:00 1970
--- ./Src/Aliases/.cvsignore	Thu Dec 16 12:40:21 1999
***************
*** 0 ****
--- 1,16 ----
+ Makefile
+ Makefile.in
+ *.export
+ so_locations
+ *.pro
+ *.epro
+ *.syms
+ *.o
+ *.o.c
+ *.so
+ *.mdh
+ *.mdhi
+ *.mdhs
+ *.mdh.tmp
+ *.c
+ *.mdd
diff -crN ../zsh+hname/Src/Aliases/.distfiles ./Src/Aliases/.distfiles
*** ../zsh+hname/Src/Aliases/.distfiles	Thu Jan  1 01:00:00 1970
--- ./Src/Aliases/.distfiles	Thu Dec 16 13:17:45 1999
***************
*** 0 ****
--- 1,8 ----
+ DISTFILES_SRC='
+     .cvsignore .distfiles .exrc .preconfig
+     alias.mdd.in alias.c.in
+     cap.mdd clone.mdd compctl.mdd complete.mdd complist.mdd
+     computil.mdd deltochar.mdd example.mdd files.mdd mapfile.mdd
+     mathfunc.mdd parameter.mdd rlimits.mdd sched.mdd stat.mdd
+     zftp.mdd zle.mdd zleparameter.mdd zutil.mdd
+ '
diff -crN ../zsh+hname/Src/Aliases/.exrc ./Src/Aliases/.exrc
*** ../zsh+hname/Src/Aliases/.exrc	Thu Jan  1 01:00:00 1970
--- ./Src/Aliases/.exrc	Thu Dec 16 12:39:39 1999
***************
*** 0 ****
--- 1,2 ----
+ set ai
+ set sw=4
diff -crN ../zsh+hname/Src/Aliases/.preconfig ./Src/Aliases/.preconfig
*** ../zsh+hname/Src/Aliases/.preconfig	Thu Jan  1 01:00:00 1970
--- ./Src/Aliases/.preconfig	Thu Dec 16 13:18:19 1999
***************
*** 0 ****
--- 1,32 ----
+ #! /bin/sh
+ 
+ for zshmod in \
+     cap \
+     clone \
+     compctl \
+     complete \
+     complist \
+     computil \
+     deltochar \
+     example \
+     files \
+     mapfile \
+     mathfunc \
+     parameter \
+     rlimits \
+     sched \
+     stat \
+     zftp \
+     zle \
+     zleparameter \
+     zutil \
+ ; do
+     localname=$zshmod
+     aliasname=$zshmod
+     depname=zsh/$zshmod
+     sed '
+ 	s,@LOCALNAME@,'$localname',g
+ 	s,@ALIASNAME@,'$aliasname',g
+ 	s,@DEPNAME@,'$depname',g
+     ' < alias.mdd.in > ${localname}.mdd
+ done
diff -crN ../zsh+hname/Src/Aliases/alias.c.in ./Src/Aliases/alias.c.in
*** ../zsh+hname/Src/Aliases/alias.c.in	Thu Jan  1 01:00:00 1970
--- ./Src/Aliases/alias.c.in	Thu Dec 16 12:59:47 1999
***************
*** 0 ****
--- 1,59 ----
+ /*
+  * alias.c.in - blank module for zsh
+  *
+  * This file is part of zsh, the Z shell.
+  *
+  * Copyright (c) 1996-1997 Andrew Main
+  * All rights reserved.
+  *
+  * Permission is hereby granted, without written agreement and without
+  * license or royalty fees, to use, copy, modify, and distribute this
+  * software and to distribute modified versions of this software for any
+  * purpose, provided that the above copyright notice and the following
+  * two paragraphs appear in all copies of this software.
+  *
+  * In no event shall Andrew Main or the Zsh Development Group be liable
+  * to any party for direct, indirect, special, incidental, or consequential
+  * damages arising out of the use of this software and its documentation,
+  * even if Andrew Main and the Zsh Development Group have been advised of
+  * the possibility of such damage.
+  *
+  * Andrew Main and the Zsh Development Group specifically disclaim any
+  * warranties, including, but not limited to, the implied warranties of
+  * merchantability and fitness for a particular purpose.  The software
+  * provided hereunder is on an "as is" basis, and Andrew Main and the
+  * Zsh Development Group have no obligation to provide maintenance,
+  * support, updates, enhancements, or modifications.
+  *
+  */
+ 
+ #include "@NAME@.mdh"
+ #include "@NAME@.pro"
+ 
+ /**/
+ int
+ setup_(Module m)
+ {
+     return 0;
+ }
+ 
+ /**/
+ int
+ boot_(Module m)
+ {
+     return 0;
+ }
+ 
+ /**/
+ int
+ cleanup_(Module m)
+ {
+     return 0;
+ }
+ 
+ /**/
+ int
+ finish_(Module m)
+ {
+     return 0;
+ }
diff -crN ../zsh+hname/Src/Aliases/alias.mdd.in ./Src/Aliases/alias.mdd.in
*** ../zsh+hname/Src/Aliases/alias.mdd.in	Thu Jan  1 01:00:00 1970
--- ./Src/Aliases/alias.mdd.in	Thu Dec 16 13:12:06 1999
***************
*** 0 ****
--- 1,20 ----
+ name=@ALIASNAME@
+ 
+ nozshdep=1
+ 
+ moddeps="@DEPNAME@"
+ 
+ objects="@LOCALNAME@.o"
+ 
+ :<<\Make
+ @LOCALNAME@.mdd: alias.mdd.in
+ 	rm -f $@
+ 	cd $(sdir) && ./.preconfig
+ 
+ @LOCALNAME@.c: alias.c.in
+ 	sed 's,@NAME@,@LOCALNAME@,g' < $(sdir)/alias.c.in > $@
+ 
+ clean-here: clean.@LOCALNAME@
+ clean.@LOCALNAME@:
+ 	rm -f @LOCALNAME@.c
+ Make
diff -crN ../zsh+hname/Src/xmods.conf ./Src/xmods.conf
*** ../zsh+hname/Src/xmods.conf	Thu Dec 16 10:14:15 1999
--- ./Src/xmods.conf	Thu Dec 16 13:08:11 1999
***************
*** 8,10 ****
--- 8,29 ----
  zsh/computil
  zsh/parameter
  zsh/zleparameter
+ cap
+ clone
+ compctl
+ complete
+ complist
+ computil
+ deltochar
+ example
+ files
+ mapfile
+ mathfunc
+ parameter
+ rlimits
+ sched
+ stat
+ zftp
+ zle
+ zleparameter
+ zutil
END

