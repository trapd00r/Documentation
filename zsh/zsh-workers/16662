From zsh-workers-return-16662-mason-zsh=primenet.com.au@sunsite.dk Sun Feb 17 16:44:28 2002
Return-Path: <zsh-workers-return-16662-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20761 invoked from network); 17 Feb 2002 16:44:27 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 17 Feb 2002 16:44:27 -0000
Received: (qmail 2873 invoked by alias); 17 Feb 2002 16:44:20 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16662
Received: (qmail 2858 invoked from network); 17 Feb 2002 16:44:19 -0000
Date: Sun, 17 Feb 2002 11:44:15 -0500
From: Clint Adams <clint@zsh.org>
To: zsh-workers@sunsite.dk
Subject: PATCH: _cdcd tweaks
Message-ID: <20020217164415.GA14077@dman.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.3.27i

This removes the use of sed, grep, and seq.  I was tempted to "unroll"
the function calls, but decided that it wouldn't buy much.

Index: Completion/Unix/Command/_cdcd
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_cdcd,v
retrieving revision 1.1
diff -u -r1.1 _cdcd
--- Completion/Unix/Command/_cdcd	14 Feb 2002 17:56:54 -0000	1.1
+++ Completion/Unix/Command/_cdcd	17 Feb 2002 16:39:35 -0000
@@ -4,17 +4,17 @@
 
 _cdcd_tracks ()
 {
-    cdcd info | sed -e 1,2d -e 4d -e "s,Total tracks: *\([0-9]\+\).*,\1,"
+    print ${${${(f)"$(cdcd info)"}[3]}/Total tracks: #(#b)([0-9]##)*/$match[1]}
 }
 
 _cdcd_track_list ()
 {
-    seq 1 $(_cdcd_tracks)
+    print ${1..$(_cdcd_tracks)}
 }
 
 _cdcd_track_list_verbose ()
 {
-    cdcd tracks | grep "^[ 0-9]\+:" | sed -e 's,^ *\([0-9]\+\):[ >]*. *[^ ]* *\(.*\) \+,\1\\\:\"\2\",'
+    print ${${(M)${(f)"$(cdcd tracks)"}:#(#s) #[0-9]##:*}/(#s) #(#b)([0-9]##):[ >]#? #[^ ]# #(*) ##/$match[1]:${(qqq)match[2]}}
 }
 
 _cdcd_commands ()

