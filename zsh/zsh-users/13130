From zsh-users-return-13130-mason-zsh=primenet.com.au@sunsite.dk Mon Aug 11 15:30:57 2008
Return-Path: <zsh-users-return-13130-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26055 invoked from network); 11 Aug 2008 15:30:55 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 11 Aug 2008 15:30:55 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 49500 invoked from network); 11 Aug 2008 15:30:19 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 11 Aug 2008 15:30:19 -0000
Received: (qmail 23122 invoked by alias); 11 Aug 2008 15:29:36 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13130
Received: (qmail 23096 invoked from network); 11 Aug 2008 15:29:32 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 11 Aug 2008 15:29:32 -0000
Received: from dan.emsphone.com (dan.emsphone.com [199.67.51.101])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 45318809A180
	for <zsh-users@sunsite.dk>; Mon, 11 Aug 2008 17:29:18 +0200 (CEST)
Received: from dan.emsphone.com (smmsp@localhost [127.0.0.1])
	by dan.emsphone.com (8.14.3/8.14.2) with ESMTP id m7BFTEH4049002
	(version=TLSv1/SSLv3 cipher=DHE-RSA-AES256-SHA bits=256 verify=NO)
	for <zsh-users@sunsite.dk>; Mon, 11 Aug 2008 10:29:14 -0500 (CDT)
	(envelope-from dan@dan.emsphone.com)
Received: (from dan@localhost)
	by dan.emsphone.com (8.14.3/8.14.2/Submit) id m7BFTALT048992;
	Mon, 11 Aug 2008 10:29:11 -0500 (CDT)
	(envelope-from dan)
Date: Mon, 11 Aug 2008 10:29:10 -0500
From: Dan Nelson <dnelson@allantgroup.com>
To: Aaron Davies <aaron.davies@gmail.com>
Cc: "Benjamin R. Haskell" <zsh@benizi.com>, Zsh Users <zsh-users@sunsite.dk>
Subject: Re: Multi-Minute Startup?
Message-ID: <20080811152909.GA61872@dan.emsphone.com>
References: <alpine.LNX.1.10.0808070254580.26055@elation.Princeton.EDU> <c4e763ac0808070020r595f3b64u38eeefbc37bc85b6@mail.gmail.com> <alpine.LNX.1.10.0808070327310.26055@elation.Princeton.EDU> <c4e763ac0808070152k2846913dn4b637fe9ea275ef2@mail.gmail.com> <alpine.LNX.1.10.0808070509320.26055@elation.Princeton.EDU> <c4e763ac0808071832j6f7393fay158c7a2485ca41c9@mail.gmail.com> <20080808025823.GB68181@dan.emsphone.com> <c4e763ac0808072340l398c5209o1cd6ccd77ec08a7f@mail.gmail.com> <alpine.LNX.1.10.0808081201180.26055@elation.Princeton.EDU> <c4e763ac0808110248g7dedabb9kbe6af57fcb0b8d68@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <c4e763ac0808110248g7dedabb9kbe6af57fcb0b8d68@mail.gmail.com>
X-OS: FreeBSD 7.0-STABLE
User-Agent: Mutt/1.5.18 (2008-05-17)
X-Virus-Scanned: ClamAV 0.92.1/8007/Mon Aug 11 15:51:54 2008 on bifrost
X-Virus-Status: Clean

In the last episode (Aug 11), Aaron Davies said:
> On Sat, Aug 9, 2008 at 12:03 AM, Benjamin R. Haskell wrote:
> > On Fri, 8 Aug 2008, Aaron Davies wrote:
> >> On Fri, Aug 8, 2008 at 10:58 AM, Dan Nelson wrote:
> >>> In the last episode (Aug 08), Aaron Davies said:
> >>>>
> >>>> FWIW, "getent group" returns 773 lines and takes about 3.5
> >>>> minutes to run.
> >>>
> >>> If it takes that long to return only 773 lines, you should
> >>> probably turn on nscd, or if it's already on, crank up the cache
> >>> size and TTL.
> 
> ok, it is running, and it looks like it should be doing something.
> 
> > egrep passwd\|group /etc/nscd.conf
> # Currently supported cache names (services): passwd, group, hosts
>         enable-cache            passwd          yes
>         positive-time-to-live   passwd          600
>         negative-time-to-live   passwd          20
>         suggested-size          passwd          211
>         check-files             passwd          yes
>         persistent              passwd          yes
>         shared                  passwd          yes
>         enable-cache            group           yes
>         positive-time-to-live   group           3600
>         negative-time-to-live   group           60
>         suggested-size          group           211
>         check-files             group           yes
>         persistent              group           yes
>         shared                  group           yes
> 
> how would you suggest i modify these?
> 
> there are about 700 users and 800 groups in the getent results.

Disable persistent; nscd will crash when its persistent cache fills up.
Raise suggested-size to 1601 (a prime number larger than your current
list size with some room to grow).  Also, raise "positive-time-to-live
passwd" to 3600.  Group membership changes a lot more often than passwd
data does, so you might as well make them the same.  If you change
group memberships a lot, you might want to lower the group TTL (or
remember to bounce nscd whenever you make a change).  Note that
passwords aren't managed by nsswitch/nscd, so don't worry about a high
value desynchronizing passwords.

You can verify that it's working by timing two consecutive "getent
group" runs; the 2nd should return the entire list immediately.  "nscd
-g" also prints some stats, like hit and miss counts.

-- 
	Dan Nelson
	dnelson@allantgroup.com

