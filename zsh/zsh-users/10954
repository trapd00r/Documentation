From zsh-users-return-10954-mason-zsh=primenet.com.au@sunsite.dk Tue Nov 07 23:19:34 2006
Return-Path: <zsh-users-return-10954-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22890 invoked from network); 7 Nov 2006 23:19:29 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 7 Nov 2006 23:19:29 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 94084 invoked from network); 7 Nov 2006 23:19:20 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 Nov 2006 23:19:20 -0000
Received: (qmail 4306 invoked by alias); 7 Nov 2006 23:18:27 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10954
Received: (qmail 4224 invoked from network); 7 Nov 2006 23:18:24 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 7 Nov 2006 23:18:24 -0000
Received: (qmail 89196 invoked from network); 7 Nov 2006 23:18:23 -0000
Received: from dep.let.rug.nl (129.125.8.60)
  by a.mx.sunsite.dk with SMTP; 7 Nov 2006 23:18:16 -0000
Received: from dep.let.rug.nl ([129.125.8.60])
 by dep.let.rug.nl (SMSSMTP 4.1.11.41) with SMTP id M2006110800181601165
 for <zsh-users@sunsite.dk>; Wed, 08 Nov 2006 00:18:16 +0100
Received: from loki (loki.let.rug.nl [129.125.8.86])
	by dep.let.rug.nl (8.12.11.20060308/8.12.10) with ESMTP id kA7NIFek001178;
	Wed, 8 Nov 2006 00:18:15 +0100 (MET)
Received: by loki (Postfix, from userid 7006)
	id 2FAD0F1A0; Wed,  8 Nov 2006 00:18:15 +0100 (CET)
Date: Wed, 8 Nov 2006 00:18:12 +0100
From: Francisco Borges <f.borges@rug.nl>
To: zsh-users@sunsite.dk
Cc: chesss <testingagain@gmail.com>
Subject: Re: persistant Directory history?
Message-ID: <20061107231812.GA14067@let.rug.nl>
Mail-Followup-To: zsh-users@sunsite.dk, chesss <testingagain@gmail.com>
References: <5db995410611060845y53f673e6je029a9c60659f116@mail.gmail.com> <20061107145231.GA8117@let.rug.nl> <5db995410611071219q77820cfeg931ac950f744a276@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <5db995410611071219q77820cfeg931ac950f744a276@mail.gmail.com>
X-Operating-System: Linux/2.6.17-2-686 (i686)
Organization: Alfa Informatica - Rijksuniversiteit Groningen
User-Agent: Mutt/1.5.13 (2006-08-11)
X-Whitelist: OK
X-Scanned-By: milter-spamc/0.25.321 (dep.let.rug.nl [129.125.8.60]); Wed, 08 Nov 2006 00:18:16 +0100

: On Wed, Nov 08, 2006 at 01:49AM +0530, chesss wrote:

> Finally this worked for me  just perfect :)  . i got it from
> http://www.zsh.org/mla/users/2006/msg00173.html

That was my first attempt (i.e. taking code from someone else ;-)) to
solve it, but there were problems with it.

> DIRSTACKSIZE=20
> if [[ -f ~/.zdirs ]] && [[ ${#dirstack[*]} -eq 0 ]]; then
> dirstack=( $(< ~/.zdirs) )
> popd > /dev/null
> fi
> precmd() {
> dirs -l >! ~/.zdirs # added -l
> }
> cd
>
> The only problem with the above was that a new shell would start with
> the last directory. So I added the extra 'cd' at the end :D

Here are the caveats of that code:

1. it will fail if your directories have spaces in their names. To solve
   this you have to use "dirs -p" to put one dir per line, and use "f"
   to read them.

2. The popd is used to avoid having multiple repeated entries; but a
   beter solution is to simply use a "u" when loading the directories so
   that duplicate entries are deleted.

3. You dont need to save the dirstack after every command, only when you
   change dirs, so it's beter to use "chpwd" instead of "precmd".

Making these changes, you would have a better ;-) persistent dirstack
history with:

#----------------------------------------------------------
DIRSTACKSIZE=20
if [[ -f ~/.zdirs ]] && [[ ${#dirstack[*]} -eq 0 ]]; then
    dirstack=( ${(uf)"$(< ~/.zdirs)"} )
fi
chpwd() { dirs -pl >! ~/.zdirs }
#----------------------------------------------------------

If you want $OLDPWD to work as well, then you have to include

cd $dirstack[0] && cd - > /dev/null

inside that "if" block.

Cheers,
-- 
Francisco Borges

