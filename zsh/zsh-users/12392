From zsh-users-return-12392-mason-zsh=primenet.com.au@sunsite.dk Mon Jan 07 09:46:15 2008
Return-Path: <zsh-users-return-12392-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24559 invoked from network); 7 Jan 2008 09:46:06 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 7 Jan 2008 09:46:06 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 76476 invoked from network); 7 Jan 2008 09:45:51 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 Jan 2008 09:45:51 -0000
Received: (qmail 3595 invoked by alias); 7 Jan 2008 09:45:40 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12392
Received: (qmail 3578 invoked from network); 7 Jan 2008 09:45:39 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 7 Jan 2008 09:45:39 -0000
Received: from virusfilter.dotsrc.org (bifrost [127.0.0.1])
	by spamfilter.dotsrc.org (Postfix) with ESMTP id 43D138058FF2
	for <zsh-users@sunsite.dk>; Mon,  7 Jan 2008 10:45:38 +0100 (CET)
Received: from mho-01-bos.mailhop.org (mho-01-bos.mailhop.org [63.208.196.178])
	by bifrost.dotsrc.org (Postfix) with ESMTP
	for <zsh-users@sunsite.dk>; Mon,  7 Jan 2008 10:45:37 +0100 (CET)
Received: from a91-152-94-186.elisa-laajakaista.fi ([91.152.94.186])
	by mho-01-bos.mailhop.org with esmtpsa (TLSv1:AES256-SHA:256)
	(Exim 4.68)
	(envelope-from <casper.gripenberg@kotiportti.fi>)
	id 1JBoY4-00086Y-0Y
	for zsh-users@sunsite.dk; Mon, 07 Jan 2008 09:45:36 +0000
X-Mail-Handler: MailHop Outbound by DynDNS
X-Originating-IP: 91.152.94.186
X-Report-Abuse-To: abuse@dyndns.com (see http://www.mailhop.org/outbound/abuse.html for abuse reporting information)
X-MHO-User: U2FsdGVkX19nXbgVHmCpraf5uSxddVPHZmJuTJXz+YM=
Message-ID: <4781F4B2.3060909@kotiportti.fi>
Date: Mon, 07 Jan 2008 11:45:22 +0200
From: Casper Gripenberg <casper.gripenberg@kotiportti.fi>
User-Agent: Thunderbird 2.0.0.9 (Windows/20071031)
MIME-Version: 1.0
To: zsh-users@sunsite.dk
Subject: Re: History as in tcsh
References: <4781E0E4.2060108@eskk.nu> <237967ef0801070028p7cba65cdu63d744c240c2417@mail.gmail.com>
In-Reply-To: <237967ef0801070028p7cba65cdu63d744c240c2417@mail.gmail.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: ClamAV using ClamSMTP

Mikael Magnusson wrote:
> On 07/01/2008, Leslie Jensen <leslie@eskk.nu> wrote:
>> Hello
>>
>> I'm used to the tcsh and now when testing zsh the first thing that I
>> would like to customize is the way history works. I want to type one or
>> two characters and then hit the up arrow and get the commands that
>> starts with the two characters. At the moment I have the history in the
>> order it was typed. Can it be done and how?
>>
>> Thanks
>> /Leslie
> 
> I think
> bindkey '^[[A' up-line-or-search
> is what you want. Although you may have to replace the ^[[A bit with
> whatever your up arrow key sends to the terminal.

This doesn't quite work as expected. At least if you're used
to the tcsh model. It only searches for the first word on the
line. So if your do this:

# echo Hello
# echo doh
# echo H<up-line-or-search>  -> displays "echo doh"

The tcsh version is much more useful, so I ended up
implementing a copy. Put this somewhere in your startup
files:

-----------------------------------------------------------
_tcsh-history-search-init () {
     if [[ $HISTNO == $HISTCMD || \
           $CURSOR != $#BUFFER || \
           $history[$HISTNO] != ${HISTORY_SEARCH}* || \
           $history[$HISTNO] != ${LBUFFER}* ]]; then
         HISTORY_SEARCH="$LBUFFER"
     fi
}

tcsh-history-search-forward () {
     _tcsh-history-search-init
     zle .history-search-forward $HISTORY_SEARCH
}

tcsh-history-search-backward () {
     _tcsh-history-search-init
     zle .history-search-backward $HISTORY_SEARCH
}

zle -N tcsh-history-search-forward
zle -N tcsh-history-search-backward
-----------------------------------------------------------

Now you can bindkey it to what you like:
bindkey "^[p" tcsh-history-search-backward

Casper

