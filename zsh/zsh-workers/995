From pws@ifh.de Wed May  8 01:05:24 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3) with ESMTP id BAA26760 for <mason@werple.mira.net.au>; Wed, 8 May 1996 01:05:22 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id KAA13126; Tue, 7 May 1996 10:53:24 -0400 (EDT)
Resent-Date: Tue, 7 May 1996 10:53:24 -0400 (EDT)
Message-Id: <199605071452.QAA20774@hydra.ifh.de>
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: Re: fdtable 
In-reply-to: "pws@ifh.de"'s message of "Tue, 07 May 1996 10:17:21 MET."
	                  <199605070817.KAA08463@hydra.ifh.de> 
Date: Tue, 07 May 1996 16:52:40 +0200
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"GhrsH1.0.0D3.aFsZn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/995
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 2154
Status: O

I wrote:
> Shouldn't fdtable[] be `signed char'? (Yes.)

Zefram just pointed out the simplest thing to do was simply to define
signed to nothing if it isn't supported.  Here's the third attempt.
I'd be obliged if somebody using a K&R compiler could have a go at it.
(I did try it by altering the cached value to `no'.)

*** config.h.in.sig	Tue May  7 15:42:38 1996
--- config.h.in	Tue May  7 16:43:33 1996
***************
*** 96,101 ****
--- 96,104 ----
  /* Define to 1 if compiler incorrectly cast signed to unsigned */
  #undef BROKEN_SIGNED_TO_UNSIGNED_CASTING
  
+ /* Define to nothing if compiler does not handle `signed' keyword */
+ #undef signed
+ 
  /* Define if your system defines TIOCGWINSZ in sys/ioctl.h.  */
  #undef GWINSZ_IN_SYS_IOCTL
  
*** configure.in.sig	Fri May  3 20:54:33 1996
--- configure.in	Tue May  7 16:40:11 1996
***************
*** 154,159 ****
--- 154,167 ----
    AC_DEFINE(BROKEN_SIGNED_TO_UNSIGNED_CASTING)
  fi
  
+ dnl  Checking if complier handles `signed' keyword
+ AC_CACHE_CHECK(if the signed keyword is handled, zsh_cv_signed_keyword,
+ [AC_TRY_COMPILE(, [signed char foo; foo = -1;],
+ zsh_cv_signed_keyword=yes, zsh_cv_signed_keyword=no)])
+ if test $zsh_cv_signed_keyword = no; then
+   AC_DEFINE(signed, )
+ fi
+ 
  dnl ------------------
  dnl CHECK FOR PROGRAMS
  dnl ------------------
*** Src/globals.h.sig	Tue May  7 15:43:49 1996
--- Src/globals.h	Tue May  7 16:41:01 1996
***************
*** 397,403 ****
   * table is not used.  A table element is set by movefd and cleard *
   * by zclose.                                                      */
  
! EXTERN char fdtable[OPEN_MAX];
  
  /* input fd from the coprocess */
  
--- 397,403 ----
   * table is not used.  A table element is set by movefd and cleard *
   * by zclose.                                                      */
  
! EXTERN signed char fdtable[OPEN_MAX];
  
  /* input fd from the coprocess */
  
-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77330
Deutches Electronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.


