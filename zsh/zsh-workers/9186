From zsh-workers-return-9186-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Jan 03 13:44:52 2000
Return-Path: <zsh-workers-return-9186-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22878 invoked from network); 3 Jan 2000 13:44:51 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 3 Jan 2000 13:44:51 -0000
Received: (qmail 20839 invoked by alias); 3 Jan 2000 13:44:38 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9186
Received: (qmail 20831 invoked from network); 3 Jan 2000 13:44:37 -0000
Date: Mon, 03 Jan 2000 14:44:27 +0100
From: jarausch@igpm.rwth-aachen.de
Subject: patch [zsh-3.1.6-pws-13] zsh.h
To: zsh-workers@sunsite.auc.dk
Reply-to: jarausch@igpm.rwth-aachen.de
Message-id: <200001031344.OAA49240@numa1.igpm.rwth-aachen.de>
MIME-version: 1.0
Content-type: TEXT/plain; charset=us-ascii

The 64bit logic in zsh-3.1.6-pws-13 is broken since an additional
member has been added to struct heap.
Here is a patch

*** zsh-3.1.6-pws-13/Src/zsh.h	Mon Dec 20 22:55:00 1999
--- zsh-3.1.6-pws-13_OLD/Src/zsh.h	Mon Dec 20 22:55:19 1999
***************
*** 1556,1573 ****
  
  struct heap {
      struct heap *next;		/* next one                                  */
      size_t size;		/* size of heap                              */
      size_t used;		/* bytes used from the heap                  */
      struct heapstack *sp;	/* used by pushheap() to save the value used */
- 
- /* Make sure sizeof(heap) is a multiple of 8 
  #ifdef PAD_64_BIT
!     size_t dummy;		
  #endif
- */
  #define arena(X)	((char *) (X) + sizeof(struct heap))
  };
  
  #ifndef DEBUG
  # define HEAPALLOC	do { int nonlocal_useheap = global_heapalloc(); do
  
--- 1556,1570 ----
  
  struct heap {
      struct heap *next;		/* next one                                  */
      size_t size;		/* size of heap                              */
      size_t used;		/* bytes used from the heap                  */
      struct heapstack *sp;	/* used by pushheap() to save the value used */
  #ifdef PAD_64_BIT
!     size_t dummy;		/* Make sure sizeof(heap) is a multiple of 8 */
  #endif
  #define arena(X)	((char *) (X) + sizeof(struct heap))
  };
  
  #ifndef DEBUG
  # define HEAPALLOC	do { int nonlocal_useheap = global_heapalloc(); do
  

-- 
Helmut Jarausch
Lehrstuhl fuer Numerische Mathematik
Institute of Technology, RWTH Aachen
D 52056 Aachen, Germany

