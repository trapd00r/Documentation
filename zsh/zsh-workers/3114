From zsh-workers-request@euclid.skiles.gatech.edu Sat May 10 19:22:55 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 549 invoked from network); 10 May 1997 19:22:54 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 10 May 1997 19:22:54 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id PAA08282; Sat, 10 May 1997 15:09:46 -0400 (EDT)
Resent-Date: Sat, 10 May 1997 15:09:46 -0400 (EDT)
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <970510121241.ZM9715@candle.brasslantern.com>
Date: Sat, 10 May 1997 12:12:41 -0700
In-Reply-To: <199705101748.NAA01384@hzoli.home>
Comments: In reply to Zoltan Hidvegi <hzoli@ny.frontiercomm.net>
        "Re: test patches" (May 10,  1:48pm)
References: <199705101748.NAA01384@hzoli.home>
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: Zoltan Hidvegi <hzoli@ny.frontiercomm.net>
Subject: Re: test patches
Cc: zsh-workers@math.gatech.edu (Zsh hacking and development)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"YZR4M2.0.I12.vVCTp"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3114
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On May 10,  1:48pm, Zoltan Hidvegi wrote:
} Subject: Re: test patches
}
} > There still doesn't appear to be a test in init.c for the case where
} > the system supports TIOCGWINSZ but the rows and columns value in the
} > shttyinfo.winsize structure are both zero.  In that case we ought to
} > be using the row and column sizes from the termcap or terminfo entry?
} 
} The test is done in zlevarsetfn() in params.c.

Yeah, but all it does is pretend the terminal is very narrow and set the
imaginary columns and lines to 80 and 24.

A zero value in shttyinfo.winsize is a special indicator from the driver
that it doesn't know what the window size is.  The actual window shape
in that case is read from the termcap by most applications.  It doesn't
mean that the window is actually zero sized.

I should have remembered this when I was fiddling with this code some
months ago; I remembered it a few weeks later when Geoff was hacking on
the zle refresh stuff, and mentioned it on the list.

The same test should probably go in adjustwinsize, but I don't think the
driver ever sends SIGWINCH when it doesn't know the window shape, so it
isn't as important there.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts        http://www.nbn.com/people/lantern

