From zsh-workers-return-8468-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Oct 28 05:19:58 1999
Return-Path: <zsh-workers-return-8468-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4329 invoked from network); 28 Oct 1999 05:19:52 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 28 Oct 1999 05:19:52 -0000
Received: (qmail 17641 invoked by alias); 28 Oct 1999 05:19:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8468
Received: (qmail 17634 invoked from network); 28 Oct 1999 05:19:48 -0000
Date: Wed, 27 Oct 1999 22:19:20 -0700
From: "Melissa D. Binde" <binde@terindell.com>
To: Zefram <zefram@fysh.org>
Cc: zsh-workers@sunsite.auc.dk
Subject: Re: HP-UX B.11.00 9000/800
Message-ID: <19991027221920.C9237@amazon.com>
References: <19991013060822.B27595@terindell.com> <E11bLm3-0003S3-00@crucigera.fysh.org>
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary=RnlQjJ0d97Da+TV1
X-Mailer: Mutt 0.95.1us
In-Reply-To: <E11bLm3-0003S3-00@crucigera.fysh.org>; from Zefram on Wed, Oct 13, 1999 at 11:36:47AM +0100
Sender: binde@amazon.com


--RnlQjJ0d97Da+TV1
Content-Type: text/plain; charset=us-ascii

Thank you.  I ended up back-porting the patch to 3.0.6 (this looks like it
was made against your beta tree?), but it worked beautifully.

My back-ported patch (context-sensitive diff) is attached as an fyi.



On Wed Oct 13 at 11:36:47 AM, Zefram wrote:

> Melissa D. Binde wrote:
> >gawk on resource.h > rlimits.h is failing with exit status of 2.  It says
> >"unknown limits" and asks me to mail resource.h to the development team.
> 
> This patch adds support for the AIO_OPS and AIO_MEM resource limits.
> Let us know if you still have problems after applying it.
> 
> -zefram
> 
> diff -cr ../zsh-/Doc/Zsh/builtins.yo ./Doc/Zsh/builtins.yo
> *** ../zsh-/Doc/Zsh/builtins.yo	Wed Oct 13 11:12:13 1999
> --- ./Doc/Zsh/builtins.yo	Wed Oct 13 11:32:51 1999
> ***************
> *** 523,528 ****
> --- 523,530 ----
>   sitem(tt(maxproc))(Maximum number of processes.)
>   sitem(tt(addressspace))(Maximum amount of address space used.)
>   sitem(tt(cachedthreads))(Maximum number of cached threads.)
> + sitem(tt(aiooperations))(Maximum number of AIO operations.)
> + sitem(tt(aiomemorylocked))(Maximum amount of memory locked in RAM for AIO operations.)
>   endsitem()
>   
>   Which of these resource limits are available depends on the system.
> diff -cr ../zsh-/Src/Builtins/rlimits.awk ./Src/Builtins/rlimits.awk
> *** ../zsh-/Src/Builtins/rlimits.awk	Wed Oct 13 11:12:15 1999
> --- ./Src/Builtins/rlimits.awk	Wed Oct 13 11:19:29 1999
> ***************
> *** 6,12 ****
>   #
>   BEGIN {limidx = 0}
>   
> ! /^[\t ]*(#[\t ]*define[\t _]*RLIMIT_[A-Z]*[\t ]*[0-9][0-9]*|RLIMIT_[A-Z]*,[\t ]*)/ {
>       limindex = index($0, "RLIMIT_")
>       limtail = substr($0, limindex, 80)
>       split(limtail, tmp)
> --- 6,12 ----
>   #
>   BEGIN {limidx = 0}
>   
> ! /^[\t ]*(#[\t ]*define[\t _]*RLIMIT_[A-Z_]*[\t ]*[0-9][0-9]*|RLIMIT_[A-Z]*,[\t ]*)/ {
>       limindex = index($0, "RLIMIT_")
>       limtail = substr($0, limindex, 80)
>       split(limtail, tmp)
> ***************
> *** 35,40 ****
> --- 35,42 ----
>   	    if (limnam == "NPROC")   { msg[limnum] = "maxproc" }
>   	    if (limnam == "AS")      { msg[limnum] = "addressspace" }
>   	    if (limnam == "TCACHE")  { msg[limnum] = "cachedthreads" }
> + 	    if (limnam == "AIO_OPS") { msg[limnum] = "aiooperations" }
> + 	    if (limnam == "AIO_MEM") { msg[limnum] = "aiomemorylocked" }
>           }
>       }
>   }
> diff -cr ../zsh-/Src/Builtins/rlimits.c ./Src/Builtins/rlimits.c
> *** ../zsh-/Src/Builtins/rlimits.c	Wed Oct 13 11:12:15 1999
> --- ./Src/Builtins/rlimits.c	Wed Oct 13 11:29:55 1999
> ***************
> *** 218,223 ****
> --- 218,237 ----
>   	    printf("cached threads             ");
>   	break;
>   # endif /* RLIMIT_TCACHE */
> + # ifdef RLIMIT_AIO_OPS
> +     case RLIMIT_AIO_OPS:
> + 	if (head)
> + 	    printf("AIO operations             ");
> + 	break;
> + # endif /* RLIMIT_AIO_OPS */
> + # ifdef RLIMIT_AIO_MEM
> +     case RLIMIT_AIO_MEM:
> + 	if (head)
> + 	    printf("AIO locked-in-memory (kb)  ");
> + 	if (limit != RLIM_INFINITY)
> + 	    limit /= 1024;
> + 	break;
> + # endif /* RLIMIT_AIO_MEM */
>       }
>       /* display the limit */
>       if (limit == RLIM_INFINITY)
> ***************
> *** 538,543 ****
> --- 552,560 ----
>   # ifdef RLIMIT_VMEM
>   	    case RLIMIT_VMEM:
>   # endif /* RLIMIT_VMEM */
> + # ifdef RLIMIT_AIO_MEM
> + 	    case RLIMIT_AIO_MEM:
> + # endif /* RLIMIT_AIO_MEM */
>   		limit *= 1024;
>   		break;
>   	    }
> END





-M.

-- 
Melissa Binde
binde@amazon.com
Tools Engineer / Systems Engineering

--RnlQjJ0d97Da+TV1
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="patch-zsh-3.0.6-HP-UX"

diff -durpN zsh-3.0.6.orig/Src/builtin.c zsh-3.0.6/Src/builtin.c
--- zsh-3.0.6.orig/Src/builtin.c	Tue Jul 13 02:24:29 1999
+++ zsh-3.0.6/Src/builtin.c	Wed Oct 27 20:31:31 1999
@@ -3997,6 +3997,9 @@ bin_ulimit(char *name, char **argv, char
 # ifdef RLIMIT_VMEM
 	    case RLIMIT_VMEM:
 # endif /* RLIMIT_VMEM */
+# ifdef RLIMIT_AIO_MEM               
+            case RLIMIT_AIO_MEM:       
+# endif /* RLIMIT_AIO_MEM */  
 		limit *= 1024;
 		break;
 	    }
@@ -4196,6 +4199,20 @@ printulimit(int lim, int hard, int head)
 	    printf("cached threads             ");
 	break;
 # endif /* RLIMIT_TCACHE */
+  # ifdef RLIMIT_AIO_OPS     
+      case RLIMIT_AIO_OPS:   
+        if (head)            
+            printf("AIO operations             ");
+        break;
+  # endif /* RLIMIT_AIO_OPS */
+  # ifdef RLIMIT_AIO_MEM      
+      case RLIMIT_AIO_MEM:    
+        if (head)             
+            printf("AIO locked-in-memory (kb)  ");
+        if (limit != RLIM_INFINITY)               
+            limit /= 1024;                        
+        break;                        
+  # endif /* RLIMIT_AIO_MEM */      
     }
     /* display the limit */
     if (limit == RLIM_INFINITY)
diff -durpN zsh-3.0.6.orig/Src/rlimits.awk zsh-3.0.6/Src/rlimits.awk
--- zsh-3.0.6.orig/Src/rlimits.awk	Tue Apr 27 22:21:43 1999
+++ zsh-3.0.6/Src/rlimits.awk	Wed Oct 27 20:29:14 1999
@@ -7,7 +7,7 @@
 #
 BEGIN {limidx = 0}
 
-/^[\t ]*(#[\t ]*define[\t _]*RLIMIT_[A-Z]*[\t ]*[0-9][0-9]*|RLIMIT_[A-Z]*,[\t ]*)/ {
+/^[\t ]*(#[\t ]*define[\t _]*RLIMIT_[A-Z_]*[\t ]*[0-9][0-9]*|RLIMIT_[A-Z]*,[\t ]*)/ {
     limindex = index($0, "RLIMIT_")
     limtail = substr($0, limindex, 80)
     split(limtail, tmp)
@@ -35,6 +35,8 @@ BEGIN {limidx = 0}
 	    if (limnam == "NPROC")   { msg[limnum] = "maxproc" }
 	    if (limnam == "AS")      { msg[limnum] = "addressspace" }
 	    if (limnam == "TCACHE")  { msg[limnum] = "cachedthreads" }
+            if (limnam == "AIO_OPS") { msg[limnum] = "aiooperations" }          
+            if (limnam == "AIO_MEM") { msg[limnum] = "aiomemorylocked" }       
         }
     }
 }
diff -durpN zsh-3.0.6.orig/config.log zsh-3.0.6/config.log
--- zsh-3.0.6.orig/config.log	Wed Oct 27 20:32:00 1999
+++ zsh-3.0.6/config.log	Wed Dec 31 16:00:00 1969
@@ -1,4 +0,0 @@
-This file contains any messages produced by compilers while
-running configure, to aid debugging if configure makes a mistake.
-
-configure:586: checking host system type
Binary files zsh-3.0.6.orig/conftest and zsh-3.0.6/conftest differ

--RnlQjJ0d97Da+TV1--

