From zsh-users-return-2388-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Jun 15 07:29:05 1999
Return-Path: <zsh-users-return-2388-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13480 invoked from network); 15 Jun 1999 07:29:04 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 Jun 1999 07:29:04 -0000
Received: (qmail 29767 invoked by alias); 15 Jun 1999 07:28:23 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 2388
Received: (qmail 29753 invoked from network); 15 Jun 1999 07:28:21 -0000
Date: Tue, 15 Jun 1999 09:28:19 +0200 (MET DST)
Message-Id: <199906150728.JAA31275@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-users@sunsite.auc.dk
In-reply-to: Dominik Vogt's message of Mon, 14 Jun 1999 14:38:43 -0600
Subject: Re: killing commands in a pipe?


Dominik Vogt wrote:

> On Mon, Jun 14, 1999 at 10:17:26AM +0000, schaefer@candle.brasslantern.com wrote:
> > On Jun 14, 12:12pm, Dominik Vogt wrote:
> > } Subject: killing commands in a pipe?
> > }
> > } The problem is that although some_command_that_never_exits is
> > } killed as expected, the 'while' part of the pipe doesn't exit.
> > 
> > Try grabbing the patches from ftp://ftp.brasslantern.com/pub/zsh/ to
> > build 3.0.6-pre-4, and let me know if the problem persists there.
> 
> Yes, the problem is still there. BTW, I must have overlooked this
> when I wrote my first mail: the setting of HUP/NOHUP does not matter,
> the problem occurs in both cases.

Sorry I didn't try it yesterday...

The problem is that we have all this code in update_job() that handles 
such cases, but only if MONITOR is set -- which it isn't in a script-
shell.

I can only hope that the patch has no negative effects -- it is for
pws-21. I haven't tried it but I think it should also work with
3.0.5-pre-4.

Bye
 Sven

--- os/jobs.c	Mon Jun 14 09:16:19 1999
+++ Src/jobs.c	Tue Jun 15 09:16:27 1999
@@ -240,8 +240,11 @@
 		adjustwinsize(0);
 	    }
 	}
+    } else if (list_pipe && (val & 0200) && inforeground == 1) {
+	breaks = loops;
+	errflag = 1;
+	inerrflush();
     }
-
     if (somestopped && jn->stat & STAT_SUPERJOB)
 	return;
     jn->stat |= (somestopped) ? STAT_CHANGED | STAT_STOPPED :

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

