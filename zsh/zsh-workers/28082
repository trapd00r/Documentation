From zsh-workers-return-28082-mason-zsh=primenet.com.au@zsh.org Thu Jul 15 20:32:36 2010
Return-Path: <zsh-workers-return-28082-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 209 invoked by alias); 15 Jul 2010 20:32:36 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28082
Received: (qmail 27941 invoked from network); 15 Jul 2010 20:32:34 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.0 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,
	T_TO_NO_BRKTS_FREEMAIL autolearn=ham version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.212.43 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:from:to:cc:subject:date
         :message-id:x-mailer;
        bh=/Od0apgf4N1m1CQ8/4p16a30P3zoyPF3o5MqXV6JcEg=;
        b=L33bTzfzyyHDkn4NRrOaD9SdyvUWchM5SzPBB2wfHll+LyzB5UPIF0Qp2Pnh6kCvT3
         W5Zm1UFAFolWFbMMafDmUCh2/qFoc3qQGShc1KXKfJ9y1ACmah/BjYhjd36neiGtSU+A
         L7TqqM2O9JpUXM4wpIaHYUbH+ojq3GSZIysuE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=from:to:cc:subject:date:message-id:x-mailer;
        b=QWhCvlw6qUdgrpAdXLACzFRtQGaThjmVWYXP6bfWxYHFgNibIxIr/HF3MtwGUXbWS6
         dPMKHE7XOfZ0gHM1H50Cms2B5POojoZ26ft6e3vm0xNvP3xEQE+5ulEgRCo1qOMRUYRT
         UJVjptwXOl0NNWp8AE3b3VsaWIetYPA2Mqh+g=
From: Michael Hwang <michael.a.hwang@gmail.com>
To: zsh-workers@zsh.org
Cc: Michael Hwang <michael.a.hwang@gmail.com>
Subject: [PATCH] Allow completions inside --{gpg,tar}-args in gpg-zip.
Date: Thu, 15 Jul 2010 16:32:13 -0400
Message-Id: <1279225933-8651-1-git-send-email-michael.a.hwang@gmail.com>
X-Mailer: git-send-email 1.7.1.1

--gpg-args and --tar-args will complete based on values in --gpg and --tar, respectively. Also fixed return values.

Michael Hwang

---
 Completion/Unix/Command/_gpg |   16 +++++++++++-----
 1 files changed, 11 insertions(+), 5 deletions(-)

diff --git a/Completion/Unix/Command/_gpg b/Completion/Unix/Command/_gpg
index 3f86411..9b862cf 100644
--- a/Completion/Unix/Command/_gpg
+++ b/Completion/Unix/Command/_gpg
@@ -12,9 +12,9 @@ gpgv=('(-q --quiet)*'{-v,--verbose}'[increase amount of output]'
   '--homedir:directory:_directories')
 
 gpgzip=('--gpg[command to use instead of gpg]:command:_command'
-  '--gpg-args[gpg arguments]:gpg arguments:'
+  '--gpg-args[gpg arguments]:gpg arguments:->gpg'
   '--tar[command to use instead of tar]:command:_command'
-  '--tar-args[tar arguments]:tar arguments:'
+  '--tar-args[tar arguments]:tar arguments:->tar'
   '--list-archive[list archive contents]')
 
 gpgbasic=('(-e --encrypt)'{-e,--encrypt}'[encrypt data. this option may be combined  with --sign]'
@@ -193,15 +193,15 @@ gpgextra=('--decrypt-files[decrypt multiple files]'
 
 case "$service" in
   gpg)
-    _arguments -C -s -S -A "-*" $gpgbasic $gpgextra $gpgv '*:args:->args'
+    _arguments -C -s -S -A "-*" $gpgbasic $gpgextra $gpgv '*:args:->args' && ret=0
     ;;
 
   gpgv)
-    _arguments -C -s -S -A "-*" $gpgv '*:args:->args'
+    _arguments -C -s -S -A "-*" $gpgv '*:args:->args' && ret=0
     ;;
 
   gpg-zip)
-    _arguments -C -s -S -A "-*" $gpgbasic $gpgzip '*:args:->args'
+    _arguments -C -s -S -A "-*" $gpgbasic $gpgzip '*:args:->args' && ret=0
     ;;
 esac
 
@@ -249,6 +249,12 @@ case "$state" in
     _wanted public-keys expl 'public keyid' \
 	compadd ${${${(M)${(f)"$(_call_program public-keyids gpg $needed --list-public-keys --list-options no-show-photos 2>/dev/null)"}:%pub*}#pub */}%% *} && return
   ;;
+  (tar|gpg)
+    compset -q
+    words=( ${opt_args[--${state}]:-${state}} "$words[@]" )
+    (( CURRENT++ ))
+    _normal && return
+    ;;
 esac
 
 return ret
-- 
1.7.1.1

