From zsh-workers-return-9500-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Jan 31 18:36:04 2000
Return-Path: <zsh-workers-return-9500-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17477 invoked from network); 31 Jan 2000 18:36:03 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 31 Jan 2000 18:36:03 -0000
Received: (qmail 8791 invoked by alias); 31 Jan 2000 18:35:53 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9500
Received: (qmail 8783 invoked from network); 31 Jan 2000 18:35:52 -0000
Date: Mon, 31 Jan 2000 13:35:46 -0500
From: Clint Adams <schizo@debian.org>
To: ZSH-workers@sunsite.auc.dk
Subject: PATCH: mmap error
Message-ID: <20000131133546.A13537@dman.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
User-Agent: Mutt/1.0i

This is not an elegant solution.  Of course, I'm not even sure that it works.
The point is to not segfault after mmap failure.

Index: Src/mem.c
===================================================================
RCS file: /cvs/zsh/zsh/Src/mem.c,v
retrieving revision 1.1.1.14
diff -u -r1.1.1.14 mem.c
--- Src/mem.c	2000/01/20 09:01:44	1.1.1.14
+++ Src/mem.c	2000/01/31 18:21:46
@@ -356,6 +356,7 @@
 	    n = (n + pgsz) & ~pgsz;
 	    h = (Heap) mmap(NULL, n, PROT_READ | PROT_WRITE,
 			    MMAP_FLAGS, -1, 0);
+            if(h==-1) { perror("mmap error"); exit;}
 	    h->size = n;
 	}
 #else

