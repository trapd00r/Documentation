From zsh-users-return-14535-mason-zsh=primenet.com.au@zsh.org Wed Nov 04 11:07:07 2009
Return-Path: <zsh-users-return-14535-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21314 invoked by alias); 4 Nov 2009 11:07:07 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14535
Received: (qmail 27999 invoked from network); 4 Nov 2009 11:07:05 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00,
	DATE_IN_PAST_03_06 autolearn=no version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at benizi.com does not designate permitted sender hosts)
Date: Wed, 4 Nov 2009 02:15:04 -0500 (EST)
From: "Benjamin R. Haskell" <zsh@benizi.com>
To: zsh-users@zsh.org
Subject: Re: Unable to input multibyte characters.
In-Reply-To: <1257312064.27110.0@localhost>
Message-ID: <alpine.LNX.2.01.0911040059200.11663@hp.internal>
References: <1257312064.27110.0@localhost>
User-Agent: Alpine 2.01 (LNX 1266 2009-07-14)
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-1463810530-1865277150-1257314731=:11663"
Content-ID: <alpine.LNX.2.01.0911040124010.11663@hp.internal>

---1463810530-1865277150-1257314731=:11663
Content-Type: TEXT/PLAIN; charset=UTF-8
Content-Transfer-Encoding: 8BIT
Content-ID: <alpine.LNX.2.01.0911040124011.11663@hp.internal>

On Wed, 4 Nov 2009, Ian-Xue Li wrote:

> numerous
> Hi,
> my problem is that input "你好嗎" but appears some weird code like "ä好å¥?
> å¾å¥".

That appears to be the UTF-8 sequence 你好嗎 interpreted as some other 
char set. (e.g. ISO-8859-1)

$ echo 你好嗎 | iconv -f ISO-8859-1 -t UTF-8    
ä½ å¥½å

So, I suspect it's a locale issue.  What do you get from the 'locale' 
command?  For me, under Gentoo Linux, with working UTF-8 support, I get:

$ locale
LANG=en_US.UTF-8
LC_CTYPE="en_US.UTF-8"
LC_NUMERIC="en_US.UTF-8"
LC_TIME="en_US.UTF-8"
LC_COLLATE=POSIX (<-- personal preference... shouldn't matter here)
LC_MONETARY="en_US.UTF-8"
LC_MESSAGES="en_US.UTF-8"
LC_PAPER="en_US.UTF-8"
LC_NAME="en_US.UTF-8"
LC_ADDRESS="en_US.UTF-8"
LC_TELEPHONE="en_US.UTF-8"
LC_MEASUREMENT="en_US.UTF-8"
LC_IDENTIFICATION="en_US.UTF-8"
LC_ALL=

> I tried setting the multibyte option by "setopt multibyte", but after 
> that, "setopt" outputs no multibyte flag in its listing. So I figure 
> there might be something wrong with the version 4.3.10 ?

If built with multibyte support, the default is that multibyte will be on.  
For me (with multibyte working):

$ set -o | grep multibyte
nomultibyte           off

(The 'no' prefix means that it's on by default.)


> Terminal is urxvt and xterm, both were unable to input Chinese and 
> Japanese characters with SCIM. (doable in bash, nothing else is 
> changed.)

With rxvt-unicode (urxvt), the following works for me:

$ scim -d
# SCIM starts as daemon
$ XMODIFIERS=@im=SCIM GTK_IM_MODULE=scim QT_IM_MODULE=scim urxvt
(... new urxvt starts ...)

$ <Ctrl+Space>
(...activates scim-pinyin... and I'm able to enter things via pinyin.)



To be sure Zsh itself is okay, you can try the following:

$ autoload insert-unicode-char
$ zle -N insert-unicode-char
$ bindkey "^U" insert-unicode-char

Then, to type your 'ni hao ma' from before, where '^U' represents Ctrl+U:

^U 4f60 ^U ^U 597d ^U ^U 55ce ^U

(The first '^U' tells Zsh to expect a hex-coded Unicode charpoint.  The 
second '^U' tells Zsh you're finished inputting the hex and then it 
inserts the char.)


> 
> I've also recompiled Zsh with an explicit "--enable-multibyte" && has 
> started Zsh with --multibyte flag, they did no help.
> 
> (this is vital because there are numerous files are named in these 
> characters, and I use the shell tools to manage them. So please help !)
> 

Best,
Ben
---1463810530-1865277150-1257314731=:11663--

