From zsh-workers-return-15060-mason-zsh=primenet.com.au@sunsite.dk Mon Jun 25 00:40:14 2001
Return-Path: <zsh-workers-return-15060-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12206 invoked from network); 25 Jun 2001 00:40:11 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 25 Jun 2001 00:40:11 -0000
Received: (qmail 25166 invoked by alias); 25 Jun 2001 00:39:13 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15060
Received: (qmail 25153 invoked from network); 25 Jun 2001 00:39:12 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010625003725.ZM12423@candle.brasslantern.com>
Date: Mon, 25 Jun 2001 00:37:25 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.dk
Subject: PATCH: Assorted test tweaks
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

In zsh-workers/14971 I wrote:
} 
} ZTST_execchunk can't handle "&& {\n...\n}".

Of course that's not it; what it can't handle is blank lines in a chunk.

This patch is 14970 corrected for the above, plus a tweak to A02alias to
account for 15050.

diff -x CVS -u zsh-forge/current/Test/A02alias.ztst zsh-4.0/Test/A02alias.ztst
--- zsh-forge/current/Test/A02alias.ztst	Mon Apr  2 05:30:15 2001
+++ zsh-4.0/Test/A02alias.ztst	Sun Jun 24 17:31:53 2001
@@ -15,7 +15,7 @@
 >echo
 
   \foo foo
-1:Not aliasing
+127:Not aliasing
 ?ZTST_execchunk:2: command not found: foo
 
   \bar \bar
diff -x CVS -u zsh-forge/current/Test/Y01completion.ztst zsh-4.0/Test/Y01completion.ztst
--- zsh-forge/current/Test/Y01completion.ztst	Mon Apr  2 05:35:14 2001
+++ zsh-4.0/Test/Y01completion.ztst	Sun Jun 24 17:28:14 2001
@@ -6,12 +6,13 @@
   mkdir comp.tmp
   cd comp.tmp
 
-  comptestinit -z $ZTST_testdir/../Src/zsh
-
+  comptestinit -z $ZTST_testdir/../Src/zsh &&
+  {
   mkdir dir1
   mkdir dir2
   touch file1
   touch file2
+  }
 
 %test
 
diff -x CVS -u zsh-forge/current/Test/Y02compmatch.ztst zsh-4.0/Test/Y02compmatch.ztst
--- zsh-forge/current/Test/Y02compmatch.ztst	Mon Apr  2 05:35:31 2001
+++ zsh-4.0/Test/Y02compmatch.ztst	Sun Jun 24 17:29:23 2001
@@ -16,10 +16,10 @@
   mkdir match.tmp
   cd match.tmp
 
-  comptestinit -z $ZTST_testdir/../Src/zsh
-
-  list1=(IndianRed IndianRed2 IndianRed3 IndianRed4)
-  test_code () {
+  comptestinit -z $ZTST_testdir/../Src/zsh &&
+  {
+    list1=(IndianRed IndianRed2 IndianRed3 IndianRed4)
+    test_code () {
 	matcher=$1;
 	list=$2;
 	code="compdef _tst tst ; _tst () { echo -n '<COMPADD>';compadd -M '"
@@ -31,11 +31,9 @@
         code="$code; echo -n '</INSERT_POSITIONS>'"
         code="$code}"
 	comptesteval "$code"
+    }
   }
 
-
-
-	 
 
 %test
 
diff -x CVS -u zsh-forge/current/Test/Y03arguments.ztst zsh-4.0/Test/Y03arguments.ztst
--- zsh-forge/current/Test/Y03arguments.ztst	Mon Apr  2 05:35:48 2001
+++ zsh-4.0/Test/Y03arguments.ztst	Sun Jun 24 17:29:37 2001
@@ -6,9 +6,11 @@
   mkdir comp.tmp
   cd comp.tmp
 
-  comptestinit -z $ZTST_testdir/../Src/zsh
+  comptestinit -z $ZTST_testdir/../Src/zsh &&
+  {
   comptesteval 'compdef _tst tst'
   tst_arguments () { comptesteval "_tst () { _arguments ${${(@qq)*}} }" }
+  }
 
 %test
  tst_arguments ':desc1:(arg1)'
diff -x CVS -u zsh-forge/current/Test/comptest zsh-4.0/Test/comptest
--- zsh-forge/current/Test/comptest	Sat Jun  9 10:24:31 2001
+++ zsh-4.0/Test/comptest	Mon Jun 18 11:57:55 2001
@@ -5,7 +5,7 @@
           $ZTST_srcdir/../Completion
           $ZTST_srcdir/../Completion/*/*~*/CVS(/) )
 
-  zmodload -i zsh/zpty
+  zmodload -i zsh/zpty || return $?
 
   comptest_zsh=${ZSH:-zsh}
 

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

