From zsh-workers-return-23310-mason-zsh=primenet.com.au@sunsite.dk Mon Apr 23 16:00:54 2007
Return-Path: <zsh-workers-return-23310-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9324 invoked from network); 23 Apr 2007 16:00:52 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.8 (2007-02-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO
	autolearn=ham version=3.1.8
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 Apr 2007 16:00:52 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 91801 invoked from network); 23 Apr 2007 16:00:46 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 Apr 2007 16:00:46 -0000
Received: (qmail 5754 invoked by alias); 23 Apr 2007 16:00:43 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23310
Received: (qmail 5744 invoked from network); 23 Apr 2007 16:00:43 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 23 Apr 2007 16:00:42 -0000
Received: (qmail 91495 invoked from network); 23 Apr 2007 16:00:42 -0000
Received: from wr-out-0506.google.com (64.233.184.228)
  by a.mx.sunsite.dk with SMTP; 23 Apr 2007 16:00:38 -0000
Received: by wr-out-0506.google.com with SMTP id i28so1609374wra
        for <zsh-workers@sunsite.dk>; Mon, 23 Apr 2007 09:00:36 -0700 (PDT)
DKIM-Signature: a=rsa-sha1; c=relaxed/relaxed;
        d=gmail.com; s=beta;
        h=domainkey-signature:received:received:message-id:date:from:to:subject:cc:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references;
        b=LH4esPIUQRLMhhBUPH6gzekev03jzfxw+ZGVmpQlarSrTAN+I/mEQpX9kpFhuIrpLqvAM3ScLDWc9DUGcxLk5iGjqHdCLMgyrIDfsXy+1pm1nxh5w0d7sJde+/2ZngsiCDTOKjJF5NDrV8VRMMoKx1jNShluhG0+CPllIuPtekk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=beta;
        h=received:message-id:date:from:to:subject:cc:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references;
        b=s5B1rVXzcPnwWzDyDOJ4CK/ANEpNAAtAqBgDA22ZaB/3bS2nNyYcKhWOzWtSWbyT/DI/rQ5bhXek8elIaGtjeKfiKue3HMiprr6efqO1WgCPzP4ZhrpRgnR2q9xPQ9a7Jvl85wka353oYL7ZZT9EV1qxWkfD4mudl5v6l5Y81zI=
Received: by 10.78.122.16 with SMTP id u16mr467819huc.1177344033854;
        Mon, 23 Apr 2007 09:00:33 -0700 (PDT)
Received: by 10.78.45.10 with HTTP; Mon, 23 Apr 2007 09:00:33 -0700 (PDT)
Message-ID: <237967ef0704230900r21af3aa1od42cd0b41abe2251@mail.gmail.com>
Date: Mon, 23 Apr 2007 18:00:33 +0200
From: "Mikael Magnusson" <mikachu@gmail.com>
To: "Peter Stephenson" <pws@csr.com>
Subject: Re: zsh 4.3.4 released
Cc: "Zsh hackers list" <zsh-workers@sunsite.dk>
In-Reply-To: <200704231506.l3NF6Njx011759@news01.csr.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
References: <200704161647.l3GGl2FE027950@news01.csr.com>
	 <20070419120758.e9774528.pws@csr.com>
	 <237967ef0704201440g1c072ca8l451439d2ec8578bf@mail.gmail.com>
	 <20070423104151.1f5f368e.pws@csr.com>
	 <237967ef0704230550k41ddb13fy60deebd526ecc5ec@mail.gmail.com>
	 <200704231318.l3NDIONr006499@news01.csr.com>
	 <237967ef0704230722u7546461ehd6b3280df79352a0@mail.gmail.com>
	 <200704231506.l3NF6Njx011759@news01.csr.com>

On 23/04/07, Peter Stephenson <pws@csr.com> wrote:
> "Mikael Magnusson" wrote:
> > (gdb) print tindent
> > $12 = -2
>
> Thanks.  This is the problem; tindent should never be less than zero.
> I'm not sure why I'm not seeing it; it might suggest the structure with
> the function in it is already corrupt at the point where you run
> "which".
>
> The following patch should stop the crash (so it's probably worth
> having) and report at the point where it first becomes confused, though
> it doesn't address the underlying problem.
>
> Is it possibly you have old wordcode for the dot file that might define
> svmode?  (Obviously the shell should be robust even if this is the case;
> since the wordcode has a version stamp this shouldn't happen with a
> released version of the shell.)

Aha, this seems to have been the problem. I renamed my .zshurxvt.zwc
and it doesn't crash anymore. I always run zrecompile -p on all my .z*
files after upgrading zsh but apparently it only takes effect if the
.file is newer than the .file.zwc, maybe it should also take effect if
$SHELL is newer than the .zwc?

-- 
Mikael Magnusson

