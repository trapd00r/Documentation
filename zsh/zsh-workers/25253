From zsh-workers-return-25253-mason-zsh=primenet.com.au@sunsite.dk Thu Jun 26 17:29:23 2008
Return-Path: <zsh-workers-return-25253-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1701 invoked from network); 26 Jun 2008 17:29:21 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 26 Jun 2008 17:29:21 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 46452 invoked from network); 26 Jun 2008 17:29:18 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 26 Jun 2008 17:29:18 -0000
Received: (qmail 22388 invoked by alias); 26 Jun 2008 17:29:15 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25253
Received: (qmail 22375 invoked from network); 26 Jun 2008 17:29:15 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 26 Jun 2008 17:29:15 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [208.87.233.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 0D0BC80561C1
	for <zsh-workers@sunsite.dk>; Thu, 26 Jun 2008 19:29:11 +0200 (CEST)
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly29g.srv.mailcontrol.com (MailControl) with ESMTP id m5QHT8Vx012228
	for <zsh-workers@sunsite.dk>; Thu, 26 Jun 2008 18:29:08 +0100
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 26 Jun 2008 18:29:05 +0100
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.2/8.13.4) with ESMTP id m5QHT5iQ021208
	for <zsh-workers@sunsite.dk>; Thu, 26 Jun 2008 18:29:05 +0100
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.2/8.14.2/Submit) with ESMTP id m5QHSr5F021201
	for <zsh-workers@sunsite.dk>; Thu, 26 Jun 2008 18:29:05 +0100
Message-Id: <200806261729.m5QHSr5F021201@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: Re: PATCH: anonymous functions (no documentation yet)
In-reply-to: <080626101233.ZM2893@torch.brasslantern.com>
References: <18441.1214488302@csr.com> <9646.1214491732@thecus> <200806261506.m5QF6aCd019139@news01.csr.com> <080626101233.ZM2893@torch.brasslantern.com>
Comments: In-reply-to Bart Schaefer <schaefer@brasslantern.com>
   message dated "Thu, 26 Jun 2008 10:12:33 -0700."
Date: Thu, 26 Jun 2008 18:28:53 +0100
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 26 Jun 2008 17:29:05.0953 (UTC) FILETIME=[224AB110:01C8D7B2]
X-Scanned-By: MailControl A-08-50-03 (www.mailcontrol.com) on 10.71.0.139
X-Virus-Scanned: ClamAV 0.92.1/7572/Thu Jun 26 18:25:12 2008 on bifrost
X-Virus-Status: Clean

Bart Schaefer wrote:
> I like this idea although I prefer the "function { ... }" syntax to the
> empty parens with nothing before them.

It's pretty much inevitable they'll both be available.

> With FUNCTION_ARGZERO set, what's the value of $0 inside an anonymous
> function?  What's the value of $functions[$0] ?

$0 will be "(anon)" which is similar to "(eval)" in debug prompts.
There's no entry in the function table, so $functions[$0] won't be set
unless someone as defined a real function called "(anon)" which is
eccentric but valid (underlying problem is as below: *any* string
whatsoever is a valid function name; in principle you can even have
embedded nulls because this is all done internally).  $funcstack[1] will
be "(argv)".

> On Jun 26,  4:06pm, Peter Stephenson wrote:
> } Subject: Re: PATCH: anonymous functions (no documentation yet)
> }
> } Oliver Kiddle wrote:
> } >   f ''() { ... }
> } > 
> } > might have the effect of defining a function f and running it
> } > immediately. And then you might write: f '' ''() { ... } and so on.
> } 
> } That ought to be a relatively straightforward addition, I think, subject
> } to the query above.
> 
> What would the form with multiple empty-string arguments mean?  Call
> the function multiple times?  (Anyway I take it from later remarks
> that ''() already defines a function with the empty name, so probably
> this "name it but also call it" idea won't work.)

The last sentence appears to be correct.

> } > What effect does all this have on the positional parameters?
> } 
> } Positional parameters from the surrounding area would be hidden and the
> } local parameter list empty.  I could easily copy them in so that they
> } could be used and modified without affecting the calling environment.
> 
> I'm of two minds on that score.  On the one hand it'd be nice to be able
> to get at the surrounding $@.  On the other it may often be a needless
> expense.

Indeed, though unless your parameter list is humongous it won't be a big
effect.  On the other hand. humongous parameter lists are not unknown
with things like zargs.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

