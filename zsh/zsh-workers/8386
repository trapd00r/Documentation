From zsh-workers-return-8386-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Oct 24 05:05:55 1999
Return-Path: <zsh-workers-return-8386-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7581 invoked from network); 24 Oct 1999 05:05:53 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 24 Oct 1999 05:05:53 -0000
Received: (qmail 22835 invoked by alias); 24 Oct 1999 05:05:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8386
Received: (qmail 22828 invoked from network); 24 Oct 1999 05:05:48 -0000
Date: Sun, 24 Oct 1999 01:05:45 -0400
From: Clint Adams <schizo@debian.org>
To: Bart Schaefer <schaefer@candle.brasslantern.com>
Cc: zsh-workers@sunsite.auc.dk
Subject: Re: 3.0 DESTDIR
Message-ID: <19991024010545.A1872@dman.com>
References: <991019052248.ZM4198@candle.brasslantern.com> <991019061342.ZM4317@candle.brasslantern.com> <19991023204554.A31639@dman.com> <991024015558.ZM1246@candle.brasslantern.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
User-Agent: Mutt/1.0pre4i
In-Reply-To: <991024015558.ZM1246@candle.brasslantern.com>; from schaefer@candle.brasslantern.com on Sun, Oct 24, 1999 at 01:55:57AM +0000

> However, I now can't see how
> 
> 	make DESTDIR=/foo/bar/baz install
> 
> differs in end result from
> 
> 	make
> 	make prefix=/foo/bar/baz/usr/local install

Well, I can answer that since my surprise at those two not being effectively
the same is precisely the reason I wanted DESTDIR in the first place:
(illustration using bart7)

% ./configure --prefix=/usr
[output elided]
% make
[output elided]
% make prefix=/tmp/zshtest/usr install
[output elided]
% strings /tmp/zshtest/usr/bin/zsh | grep tmp
/tmp/zshtest/usr/share/zsh/functions
/tmp/zshtest/usr/lib/zsh/3.1.6-bart-7
/tmp/zsh
/tmp/zsh
/var/log/wtmp
/var/run/utmp
% /tmp/zshtest/usr/bin/zsh -f
% echo $fpath
/tmp/zshtest/usr/share/zsh/functions

The functions are there, as are the modules, but if you were to
chroot to /tmp/zshtest, you'd be screwed.

DESTDIR provides a safe way to guarantee against this sort of thing
because nothing depends on it but the install, whereas prefix is used
to generate fndir and libdir, which are then used in the somewhat
unexpected recompile and relink during the install target.  I hope
that that was coherent.

