From zsh-workers-return-28079-mason-zsh=primenet.com.au@zsh.org Thu Jul 15 15:21:53 2010
Return-Path: <zsh-workers-return-28079-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24477 invoked by alias); 15 Jul 2010 15:21:53 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28079
Received: (qmail 14048 invoked from network); 15 Jul 2010 15:21:52 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at morini.apam.columbia.edu does not designate permitted sender hosts)
Date: Thu, 15 Jul 2010 11:21:48 -0400
From: Pavol Juhas <pj2192@columbia.edu>
To: zsh workers <zsh-workers@zsh.org>
Subject: truncated alternate history
Message-ID: <20100715152148.GA21056@columbia.edu>
Mail-Followup-To: zsh workers <zsh-workers@zsh.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.20 (2009-06-14)

Hello,

I found some odd behavior when using local history in zsh 4.3.10 -
the alternate history file seems to be loaded only up to the
global history number:

    $ yes | head -7000 > ~/longhistory
    $ historylength() { fc -p -a ~/longhistory 7000; fc -l 1 -1 | wc -l }
    $ historylength	# global history number is 4004
    4003                # expected 7000

The behavior seems to be correct if the history push/pop commands
are on separate lines:

    $ fc -p ~/longhistory 7000
    $ fc -l 1 -1 | wc -l
    6999
    $ fc -P
    # global history number is 4006

but fails when all commands are on the same line:

    $ fc -p ~/longhistory 7000;  fc -l 1 -1 | wc -l;  fc -P
    4005
    
Would it be possible to fix this?

On a side note - I have used this feature in a "scd" function that
allows to quickly search and change among recently visited directories.
The script installs a chpwd hook that pushes all visited directories
to the .scdhistory file; the recently visited directories are returned
at a top of the matchlist.

If there is any interest, I would be glad to post / contribute this script.

Thanks,

Pavol

