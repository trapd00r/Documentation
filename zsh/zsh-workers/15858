From zsh-workers-return-15858-mason-zsh=primenet.com.au@sunsite.dk Sun Sep 23 21:44:12 2001
Return-Path: <zsh-workers-return-15858-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7779 invoked from network); 23 Sep 2001 21:44:11 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 23 Sep 2001 21:44:11 -0000
Received: (qmail 7950 invoked by alias); 23 Sep 2001 21:44:02 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15858
Received: (qmail 7932 invoked from network); 23 Sep 2001 21:44:01 -0000
Message-ID: <3BAE579A.3010205@slacknet.org>
Date: Sun, 23 Sep 2001 17:43:54 -0400
From: Wes Morgan <wesm@slacknet.org>
User-Agent: Mozilla/5.0 (Macintosh; U; PPC Mac OS X; en-US; rv:0.9.4) Gecko/20010913
X-Accept-Language: en-us
MIME-Version: 1.0
To: zsh-workers <zsh-workers@sunsite.dk>
Subject: Re: Compiling zsh-4.0.2 on Mac OS X
References: <3B5E0BBE.8020100@slacknet.org> <200108311712.MAA23833@wo1203.cmg.FCNBD.COM> <3B8FCFC4.869C0D51@yahoo.co.uk>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit

This patch causes the "checking for executable suffix..." test in the 
configure script to fail with "compiler cannot create executables." The 
man page for ld on Mac OS X says that -x overlaps with a compiler option 
and that to invoke it from cc, it needs to be specified as "-Wl,-x". I 
changed this in the configure script and configure worked again. Then 
"make" succeeded, but "make check" had some problems. I don't know if 
they are specific to OS X or something I did/didn't do. Here's the errors:

Test ./C02cond.ztst failed: bad status 1, expected 0 from:
  [[ -k modish && ! -k zerolength ]]
Was testing: -k cond

Test ./Y01completion.ztst failed: non-zero status from preparation code:
  comptestinit -z $ZTST_testdir/../Src/zsh

Test ./Y01completion.ztst failed: bad status 1, expected 0 from:
  comptest $': \t\t\t\t\t\t\t'
Error output:
comptest:2: command not found: zpty
comptest:3: command not found: zpty
Was testing: directories and files

Test ./Y02compmatch.ztst failed: non-zero status from preparation code:
  comptestinit -z $ZTST_testdir/../Src/zsh

Test ./Y02compmatch.ztst failed: bad status 1, expected 0 from:
 test_code z: list1
 comptest  $'tst \t'
Error output:
comptesteval:4: command not found: zpty
comptesteval:5: command not found: zpty
comptest:2: command not found: zpty
comptest:3: command not found: zpty
Was testing: Match Error for "z:"

Test ./Y03arguments.ztst failed: bad status 1, expected 0 from:
 tst_arguments ':desc1:(arg1)'
 comptest $'tst \t\C-wa\t\C-war\t\C-warg\t\C-warg1\t\C-wr\t\C-wx\t \ty \t'
Error output:
comptesteval:4: command not found: zpty
comptesteval:5: command not found: zpty
comptest:2: command not found: zpty
comptest:3: command not found: zpty
Was testing: one non-option argument

Thanks,
Wes Morgan

Oliver Kiddle wrote:

>Brian Boonstra wrote:
>
>>  I solved this by running
>>          autoconf
>>in the top-level source directory.  That gave me a configure script with
>>more options, including one for the ldflags, which I then set to be nothing.
>>
>
>I take it there no problems with the clear ldflags then?
>
>>  I suppose this is ultimately a problem with autoconf.
>>
>
>What version of autoconf do you have? I'd be suprised if 2.5x doesn't
>handle MacOS X.
>
>Judging by one section of zshconfig.ac, it is probably a zsh problem.
>Can you try with this patch. You will need to rerun autoconf (or
>Util/preconfig) or manually apply this to configure itself.
>
>Does anyone know if ${enable_zsh_debug} is definitely empty for a no
>value as I've assumed here? The -x option may not be right in which case
>we could use nothing.
>
>Oliver
>
>Index: zshconfig.ac
>===================================================================
>RCS file: /cvsroot/zsh/zsh/zshconfig.ac,v
>retrieving revision 1.17
>diff -u -r1.17 zshconfig.ac
>--- zshconfig.ac        2001/07/03 17:34:33     1.17
>+++ zshconfig.ac        2001/08/31 17:47:17
>@@ -307,6 +307,7 @@
> if test -n "$auto_ldflags"; then
>   case "${enable_zsh_debug}$host_os" in
>     yesaix*|yeshpux*|yesnetbsd*|yesopenbsd*) ;;  # "ld -g" is not valid
>on these systems
>+    darwin*) LDFLAGS=-x ;;
>     yes*)    LDFLAGS=-g ;;
>     *)       LDFLAGS=-s ;;
>   esac
>
>_____________________________________________________________________
>This message has been checked for all known viruses by the 
>MessageLabs Virus Scanning Service. For further information visit
>http://www.messagelabs.com/stats.asp
>


