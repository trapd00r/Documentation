From zsh-workers-request@math.gatech.edu Tue May 19 17:38:33 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24708 invoked from network); 19 May 1998 17:38:32 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 19 May 1998 17:38:32 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id NAA04792;
	Tue, 19 May 1998 13:34:28 -0400 (EDT)
Resent-Date: Tue, 19 May 1998 13:34:28 -0400 (EDT)
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <980519102749.ZM15183@candle.brasslantern.com>
Date: Tue, 19 May 1998 10:27:49 -0700
In-Reply-To: <19980519094017.A9893@dtthp169.pdx.intel.com>
Comments: In reply to Clint Olsen <olsenc@ichips.intel.com>
        "Re: 3.0.5: eval `resize` messes up" (May 19,  9:40am)
References: <199805180745.AA013327509@rfcom704.kobe.hp.com> 
	<19980512092717.A13425@dtthp169.pdx.intel.com> 
	<19980518011037.A25015@dtthp169.pdx.intel.com> 
	<980518112027.ZM10579@candle.brasslantern.com> 
	<19980519002131.C4456@dtthp169.pdx.intel.com> 
	<980519093419.ZM14978@candle.brasslantern.com> 
	<19980519094017.A9893@dtthp169.pdx.intel.com>
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: Clint Olsen <olsenc@ichips.intel.com>
Subject: Re: 3.0.5: eval `resize` messes up
Cc: zsh-workers@math.gatech.edu
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"qb3Md1.0.pA1.aASOr"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3989
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On May 19,  9:40am, Clint Olsen wrote:
} Subject: Re: 3.0.5: eval `resize` messes up
}
} On May 19, Bart Schaefer wrote:
} > 
} > OK, next question ... what exactly does it not do, that 3.0.2 does?
} 
} Eval `resize` no longer sets the window to the new size so that programs
} like less etc. etc. use the correct terminal window size.

Ah!  Now we're getting somewhere.  If you look in Src/utils.c at around
lines 875-885 you'll see that setting the window size now happens only
when COLUMNS and LINES actually change (rather than on every settyinfo()
as it did before) and that it's now conditional upon `interact' being
true.  If you're interested in running the debugger, you could check the
value of the `from' parameter in adjustwinsize() and see whether that
`if (interact && ...)' case is executing.

The first thing I'd check, though, is that configure did its job correctly
so that TIOCGWINSZ is actually defined at that point when compiling utils.c.
The code in adjustwinsize() is definitely working for me on Linux; I tried
this experiment:

zagzig[38] foo=$(resize)
( stretch the xterm to be much bigger than it was )
zagzig[39] vi
( verify that vim is using the new terminal size )
zagzig[40] eval $foo
zagzig[41] unset LINES COLUMNS
zagzig[42] vi
( vim is now using the old, smaller terminal size )

With LINES and COLUMNS unset, the only place vim could have read the smaller
terminal size is from the tty driver, so zsh must have reset it at the time
of the `eval $foo'.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

