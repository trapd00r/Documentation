From zsh-workers-return-11142-mason-zsh=primenet.com.au@sunsite.auc.dk Thu May 04 08:41:44 2000
Return-Path: <zsh-workers-return-11142-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1558 invoked from network); 4 May 2000 08:41:41 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 4 May 2000 08:41:41 -0000
Received: (qmail 17988 invoked by alias); 4 May 2000 08:41:32 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11142
Received: (qmail 17965 invoked from network); 4 May 2000 08:41:32 -0000
Date: Thu, 4 May 2000 10:41:29 +0200 (MET DST)
Message-Id: <200005040841.KAA20875@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 04 May 2000 14:24:33 +0900
Subject: PATCH: Re: side effect of promptsubst.


Tanaka Akira wrote:

> Z(4):akr@serein% zsh -f
> serein% setopt promptsubst
> serein% print -lr - ' 
> quote> aaaaaaaaaaaaaaaaaaaaaaaaaaabcdddddddd'
>  
> aaaaaaaaaaaaaaaaaaaaaaaaaaab
> serein%
> 
> The argument is truncated.  This problem doesn't arised without
> promptsubst.

Missing save/restore for one of the variables used during lexing.

Bye
 Sven

Index: Src/lex.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/lex.c,v
retrieving revision 1.3
diff -u -r1.3 lex.c
--- Src/lex.c	2000/04/06 17:21:52	1.3
+++ Src/lex.c	2000/05/04 08:41:03
@@ -178,6 +178,7 @@
     char *yytext;
     char *bptr;
     int bsiz;
+    int len;
     short *chwords;
     int chwordlen;
     int chwordpos;
@@ -236,6 +237,7 @@
     ls->yytext = yytext;
     ls->bptr = bptr;
     ls->bsiz = bsiz;
+    ls->len = len;
     ls->chwords = chwords;
     ls->chwordlen = chwordlen;
     ls->chwordpos = chwordpos;
@@ -296,6 +298,7 @@
     yytext = lstack->yytext;
     bptr = lstack->bptr;
     bsiz = lstack->bsiz;
+    len = lstack->len;
     chwords = lstack->chwords;
     chwordlen = lstack->chwordlen;
     chwordpos = lstack->chwordpos;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

