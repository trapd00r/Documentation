From zsh-workers-return-20788-mason-zsh=primenet.com.au@sunsite.dk Fri Feb 04 21:16:28 2005
Return-Path: <zsh-workers-return-20788-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27733 invoked from network); 4 Feb 2005 21:16:28 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 4 Feb 2005 21:16:28 -0000
Received: (qmail 56935 invoked from network); 4 Feb 2005 21:14:13 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Feb 2005 21:14:13 -0000
Received: (qmail 28253 invoked by alias); 4 Feb 2005 19:01:10 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20788
Received: (qmail 28243 invoked from network); 4 Feb 2005 19:01:10 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 4 Feb 2005 19:01:10 -0000
Received: (qmail 87733 invoked from network); 4 Feb 2005 19:00:29 -0000
Received: from ip-66-80-62-153.dsl.sca.megapath.net (HELO ripple.fruitbat.org) (66.80.62.153)
  by a.mx.sunsite.dk with SMTP; 4 Feb 2005 19:00:24 -0000
Received: (from daemon@localhost)
	by ripple.fruitbat.org (8.10.2/8.8.8/PAC-1.3) id j14IwkB13332;
	Fri, 4 Feb 2005 10:58:46 -0800
Received: from ming.fruitbat.org(192.168.1.2) by ripple.fruitbat.org via smap (V2.1/2.1+anti-relay+anti-spam)
	id xma013327; Fri, 4 Feb 05 10:58:25 -0800
Received: from ming.fruitbat.org (IDENT:202@ming.fruitbat.org [192.168.1.2])
	by ming.fruitbat.org (8.12.10/8.10.2/PAC-1.6) with ESMTP id j14ItF8p011738;
	Fri, 4 Feb 2005 10:55:15 -0800
Date: Fri, 4 Feb 2005 10:55:15 -0800 (PST)
From: "Peter A. Castro" <doctor@fruitbat.org>
To: Peter Stephenson <pws@csr.com>
cc: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: 4.2.4 failure on MacOS X
In-Reply-To: <200502031719.j13HJO7b006036@news01.csr.com>
Message-ID: <Pine.LNX.4.58.0502041025040.17079@ming.fruitbat.org>
References: <200502031615.j13GFnuc005915@news01.csr.com>
 <1050203162852.ZM14033@candle.brasslantern.com> <200502031719.j13HJO7b006036@news01.csr.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On Thu, 3 Feb 2005, Peter Stephenson wrote:

> > gcc -Wl,-x   -o zsh main.o  `cat stamp-modobjs`   -L/sw/lib -lpcre -ldl
> > -ltinfo -lm  -lc
> > ld: Undefined symbols:
> > _libiconv
> > _libiconv_close
> > _libiconv_open
>
> Another possibility:  this error doesn't show the headers, and we now
> attempt to compile in the iconv stuff if the headers only were found:
>
> #   if defined(HAVE_ICONV_H) || defined(HAVE_ICONV) || defined(HAVE_LIBICONV)
>
> Peter, are the tests for HAVE_ICONV_H really necessary on Cygwin?
> Shouldn't HAVE_LIBICONV be defined from the test you added?

Not really, but it did make sense at the time.  You can't compile without
the header, and you can't link without the library, so both must be
present in some form or another.  It's assumed that if the header is
present the function is available.  The question is what library contains
it?  Under Cygwin, the header was available, but the detection of the
library had to be change because the real function name was 'libiconv',
not 'iconv'.  It's possible for iconv to be contained in a different
library under a different name, so perhaps configure should search a few
more places to find in (maybe using the AC_SEARCH_LIBS macro)?  Can
someone who's got a Mac OS-X environment determine what libraries contain
iconv (and where)?  Or is this a matter of the header exists but the
function doesn't?  I'm not sure how one would safe guard against this
without having some really ugly #if statements, or have it as a configure
option.

-- 
Peter A. Castro <doctor@fruitbat.org> or <Peter.Castro@oracle.com>
	"Cats are just autistic Dogs" -- Dr. Tony Attwood

