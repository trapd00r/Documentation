From zsh-workers-return-28998-mason-zsh=primenet.com.au@zsh.org Thu Apr 14 22:43:01 2011
Return-Path: <zsh-workers-return-28998-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23990 invoked by alias); 14 Apr 2011 22:43:00 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28998
Received: (qmail 13142 invoked from network); 14 Apr 2011 22:42:49 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.7 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FROM,RCVD_IN_DNSWL_LOW autolearn=ham
	version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.214.43 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:from:to:subject:date:message-id:x-mailer;
        bh=uWpvrI8R7qZgdlzgSnH4/ufaYzWYcsIDhTrAeEtdka8=;
        b=XA2uuGBnO4Q1nKAtlkFhdHITSOT+6Yd4+N6XoOHbDomsiMCbw1ETZ4QoAOCtTer96z
         7dhrghnEu5merot5snct87oYQjg7F9gytG0du3i5NPyNfgdXeCsL6pBrlQw7apr4D/HR
         Ljvfz7/+7+dywmlmbsS/tHip1ROYUI3aj9iho=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=from:to:subject:date:message-id:x-mailer;
        b=SZMytNHVIZx+YaA9eKfu6JWMfpRUv5/6wasq6E/Y1DSHB4gPd6KGHAd99egT0cioYh
         PW2tessoUmIjpnxcMQMv11lUNZutIVZ3+QudbYXwaXsZRs+PRrzz8PT6nhQyOX6UVmeo
         Wd8CuVcwV0N7dmlcKubZNNVpUScF9q2750D2Q=
From: Mikael Magnusson <mikachu@gmail.com>
To: zsh workers <zsh-workers@zsh.org>
Subject: [PATCH] make: return true if we added completions
Date: Fri, 15 Apr 2011 00:34:38 +0200
Message-Id: <1302820478-22574-1-git-send-email-mikachu@gmail.com>
X-Mailer: git-send-email 1.7.4-rc1

Does this look right?

---
 Completion/Unix/Command/_make |   13 ++++++++-----
 1 files changed, 8 insertions(+), 5 deletions(-)

diff --git a/Completion/Unix/Command/_make b/Completion/Unix/Command/_make
index e404d16..1e62c0d 100644
--- a/Completion/Unix/Command/_make
+++ b/Completion/Unix/Command/_make
@@ -5,6 +5,7 @@
 
 local prev="$words[CURRENT-1]" file expl tmp is_gnu dir incl match
 local -A TARGETS VARIABLES
+local ret=1
 
 expandVars() {
   local open close var val front ret tmp=$1
@@ -159,10 +160,10 @@ fi
 
 if [[ "$prev" == -[CI] ]]
 then
-  _files -W ${(q)$(findBasedir ${words[1,CURRENT-1]})} -/
+  _files -W ${(q)$(findBasedir ${words[1,CURRENT-1]})} -/ && ret=0
 elif [[ "$prev" == -[foW] ]]
 then
-  _files -W ${(q)$(findBasedir $words)}
+  _files -W ${(q)$(findBasedir $words)} && ret=0
 else
   file="$words[(I)-f]"
   if (( file ))
@@ -208,15 +209,17 @@ else
     # Complete make variable as if shell variable
     compstate[parameter]="${PREFIX%%\=*}"
     compset -P 1 '*='
-    _value "$@"
+    _value "$@" && ret=0
   else
     _tags targets variables
     while _tags
     do
       _requested targets expl 'make targets' \
-        compadd -- ${(k)TARGETS}
+        compadd -- ${(k)TARGETS} && ret=0
       _requested variables expl 'make variables' \
-        compadd -S '=' -- ${(k)VARIABLES}
+        compadd -S '=' -- ${(k)VARIABLES} && ret=0
     done
   fi
 fi
+
+return ret
-- 
1.7.4-rc1

