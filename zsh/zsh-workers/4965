Delivered-To: mason-zsh@primenet.com.au
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <990124164144.ZM8650@candle.brasslantern.com>
Date: Sun, 24 Jan 1999 16:41:44 -0800
In-Reply-To: <9901231125.AA13246@ibmth.df.unipi.it>
Comments: In reply to Peter Stephenson <pws@ibmth.df.unipi.it>
        "zsh-3.1.5-pws-5 available" (Jan 23, 12:25pm)
References: <9901231125.AA13246@ibmth.df.unipi.it>
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: zsh-workers@sunsite.auc.dk, Peter Stephenson <pws@ibmth.df.unipi.it>
Subject: PATCH: Missing bits Re: zsh-3.1.5-pws-5 available
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailing-List: <zsh-workers@sunsite.auc.dk> 4965

On Jan 23, 12:25pm, Peter Stephenson wrote:
} Subject: zsh-3.1.5-pws-5 available
}
} It includes pretty much everything up to Friday, excluding Sven's last
} patch for completion after redirection.

This patch covers:

4951	Sven	Tweak completion of words following a redirection operator
4794 	Bart	Fix associative array handling in setsparam()
????	Bart	Fix the 4974 fix by adding missing parens

The ???? there refers to this article, whatever number it gets ... one part
of the patch in 4974 was included, another was not, probably because of the
missed parens that are added in the patch below.

Index: Src/Zle/zle_tricky.c
--- ../zsh-3.1.5-pws-5/Src/Zle/zle_tricky.c	Fri Jan 22 05:13:49 1999
+++ ./Src/Zle/zle_tricky.c	Sun Jan 24 10:47:22 1999
@@ -1039,7 +1039,8 @@
 		rd = linredir;
 		if (inwhat == IN_NOTHING && incond)
 		    inwhat = IN_COND;
-	    }
+	    } else if (linredir)
+		continue;
 	    if (!tokstr)
 		continue;
 	    /* Hack to allow completion after `repeat n do'. */

diff -ru ../patched/zsh-3.1.5-pws-5/Src/params.c ./Src/params.c
--- ../patched/zsh-3.1.5-pws-5/Src/params.c	Wed Jan 13 00:20:25 1999
+++ ./Src/params.c	Sun Jan 24 10:25:10 1999
@@ -1500,7 +1500,7 @@
     } else {
 	if (!(v = getvalue(&s, 1)))
 	    createparam(t, PM_SCALAR);
-	else if (PM_TYPE(v->pm->flags) == PM_ARRAY &&
+	else if ((PM_TYPE(v->pm->flags) & (PM_ARRAY|PM_HASHED)) &&
 		 !(v->pm->flags & PM_SPECIAL) && unset(KSHARRAYS)) {
 	    unsetparam(t);
 	    createparam(t, PM_SCALAR);

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

