From zsh-workers-return-15914-mason-zsh=primenet.com.au@sunsite.dk Sun Sep 30 16:40:43 2001
Return-Path: <zsh-workers-return-15914-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22282 invoked from network); 30 Sep 2001 16:40:42 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 30 Sep 2001 16:40:42 -0000
Received: (qmail 24067 invoked by alias); 30 Sep 2001 16:40:37 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15914
Received: (qmail 24055 invoked from network); 30 Sep 2001 16:40:36 -0000
From: Borsenkow Andrej <Andrej.Borsenkow@mow.siemens.ru>
To: Bart Schaefer <schaefer@brasslantern.com>
Cc: zsh-workers@sunsite.dk, lordzork@lordzork.com
Message-ID: <3BB74AF3.8000600@mow.siemens.ru>
Date: Sun, 30 Sep 2001 20:40:19 +0400
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:0.9.4) Gecko/20010914
X-Accept-Language: en-us
MIME-Version: 1.0
Subject: Re: error on TTY read: no such file or directory
References: <3BB63D16.5040709@mow.siemens.ru> 	<20010929173848.H16561@hithaeglir.net> 	<3BB64378.8060505@mow.siemens.ru> 	<20010929181100.I16561@hithaeglir.net> 	<1010929223918.ZM20169@candle.brasslantern.com> 	<20010929202423.K16561@hithaeglir.net> 	<1010930012412.ZM20346@candle.brasslantern.com> 	<20010929213405.L16561@hithaeglir.net> 	<3BB6BAD4.5080201@mow.siemens.ru> 	<20010930074816.N16561@hithaeglir.net> 	<20010930133842.C2654@fysh.org> <1010930162212.ZM21385@candle.brasslantern.com>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit

Bart Schaefer wrote:

> On Sep 30,  1:38pm, Zefram wrote:
> } Subject: Re: error on TTY read: no such file or directory
> }
> } lordzork@lordzork.com wrote:
> } >i made a new strace, this time without zsh reading any of its start up
> } >files. my idea was that this would make it easier to read, but the new
> } >strace looks completely different from the old one, at least to me.
> } 
> } It's still doing the same impossible thing.
> 
> I never saw the previous trace.   Looking at this one, I note that it's
> doing this impossible thing a lot, but only on fd 10, and sometimes zsh
> just ignores the problem and loops.  (That would happen when errno == 0,
> or if the impossible occurred somewhere other than in getkey().)
> 


In first strace I got it does it exactly once and then bails out. Not 
that it helps much.


> Ignoring the problem would mean that zsh discarded at least one char of
> input if there really were any, but there's no evidence of input being
> lost.  That in turn makes me think that reads from the tty are behaving
> as if they're non-blocking, but for some reason are returning 1025 when
> they should be returning -1 with EWOULDBLOCK.
> 


I very much like to see what happens with "standard" mingetty instead of 
agetty. There is always a small chance it sets tty into some weird mode.


-andrej

