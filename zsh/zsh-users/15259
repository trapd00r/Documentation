From zsh-users-return-15259-mason-zsh=primenet.com.au@zsh.org Mon Aug 09 17:58:30 2010
Return-Path: <zsh-users-return-15259-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19080 invoked by alias); 9 Aug 2010 17:58:30 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15259
Received: (qmail 8891 invoked from network); 9 Aug 2010 17:58:27 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-0.7 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,RCVD_IN_NJABL_SPAM,
	T_TO_NO_BRKTS_FREEMAIL,UNPARSEABLE_RELAY autolearn=no version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at yahoo.no does not designate permitted sender hosts)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.no;
  h=DKIM-Signature:Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Content-Type:To:Date:Subject:MIME-Version:Content-Transfer-Encoding:From:Message-ID:User-Agent;
  b=eYpxCrLQ5Qr1rz3j+gknGSmDHVyv1R4HZMCFIHrtfgCeQpooLeKHAX+CVxvr+S1iW8TnxAO7IBtfBL43jftF63li9oJO8yjHep3PPVCfILf20hrQR3TXQIL+BrYIIdDjcA1mrIpseEt52mww6kpM8W3IY9rInmd0lgWnVu9EbXg=  ;
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.no; s=s1024; t=1281374747; bh=kn0a8CFw+LxVMLkotOdUvXCz6jyWSmo0V9yO8ANx63w=; h=Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Content-Type:To:Date:Subject:MIME-Version:Content-Transfer-Encoding:From:Message-ID:User-Agent; b=RQBDVICatB4c2sUYK8LAoYnal+vL4AD5XNOxJ1ISBUja1LK7c/DzSkmVhutjqUFjPHGVSFP+TktUbXVdvgBjVNkkZZJN8RhS2atj0rVqm+3hYnlUZIMp3oYgzfzfPB2U2r1nT8BIYoH0mOU4x152zGpbFsc8wCErsG2LYFuazkU=
X-Yahoo-SMTP: GVxjiN6swBBXSp72Za0CO9rW.O37AdI-
X-YMail-OSG: lT7Y8fAVM1ntsnnibIT4D0lWsjQkDIlhbnyYB9N_AKUomFl
 b02Yah0ngmj.RdOe39aLugTjw2GsKmTPvQstKPUMstn2p0UR_r0nzAhY97ji
 VaAzjcDRimswchI6adYiZkOEKoXGA4OPVDetroreVHnZyenEh_OGWtR4S.iQ
 cL7azssjHB.QFZF9_GvVUdmBZOC.nzgOQS8AI.lVKCkkxbG.7fEB9ser5gjo
 hnTUAuZZY4zEfF_srcSzUGFH5ifpt2eKWkPOLCkPOgYkEvn3xGBml.FbaK.m
 uyoDlj8wXv4vjIcfiGe_kAotHEUZwMdoYsWRETm.xkJXaQIC9b8EwbsifgUy
 TEkap4eg4oMwCPmpMJdw.o8TUaBXW0Edz4lFeNsK9JkrVhN_BEbYQp2igSbZ
 x9iqtltkpY70qOcNUhHH0YlU-
X-Yahoo-Newman-Property: ymail-3
Content-Type: text/plain; charset=utf-8; format=flowed; delsp=yes
To: zsh-users@zsh.org
Date: Mon, 09 Aug 2010 19:25:41 +0200
Subject: $KEYMAP in command, isearch and menuselect
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
From: =?utf-8?Q?Ole_J=C3=B8rgen_Br=C3=B8nner?= <olejorgenb@yahoo.no>
Message-ID: <op.vg6lcz2hvocxtk@tabole>
User-Agent: Opera Mail/10.10 (Linux)

I was trying to make a zle widget to display the currently active bindings when I noticed that KEYMAP is set to 'main' in widgets run from command, isearch and menuselect.

show-keymap() {
	{ print "$KEYMAP:\n"; bindkey -M $KEYMAP } | less
}
zle -N show-keymap
bindkey -M vicmd "^Ki" show-keymap
bindkey -M main "^Ki" show-keymap
bindkey -M command "^Ki" show-keymap
bindkey -M menuselect "^Ki" show-keymap
bindkey -M isearch "^Ki" show-keymap

In 'command' the binding doesn't work. (since you only can bind a few widgets in 'command')

In vicmd and main it works as expected

In isearch and menuselect the 'main' keymap is displayed and the search/completion is aborted on the current entry.

Poking in the code for 'executenamedcommand', it seems there is something called a 'localkeymap' and this is not exposed to zle widgets.

Any solution for this?

- Ole Jørgen Brønner

