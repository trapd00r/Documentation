From zsh-workers-return-6249-mason-zsh=primenet.com.au@sunsite.auc.dk Mon May 10 13:59:14 1999
Return-Path: <zsh-workers-return-6249-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 580 invoked from network); 10 May 1999 13:59:12 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 10 May 1999 13:59:12 -0000
Received: (qmail 26355 invoked by alias); 10 May 1999 13:58:42 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6249
Received: (qmail 26348 invoked from network); 10 May 1999 13:58:41 -0000
Date: Mon, 10 May 1999 15:58:34 +0200 (MET DST)
Message-Id: <199905101358.PAA15395@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Peter Stephenson's message of Mon, 10 May 1999 13:21:20 +0200
Subject: Re: Bug in mult_isarr


Peter Stephenson wrote:

> Modifiers and split process substitutions don't seem to go together too
> well with the mult_isarr patch (6046).
> 
> % print "${(@)${(@)=$(echo yan tan tethera dick)}:##t*}"
> 
> before:
> 
> yan dick
> 
> after:
> 
> yan tan tethera dick
> 
> The example that I originally found was presumably triggering the same
> thing, 
> 
> % print "${(@)${(@f)$(typeset)}:#*local *\=*}"
> 
> where you get nothing after the patch.  However, I also noticed that in
> that case if you miss out the `:' the shell hangs.

The patch below fixes this -- remember me saying that I had to put the 
`mult_isarr = isarr' further up than I would have done if the singleton-
array-to-string conversion hadn't been there?

The second example now works for me, too. I couldn't get it to hang,
though. However, in the shell I tested it I have the magic hashes from 
6198 where a simple `typeset' could cause the shell to SEGV -- if you
have that in the shell you tried this with, too, you'll better remove
it -- I hope to send a patch for a module with those special
parameters this week anyway.

Bye
 Sven

--- os/subst.c	Fri May  7 14:55:12 1999
+++ Src/subst.c	Mon May 10 15:46:53 1999
@@ -1465,6 +1465,7 @@
 		val = aval[0];
 	    else
 		isarr = 2;
+	    mult_isarr = isarr;
 	}
     }
     if (casmod) {

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

