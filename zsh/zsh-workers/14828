From zsh-workers-return-14828-mason-zsh=primenet.com.au@sunsite.dk Sat Jun 09 17:59:09 2001
Return-Path: <zsh-workers-return-14828-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22062 invoked from network); 9 Jun 2001 17:59:08 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 9 Jun 2001 17:59:08 -0000
Received: (qmail 14820 invoked by alias); 9 Jun 2001 17:58:47 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14828
Received: (qmail 14802 invoked from network); 9 Jun 2001 17:58:47 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer david.siemens.de)
Message-ID: <3B22646C.2050307@mow.siemens.ru>
Date: Sat, 09 Jun 2001 22:01:16 +0400
From: Andrej Borsenkow <Andrej.Borsenkow@mow.siemens.ru>
User-Agent: Mozilla/5.0 (X11; U; Linux 2.4.5-3mdk i686; en-US; rv:0.9.1) Gecko/20010608
X-Accept-Language: en-us
MIME-Version: 1.0
To: Timothy Miller <tsm@transit.cs.brown.edu>
CC: zsh-workers@sunsite.dk
Subject: Re: zsh 4.0.1 make check failures on irix, freebsd, solaris, aix, linux
References: <yehd78epir3.fsf@water.cs.brown.edu> <1010609045924.ZM6260@candle.brasslantern.com> <yeh8zj1r5sb.fsf@transit.cs.brown.edu>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit

Timothy Miller wrote:

> Some more details then:
> 
> the zsh linking command from "CC=cc ./configure --prefix=/cs" is
> 
> LD_RUN_PATH=/cs/lib/zsh cc -qlanglvl=ansi  -s  -o zsh main.o libzsh-4.0.1.so -ldl -lcurses -lm  -lc
> 
> The error that produces on trying to run the resulting zsh is
> 
> exec(): 0509-036 Cannot load program ./zsh because of the following errors:
>         0509-022 Cannot load library libzsh-4.0.1.so.
>         0509-026 System error: A file or directory in the path name does not 
>         exist.
> 
> I changed the link line to
> 
> cc -qlanglvl=ansi  -s  -o zsh main.o  -L/cs/lib/zsh libzsh-4.0.1.so -ldl -lcurses -lm  -lc
> 
> which produced the zsh that just segfaulted. It turns out it doesn't
> segfault if you don't install any modules and run it with -f, but does if
> the modules are installed or -f isn't given.
>



Timothy, have you tried my patch? I am pretty sure, the actual problem 
is that we still need export files even in case of dlopen() (libtool 
documentation mentions, that shared objects on AIX must self-contained; 
we try outsmart it :-).

 
> 
> Options (-bOptions)
> 
> The following values are possible for the Options variable of the -b flag. You
> can list more than one option after the -b flag, separating them with a single
> blank.
> 
> [...]
> 


Alas, you omitted the most interesting part - system-specific options ...

> 
> LIBPATH If LIBPATH is defined, its value is used as the default libary path
> information. Otherwise, the default library path information is /usr/lib:/lib.
> If no -L flags are specified and no -blibpath option is specified, the default
> library path information is written in the loader section of the output file.
> Regardless of any options specified, LIBPATH is not used when searching for
> libraries that are specified from the command line.
>


That would be very useful if we needed libzsh - but Oliver said, we did 
not need it even on 3.x version - so I guess we do not need it here as well.

-andrej

