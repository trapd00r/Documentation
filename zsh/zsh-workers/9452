From zsh-workers-return-9452-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Jan 28 09:03:01 2000
Return-Path: <zsh-workers-return-9452-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6161 invoked from network); 28 Jan 2000 09:02:56 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 28 Jan 2000 09:02:56 -0000
Received: (qmail 20487 invoked by alias); 28 Jan 2000 09:02:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9452
Received: (qmail 20476 invoked from network); 28 Jan 2000 09:02:38 -0000
Date: Fri, 28 Jan 2000 10:02:37 +0100 (MET)
Message-Id: <200001280902.KAA20141@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: _arguments


Doing diff --exclude=<TAB> showed something I would like to call a
thinko in _arguments: it expanded the option to --exclude-from,
completed after it, and also showed the message for --exclude=.

This makes it show only the message.

Bye
 Sven

diff -ru ../z.old/Completion/Base/_arguments Completion/Base/_arguments
--- ../z.old/Completion/Base/_arguments	Thu Jan 27 17:07:16 2000
+++ Completion/Base/_arguments	Fri Jan 28 09:57:23 2000
@@ -258,7 +258,7 @@
         fi
       fi
 
-      if [[ -z "$matched" ]] && _requested options &&
+      if [[ -z "$matched$mesg" ]] && _requested options &&
           { ! zstyle -t ":completion${curcontext}:options" prefix-needed ||
             [[ "$origpre" = [-+]* ||
                ( -z "$aret$mesg" && nm -eq compstate[nmatches] ) ]] } ; then
@@ -301,7 +301,7 @@
 	IPREFIX="$previpre"
       fi
     done
-    if [[ -n "$opts" && -z "$aret$matched" &&
+    if [[ -n "$opts" && -z "$aret$matched$mesg" &&
           nm -eq compstate[nmatches] ]]; then
 
       PREFIX="$origpre"

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

