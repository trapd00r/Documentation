From zsh-workers-return-25818-mason-zsh=primenet.com.au@sunsite.dk Mon Oct 06 19:47:37 2008
Return-Path: <zsh-workers-return-25818-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17982 invoked from network); 6 Oct 2008 19:47:35 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 6 Oct 2008 19:47:35 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 58465 invoked from network); 6 Oct 2008 19:47:23 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 6 Oct 2008 19:47:23 -0000
Received: (qmail 29112 invoked by alias); 6 Oct 2008 19:47:11 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25818
Received: (qmail 29092 invoked from network); 6 Oct 2008 19:47:09 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 6 Oct 2008 19:47:09 -0000
Received: from cork.scru.org (cork.scru.org [209.20.67.2])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id EB54280308BD
	for <zsh-workers@sunsite.dk>; Mon,  6 Oct 2008 21:47:02 +0200 (CEST)
Received: by cork.scru.org (Postfix, from userid 1000)
	id DCF371040A4; Mon,  6 Oct 2008 19:47:00 +0000 (UTC)
Date: Mon, 6 Oct 2008 19:47:00 +0000
From: Clint Adams <schizo@debian.org>
To: Morita Sho <morita-pub-en-debian@inz.sakura.ne.jp>,
	501248@bugs.debian.org
Cc: zsh-workers@sunsite.dk
Subject: Re: Bug#501248: /usr/share/zsh/functions/Completion/compinstall:
	compinstall doesn't keep the previous configuration.
Message-ID: <20081006194700.GC5175@scru.org>
Mail-Followup-To: Morita Sho <morita-pub-en-debian@inz.sakura.ne.jp>,
	501248@bugs.debian.org, zsh-workers@sunsite.dk
References: <20081005223201.17132.55292.reportbug@debian>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20081005223201.17132.55292.reportbug@debian>
User-Agent: Mutt/1.5.18 (2008-05-17)
X-Virus-Scanned: ClamAV 0.92.1/8378/Mon Oct  6 14:51:03 2008 on bifrost
X-Virus-Status: Clean

On Mon, Oct 06, 2008 at 07:32:01AM +0900, Morita Sho wrote:
> Running compinstall will lost the setting that is previously configured using compinstall.
> 
> How to reproduce:
> 
>   % compinstall
>   ... Change some settings and exit.
>   % compinstall
>   ... All settings are reset to the default.
> 
> A message "Starting a new completion configuration from scratch." will be
> appears for every compinstall execution.
> 
> 
> It seems that there is a small typo in line 128 of
> /usr/share/zsh/functions/Completion/compinstall.
> 
>   [[ -z $newifile || ! -f $newfile ]] && foundold=false
>                            ^^^^^^^
> There is no such variable named $newfile in this file.
> I think it is a typo ("i" is missing) and it should be $newifile.

Thanks.

Index: Completion/compinstall
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/compinstall,v
retrieving revision 1.13
diff -u -r1.13 compinstall
--- Completion/compinstall	8 Jun 2008 17:53:54 -0000	1.13
+++ Completion/compinstall	6 Oct 2008 19:46:14 -0000
@@ -125,7 +125,7 @@
     newifile=$PWD/$newifile
     print "[Not absolute path: updating to $newifile]"
   fi
-  [[ -z $newifile || ! -f $newfile ]] && foundold=false
+  [[ -z $newifile || ! -f $newifile ]] && foundold=false
 else
   print "I haven't found any existing completion definitions.
 If you have some already defined by compinstall, edit the name of the

