Delivered-To: mason-zsh@primenet.com.au
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
Message-Id: <9902011255.AA57575@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH 3.1.5-pws-6 + 5132: Re: patch 5132 breaks pws-6 
In-Reply-To: "Helmut Jarausch"'s message of "Mon, 01 Feb 1999 13:03:30 NFT."
             <jarausch-990201130329.A03694@numa1> 
Date: Mon, 01 Feb 1999 13:55:07 +0100
From: Peter Stephenson <pws@ibmth.df.unipi.it>
X-Mailing-List: <zsh-workers@sunsite.auc.dk> 5152

Helmut Jarausch wrote:
> Hi,
> 
> first patches 5132 and 5133 are hard to apply. What 'patch' is required
> for that.

I think it was just the ChangeLog, which I haven't been keeping up to
date anyway, so I removed those hunks.

> Having applied it (by hand), zsh fails to build.
> 
> In  Src/init.c
> 
> the preprocessor variable UNLINKED_XMOD_zle  gets defined in 
> zshxmods.h
> 
> but is used already in  init.pro, which gets included by zsh.mdh.

This time, I think there's an easy fix:  the definition we want is in
the non-GLOBAL_PROTOTYPES section of init.pro, which isn't used from
zsh.mdh, only when init.pro is directly included.  So the answer is
simply to move down the #include for that.  Luckily this doesn't seem a
problem in other source files.  I think this is a good system, so I'll
put this in pws-7 whenever.

--- Src/init.c.proto	Mon Feb  1 09:42:01 1999
+++ Src/init.c	Mon Feb  1 13:40:57 1999
@@ -28,10 +28,11 @@
  */
 
 #include "zsh.mdh"
-#include "init.pro"
 
 #include "zshpaths.h"
 #include "zshxmods.h"
+
+#include "init.pro"
 
 /**/
 int noexitct = 0;

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

