From zsh-users-return-13087-mason-zsh=primenet.com.au@sunsite.dk Sun Aug 03 17:34:43 2008
Return-Path: <zsh-users-return-13087-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3160 invoked from network); 3 Aug 2008 17:34:41 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 3 Aug 2008 17:34:41 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 51892 invoked from network); 3 Aug 2008 17:33:04 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 3 Aug 2008 17:33:04 -0000
Received: (qmail 29312 invoked by alias); 3 Aug 2008 17:31:51 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13087
Received: (qmail 29295 invoked from network); 3 Aug 2008 17:31:49 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 3 Aug 2008 17:31:49 -0000
Received: from vms044pub.verizon.net (vms044pub.verizon.net [206.46.252.44])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 551C580590E6
	for <zsh-users@sunsite.dk>; Sun,  3 Aug 2008 19:31:31 +0200 (CEST)
Received: from torch.brasslantern.com ([96.238.220.175])
 by vms044.mailsrvcs.net
 (Sun Java System Messaging Server 6.2-6.01 (built Apr  3 2006))
 with ESMTPA id <0K51009BNCO71MN0@vms044.mailsrvcs.net> for
 zsh-users@sunsite.dk; Sun, 03 Aug 2008 12:31:20 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id m73HVHF5026041	for
 <zsh-users@sunsite.dk>; Sun, 03 Aug 2008 10:31:19 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id m73HVHmO026040	for zsh-users@sunsite.dk; Sun,
 03 Aug 2008 10:31:17 -0700
Date: Sun, 03 Aug 2008 10:31:17 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: completion: highlight matching part
In-reply-to: <20080803111423.GA11247@pepin.polanet.pl>
To: zsh-users@sunsite.dk
Message-id: <080803103117.ZM26039@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <20080801163301.GA3589@pepin.polanet.pl>
	<080802143558.ZM815@torch.brasslantern.com>
	<20080803111423.GA11247@pepin.polanet.pl>
Comments: In reply to Tomasz Pala <gotar@polanet.pl>
 "Re: completion: highlight matching part" (Aug  3,  1:14pm)
X-Virus-Scanned: ClamAV 0.92.1/7923/Sun Aug  3 18:22:03 2008 on bifrost
X-Virus-Status: Clean

On Aug 3,  1:14pm, Tomasz Pala wrote:
}
} > you have to use "zstyle -e" to set an evaluated style.
} 
} I've found that
} 
} setopt extendedglob
} 
} is also required for this trick to work.

Shouldn't be (if it were, it wouldn't have worked for me, because I
don't have that set).  The complist module sets/restores extendeglob
internally before interpreting the pattern.

I suspect you've got quoting wrong in the reply= assignment when
setting up your zstyle.  There's also an erroneous ":" and extra "}"
in what you say you ended up with.  I think you need:

highlights='${PREFIX:+=(#bi)($PREFIX:t)(?)*=00=$color[red]=$color[green];$color[bold]}'
zstyle -e ':completion:*' list-colors \
    'reply=( "$highlights" ${(s.:.)LS_COLORS} )'

} First thing was to match ($PREFIX) only - this way we colour the right
} (including when someone types * or any glob) letters in case when
} pattern matches more times.

Good catch; I wondered about that after I sent the mail.  I was thinking
backward about which string was going to be matched against, in that I
thought the pattern might have to account for a directory-name prefix,
which is also why I missed this ...

} > The above doesn't work when completing files in subdirectories
} 
} ($PREFIX:t) copes with that. While '/' is not used within some options
} it doesn't break anything.

... so ($PREFIX:t) is definitely the way to go.

} Then I've used (#i) modifier as if $PREFIX matches, there must be some
} matcher-list involved for case insensitiveness.

Well ... not everyone uses matcher-list or case-insensitiveness in it,
but if you do then this is fine.

} > something is forcing e.g. executable files to be colored bold green,
} > directories red, etc., if there is ANY value at all for list-colors or
} 
} These are default GNU ls colors for standard tags - they're supposed to
} be "obtained by setting the style to an empty string", but it doesn't
} work that way...

The complist module installs some defaults if $LS_COLORS is empty.  The
problem is that the form beginning with an equal or a star is supposed
to take precedence over those defaults, but it does not.  Instead (if
I'm reading the code correctly) it takes precedence only over explicit
settings of all the possible $LS_COLORS colorings.

So it works for you because (1) you have a non-empty $LS_COLORS and
(2) you actually included $LS_COLORS in the list-colors style.  It
fails for me because it finds nothing but the =(#b)... in $ZLS_COLORS
and therefore stuffs in its internal defaults.
 
} At the end I wanted to override * expressions (like *.jpg), but didn't
} succeed. There are problems with disabling and reenabling backreferences:
} 
} ${${(s.:.)LS_COLORS}//#(#b)\*(*)=(*)/'=(#Bbi)($PREFIX:t)(?)*('$match[1]')='$match[2]'=$color[red]=$color[green];$color[bold]=$color[cyan];$color[bold]'}

(This is probably the part where you need extendedglob, for the (#b)
business in the ${...//...} expression.)

You can't use (#B) and (#b) in the same pair of parens like (#Bb).  The
one that comes rightmost will always win.

I'm not entirely clear on why you need to disable the backreferences; why
does is matter?  However, I suspect you think you want this:

 ${${(s.:.)LS_COLORS}//#(#b)\*(*)=(*)/'=(#bi)($PREFIX:t)(?)(#B)*('$match[1]')='$match[2]'=$color[red]=$color[green];$color[bold]=$color[cyan];$color[bold]'}
 

