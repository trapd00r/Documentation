From zsh-users-return-11466-mason-zsh=primenet.com.au@sunsite.dk Mon Apr 30 21:45:11 2007
Return-Path: <zsh-users-return-11466-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26276 invoked from network); 30 Apr 2007 21:45:08 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.8 (2007-02-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,FORGED_RCVD_HELO
	autolearn=ham version=3.1.8
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 30 Apr 2007 21:45:08 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 3943 invoked from network); 30 Apr 2007 21:45:02 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 30 Apr 2007 21:45:02 -0000
Received: (qmail 8102 invoked by alias); 30 Apr 2007 21:44:51 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11466
Received: (qmail 8091 invoked from network); 30 Apr 2007 21:44:50 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 30 Apr 2007 21:44:50 -0000
Received: (qmail 2735 invoked from network); 30 Apr 2007 21:44:50 -0000
Received: from redoubt.spodhuis.org (HELO mx.spodhuis.org) (193.202.115.177)
  by a.mx.sunsite.dk with SMTP; 30 Apr 2007 21:44:43 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws; s=first1; d=spodhuis.org;
	h=Received:Date:From:To:Subject:Message-ID:Mail-Followup-To:References:MIME-Version:Content-Type:Content-Disposition:In-Reply-To;
	b=TxjkAu/0GqFn+uPKr8HtoTGm5SIMlFJua+KAYOHlhMvB/2Ml1BUzcOYn2mX/SbsbI5+Xr/EwrMHcaM1s7Z/HCKIoquz7jg0D6r7Bv7WD5cdCA8pHEatXz0wFIeMs9JeQhKtT7ZbZiFZgLRZN4bUOvzxcFxEY9S1mE/pRRyyuAqU=;
Received: by smtp.spodhuis.org with local 
	id 1Hidfn-000OEf-8C; Mon, 30 Apr 2007 21:44:43 +0000
Date: Mon, 30 Apr 2007 14:44:43 -0700
From: Phil Pennock <zsh-workers+phil.pennock@spodhuis.org>
To: Zsh users list <zsh-users@sunsite.dk>
Subject: Re: Proposal to use patterns in fake-files style
Message-ID: <20070430214443.GC84288@redoubt.spodhuis.org>
Mail-Followup-To: Zsh users list <zsh-users@sunsite.dk>
References: <200704301208.l3UC81Ol017197@news01.csr.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <200704301208.l3UC81Ol017197@news01.csr.com>

On 2007-04-30 at 13:08 +0100, Peter Stephenson wrote:
> The reason I want this is that our Netapp file server has a magic
> ".snapshot" directory within every directory that doesn't appear in the
> listing (except, for some reason, in the home directory).

It's documented; you might want to ask your filer admins if they've put
a copy of the supplied man-pages anywhere convenient, so that you can
add it to your man search-path.

na_snap(1):

       Volume  snapshots are exported to all CIFS or NFS clients.  They can be
       accessed from each directory in the file system. From any directory,  a
       user  can  access the set of snapshots from a hidden sub-directory that
       appears to a CIFS client as ~snapsht and to an NFS client as .snapshot.
       These  hidden  sub-directories are special in that they can be accessed
       from every directory, but they only show up in directory listings at an
       NFS mount point or at the root of CIFS share.

Probably not worth the portability complexity of dealing with
statfs/statvfs/other and looking for something like f_mnttoname to
compare with the canonicalised path ... but might be worth letting
zstyle set a list of directories which are mountpoints to ignore
.snapshot in, default list value (/home) ?

I'm unable to remember what the EMC Celerra NAS heads name their
snapshot directories but I think it was something different, so
.snapshot itself could be a zstyle'd var?

And a search engine check for Sun's ZFS, (zfs NFS snapshot), turned up
<URL:http://www.solarisinternals.com/wiki/index.php/ZFS_Best_Practices_Guide>
which says the special directory is called ".zfs".

In neither case do I know if the entry is ever returned in a readdir().

But the completion stuff still gives me headaches, so I'm not supplying
a patch.  Sorry.

-Phil

