From zsh-workers-request@euclid.skiles.gatech.edu Thu Feb 27 19:23:03 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 13811 invoked from network); 27 Feb 1997 19:23:01 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 27 Feb 1997 19:23:01 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id OAA21241; Thu, 27 Feb 1997 14:16:20 -0500 (EST)
Resent-Date: Thu, 27 Feb 1997 14:15:18 -0500 (EST)
Date: Thu, 27 Feb 1997 14:15:50 -0500 (EST)
Message-Id: <199702271915.OAA09047@catbert.seo.com>
From: "James B. Crigler" <crigler@seo.com>
To: zsh-users@math.gatech.edu
CC: schaefer@nbn.com
In-reply-to: <970227094300.ZM19654@candle.brasslantern.com>
	(schaefer@candle.brasslantern.com)
Subject: Re: problem with GNU Emacs shell mode
Resent-Message-ID: <"yaheP2.0.GB5.5rT5p"@euclid>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/728
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

-----BEGIN PGP SIGNED MESSAGE-----

>>>>> "Bart" == Bart Schaefer <schaefer@candle.brasslantern.com> writes:
>>>>> "Me" = James B. Crigler <crigler@seo.com> writes:

 Bart> Placing a
 Bart>     (setenv "TERM" "emacs")
 Bart> in your ~/.emacs file seems to fix this.

 Me> Neither of these works for me.  I start a shell and get ^M's and
 Me> "echo $TERM" still returns "dumb".  Next idea?

 Bart> If you C-h v process-environment RET in emacs, what is TERM set
 Bart> to?  Maybe you're stomping on the (setenv ...) with a (setq
 Bart> process-environment ...)  or some such, elsewhere?

Nothing, i.e., there is no TERM in process-environment.  (I start
emacs from my .xinitrc so it will be available immediately---well, as
fast as emacs comes up, anyway.)

 Bart> Try this:

 Bart> ;; Don't set TERM=dumb, it bugs zsh.
 Bart> 
 Bart> (require 'comint)
 Bart> (defun comint-exec-1 (name buffer command switches)
 Bart>   (let ((process-environment
 Bart> 	 (nconc
 Bart> 	  (if (and (boundp 'system-uses-terminfo) system-uses-terminfo)
 Bart> 	      (list "EMACS=t" "TERM=emacs"
 Bart> 		    (format "COLUMNS=%d" (frame-width)))
 Bart> 	    (list "EMACS=t" "TERM=emacs"
 Bart> 		  (format "TERMCAP=emacs:co#%d:tc=unknown" (frame-width))))
 Bart> 	  process-environment)))
 Bart>     (apply 'start-process name buffer command switches)))

This also works.  (The previous solution was to add this:

   [[ $TERM = dumb ]] && unsetopt zle

to .zshrc.  Since you (Bart) are a lot more fluent in zsh stuff than I
am, could you comment on the relative merits of the two approaches?

- -- 
Jim Crigler <crigler@seo.com>
Schwartz Electro-Optics, Inc.   Voice:  (407)298-1802 x200
3404 N. Orange Blossom Tr.        Fax:  (407)290-9666
Orlando FL 32804-3498 USA

-----BEGIN PGP SIGNATURE-----
Version: 2.6.2
Comment: Processed by Mailcrypt 3.4, an Emacs/PGP interface

iQCVAwUBMxXdn7UOmtduhAKtAQHdQwQAnvv2N6HDYA4g84INhmzA2O9U4pDHJFN4
jqimfiQv8GrQ/GrSQCQwv68UNSqCaVAds9Rcv0Vx+ax7X2YL4ziCbNeg0T9xmTrE
7tVhW7MAaZ2MDuR9VaLdibUovlSzxTgqc/o/mp+RI6RPcNA2lO1m+zdBZHRdeu7o
/taaOd6zSy8=
=W9YN
-----END PGP SIGNATURE-----

