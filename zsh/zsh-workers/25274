From zsh-workers-return-25274-mason-zsh=primenet.com.au@sunsite.dk Thu Jul 10 19:01:13 2008
Return-Path: <zsh-workers-return-25274-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19162 invoked from network); 10 Jul 2008 19:01:09 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 10 Jul 2008 19:01:09 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 59680 invoked from network); 10 Jul 2008 19:01:03 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 Jul 2008 19:01:02 -0000
Received: (qmail 29446 invoked by alias); 10 Jul 2008 19:00:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25274
Received: (qmail 29433 invoked from network); 10 Jul 2008 19:00:59 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 10 Jul 2008 19:00:59 -0000
Received: from mtaout01-winn.ispmail.ntl.com (mtaout01-winn.ispmail.ntl.com [81.103.221.47])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 3F71B80524FA
	for <zsh-workers@sunsite.dk>; Thu, 10 Jul 2008 21:00:54 +0200 (CEST)
Received: from aamtaout04-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout01-winn.ispmail.ntl.com with ESMTP
          id <20080710190540.QNVY28496.mtaout01-winn.ispmail.ntl.com@aamtaout04-winn.ispmail.ntl.com>
          for <zsh-workers@sunsite.dk>; Thu, 10 Jul 2008 20:05:40 +0100
Received: from pws-pc ([81.107.40.67]) by aamtaout04-winn.ispmail.ntl.com
          with ESMTP
          id <20080710190101.FDSP18637.aamtaout04-winn.ispmail.ntl.com@pws-pc>
          for <zsh-workers@sunsite.dk>; Thu, 10 Jul 2008 20:01:01 +0100
Date: Thu, 10 Jul 2008 20:00:49 +0100
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-workers@sunsite.dk
Subject: Re: Breaking apart link dependencies
Message-ID: <20080710200049.3fde923e@pws-pc>
In-Reply-To: <20080709034817.GA27341@redoubt.spodhuis.org>
References: <20080709034817.GA27341@redoubt.spodhuis.org>
X-Mailer: Claws Mail 3.4.0 (GTK+ 2.12.11; x86_64-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: ClamAV 0.92.1/7686/Thu Jul 10 17:27:03 2008 on bifrost
X-Virus-Status: Clean

On Tue, 8 Jul 2008 20:48:17 -0700
Phil Pennock <zsh-workers+phil.pennock@spodhuis.org> wrote:
> This is the first step to see if there's any linker breakage on other
> platforms.  If it works decently, perhaps a later step is to move the
> ncurses dependency to zle?

Linking pcre statically now fails.  I tried this with --enable-pcre;
however, presumably if this code works turning on --enable-pcre by
default isn't a problem any more since it doesn't create dependencies in
the main shell, unless the test for chained libraries fails.

Presumably in this case the library needs to be thrown in at the point
everything is linked, either in stamp-modobjs or an additional file with
module dependencies.

> Does zsh still support any systems that don't support chained libraries,
> as mentioned by Andrey Borzenkov in post 23347?  Does zsh tend to just
> statically compile on those platforms?  If not, is there a deterministic
> configure.ac test available, or should we just list the platforms as
> exceptions to resetting LIBS and CPPFLAGS by the XXX comment in the
> patch?

An autoconf test ought not to be too hard, I'd have thought.  Use a
standard library that's not part of the C library, create a shared
library using it, load and invoke the shared library.  In fact, creating
a chained library locally, given you're creating one anyway, isn't
difficult and leaves nothing to chance.

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

