From zsh-workers-return-7058-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Jul 09 08:35:55 1999
Return-Path: <zsh-workers-return-7058-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17503 invoked from network); 9 Jul 1999 08:35:53 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 9 Jul 1999 08:35:53 -0000
Received: (qmail 3711 invoked by alias); 9 Jul 1999 08:35:38 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7058
Received: (qmail 3704 invoked from network); 9 Jul 1999 08:35:37 -0000
Date: Fri, 9 Jul 1999 10:35:35 +0200 (MET DST)
Message-Id: <199907090835.KAA13170@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Sven Wischnowsky's message of Thu, 8 Jul 1999 11:11:05 +0200 (MET
	DST)
Subject: Re: PATCH: tricky.c and i-c-w


I wrote:

> I fear that there are even more problems here: if we are in a
> menu-completion and someone changes the command line directly, calling 
> the completion code again may have all kinds of nasty effects. At
> least I think so, haven't tried it yet, but I will look into it.

Yes, we have to break menu-completion when someone sets [LR]BUFFER,
otherwise the command-line positions stored get invalid.

Bye
 Sven

diff -u oos/Zle/zle_params.c Src/Zle/zle_params.c
--- oos/Zle/zle_params.c	Thu Jul  8 11:11:37 1999
+++ Src/Zle/zle_params.c	Fri Jul  9 10:29:59 1999
@@ -137,6 +137,8 @@
 	    cs = ll;
     } else
 	cs = ll = 0;
+    fixsuffix();
+    menucmp = 0;
 }
 
 /**/
@@ -156,6 +158,8 @@
 	cs = ll;
     else
 	cs = x;
+    fixsuffix();
+    menucmp = 0;
 }
 
 /**/
@@ -182,6 +186,8 @@
     ll = ll - cs + len;
     cs = len;
     zsfree(x);
+    fixsuffix();
+    menucmp = 0;
 }
 
 /**/
@@ -205,6 +211,8 @@
     sizeline(ll = cs + len);
     memcpy(line + cs, y, len);
     zsfree(x);
+    fixsuffix();
+    menucmp = 0;
 }
 
 /**/

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

