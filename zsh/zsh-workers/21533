From zsh-workers-return-21533-mason-zsh=primenet.com.au@sunsite.dk Tue Jul 26 22:23:19 2005
Return-Path: <zsh-workers-return-21533-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21743 invoked from network); 26 Jul 2005 22:23:16 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 26 Jul 2005 22:23:16 -0000
Received: (qmail 79698 invoked from network); 26 Jul 2005 22:23:10 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 26 Jul 2005 22:23:10 -0000
Received: (qmail 22918 invoked by alias); 26 Jul 2005 22:23:08 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21533
Received: (qmail 22908 invoked from network); 26 Jul 2005 22:23:07 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 26 Jul 2005 22:23:07 -0000
Received: (qmail 79376 invoked from network); 26 Jul 2005 22:23:07 -0000
Received: from smtprelay04.ispgateway.de (80.67.18.16)
  by a.mx.sunsite.dk with SMTP; 26 Jul 2005 22:23:01 -0000
Received: (qmail 13548 invoked from network); 26 Jul 2005 22:23:01 -0000
Received: from unknown (HELO raffi.reidel.info) (793055@[62.245.208.228])
          (envelope-sender <mark@reidel.info>)
          by smtprelay04.ispgateway.de (qmail-ldap-1.03) with SMTP
          for <zsh-workers@sunsite.dk>; 26 Jul 2005 22:23:01 -0000
Received: (qmail 4077 invoked by uid 0); 26 Jul 2005 22:23:02 -0000
Received: from unknown (HELO ?192.168.42.12?) (192.168.42.12)
  by karm.dyndns.org with SMTP; 26 Jul 2005 22:23:02 -0000
Message-ID: <42E6D3E6.5070206@reidel.info>
Date: Wed, 27 Jul 2005 00:23:02 +0000
From: Mark Daniel Reidel <mark@reidel.info>
User-Agent: Mozilla Thunderbird 1.0.6 (X11/20050725)
X-Accept-Language: en-us, en
MIME-Version: 1.0
To:  zsh-workers@sunsite.dk
Subject: Pause when quitting under FreeBSD
X-Enigmail-Version: 0.92.0.0
Content-Type: text/plain; charset=ISO-8859-15
Content-Transfer-Encoding: 7bit
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham 
	version=3.0.4

Hi there!

I'm not 100% sure if this is the right place to post this problem, but
ever since I switched to a 64bit OS and installed my shell of choice,
quitting zsh suddenly takes about 2 or 3 seconds.
Since my configuration comes from an NFS-server, I can be 100% sure that
it's the same unter FreeBSD 5.4 and 6 (which is the one that seems to
have problems).
I already tried a ktrace to maybe find the bugger, but the
time-consumption seems to be during some breaks. Here's the important parts:

[...]
   744 zsh      Events dropped.
   744 zsh      1122421279.260961 RET   open 3
   744 zsh      Events dropped.
   744 zsh      1122421279.271187 RET   close 0
   744 zsh      1122421280.524404 CALL  break(0x876c20)
   744 zsh      1122421280.524420 RET   break 0
   744 zsh      1122421280.563815 CALL  break(0x871c20)
[...]
   744 zsh      1122421281.009755 CALL  break(0x835c20)
   744 zsh      1122421281.009771 RET   break 0
   744 zsh      1122421281.548473 CALL  break(0x7d4c20)
   744 zsh      1122421281.548534 RET   break 0
   744 zsh      1122421281.548602 CALL  unlink(0x7b6960)
   744 zsh      1122421281.548606 NAMI  "/home/mark/.zsh_history.LOCK"
   744 zsh      1122421281.553918 RET   unlink 0
[...]

As you can see, it takes about 2.3s doing breaks and this is *really*
annoying if you fire up some terminals and want to close them wich
ctrl+d, because the terminal just sits there and twiddles thumbs :-/

Is there anything I could maybe do to help get rid of this? I already
tried not to do a setopt APPEND_HISTORY or SHARE_HISTORY, but it seems
to be totally unrelated. Also NFS doesn't seem to be the bugger, because
the problem exists for root, too and /root is of course not on an NFS-mount.

Hope anyone can help me or at least provide some debugging hints

	- Mark
-- 
Fortune cookie of the hour:
Be free and open and breezy!  Enjoy!  Things won't get any better so
get used to it.

