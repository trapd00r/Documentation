From zsh-workers-return-10243-mason-zsh=primenet.com.au@sunsite.auc.dk Sat Mar 25 16:46:29 2000
Return-Path: <zsh-workers-return-10243-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10488 invoked from network); 25 Mar 2000 16:46:28 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 25 Mar 2000 16:46:28 -0000
Received: (qmail 13464 invoked by alias); 25 Mar 2000 16:46:21 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10243
Received: (qmail 13445 invoked from network); 25 Mar 2000 16:46:19 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000325164607.ZM25889@candle.brasslantern.com>
Date: Sat, 25 Mar 2000 16:46:07 +0000
In-Reply-To: <rsq7ler96h0.fsf@crane.jaist.ac.jp>
Comments: In reply to Tanaka Akira <akr@jaist.ac.jp>
        "Re: zsh-3.1.6-dev-20" (Mar 25, 10:35am)
References: <E12Yc4C-0002qM-00.2000-03-24-21-56-29@cmailg3.svr.pol.co.uk> 
	<rsq7ler96h0.fsf@crane.jaist.ac.jp>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Tanaka Akira <akr@jaist.ac.jp>,
        zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: Re: zsh-3.1.6-dev-20
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Mar 25, 10:35am, Tanaka Akira wrote:
} Subject: Re: zsh-3.1.6-dev-20
}
} In article <E12Yc4C-0002qM-00.2000-03-24-21-56-29@cmailg3.svr.pol.co.uk>,
}   Peter Stephenson <pws@pwstephenson.fsnet.co.uk> writes:
} 
} > I have uploaded
} >   ftp://ftp.zsh.org/zsh/development/zsh-3.1.6-dev-20.tar.gz
} 
} * 10233 is not applied.

That's because 10230 and 10231 are not applied either.  Will 10233 work
without those others?

} * Src/text.c is different to my version.  Where is the change come from?

They came (or rather, did NOT come) from 10179, which was not applied.

} * 9988 is applied (by hand because it's encoded by quoted-printable?)
}   but it has a problem.

Below is what I have (diffed against -dev-20).  There's an extra hunk in
there that converts leading spaces to tabs in some of the indentation;
I don't know if that's a mailing artifact or an emacs-editing artifact
on my part.

It also appears that 9897 and 10089 were not properly merged into _groups.

Index: Completion/User/_groups
===================================================================
@@ -6,7 +6,8 @@
 
 if ! zstyle -a ":completion:${curcontext}:" groups groups; then
   (( $+_cache_groups )) ||
-      if (( ${+commands[ypcat]} )) && tmp=$(ypcat group.byname); then
+      if (( ${+commands[ypcat]} )) &&
+	  tmp=$(_call groups ypcat group.byname); then
         : ${(A)_cache_groups:=${${(f)tmp}%%:*}} # If you use YP
       else
         : ${(A)_cache_groups:=${${(s: :)$(</etc/group)}%%:*}}

Index: Src/Modules/zpty.c
===================================================================
@@ -165,7 +165,7 @@
 
 #else /* ! __osf__ */
 
-#if __SVR4
+#if defined(__SVR4) || defined(sinix)
 
 #include <sys/stropts.h>
 
@@ -174,11 +174,12 @@
 {
     int mfd, sfd;
     char *name;
+    int ret;
 
     if ((mfd = open("/dev/ptmx", O_RDWR)) < 0)
 	return 1;
 
-    if (!(name = ptsname(mfd)) || grantpt(mfd) || unlockpt(mfd)) {
+    if (grantpt(mfd) || unlockpt(mfd) || !(name = ptsname(mfd))) {
 	close(mfd);
 	return 1;
     }
@@ -186,31 +187,31 @@
 	close(mfd);
 	return 1;
     }
-   if ((ret = ioctl(sfd, I_FIND, "ptem")) != 1)
-      if (ret == -1 || ioctl(sfd, I_PUSH, "ptem") == -1) {
-          close(mfd);
-          close(sfd);
-          return 1;
-      }
-   if ((ret = ioctl(sfd, I_FIND, "ldterm")) != 1)
-      if (ret == -1 || ioctl(sfd, I_PUSH, "ldterm") == -1) {
-          close(mfd);
-          close(sfd);
-          return 1;
-      }
-   if ((ret = ioctl(sfd, I_FIND, "ttcompat")) != 1)
-      if (ret == -1 || ioctl(sfd, I_PUSH, "ttcompat") == -1) {
-          close(mfd);
-          close(sfd);
-          return 1;
-      }
+    if ((ret = ioctl(sfd, I_FIND, "ptem")) != 1)
+       if (ret == -1 || ioctl(sfd, I_PUSH, "ptem") == -1) {
+	   close(mfd);
+	   close(sfd);
+	   return 1;
+       }
+    if ((ret = ioctl(sfd, I_FIND, "ldterm")) != 1)
+       if (ret == -1 || ioctl(sfd, I_PUSH, "ldterm") == -1) {
+	   close(mfd);
+	   close(sfd);
+	   return 1;
+       }
+    if ((ret = ioctl(sfd, I_FIND, "ttcompat")) != 1)
+       if (ret == -1 || ioctl(sfd, I_PUSH, "ttcompat") == -1) {
+	   close(mfd);
+	   close(sfd);
+	   return 1;
+       }
     *master = mfd;
     *slave = sfd;
 
     return 0;
 }
 
-#else /* ! (defined(__SVR4) || defined(sinix)) */
+#else /* ! (defined(__SVR4) || defind(sinix)) */
 
 static int
 get_pty(int *master, int *slave)



-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

