From zsh-users-return-13477-mason-zsh=primenet.com.au@sunsite.dk Sun Nov 23 18:16:06 2008
Return-Path: <zsh-users-return-13477-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27189 invoked from network); 23 Nov 2008 18:16:02 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 Nov 2008 18:16:02 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 13650 invoked from network); 23 Nov 2008 18:15:51 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 Nov 2008 18:15:51 -0000
Received: (qmail 26646 invoked by alias); 23 Nov 2008 18:15:34 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13477
Received: (qmail 26630 invoked from network); 23 Nov 2008 18:15:33 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 23 Nov 2008 18:15:33 -0000
Received: from vms173007pub.verizon.net (vms173007pub.verizon.net [206.46.173.7])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 572E580525B4
	for <zsh-users@sunsite.dk>; Sun, 23 Nov 2008 19:15:29 +0100 (CET)
Received: from torch.brasslantern.com ([96.238.220.215])
 by vms173007.mailsrvcs.net
 (Sun Java System Messaging Server 6.2-6.01 (built Apr  3 2006))
 with ESMTPA id <0KAS00FCATBX2NA1@vms173007.mailsrvcs.net> for
 zsh-users@sunsite.dk; Sun, 23 Nov 2008 12:14:22 -0600 (CST)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id mANIFM37025127; Sun,
 23 Nov 2008 10:15:23 -0800
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id mANIFMUD025126; Sun, 23 Nov 2008 10:15:22 -0800
Date: Sun, 23 Nov 2008 10:15:22 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: auto-completion with exact match
In-reply-to: <5992e17f0811230424vb7dc2ccle366e37152b48800@mail.gmail.com>
To: "Kazuo Teramoto" <kaz.rag@gmail.com>
Cc: zsh-users@sunsite.dk
Message-id: <081123101522.ZM25125@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <1227383717.16125.16.camel@zoe>
	<081122123957.ZM32606@torch.brasslantern.com>	<1227386675.16125.18.camel@zoe>
	<5992e17f0811221553xbc4392boa71ca9fc30d052ce@mail.gmail.com>
	<081122205238.ZM559@torch.brasslantern.com>
	<5992e17f0811230424vb7dc2ccle366e37152b48800@mail.gmail.com>
Comments: In reply to "Kazuo Teramoto" <kaz.rag@gmail.com>
 "Re: auto-completion with exact match" (Nov 23, 10:24am)
X-Virus-Scanned: ClamAV 0.92.1/8666/Sun Nov 23 11:41:19 2008 on bifrost
X-Virus-Status: Clean

On Nov 23, 10:24am, Kazuo Teramoto wrote:
}
} > % ln <ctrl-x>h
} Produce a list of options to complete like ls. With and without a
} start arg (e.g. with 'ln win' I get a list 'wine winet' and can cycle
} between the options)

No, you misunderstand.  I mean really do type a control-x and an h.
You should see something like this:

% ln
tags in context :completion::complete:ln::
    globbed-files  (_files _default (eval))
% rm
tags in context :completion::complete:rm::
    argument-rest options  (_arguments _rm (eval))

I just realized that when I looked at this before, I was using an
older version of zsh.  There now is a completion function _rm, and
I'm able to reproduce the behavior you described.  This function
was introduced at the beginning of October of this year.

The fix seems to be to change the direct call to _path_files in _rm
to instead call _files and let it manage looping on _path_files.

--- ../zsh-forge/current/Completion/Unix/Command/_rm    2008-10-08
04:37:34.000000000 -0700
+++ Completion/Unix/Command/_rm 2008-11-23 10:03:34.000000000 -0800
@@ -34,7 +34,7 @@
   (file)
     declare -a ignored
     ignored=(${line//(#m)[\[\]()\\*?#<>~\^]/\\$MATCH})
-    _path_files -F ignored && ret=0
+    _files -F ignored && ret=0
     ;;
 esac
 

