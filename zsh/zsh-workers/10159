From zsh-workers-return-10159-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Mar 17 08:11:24 2000
Return-Path: <zsh-workers-return-10159-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12987 invoked from network); 17 Mar 2000 08:11:23 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Mar 2000 08:11:23 -0000
Received: (qmail 19327 invoked by alias); 17 Mar 2000 08:11:11 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10159
Received: (qmail 19317 invoked from network); 17 Mar 2000 08:11:10 -0000
Date: Fri, 17 Mar 2000 09:11:07 +0100 (MET)
Message-Id: <200003170811.JAA01624@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Bart Schaefer"'s message of Thu, 16 Mar 2000 16:10:26 +0000
Subject: PATCH: Re: setopt list_types misaligns columns


Bart Schaefer wrote:

> Fragments of a long completion listing, with list_types set:
> 
> MakeTeXPK         makeinfo          mkdir             mogrify
> Misc/              makemap           mkdirhier         montage
> Muttrc            makempx           mke2fs            more
> mail              md5sum            mkinitrd          msgcmp
> mail-files        megatron          mkinstalldirs*     msgcomm
> mail.rc           merge             mklost+found      msgfmt
> 
> This does NOT happen if the complist module is loaded, whether or not
> colors are enabled.

Wrong length calculation. A rather stupid bug.

Bye
 Sven

diff -ru ../z.old/Src/Zle/compresult.c Src/Zle/compresult.c
--- ../z.old/Src/Zle/compresult.c	Thu Mar 16 10:06:43 2000
+++ Src/Zle/compresult.c	Fri Mar 17 09:09:03 2000
@@ -1799,9 +1799,8 @@
 	nicezputs(m->str, shout);
 	len = niceztrlen(m->str);
 
-	if (isset(LISTTYPES)) {
-	    if (buf)
-		putc(file_type(buf->st_mode), shout);
+	if (isset(LISTTYPES) && buf) {
+	    putc(file_type(buf->st_mode), shout);
 	    len++;
 	}
     }

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

