From zsh-users-return-13548-mason-zsh=primenet.com.au@sunsite.dk Tue Dec 09 11:45:09 2008
Return-Path: <zsh-users-return-13548-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22691 invoked from network); 9 Dec 2008 11:45:05 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.3 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 9 Dec 2008 11:45:05 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 22399 invoked from network); 9 Dec 2008 11:44:55 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 Dec 2008 11:44:55 -0000
Received: (qmail 5577 invoked by alias); 9 Dec 2008 11:44:39 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13548
Received: (qmail 5565 invoked from network); 9 Dec 2008 11:44:39 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 9 Dec 2008 11:44:39 -0000
Received: from cluster-d.mailcontrol.com (cluster-d.mailcontrol.com [85.115.60.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 7346E80308BE
	for <zsh-users@sunsite.dk>; Tue,  9 Dec 2008 12:44:35 +0100 (CET)
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly02d.srv.mailcontrol.com (MailControl) with ESMTP id mB9Bhvpx000767
	for <zsh-users@sunsite.dk>; Tue, 9 Dec 2008 11:44:27 GMT
Received: from news01 ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Tue, 9 Dec 2008 11:44:23 +0000
Date: Tue, 9 Dec 2008 11:44:23 +0000
From: Peter Stephenson <pws@csr.com>
To: "Zsh users list" <zsh-users@sunsite.dk>
Subject: Re: Is this correct? Redirecting stdin/stout to implement a
 gdb-like "set inferior tty" in zshdb
Message-ID: <20081209114423.1382b8e5@news01>
In-Reply-To: <6cd6de210812090327o11abb9f3w2cc932515e4dbef8@mail.gmail.com>
References: <6cd6de210812090327o11abb9f3w2cc932515e4dbef8@mail.gmail.com>
Organization: CSR
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.8; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 09 Dec 2008 11:44:23.0623 (UTC) FILETIME=[7B3C1570:01C959F3]
X-Scanned-By: MailControl A_08_51_00 (www.mailcontrol.com) on 10.68.0.112
X-Virus-Scanned: ClamAV 0.92.1/8735/Tue Dec  9 09:53:21 2008 on bifrost
X-Virus-Status: Clean

On Tue, 9 Dec 2008 06:27:48 -0500
"Rocky Bernstein" <rocky.bernstein@gmail.com> wrote:
> Recently I needed to debug a GNU autoconf configure script which seems to do
> funky things with stdin and stdout. I realized that the shell debuggers
> really should have the equivalent of gdb's "set inferior tty" (
> http://www.mcs.vuw.ac.nz/cgi-bin/info2www?(gdb)Input/Output)
> 
> Something along the lines of the below is what I came up with. But is this
> correct? $1 of course supposed to be the tty like say /dev/pts/1 on a
> GNU/Linuxy box.  When I tried it with the tty of another terminal, I'm
> getting output to the terminal but not input. I'm not sure it even makes
> sense to try to mug the input from another terminal or whether two processes
> (not even parent related) can read from the same input.
> 
> #!/usr/local/bin/zsh
> typeset line
> exec 7<&0 </dev/null 6>&1  # Line taken from an autoconf "configure" script.
> #...
> exec {_Dbg_fdi} <> $1
> while : ; do
>   vared -e -h -p "foo> " line <&${_Dbg_fdi} || break
>   builtin print -- "$line" >&${_Dbg_fdi}
>   line=''
> done
> echo "That's all folks! (${_Dbg_fdi})"
> 
> Does zsh have <> like ksh does? It wasn't rejected, so I assume it does.

That should indeed make the shell do what you expect, but I'm not clear
what you're supposed to be able to do with another terminal either, so it
doesn't entirely surprise me if it doesn't work.  It seem to work run as a
script running on /dev/tty (which as far as the non-interactive shell
running the script is concerned is just another file, no different from any
other terminal---the difference is down in the OS).

The only oddity was I didn't get history (the -h option to vared seemed to
do nothing), but I've forgotten whether I'm supposed to or not in this
case...

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

