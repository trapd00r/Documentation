From zsh-workers-request@euclid.skiles.gatech.edu Mon Jun 02 21:10:53 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 26425 invoked from network); 2 Jun 1997 21:10:52 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 2 Jun 1997 21:10:52 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id RAA03925; Mon, 2 Jun 1997 17:00:28 -0400 (EDT)
Resent-Date: Mon, 2 Jun 1997 16:59:44 -0400 (EDT)
From: <hzoli@VNET.IBM.COM> (Zoltan T. Hidvegi)
Message-Id: <9706022103.AA16754@belgium.fishkill.ibm.com>
Subject: Re: using /etc/zshenv for access control
In-Reply-To: <Pine.SUN.3.96.970602122642.23803A-100000@kira> from Timothy Luoma at "Jun 2, 97 12:40:11 pm"
To: luomat@peak.org
Date: Mon, 2 Jun 1997 17:03:12 -0400 (EDT)
Cc: zsh-users@math.gatech.edu
X-Mailer: ELM [version 2.4ME+ PL31H (25)]
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"W0wHY.0.Xx._Gpap"@euclid>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/878
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Timothy Luoma wrote:
[...]

I havn't really looked at the scripts but here are some ideas:

> 1) what 'trap' comments do I need in
>       a) /etc/zshenv

Unfortunately even if the first statement in /etc/zshenv is a trap
statement a user still have a chance to hit ^C or ^\ before that trap
statement executes.  If the shell is setuid or restricted it quits on ^C
but normally the user just gets an interactive shell.  A restricted shell
is still in non-restricted mode while it is executing startup scripts but
it drops into restricted mode as soon as the startup scripts are finished.
I'll try to modify zsh so that an explicit unsetopt restricted in the
startup scripts can be used to prevent this fallback.  This way a
restricted login shell can be installed for the users which is protected
against signals, and the startup script can decide what shell the user
gets.  Of course all this is for zsh-3.1 and this new restricted stuff will
probably go only into zsh-3.1.3 as I'd like to release 3.1.2 tonight as
soon as this job control bug Peter has just reported is fixed (which is
probably related to the SIGPIPE handling).

> 3) right now this doesn't work at all because PNAME in /etc/zshenv still
> thinks it is being called from telnetd or rlogind... should I use this in
> the /bin/sh script instead?

The PNAME is generated is a very complicated way in your script.  Why don't
you use the $PPID zsh special parameter?

Zoltan

