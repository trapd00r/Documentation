From zsh-workers-return-6063-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Apr 20 15:58:49 1999
Return-Path: <zsh-workers-return-6063-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7018 invoked from network); 20 Apr 1999 15:58:48 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 20 Apr 1999 15:58:48 -0000
Received: (qmail 21283 invoked by alias); 20 Apr 1999 15:58:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6063
Received: (qmail 21258 invoked from network); 20 Apr 1999 15:58:35 -0000
Message-Id: <9904201534.AA45662@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk
Subject: Re: compstate[old_list] 
In-Reply-To: "Sven Wischnowsky"'s message of "Tue, 20 Apr 1999 16:17:30 DFT."
             <199904201417.QAA23159@beta.informatik.hu-berlin.de> 
Date: Tue, 20 Apr 1999 17:34:15 +0200
From: Peter Stephenson <pws@ibmth.df.unipi.it>

Sven Wischnowsky wrote:
> Hm. maybe if we move the test I removed zle_main.c to this place...
> 
> Could you play with it and tell me if this is better?

So far, it's fine.  Normal menu-completion behaviour is OK, _main_complete
gets called when I expect it to, and I can engineer the `TAB continues
ad-hoc menu-completion'-type behaviour by adding

if [[ -n $compstate[old_insert] && $WIDGET = *complete(|-prefix) &&
  -n $compconfig[old_menu] ]]; then
  compstate[old_list]=keep
  if [[ $WIDGET = *reverse* ]]; then
    compstate[insert]=$(( compstate[old_insert] - 1 ))
  else
    compstate[insert]=$(( compstate[old_insert] + 1 ))
  fi
  return
fi

to _main_complete.

I'll put it in and see what happens.  Maybe I'll make a $compconfig
patch for some of these things, once I work out what they are.  Or is that
causing the danger of code bloat?

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

