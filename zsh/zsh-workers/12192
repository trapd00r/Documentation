From zsh-workers-return-12192-mason-zsh=primenet.com.au@sunsite.auc.dk Sat Jul 08 08:38:00 2000
Return-Path: <zsh-workers-return-12192-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2114 invoked from network); 8 Jul 2000 08:38:00 -0000
Received: from ns2.primenet.com.au (HELO primenet.com.au) (?5i3BFqICjSFXW6tu4T0mFT1TkGhW78QS?@203.24.36.3)
  by ns1.primenet.com.au with SMTP; 8 Jul 2000 08:38:00 -0000
Received: (qmail 1310 invoked from network); 7 Jul 2000 16:37:57 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns2.primenet.com.au with SMTP; 7 Jul 2000 16:37:57 -0000
Received: (qmail 29263 invoked by alias); 7 Jul 2000 16:37:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12192
Received: (qmail 29256 invoked from network); 7 Jul 2000 16:37:49 -0000
X-Authentication-Warning: cassini.us.mandrakesoft.com: chmou set sender to chmouel@mandrakesoft.com using -f
To: zsh-workers@sunsite.auc.dk
Subject: Re: adding a toplevel zsh.spec.in file
References: <20000707125317.A1626@thelonious.new.ox.ac.uk>
From: Chmouel Boudjnah <chmouel@mandrakesoft.com>
Date: 07 Jul 2000 09:15:12 -0700
In-Reply-To: Adam Spiers's message of "Fri, 7 Jul 2000 12:53:17 +0100"
Message-ID: <m2hfa1lxwv.fsf@cassini.us.mandrakesoft.com>
Lines: 42
User-Agent: Gnus/5.0807 (Gnus v5.8.7) Emacs/20.6
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

Adam Spiers <adam@spiers.net> writes:

> Hi all,
> 
> I would like to add a zsh.spec.in file to the toplevel directory so
> that any tarball releases or CVS snapshots can immediately be built
> into RPMs with
> 
>   $ rpm -ta zsh-3.1.x-dev-y.tar.gz
> 
> Are there any objections to this?  If not there are a few issues to
> clear up:

Be careful you'll have by the way need to fight with the
RPM_BUILD_ROOT in the %install :

--- zsh-3.1.9/Src/zsh.mdd.chmou Tue Jul  4 10:06:32 2000
+++ zsh-3.1.9/Src/zsh.mdd       Tue Jul  4 10:54:11 2000
@@ -53,8 +53,10 @@
            rm -f zshpaths.h.tmp; \
            echo "\`zshpaths.h' is up to date." ; \
        else \
+           if [ ! -f .in_rpm_install ]; then \
            mv -f zshpaths.h.tmp zshpaths.h; \
            echo "Updated \`zshpaths.h'." ; \
+           fi; \
        fi
 
 bltinmods.list: modules.stamp modules-bltin xmods.conf mkbltnmlst.sh

and this in %install :

# Zsh hardcode the prefix in binary even at install.
pushd Src/ && {
    touch .in_rpm_install
    %makeinstall
} && popd

(%makinstall is new macros of rpm-3.0.5 combined with %configure)
-- 
MandrakeSoft Inc                http://www.mandrakesoft.com
San-Francisco, CA USA                             --Chmouel

