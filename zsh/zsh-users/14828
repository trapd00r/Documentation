From zsh-users-return-14828-mason-zsh=primenet.com.au@zsh.org Fri Feb 12 15:22:26 2010
Return-Path: <zsh-users-return-14828-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8550 invoked by alias); 12 Feb 2010 15:22:26 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14828
Received: (qmail 18496 invoked from network); 12 Feb 2010 15:22:16 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at seiken.de does not designate permitted sender hosts)
From: Joke de Buhr <joke@seiken.de>
Organization: http://www.seiken.de/
To: zsh-users@zsh.org
Subject: Re: How zcompile work?
Date: Fri, 12 Feb 2010 16:04:02 +0100
User-Agent: KMail/1.12.2 (Linux/2.6.31-19-generic; KDE/4.3.2; x86_64; ; )
References: <6910cba01002120551i23ce6224t48e09f9b04a30689@mail.gmail.com>
In-Reply-To: <6910cba01002120551i23ce6224t48e09f9b04a30689@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/signed;
  boundary="nextPart70336677.on6oEAOsd1";
  protocol="application/pgp-signature";
  micalg=pgp-sha1
Content-Transfer-Encoding: 7bit
Message-Id: <201002121604.07838.joke@seiken.de>

--nextPart70336677.on6oEAOsd1
Content-Type: Text/Plain;
  charset="utf-8"
Content-Transfer-Encoding: quoted-printable

You can trace the system calls using strace.

  strace zsh >/dev/null | grep zshrc

Look out for the "open" and "stat" system calls. If zsh uses the compiled .=
zwc=20
it will look like this:

  stat("/home/joke/.zshrc.zwc", {st_mode=3DS_IFREG|0444, st_size=3D9624, ..=
=2E}) =3D 0
  stat("/home/joke/.zshrc", {st_mode=3DS_IFREG|0640, st_size=3D3477, ...}) =
=3D 0
  open("/home/joke/.zshrc.zwc", O_RDONLY) =3D 3

zsh uses "stat" to check the modification time of .zshrc and .zshrc.zwc and=
=20
decides to open .zshrc.zwc.


If the .zshrc is more recent then .zshwc zsh opens the .zshrc file:

  stat("/home/joke/.zshrc.zwc", {st_mode=3DS_IFREG|0444, st_size=3D9624, ..=
=2E}) =3D 0
  stat("/home/joke/.zshrc", {st_mode=3DS_IFREG|0640, st_size=3D3477, ...}) =
=3D 0
  open("/home/joke/.zshrc", O_RDONLY|O_NOCTTY) =3D 3


On Friday 12 February 2010 14:51:49 Piotr Karbowski wrote:
> Hi there!
>=20
> I am trying to understand how zcompile work. When I do zcompile .zshrc
> it making .zshrc.zwc  (3x bigger than .zshrc). How can I check if zsh
> really using compiled zshrc? And, when I changing zshrc but dont
> recompile .zwc, how it detect that zwc is outdatted? Sorry if I asking
> about something documented but I didnt found anything useful about it
> on google.
>=20

--nextPart70336677.on6oEAOsd1
Content-Type: application/pgp-signature; name=signature.asc 
Content-Description: This is a digitally signed message part.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)

iQIcBAABCgAGBQJLdW3iAAoJEMcNQWzYfbLsIJcQAI6vmOAIUBy8Y8VTsyVcN7xN
WZe1RCu0IJkuCFOpId2MM8EICQIihm9ep7RTvjzO9cEMmXSxj4V2X9C2lx1+fkRs
A4yrTOjnTQ7LjeWRDC2RaqPCECSQdrjLDwF+5gzcijMYHpSEEvGEfCK/eiaqafJ3
x9jh2VueOy5WGymyyIzHgvyWJaZy3SlCV+fF4JBINwp5NSF4BQ9OIuxISo2u46OG
OB1Ol50vY36fs7HHbMNEQFMQyHBvuFNhVmyYkwcWtjVqjOxdLMe4PuKH/hhux8Ae
hxoJN3AEgsaetbklD2cP/Oeelv5xs6azvVV6R5TxE+KTPkX9v5oNjUObkjGgTeep
H3hwOGDs37LDy4WElBjkhI1OzAYYVc6ESqOdT4I/GhppPyZViUB3twzpqNwK+4Je
2xrdsgMFB+s/c2LsXG3RwxwmxM/LGvn0Ayuyais+GXv57XxcmdxwwJNeHARzJk96
epabtmag/2vNvVKV0o0db5Vws2g2xfK6U840khAiJFfbij6N7fTjeXS/0POHa9a6
kf3v/WlrzRO0yyKu9OYFNaBHx/5ZqvQRf4vKN7Ey6x9ESHr4QbOMu8WzIi1BA1OJ
yJFDHh9xu8+Topj2lMPnjdqS614Ytz9UOk8I0sNyqti/ceBXSNvCy8+n/VJFmxWy
DAIgpLVc5xemjoMREJDz
=ksHJ
-----END PGP SIGNATURE-----

--nextPart70336677.on6oEAOsd1--

