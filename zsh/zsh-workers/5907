From zsh-workers-return-5907-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Mar 23 16:14:02 1999
Return-Path: <zsh-workers-return-5907-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21826 invoked from network); 23 Mar 1999 16:14:01 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 23 Mar 1999 16:14:01 -0000
Received: (qmail 7540 invoked by alias); 23 Mar 1999 16:13:41 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5907
Received: (qmail 7521 invoked from network); 23 Mar 1999 16:13:40 -0000
From: "Andrej Borsenkow" <borsenkow.msk@sni.de>
To: "Peter Stephenson" <pws@ibmth.df.unipi.it>,
        "Zsh hackers list" <zsh-workers@sunsite.auc.dk>
Subject: RE: Another slight weirdness
Date: Tue, 23 Mar 1999 19:12:44 +0300
Message-ID: <000b01be7547$fc4264d0$21c9ca95@mowp.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="koi8-r"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2910.0)
In-reply-to: <9903231527.AA34098@ibmth.df.unipi.it>
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2014.211
Importance: Normal

>
> By the way, I never liked the way _setopt and _unsetopt reflected the
> current state of the options, since usually I can't remember
> what's set and
> the fact I don't get offered all possibilities just confuses me.  The fact
> you now have to two $(...) calls on every single completion just to store
> the current values --- this does not seem to be the sort of thing
> completion should be doing by default --- makes me think even
> more strongly
> that this is just not worth it for the basic set-up and anyone
> sophisticated enough should add it themselves.

Anything more sophisticated will end up with just the same problem. O.K.,
what we have now:

 - top level shell has some options set
 - f1 is called - now we have global options and local f1 options
 - f2 is called from f1 - do we have three or two option sets now? That is,
if f1 has localoptions and changed some - will options upon exit from f2 be
restored to f1-local set or to global-set?

The latter smells like a bug. And if it is the former, that we have the
single global options set - and only need a way to acces it. And I really
suggest assoc array for that. That will make any work with options quite
easy (and actually un/setopt could be reduced to functions that simply set
array values :-)

Just tested - the options are restored to local f1 array. So, looks like it
is quite doable. And again, it will probably be quite useful outside of
completion as well.

cheers

/andrej

