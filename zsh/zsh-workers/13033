From zsh-workers-return-13033-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Oct 19 03:32:45 2000
Return-Path: <zsh-workers-return-13033-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5093 invoked from network); 19 Oct 2000 03:32:44 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 19 Oct 2000 03:32:44 -0000
Received: (qmail 7658 invoked by alias); 19 Oct 2000 03:32:38 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 13033
Received: (qmail 7645 invoked from network); 19 Oct 2000 03:32:38 -0000
Message-ID: <14830.27472.293944.627458@phl.itasoftware.com>
Date: Wed, 18 Oct 2000 23:32:32 -0400 (EDT)
From: greg@klanderman.net (Greg Klanderman)
To: zsh-workers@sunsite.auc.dk (Zsh list)
Subject: small history bugs in zsh 3.1.9
Reply-To: greg@klanderman.net
X-Mailer: VM 6.62 under 21.1 (patch 9) "Canyonlands" XEmacs Lucid
Mime-Version: 1.0 (generated by tm-edit 7.108)
Content-Type: text/plain; charset=US-ASCII


Hi all you zsh wizards,

with no .zshenv file, if "history" is the first command it is listed
in the history:

    [~] phl| /phl/build/zsh-3.1.9/Src/zsh
    phl% history
        1  history
    phl% 

if it is the second command you get an error:

    [~] phl| /phl/build/zsh-3.1.9/Src/zsh
    phl% pwd
    /home/greg
    phl% history
    fc: no such event: 1
    phl% 

otherwise, it is not listed:

    [~] phl| /phl/build/zsh-3.1.9/Src/zsh
    phl% pwd
    /home/greg
    phl% echo foo
    foo
    phl% history
        1  pwd
        2  echo foo
    phl% 

also, there is a bad interaction with precmd.  if .zshenv is:

    reload () {
      precmd () {
        unset -f precmd
        source ~/.zshenv
      }
    }

and you start zsh and execute:

    phl% pwd
    /home/greg
    phl% cd
    phl% reload
    phl% pwd
    /home/greg
    phl% echo foo
    foo
    phl% history
        1  pwd
        2  cd
        3  reload
        4  echo foo
    phl% 

notice that the command after "reload" does not make it into the
history.

these problems didn't exist in 3.1.6.

many thanks for all your hard work,
Greg

greg@klanderman.net

