From zsh-workers-return-12661-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Aug 16 11:30:35 2000
Return-Path: <zsh-workers-return-12661-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3544 invoked from network); 16 Aug 2000 11:30:34 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 16 Aug 2000 11:30:34 -0000
Received: (qmail 2620 invoked by alias); 16 Aug 2000 11:29:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12661
Received: (qmail 2611 invoked from network); 16 Aug 2000 11:29:38 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer david.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "ZSH workers mailing list" <zsh-workers@sunsite.auc.dk>
Subject: PATCH: (incomplete - see 12594) icon for zsh under Cygwin
Date: Wed, 16 Aug 2000 15:29:30 +0400
Message-ID: <000301c00775$3e6e2db0$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----=_NextPart_000_0004_01C00796.C57FCDB0"
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
Importance: Normal
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4133.2400

This is a multi-part message in MIME format.

------=_NextPart_000_0004_01C00796.C57FCDB0
Content-Type: text/plain;
	charset="koi8-r"
Content-Transfer-Encoding: 7bit

This is the most straightforward solution. The patch is incomplete - you need
Srz/zsh.ico and Src/zsh.rc from Peter's 12594 (but note, that in this archive
they are in Src/Modules; beware when extracting). I could not convince GNU
diff 2.7 to diff binary file.

I modified Makefile rules; original had obvious problem when building in
source directory.

-andrej

Have a nice DOS!
B >>

------=_NextPart_000_0004_01C00796.C57FCDB0
Content-Type: application/octet-stream;
	name="zsh-icon.diff"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename="zsh-icon.diff"

Index: configure.in=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /cvsroot/zsh/zsh/configure.in,v=0A=
retrieving revision 1.25=0A=
diff -u -r1.25 configure.in=0A=
--- configure.in	2000/08/15 05:13:41	1.25=0A=
+++ configure.in	2000/08/16 11:14:07=0A=
@@ -1693,6 +1693,10 @@=0A=
 AC_SUBST(INSTLIB)dnl=0A=
 AC_SUBST(UNINSTLIB)dnl=0A=
 =0A=
+if test x"$ac_cv_cygwin" =3D xyes; then=0A=
+  EXTRAZSHOBJS=3D"$EXTRAZSHOBJS zsh.res.o"=0A=
+fi=0A=
+=0A=
 AC_DEFINE_UNQUOTED(DL_EXT, "$DL_EXT")dnl=0A=
 AC_SUBST(D)dnl=0A=
 AC_SUBST(DL_EXT)dnl=0A=
@@ -1708,6 +1712,7 @@=0A=
 AC_SUBST(MOD_EXPORT)dnl=0A=
 AC_SUBST(MOD_IMPORT_VARIABLE)dnl=0A=
 AC_SUBST(MOD_IMPORT_FUNCTION)dnl=0A=
+AC_SUBST(EXTRAZSHOBJS)=0A=
 =0A=
 CLEAN_MK=3D"${srcdir}/Config/clean.mk"=0A=
 CONFIG_MK=3D"${srcdir}/Config/config.mk"=0A=
Index: Src/Makefile.in=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /cvsroot/zsh/zsh/Src/Makefile.in,v=0A=
retrieving revision 1.5=0A=
diff -u -r1.5 Makefile.in=0A=
--- Src/Makefile.in	2000/08/02 18:01:51	1.5=0A=
+++ Src/Makefile.in	2000/08/16 11:14:08=0A=
@@ -78,14 +78,19 @@=0A=
 LDRUNPATH =3D LD_RUN_PATH=3D$(libdir)/$(tzsh)=0A=
 NDRUNPATH =3D=0A=
 =0A=
-zsh$(EXEEXT): $(@L@IBZSH) $(@L@STMP) $(MAIN_OBJS) zsh.export=0A=
+EXTRAZSHOBJS =3D @EXTRAZSHOBJS@=0A=
+=0A=
+zsh$(EXEEXT): $(@L@IBZSH) $(@L@STMP) $(MAIN_OBJS) zsh.export =
$(EXTRAZSHOBJS)=0A=
 	rm -f $@=0A=
-	$(@L@DRUNPATH) $(LINK) $(MAIN_OBJS) $(@L@LIST) $(ZSH_@E@XPORT) =
$(@L@IBZSH) $(LIBS)=0A=
+	$(@L@DRUNPATH) $(LINK) $(MAIN_OBJS) $(EXTRAZSHOBJS) $(@L@LIST) =
$(ZSH_@E@XPORT) $(@L@IBZSH) $(LIBS)=0A=
 =0A=
 $(LIBZSH): $(LIBOBJS) $(NSTMP)=0A=
 	rm -f $@=0A=
 	$(DLLINK) $(LIBOBJS) $(NLIST) $(LIBS)=0A=
 =0A=
+zsh.res.o: $(sdir)/zsh.rc $(sdir)/zsh.ico=0A=
+	windres -O coff --include-dir $(sdir) -i $(sdir)/zsh.rc -o zsh.res.o=0A=
+	=0A=
 stamp-modobjs: modobjs=0A=
 	@if cmp -s stamp-modobjs.tmp stamp-modobjs; then \=0A=
 	    rm -f stamp-modobjs.tmp; \=0A=

------=_NextPart_000_0004_01C00796.C57FCDB0--

