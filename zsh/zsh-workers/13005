From zsh-workers-return-13005-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Oct 17 14:01:10 2000
Return-Path: <zsh-workers-return-13005-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26971 invoked from network); 17 Oct 2000 14:01:08 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Oct 2000 14:01:08 -0000
Received: (qmail 6907 invoked by alias); 17 Oct 2000 14:01:02 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 13005
Received: (qmail 6897 invoked from network); 17 Oct 2000 14:01:02 -0000
Date: Tue, 17 Oct 2000 16:01:00 +0200 (MET DST)
Message-Id: <200010171401.QAA08886@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Mon, 16 Oct 2000 15:59:37 +0400
Subject: Re: configure completion with argument


Andrej Borsenkow wrote:

> The following fails:
> 
> configure --TAB  mips-sni-sysv4
> 
> that is, options completion if argument is present.

Hrmpf. In a certain sense, this was correct, because it was awfully
clever and saw that this command doesn't take any arguments. And hence 
the command line didn't match the specification.

But making it a bit more forgiving might make sense, too, especially
since we added something similar for options qute some time ago.

Bye
 Sven

Index: Src/Zle/computil.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/computil.c,v
retrieving revision 1.43
diff -u -r1.43 computil.c
--- Src/Zle/computil.c	2000/10/05 08:55:35	1.43
+++ Src/Zle/computil.c	2000/10/17 13:59:05
@@ -1485,8 +1485,11 @@
 		state.nargbeg = cur - 1;
 		state.argend = argend;
 	    }
-	    if (!d->args && !d->rest && *line && *line != '-' && *line != '+')
+	    if (!d->args && !d->rest && *line && *line != '-' && *line != '+') {
+		if (!multi && cur > compcurrent)
+		    break;
 		return 1;
+	    }
 	    if ((adef = state.def = ca_get_arg(d, state.nth)) &&
 		(state.def->type == CAA_RREST ||
 		 state.def->type == CAA_RARGS)) {

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

