From zsh-users-return-12563-mason-zsh=primenet.com.au@sunsite.dk Thu Feb 14 02:29:15 2008
Return-Path: <zsh-users-return-12563-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4202 invoked from network); 14 Feb 2008 02:29:12 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 14 Feb 2008 02:29:12 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 48320 invoked from network); 14 Feb 2008 02:28:54 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 14 Feb 2008 02:28:54 -0000
Received: (qmail 1327 invoked by alias); 14 Feb 2008 02:28:44 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12563
Received: (qmail 1312 invoked from network); 14 Feb 2008 02:28:44 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 14 Feb 2008 02:28:44 -0000
Received: from mal35-2-82-225-70-234.fbx.proxad.net (mal35-2-82-225-70-234.fbx.proxad.net [82.225.70.234])
	by bifrost.dotsrc.org (Postfix) with ESMTP id F1D1880482A1
	for <zsh-users@sunsite.dk>; Thu, 14 Feb 2008 03:28:39 +0100 (CET)
Received: from localhost (server.nasreddine.info [127.0.0.1])
	by mal35-2-82-225-70-234.fbx.proxad.net (Postfix) with ESMTP id 908F523C5F;
	Thu, 14 Feb 2008 03:28:39 +0100 (CET)
X-Virus-Scanned: amavisd-new at nasreddine.com
Received: from mal35-2-82-225-70-234.fbx.proxad.net ([127.0.0.1])
	by localhost (server.nasreddine.info [127.0.0.1]) (amavisd-new, port 10024)
	with LMTP id QlWUzBCkkVKT; Thu, 14 Feb 2008 03:28:24 +0100 (CET)
Received: from phoenix.nasreddine.info (phoenix.nasreddine.info [192.168.1.3])
	by mal35-2-82-225-70-234.fbx.proxad.net (Postfix) with ESMTP id 8456023C5E;
	Thu, 14 Feb 2008 03:28:24 +0100 (CET)
Date: Thu, 14 Feb 2008 03:28:13 +0100
From: Wael Nasreddine <mla@nasreddine.com>
To: Andrey Borzenkov <arvidjaar@newmail.ru>
Cc: zsh-users@sunsite.dk
Subject: Re: Phil's prompt is not working when LANG is set to UTF-8
Message-ID: <20080214022813.GB11647@phoenix.nasreddine.info>
References: <20080211033116.GD19613@phoenix.nasreddine.info> <20080211155200.0a8e9ecf@news01> <200802132133.35130.arvidjaar@newmail.ru> <200802132201.21702.arvidjaar@newmail.ru>
MIME-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="gatW/ieO32f1wygP"
Content-Disposition: inline
In-Reply-To: <200802132201.21702.arvidjaar@newmail.ru>
X-OS: Linux 2.6.24-tuxonice i686
X-Editor: VIM - Vi IMproved 7.1 (2007 May 12, compiled Feb  4 2008 15:13:47)
X-PGP-Key: http://wael.nasreddine.com/files/Wael_Nasreddine.asc
User-Agent: Mutt/1.5.16 (2007-06-09)
X-Virus-Scanned: ClamAV 0.91.2/5805/Thu Feb 14 00:29:12 2008 on bifrost
X-Virus-Status: Clean


--gatW/ieO32f1wygP
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

This One Time, at Band Camp, Andrey Borzenkov <arvidjaar@newmail.ru> said, =
On Wed, Feb 13, 2008 at 10:01:21PM +0300:
> On Wednesday 13 February 2008, Andrey Borzenkov wrote:
> > On Monday 11 February 2008, Peter Stephenson wrote:

> > > On Mon, 11 Feb 2008 16:07:09 +0100
> > > antho.charles@gmail.com wrote:
> > > > I didn't have this problem on Debian etch, but it appears when I
> > > > upgraded to lenny. It's the same problem: if I set LANG to a non ut=
f8
> > > > encoding (fr_FR instead of fr_FR.UTF-8), RPROMPT is good, otherwise
> > > > it's partially on another line and the cusor is after RPROMPT.
> > > > (cf. http://tinyurl.com/3xjeqt)

> > > Sounds like it ought to be fairly reproducible, but it's not happenin=
g on
> > > Fedora 8 (and it still sounds suspiciously like the shell is getting =
duff
> > > information about the environment, though that's certainly not the on=
ly
> > > possibility).  I've tried adding multibyte characters to the command =
line
> > > and complicating the RPROMPT and even adding multibyte characters to =
that,
> > > but it still works OK.

> > > Are there any particular things on the command line, forms of RPROMPT=
 etc.
> > > etc. that show this up?  (We really need something that narrows this =
down.)


> > I can reproduce it on Mandriva cooker with locale en_US.UTF-8 or ru_RU.=
UTF-8.=20
> It=20
> > does not matter whether there are UTF-8 characters on the screen (at le=
ast, I=20
> am=20
> > not sure whether there are - en_US.UTF-8 should not emit any non-ASCII =
strings=20
> > as far as I can tell).


> Actually the problem seems to be that terminal description contains non-U=
TF-8=20
> conform characters.

> {pts/0}% infocmp | grep acsc
>         acsc=3D``aaffggiijjkkllmmnnooppqqrrssttuuvvwwxxyyzz{{||}}~~,
> {pts/0}% infocmp linux | grep acsc
>         acsc=3D+\020\,
> \021-\030.^Y0\333`\004a\261f\370g\361h\260i\316j\331k\277l\332m\300n\305o=
~p\304q\304r\304s_t\303u\264v\301w\302x\263y\363z\362
> {\343|\330}\234~\376,

> the first one is for dtterm, the second - for linux console.

> The prompt is using q, l, m, j, k - at least some of them have high bit s=
et.

> So something gets confused computing prompt width. I am not really sure
> how to fix it except teaching zsh about ACS mode. Is there any curses fun=
ction
> that would return screen width of character string?

Maybe that's the reason, but changing TERM has no effect whatsoever,
see, whatever TERM is it just never works, but strangely, GNU Screen
works perfectly, New screen sessions and attached ones, My TERM in GNU
Screen is 'screen-256color'...

@Peter have you tried my envirenment on your Fedora install? I tried
installing fedora but it kickstart doesn't support LVM over DM-CRYPT
setup, that'll be fixed in Fedora 9 AFAIK...

--=20
Wael Nasreddine
http://wael.nasreddine.com
PGP: 1024D/C8DD18A2 06F6 1622 4BC8 4CEB D724  DE12 5565 3945 C8DD 18A2

=2E: An infinite number of monkeys typing into GNU emacs,
   would never make a good program. (L. Torvalds 1995) :.

--gatW/ieO32f1wygP
Content-Type: application/pgp-signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.7 (GNU/Linux)

iD8DBQFHs6c9VWU5RcjdGKIRAgtMAKD7NWyLsuLxiDhYzieqBzotu6arlwCfYGTI
cwSjqncX8GxivXtBHGMB9y0=
=xr01
-----END PGP SIGNATURE-----

--gatW/ieO32f1wygP--

