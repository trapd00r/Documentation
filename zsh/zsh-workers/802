From zsh-workers-request@euclid.skiles.gatech.edu  Fri Mar  8 05:57:44 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.4/8.7.3) with ESMTP id BAA20628 for <mason@werple.mira.net.au>; Fri, 8 Mar 1996 01:18:18 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id IAA17284; Thu, 7 Mar 1996 08:50:38 -0500 (EST)
Resent-Date: Thu, 7 Mar 1996 08:50:38 -0500 (EST)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199603071349.OAA18427@bolyai.cs.elte.hu>
Subject: Re: Problem w/zsh-2.6-beta13-hzoli13 as login shell (long)
To: duvall@dhduvall.student.princeton.edu (Danek Duvall)
Date: Thu, 7 Mar 1996 14:49:40 +0100 (MET)
Cc: zsh-workers@math.gatech.edu
In-Reply-To: <199603070220.VAA08428@dhduvall.student.Princeton.EDU> from "Danek Duvall" at Mar 6, 96 09:20:53 pm
Organization: Dept. of Comp. Sci., Eotvos University, Budapest, Hungary
Phone: (36 1)2669833 ext: 2667, home phone: (36 1) 2752368
X-Mailer: ELM [version 2.4 PL24 PGP3 *ALPHA*]
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"-I98O.0.xD4.jckFn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/802
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Status: O

Danek Duvall wrote:
> Zsh is segfaulting when run from /bin/login, either from
> rlogind/telnetd or by exec'ing /bin/login on the commandline.
> Unfortunately, I can't get the thing to dump core, or I'd provide at
> least a backtrace.  The most I've been able to do is get an strace,
> which I've provided at the end of the message.
> 
> Here are my system specs: linux 1.3.71, libc5.0.9, ncurses 1.9.8a, gcc
> 2.7.0 (not using -fno-strength-reduce), /bin/login from the shadow
> password suite.

Unfortunately I cannot reproduce this.  I tried it on 1.3.71 with libc-5.2.18
and libc-5.3.3,  with ncurses and with termcap with sr-bugfixed gcc-2.7.2.

Did you used the ncurses include files to compile zsh?  You may need to add
something like -I/usr/include/ncurses to INCLUDES in Src/Makefile.  If this
does not fix the problem, try to use unlimit coredumpsize before execing
login to get a core then use gdb zsh core then bt to get a backtrace.  If that
does not work, try to login to an account with sh as login shell and
no /etc/profile and ~/.profile, then start zsh -l from there and see if it
gets a SEGV from there.  Or as a last resort add a sleep(1000); right after
the variable declaratins in main() in init.c, login to an account which has
this modified shell as login shell, then attach the shell process to gdb, send
a SIGALRM to the attached process and continue its execution.  If you do not
have a meaningful backtrace try to link with -lncurses_g.  It may happen that
starting /usr/local/bin/zsh works but zsh or ./zsh alone does not work so
experiment with this a little bit.

Thanks,

Zoltan

