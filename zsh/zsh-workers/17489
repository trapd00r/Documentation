From zsh-workers-return-17489-mason-zsh=primenet.com.au@sunsite.dk Tue Jul 30 07:46:10 2002
Return-Path: <zsh-workers-return-17489-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6650 invoked from network); 30 Jul 2002 07:46:09 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 30 Jul 2002 07:46:09 -0000
Received: (qmail 17780 invoked by alias); 30 Jul 2002 07:46:02 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 17489
Received: (qmail 17768 invoked from network); 30 Jul 2002 07:46:02 -0000
From: Sven Wischnowsky <wischnow@berkom.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <15686.17544.316202.482472@wischnow.berkom.de>
Date: Tue, 30 Jul 2002 09:47:20 +0200
To: zsh-workers@sunsite.dk
Subject: Re: Menu selection
In-Reply-To: <20020724230150.66235.qmail@web10409.mail.yahoo.com>
References: <15653.21535.954397.86417@wischnow.berkom.de>
	<20020724230150.66235.qmail@web10409.mail.yahoo.com>
X-Mailer: VM 7.03 under 21.5 (patch 5) "beets" XEmacs Lucid


Felix Rosencrantz wrote:

> Sorry to be the bearer of bad news...
> 
> I'm still seeing problems with the changes made to menu-select/vi-insert.
> Below is the same simple recipe that causes the problem.  Also, attached is the
> output of this recipe run under valgrind.   It points to memory reads of
> data that has already been free'd.
> 
> I actually don't really use this functionality much, but hope it might
> someday be used in a version of history-incremental-search-*ward.
> So that the incremental search can use a matching-spec....

Sigh. You're right, invalidatelist() could be called at the wrong time.


Bye
  Sven

Index: Src/Zle/compresult.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compresult.c,v
retrieving revision 1.45
diff -u -r1.45 compresult.c
--- Src/Zle/compresult.c	26 Jun 2002 11:07:46 -0000	1.45
+++ Src/Zle/compresult.c	30 Jul 2002 07:45:30 -0000
@@ -813,7 +813,7 @@
 	 * want to enter an AUTO_MENU imediately.                          */
 	if ((uselist == 3 ||
 	     (!uselist && isset(BASHAUTOLIST) && isset(LISTAMBIGUOUS))) &&
-	    la) {
+	    la && iforcemenu != -1) {
 	    int fc = fromcomp;
 
 	    invalidatelist();

-- 
Sven Wischnowsky                          wischnow@berkom.de

