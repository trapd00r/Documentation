From zsh-users-return-13964-mason-zsh=primenet.com.au@sunsite.dk Tue Mar 24 21:37:17 2009
Return-Path: <zsh-users-return-13964-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16691 invoked from network); 24 Mar 2009 21:37:14 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 24 Mar 2009 21:37:14 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 61882 invoked from network); 24 Mar 2009 21:37:01 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 24 Mar 2009 21:37:01 -0000
Received: (qmail 9267 invoked by alias); 24 Mar 2009 21:36:40 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13964
Received: (qmail 9253 invoked from network); 24 Mar 2009 21:36:39 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 24 Mar 2009 21:36:39 -0000
Received: from atom.smasher.org (atom.smasher.org [69.55.237.145])
	by bifrost.dotsrc.org (Postfix) with SMTP id D8E7780590EB
	for <zsh-users@sunsite.dk>; Tue, 24 Mar 2009 22:36:25 +0100 (CET)
Received: (qmail 93604 invoked by uid 1000); 24 Mar 2009 21:36:24 -0000
Message-ID: <20090324213624.93603.qmail@smasher.org>
cc: zsh-users@sunsite.dk
Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed
Date: Wed, 25 Mar 2009 10:36:21 +1300 (NZDT)
From: Atom Smasher <atom@smasher.org>
In-Reply-To: <chaz20090324114727.GA5144@seebyte.com>
MIME-Version: 1.0
OpenPGP: id=0xB88D52E4D9F57808; algo=1 (RSA); size=4096; url=http://atom.smasher.org/pgp.txt
References: <20090324101411.66890.qmail@smasher.org> <chaz20090324114727.GA5144@seebyte.com>
Subject: Re: freebsd problems with carriage return
To: Stephane Chazelas <stephane_chazelas@yahoo.fr>
X-POM: The Moon is Waning Crescent (4% of Full)
X-Hashcash: 1:20:0903242136:stephane_chazelas@yahoo.fr::htyYQKPxv7w0klgm:0000000
	0000000000000000000000001i17
X-Hashcash: 1:20:0903242136:zsh-users@sunsite.dk::uM8GF7Itg2rsk3Wf:0000000000000
	0000000000000000000000000/aL
X-Virus-Scanned: ClamAV 0.92.1/9160/Tue Mar 24 17:50:40 2009 on bifrost
X-Virus-Status: Clean

On Tue, 24 Mar 2009, Stephane Chazelas wrote:

> 2009-03-24 23:14:09 +1300, Atom Smasher:
>> on linux this works as expected:
>>
>>      rsync --progress /from /to | while read -d "`print '\r'`" n
>
> See $'\r' instead of "`print '\r'`"
>
>>      do
>>          print "  foo: $n"
>
> should be print -r, print without -r expands the \ sequences.
>
> You should probably use IFS= read -r instead of read as well.
=================

huh?

here are screen-shots of what it's doing on linux, which is what i expect 
and desire:
 	http://smasher.org/tmp/snapshot149.png
 	http://smasher.org/tmp/snapshot150.png

here's a screen-shot of modifying IFS, which i almost thought would work, 
but it makes sense that it doesn't work as above:
 	http://smasher.org/tmp/snapshot151.png

the 151 screen shot shows what doesn't work. if i try the commands used in 
the 149 or 150 screen-shots on freebsd, i get the same non-results as 
shown in 151; the name of the file i'm rsyncing, and then nothing.


> rsync --progress /from /to | sed -n l
>
> (or od -c)
>
> to see what rsync actually outputs.
================

or this:

<<<<<<<<

% rsync --progress -h --bwlimit=5 ./foo_in ./foo_out > test

% cat -vet test
foo_in$
       32.77K   0%    0.00kB/s    0:00:00^M      65.54K   0%    5.00kB/s 
0:49:49^M      98.30K   0%    5.00kB/s    0:49:42^M     131.07K   0% 
5.00kB/s    0:49:36^M     163.84K   1%    5.00kB/s    0:49:29^M 
196.61K   1%    5.00kB/s    0:49:22^M     229.38K   1%    5.00kB/s 
0:49:16^M     262.14K   1%    5.00kB/s    0:49:09^M     294.91K   1% 
5.00kB/s    0:49:03^M     327.68K   2%    5.00kB/s    0:48:56^M 
360.45K   2%    5.00kB/s    0:48:50^M     393.22K   2%    5.00kB/s 
0:48:43^M     425.98K   2%    5.00kB/s    0:48:36^M     458.75K   3% 
5.00kB/s    0:48:30^M     491.52K   3%    5.00kB/s    0:48:24^M
 	<<snip>

<<<<<<<<

all of rsync's output of interest is stdout. it's mostly a bunch of 
progress updates, separated by carriage returns.


-- 
         ...atom

  ________________________
  http://atom.smasher.org/
  762A 3B98 A3C3 96C9 C6B7 582A B88D 52E4 D9F5 7808
  -------------------------------------------------

 	"I am a great mayor;
 	 I am an upstanding Christian man;
 	 I am an intelligent man;
 	 I am a deeply educated man;
 	 I am a humble man."
 		-- Marion Barry
 		Mayor, Washington, D.C

