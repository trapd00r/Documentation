From zsh-users-return-13220-mason-zsh=primenet.com.au@sunsite.dk Mon Sep 15 16:35:08 2008
Return-Path: <zsh-users-return-13220-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12959 invoked from network); 15 Sep 2008 16:35:06 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 15 Sep 2008 16:35:06 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 79789 invoked from network); 15 Sep 2008 16:34:21 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 15 Sep 2008 16:34:21 -0000
Received: (qmail 5297 invoked by alias); 15 Sep 2008 16:33:31 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13220
Received: (qmail 5279 invoked from network); 15 Sep 2008 16:33:29 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 15 Sep 2008 16:33:29 -0000
Received: from smtp.tt-solutions.com (sunset.tt-solutions.com [82.238.156.189])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 05A4C809A183
	for <zsh-users@sunsite.dk>; Mon, 15 Sep 2008 18:33:25 +0200 (CEST)
Received: from nightfall ([192.168.17.76])
	by smtp.tt-solutions.com with esmtp (Exim 4.63)
	(envelope-from <vz-zsh@zeitlins.org>)
	id 1KfH0v-0002ec-7A
	for zsh-users@sunsite.dk; Mon, 15 Sep 2008 18:33:25 +0200
Date: Mon, 15 Sep 2008 18:33:25 +0200
From: Vadim Zeitlin <vz-zsh@zeitlins.org>
Subject: svn completion under Cygwin
To: zsh-users@sunsite.dk
MIME-Version: 1.0
Content-Type: MULTIPART/SIGNED; protocol="application/pgp-signature"; micalg=pgp-sha1; BOUNDARY="1107357347-13575-1221496405=:3616"
X-Mailer: Mahogany 0.67.2 'Constance', running under Windows Server 2003 (build 3790, Service Pack 1)
Message-Id: <20080915163326.05A4C809A183@bifrost.dotsrc.org>
X-Virus-Scanned: ClamAV 0.92.1/8248/Mon Sep 15 17:28:54 2008 on bifrost
X-Virus-Status: Clean

--1107357347-13575-1221496405=:3616
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII
Content-Disposition: INLINE

 Hello,

 My Cygwin zsh 4.3.2 doesn't complete any file names for "svn ci" (and
other svn subcommands) and the problem persists even when using the latest
completion file version from

http://zsh.cvs.sourceforge.net/*checkout*/zsh/zsh/Completion/Unix/Command/_subversion?revision=1.25

I couldn't really understand where exactly does the problem come from to be
honest but, as this works under Unix I was almost sure that it was due to
either "\r\n" line terminators or backslashes instead of slashes in the
output of Win32 svn version. It turned out to be the latter and so the
following trivial patch makes the completion work as expected:

--- _subversion.orig    2008-09-15 18:29:24.788071400 +0200
+++ _subversion 2008-09-15 18:29:33.412740200 +0200
@@ -194,7 +194,7 @@
   local pat="${1:-([ADMR~]|?M)}"

   if (( ! $+_cache_svn_status[$dir] )); then
-    _cache_svn_status[$dir]="$(_call_program files svn status -N $dir)"
+    _cache_svn_status[$dir]="$(_call_program files svn status -N $dir) | tr '\\' '/'"
   fi

   (( ${(M)#${(f)_cache_svn_status[$dir]}:#(#s)${~pat}*$REPLY} ))

This is almost surely not the best way to fix it but maybe this is going to
be useful to somebody. And if anybody could propose a better fix which
could be included in the next versions of zsh it would be great,

 Thanks,
VZ

--1107357347-13575-1221496405=:3616
Content-Type: APPLICATION/PGP-SIGNATURE

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (MingW32)

iEYEABECAAYFAkjOjlUACgkQBupB3k9sHoayQQCfWDpZ0b8094jRayCcBagAunhF
f+EAni9yvitKVygOZWMmXtmle7ezLQmw
=DYzW
-----END PGP SIGNATURE-----

--1107357347-13575-1221496405=:3616--

