From zsh-workers-return-24842-mason-zsh=primenet.com.au@sunsite.dk Fri Apr 18 15:52:42 2008
Return-Path: <zsh-workers-return-24842-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22739 invoked from network); 18 Apr 2008 15:52:32 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 18 Apr 2008 15:52:32 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 84123 invoked from network); 18 Apr 2008 15:52:29 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 18 Apr 2008 15:52:29 -0000
Received: (qmail 7013 invoked by alias); 18 Apr 2008 15:52:27 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24842
Received: (qmail 6997 invoked from network); 18 Apr 2008 15:52:26 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 18 Apr 2008 15:52:26 -0000
Received: from rcpt-expgw.biglobe.ne.jp (rcpt-expgw.biglobe.ne.jp [133.205.19.66])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 37C5E8043AC7
	for <zsh-workers@sunsite.dk>; Fri, 18 Apr 2008 17:52:21 +0200 (CEST)
Received: from smtp-gw.biglobe.ne.jp
	by rcpt-expgw.biglobe.ne.jp (kbkr/0208160408) with ESMTP id m3IFqJO0021956
	for <zsh-workers@sunsite.dk>; Sat, 19 Apr 2008 00:52:19 +0900
X-Biglobe-Sender: <takimoto-j@kba.biglobe.ne.jp>
Received: from [192.168.0.3] (122.132.76.179 [122.132.76.179]) by smtp-gw.biglobe.ne.jp
	id ABMVAC15AFDC; Sat, 19 Apr 2008 00:52:19 +0900 (JST)
Message-Id: <12C9D7E4-D02E-478F-92BD-FDB75F3C8B2D@kba.biglobe.ne.jp>
From: "Jun T." <takimoto-j@kba.biglobe.ne.jp>
To: zsh-workers@sunsite.dk
Content-Type: text/plain; charset=US-ASCII; format=flowed
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v919.2)
Subject: Combining characters and MacOSX
Date: Sat, 19 Apr 2008 00:52:19 +0900
X-Mailer: Apple Mail (2.919.2)
X-Virus-Scanned: ClamAV 0.91.2/6827/Fri Apr 18 16:42:03 2008 on bifrost
X-Virus-Status: Clean

Since all the filenames are decomposed in MacOSX, I guess
many Mac users (including me) have been waiting for the
combining character support eagerly.

But the recent "combining character patch" does not work
on MacOSX, just because wcwidth() on MacOSX is broken.
For example,

wchar_t w = 0x0301; /* COMBINING ACUTE ACCENT */
printf("%d %d\n", wcwidth(w), iswpunct(w) );

this will print "0 1" on Linux but "1 0" on MacOSX. I think
this is a serious bug of MacOSX, but I don't know whether Apple
will fix this or not; maybe they won't at least in a near future.

Is it possible to include a working version of wcwidth()
in the zsh source tree and use it if the system's wcwidth()
is broken?
For example, a version written by Markus Kuhn can be found in:
http://www.cl.cam.ac.uk/~mgk25/ucs/wcwidth.c
Gnulib also has wcwidth(), but I guess the above one is much
easier to include into the zsh source.

As I wrote in another post, use of iswpunct() can be avoided
if the combining character is defined solely by wcwidth(wc)==0.

Jun

