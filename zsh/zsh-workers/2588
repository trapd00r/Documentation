From zsh-workers-request@euclid.skiles.gatech.edu Mon Dec 16 00:21:35 1996
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 812 invoked from network); 16 Dec 1996 00:21:34 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 16 Dec 1996 00:21:34 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id TAA24572; Sun, 15 Dec 1996 19:18:26 -0500 (EST)
Resent-Date: Sun, 15 Dec 1996 19:18:26 -0500 (EST)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199612152354.AAA01269@hzoli.ppp.cs.elte.hu>
Subject: Re: Lost Job Control
To: awick@purple.org (Andy Wick)
Date: Mon, 16 Dec 1996 00:54:46 +0100 (MET)
Cc: zsh-workers@math.gatech.edu
In-Reply-To: <199612152216.RAA18253@people-eater.purple.org> from Andy Wick at "Dec 15, 96 05:16:05 pm"
X-Mailer: ELM [version 2.4ME+ PL17 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"k8_XX2.0.q_5.IL9jo"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2588
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

> xclock &
> xclock &
> %1
> <Control-C>
> %
> <Control-C>
> %
> (ZSH Output: zsh: can't set tty pgrp: invalid argument)

The fix is below.

Zoltan


*** Src/builtin.c	1996/12/14 01:21:07	3.1.0.11
--- Src/builtin.c	1996/12/15 23:43:26
***************
*** 531,537 ****
      if (curjob != -1 && !(jobtab[curjob].stat & STAT_INUSE)) {
  	curjob = prevjob;
  	setprevjob();
! 	if (curjob != -1 && !(jobtab[curjob].stat & STAT_INUSE)) {
  	    curjob = prevjob;
  	    setprevjob();
  	}
--- 531,538 ----
      if (curjob != -1 && !(jobtab[curjob].stat & STAT_INUSE)) {
  	curjob = prevjob;
  	setprevjob();
! 	if (curjob != -1 && !((jobtab[curjob].stat & STAT_INUSE) &&
! 			      curjob != thisjob)) {
  	    curjob = prevjob;
  	    setprevjob();
  	}

