From zsh-workers-return-23174-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 14 07:54:22 2007
Return-Path: <zsh-workers-return-23174-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24261 invoked from network); 14 Feb 2007 07:54:21 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 14 Feb 2007 07:54:21 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 82665 invoked from network); 14 Feb 2007 07:54:15 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 14 Feb 2007 07:54:15 -0000
Received: (qmail 12693 invoked by alias); 14 Feb 2007 07:54:10 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23174
Received: (qmail 12684 invoked from network); 14 Feb 2007 07:54:09 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 14 Feb 2007 07:54:09 -0000
Received: (qmail 82005 invoked from network); 14 Feb 2007 07:54:09 -0000
Received: from vms040pub.verizon.net (206.46.252.40)
  by a.mx.sunsite.dk with SMTP; 14 Feb 2007 07:54:03 -0000
Received: from torch.brasslantern.com ([71.116.79.148])
 by vms040.mailsrvcs.net (Sun Java System Messaging Server 6.2-6.01 (built Apr
 3 2006)) with ESMTPA id <0JDG000YX0L34M02@vms040.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Wed, 14 Feb 2007 01:53:28 -0600 (CST)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id l1E7rQsn005436	for
 <zsh-workers@sunsite.dk>; Tue, 13 Feb 2007 23:53:27 -0800
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id l1E7rQHr005435	for zsh-workers@sunsite.dk; Tue,
 13 Feb 2007 23:53:26 -0800
Date: Tue, 13 Feb 2007 23:53:26 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: echo > * and EMFILE
In-reply-to: <200702131728.l1DHSVb0008430@news01.csr.com>
To: Zsh hackers list <zsh-workers@sunsite.dk>
Message-id: <070213235326.ZM5434@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <20070212223239.GA4812@sc.homeunix.net>
	<200702131053.l1DArKoK003124@news01.csr.com>
	<070213091133.ZM4614@torch.brasslantern.com>
	<200702131728.l1DHSVb0008430@news01.csr.com>
Comments: In reply to Peter Stephenson <pws@csr.com>
 "Re: echo > * and EMFILE" (Feb 13,  5:28pm)

On Feb 13,  5:28pm, Peter Stephenson wrote:
}
} Bart Schaefer wrote:
} > If we call zerr() and closemnodes(), then an error message is printed
} > once but the command never actually executes, so the files that it was
} > possible to open are truncated to zero size.   If we call zwarn() and
} > not closemnodes(), then hundreds of error messages are printed, the
} > command goes ahead, some files get $SECONDS and some remain unchanged.
} > Which is preferable?
} 
} Probably the former.

OK, I'll go ahead and commit the patch from 23169, along with one other
spot in addfd() where it's possible to detect movefd() failure.

