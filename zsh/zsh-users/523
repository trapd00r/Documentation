From zsh-workers-request@euclid.skiles.gatech.edu  Sat Nov 23 06:06:17 1996
Return-Path: zsh-workers-request@euclid.skiles.gatech.edu
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by coral.primenet.com.au (8.7.6/8.7.3) with ESMTP id GAA16294 for <mason@primenet.com.au>; Sat, 23 Nov 1996 06:06:15 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id NAA01182; Fri, 22 Nov 1996 13:56:39 -0500 (EST)
Resent-Date: Fri, 22 Nov 1996 13:40:51 -0500 (EST)
Message-Id: <199611221841.NAA24951@Pontryagin.McRCIM.McGill.EDU>
X-Authentication-Warning: Pontryagin.McRCIM.McGill.EDU: peta owned process doing -bs
X-Authentication-Warning: Pontryagin.McRCIM.McGill.EDU: Host localhost didn't use HELO protocol
To: zsh-users@math.gatech.edu
Subject: Re: ANSI zsh? (GNU 3.13 ls ORPHAN color patch)
In-reply-to: Your message of "22 Nov 1996 07:55:53 +0200."
             <k8kn2wa65cm.fsf@paperilennokki.cs.hut.fi> 
Date: Fri, 22 Nov 1996 13:41:26 -0500
From: Peter Whaite <peta@cim.mcgill.ca>
Resent-Message-ID: <"yG-9s.0.RE.oEVbo"@euclid>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/523
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu


Aki Vehtari said:
> 
> The GNU ls is part of the GNU fileutils and "--color=tty" option was
> added to GNU ls in fileutils-3.13 (which is the latest version AFAIK)

Sorry to continue this off-topic thread but I found that the GNU version
(3.13) of color-ls does not support the, very useful, ORPHAN color for
dangling symbolic links.  I have a patch which works on our irix and sun
systems (below) but I'm wondering if there is a better one around.

--- ls.c.~1~	Mon Jul  8 00:23:47 1996
+++ ls.c	Fri Sep 20 11:43:26 1996
@@ -1593,6 +1593,7 @@
 
   files[files_index].linkname = 0;
   files[files_index].linkmode = 0;
+  files[files_index].linkok = 1;
 
   if (explicit_arg || format_needs_stat)
     {
@@ -1638,7 +1639,8 @@
 	  if (linkpath
 	      && ((explicit_arg && format != long_format)
 		  || indicator_style != none)
-	      && stat (linkpath, &linkstats) == 0)
+	      && (files[files_index].linkok =
+		  (stat (linkpath, &linkstats) == 0) ) )
 	    {
 	      /* Symbolic links to directories that are mentioned on the
 	         command line are automatically traced if not being



