From zsh-users-return-12212-mason-zsh=primenet.com.au@sunsite.dk Sat Nov 17 16:37:00 2007
Return-Path: <zsh-users-return-12212-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24977 invoked from network); 17 Nov 2007 16:36:52 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.3 required=5.0 tests=AWL,BAYES_00,MISSING_MID
	autolearn=ham version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 17 Nov 2007 16:36:52 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 46863 invoked from network); 17 Nov 2007 16:36:42 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Nov 2007 16:36:42 -0000
Received: (qmail 917 invoked by alias); 17 Nov 2007 16:36:28 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12212
Received: (qmail 895 invoked from network); 17 Nov 2007 16:36:26 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 17 Nov 2007 16:36:26 -0000
Received: (qmail 45502 invoked from network); 17 Nov 2007 16:36:26 -0000
Received: from sunset.tt-solutions.com (HELO smtp.tt-solutions.com) (82.238.156.189)
  by a.mx.sunsite.dk with SMTP; 17 Nov 2007 16:36:20 -0000
Received: from nightfall ([192.168.17.76])
	by smtp.tt-solutions.com with esmtp (Exim 4.63)
	(envelope-from <vz-zsh@zeitlins.org>)
	id 1ItQea-0007N9-FK
	for zsh-users@sunsite.dk; Sat, 17 Nov 2007 17:36:20 +0100
Date: Sat, 17 Nov 2007 17:36:20 +0100
From: Vadim Zeitlin <vz-zsh@zeitlins.org>
Subject: strange "diff -u" completion
To: zsh-users@sunsite.dk
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII
Content-Disposition: INLINE
X-Mailer: Mahogany 0.67.0 'Constance', running under Windows Server 2003 (build 3790, Service Pack 1)

 Hello,

 Using zsh 4.3.2 under both Debian Linux and Cygwin trying to complete the
command line after entering "diff -u2 oldfile" results in options being
completed, not "new file". This is because in the file
/usr/share/zsh/4.3.2/functions/Completion/Unix/_diff_options the "-u"
option is explicitly treated differently from "-U" and "--unified" which
are defined, in the list of options passed to _arguments, as taking an
optional parameter, but "-u" isn't. IMO this is wrong as "-u" behaves in
exactly the same way as "-U". But OTOH this has been clearly done on
purpose so there might be something I'm missing.

 Anyhow, if this is not intentional, it would be great if the following
patch could be applied:

--- /usr/share/zsh/4.3.2/functions/Completion/Unix/_diff_options        2006-11-24 05:36:03.000000000 +0100
+++ /home/zeitlin/zsh/_diff_options     2007-11-17 17:33:46.000000000 +0100
@@ -54,8 +54,6 @@
     '--strip-trailing-cr[strip trailing carriage return on input]' \
     '(-a --text)'{-a,--text}'[treat all files as text]' \
-    "($of $oss)"{-C+,--context=-}'[output a context diff]:number of lines of copied context' \
-    "($of $oss)-c[output a context diff]" \
-    "($of $oss)"{-U+,--unified=-}'[output a unified diff]:number of lines of unified context' \
-    "($of $oss)-u[output a unified diff]" \
+    "($of $oss)"{-c+,-C+,--context=-}'[output a context diff]:number of lines of copied context' \
+    "($of $oss)"{-u+,-U+,--unified=-}'[output a unified diff]:number of lines of unified context' \
     "($ofwuc $oss)*"{-L+,--label=}'[set label to use instead of file name]:label' \
     "($ofwuc $oss -p --show-c-function)"{-p,--show-c-function}'[show C function of each change]' \

 Thanks,
VZ

