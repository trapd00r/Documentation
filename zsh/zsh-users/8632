From zsh-users-return-8632-mason-zsh=primenet.com.au@sunsite.dk Fri Mar 25 03:08:11 2005
Return-Path: <zsh-users-return-8632-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25332 invoked from network); 25 Mar 2005 03:08:09 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 Mar 2005 03:08:09 -0000
Received: (qmail 56888 invoked from network); 25 Mar 2005 03:08:01 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 25 Mar 2005 03:08:01 -0000
Received: (qmail 21671 invoked by alias); 25 Mar 2005 03:07:52 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8632
Received: (qmail 21655 invoked from network); 25 Mar 2005 03:07:50 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 25 Mar 2005 03:07:50 -0000
Received: (qmail 55714 invoked from network); 25 Mar 2005 03:07:50 -0000
Received: from itapoa.terra.com.br (200.154.55.227)
  by a.mx.sunsite.dk with SMTP; 25 Mar 2005 03:07:45 -0000
Received: from pasto.terra.com.br (pasto.terra.com.br [200.154.55.137])
	by itapoa.terra.com.br (Postfix) with ESMTP id 9578E30C32C
	for <zsh-users@sunsite.dk>; Fri, 25 Mar 2005 00:07:43 -0300 (BRT)
X-Terra-Karma:         -2%
X-Terra-Hash: e8484215ebcce1c41a1f6030e257ab66
Received-SPF: pass (pasto.terra.com.br: domain of terra.com.br designates 200.154.55.137 as permitted sender) client-ip=200.154.55.137; envelope-from=stdfk@terra.com.br; helo=alien.nyvra.org;
Received: from alien.nyvra.org (dl-lns4-poa-C89AC080.dialterra.com.br [200.154.192.128])
	(authenticated user stdfk)
	by pasto.terra.com.br (Postfix) with ESMTP id D309B1B002D
	for <zsh-users@sunsite.dk>; Fri, 25 Mar 2005 00:07:42 -0300 (BRT)
Date: Thu, 24 Mar 2005 21:18:01 -0300 (BRST)
From: Felipe Kellermann <stdfk@terra.com.br>
To: zsh-users@sunsite.dk
Subject: Opinion: locks, nonblock
Message-ID: <Pine.LNX.4.61.0503242037320.6584@nyvra.alien.bet>
User-Agent: Pine <http://www.washington.edu/pine/>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-1.7 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -1.7

Greetings,

This is more a request for opinions than a question.

Last weekend I decided that I'd try to implement a native "shell file 
locking". I have made a patch to bash 3.0.14 just for experimenting:
http://fk.geek42.org/bash-3.0.14-lock.patch

The patch adds to options: exlock and nonblock.
That was just a test. exlock implements a lock to every file opened by the 
shell (using exec) and nonblock makes O_NONBLOCK'ed operations (including 
the possibly exlock'ed I/O).

My real target while making the patch was the possibility to write a zsh 
module to implement such operations in a native way. Most of these could 
very well be implemented outside the shell while others would have to be 
implemented natively in the environment.

For instance, I have been using lockfile (of procmail) to lock files for 
years. Now I'm wondering if it would not be nicer to have that operation 
natively in my zsh environment.

Some of these operations - like setting a nonblock flag to a fd, or just 
temporarily locking a fd - could help in various ways.

So, the opinions...

Does anyone implemented something like that already? Or else, does anyone 
have specific tricks to achieve similar functionality? I've researched a 
bit and found nothing.

Do you guys think it would be nice to have that functionality implemented 
natively in the shell?

Also, any pointers to implementing that functionality? Would it be better 
designed as a module or natively to the zsh? At first I thought it would 
be nice to write a module implementing something like a "generic file 
descriptior handling" operation.

Are are your opinions on these points?
Thanks,

-- 
Felipe Kellermann

