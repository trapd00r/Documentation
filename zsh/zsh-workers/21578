From zsh-workers-return-21578-mason-zsh=primenet.com.au@sunsite.dk Mon Aug 08 18:13:59 2005
Return-Path: <zsh-workers-return-21578-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19120 invoked from network); 8 Aug 2005 18:13:56 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 8 Aug 2005 18:13:56 -0000
Received: (qmail 9538 invoked from network); 8 Aug 2005 18:13:50 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 8 Aug 2005 18:13:50 -0000
Received: (qmail 4431 invoked by alias); 8 Aug 2005 18:13:47 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21578
Received: (qmail 4422 invoked from network); 8 Aug 2005 18:13:47 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 8 Aug 2005 18:13:47 -0000
Received: (qmail 9211 invoked from network); 8 Aug 2005 18:13:47 -0000
Received: from mail.gmx.net (213.165.64.20)
  by a.mx.sunsite.dk with SMTP; 8 Aug 2005 18:13:43 -0000
Received: (qmail invoked by alias); 08 Aug 2005 18:13:42 -0000
Received: from Bc93f.b.pppool.de (EHLO pcdahl4201) [213.7.201.63]
  by mail.gmx.net (mp034) with SMTP; 08 Aug 2005 20:13:42 +0200
X-Authenticated: #21620914
Message-ID: <024401c59c46$29f6a180$cc74fea9@pcdahl4201>
From: "Thorsten Dahlheimer" <tdahlheim@gmx.net>
To: <zsh-workers@sunsite.dk>
Subject: PATCH: Nitpicking in mkmakemod.sh
Date: Mon, 8 Aug 2005 19:37:38 +0200
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----=_NextPart_000_01DE_01C59C50.A2318C00"
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2800.1409
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2800.1409
X-Y-GMX-Trusted: 0
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.4

This is a multi-part message in MIME format.

------=_NextPart_000_01DE_01C59C50.A2318C00
Content-Type: text/plain;
	charset="Windows-1252"
Content-Transfer-Encoding: 7bit

This fixes the cleanup-on-exit traps in mkmakemod.sh, which used to
do the cleanup, but wouldn't exit.

Regards,
Thorsten Dahlheimer

------=_NextPart_000_01DE_01C59C50.A2318C00
Content-Type: application/octet-stream;
	name="mkmakemod.patch"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename="mkmakemod.patch"

Index: Src/mkmakemod.sh=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /cvsroot/zsh/zsh/Src/mkmakemod.sh,v=0A=
retrieving revision 1.13=0A=
diff -u -p -r1.13 mkmakemod.sh=0A=
--- Src/mkmakemod.sh	14 Feb 2004 18:50:17 -0000	1.13=0A=
+++ Src/mkmakemod.sh	8 Aug 2005 14:46:22 -0000=0A=
@@ -37,7 +37,7 @@=0A=
 # `:<<\Make' and `Make' -- this will be copied into Makemod.in.=0A=
 #=0A=
 # The resulting Makemod.in knows how to build each module that is =
defined.=0A=
-# For each module in also knows how to build a .mdh file.  Each source =
file=0A=
+# For each module it also knows how to build a .mdh file.  Each source =
file=0A=
 # should #include the .mdh file for the module it is a part of.  The =
.mdh=0A=
 # file #includes the .mdh files for any module dependencies, then each =
of=0A=
 # $headers, and then each .epro (for global declarations).  It will=0A=
@@ -92,7 +92,7 @@ if $first_stage; then=0A=
 =0A=
     dir_top=3D`echo $the_subdir | sed 's,[^/][^/]*,..,g'`=0A=
 =0A=
-    trap "rm -f $the_subdir/${the_makefile}.in" 1 2 15=0A=
+    trap "rm -f $the_subdir/${the_makefile}.in; exit 1" 1 2 15=0A=
     echo "creating $the_subdir/${the_makefile}.in"=0A=
     exec 3>&1 >$the_subdir/${the_makefile}.in=0A=
     echo "##### ${the_makefile}.in generated automatically by =
mkmakemod.sh"=0A=
@@ -466,11 +466,11 @@ if $first_stage; then=0A=
 fi=0A=
 =0A=
 if $second_stage ; then=0A=
-    trap "rm -f $the_subdir/${the_makefile}" 1 2 15=0A=
+    trap "rm -f $the_subdir/${the_makefile}; exit 1" 1 2 15=0A=
 =0A=
     ${CONFIG_SHELL-/bin/sh} ./config.status \=0A=
 	--file=3D$the_subdir/${the_makefile}:$the_subdir/${the_makefile}.in ||=0A=
-    return 1=0A=
+    exit 1=0A=
 fi=0A=
 =0A=
 exit 0=0A=

------=_NextPart_000_01DE_01C59C50.A2318C00--

