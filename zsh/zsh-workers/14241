From zsh-workers-return-14241-mason-zsh=primenet.com.au@sunsite.dk Mon May 07 10:34:06 2001
Return-Path: <zsh-workers-return-14241-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25238 invoked from network); 7 May 2001 10:34:05 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 7 May 2001 10:34:05 -0000
Received: (qmail 27330 invoked by alias); 7 May 2001 10:34:00 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14241
Received: (qmail 27316 invoked from network); 7 May 2001 10:33:59 -0000
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
Date: Mon, 7 May 2001 12:33:50 +0200 (MET DST)
Message-Id: <200105071033.MAA02959@beta.informatik.hu-berlin.de>
To: zsh-workers@sunsite.dk
Subject: Re: Screen refresh problem with completion messages
In-Reply-To: <1010504162206.ZM19282@candle.brasslantern.com>

Bart Schaefer wrote:

> ...
> 
> Note that the final close-quote is missing (so only 79 columns of the 80-
> column message were displayed).  Worse, however, is that the cursor is now
> over the `c' in the word `local', on the line above where it should be.
> 
> My guess is that the zle code thinks that all 80 columns were printed and
> thus that the line has wrapped, so it needed to move the cursor up two
> line; but some other part of the code is suppressing the 80th character
> in order to prevent the line from wrapping.  However, I'm not sure how to
> track it down.  Geoff or Sven?

This is yet another manifestation of the first bug in the BUGS file.

At least for the non-complist code, it actually prints all characters
and then outputs a CLEAREOL which removes the last character again.  For
complist I suspect something similar, although there seems to be
something else keeping the last character from being printed (or which
makes it be erased again).

The cursor positioning bug is caused by what you thought.

I'm not at all sure how to fix it.  We discussed it some time ago and
then again (shortly) when talking about open bugs before entering the
4.0-pre-state.  We wanted to have some function that outputs a string
and reports the number of lines needed, taking terminal capabilities
into account.  That function didn't appear and hence I couldn't change
the completion code to use it.  And I don't think I have enough
experience with different terminals to try to write that function myself.

So, what are we to do now?


Bye
  Sven


-- 
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

