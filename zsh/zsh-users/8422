From zsh-users-return-8422-mason-zsh=primenet.com.au@sunsite.dk Mon Jan 24 10:53:06 2005
Return-Path: <zsh-users-return-8422-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11879 invoked from network); 24 Jan 2005 10:53:05 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 24 Jan 2005 10:53:05 -0000
Received: (qmail 51364 invoked from network); 24 Jan 2005 10:52:56 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 24 Jan 2005 10:52:56 -0000
Received: (qmail 8344 invoked by alias); 24 Jan 2005 10:52:36 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8422
Received: (qmail 8334 invoked from network); 24 Jan 2005 10:52:35 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 24 Jan 2005 10:52:35 -0000
Received: (qmail 50177 invoked from network); 24 Jan 2005 10:52:35 -0000
Received: from mailhost1.csr.com (HELO MAILSWEEPER01.csr.com) (81.105.217.43)
  by a.mx.sunsite.dk with SMTP; 24 Jan 2005 10:52:30 -0000
Received: from exchange03.csr.com (unverified [10.100.137.60]) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.12) with ESMTP id <T6eb0c169210a6c8d014d0@MAILSWEEPER01.csr.com> for <zsh-users@sunsite.dk>;
 Mon, 24 Jan 2005 10:51:07 +0000
Received: from news01.csr.com ([10.103.143.38]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Mon, 24 Jan 2005 10:55:14 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.1/8.12.11) with ESMTP id j0OAqY2T007969
	for <zsh-users@sunsite.dk>; Mon, 24 Jan 2005 10:52:35 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.1/8.13.1/Submit) with ESMTP id j0OAqY3S007966
	for <zsh-users@sunsite.dk>; Mon, 24 Jan 2005 10:52:34 GMT
Message-Id: <200501241052.j0OAqY3S007966@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-users@sunsite.dk
Subject: Re: Is this a bug for zsh 4.2.3? 
In-reply-to: <1050123064401.ZM16256@candle.brasslantern.com> 
References: <16883.11714.845975.423895@cns-build4.cisco.com> <1050123064401.ZM16256@candle.brasslantern.com>
Date: Mon, 24 Jan 2005 10:52:34 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 24 Jan 2005 10:55:14.0072 (UTC) FILETIME=[2EA61180:01C50203]
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.3 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.3

Bart Schaefer wrote:
> The network mounted part is a red herring; this occurs anytime one uses
> [[ existingfile -nt nonexistentfile ]].
> 
> What's happening is that stat("nonexistentfile") fails, which causes
> [[ ... ]] to return an error condition rather than a simple falsehood.
> 
> This is almost certainly a a bug, because [ ... ] (the test builtin,
> that is) does not cause an error in this situation.

Yes, this wasn't intended.

> It's a pretty
> serious bug, one that probably warrants a 4.2.4.

I don't have the energy, myself...

> This was introduced
> in the patch in zsh-workers/20412, which could probably be entirely
> backed out because the Austin Group has concluded that the extensions to
> "test" are OK after all.

It's probably more useful to leave it looking like a traditional "test"
which is what existing scripts will assume, if they assume anything.

Index: Src/cond.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/cond.c,v
retrieving revision 1.6
diff -u -r1.6 cond.c
--- Src/cond.c	5 Oct 2004 10:39:43 -0000	1.6
+++ Src/cond.c	24 Jan 2005 10:50:03 -0000
@@ -336,7 +336,7 @@
 		return 1;
 	    a = st->st_mtime;
 	    if (!(st = getstat(right)))
-		return 2;
+		return 1;
 	    return !((ctype == COND_NT) ? a > st->st_mtime : a < st->st_mtime);
 	}
     case COND_EF:

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

This footnote also confirms that this email message has been swept by
MIMEsweeper for the presence of computer viruses.

www.mimesweeper.com
**********************************************************************

