From zsh-users-return-12418-mason-zsh=primenet.com.au@sunsite.dk Fri Jan 11 15:58:34 2008
Return-Path: <zsh-users-return-12418-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19053 invoked from network); 11 Jan 2008 15:58:32 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 11 Jan 2008 15:58:32 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 74407 invoked from network); 11 Jan 2008 15:58:13 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 11 Jan 2008 15:58:13 -0000
Received: (qmail 27892 invoked by alias); 11 Jan 2008 15:58:03 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12418
Received: (qmail 27870 invoked from network); 11 Jan 2008 15:58:02 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 11 Jan 2008 15:58:02 -0000
Received: from virusfilter.dotsrc.org (bifrost [127.0.0.1])
	by spamfilter.dotsrc.org (Postfix) with ESMTP id CB0A38058F4C
	for <zsh-users@sunsite.dk>; Fri, 11 Jan 2008 16:58:01 +0100 (CET)
Received: from mk-outboundfilter-4.mail.uk.tiscali.com (mk-outboundfilter-4.mail.uk.tiscali.com [212.74.114.32])
	by bifrost.dotsrc.org (Postfix) with ESMTP
	for <zsh-users@sunsite.dk>; Fri, 11 Jan 2008 16:58:01 +0100 (CET)
X-Trace: 10555564/mk-outboundfilter-2.mail.uk.tiscali.com/F2S/$ACCEPTED/freedom2Surf-customers/195.137.21.170
X-SBRS: None
X-RemoteIP: 195.137.21.170
X-IP-MAIL-FROM: njm@njm.f2s.com
X-IP-BHB: Once
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: Aq4HAE8hh0fDiRWq/2dsb2JhbACBVqhy
Received: from i-195-137-21-170.freedom2surf.net (HELO oberon.njm.f2s.com) ([195.137.21.170])
  by smtp.f2s.tiscali.co.uk with ESMTP/TLS/DHE-RSA-AES256-SHA; 11 Jan 2008 15:58:00 +0000
Received: from oberon.njm.f2s.com (localhost.njm.f2s.com [127.0.0.1])
	by oberon.njm.f2s.com (8.14.2/8.14.2) with ESMTP id m0BFw0XQ013845
	for <zsh-users@sunsite.dk>; Fri, 11 Jan 2008 15:58:00 GMT
	(envelope-from njm@oberon.njm.f2s.com)
Received: (from njm@localhost)
	by oberon.njm.f2s.com (8.14.2/8.14.2/Submit) id m0BFw0p6013844
	for zsh-users@sunsite.dk; Fri, 11 Jan 2008 15:58:00 GMT
	(envelope-from njm)
Date: Fri, 11 Jan 2008 15:58:00 +0000
From: "N.J. Mann" <njm@njm.f2s.com>
To: zsh-users@sunsite.dk
Subject: CVS completion for 'forced commit'
Message-ID: <20080111155800.GA12171@oberon.njm.f2s.com>
Mail-Followup-To: zsh-users@sunsite.dk
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
X-Operating-System: FreeBSD 6.3-PRERELEASE
User-Agent: Mutt/1.5.17 (2007-11-01)
X-Virus-Scanned: ClamAV using ClamSMTP

Hi,


I have been using ZSH for just over a year now and I am really
impressed!  Well done all those involved.  Previously I have mainly used
TCSH and so getting ZSH completion to work "my" way was important to me.
So far the one thing that has really rattled my chain is that completion
does not work for `cvs commit -f`.  I have only very briefly looked at
the documentation for completion - ENOTIME - so the patch I am about to
suggest is probably wrong. :-)  However, it does appear to work.

+===+===+===+===+===+===+===+

--- zsh/4.3.4/functions/Completion/Unix/_cvs.orig       2007-10-06 07:10:48.000000000 +0100
+++ zsh/4.3.4/functions/Completion/Unix/_cvs    2008-01-11 15:37:52.000000000 +0000
@@ -170,9 +170,19 @@
     '(-F)-m+[message]:message:_cvs_m' \
     '(-m)-F+[message file]:log message file:_files' \
     '-r+[specify revision]:tag:_cvs_revisions' \
-    '*:modified file:_cvs_files_modified'
+    '*:modified file:_cvs_commit_arg'
 }
 
+(( $+functions[_cvs_commit_arg] )) ||
+_cvs_commit_arg() {
+  if (( $+opt_args[-f] )); then
+    _cvs_files
+  else
+    _cvs_files_modified
+  fi
+}
+
+(( $+functions[_cvs_rtag] )) ||
 (( $+functions[_cvs_diff] )) ||
 _cvs_diff() {
   local of ofwuc ouc oss ofwy ofwg ofwl

+===+===+===+===+===+===+===+

Is the above right?  Nearly right?


Cheers,
       Nick.
-- 

