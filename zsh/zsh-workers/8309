From zsh-workers-return-8309-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Oct 17 23:46:38 1999
Return-Path: <zsh-workers-return-8309-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20320 invoked from network); 17 Oct 1999 23:46:38 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Oct 1999 23:46:38 -0000
Received: (qmail 14951 invoked by alias); 17 Oct 1999 23:46:32 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8309
Received: (qmail 14943 invoked from network); 17 Oct 1999 23:46:32 -0000
Date: Mon, 18 Oct 1999 01:46:49 +0200
From: Jos Backus <Jos.Backus@nl.origin-it.com>
To: Bart Schaefer <schaefer@candle.brasslantern.com>
Cc: zsh-workers@sunsite.auc.dk
Subject: Re: About to release 3.0.7 ...
Message-ID: <19991018014649.A84537@hal.mpn.cp.philips.com>
Reply-To: Jos Backus <Jos.Backus@nl.origin-it.com>
References: <991017212615.ZM20453@candle.brasslantern.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 1.0pre2i
In-Reply-To: <991017212615.ZM20453@candle.brasslantern.com>

	Hi Bart,

FreeBSD -current has recently acquired a new limit type:

>From /usr/include/sys/resource.h:

#define RLIMIT_SBSIZE   9               /* maximum size of all socket buffers */

This causes Src/rlimits.awk to exit with badlimit == 1:

awk -f ./rlimits.awk /usr/include/sys/resource.h > rlimits.h
*** Error code 1

Stop in /usr/local/src/zsh-3.0.7/Src.
*** Error code 1

Stop in /usr/local/src/zsh-3.0.7.
jos:/usr/local/src/zsh-3.0.7# cat Src/rlimits.h
/** rlimits.h                                 **/
/** architecture-customized limits for zsh **/

#define ZSH_NLIMITS 10

static char *recs[ZSH_NLIMITS+1] = {
        "cputime",
        "filesize",
        "datasize",
        "stacksize",
        "coredumpsize",
        "memoryuse",
        "memorylocked",
        "maxproc",
        "descriptors",
        "SBSIZE",
        NULL
};   

Suggested fix:

--- Src/rlimits.awk.orig        Mon Oct 18 01:44:46 1999
+++ Src/rlimits.awk     Mon Oct 18 01:45:22 1999
@@ -37,6 +37,7 @@
            if (limnam == "TCACHE")  { msg[limnum] = "cachedthreads" }
            if (limnam == "AIO_OPS") { msg[limnum] = "aiooperations" }
            if (limnam == "AIO_MEM") { msg[limnum] = "aiomemorylocked" }
+           if (limnam == "SBSIZE")  { msg[limnum] = "sbsize" }
         }
     }
 }

Thanks,
-- 
Jos Backus                          _/ _/_/_/  "Reliability means never
                                   _/ _/   _/   having to say you're sorry."
                                  _/ _/_/_/             -- D. J. Bernstein
                             _/  _/ _/    _/
Jos.Backus@nl.origin-it.com  _/_/  _/_/_/      use Std::Disclaimer;

