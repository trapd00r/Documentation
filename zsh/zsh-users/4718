From zsh-users-return-4718-mason-zsh=primenet.com.au@sunsite.dk Thu Feb 28 17:14:05 2002
Return-Path: <zsh-users-return-4718-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14818 invoked from network); 28 Feb 2002 17:14:04 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 28 Feb 2002 17:14:04 -0000
Received: (qmail 20538 invoked by alias); 28 Feb 2002 17:13:50 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4718
Received: (qmail 20527 invoked from network); 28 Feb 2002 17:13:49 -0000
Date: Thu, 28 Feb 2002 17:12:54 +0000
From: Ian Lynagh <igloo@earth.li>
To: zsh-users@sunsite.dk
Subject: Re: Length of %? in prompt
Message-ID: <20020228171254.GA32284@stu163.keble.ox.ac.uk>
Mail-Followup-To: zsh-users@sunsite.dk
References: <20020228153400.GA31674@stu163.keble.ox.ac.uk> <Pine.LNX.4.44.0202280827160.31050-100000@ns1.sodaware.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <Pine.LNX.4.44.0202280827160.31050-100000@ns1.sodaware.com>
User-Agent: Mutt/1.3.25i
Sender: Ian Lynagh <ian@lynagh.demon.co.uk>

On Thu, Feb 28, 2002 at 08:45:03AM -0800, Bart Schaefer wrote:
> On Thu, 28 Feb 2002, Ian Lynagh wrote:
> 
> > I have just a couple more problems. Firstly I can't find a way to have
> > ANSI escape sequences actually executed when they are passed through
> > psvar - is this possible?
> 
> No, it's not possible.  The contents of psvar are always passed through
> zsh's internal "nice display" filter, which works sort of like "cat -v".

OK, ta

> >     "%\$((\$COLUMNS-2))>${(%%):-%{$fg_bold[cyan]%\}}k>"
> > and "%\$((\$COLUMNS-2))>\${(%%):-%{$fg_bold[cyan]%\}}k>"
> > seem to be counting the length of the ANSI escape sequence in the length
> > calculation - am I missing something?
> 
> However, it's not making any sense to me that you want to insert a color
> change only when the string is truncated.  I think you're probably seeking
> something like this:

I missed the ^N out for simplicity, and in graphics mode k is a
top-right corner character. What I'm doing is something like this:

/--stuff--more stuff--some more stuff--------------------

and I am then truncating this to the screen width with \ (using / and \
for top-left and top-right corner characters respectively). The border
is in graphics mode and bold cyan while the various stuffs are in
various colours and normal text mode, so if it gets truncated in the
middle of them I am getting a text letter k in whatever colour happens
to be there. Therefore I want to set the colour and have a ^N in the
truncating string.

Any ideas?


Thanks
Ian

