From zsh-workers-return-16577-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 06 16:43:39 2002
Return-Path: <zsh-workers-return-16577-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25566 invoked from network); 6 Feb 2002 16:43:36 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 6 Feb 2002 16:43:36 -0000
Received: (qmail 21223 invoked by alias); 6 Feb 2002 16:43:21 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16577
Received: (qmail 21210 invoked from network); 6 Feb 2002 16:43:20 -0000
Date: Wed, 6 Feb 2002 11:43:15 -0500
From: Clint Adams <clint@zsh.org>
To: Bart Schaefer <schaefer@brasslantern.com>
Cc: zsh-workers@sunsite.dk
Subject: Re: PATCH: _ssh (scp)
Message-ID: <20020206164315.GA23850@dman.com>
References: <20020204175927.GA12977@dman.com> <20020205102420.39912.qmail@web9304.mail.yahoo.com> <20020205174702.GA2325@dman.com> <20020205180850.GA2743@dman.com> <1020205183840.ZM30292@candle.brasslantern.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1020205183840.ZM30292@candle.brasslantern.com>
User-Agent: Mutt/1.3.25i

> There was a change to make :h behave more as if it knew about file structure,
> but I'm quite sure that turning `/' into `.' was not an intended effect, and
> in fact it looks like a serious bug to me.

Is the following acceptable behavior on Cygwin?

Index: Src/hist.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/hist.c,v
retrieving revision 1.36
diff -u -r1.36 hist.c
--- Src/hist.c	2001/10/26 23:47:10	1.36
+++ Src/hist.c	2002/02/06 16:38:14
@@ -1378,7 +1378,11 @@
     while (str >= *junkptr && !IS_DIRSEP(*str))
 	--str;
     if (str < *junkptr) {
-	*junkptr = dupstring (".");
+	if (IS_DIRSEP(**junkptr))
+	    *junkptr = dupstring ("/");
+	else
+	    *junkptr = dupstring (".");
+
 	return 0;
     }
     /* repeated slashes are considered like a single slash */

