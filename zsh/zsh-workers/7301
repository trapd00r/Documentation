From zsh-workers-return-7301-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Jul 28 05:14:10 1999
Return-Path: <zsh-workers-return-7301-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29915 invoked from network); 28 Jul 1999 05:14:08 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 28 Jul 1999 05:14:08 -0000
Received: (qmail 17746 invoked by alias); 28 Jul 1999 05:13:57 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7301
Received: (qmail 17736 invoked from network); 28 Jul 1999 05:13:52 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <990728051241.ZM27045@candle.brasslantern.com>
Date: Wed, 28 Jul 1999 05:12:41 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: _cvs should complete dot-files (?)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

After 7295 and 7296, the _cvs completer stopped matching files whose name
begins with a dot upon "cvs add".  This restores that behavior, and also
removes the now-extraneous assignment to $all.

I personally want dot-files completed here, but it might be nice to omit
them unless you've typed the leading dot yourself.  That behavior is at
the end as a uuencoded patch (so you can't accidentally apply both; they
conflict).

Index: Completion/User/_cvs
===================================================================
@@ -308,13 +308,12 @@
   if [[ -d ${pref}CVS ]]; then
     _cvsentries
     setopt localoptions unset
-    local all omit
-    all=( ${pref}*~${pref}CVS(D:t) )
+    local omit
     omit=( CVS $entries ${=cvsignore} )
     [[ -r ~/.cvsignore ]] && omit=( $omit $(<~/.cvsignore) )
     [[ -r ${pref}.cvsignore ]] && omit=( $omit $(<${pref}.cvsignore) )
-    compgen -g '*~(*/|)('${(j:|:)omit:q}')' ||
-    { _cvsdirentries; compgen -g '('${(j:|:)entries:q}')' }
+    compgen -g '*~(*/|)('${(j:|:)omit:q}')(D)' ||
+    { _cvsdirentries; compgen -g '('${(j:|:)entries:q}')(D)' }
   else
     _files
   fi


The first line of this uuencoded block is a compgen command cut'n'pasted
from xtrace output of the _cvsaddp function that results after applying
the patch in the rest of the block and then typing "cvs add Src/<TAB>" in
my zsh source tree.  3.1.6-test-3 dumps core with a garbaged stack (no
useful backtrace) while trying to execute that compgen.

begin 664 alternate._cvs.diff
M8V]M<&=E;B`M9R`H+EPC36%K969I;&4N:6XN,2XU?"Y<(TUA:V5F:6QE+FEN
M+C$N-GPN7"--86ME9FEL92YI;BXQ+C=\+EPC36%K96UO9"YI;BYI;BXQ+C-\
M+EPC8G5I;'1I;BYC+C$N,C9\+EPC8G5I;'1I;BYC+C$N,C=\+EPC8G5I;'1I
M;BYC+C$N,S)\+EPC8G5I;'1I;BYC+C$N,S9\+EPC8G5I;'1I;BYC+C$N-#%\
M+EPC8G5I;'1I;BYC+C$N-#-\+EPC8V]N9"YC+C$N-WPN7"-C;VYD+F,N,2XY
M?"Y<(V5X96,N8RXQ+C(P?"Y<(V5X96,N8RXQ+C(R?"Y<(V5X96,N8RXQ+C(V
M?"Y<(V5X96,N8RXQ+C,S?"Y<(V5X96,N8RXQ+C,W?"Y<(V5X96,N8RXQ+C0R
M?"Y<(V5X96,N8RXQ+C0S?"Y<(V5X96,N8RXQ+C0U?"Y<(V5X96,N8RXQ+C0X
M?"Y<(V=L;V(N8RXQ+C(U?"Y<(V=L;V(N8RXQ+C(W?"Y<(V=L;V(N8RXQ+C(Y
M?"Y<(V=L;V(N8RXQ+C,P?"Y<(V=L;V(N8RXQ+C,R?"Y<(VAA<VAT86)L92YC
M+C$N,3%\+EPC:&%S:'1A8FQE+F,N,2XQ,GPN7"-H87-H=&%B;&4N8RXQ+CA\
M+EPC:&ES="YC+C$N-'PN7"-H:7-T+F,N,2XV?"Y<(VAI<W0N8RXQ+C=\+EPC
M:&ES="YC+C$N.7PN7"-I;FET+F,N,2XQ.7PN7"-I;FET+F,N,2XR,'PN7"-I
M;FET+F,N,2XR,GPN7"-I;FET+F,N,2XR-GPN7"-I;FET+F,N,2XR.7PN7"-I
M;FET+F,N,2XS,7PN7"-I;FET+F,N,2XS-'PN7"-I;G!U="YC+C$N,3!\+EPC
M:6YP=70N8RXQ+C=\+EPC:F]B<RYC+C$N,3!\+EPC:F]B<RYC+C$N,3)\+EPC
M:F]B<RYC+C$N,3-\+EPC:F]B<RYC+C$N-7PN7"-J;V)S+F,N,2XW?"Y<(VQE
M>"YC+C$N,3%\+EPC;&5X+F,N,2XQ,GPN7"-L97@N8RXQ+C$S?"Y<(VQI;FML
M:7-T+F,N,2XR?"Y<(VQO;W`N8RXQ+C$P?"Y<(VQO;W`N8RXQ+C$Q?"Y<(VQO
M;W`N8RXQ+C9\+EPC;&]O<"YC+C$N.7PN7"-M86EN+F,N,2XU?"Y<(VUA=&@N
M8RXQ+C-\+EPC;65M+F,N,2XT?"Y<(VUE;2YC+C$N-GPN7"-M;V1U;&4N8RXQ
M+C$S?"Y<(VUO9'5L92YC+C$N,39\+EPC;W!T:6]N<RYC+C$N-7PN7"-O<'1I
M;VYS+F,N,2XV?"Y<(V]P=&EO;G,N8RXQ+C=\+EPC;W!T:6]N<RYC+C$N.'PN
M7"-O<'1I;VYS+F,N,2XY?"Y<(W!A<F%M<RYC+C$N,S=\+EPC<&%R86US+F,N
M,2XT,'PN7"-P87)A;7,N8RXQ+C0T?"Y<(W!A<F%M<RYC+C$N-#9\+EPC<&%R
M<V4N8RXQ+C=\+EPC<&%R<V4N8RXQ+CA\+EPC<&%R<V4N8RXQ+CE\+EPC<')O
M;7!T+F,N,2XU?"Y<(W-I9VYA;',N8RXQ+C5\+EPC<VEG;F%L<RYC+C$N-WPN
M7"-S:6=N86QS+F,N,2XY?"Y<(W-U8G-T+F,N,2XR-7PN7"-S=6)S="YC+C$N
M,CA\+EPC<W5B<W0N8RXQ+C,Q?"Y<(W-U8G-T+F,N,2XS,WPN7"-S=6)S="YC
M+C$N,S5\+EPC<W5B<W0N8RXQ+C,V?"Y<(W1E>'0N8RXQ+C1\+EPC=&5X="YC
M+C$N-GPN7"-U=&EL<RYC+C$N,C)\+EPC=71I;',N8RXQ+C(U?"Y<(W5T:6QS
M+F,N,2XR-WPN7"-U=&EL<RYC+C$N,S!\+EPC=71I;',N8RXQ+C,T?"Y<(WAM
M;V1S+F-O;F8N,2XS?"Y<(WIS:"YH+C$N,C1\+EPC>G-H+F@N,2XR-7PN7"-Z
M<V@N:"XQ+C(Y?"Y<(WIS:"YH+C$N,S-\+EPC>G-H+F@N,2XS-7PN7"-Z<V@N
M:"XQ+C,V?"Y<(WIS:"YH+C$N,SA\+EPC>G-H+FUD9"XQ+C5\+EPC>G-H+FUD
M9"XQ+C=\+F-V<VEG;F]R97PN9&ES=&9I;&5S?"YE>')C?$)U:6QT:6YS?$-6
M4WQ-86ME9FEL92YI;GQ-86ME;6]D+FEN+FEN?$UO9'5L97-\6FQE?&%N<VDR
M:VYR+F-\8G5I;'1I;BYC?&-O;7!A="YC?&-O;F0N8WQE>&5C+F-\9VQO8BYC
M?&AA<VAT86)L92YC?&AA<VAT86)L92YH?&AI<W0N8WQI;FET+F-\:6YP=70N
M8WQJ;V)S+F-\;&5X+F-\;&EN:VQI<W0N8WQL;V]P+F-\;6%I;BYC?&UA:V5P
M<F\N87=K?&UA=&@N8WQM96TN8WQM:V)L=&YM;'-T+G-H?&UK;6%K96UO9"YS
M:'QM:VUO9&EN9&5X+G-H?&UO9&5N=')Y+F-\;6]D=6QE+F-\;W!T:6]N<RYC
M?'!A<F%M<RYC?'!A<G-E+F-\<')O;7!T+F-\<')O=&]T>7!E<RYH?'-I9VYA
M;',N8WQS:6=N86QS+FA\<VEG;F%M97,Q+F%W:WQS:6=N86UE<S(N87=K?'-U
M8G-T+F-\<WES=&5M+FA\=&5X="YC?'5T:6QS+F-\=V%T8V@N8WQX;6]D<RYC
M;VYF?'IS:"YE>'!O<G1\>G-H+FA\>G-H+FUD9'QZ='EP92YH*7XH*B]\*2A#
M5E-\+F-V<VEG;F]R97PN97AR8WQA;G-I,FMN<BYC?&AA<VAT86)L92YH?&UA
M:V5P<F\N87=K?&UK8FQT;FUL<W0N<VA\;6MM86ME;6]D+G-H?&UK;6]D:6YD
M97@N<VA\;6]D96YT<GDN8WQS:6=N86QS+FA\<VEG;F%M97,Q+F%W:WQS:6=N
M86UE<S(N87=K?'=A=&-H+F-\>G1Y<&4N:'Q"=6EL=&EN<WQ-;V1U;&5S?%IL
M97QC;VUP870N8WQP<F]T;W1Y<&5S+FA\<WES=&5M+FA\+F1I<W1F:6QE<WQ-
M86ME;6]D+FEN+FEN?&UA:6XN8WQC;VYD+F-\;&EN:VQI<W0N8WQT97AT+F-\
M>G-H+FUD9'QM96TN8WQI;G!U="YC?'IS:"YE>'!O<G1\:&%S:'1A8FQE+F-\
M;6]D=6QE+F-\>&UO9',N8V]N9GQ-86ME9FEL92YI;GQI;FET+F-\<VEG;F%L
M<RYC?&AI<W0N8WQJ;V)S+F-\;&]O<"YC?&UA=&@N8WQP87)A;7,N8WQP<F]M
M<'0N8WQG;&]B+F-\;&5X+F-\;W!T:6]N<RYC?'!A<G-E+F-\=71I;',N8WQZ
M<V@N:'QB=6EL=&EN+F-\97AE8RYC?'-U8G-T+F-\36%K969I;&5\36%K96UO
M9"YI;GQ-86ME;6]D?%PJ+G!R;WQ<*BYO?%PJ+F\N8WQ<*BYS;WQ<*BYM9&A\
M7"HN;61H:7Q<*BYM9&AS?%PJ+FUD:"YT;7!\;6]D=6QE<RYI;F1E>'QM;V1U
M;&5S+FEN9&5X+G1M<'QM;V1U;&5S+G-T86UP?&UO9'5L97,M8FQT:6Y\<W1A
M;7`M;6]D;V)J<WQS=&%M<"UM;V1O8FIS+G1M<'QA;G-I,FMN<GQZ<VA\;&EB
M>G-H+G-O7"I\<VEG8V]U;G0N:'QS:6=N86UE<RYC?'9E<G-I;VXN:'QZ<VAP
M871H<RYH?'IS:'AM;V1S+FA\8FQT:6YM;V1S+FQI<W1\=&%G<WQ404=3*0H*
M26YD97@Z($-O;7!L971I;VXO57-E<B]?8W9S"CT]/3T]/3T]/3T]/3T]/3T]
M/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]
M/3T]/3T*0$`@+3,P,RPQ."`K,S`S+#$X($!`"B!]"B`*(%]C=G-A9&1P("@I
M('L*("`@;&]C86P@<7!R968@<')E9B!E;G1R:65S"B`@(%]C=G-P<F5F:7@*
M("`@:68@6UL@+60@)'MP<F5F?4-64R!=73L@=&AE;@H@("`@(%]C=G-E;G1R
M:65S"B`@("`@<V5T;W!T(&QO8V%L;W!T:6]N<R!U;G-E=`H@("`@(&QO8V%L
M(&%L;"!O;6ET"BT@("`@86QL/2@@)'MP<F5F?2I^)'MP<F5F?4-64RA$.G0I
M("D**R`@("!A;&P]*"`D>W!R969]*BA$.G0I("D*("`@("!O;6ET/2@@0U93
M("1E;G1R:65S("1[/6-V<VEG;F]R97T@*0H@("`@(%M;("UR('XO+F-V<VEG
M;F]R92!=72`F)B!O;6ET/2@@)&]M:70@)"@\?B\N8W9S:6=N;W)E*2`I"B`@
M("`@6UL@+7(@)'MP<F5F?2YC=G-I9VYO<F4@75T@)B8@;VUI=#TH("1O;6ET
M("0H/"1[<')E9GTN8W9S:6=N;W)E*2`I"BT@("`@8V]M<&=E;B`M9R`G*GXH
M*B]\*2@G)'LH:CI\.BEO;6ET.G%])RDG('Q\"BT@("`@>R!?8W9S9&ER96YT
M<FEE<SL@8V]M<&=E;B`M9R`G*"<D>RAJ.GPZ*65N=')I97,Z<7TG*2<@?0HK
M("`@(&-O;7!G96X@+6<@)R@G)'LH:CI\.BEA;&PZ<7TG*7XH*B]\*2@G)'LH
M:CI\.BEO;6ET.G%])RDG('Q\"BL@("`@>R!?8W9S9&ER96YT<FEE<SL@8V]M
M<&=E;B`M9R`G*"<D>RAJ.GPZ*65N=')I97,Z<7TG*2A$*2<@?0H@("!E;'-E
3"B`@("`@7V9I;&5S"B`@(&9I"@``
`
end

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

