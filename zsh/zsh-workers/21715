From zsh-workers-return-21715-mason-zsh=primenet.com.au@sunsite.dk Fri Sep 09 12:33:29 2005
Return-Path: <zsh-workers-return-21715-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28337 invoked from network); 9 Sep 2005 12:33:25 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 9 Sep 2005 12:33:25 -0000
Received: (qmail 36180 invoked from network); 9 Sep 2005 12:33:19 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 Sep 2005 12:33:19 -0000
Received: (qmail 20397 invoked by alias); 9 Sep 2005 12:33:17 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21715
Received: (qmail 20387 invoked from network); 9 Sep 2005 12:33:16 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 9 Sep 2005 12:33:16 -0000
Received: (qmail 35899 invoked from network); 9 Sep 2005 12:33:16 -0000
Received: from zproxy.gmail.com (64.233.162.203)
  by a.mx.sunsite.dk with SMTP; 9 Sep 2005 12:33:11 -0000
Received: by zproxy.gmail.com with SMTP id 13so1534201nzn
        for <zsh-workers@sunsite.dk>; Fri, 09 Sep 2005 05:33:10 -0700 (PDT)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:reply-to:to:subject:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references;
        b=SD1sfua91qfWL2W5n2N11kKLaBRfxkJQCYGbvpxxOuDImxBtRdqGY+wS4bTQ/Konw/1z4fJUcMqm1Gzdfy11WWM7kr7rYjfssD37dnfBCZGdY9jx4MB9PyogErfnyL6ZevSRIHrrxpPuZWS1cclf7VzBQmq/DdT+w0y/f1P/Ve8=
Received: by 10.36.154.20 with SMTP id b20mr262476nze;
        Fri, 09 Sep 2005 05:33:10 -0700 (PDT)
Received: by 10.36.23.13 with HTTP; Fri, 9 Sep 2005 05:33:09 -0700 (PDT)
Message-ID: <237967ef050909053330303540@mail.gmail.com>
Date: Fri, 9 Sep 2005 14:33:09 +0200
From: Mikael Magnusson <mikachu@gmail.com>
Reply-To: mikachu@gmail.com
To: zsh-workers@sunsite.dk
Subject: Re: various weirdnesses with unicode support
In-Reply-To: <20050909125341.12a21423.pws@csr.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline
References: <237967ef05090713304637c1f1@mail.gmail.com>
	 <20050908085533.GA2463@fargo>
	 <200509081002.j88A215f024377@news01.csr.com>
	 <20050908113246.52522e05.pws@csr.com>
	 <237967ef0509080731646f7306@mail.gmail.com>
	 <20050909125341.12a21423.pws@csr.com>
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,RCVD_BY_IP 
	autolearn=ham version=3.0.4

On 9/9/05, Peter Stephenson <pws@csr.com> wrote:
> Mikael Magnusson <mikachu@gmail.com> wrote:
> > It seems to help a bit. If i press =E5 (a with a ring), and then press =
a
> > a few times, zle still seems to be in a mostly normal state. But if i
> > press several =E5 in a row i can't seem to get out.
>=20
> I've checked this in anyway, with some slight tweaks: the MB state is
> also reset if getrestchar() returns EOF, and I've added zle documentation
> indicating that $KEYTIMEOUT is applied to multibyte characters.
>=20
> I won't be much use with debugging this since I have currently no way
> of generating invalid characters.  X Windows is smart enough to convert
> between windows.  There may be some way of confusing it with the locale
> or character set.

You can try stuff like echo `echo =E5=E4=F6 or other characters | iconv -f
UTF-8 -t ISO-8859-1`<tab>
It will just expand to an empty string in the command line, but the
completion listing does show the =E5 (rxvt-unicode shows invalid
characters as latin-1 which is not really the right thing to do but
still more helpful than a box).
As for confusing zsh with keyboard input, just running a terminal in
some iso-8859 mode and running export LC_CTYPE=3Dxx_XX.UTF-8 should be
enough to trigger the thing i talked about, since zsh then expects the
input to be UTF-8.

--=20
Mikael Magnusson

