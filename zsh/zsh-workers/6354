From zsh-workers-return-6354-mason-zsh=primenet.com.au@sunsite.auc.dk Thu May 27 06:24:15 1999
Return-Path: <zsh-workers-return-6354-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17874 invoked from network); 27 May 1999 06:24:13 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 27 May 1999 06:24:13 -0000
Received: (qmail 7648 invoked by alias); 27 May 1999 06:24:06 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6354
Received: (qmail 7641 invoked from network); 27 May 1999 06:24:06 -0000
Date: Thu, 27 May 1999 08:24:04 +0200 (MET DST)
Message-Id: <199905270624.IAA09978@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 26 May 1999 22:01:44 +0900
Subject: Re: zsh-3.1.5-pws-19 unquotes prefix.


Tanaka Akira wrote:

> is27e1u11% fpath=($PWD/Completion/*(/))
> is27e1u11% . Completion/Core/compinit
> is27e1u11% _tst () { compadd -P '\*' a }              
> is27e1u11% _comps[tst]=_tst
> is27e1u11% tst \*<TAB>
> 
> Then, I get no completion.

Argh. Sorry, I just forgot to change `compadd -P', too. Of course it's 
the same fix as for comp{gen,ctl}.

Bye
 Sven

--- os/Zle/zle_tricky.c	Tue May 25 19:47:05 1999
+++ Src/Zle/zle_tricky.c	Wed May 26 20:28:14 1999
@@ -3609,7 +3609,9 @@
 		llsl = strlen(lsuf);
 		/* Test if there is an existing -P prefix. */
 		if (dat->pre && *dat->pre) {
-		    pl = pfxlen(dat->pre, lpre);
+		    char *dp = rembslash(dat->pre);
+
+		    pl = pfxlen(dp, lpre);
 		    llpl -= pl;
 		    lpre += pl;
 		}

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

