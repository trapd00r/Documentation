From zsh-users-return-8059-mason-zsh=primenet.com.au@sunsite.dk Thu Oct 14 15:39:37 2004
Return-Path: <zsh-users-return-8059-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14055 invoked from network); 14 Oct 2004 15:39:36 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 14 Oct 2004 15:39:36 -0000
Received: (qmail 55928 invoked from network); 14 Oct 2004 15:39:29 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 14 Oct 2004 15:39:29 -0000
Received: (qmail 12832 invoked by alias); 14 Oct 2004 15:38:41 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8059
Received: (qmail 12809 invoked from network); 14 Oct 2004 15:38:40 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 14 Oct 2004 15:38:40 -0000
Received: (qmail 54316 invoked from network); 14 Oct 2004 15:37:41 -0000
Received: from moonbase.zanshin.com (64.84.47.139)
  by a.mx.sunsite.dk with SMTP; 14 Oct 2004 15:37:38 -0000
Received: from toltec.zanshin.com (toltec.zanshin.com [64.84.47.166])
	by moonbase.zanshin.com (8.13.1/8.13.1) with ESMTP id i9EFbaEW016707;
	Thu, 14 Oct 2004 08:37:36 -0700
Date: Thu, 14 Oct 2004 08:37:36 -0700 (PDT)
From: Bart Schaefer <schaefer@brasslantern.com>
Reply-To: zsh-users@sunsite.dk
To: Matt Garman <garman@raw-sewage.net>
cc: zsh-users@sunsite.dk
Subject: Re: HASH_LIST_ALL?
In-Reply-To: <20041014034134.GA7178@raw-sewage.net>
Message-ID: <Pine.LNX.4.61.0410140815240.24408@toltec.zanshin.com>
References: <20041013200240.GA27249@raw-sewage.net>
 <Pine.LNX.4.61.0410131937060.24408@toltec.zanshin.com> <20041014034134.GA7178@raw-sewage.net>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_44 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0

On Wed, 13 Oct 2004, Matt Garman wrote:

> rehashComplete() {
>     rehash;
>     zle expand-or-complete;
> }

Egad.  That means you're rehashing on every completion, not just on every 
command completion.  What a terrific waste of time and CPU.  If you're
using compsys, the right way to do this is by adding to your completer
zstyle:

  _force_rehash() {
    (( CURRENT == 1 )) && rehash
    return 1	# Because we didn't really complete anything
  }

  zstyle ':completion:*' completer \
    _oldlist _expand _force_rehash _complete ...

(where "..." is the rest of whatever you already have in that style).

> That works (meaning, it makes the shell behave as I want), but I was
> just hoping there was a simpler method, i.e. "setopt something".

Unfortunately, there's not.  Command completion uses the $command variable 
from the zsh/parameter module, which means it forces command hashing to 
occur even if you (un)set all the options that otherwise turn hashing off.

