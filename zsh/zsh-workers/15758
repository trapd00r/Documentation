From zsh-workers-return-15758-mason-zsh=primenet.com.au@sunsite.dk Sat Sep 08 15:34:52 2001
Return-Path: <zsh-workers-return-15758-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10735 invoked from network); 8 Sep 2001 15:34:51 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 8 Sep 2001 15:34:51 -0000
Received: (qmail 24112 invoked by alias); 8 Sep 2001 15:34:42 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15758
Received: (qmail 24100 invoked from network); 8 Sep 2001 15:34:40 -0000
Date: Sat, 8 Sep 2001 11:34:25 -0400
From: Clint Adams <clint@zsh.org>
To: Bart Schaefer <schaefer@brasslantern.com>
Cc: zsh-workers@sunsite.dk
Subject: Re: segfaults in 4.0.2
Message-ID: <20010908113425.A27879@dman.com>
References: <yu966au5zyv.fsf@cato.aoc.nrao.edu> <010907170335.ZM18221@candle.brasslantern.com> <20010908015928.A21707@dman.com> <1010908070005.ZM18696@candle.brasslantern.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <1010908070005.ZM18696@candle.brasslantern.com>; from schaefer@brasslantern.com on Sat, Sep 08, 2001 at 07:00:04AM +0000

> Doesn't for me, neither in 4.0.1 nor in the current 4.1.x CVS snapshot (I
> don't have an actual 4.0.2 handy).
> 
> Can you provide more details?

Yes.  It doesn't happen with -f.
I can reproduce it this way:

zsh -f
autoload -U promptinit ; promptinit
prompt ${${(z):-adam1 adam2 bigfade clint elite2}[RANDOM%5]}
coproc || echo test

Of the prompts I tried, only ``bart'' didn't facilitate a segfault.
I can't narrow down what the prompts do as causative.

Here's a backtrace:

#0  0x4011b31f in strlen () from /lib/libc.so.6
#1  0x80b0dda in taddstr (s=0x5cdabea8 <Address 0x5cdabea8 out of bounds>)
    at text.c:60
#2  0x80b156e in gettext2 (state=0xbffffcac) at text.c:322
#3  0x80b10bd in getjobtext (prog=0x40016168, c=0x40016188) at text.c:160
#4  0x8078ae2 in loop (toplevel=1, justonce=0) at init.c:153
#5  0x807b582 in zsh_main (argc=1, argv=0xbffffdcc) at init.c:1214
#6  0x8051826 in main (argc=1, argv=0xbffffdcc) at ./main.c:37

