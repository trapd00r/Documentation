From zsh-workers-return-5704-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Mar 09 12:55:36 1999
Return-Path: <zsh-workers-return-5704-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16211 invoked from network); 9 Mar 1999 12:55:34 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 9 Mar 1999 12:55:34 -0000
Received: (qmail 14178 invoked by alias); 9 Mar 1999 12:54:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5704
Received: (qmail 14171 invoked from network); 9 Mar 1999 12:54:58 -0000
Date: Tue, 9 Mar 1999 13:54:14 +0100 (MET)
Message-Id: <199903091254.NAA14116@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Tue, 9 Mar 1999 14:36:10 +0300
Subject: RE: PATCH: (was Re: _configure does not work)


Andrej Borsenkow wrote:

> After applying last patches (5696-5699) I get some strange results:
> 
> 1. bor@itsrm2:/tools/src/zsh-3.1.5-pws-11%> ./configure --pre<TAB>
> bor@itsrm2:/tools/src/zsh-3.1.5-pws-11%> ./configure --pre44
> fix=

Maybe I'm too tired today to fiddle with the code... this is the
output of an `echo' I had inserted for debugging.

> 2. l ~/.z/C<TAB>
>     Beep
> ~/.zsh.d/Completion exists and was correctly completed before a couple of
> last patches :-)

Hm, this works for me.

> 3. (I think, it changed recently)
> 
> ./configure --e-d<TAB>
> ./configure --enable-dynamic <^Xu> (bound to undo)
>                              ^cursor here (one blank after line)
> ./configure --enable-dynamic <^Xu>
>                              ^cursor still here
> ./configure --e-d
> 
> Well, IMHO ``--enable-dynamic '' (including blank) was inserted in _one_
> step and should be removed by _one_ command as well. And it was the case at
> least with 3-1.5-pws-10.

This is the auto-removable suffix. I faintly remember a discussion
about undoing and inserted suffixes where some people wanted to have
different `undo's for the suffix and the word. (If you don't see a auto-
removable suffix, just type a space, tab, or newline after the
`--enable-dynamic ').
So, what do (and others) think, should the first `undo' undo
everything, should this be done only if the suffix was a automatically
inserted space, should there be an option,...?

Bye
 Sven

--- oc/User/_long_options	Tue Mar  9 11:31:54 1999
+++ Completion/User/_long_options	Tue Mar  9 13:10:14 1999
@@ -89,7 +89,7 @@
 
   opts=("--${(@)^${(@)${(@)${(@M)${(@ps:\n:j:\n:)${(@)${(@M)${(@f)$("$words[1]" --help)}:#[ 	]#-*}//,/
 }}:#*--*}#*--}%%[, ]*}:#(*-[A-Z]*|)}")
-echo $#opts
+
   # The interpretation of the options is completely table driven. We
   # use the positional parameters we were given and a few standard
   # ones. Then we loop through this table.
@@ -298,7 +298,7 @@
     compadd -M 'r:|-=* r:|=*' -Q "$suffix[@]" -s "$str" - \
             "${(@P)name}" && ret=0
   elif [[ -z "$str" ]]; then
-    compadd -M 'r:|-=* r:|=*' -Q -s "$str" - \
+    compadd -M 'r:|-=* r:|=*' -Q - \
             "${(@P)name}" && ret=0
   fi
 done

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

