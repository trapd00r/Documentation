From zsh-users-return-6661-mason-zsh=primenet.com.au@sunsite.dk Tue Oct 07 15:40:29 2003
Return-Path: <zsh-users-return-6661-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10188 invoked from network); 7 Oct 2003 15:40:28 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 7 Oct 2003 15:40:28 -0000
Received: (qmail 28631 invoked by alias); 7 Oct 2003 15:40:04 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 6661
Received: (qmail 28610 invoked from network); 7 Oct 2003 15:40:03 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 7 Oct 2003 15:40:03 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [4.3.58.249] by sunsite.dk (MessageWall 1.0.8) with SMTP; 7 Oct 2003 15:40:3 -0000
Received: (from schaefer@localhost)
	by candle.brasslantern.com (8.11.6/8.11.6) id h97Fe1S06621
	for zsh-users@sunsite.dk; Tue, 7 Oct 2003 08:40:01 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <1031007154001.ZM6620@candle.brasslantern.com>
Date: Tue, 7 Oct 2003 15:40:01 +0000
In-Reply-To: <20031007105820.GA23911@tkd-fires-02.ja.jpmorgan.com>
Comments: In reply to Anthony Heading <aheading@jpmorgan.com>
        "startup delay from compinit" (Oct  7,  7:58pm)
References: <20031007105820.GA23911@tkd-fires-02.ja.jpmorgan.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-users@sunsite.dk
Subject: Re: startup delay from compinit
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Oct 7,  7:58pm, Anthony Heading wrote:
}
} I'd like to start using the "new" completion system, but
} running compinit from .zshrc seems to take about two seconds
[...]
} I'm using a 750Mhz Solaris sparcv9 machine). 

That's rather odd.  On my paltry 233MHz i586-linux PC, it takes on the
order of 1 second to run "compinit -D" (which explicitly skips and does
not recreate .zcompdump), about 2 seconds to run "compinit" when it is
creating .zcompdump, and less than 1 second when loading from .zcompdump
after it exists.  Starting from a fresh "zsh -f" every time and running
compinit by hand, that is.

Are you perhaps dealing with automounted NFS filesystems that frequently
expire and have to be remounted?

} I believe I've followed the instructions in zshcompsys, and
} have .zcompdump being created, and so on.  So am I doing something
} wrong, or is this time overhead to be expected?

If you want us to determine whether you're doing something wrong,
you'll have to show us exactly what you added to your .zshrc or other
startup files for this, not just tell us vaguely what you believe.

} If so, is there any alternative way to load all the completion
} functions lazily?

The functions themselves are all loaded lazily no matter what -- all
compinit does is create autoloads for them.  If anything is taking time,
it's scanning the directories to discover what functions are available.
That always happens unless you use "compinit -C", regardless of whether
the .zcompdump file exists.

Did you build and install zsh yourself?  Did you configure it with
--enable-function-subdirs?  It may be taking a lot longer to scan a
directory hierarchy than it would a flat directory -- you should try
--disable-function-subdirs, which is what I use, and see if that
speeds things up.

