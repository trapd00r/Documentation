From zsh-workers-request@math.gatech.edu  Fri Sep 22 04:08:43 1995
Received: from gatech.edu (gatech.edu [130.207.244.244]) by werple.mira.net.au (8.6.12/8.6.12) with SMTP id EAA17768 for <mason@werple.mira.net.au>; Fri, 22 Sep 1995 04:08:40 +1000
Received: from math (math.skiles.gatech.edu) by gatech.edu with SMTP id AA13081
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Thu, 21 Sep 1995 14:11:13 -0400
Received: by math (5.x/SMI-SVR4)
	id AA09441; Thu, 21 Sep 1995 14:05:05 -0400
Resent-Date: Thu, 21 Sep 1995 11:09:02 -0700
Old-Return-Path: <schaefer@z-code.ncd.com>
From: schaefer@z-code.com (Barton E. Schaefer)
Message-Id: <950921110903.ZM9297@zyrcon.z-code.com>
Date: Thu, 21 Sep 1995 11:09:02 -0700
In-Reply-To: schaefer@zyrcon.z-code.com (Barton E. Schaefer)
        "Re: input.c and here documents bugfixes" (Sep 21,  9:22am)
References: <199509211119.NAA20683@bolyai.cs.elte.hu> 
	<950921092241.ZM8730@zyrcon.z-code.com>
Reply-To: schaefer@z-code.com
X-Face: czU|*h"p8AX?4.I.yU.^s%TIMx|"-s,*'|#H^|e,QjE&!jL%<]:-.U/;khS%3a2BC5_d#)(
 mz=$$G0u9P&*N8cA~b[URf;lgKRif@#qEf[ltie#Gg0%6$b`e`k.Cgw:\qJx\\a7c(K7^3;gXW:e1@
 J<dlE"_MR!jLyY^_Ig[6-B#D2;B2V
X-Mailer: Z-Mail Lite (3.3dev.918 18sep95)
To: Zoltan Hidvegi  <hzoli@cs.elte.hu>,
        zsh-workers@math.gatech.edu (zsh-workers)
Subject: Re: input.c and here documents bugfixes
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-Id: <"xT_P31.0.RJ2.GbQOm"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/397
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

I think Zoltan's input.c patch was incorrect.  The exec.c part of the
patch is OK.  Here's the relevant bit:

--- Forwarded mail from Zoltan Hidvegi  <hzoli@cs.elte.hu>

*** 1.2	1995/09/19 17:57:52
--- Src/input.c	1995/09/20 11:04:22
***************
*** 274,283 ****
  {
      int l;
  
!     for (l = 0; l < n - 1; l++)
! 	if ((buf[l] = ingetc()) == '\n' || lexstop)
! 	    break;
!     buf[l + (lexstop ? 0 : 1)] = 0;
  
      return (!lexstop || l) ? buf : NULL;
  }
--- 274,283 ----
  {
      int l;
  
!     for (l = 0; l < n - 1 && (buf[l++] = ingetc()) != '\n' && !lexstop;)
!     if (lexstop)
! 	l--;
!     buf[l] = '\0';
  
      return (!lexstop || l) ? buf : NULL;
  }


--- End of forwarded mail from Zoltan Hidvegi  <hzoli@cs.elte.hu>

I don't know whether that's supposed to be "for (... && !lexstop;);" or
whether the "if (lexstop)" is intended to be part of the loop (as it is
as it stands), but either way it's wrong -- if it's not part of the loop,
it can decrement `l' to less than zero when n <= 1, and if it *is* part
of the loop, it fails to decrement `l' at all.

Zoltan, why did you change this code in the first place?

-- 
Bart Schaefer                     Vice President, Technology, Z-Code Software
schaefer@z-code.com                  Division of NCD Software Corporation
http://www.well.com/www/barts

