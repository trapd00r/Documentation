From zsh-users-return-13107-mason-zsh=primenet.com.au@sunsite.dk Thu Aug 07 07:34:15 2008
Return-Path: <zsh-users-return-13107-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24896 invoked from network); 7 Aug 2008 07:34:11 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 7 Aug 2008 07:34:11 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 54897 invoked from network); 7 Aug 2008 07:33:53 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 Aug 2008 07:33:53 -0000
Received: (qmail 29977 invoked by alias); 7 Aug 2008 07:33:31 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13107
Received: (qmail 29964 invoked from network); 7 Aug 2008 07:33:31 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 7 Aug 2008 07:33:31 -0000
Received: from elation.princeton.edu (elation.Princeton.EDU [128.112.144.224])
	by bifrost.dotsrc.org (Postfix) with ESMTP id DD6C08056E06
	for <zsh-users@sunsite.dk>; Thu,  7 Aug 2008 09:33:26 +0200 (CEST)
Received: from elation.Princeton.EDU (elation.Princeton.EDU [128.112.144.224])
	by elation.princeton.edu (Postfix) with ESMTP id 591C2377D013;
	Thu,  7 Aug 2008 03:33:03 -0400 (EDT)
Date: Thu, 7 Aug 2008 03:33:02 -0400 (EDT)
From: "Benjamin R. Haskell" <zsh@benizi.com>
To: Zsh Users <zsh-users@sunsite.dk>
Subject: Re: Multi-Minute Startup?
In-Reply-To: <c4e763ac0808070020r595f3b64u38eeefbc37bc85b6@mail.gmail.com>
Message-ID: <alpine.LNX.1.10.0808070327310.26055@elation.Princeton.EDU>
References: <c4e763ac0808062357g44f7b75amf30db12fc1535409@mail.gmail.com> <alpine.LNX.1.10.0808070254580.26055@elation.Princeton.EDU> <c4e763ac0808070020r595f3b64u38eeefbc37bc85b6@mail.gmail.com>
User-Agent: Alpine 1.10 (LNX 1032 2008-04-11)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed
X-Virus-Scanned: ClamAV 0.92.1/7966/Thu Aug  7 04:05:25 2008 on bifrost
X-Virus-Status: Clean

On Thu, 7 Aug 2008, Aaron Davies wrote:
> On Thu, Aug 7, 2008 at 3:00 PM, Benjamin R. Haskell <zsh@benizi.com> wrote:
>> On Thu, 7 Aug 2008, Aaron Davies wrote:
>>
>>> It takes zsh multiple minutes (around 3) to start up on a new server I 
>>> just got access to. I have no custom .z* files at this point, so all 
>>> that's running should be the /etc files, of which only /etc/zshenv and 
>>> /etc/zshrc are actually present. Any ideas what's likely to be slowing 
>>> me down so much?
>>
>> What O/S and architecture? (Not sure if it's relevant, but maybe Zsh 
>> doesn't run so fast on a 286.)
>
> linux on some fairly new enterprise server hardware. i don't think it's 
> the machine's fault. :)
>

Had ta ask... :-)


>> Try running zsh -x -l
>> -l makes it a login shell
>> -x is to trace commands as they're executed
>>
>> Maybe that will reveal a particular command that's taking a long time 
>> to execute.
>
> ah, looks like it's part of compaudit
>
> +compaudit:84> IFS=: +compaudit:84> read GROUP _i_pw _i_gid GROUPMEM
>
> is it trying to do something like read all users/groups from the
> authentication system for completion? that might explain it, as our
> directory server is 10,000 miles away. if that's the problem, is there
> a way to get rid of it without having write access to the /etc/z*
> files?
>

Something similar came up just under a month ago on this list:

==
Eric D. Friedman wrote:
Subject: new-style completion and large numbers of users

I'm using zsh 4.2.0 on a machine with a very large number of users. When I 
first log on and do a completion of any kind, it triggers a cache-load of 
all of the user names, which is quite time consuming. I'd like to disable 
that behavior but can't see how to do it.  The archives have some ideas 
for old style completion but I didn't see anything for the new system.
==

==
Angel Olivera replied:

You can make zsh complete just the usernames you will be more likely to 
use with

zstyle ':completion:*' users user1 user2

Not specifying any users will effectively disable login name completions. 
See zshcompsys(1) for a description of this style.
==

I forget the order of Zsh's startup files, but maybe you can slip a 
similar zstyle command into something that will run before your slow 
compaudit command that will prevent it from fetching all the groups.

Best,
Ben

