From zsh-workers-request@euclid.skiles.gatech.edu Mon Feb 10 10:53:04 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 20891 invoked from network); 10 Feb 1997 10:53:02 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 10 Feb 1997 10:53:02 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id FAA08684; Mon, 10 Feb 1997 05:45:40 -0500 (EST)
Resent-Date: Mon, 10 Feb 1997 05:45:40 -0500 (EST)
Message-Id: <199702101047.LAA12714@hydra.ifh.de>
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: Shared libraries on IRIX
Date: Mon, 10 Feb 1997 11:47:34 +0100
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"lHyDr2.0.d72.Jnl_o"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2886
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

I hadn't been able to get shared libraries to work on IRIX and I
think the following, from the dlopen(3) manual, was the problem.

     Objects loaded by a single invocation of dlopen may import symbols from
     one another or from any object loaded automatically during program
     startup, but objects loaded by one dlopen invocation may not directly
     reference symbols from objects loaded by a different dlopen invocation.
     Those symbols may, however, be referenced indirectly using dlsym.

This fits in with my experiences: problems happen when the zle module
is loaded, which depends on another module, comp1.  The latter loads
all right but zle starts acting strangely straight away (the address
for the init routine is not sensible) and the shell crashes on entry
to zleread().

Looking at the code in the light of this, it will make things very
hard for zle add-on modules even if zle were loaded in one go.  I
suspect that (for IRIX and perhaps others) it's going to be necessary
to have zle hard-wired, at least until it's possible to restrict
modules to a pre-defined set of hooks into zle.

Anyway, I added comp1 and zle to modules-bltin by hand and everything
else seems fine with dynamic loading.  This should therefore become
the default for IRIX, even with --dynamic; I couldn't see code for it
in configure.in, though.

-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77413
Deutsches Elektronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.

