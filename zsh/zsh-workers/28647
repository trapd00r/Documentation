From zsh-workers-return-28647-mason-zsh=primenet.com.au@zsh.org Sun Jan 23 21:02:21 2011
Return-Path: <zsh-workers-return-28647-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26514 invoked by alias); 23 Jan 2011 21:02:21 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28647
Received: (qmail 2161 invoked from network); 23 Jan 2011 21:02:19 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-3.3 required=5.0 tests=BAYES_00,DKIM_ADSP_CUSTOM_MED,
	FREEMAIL_FROM,NML_ADSP_CUSTOM_MED,RCVD_IN_DNSWL_MED autolearn=ham
	version=3.3.1
Received-SPF: neutral (ns1.primenet.com.au: 128.2.11.96 is neither permitted nor denied by SPF record at _spf.google.com)
Date: Sun, 23 Jan 2011 15:37:02 -0500
From: gi1242+zsh@gmail.com
To: Mikael Magnusson <mikachu@gmail.com>
Cc: zsh-workers@zsh.org
Subject: Re: _arguments: Sets not working?
Message-ID: <20110123203702.GD2593@andrew.cmu.edu>
Mail-Followup-To: gi1242+zsh@gmail.com,
	Mikael Magnusson <mikachu@gmail.com>, zsh-workers@zsh.org
References: <20110123174508.GC2593@andrew.cmu.edu> <AANLkTinifNrj_M7ycR06y9cpawy5nJdyBpY30XvcsUc0@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="pf9I7BMVVzbSWLtt"
Content-Disposition: inline
In-Reply-To: <AANLkTinifNrj_M7ycR06y9cpawy5nJdyBpY30XvcsUc0@mail.gmail.com>
User-Agent: Mutt/1.5.18 (2008-05-17)
X-PMX-Version: 5.5.9.388399, Antispam-Engine: 2.7.2.376379, Antispam-Data: 2010.4.9.4220
X-SMTP-Spam-Clean: 40% (
 RDNS_SUSP_FORGED_FROM 3.5, HASHBUSTER_BLOCK_V2 0.5, FORGED_FROM_GMAIL 0.1, MIME_TEXT_ONLY_MP_MIXED 0.05, BODY_SIZE_5000_5999 0, BODY_SIZE_7000_LESS 0, NO_REAL_NAME 0, RDNS_BROADBAND 0, RDNS_GENERIC_POOLED 0, RDNS_POOLED 0, RDNS_SUSP 0, RDNS_SUSP_GENERIC 0, RDNS_SUSP_SPECIFIC 0, __BOUNCE_CHALLENGE_SUBJ 0, __BOUNCE_NDR_SUBJ_EXEMPT 0, __CD 0, __CP_MEDIA_BODY 0, __CT 0, __CTYPE_HAS_BOUNDARY 0, __CTYPE_MULTIPART 0, __CTYPE_MULTIPART_MIXED 0, __FRAUD_CONTACT_NAME 0, __FRAUD_WEBMAIL 0, __FRAUD_WEBMAIL_FROM 0, __FROM_GMAIL 0, __HASHBUSTER_BLOCK_V2_1 0, __HAS_MSGID 0, __MIME_TEXT_ONLY 0, __MIME_VERSION 0, __PHISH_SPEAR_STRUCTURE_1 0, __RDNS_BROADBAND_5 0, __RDNS_POOLED_11 0, __SANE_MSGID 0, __TO_MALFORMED_2 0, __USER_AGENT 0)
X-SMTP-Spam-Score: 40%
X-Scanned-By: MIMEDefang 2.60 on 128.2.11.96

--pf9I7BMVVzbSWLtt
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

On Sun, Jan 23, 2011 at 07:51:25PM +0100, Mikael Magnusson wrote:

>> It looks like argument sets separated by single hyphens are not working.
>> You can see the bug by trying to complete arguments of 'vncserver'. When
>> you ask for completions, none are returned. [Behaviour persists in
>> latest release from Git]
>>
> FWIW, the completion appears to work fine here. If i specify -help, no
> other completions are offered, and same for -kill or the other set as
> well. I even found i still had an Xvnc process running from a few
> weeks ago when i pressed tab again after -kill :).

Thanks Peter/Mikael for looking into it and confirming it works on your
system. I found the problem was that I had

    alias vncserver='\vncserver -localhost -nolisten tcp'

in my .zshrc. The completer didn't know about -nolisten option, and so
was refusing to complete anything else for me.

I guess this is because the Xvnc options were missing from the
completer. I added them, and am attaching them to this message (diff
-u),

Thanks again,

GI

-- 
A topologist is a person who doesn't know the difference between a
coffee cup and a doughnut.

--pf9I7BMVVzbSWLtt
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="_vnc.Xvnc-options.patch"

--- /free/tmp/src/zsh/Completion/X/Command/_vnc	2011-01-15 20:53:15.635331696 -0500
+++ _vnc	2011-01-23 15:28:37.489848153 -0500
@@ -6,13 +6,78 @@
 
 case $service in
   vncserver)
-    # currently lacking Xvnc arguments
+    # currently missing: bc, c, nologo, r, ttyxx, v
+    # Don't know values for -nolisten (other than tcp).
     _arguments \
       - start \
 	'-name:desktop name:_x_name' \
+	'-a[mouse acceleration (pixels)]:#:' \
+	'-ac[disable access control restrictions]' \
+	'-audit[set audit trail level]:int:' \
+	'-auth[select authorization file]:file:_files' \
+	'-bs[disable any backing store support]' \
+	'-c[turns off key-click]' \
+	'-cc[default color visual class]:int:' \
+	'-co[color database file]:file:_files' \
+	'-core[generate core dump on fatal error]' \
+	'-dpi[screen resolution in dots per inch]:int:' \
+	'-deferglyphs[defer loading of glyphs]:type:(none all 16)' \
+	'-f[bell base]:level (0-100):' \
+	'-fc[cursor font]:string:' \
+	'-fn[default font name]:string:' \
+	'-fp[default font path]:string:' \
+	'-help[prints message with these options]' \
+	'-I[ignore all remaining arguments]' \
+	'-ld[limit data space to N Kb]:int:' \
+	'-lf[limit number of open files to N]:int:' \
+	'-ls[limit stack space to N Kb]:int:' \
+	'-nolock[disable the locking mechanism]' \
+	'-logo[enable logo in screen saver]' \
+	'-nolisten[dont listen on protocol]:protocol:(tcp)' \
+	'-p[screen-saver pattern duration (minutes)]:time (minutes):' \
+	'-pn[accept failure to listen on all ports]' \
+	'-nopn[reject failure to listen on all ports]' \
+	'-r[turns off auto-repeat]' \
+	'-s[screen-saver timeout (minutes)]:timeout (minutes):' \
+	'-su[disable any save under support]' \
+	'-t[mouse threshold]:pixels:' \
+	'-terminate[terminate at server reset]' \
+	'-to[connection time out]:time:' \
+	'-tst[disable testing extensions]' \
+	'-v[screen-saver without video blanking]' \
+	'-wm[WhenMapped default backing-store]' \
+	'-x[loads named extension at init time ]:string:' \
+	'-query[contact named host for XDMCP]:host-name:_hosts' \
+	'-broadcast[broadcast for XDMCP]' \
+	'-indirect[contact named host for indirect XDMCP]:host-name:_hosts' \
+	'-port[UDP port number to send messages to]:port:' \
+	'-once[Terminate server after one session]' \
+	'-class[specify display class to send in manage]:display-class:' \
+	'-cookie[specify the magic cookie for XDMCP]:xdm-auth-bits:' \
+	'-displayID[manufacturer display ID for request]:display-id:' \
 	'-geometry:geometry:(1600x1200 1280x1024 1152x864 1024x768 800x600 640x480)' \
 	'-depth:pixel depth:(8 16 24 32)' \
 	'-pixelformat:pixel format' \
+	'-udpinputport[UDP port for keyboard/pointer data]:port:' \
+	'-rfbport[TCP port for RFB protocol]:port:' \
+	'-rfbwait[max time in ms to wait for RFB client]:time:' \
+	'-nocursor[dont put up a cursor]' \
+	'-rfbauth[use authentication on RFB protocol]:passwd-file:_files' \
+	'-httpd[serve files via HTTP from here]:dir:_files -/' \
+	'-httpport[port for HTTP]:port:' \
+	'-deferupdate[time in ms to defer updates (default 40)]:time (ms):' \
+	'-economictranslate[less memory-hungry translation]' \
+	'-lazytight[disable "gradient" filter in tight encoding]' \
+	'-desktop[VNC desktop name (default x11)]:name:' \
+	'-alwaysshared[always treat new clients as shared]' \
+	'-nevershared[never treat new clients as shared]' \
+	'-dontdisconnect[dont disconnect existing clients for new non-shared connections]' \
+	'-viewonly[let clients only to view the desktop]' \
+	'-localhost[only allow connections from localhost]' \
+	'-interface[only bind to specified interface address]:ipaddr:' \
+	'-inetd[Xvnc is launched by inetd]' \
+	'-compatiblekbd[set META key = ALT key as in the original VNC]' \
+	'-version[report Xvnc version on stderr]' \
 	'1:: :_guard "(|:[0-9]#)" "display number"' \
       - kill \
 	"-kill:display number:($displays)" \

--pf9I7BMVVzbSWLtt--

