From zsh-workers-return-8793-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Nov 26 22:09:00 1999
Return-Path: <zsh-workers-return-8793-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19030 invoked from network); 26 Nov 1999 22:08:58 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 26 Nov 1999 22:08:58 -0000
Received: (qmail 7365 invoked by alias); 26 Nov 1999 22:08:54 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8793
Received: (qmail 7358 invoked from network); 26 Nov 1999 22:08:53 -0000
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: PATCH: 3.1.6-pws-9: use heap in printjobs
Date: Fri, 26 Nov 1999 22:09:14 +0000
From: Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Message-Id: <E11rTXw-0007tC-00.1999-11-26-22-08-52@mail1.svr.pol.co.uk>

This fixes an error message about using permanent allocation when
a background job exits and the notify message is printed.

--- Src/jobs.c.uh	Wed Oct  6 18:58:17 1999
+++ Src/jobs.c	Wed Nov 24 20:37:35 1999
@@ -548,8 +548,11 @@
     if (j->stat & STAT_TIMED)
 	return 1;
 
-    if (!(v = getvalue(&s, 0)) || (reporttime = getintvalue(v)) < 0)
-	return 0;
+    HEAPALLOC {
+	if (!(v = getvalue(&s, 0)) || (reporttime = getintvalue(v)) < 0) {
+	    LASTALLOC_RETURN 0;
+	}
+    } LASTALLOC;
 
     /* can this ever happen? */
     if (!j->procs)

-- 
Peter Stephenson <pws@pwstephenson.fsnet.co.uk>

