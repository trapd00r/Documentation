From zsh-workers-return-16678-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 20 19:31:00 2002
Return-Path: <zsh-workers-return-16678-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21582 invoked from network); 20 Feb 2002 19:30:59 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 20 Feb 2002 19:30:59 -0000
Received: (qmail 29998 invoked by alias); 20 Feb 2002 19:30:53 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16678
Received: (qmail 29984 invoked from network); 20 Feb 2002 19:30:52 -0000
Date: Wed, 20 Feb 2002 11:30:21 -0800 (PST)
From: Wayne Davison <wayned@users.sourceforge.net>
X-X-Sender:  <wayne@phong.blorf.net>
To: Peter Stephenson <pws@csr.com>
Cc: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: Bug in history changes
In-Reply-To: <5921.1014224430@csr.com>
Message-ID: <Pine.LNX.4.33L2.0202201125400.23437-100000@phong.blorf.net>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Wed, 20 Feb 2002, Peter Stephenson wrote:
> The latest version of the history code is causing zcalc to crash.

I'm ashamed to say that my last patch still left a stupid bug in
prepnexthistent().  I just committed the following fix to CVS.

..wayne..

---8<------8<------8<------8<---cut here--->8------>8------>8------>8---
Index: Src/hist.c
--- Src/hist.c	18 Feb 2002 19:25:25 -0000	1.41
+++ Src/hist.c	20 Feb 2002 19:22:20 -0000
@@ -971,7 +971,8 @@
     }
     else {
 	putoldhistentryontop(0);
-	freehistdata(he = hist_ring, 0);
+	freehistdata(hist_ring, 0);
+	he = hist_ring;
     }
     he->histnum = ++curhist;
     if (curline_in_ring)
---8<------8<------8<------8<---cut here--->8------>8------>8------>8---

