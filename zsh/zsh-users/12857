From zsh-users-return-12857-mason-zsh=primenet.com.au@sunsite.dk Sun May 18 19:57:24 2008
Return-Path: <zsh-users-return-12857-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4505 invoked from network); 18 May 2008 19:57:22 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 18 May 2008 19:57:22 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 48609 invoked from network); 18 May 2008 19:57:12 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 18 May 2008 19:57:12 -0000
Received: (qmail 14844 invoked by alias); 18 May 2008 19:57:02 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12857
Received: (qmail 14811 invoked from network); 18 May 2008 19:57:01 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 18 May 2008 19:57:01 -0000
Received: from elation.princeton.edu (elation.Princeton.EDU [128.112.144.224])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 9E8CA80589A4
	for <zsh-users@sunsite.dk>; Sun, 18 May 2008 21:56:56 +0200 (CEST)
Received: from [192.168.1.103] (pool-70-20-73-235.pitbpa.east.verizon.net [70.20.73.235])
	by elation.princeton.edu (Postfix) with ESMTP id 0C0581E02D698
	for <zsh-users@sunsite.dk>; Sun, 18 May 2008 15:48:35 -0400 (EDT)
Date: Sun, 18 May 2008 15:58:24 -0400 (EDT)
From: "Benjamin R. Haskell" <zsh@benizi.com>
To: Zsh Users <zsh-users@sunsite.dk>
Subject: Re: Question on filename completion
In-Reply-To: <080518120311.ZM4212@torch.brasslantern.com>
Message-ID: <alpine.LNX.1.10.0805181551410.9622@transport>
References: <d53cb3110805181023p1e823d8drb196db9e52f79b33@mail.gmail.com> <080518120311.ZM4212@torch.brasslantern.com>
User-Agent: Alpine 1.10 (LNX 1032 2008-04-11)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed
X-Virus-Scanned: ClamAV 0.91.2/7151/Sun May 18 20:36:29 2008 on bifrost
X-Virus-Status: Clean

On Sun, 18 May 2008, Bart Schaefer wrote:

> On May 18, 10:53pm, Gowtham M wrote:
> }
> } When I hit tab at
> } zsh> ls /some/path/to/something/761/xyz/_  # Tab is hit when cursor is at _
> }
> } zsh spends a lot of time in stat64()ing all the directories from
> } /some/path/to/something/0 to /some/path/to/something/9999
> }
> } I do not understand why this is required to complete the filename
> } after /some/path/to/something/761/xyz
>
> This is _path_files at work.  Try typing
>
>    zsh> ls /s/p/t/s<TAB>
>
> and you'll find that it gets competed to
>
>    zsh> ls /some/path/to/something/
>
> On any given completion attempt, _path_files doesn't know whether any
> path component might be only part of a directory name which, if it were
> completed, would lead to additional matches among the sub-directories,
> etc.  So it re-scans the whole hierarchy.
>
> One way to prevent this from happening for hierarchies that you know
> to be very broad is:
>
>  zstyle ':completion:*' preserve-prefix '/some/path/to/something/*/'
>
> That's not really the intended use of preserve-prefix but it has the
> desired effect.  Note that preserve-prefix is a single string, not a
> list of patterns (too bad, really) so if you want to use it for more
> than one pattern, you have to construct the alternatives yourself:
>
>  zstyle ':completion:*' preserve-prefix \
>      '(/|?:|/some/path/to/something/*|/another/large/dir/*)/'
>
> The preserve-prefix pattern is matched against a string, not against
> files on disk, so it can have slashes inside the parens and cannot
> use glob qualifiers that test file attributes.
>
>

Oops, sorry for the noise. Didn't see this due to mail delay. Is there a 
simple way to disable this completely? I tend to do something like:

/s<Tab>/p<Tab>/to/s<Tab>

to get /some/path/to/something. And, I suppose this is also what causes 
this confusing behavior:

$ tree dir*
dir
dira
`-- only_file
$ <dir/<Tab>
$ <dira/only_file

i.e. trying to tab-complete a file in an empty directory whose name 
happens to be the prefix of another will bring up files in the other 
directory.

Best,
Ben

