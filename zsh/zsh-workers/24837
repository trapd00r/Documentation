From zsh-workers-return-24837-mason-zsh=primenet.com.au@sunsite.dk Fri Apr 18 09:40:52 2008
Return-Path: <zsh-workers-return-24837-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21214 invoked from network); 18 Apr 2008 09:40:49 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 18 Apr 2008 09:40:49 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 60578 invoked from network); 18 Apr 2008 09:40:40 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 18 Apr 2008 09:40:40 -0000
Received: (qmail 25693 invoked by alias); 18 Apr 2008 09:40:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24837
Received: (qmail 25673 invoked from network); 18 Apr 2008 09:40:36 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 18 Apr 2008 09:40:36 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [85.115.41.190])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 611208043AC7
	for <zsh-workers@sunsite.dk>; Fri, 18 Apr 2008 11:40:31 +0200 (CEST)
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly04g.srv.mailcontrol.com (MailControl) with ESMTP id m3I9eHvE002029
	for <zsh-workers@sunsite.dk>; Fri, 18 Apr 2008 10:40:20 +0100
Received: from news01 ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Fri, 18 Apr 2008 10:40:17 +0100
Date: Fri, 18 Apr 2008 10:40:16 +0100
From: Peter Stephenson <pws@csr.com>
To: zsh-workers@sunsite.dk
Subject: Re: PATCH: (large) initial support for combining characters in ZLE.
Message-ID: <20080418104016.3cf8d12b@news01>
In-Reply-To: <9F0DCF1B-F5FB-4150-A4FF-C441DE615404@kba.biglobe.ne.jp>
References: <20080413175442.0e95a241@pws-pc>
	<9F0DCF1B-F5FB-4150-A4FF-C441DE615404@kba.biglobe.ne.jp>
Organization: CSR
X-Mailer: Claws Mail 3.3.1 (GTK+ 2.12.5; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-OriginalArrivalTime: 18 Apr 2008 09:40:17.0055 (UTC) FILETIME=[35A8BAF0:01C8A138]
X-Scanned-By: MailControl A-08-00-05 (www.mailcontrol.com) on 10.71.0.114
X-Virus-Scanned: ClamAV 0.91.2/6818/Fri Apr 18 10:28:41 2008 on bifrost
X-Virus-Status: Clean

On Fri, 18 Apr 2008 03:33:36 +0900
"Jun T." <takimoto-j@kba.biglobe.ne.jp> wrote:
> At 17:54 +0100 08.4.13, Peter Stephenson wrote:
>  >the base character must be an alphanumeric (and
>  >I'm not sure about the numeric, I need to find a better definition), =20
> and
>=20
> I think this is too restrictive, because in some Asian languages
> (Japanese, Korean, Thai, etc.) the base character can be non-alphaget.
> For example, in Japanese, Hiragana/Katakana can be combined with
> U+3099 (VOICED SOUND MARK) or U+309A (SEMI-VOICED SOUND MARK).
> Example: U+3057 U+3099 =3D "=E3=81=98"
> the base character U+3057 =3D "=E3=81=97" is not an alphanumeric.

It's treated as alphanumeric here, but what you say doesn't surprise me.  I
think we can widen it without problems to anything that isn't a whitespace
or a control character, at least, so iswgraph() might be the thing.  We
definitely need to avoid special whitespace characters (tabs, feeds,
newline, carriage return) since we don't know what's going to happen.
Also, as far as I can see marking a character as "control" is a signal not
to print it directly.

>  >the zero-width characters afterwards (I haven't imposed a limit on how
>  >many there are) must be punctuation.
>=20
> I guess this is also too restrictive. I have run the code like the =20
> following
> on Fedora7:
>=20
> wchar_t w;
> setlocale(LC_ALL,"");
> for(w=3D1; w<0x2ffff; ++w) {
> 	if(wcwidth(w)=3D=3D0 && iswpunct(w)=3D=3D0) {
> 		printf("%05x: %lc\n",w,w);
> 	}
> }
>=20
> It listed 166 characters, all of which seem to be combining chars in
> Thai or Korean (U+0e4e and U+1160 may not be combining, I'm not sure).

Probably looking for a graphic zero width character is good enough.
There may not be control character with zero width, anyway.

--=20
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

