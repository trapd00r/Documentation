From zsh-users-return-2446-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Jul 19 12:16:41 1999
Return-Path: <zsh-users-return-2446-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8574 invoked from network); 19 Jul 1999 12:16:39 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 19 Jul 1999 12:16:39 -0000
Received: (qmail 29390 invoked by alias); 19 Jul 1999 12:16:15 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 2446
Received: (qmail 29383 invoked from network); 19 Jul 1999 12:16:14 -0000
Message-Id: <9907191145.AA18364@ibmth.df.unipi.it>
To: Zsh Users <zsh-users@sunsite.auc.dk>
Subject: Re: ssh compctl 
In-Reply-To: "Bek Oberin"'s message of "Mon, 19 Jul 1999 20:54:36 DFT."
             <19990719205436.F29765@tertius.net.au> 
Date: Mon, 19 Jul 1999 13:45:18 +0200
From: Peter Stephenson <pws@ibmth.df.unipi.it>

Bek Oberin wrote:
> 
> I want to get ssh to complete either user@host or host.  I've figured
> out the former, with much rtfm'ing, but not the latter ... how can I
> give it alternates?

You're supposed to be able to do it with `+', as follows:

compctl -k users -S @ -x 'n[1,@]' -k hosts -- + -k hosts ssh

Maybe the section in the FAQ is clearer about alternatives than the manual,
but maybe not.

The new completion (Completion/User/_rlogin) should probably do this better
too.

--- Completion/User/_rlogin~	Wed Jul 14 13:57:32 1999
+++ Completion/User/_rlogin	Mon Jul 19 13:42:54 1999
@@ -1,9 +1,15 @@
 #compdef rlogin rsh ssh
 
-if [[ CURRENT -eq 2 ]]; then
-  _hosts
+if [[ CURRENT -eq 2 ]];
+  if compset -P 1 '*@'; then
+   _hosts
+  else
+    local nm=${compstate[nmatches]}
+    _hosts
+    [[ nm -eq compstate[nmatches] ]] && compgen -S @ -u
+  fi
 elif [[ CURRENT -eq 3 ]]; then
   compadd - -l
 else
-  compgen -u
+  compgen -S @ -u
 fi


-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

