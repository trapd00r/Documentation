From zsh-workers-return-8547-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Nov 04 19:12:34 1999
Return-Path: <zsh-workers-return-8547-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9296 invoked from network); 4 Nov 1999 19:12:33 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 4 Nov 1999 19:12:33 -0000
Received: (qmail 14202 invoked by alias); 4 Nov 1999 19:12:28 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8547
Received: (qmail 14194 invoked from network); 4 Nov 1999 19:12:27 -0000
Message-ID: <3821DA96.47D9E718@u.genie.co.uk>
Date: Thu, 04 Nov 1999 19:12:23 +0000
From: Oliver Kiddle <opk@u.genie.co.uk>
X-Mailer: Mozilla 4.7 [en] (Win95; I)
X-Accept-Language: en
MIME-Version: 1.0
To: Zsh workers <zsh-workers@sunsite.auc.dk>
Subject: PATCH: AIX .export files
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

I had a go at compiling 3.1.6-bart-8 on AIX. The first problem I had
was with the standard AIX awk. I got this error:

 awk -f ../../Src/makepro.awk parameter.c Src/Modules > parameter.pro
awk: 0602-564 Format item static void shempty  cannot be longer than
3,000 bytes.
 The input line number is 1756. The file is parameter.c.
 The source line number is 179.

The generated parameter.pro was fine up to and including the blank line
after the '#ifndef GLOBAL_PROTOTYPES' line. I was able to create it by
transfering the file to a linux machine and using gawk. Has anyone got
any thoughts on what the problem is - my guess is a limitation of AIX
awk. Can parameter.c be changed to avoid it?

I've also attached a patch to the .export files for compiling on AIX.
I'm not sure that all the symbols are in the right file as some shared
objects link against more than one shared object so I didn't know where
the unresolved symbols came from. I had a brief look at how perl handles
the AIX export files. It seems to generate them automatically from .h
files. Can we do something like this with our .h and .pro files?

Anyway, the new zsh seg faulted every time I pressed tab to complete. I
recompiled it with -g to try to find out why but compiled with -g it
didn't seg fault. Maybe the problem was my piece-by-piece build as I
constructed the .export files from the ld error messages.

--- zle.export.bak	Tue Oct 19 00:30:27 1999
+++ zle.export	Thu Nov  4 18:57:07 1999
@@ -3,6 +3,7 @@
 addzlefunction
 amatches
 asklist
+autoq
 backdel
 backkill
 bindk
@@ -10,12 +11,21 @@
 brbeg
 brend
 calclist
+cfargs
+cfret
 clearflag
 clearlist
 clearscreen
+clwnum
+clwords
+clwpos
+cmdstr
+compfunc
+compwidget
 deletezlefunction
 do_menucmp
 do_single
+dupstrspace
 fixsuffix
 foredel
 forekill
@@ -23,42 +33,84 @@
 getkey
 getkeycmd
 getzlequery
+hascompmod
 hasoldlist
 hasperm
+inbackt
+incompfunc
+instring
+inststrlen
+insubscr
 invalidatelist
+iremovesuffix
 lastambig
-lastmatches
+lastbrbeg
+lastbrend
+lastcmd
 lastlmatches
+lastmatches
+lastpostbr
+lastprebr
 lbindk
+linarr
+lincmd
 linkkeymap
+linredir
 listdat
 listshown
 lmatches
+makeparamsuffix
+makesuffix
+makesuffixstr
+makezleparams
 menuacc
 menucmp
 menucomplete
+metafy_line
 minfo
+nbrbeg
+nbrend
 newkeymap
 nlnct
 nmatches
+offs
 onlyexpl
+origcs
+origline
+origll
+pfxlen
 pmatches
 printfmt
 printlist
+qipre
+qisuf
+rdstr
 redisplay
 refthingy
 reversemenucomplete
 selectlocalmap
+showagain
 showinglist
 skipnolist
 spaceinline
+strbpcmp
+strbpcmp
+suffixlen
 tcmultout
 tcout
 thingies
 trashzle
 ungetkeycmd
 unlinkkeymap
+unmetafy_line
+useglob
+usemenu
 validlist
+varedarg
+varname
+wb
+we
+zlehooks
 zlenoargs
 zmod
 zrefresh
--- /dev/null	Thu Nov  4 18:38:43 1999
+++ complete.export	Thu Nov  4 18:58:00 1999
@@ -0,0 +1,126 @@
+#!
+accept_last
+addexpl
+addzlefunction
+add_bmatchers
+add_match_data
+allccs
+amatches
+asklist
+autoq
+begcmgroup
+bindkey
+bmatchers
+brbeg
+brend
+calclist
+check_param
+clearflag
+clearlist
+clearscreen
+clwnum
+clwords
+clwpos
+clwsize
+cmatcher
+cmdstr
+compcurrent
+compheap
+compisuffix
+complastprompt
+comppatmatch
+compprefix
+compqiprefix
+compqisuffix
+compquote
+compsuffix
+compwords
+comp_match
+comp_str
+cpcmatcher
+ctokenize
+curexpl
+deletezlefunction
+do_menucmp
+do_single
+dupbrinfo
+dupstrspace
+endcmgroup
+fixsuffix
+foredel
+freebrinfo
+freecmatcher
+freematches
+getkeycmd
+get_user_var
+hasmatched
+hasoldlist
+haspattern
+ignore_prefix
+ignore_suffix
+inbackt
+incompctlfunc
+incompfunc
+instring
+insubscr
+invalidate_list
+ipre
+ispar
+ispattern
+isuf
+keypm
+lastambig
+lastbrbeg
+lastbrend
+lastlmatches
+lastmatches
+linkkeymap
+linredir
+linwhat
+listdat
+listshown
+matchers
+matches
+menuacc
+menucmp
+menucomplete
+mflags
+minfo
+mnum
+mstack
+nbrbeg
+nbrend
+newkeymap
+nlnct
+nmatches
+offs
+onlyexpl
+parse_cmatcher
+pfxlen
+pmatches
+printfmt
+printlist
+qipre
+qisuf
+redisplay
+refthingy
+rembslash
+restrict_range
+reversemenucomplete
+ripre
+selectlocalmap
+set_gmatcher
+set_list_array
+showinglist
+spaceinline
+thingies
+thingytab
+ungetkeycmd
+unlinkkeymap
+update_bmatchers
+usemenu
+validlist
+wb
+we
+zlenoargs
+zrefresh
--- zsh.export.bak	Sun Sep 26 22:51:25 1999
+++ zsh.export	Thu Nov  4 18:58:42 1999
@@ -1,5 +1,4 @@
 #!
-SHTTY
 addbuiltins
 addconddefs
 addedx
@@ -10,14 +9,17 @@
 addmathfunc
 addmathfuncs
 addparamdefs
+adduserdir
 addwrapper
-arrvargetfn
-arrvarsetfn
 aliastab
+alloc
 alloc_stackp
 appstr
 arrdup
 arrlen
+arrsetfn
+arrvargetfn
+arrvarsetfn
 attachtty
 bangchar
 bin_notavail
@@ -33,15 +35,16 @@
 cmdnamtab
 columns
 compctlreadptr
+condtab
 cond_match
 cond_str
 cond_val
-condtab
 convbase
 coprocin
 coprocout
 countlinknodes
 countprompt
+createaliasnode
 createparam
 ctxtlex
 curhist
@@ -78,9 +81,9 @@
 fallback_zleread
 fetchvalue
 fignore
-file_type
 filesub
 filesubstr
+file_type
 findcmd
 freearray
 freeheap
@@ -102,13 +105,12 @@
 getsparam
 getstrvalue
 gettempname
-glob_pre
-glob_suf
 global_heapalloc
 global_permalloc
 globlist
+glob_pre
+glob_suf
 gotwordptr
-has_token
 hasam
 hashcmd
 hasher
@@ -116,6 +118,7 @@
 hashsetfn
 hasspecial
 haswilds
+has_token
 hcalloc
 hgetc
 hgetline
@@ -142,6 +145,7 @@
 inwhat
 isfirstln
 jobtab
+keymapnamtab
 lastpid
 lastval
 lchdir
@@ -164,10 +168,10 @@
 mypid
 nameddirtab
 ncalloc
-new_heaps
 newhashtable
 newlinklist
 newparamtable
+new_heaps
 nicechar
 nicezputs
 niceztrdup
@@ -185,8 +189,8 @@
 paramtab
 parbegin
 parend
-parse_string
 parsestr
+parse_string
 patcompile
 path
 pathchecked
@@ -196,6 +200,7 @@
 ppid
 prefork
 prepromptfns
+printfmt
 printif
 printparamnode
 printqt
@@ -235,6 +240,7 @@
 shout
 shttyinfo
 sigfuncs
+sigmsg
 sigtrapped
 singsub
 skipparens
@@ -255,11 +261,13 @@
 strvargetfn
 strvarsetfn
 switch_heaps
+SHTTY
 tclen
 tcstr
 termflags
-thisjob
 tgoto
+thingytab
+thisjob
 tok
 tokenize
 tokstr
@@ -315,4 +323,5 @@
 ztrftime
 ztrlen
 ztrsub
+zwarn
 zwarnnam

