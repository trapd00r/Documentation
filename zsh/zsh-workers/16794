From zsh-workers-return-16794-mason-zsh=primenet.com.au@sunsite.dk Mon Mar 11 05:33:33 2002
Return-Path: <zsh-workers-return-16794-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7150 invoked from network); 11 Mar 2002 05:33:32 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 11 Mar 2002 05:33:32 -0000
Received: (qmail 18472 invoked by alias); 11 Mar 2002 05:33:26 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16794
Received: (qmail 18461 invoked from network); 11 Mar 2002 05:33:25 -0000
Date: Mon, 11 Mar 2002 00:32:41 -0500
From: Clint Adams <clint@zsh.org>
To: zsh-workers@sunsite.dk
Subject: Y test failures (zpty)
Message-ID: <20020311053241.GA9027@dman.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.3.27i

Y01completion hangs for me.

+comptestinit:7> zmodload -i zsh/zpty
+comptestinit:9> comptest_zsh=zsh
+comptestinit:11> getopts z: opt
+comptestinit:12> case z (z)
+comptestinit:13> comptest_zsh=/home/clint/tmp/zsh/Test/../Src/zsh
+comptestinit:11> getopts z: opt
+comptestinit:16> ((  OPTIND > 1  ))
+comptestinit:16> shift 2
+comptestinit:18> export PS1=<PROMPT>
+comptestinit:19> zpty zsh /home/clint/tmp/zsh/Test/../Src/zsh -f +Z
+comptestinit:21> zpty -r zsh log1 *<PROMPT>*

The child zsh process shows as defunct.  Linux kernel is 2.4.17, glibc
is 2.2.5, zsh is current CVS.

As another datapoint, someone (whose complaints led me to run make check
in the first place), running Linux 2.4.19pre1, glibc 2.2.4, zsh 4.0.4,
gets the following, in addition to such errors for Y02 and Y03.

./Y01completion.ztst: starting.
comptestinit:zpty:19: can't open pseudo terminal: bad file descriptor
comptestinit:zpty:21: no such pty command: zsh
Test ./Y01completion.ztst failed: non-zero status from preparation code:
  comptestinit -z $ZTST_testdir/../Src/zsh &&
{
    mkdir dir1
    mkdir dir2
    touch file1
    touch file2
  }
./Y01completion.ztst: test failed.

Any ideas what's going on?

