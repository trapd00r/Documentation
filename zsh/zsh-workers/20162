From zsh-workers-return-20162-mason-zsh=primenet.com.au@sunsite.dk Thu Jul 15 05:52:23 2004
Return-Path: <zsh-workers-return-20162-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17098 invoked from network); 15 Jul 2004 05:52:23 -0000
Received: from odin.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.85)
  by ns1.primenet.com.au with SMTP; 15 Jul 2004 05:52:23 -0000
Received: (qmail 19732 invoked from network); 15 Jul 2004 05:57:08 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 15 Jul 2004 05:57:08 -0000
Received: (qmail 21532 invoked by alias); 15 Jul 2004 05:52:00 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20162
Received: (qmail 21522 invoked from network); 15 Jul 2004 05:52:00 -0000
Received: from odin.dotsrc.org (HELO a.mx.sunsite.dk) (qmailr@130.225.247.85)
  by sunsite.dk with SMTP; 15 Jul 2004 05:52:00 -0000
Received: (qmail 19533 invoked from network); 15 Jul 2004 05:57:06 -0000
Received: from g.primenet.com.au (203.24.36.10)
  by a.mx.sunsite.dk with SMTP; 15 Jul 2004 05:56:52 -0000
Received: (qmail 5390 invoked by uid 100); 15 Jul 2004 05:51:43 -0000
Date: Thu, 15 Jul 2004 15:51:43 +1000
From: Geoff Wing <gcw@zsh.org>
To: Zsh Hackers <zsh-workers@sunsite.dk>
Subject: Re: Another completion-time screen refresh bug
Message-ID: <20040715055143.GA15329@primenet.com.au>
References: <Pine.LNX.4.60.0407130814310.19233@toltec.zanshin.com> <20040715033750.GA5837@primenet.com.au>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20040715033750.GA5837@primenet.com.au>
User-Agent: Mutt/1.4.2.1i
Organization: PrimeNet Computer Consultancy
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_44 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0

Tracked down to Src/Zle/compresult.c:printlist():2027-2028
This seems wrong - it's a near copy of compprintlist() (or the
other way around) but it doesn't necessarily make sense here.
Printing the new line only makes sense _after_ printing other
stuff which is OK in compprintlist() where there are possibly
multiple sets of lists & explanations to print.  Don't know if
this is the case here.

I don't (want to) understand this section.  I'm thinking that
those lines should be ripped out though maybe it should be
something like the following.  Anybody (besides Sven) looked
through this code before?

Regards,
Geoff

--- Src/Zle/compresult.c	2004-07-13 04:31:41.000000000 +1000
+++ Src/Zle/compresult.c	2004-07-15 15:40:41.000000000 +1000
@@ -1855,8 +1855,7 @@
 	if (tccan(TCCLEAREOD))
 	    tcout(TCCLEAREOD);
     }
-    g = amatches;
-    while (g) {
+    for (g = amatches; g; g = g->next) {
 	char **pp = g->ylist;
 
 	if ((e = g->expls)) {
@@ -2023,10 +2022,10 @@
 			    p = skipnolist(p + 1, showall);
 		}
 	    }
-	}
+	} else
+	    continue;
 	if (g->lcount || (showall && g->mcount))
 	    pnl = 1;
-	g = g->next;
     }
     lastlistlen = 0;
     if (clearflag) {

