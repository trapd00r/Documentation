From zsh-workers-return-19889-mason-zsh=primenet.com.au@sunsite.dk Wed May 05 23:33:42 2004
Return-Path: <zsh-workers-return-19889-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25495 invoked from network); 5 May 2004 23:33:40 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.86)
  by ns1.primenet.com.au with SMTP; 5 May 2004 23:33:40 -0000
Received: (qmail 24678 invoked from network); 5 May 2004 23:33:31 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 May 2004 23:33:31 -0000
Received: (qmail 12922 invoked by alias); 5 May 2004 23:33:29 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19889
Received: (qmail 12913 invoked from network); 5 May 2004 23:33:29 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (qmailr@130.225.247.86)
  by sunsite.dk with SMTP; 5 May 2004 23:33:26 -0000
Received: (qmail 24460 invoked from network); 5 May 2004 23:33:25 -0000
Received: from apate.telenet-ops.be (195.130.132.57)
  by a.mx.sunsite.dk with SMTP; 5 May 2004 23:33:23 -0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by apate.telenet-ops.be (Postfix) with SMTP
	id B6B242B4051; Thu,  6 May 2004 01:33:21 +0200 (MEST)
Received: from kabel.telenet.be (D5767DEE.kabel.telenet.be [213.118.125.238])
	by apate.telenet-ops.be (Postfix) with ESMTP
	id 7A53C2B404C; Thu,  6 May 2004 01:33:21 +0200 (MEST)
Received: by kabel.telenet.be (Postfix, from userid 501)
	id 4DE3926136; Thu, 06 May 2004 01:33:20 +0200 (CEST)
Date: Thu, 6 May 2004 01:33:20 +0200
From: Kurt Roeckx <Q@ping.be>
To: Clint Adams <clint@zsh.org>
Cc: zsh-workers@sunsite.dk, 247556@bugs.debian.org,
	sbuild@packages.debian.org, troup@debian.org
Subject: Re: Bug#247556: zsh build gets stuck running tests.
Message-ID: <20040505233320.GA3923@ping.be>
References: <20040505194300.GA3142@ping.be> <20040505205840.GA30862@scowler.net> <20040505210825.GA3451@ping.be> <20040505212423.GA31074@scowler.net> <20040505213544.GA3566@ping.be> <20040505220657.GA31581@scowler.net> <20040505222340.GA3747@ping.be> <20040505223237.GA32074@scowler.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20040505223237.GA32074@scowler.net>
User-Agent: Mutt/1.4.2.1i
Sender: Q@ping.be
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: *
X-Spam-Status: No, hits=1.5 required=6.0 tests=RCVD_IN_SORBS autolearn=no 
	version=2.63
X-Spam-Hits: 1.5

On Wed, May 05, 2004 at 06:32:37PM -0400, Clint Adams wrote:
> > Why would it be a kernel bug if all other packages build fine?
> 
> Why would it be a zsh bug if it builds fine outside of sbuild?
> Why would it be an sbuild bug if it builds fine under sbuild on all
> architectures bug sparc and amd64?

Anyway, I'm using kernel version 2.6.5.  I doubt many other
people using sbuild on 2.6.x.

What is the test that triggers it (B04read.ztst) doing that other
tests aren't doing?  It would be nice if reduce it to something
we can easily reproduce.

I ran:
strace -f -F zsh +Z -f Test/B04read.ztst

and got:
[...]
open("/bin", O_RDONLY|O_NONBLOCK|O_DIRECTORY) = 3
fstat(3, {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0
fcntl(3, F_SETFD, FD_CLOEXEC)           = 0
getdents64(3, /* 96 entries */, 4096)   = 2736
getdents64(3, /* 0 entries */, 4096)    = 0
close(3)                                = 0
rt_sigprocmask(SIG_BLOCK, [CHLD], [CHLD], 8) = 0
pipe([3, 4])                            = 0
fork(Process 24898 attached
)                                  = 24898
[pid 24894] close(4 <unfinished ...>
[pid 24898] close(3 <unfinished ...>
[pid 24894] <... close resumed> )       = 0
[pid 24894] read(3,  <unfinished ...>
[pid 24898] <... close resumed> )       = 0
[pid 24898] close(11)                   = 0
[pid 24898] rt_sigaction(SIGQUIT, {SIG_DFL}, {SIG_IGN}, 8) = 0
[pid 24898] times({tms_utime=0, tms_stime=0, tms_cutime=0,
tms_cstime=0}) = 551580957
[pid 24898] close(4)                    = 0
[pid 24894] <... read resumed> "", 1)   = 0
[pid 24894] close(3)                    = 0
[pid 24894] rt_sigprocmask(SIG_BLOCK, [CHLD], [CHLD], 8) = 0
[pid 24894] rt_sigsuspend(~[HUP CHLD] <unfinished ...>
[pid 24898] open("world", O_WRONLY|O_CREAT|O_TRUNC|O_NOCTTY,
0666) = 3
[pid 24898] dup2(3, 1)                  = 1
[pid 24898] close(3)                    = 0
[pid 24898] close(10)                   = 0
[pid 24898] close(4294967295)           = -1 EBADF (Bad file
descriptor)
[pid 24898] close(4294967295)           = -1 EBADF (Bad file
descriptor)
[pid 24898] rt_sigprocmask(SIG_UNBLOCK, [CHLD], [CHLD], 8) = 0
[pid 24898] execve("/bin/cat", ["cat"], [/* 13 vars */]) = 0
[pid 24898] uname({sys="Linux", node="debian", ...}) = 0
[pid 24898] brk(0)                      = 0x505000
[pid 24898] mmap(NULL, 4096, PROT_READ|PROT_WRITE,
MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x2a95569000
[pid 24898] access("/etc/ld.so.nohwcap", F_OK) = -1 ENOENT (No
such file or directory)
[pid 24898] open("/etc/ld.so.preload", O_RDONLY) = -1 ENOENT (No
such file or directory)
[pid 24898] open("/etc/ld.so.cache", O_RDONLY) = 3
[pid 24898] fstat(3, {st_mode=S_IFREG|0644, st_size=52453, ...})
= 0
[pid 24898] mmap(NULL, 52453, PROT_READ, MAP_PRIVATE, 3, 0) =
0x2a9556a000
[pid 24898] close(3)                    = 0
[pid 24898] access("/etc/ld.so.nohwcap", F_OK) = -1 ENOENT (No
such file or directory)
[pid 24898] open("/lib/libc.so.6", O_RDONLY) = 3
[pid 24898] read(3,
"\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0>\0\1\0\0\0\240\331"..., 640)
= 640
[pid 24898] fstat(3, {st_mode=S_IFREG|0644, st_size=1268960,
...}) = 0
[pid 24898] mmap(NULL, 2329544, PROT_READ|PROT_EXEC, MAP_PRIVATE,
3, 0) = 0x2a9566b000
[pid 24898] mprotect(0x2a95785000, 1174472, PROT_NONE) = 0
[pid 24898] mmap(0x2a9586b000, 217088, PROT_READ|PROT_WRITE,
MAP_PRIVATE|MAP_FIXED, 3, 0x100000) = 0x2a9586b000
[pid 24898] mmap(0x2a958a0000, 15304, PROT_READ|PROT_WRITE,
MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x2a958a0000
[pid 24898] close(3)                    = 0
[pid 24898] mmap(NULL, 4096, PROT_READ|PROT_WRITE,
MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x2a958a4000
[pid 24898] munmap(0x2a9556a000, 52453) = 0
[pid 24898] brk(0)                      = 0x505000
[pid 24898] brk(0x526000)               = 0x526000
[pid 24898] brk(0)                      = 0x526000
[pid 24898] fstat(1, {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 24898] fstat(0, {st_mode=S_IFCHR|0600, st_rdev=makedev(136,
1), ...}) = 0
[pid 24898] read(0,  <unfinished ...>


And there it hangs reading from stdin and nobody seems to be
writing.


Kurt

