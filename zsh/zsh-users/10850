From zsh-users-return-10850-mason-zsh=primenet.com.au@sunsite.dk Thu Oct 12 17:36:20 2006
Return-Path: <zsh-users-return-10850-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1901 invoked from network); 12 Oct 2006 17:36:16 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.6 (2006-10-03) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.6
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 12 Oct 2006 17:36:16 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 62554 invoked from network); 12 Oct 2006 17:36:05 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 12 Oct 2006 17:36:05 -0000
Received: (qmail 27611 invoked by alias); 12 Oct 2006 17:35:52 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10850
Received: (qmail 27600 invoked from network); 12 Oct 2006 17:35:51 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 12 Oct 2006 17:35:51 -0000
Received: (qmail 60900 invoked from network); 12 Oct 2006 17:35:51 -0000
Received: from py-out-1112.google.com (64.233.166.177)
  by a.mx.sunsite.dk with SMTP; 12 Oct 2006 17:35:50 -0000
Received: by py-out-1112.google.com with SMTP id z74so666351pyg
        for <zsh-users@sunsite.dk>; Thu, 12 Oct 2006 10:35:49 -0700 (PDT)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:mime-version:content-transfer-encoding:message-id:content-type:to:from:subject:date:x-mailer;
        b=hndMiTthc9ZGebb9m6U76cwxAb/zlJh5AsIf2rUcPu1k4ixHn8olTEKYCXBvjLdZYFbMy8hmyup3cO3JPI1NihzdSFBcHuVwV7UCDA6N/rhnJ0TiGBfxVpL8UC1JiOD/TEgato4jqtAfXJfJ9+wHjGyF/C9gf2gALn4vICU78Yc=
Received: by 10.35.49.15 with SMTP id b15mr3685579pyk;
        Thu, 12 Oct 2006 10:35:49 -0700 (PDT)
Received: from ?10.1.0.23? ( [204.107.76.240])
        by mx.google.com with ESMTP id j7sm1790435nzd.2006.10.12.10.35.48;
        Thu, 12 Oct 2006 10:35:48 -0700 (PDT)
Mime-Version: 1.0 (Apple Message framework v752.2)
Content-Transfer-Encoding: 7bit
Message-Id: <76C42610-83A0-4174-ADBF-5CD4D75891D5@gmail.com>
Content-Type: text/plain; charset=US-ASCII; delsp=yes; format=flowed
To: zsh-users@sunsite.dk
From: Michael Hernandez <sequethin@gmail.com>
Subject: can't write zsh_history
Date: Thu, 12 Oct 2006 13:35:45 -0400
X-Mailer: Apple Mail (2.752.2)

Hi all,

Every now and then I need to su on some servers that I work on  
(mostly old freebsd systems that don't have sudo installed and have  
no outbound net connections, i.e. installing sudo is not an option).  
The problem, which is really more of an annoyance than a problem, is  
that if I su to run some command and I don't cd first,  
my .zsh_history file becomes owned by root. After I exit from # and  
run a command as my regular user, zsh tells me that it can't write  
the history file, which of course it can't because it's now owned by  
root. Is there something I can do to alter the way zsh writes to my  
history file when I am root? Something like "if uid is 0 then write  
the history to root's history file and leave .zsh_history alone"?  It  
should be noted that on these machines root's shell is tcsh, except  
in one case where it's ksh (not my idea I promise!) so I'm not sure  
why .zsh_history is touched at all when I'm root. Another oddity is  
that if I chown the file to my user, the file becomes corrupt, which  
is even more frustrating. The version of zsh for each of these  
machines is 4.2.6.

As I said, this is a minor annoyance, but I figured I'd ask in case  
someone else has experienced this before and has a remedy.

Thanks!

Mike H


PS. I just tested this on an openbsd 3.9 firewall that I have, with  
zsh version 4.2.6, and where root's shell is ksh. Same thing happens.

