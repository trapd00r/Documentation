From zsh-workers-return-8494-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Nov 02 14:54:21 1999
Return-Path: <zsh-workers-return-8494-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2289 invoked from network); 2 Nov 1999 14:54:20 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 2 Nov 1999 14:54:20 -0000
Received: (qmail 3788 invoked by alias); 2 Nov 1999 14:54:13 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8494
Received: (qmail 3781 invoked from network); 2 Nov 1999 14:54:13 -0000
Date: Tue, 2 Nov 1999 15:54:11 +0100 (MET)
Message-Id: <199911021454.PAA17679@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Tue, 2 Nov 1999 17:17:40 +0300
Subject: RE: PATCH: Re: _match still does not work in _path_files


Andrej Borsenkow wrote:

> Compare:
> 
> bor@itsrm2:/tools/src/zsh-cvs/zsh%> zsh -f
> ...
> itsrm2% ls /t/s/z/f*/_<TAB>
> beeps
> 
> but
> 
> bor@itsrm2:/tools/src/db-2.7.7/build_unix%> zsh-3.1.6 -f
> ...
> itsrm2% ls /t/s/z/f*/_<TAB>
> itsrm2% ls /tools/share/zsh/functions<CURSOR>/_
> functions/      functions.old/
> 
> with TAB cycling between functions and functions.old
> 
> It is much worse actually; in the above setup as simple as
> 
> itsrm2% ls /t/s/z/f/_<TAB>
> 
> does not work - it beeps. In 3.1.6 pure I at least get both functions and
> functions.old listed (I am still not quite happy with what happens after the
> second TAB ...)

There was a bug which should be fixed by the patch below. However, the 
rest of what I said the last time when you brought this up is still
valid.

Bye
 Sven

diff -u oldcompletion/Core/_path_files Completion/Core/_path_files
--- oldcompletion/Core/_path_files	Mon Nov  1 09:03:02 1999
+++ Completion/Core/_path_files	Tue Nov  2 15:50:27 1999
@@ -316,7 +316,7 @@
       # collected as the suffixes to make the completion code expand
       # it as far as possible.
 
-      if [[ "$tsuf" = */* ]]; then
+      if [[ "$tpre" = */* ]]; then
         PREFIX="${donepath}${linepath}${cpre}${tpre%%/*}"
 	SUFFIX="/${tsuf#*/}"
       else
@@ -390,8 +390,8 @@
   done
 
   if [[ -z "$tmp4" ]]; then
-    PREFIX="${opre}"
-    SUFFIX="${osuf}"
+    PREFIX="${opre}${osuf}"
+    SUFFIX=""
     compadd -Qf -p "$linepath${testpath:q}" \
 	    -W "$prepath$realpath$testpath" "$ignore[@]" \
 	    "$addpfx[@]" "$addsfx[@]" "$remsfx[@]" \

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

