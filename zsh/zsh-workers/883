From hzoli@cs.elte.hu Mon Apr  1 07:43:20 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3) with ESMTP id HAA26597 for <mason@werple.mira.net.au>; Mon, 1 Apr 1996 07:43:17 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id QAA21409; Sun, 31 Mar 1996 16:29:37 -0500 (EST)
Resent-Date: Sun, 31 Mar 1996 16:29:37 -0500 (EST)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199603312126.XAA00221@hzoli.ppp.cs.elte.hu>
Subject: A fix for beta13-hzoli13
To: zsh-workers@math.gatech.edu (Zsh hacking and development)
Date: Sun, 31 Mar 1996 23:26:22 +0200 (MET DST)
X-Mailer: ELM [version 2.4ME+ PL11 (25)]
MIME-Version: 1.0
Content-Type: application/pgp; format=text; x-action=sign
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"dtCBb3.0.RE5.0blNn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/883
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 1210
Status: OR

-----BEGIN PGP SIGNED MESSAGE-----

If the ENV environment variable is not set and zsh is invoked as sh or ksh,
it just dumps core.  The problem is that source() is called with NULL
argument.  This is no problem for the vanilla version since it passes the
NULL to open(2) which just fails and sets errno.  But my version first
converts the filename from the zsh internal quoted form to a normal string
and the conversion routine causes a SEGV.

The patch below fixes that.

Bye,

Zoltan

 *** Src/init.c	1996/03/22 21:33:31	1.15
 --- Src/init.c	1996/03/31 21:13:37
 ***************
 *** 832,837 ****
 --- 832,839 ----
       /* Current while, for, ... loops are invisible to the source'd script          */
       int oloops    = loops;           /* stored the # of nested loops we are in     */
   
 +     if (!s)
 + 	return 1;
       loops  = 0;
       lineno = 0;
       opts[SHINSTDIN] = OPT_UNSET;

-----BEGIN PGP SIGNATURE-----
Version: 2.6.3i
Charset: noconv

iQCVAwUBMV74fAupSCiLN749AQHo7gQAiwNZ+CIgaWOk91cQ9bJtqRm0MkB2Sxhi
d5qZSoVBOf/NORoPCNpXqMQLBe7MeBYnG/yQJfBUNApIo2qA6txiMmGKodDI12x0
EF9CeyjiqmtQCZiXuB1doHHIcD+seYh/UpuWtqt/Ksoo+5PdFtkQXWCiShXm1wbB
DOSzLFMtPTE=
=KzdC
-----END PGP SIGNATURE-----
