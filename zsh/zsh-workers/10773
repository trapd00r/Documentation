From zsh-workers-return-10773-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Apr 17 00:58:19 2000
Return-Path: <zsh-workers-return-10773-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25796 invoked from network); 17 Apr 2000 00:58:18 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Apr 2000 00:58:18 -0000
Received: (qmail 6746 invoked by alias); 17 Apr 2000 00:58:11 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10773
Received: (qmail 6731 invoked from network); 17 Apr 2000 00:58:09 -0000
Date: Mon, 17 Apr 2000 10:58:03 +1000
From: Geoff Wing <gcw@pobox.com>
To: Bart Schaefer <schaefer@candle.brasslantern.com>
Cc: zsh-workers@sunsite.auc.dk
Subject: Re: 3.1.6-dev-22
Message-ID: <20000417105803.A25633@primenet.com.au>
References: <E12f77V-0004S7-00.2000-04-11-21-18-46@cmailg2.svr.pol.co.uk> <slrn8f85va.edk.mason@coral.primenet.com.au> <1000412081220.ZM11853@candle.brasslantern.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 1.0.1i
In-Reply-To: <1000412081220.ZM11853@candle.brasslantern.com>; from schaefer@candle.brasslantern.com on Wed, Apr 12, 2000 at 08:12:20AM +0000
Organization: PrimeNet Computer Consultancy

Bart Schaefer wrote about Re: 3.1.6-dev-22:
:On Apr 12,  6:30am, Geoff Wing wrote:
:} Subject: Re: 3.1.6-dev-22
:} We differ from other shells in that we have a clear workspace
:} under the prompt line.  Apply [users/2973] and [...]
:} My preference is for the current arrangement and I have
:} noalwayslastprompt - adding the patch may spawn another setopt
:} value: gimmeaclearworkspace :-)
:I'll play with this a bit when I'm wider awake, but:

I've been waiting.  Are you wider awake yet?  :-)

:Can't you get the same effect with 2973 applied by having %E as the last
:thing in $PS1 ?

:And what's the point of having the %E escape if zsh is always going to
:clear the screen unconditionally?  Just for "print -P"?

OK.  Here are some starting points:
1) %E is CLEAREOL (erase to end of line)
2) The display code doesn't know about %E.  The prompt code handles
   that but doesn't pass that information through, leading to:
3) %E in prompts may be dangerous.  In certain (possibly contrived)
   situations the display code may have the cursor within the prompt
   and decide the quickest way to get past it is to output the prompt.
   However it won't know that you've CLEAREOL'd so you may end up
   missing text in the display.  The likelyhood of this happening to
   anyone is probably extremely low since, IIRC, you would need wierd
   termcap/terminfo settings to achieve it.
4) CLEAREOL only affects the directly managed display (the prompt lines)
   whereas the patch affects sending CLEAREOD which also affects text
   under the prompt lines.
5) You can't unconditionally put CLEAREOD in left or right prompt
   because of several situations including lists or extended lines,
   e.g. the right prompt can be removed or redrawn without affecting
   the following lines;  if it's redrawn and it has CLEAREOD, blam!

Regards,
-- 
Geoff Wing : <gcw@pobox.com>     Work URL: http://www.primenet.com.au/
Rxvt Stuff : <gcw@rxvt.org>      Ego URL : http://pobox.com/~gcw/
Zsh Stuff  : <gcw@zsh.org>       Phone   : (Australia) 0413 431 874

