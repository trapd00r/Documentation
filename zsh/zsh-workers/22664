From zsh-workers-return-22664-mason-zsh=primenet.com.au@sunsite.dk Sat Sep 02 17:42:52 2006
Return-Path: <zsh-workers-return-22664-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28828 invoked from network); 2 Sep 2006 17:42:49 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.4 (2006-07-25) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-0.9 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO,
	RCVD_IN_BL_SPAMCOP_NET autolearn=no version=3.1.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 2 Sep 2006 17:42:49 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 55529 invoked from network); 2 Sep 2006 17:42:43 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 2 Sep 2006 17:42:43 -0000
Received: (qmail 7617 invoked by alias); 2 Sep 2006 17:42:41 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22664
Received: (qmail 7607 invoked from network); 2 Sep 2006 17:42:40 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 2 Sep 2006 17:42:40 -0000
Received: (qmail 55252 invoked from network); 2 Sep 2006 17:42:40 -0000
Received: from wx-out-0506.google.com (66.249.82.232)
  by a.mx.sunsite.dk with SMTP; 2 Sep 2006 17:42:38 -0000
Received: by wx-out-0506.google.com with SMTP id s7so1451695wxc
        for <zsh-workers@sunsite.dk>; Sat, 02 Sep 2006 10:42:37 -0700 (PDT)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:user-agent:mime-version:to:subject:references:in-reply-to:content-type:content-transfer-encoding;
        b=diu1aQ/PaLC8tIR26EWU8ZcP8QRV9qYt1ycIsez/NcwBRJYquO9hs5h3aT+LA5Ee8MglAcnT1JZewl0AtvcntPyBj9pRWrvgJp/s3BTJmwwqs7YBNctunbCgU5yZAPxegb4gRyPYowRRWu8PjqHBxvpIJemfwdgtMZNvY7X5iug=
Received: by 10.70.90.14 with SMTP id n14mr4695100wxb;
        Sat, 02 Sep 2006 10:42:36 -0700 (PDT)
Received: from ?192.168.1.36? ( [69.253.209.154])
        by mx.gmail.com with ESMTP id h20sm5087226wxd.2006.09.02.10.42.35;
        Sat, 02 Sep 2006 10:42:36 -0700 (PDT)
Message-ID: <44F9C290.6070703@gmail.com>
Date: Sat, 02 Sep 2006 13:42:40 -0400
From: Gene <gananda@gmail.com>
User-Agent: Thunderbird 1.5.0.5 (Macintosh/20060719)
MIME-Version: 1.0
To:  zsh-workers@sunsite.dk
Subject: Re: zsh hangs on AIX 4.3.3
References: <bf7e3eaf0609010856l753eb484pe863afafaf4c660c@mail.gmail.com>
In-Reply-To: <bf7e3eaf0609010856l753eb484pe863afafaf4c660c@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit

For what it's worth, this bug also appears to exist on an AIX 5.2
platform I have access to.

Gene Carter wrote:
> Greetings,
> 
> I'm trying to use zsh on an AIX 4.3.3 box. Unfortunately, I appear to be
> hitting a bug related to a wait
> on signals.
> 
> I've trimmed down the script to a (perhaps local) minimum to recreate
> the problem. The script seems
> to make it through about 351 interations, and then hangs. ^C won't break
> it out. ^Z won't suspend.
> SIGHUP and SIGCHLD both will stop the process.
> 
> This problem occurs with zsh binaries that I compile as well as
> externally supplied
> binaries (from two sources).
> 
> I would very much like to use zsh to script our administration work on
> these systems.
> Any help would be greately appreciated.
> 
> Thanks,
> Gene
> 
> ----
> script
> ----
> #!/usr3/rfgadm/src/zsh-4.3.2/Src/zsh
> 
> integer ctr=1
> disks=$(while ((ctr < 100)) ; do print $ctr ; let ctr=ctr+1 ; done )
> 
> integer outer=1
> while [ 1 ] ; do
>     print $disks |
>         while read pdisk; do
>             echo $pdisk  | read hdisk
>             echo 0 | read n
>             print $pdisk $((outer*${#disks}+pdisk))
>         done
>     ((outer=outer+1))
> done
> 
> ---
> gcc info
> ---
> 11:39: [carterg@isriscwc {80}] gcc -v
> Reading specs from
> /usr3_is/rfgadm/bin/../lib/gcc-lib/powerpc-ibm-aix4.3.2.0/3.3.6/specs
> Configured with: ../gcc-3.3.6/configure --disable-nls
> Thread model: aix
> gcc version 3.3.6
> 11:47: [carterg@isriscwc {81}]
> 
> ---
> gdb trace
> ---
> 11:39: [carterg@isriscwc {260}] gdb /usr3/rfgadm/src/zsh-4.3.2/Src/zsh
> GNU gdb 6.5
> Copyright (C) 2006 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and you
> are
> welcome to change it and/or distribute copies of it under certain
> conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for details.
> This GDB was configured as "powerpc-ibm-aix4.3.3.0"...
> (gdb) run zshprob
> Starting program: /usr3_is/rfgadm/src/zsh-4.3.2/Src/zsh zshprob
> ...
> 62 349
> 63 350
> 64 351
> 
> Program received signal SIGTERM, Terminated.
> 0xd01888c8 in sigsuspend () from /usr/lib/libc.a(shr.o)
> (gdb) bt
> #0  0xd01888c8 in sigsuspend () from /usr/lib/libc.a(shr.o)
> #1  0x100732b4 in signal_suspend (sig=20, sig2=0) at signals.c:376
> #2  0x10079ed0 in zwaitjob (job=3, sig=0) at jobs.c:1161
> #3  0x1007a090 in waitjobs () at jobs.c:1196
> #4  0x1004546c in execpline (state=0x2ff22448, slcode=9218, how=2, last1=0)
>     at exec.c:1161
> #5  0x1004469c in execlist (state=0x2ff22448, dont_change_job=1,
> exiting=0) at exec.c:892
> #6  0x100aeb48 in execwhile (state=0x2ff22448, do_exec=0) at loop.c:415
> #7  0x1004a8e4 in execcmd (state=0x2ff22448, input=12, output=0, how=2,
> last1=2)
>     at exec.c:2523
> #8  0x10045e34 in execpline2 (state=0x2ff22448, pcode=643, how=2,
> input=12, output=0,
>     last1=0) at exec.c:1300
> #9  0x100460f8 in execpline2 (state=0x2ff22448, pcode=611, how=2,
> input=0, output=0,
>     last1=0) at exec.c:1351
> #10 0x10045024 in execpline (state=0x2ff22448, slcode=43010, how=2,
> last1=0)
>     at exec.c:1086
> #11 0x1004469c in execlist (state=0x2ff22448, dont_change_job=1,
> exiting=0) at exec.c:892
> #12 0x100aeb48 in execwhile (state=0x2ff22448, do_exec=0) at loop.c:415
> #13 0x1004a8e4 in execcmd (state=0x2ff22448, input=0, output=0, how=18,
> last1=2)
>     at exec.c:2523
> #14 0x10045e34 in execpline2 (state=0x2ff22448, pcode=515, how=18,
> input=0, output=0,
>     last1=0) at exec.c:1300
> #15 0x10045024 in execpline (state=0x2ff22448, slcode=58370, how=18,
> last1=0)
> ---Type <return> to continue, or q <return> to quit---
>     at exec.c:1086
> #16 0x1004469c in execlist (state=0x2ff22448, dont_change_job=0,
> exiting=0) at exec.c:892
> #17 0x100441c4 in execode (p=0x20040440, dont_change_job=0, exiting=0)
> at exec.c:792
> #18 0x10000c28 in loop (toplevel=1, justonce=0) at init.c:167
> #19 0x10004520 in zsh_main (argc=2, argv=0x2ff225d4) at init.c:1326
> #20 0x10000578 in main (argc=2, argv=0x2ff225d4) at main.c:93
> (gdb)

