From zsh-workers-return-19279-mason-zsh=primenet.com.au@sunsite.dk Fri Dec 05 16:52:46 2003
Return-Path: <zsh-workers-return-19279-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26619 invoked from network); 5 Dec 2003 16:52:45 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 5 Dec 2003 16:52:45 -0000
Received: (qmail 4515 invoked by alias); 5 Dec 2003 16:52:38 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19279
Received: (qmail 4503 invoked from network); 5 Dec 2003 16:52:37 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 5 Dec 2003 16:52:37 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [4.11.8.53] by sunsite.dk (MessageWall 1.0.8) with SMTP; 5 Dec 2003 16:52:37 -0000
Received: (from schaefer@localhost)
	by candle.brasslantern.com (8.11.6/8.11.6) id hB5GqZg18397
	for zsh-workers@sunsite.dk; Fri, 5 Dec 2003 08:52:35 -0800
X-Authentication-Warning: candle.brasslantern.com: schaefer set sender to schaefer@closedmail.com using -f
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <1031205165235.ZM18396@candle.brasslantern.com>
Date: Fri, 5 Dec 2003 16:52:35 +0000
In-Reply-To: <15582.1070624216@gmcs3.local>
Comments: In reply to Oliver Kiddle <okiddle@yahoo.co.uk>
        "Adding the original string from completion" (Dec  5, 12:36pm)
References: <15582.1070624216@gmcs3.local>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Zsh workers <zsh-workers@sunsite.dk>
Subject: Re: Adding the original string from completion
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Dec 5, 12:36pm, Oliver Kiddle wrote:
}
} compadd "$expl[@]" -U -Q - "$PREFIX$SUFFIX"
} 
} When called from _prefix, the result is that the suffix is lost.
} 
} The fix is to change the line to:
} 
} compadd "$expl[@]" -i "$IPREFIX" -I "$ISUFFIX" -U -Q - "$PREFIX$SUFFIX"
} 
} Only problem is if _prefix's add-space style is set. It sticks an
} additional space at the beginning of ISUFFIX.
[...]
} This amounts to trusting $words[CURRENT] to be unchanged instead of
} $ISUFFIX. If we do this, I'm inclined to factor it out into an new
} _original function though. Anyone got any better ideas?

How about this:

Have functions _prefix and _original cooperate with each other.  Before
changing $ISUFFIX, _prefix stores the original value in a local, perhaps
$_orig_isuf or some such.  Then _original uses ${_orig_isuf:-$ISUFFIX}
when constructing the compadd command.

} There is also the option of only adding original strings at the end from
} _main_complete. Given certain styles and whether menu completion if
} enabled that is.

So then _original would work sort of like _all_matches ?  That might be
a good way to go, but I'm not entirely certain.

