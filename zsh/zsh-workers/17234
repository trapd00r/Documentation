From zsh-workers-return-17234-mason-zsh=primenet.com.au@sunsite.dk Sun May 26 19:19:50 2002
Return-Path: <zsh-workers-return-17234-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3587 invoked from network); 26 May 2002 19:19:49 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 26 May 2002 19:19:49 -0000
Received: (qmail 26824 invoked by alias); 26 May 2002 19:19:42 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 17234
Received: (qmail 26807 invoked from network); 26 May 2002 19:19:41 -0000
Date: Sun, 26 May 2002 15:19:39 -0400
From: Clint Adams <clint@zsh.org>
To: zsh-workers@sunsite.dk
Subject: PATCH: pattern error in cvs completion
Message-ID: <20020526191939.GA12421@dman.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.3.28i
X-Virus-Scanned: by amavisd-milter (http://amavis.org/)

To reproduce:

mkdir /tmp/test
cd /tmp/test
mkdir CVS
echo D >CVS/Entries
touch .test
echo '.*' >~/.cvsignore
cvs add .<TAB>


Index: Completion/Unix/Command/_cvs
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_cvs,v
retrieving revision 1.14
diff -u -r1.14 _cvs
--- Completion/Unix/Command/_cvs	25 May 2002 23:04:03 -0000	1.14
+++ Completion/Unix/Command/_cvs	26 May 2002 19:18:50 -0000
@@ -945,7 +945,11 @@
     omitpats=(
       ${${${${(M)${(f)"$(<"$realdir"CVS/Entries)"}:#/*}#/}%%/*}//(#m)[][*?()<|^~#\\]/\\$MATCH}
     )
-    _path_files -g "*~(*/|)(${(j:|:)~omitpats})(D.)"
+    if (( $#omitpats )); then
+    	_path_files -g "*~(*/|)(${(j:|:)~omitpats})(D.)"
+    else
+    	_path_files -g "*~(*/|)(D.)"
+    fi
   }
 }
 

