From zsh-users-return-14597-mason-zsh=primenet.com.au@zsh.org Tue Nov 24 14:38:10 2009
Return-Path: <zsh-users-return-14597-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24746 invoked by alias); 24 Nov 2009 14:38:10 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14597
Received: (qmail 16842 invoked from network); 24 Nov 2009 14:38:07 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00
	autolearn=unavailable version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at math.technion.ac.il does not designate permitted sender hosts)
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: ApoEAJd+C0uERHMG/2dsb2JhbADZAAKENwQ
X-IronPort-AV: E=Sophos;i="4.47,279,1257112800"; 
   d="scan'208";a="211524642"
Resent-Message-Id: <200911241438.nAOEc4vg010115@fermat.math.technion.ac.il>
X-Authentication-Warning: fermat.math.technion.ac.il: nyh set sender to nyh@math.technion.ac.il using -f
X-Authentication-Warning: fermat.math.technion.ac.il: nyh set sender to nyh@math.technion.ac.il using -f
Date: Tue, 24 Nov 2009 16:31:40 +0200
From: "Nadav Har'El" <nyh@math.technion.ac.il>
To: zsh-users@zsh.org
Subject: Redirecting shell output to a pipe
Message-ID: <20091124143140.GA7612@fermat.math.technion.ac.il>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4.2.2i
Hebrew-Date: 7 Kislev 5770
Resent-From: nyh@math.technion.ac.il
Resent-Date: Tue, 24 Nov 2009 16:38:04 +0200
Resent-To: zsh-users@zsh.org

Hi,

If a shell script wants all its output to go to a file, it's easy:

	exec >filename 2>&1

Isn't it natural to assume that in the same fashion, you should also
be able to redirect the scripts output to a pipe? E.g., a very useful
idiom could have been

	exec | tee filename

to redirect stdout both to a file, and to the terminal.
But unfortunately, the above line does *not* work. Is there a reason why
it doesn't? Wouldn't this be a useful feature?

By the way, for the curious, there is actually a different solution to this
need, but it is much more convoluted. The other solution is to write this:

	exec 3>&1
	coproc tee /tmp/b >&3
	exec >&p 2>&1

(and perhaps do something, I'm not even sure what, at the end of the script
to give the tee coprocess enough time to finish outputting before the script
exits).

Another downside of this solution, besides being extremely complex (99%
of the zsh users will probably not be able to figure it out), is that
it takes the only coprocess that zsh gives you, which won't work if your
code is already using coprocesses.

-- 
Nadav Har'El                        |      Tuesday, Nov 24 2009, 7 Kislev 5770
nyh@math.technion.ac.il             |-----------------------------------------
Phone +972-523-790466, ICQ 13349191 |"Guests, like fish, begin to smell after
http://nadav.harel.org.il           |three days." -- Benjamin Franklin

