From zsh-workers-return-10943-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Apr 26 17:49:19 2000
Return-Path: <zsh-workers-return-10943-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8326 invoked from network); 26 Apr 2000 17:49:18 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 26 Apr 2000 17:49:18 -0000
Received: (qmail 13607 invoked by alias); 26 Apr 2000 17:49:08 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10943
Received: (qmail 13599 invoked from network); 26 Apr 2000 17:49:07 -0000
Date: Wed, 26 Apr 2000 18:49:05 +0100
From: Adam Spiers <adam@spiers.net>
To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Subject: PATCH: bugfixes for _rpm and _hash
Message-ID: <20000426184905.A11937@thelonious.new.ox.ac.uk>
Reply-To: Adam Spiers <adam@spiers.net>
Mail-Followup-To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
References: <20000426173759.A11067@thelonious.new.ox.ac.uk> <1000426172340.ZM20629@candle.brasslantern.com> <20000426183501.A11738@thelonious.new.ox.ac.uk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 1.0.1i
In-Reply-To: <20000426183501.A11738@thelonious.new.ox.ac.uk>; from adam@spiers.net on Wed, Apr 26, 2000 at 06:35:01PM +0100
X-Home-Page: http://www.new.ox.ac.uk/~adam/
X-OS: RedHat Linux

Adam Spiers (adam@spiers.net) wrote:
> Bart Schaefer (schaefer@candle.brasslantern.com) wrote:
> > Take that "$expl[@]" out of there, you don't need it and it's ultimately
> > causing an empty string as an argument to _files.
> 
> Ahah.  In that case is _hash wrong?  It has
> 
>   _wanted -C value values expl 'executable file' _files "$expl[@]" -g '*(-*)'
> 
> which seems to exhibit the same problem.

As soon as someone confirms this, I'll apply this patch, which makes
things work as expected.

Index: Completion/Builtins/_hash
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Builtins/_hash,v
retrieving revision 1.2
diff -u -r1.2 _hash
--- Completion/Builtins/_hash	2000/04/11 07:57:56	1.2
+++ Completion/Builtins/_hash	2000/04/26 17:38:04
@@ -10,7 +10,7 @@
         compadd -q -S '=' - "${(@k)nameddirs}"
   fi
 elif compset -P 1 '*='; then
-  _wanted -C value values expl 'executable file' _files "$expl[@]" -g '*(-*)'
+  _wanted -C value values expl 'executable file' _files -g '*(-*)'
 else
   _wanted -C name commands expl command compadd -q -S '=' - "${(@k)commands}"
 fi
Index: Completion/Linux/_rpm
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Linux/_rpm,v
retrieving revision 1.6
diff -u -r1.6 _rpm
--- Completion/Linux/_rpm	2000/04/17 08:42:18	1.6
+++ Completion/Linux/_rpm	2000/04/26 17:38:04
@@ -70,8 +70,9 @@
   '--erase:*:uninstall:->uninstall' \
   -'b+[build mode (spec file)]:build stage:((p\:execute\ \%prep\ stage l\:do\ a\ list\ check c\:execute\ build\ stage i\:execute\ install\ stage b\:build\ a\ binary\ package a\:build\ binary\ and\ source\ packages)):*:build:->build_b' \
   -'t+[build mode (tar file)]:build stage:((p\:execute\ \%prep\ stage l\:do\ a\ list\ check c\:execute\ build\ stage i\:execute\ install\ stage b\:build\ a\ binary\ package a\:build\ binary\ and\ source\ packages)):*:build:->build_t' \
-  --{rmsource,recompile,resign,addsign}':*:RPM package:->package' \
-  '--rebuild:*:Src RPM files:->package_src' \
+  --{resign,addsign}':*:RPM package:->package' \
+  '--rmsource:*:spec file:->spec_file' \
+  --{rebuild,recompile}':*:Src RPM files:->package_src' \
     '-K+[signature check mode]:*:sigcheck:->sigcheck' \
   '--checksig:*:sigcheck:->sigcheck' \
   '--rebuilddb:*:rebuild:->rebuild' && ret=0
@@ -198,13 +199,17 @@
     _wanted packages expl 'RPM package' \
         compadd -M 'r:|-=* r:|=*' - $(_call packages rpm -qa) && ret=0
     ;;
+  spec_file)
+    _wanted specfiles expl 'spec file' \
+        _files -g \*.spec && ret=0
+    ;;
   package_file)
     if compset -P ftp://; then
       _hosts -S/ && ret=0
     else
       _alternative \
           'files:RPM package file:_files -g \*.\(\#i\)rpm' \
-	  'prefixes:ftp URL prefix:compadd ftp://' && ret=0
+          'prefixes:ftp URL prefix:compadd ftp://' && ret=0
     fi
     ;;
   package_src)

