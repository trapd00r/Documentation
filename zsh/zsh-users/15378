From zsh-users-return-15378-mason-zsh=primenet.com.au@zsh.org Thu Sep 09 09:56:17 2010
Return-Path: <zsh-users-return-15378-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14632 invoked by alias); 9 Sep 2010 09:56:17 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15378
Received: (qmail 501 invoked from network); 9 Sep 2010 09:56:15 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_LOW,
	SPF_HELO_PASS autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at csr.com does not designate permitted sender hosts)
Date: Thu, 9 Sep 2010 10:56:08 +0100
From: Peter Stephenson <Peter.Stephenson@csr.com>
To: zsh-users@zsh.org
Subject: Re: trap does not work in a trap function?
Message-ID: <20100909105608.453fd843@pwslap01u.europe.root.pri>
In-Reply-To: <AANLkTikjabCspqKZfWCA35_RhYa0up7AxDa+GocktMG_@mail.gmail.com>
References: <20100909080214.76320@gmx.net>
	<20100909081733.76300@gmx.net>
	<20100909095753.5473e833@pwslap01u.europe.root.pri>
	<AANLkTikjabCspqKZfWCA35_RhYa0up7AxDa+GocktMG_@mail.gmail.com>
Organization: Cambridge Silicon Radio
X-Mailer: Claws Mail 3.7.6 (GTK+ 2.18.9; i686-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 09 Sep 2010 09:56:08.0885 (UTC) FILETIME=[3A07F650:01CB5005]
X-Scanned-By: MailControl A-06-00-00 (www.mailcontrol.com) on 10.68.0.118

On Thu, 9 Sep 2010 11:44:49 +0200
Mikael Magnusson <mikachu@gmail.com> wrote:
> Could you also use "SIGEXIT() shutdown" and "unfunction SIGEXIT"
> instead, regardless of the amount of function nesting? (It seems to
> work when I try it).

What's supposed to happen is the trap, however it is set, is saved and
unset during the function, then restored afterwards (before the scope in
which the function's EXIT trap is run, hence the workaround).  So this
isn't supposed to work.  I get the following:

% TRAPEXIT() { echo This is the exit trap; }
% fn() { unfunction TRAPEXIT; }
% fn
fn:unfunction: no such hash table element: TRAPEXIT
% functions TRAPEXIT
TRAPEXIT () {
	echo This is the exit trap
}
% exit
This is the exit trap

-- 
Peter Stephenson <pws@csr.com>            Software Engineer
Tel: +44 (0)1223 692070                   Cambridge Silicon Radio Limited
Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, UK


Member of the CSR plc group of companies. CSR plc registered in England and Wales, registered number 4187346, registered office Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, United Kingdom

