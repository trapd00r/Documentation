From zsh-users-return-11339-mason-zsh=primenet.com.au@sunsite.dk Sun Mar 25 19:28:04 2007
Return-Path: <zsh-users-return-11339-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9544 invoked from network); 25 Mar 2007 19:28:02 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.8 (2007-02-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO
	autolearn=ham version=3.1.8
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 Mar 2007 19:28:02 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 8533 invoked from network); 25 Mar 2007 19:27:57 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 25 Mar 2007 19:27:57 -0000
Received: (qmail 10681 invoked by alias); 25 Mar 2007 19:27:49 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11339
Received: (qmail 10670 invoked from network); 25 Mar 2007 19:27:48 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 25 Mar 2007 19:27:48 -0000
Received: (qmail 7291 invoked from network); 25 Mar 2007 19:27:48 -0000
Received: from flpvm09.prodigy.net (207.115.20.39)
  by a.mx.sunsite.dk with SMTP; 25 Mar 2007 19:27:44 -0000
X-ORBL: [76.199.97.3]
Received: from [76.199.97.3] (adsl-76-199-97-3.dsl.pltn13.sbcglobal.net [76.199.97.3])
	by flpvm09.prodigy.net (8.13.8 out.dk.spool/8.13.8) with ESMTP id l2PJRVvH031843
	for <zsh-users@sunsite.dk>; Sun, 25 Mar 2007 12:27:32 -0700
Message-ID: <4606D284.1050208@cowan.name>
Date: Sun, 25 Mar 2007 12:50:28 -0700
From: Micah Cowan <micah@cowan.name>
User-Agent: Thunderbird 1.5.0.10 (X11/20070306)
MIME-Version: 1.0
To: zsh-users@sunsite.dk
Subject: Re: command substitution with control chars?
References: <20070325094407.62594.qmail@smasher.org> <237967ef0703251133y79cde28coaa7a788f0ced8069@mail.gmail.com> <20070325185204.48021.qmail@smasher.org>
In-Reply-To: <20070325185204.48021.qmail@smasher.org>
X-Enigmail-Version: 0.94.0.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit

Atom Smasher wrote:
> On Sun, 25 Mar 2007, Mikael Magnusson wrote:
> 
>> It sounds like you just need to put your escape sequences inside %{ %}
>> pairs?
> =====================
> 
> then i wind up getting colored "%{" and colored "%}" in the prompt, and
> things are still hosed. maybe there's a way to do it, but i haven't
> figured it out yet...
> 
> basically, i'm taking this idea <http://swicked.net/pages/bat_mon.html>
> and trying to convert it from linux to bsd and from bash to zsh. i've
> got a script that outputs battery status, and uses different colors to
> display the output depending on the status... now to get the output into
> my prompt...
> 
> anyway, it seems that if the output of the script includes the zsh
> escape sequences it doesn't work as expected.

If you are getting colored "%{" and "%}" in your prompt, then you
probably just need to make sure that the prompt_percent option is set.

I started a thread a couple weeks ago about a shell-script I was working
on that does an abbreviated suspended-jobs-list on the command-line,
which has similar issues to your own (except that, I'm also keeping the
whole script compatible with bash and ksh as well). Bash uses "\[" and
"\]" (without requiring an option to be set); and ksh uses... an
abomination that involves carefully selecting a control character that
doesn't print anything on any terminal you wish to support. :)

-- 
Micah J. Cowan
Programmer, musician, typesetting enthusiast, gamer...
http://micah.cowan.name/

