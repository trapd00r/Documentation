From zsh-workers-return-7852-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Sep 15 15:05:12 1999
Return-Path: <zsh-workers-return-7852-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11243 invoked from network); 15 Sep 1999 15:05:10 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 Sep 1999 15:05:10 -0000
Received: (qmail 7452 invoked by alias); 15 Sep 1999 15:04:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7852
Received: (qmail 7445 invoked from network); 15 Sep 1999 15:04:57 -0000
Message-ID: <37DFB584.506608BA@u.genie.co.uk>
Date: Wed, 15 Sep 1999 16:04:36 +0100
From: Oliver Kiddle <opk@u.genie.co.uk>
X-Mailer: Mozilla 4.61 [en] (Win95; I)
X-Accept-Language: en
MIME-Version: 1.0
To: Zsh workers <zsh-workers@sunsite.auc.dk>
Subject: man completion and zftp problem
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

The man completion is also useful for whatis and apropos. I was going
to save this patch until I had a load more completion patches but I've
not had the time to do any more. Strictly speaking, apropos should
complete to words taken from all the whatis files but in the absence of
that, the same completion as man is useful.

Also below is my compdef completion which I wrote ages ago and never
finished. It probably needs a bit of tidying up, finishing and adjusting
to use other new functions like _arguments but until then, it's useful
as it is.

Finally, an unrelated thing which I have recently observed. If I use
zfgoto to connect to an ftp site from my bookmarks and accidentally type
the wrong password, the module saves my incorrect password in memory so,
I then have to unload and reload the module before I can connect to the
ftp site.

Oliver Kiddle


#compdef compdef

local func base=2

while [[ $words[base] = -* ]]; do
  case $words[base] in
    -d) delete=yes ;;
    -p) type=pattern ;;
    -k) type=key ;;
  esac  
  (( base++ ))
done

if [ "$delete" ]; then
  compadd ${(k)_comps}
else
  if [[ CURRENT -eq base  ]]; then
    for func in ${^~fpath:/.}/_(|*[^~])(N:t); compadd -P_ - ${func#_}
  else
    compgen -c
  fi
fi


*** Completion/User/_man.old	Wed Sep 15 15:30:16 1999
--- Completion/User/_man	Wed Sep 15 15:30:40 1999
***************
*** 1,4 ****
! #compdef man
  
  setopt localoptions rcexpandparam
  
--- 1,4 ----
! #compdef man apropos whatis
  
  setopt localoptions rcexpandparam

