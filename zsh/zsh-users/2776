From zsh-users-return-2776-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Dec 13 10:33:47 1999
Return-Path: <zsh-users-return-2776-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21509 invoked from network); 13 Dec 1999 10:33:46 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 13 Dec 1999 10:33:46 -0000
Received: (qmail 22259 invoked by alias); 13 Dec 1999 10:33:14 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 2776
Received: (qmail 22250 invoked from network); 13 Dec 1999 10:33:13 -0000
Date: Mon, 13 Dec 1999 11:33:12 +0100 (MET)
Message-Id: <199912131033.LAA26141@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-users@sunsite.auc.dk
In-reply-to: "Bart Schaefer"'s message of Fri, 10 Dec 1999 18:33:37 +0000
Subject: Re: two completion questions


Bart Schaefer wrote:

> ...
> 
> If you're using the new function-based completion in 3.1.6, it's going to
> require some editing of the _path_files completer.  Hey, Sven, do you (or
> any other zsh-workers) remember the rationale for this handling of ".."?

In _path_files it's because globbing never produces . and ..

About compctl: I only vaguely remember lots of discussions about these 
two special cases.


Anyway, here's the patch for _path_files, for the latest version.

To tell you the truth: this also fixes two typos that made files not
starting with a dot not be used as possible completions if glob_dots
was unset and the string on the line started with a dot.

Bye
 Sven

diff -ru ../z.old/Completion/Core/_path_files Completion/Core/_path_files
--- ../z.old/Completion/Core/_path_files	Mon Dec 13 11:24:11 1999
+++ Completion/Core/_path_files	Mon Dec 13 11:27:49 1999
@@ -225,11 +225,11 @@
     if [[ "$tpre$tsuf" = */* ]]; then
       tmp2=( ${^tmp1}*(-/) )
       [[ ! -o globdots && "$PREFIX" = .* ]] &&
-          tmp2=( "$tmp1[@]" ${^tmp1}.*(-/) )
+          tmp2=( "$tmp2[@]" ${^tmp1}.*(-/) . .. )
     else
       tmp2=( ${^tmp1}${^~pats} )
       [[ ! -o globdots && "$PREFIX" = .* ]] &&
-          tmp2=( "$tmp1[@]" ${^tmp1}.${^~pats} )
+          tmp2=( "$tmp2[@]" ${^tmp1}.${^~pats} . .. )
     fi
     tmp1=( "$tmp2[@]" )
 

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

