From zsh-workers-return-20273-mason-zsh=primenet.com.au@sunsite.dk Thu Aug 19 10:23:32 2004
Return-Path: <zsh-workers-return-20273-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18874 invoked from network); 19 Aug 2004 10:23:30 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 19 Aug 2004 10:23:30 -0000
Received: (qmail 13704 invoked from network); 19 Aug 2004 10:23:24 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 19 Aug 2004 10:23:24 -0000
Received: (qmail 15509 invoked by alias); 19 Aug 2004 10:21:55 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20273
Received: (qmail 11218 invoked from network); 19 Aug 2004 07:00:15 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by 130.225.247.90 with SMTP; 19 Aug 2004 07:00:15 -0000
Received: (qmail 89935 invoked from network); 19 Aug 2004 06:58:17 -0000
Received: from cs3-ats68-81.dialup.mts-nn.ru (HELO flamante.gado) (82.208.72.81)
  by a.mx.sunsite.dk with SMTP; 19 Aug 2004 06:58:13 -0000
Received: from flamante.gado (localhost [127.0.0.1])
	by flamante.gado (8.12.11/8.12.11) with ESMTP id i7J6v3Oj007307
	for <zsh-workers@sunsite.dk>; Thu, 19 Aug 2004 10:57:03 +0400 (MSD)
Message-Id: <200408190657.i7J6v3Oj007307@flamante.gado>
From: "Denis Lagno" <dlagno@smtp.ru>
Reply-To: dlagno@smtp.ru
To: zsh-workers@sunsite.dk
Subject: history probs, build probs
Content-Type: text/plain; charset=koi8-r
Content-Transfer-Encoding: 8bit
User-Agent: nmh-1.1 (NetBSD/i386)
Date: Thu, 19 Aug 2004 10:57:03 +0400
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: **
X-Spam-Status: No, hits=2.0 required=6.0 tests=RCVD_IN_ABUSEAT autolearn=no 
	version=2.63
X-Spam-Hits: 2.0

Hi,

I use zsh-4.0.6 on NetBSD-current.
I repeatedly (probably monthly or bimonthly) observe partial
losing of history.  I lose last events, not oldest.  
History file got truncated at a sector boundary.
Of course it can be FFS softdeps related issue,
but I lose no other things.

My history related settings are:

export HISTSIZE=500000
export HISTFILE=~/.zhistory
export SAVEHIST=500000
setopt HIST_SAVE_NO_DUPS
setopt EXTENDED_HISTORY
setopt INC_APPEND_HISTORY

FWIW ~/.zhistory is symlink to other location.
Maybe symlink triggers some race condition saving history??

So I decided to build zsh-current checked out from cvs repository.
I have problems building it, both with GNU make or BSD make:

$ ./Util/preconfig
cd . && ./.preconfig

$ ./configure
configuring for zsh 4.2.1-dev-1
checking build system type... unknown-unknown-netbsd2.0G
checking host system type... unknown-unknown-netbsd2.0G
checking for gcc... gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables... 
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ANSI C... none needed
checking whether large file support needs explicit enabling... no
checking how to run the C preprocessor... gcc -E
checking for grep that handles long lines... 
checking for egrep... /usr/bin/grep -E
checking whether gcc needs -traditional... no
checking for an ANSI C-conforming const... yes
checking for gcc option to accept ANSI C... 
checking whether to use prototypes... yes
checking for working alloca.h... no
checking for alloca... yes
checking if the compiler supports union initialisation... yes
checking if signed to unsigned casting is broken... no
checking if the compiler supports variable-length arrays... yes
checking whether make sets $(MAKE)... yes
checking for a BSD-compatible install... /usr/bin/install -c
checking for gawk... no
checking for mawk... no
checking for nawk... no
checking for awk... awk
checking whether ln works... yes
checking for yodl... no
checking for ansi2knr... no
checking for dirent.h that defines DIR... yes
checking for library containing opendir... none required
checking for ANSI C header files... yes
checking whether time.h and sys/time.h may both be included... yes
checking whether stat file-mode macros are broken... no
checking for sys/wait.h that is POSIX.1 compatible... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking sys/time.h usability... yes
checking sys/time.h presence... yes
checking for sys/time.h... yes
checking sys/times.h usability... yes
checking sys/times.h presence... yes
checking for sys/times.h... yes
checking sys/select.h usability... yes
checking sys/select.h presence... yes
checking for sys/select.h... yes
checking termcap.h usability... yes
checking termcap.h presence... yes
checking for termcap.h... yes
checking termio.h usability... no
checking termio.h presence... no
checking for termio.h... no
checking termios.h usability... yes
checking termios.h presence... yes
checking for termios.h... yes
checking sys/param.h usability... yes
checking sys/param.h presence... yes
checking for sys/param.h... yes
checking sys/filio.h usability... yes
checking sys/filio.h presence... yes
checking for sys/filio.h... yes
checking for string.h... (cached) yes
checking for memory.h... (cached) yes
checking limits.h usability... yes
checking limits.h presence... yes
checking for limits.h... yes
checking fcntl.h usability... yes
checking fcntl.h presence... yes
checking for fcntl.h... yes
checking libc.h usability... no
checking libc.h presence... no
checking for libc.h... no
checking sys/utsname.h usability... yes
checking sys/utsname.h presence... yes
checking for sys/utsname.h... yes
checking sys/resource.h usability... yes
checking sys/resource.h presence... yes
checking for sys/resource.h... yes
checking locale.h usability... yes
checking locale.h presence... yes
checking for locale.h... yes
checking errno.h usability... yes
checking errno.h presence... yes
checking for errno.h... yes
checking stdio.h usability... yes
checking stdio.h presence... yes
checking for stdio.h... yes
checking for stdlib.h... (cached) yes
checking for unistd.h... (cached) yes
checking sys/capability.h usability... no
checking sys/capability.h presence... no
checking for sys/capability.h... no
checking utmp.h usability... yes
checking utmp.h presence... yes
checking for utmp.h... yes
checking utmpx.h usability... yes
checking utmpx.h presence... yes
checking for utmpx.h... yes
checking for sys/types.h... (cached) yes
checking pwd.h usability... yes
checking pwd.h presence... yes
checking for pwd.h... yes
checking grp.h usability... yes
checking grp.h presence... yes
checking for grp.h... yes
checking poll.h usability... yes
checking poll.h presence... yes
checking for poll.h... yes
checking sys/mman.h usability... yes
checking sys/mman.h presence... yes
checking for sys/mman.h... yes
checking netinet/in_systm.h usability... yes
checking netinet/in_systm.h presence... yes
checking for netinet/in_systm.h... yes
checking pcre.h usability... no
checking pcre.h presence... no
checking for pcre.h... no
checking langinfo.h usability... yes
checking langinfo.h presence... yes
checking for langinfo.h... yes
checking wchar.h usability... yes
checking wchar.h presence... yes
checking for wchar.h... yes
checking stddef.h usability... yes
checking stddef.h presence... yes
checking for stddef.h... yes
checking sys/stropts.h usability... no
checking sys/stropts.h presence... no
checking for sys/stropts.h... no
checking dlfcn.h usability... yes
checking dlfcn.h presence... yes
checking for dlfcn.h... yes
checking dl.h usability... no
checking dl.h presence... no
checking for dl.h... no
checking for conflicts in sys/time.h and sys/select.h... no
checking POSIX termios... yes
checking TIOCGWINSZ in termios.h... yes
checking for streams headers including struct winsize... no
checking for printf in -lc... yes
checking for pow in -lm... yes
checking for library containing tgetent... -ltermcap
checking for library containing tigetflag... no
checking curses.h usability... yes
checking curses.h presence... yes
checking for curses.h... yes
checking term.h usability... no
checking term.h presence... no
checking for term.h... no
checking for library containing yp_all... none required
checking for dlopen in -ldl... no
checking for socket in -lsocket... no
checking for iconv in -liconv... no
checking if an include file defines ospeed... yes
checking return type of signal handlers... void
checking for pid_t... yes
checking for off_t... yes
checking for ino_t... yes
checking for mode_t... yes
checking for uid_t in sys/types.h... yes
checking for size_t... yes
checking if long is 64 bits... no
checking if off_t is 64 bit... yes
checking if ino_t is 64 bit... no
checking if compiler has a 64 bit type... long long
checking for a corresponding unsigned 64 bit type... unsigned long long
checking for sigset_t... yes
checking for struct timezone... yes
checking for struct utmp... yes
checking for struct utmpx... yes
checking for ut_host in struct utmp... yes
checking for ut_host in struct utmpx... yes
checking for ut_xtime in struct utmpx... yes
checking for ut_tv in struct utmpx... yes
checking for d_ino in struct dirent... yes
checking for d_stat in struct dirent... no
checking for d_ino in struct direct... no
checking for d_stat in struct direct... no
checking for sin6_scope_id in struct sockaddr_in6... yes
checking if we need our own h_errno... no
checking for strftime... yes
checking for difftime... yes
checking for gettimeofday... yes
checking for select... yes
checking for poll... yes
checking for readlink... yes
checking for faccessx... no
checking for fchdir... yes
checking for ftruncate... yes
checking for fstat... yes
checking for lstat... yes
checking for lchown... yes
checking for fseeko... yes
checking for ftello... yes
checking for mkfifo... yes
checking for _mktemp... yes
checking for mkstemp... yes
checking for waitpid... yes
checking for wait3... yes
checking for sigaction... yes
checking for sigblock... yes
checking for sighold... yes
checking for sigrelse... yes
checking for sigsetmask... yes
checking for sigprocmask... yes
checking for killpg... yes
checking for setpgid... yes
checking for setpgrp... yes
checking for tcsetpgrp... yes
checking for tcgetattr... yes
checking for nice... yes
checking for gethostname... yes
checking for gethostbyname2... yes
checking for getipnodebyname... no
checking for inet_aton... yes
checking for inet_pton... yes
checking for inet_ntop... yes
checking for getlogin... yes
checking for getpwent... yes
checking for getpwnam... yes
checking for getpwuid... yes
checking for getgrgid... yes
checking for getgrnam... yes
checking for initgroups... yes
checking for nis_list... no
checking for setuid... yes
checking for seteuid... yes
checking for setreuid... yes
checking for setresuid... no
checking for setsid... yes
checking for memcpy... yes
checking for memmove... yes
checking for strstr... yes
checking for strerror... yes
checking for getrlimit... yes
checking for setlocale... yes
checking for uname... yes
checking for signgam... yes
checking for putenv... yes
checking for getenv... yes
checking for brk... yes
checking for sbrk... yes
checking for pathconf... yes
checking for sysconf... yes
checking for tgetent... yes
checking for tigetflag... no
checking for tigetnum... no
checking for tigetstr... no
checking for setupterm... no
checking for pcre_compile... no
checking for pcre_study... no
checking for pcre_exec... no
checking for nl_langinfo... yes
checking for erand48... yes
checking for open_memstream... no
checking for wctomb... yes
checking for iconv... yes
checking for grantpt... yes
checking for unlockpt... yes
checking for ptsname... yes
checking for htons... yes
checking for ntohs... yes
checking for working strcoll... yes
checking if tgetent accepts NULL... no
checking if tgetent returns 0 on success... no
checking for stdlib.h... (cached) yes
checking for unistd.h... (cached) yes
checking for getpagesize... yes
checking for working mmap... yes
checking for munmap... yes
checking for msync... yes
checking whether getpgrp requires zero arguments... yes
checking for dlopen... yes
checking for dlerror... yes
checking for dlsym... yes
checking for dlclose... yes
checking for load... no
checking for loadquery... no
checking for loadbind... no
checking for unload... no
checking for shl_load... no
checking for shl_unload... no
checking for shl_findsym... no
checking what style of signals to use... POSIX_SIGNALS
checking where signal.h is located... /usr/include/sys/signal.h
checking where error names are located... /usr/include/sys/errno.h
checking where the RLIMIT macros are located... /usr/include/sys/resource.h
checking if rlim_t is longer than a long... yes
checking if rlim_t is a quad... yes
checking for rlim_t... yes
checking for limit RLIMIT_AIO_MEM... no
checking for limit RLIMIT_AIO_OPS... no
checking for limit RLIMIT_AS... no
checking for limit RLIMIT_LOCKS... no
checking for limit RLIMIT_MEMLOCK... yes
checking for limit RLIMIT_NPROC... yes
checking for limit RLIMIT_NOFILE... yes
checking for limit RLIMIT_PTHREAD... no
checking for limit RLIMIT_RSS... yes
checking for limit RLIMIT_SBSIZE... yes
checking for limit RLIMIT_TCACHE... no
checking for limit RLIMIT_VMEM... no
checking if RLIMIT_VMEM and RLIMIT_RSS are the same... no
checking if RLIMIT_VMEM and RLIMIT_AS are the same... no
checking for /dev/fd filesystem... /proc/self/fd
checking for RFS superroot directory... no
checking whether we should use the native getcwd... no
checking for NIS... no
checking for NIS+... no
checking for utmp file... /var/run/utmp
checking for wtmp file... /var/log/wtmp
checking for utmpx file... /var/run/utmpx
checking for wtmpx file... /var/log/wtmpx
checking for brk() prototype in <unistd.h>... yes
checking for sbrk() prototype in <unistd.h>... yes
checking for ioctl prototype in <sys/ioctl.h>... yes
checking for mknod prototype in <sys/stat.h>... yes
checking if named FIFOs work... yes
checking if echo in /bin/sh interprets escape sequences... no
checking if link() works... yes
checking if kill(pid, 0) returns ESRCH correctly... yes
checking if POSIX sigsuspend() works... yes
checking if tcsetpgrp() actually works... yes
checking if getpwnam() is faked... no
checking base type of the third argument to accept... socklen_t
checking if your system has /dev/ptmx... yes
checking if /dev/ptmx is usable... yes
checking if your system uses ELF binaries... yes
checking if your dlsym() needs a leading underscore... no
checking if environ is available in shared libraries... yes
checking if tgetent is available in shared libraries... yes
checking if name clashes in shared objects are OK... yes
checking for working RTLD_GLOBAL... yes
checking whether symbols in the executable are available... no
checking whether executables can be stripped... yes
checking whether libraries can be stripped... yes
./configure:15456: functions: attempt to set slice of associative array
configure: creating ./config.status
config.status: creating Config/defs.mk
config.status: creating Makefile
config.status: creating Doc/Makefile
config.status: creating Etc/Makefile
config.status: creating Src/Makefile
config.status: creating Test/Makefile
config.status: creating config.h
config.status: executing config.modules commands
creating ./config.modules
config.status: executing stamp-h commands

zsh configuration
-----------------
zsh version               : 4.2.1-dev-1
host operating system     : unknown-unknown-netbsd2.0G
source code location      : .
compiler                  : gcc
preprocessor flags        : 
executable compiler flags :  -Wall -Wmissing-prototypes -O2
module compiler flags     :  -Wall -Wmissing-prototypes -O2 -fPIC
executable linker flags   :   -s 
module linker flags       :   -s -Wl,-x -shared --whole-archive
library flags             : -ltermcap -lm  -lc
installation basename     : zsh
binary install path       : /usr/local/bin
man page install path     : /usr/local/man
info install path         : /usr/local/info
functions install path    : /usr/local/share/zsh/4.2.1-dev-1/functions
See config.modules for installed modules and functions.

$ gmake
gmake[1]: Entering directory `/volatile/worksrc/zsh/Src'
cd .. && /bin/sh $top_srcdir/Src/mkmakemod.sh Src Makemod
creating Src/Makemod.in
config.status: creating Src/Makemod
gmake[2]: Entering directory `/volatile/worksrc/zsh/Src'
echo 'timestamp for *.mdd files' > ../Src/modules.stamp
gmake[2]: Leaving directory `/volatile/worksrc/zsh/Src'
gmake[2]: Entering directory `/volatile/worksrc/zsh/Src'
gmake[2]: Leaving directory `/volatile/worksrc/zsh/Src'
rm -f stamp-modobjs.tmp
gmake[2]: Entering directory `/volatile/worksrc/zsh/Src'
gmake[2]: Leaving directory `/volatile/worksrc/zsh/Src'
mv: rename stamp-modobjs.tmp to stamp-modobjs: No such file or directory
Updated `stamp-modobjs'.
rm -f libzsh-4.2.1-dev-1.so
gcc  -s -Wl,-x -shared --whole-archive -o libzsh-4.2.1-dev-1.so  `cat stamp-modobjs` -ltermcap -lm  -lc
cat: stamp-modobjs: No such file or directory
gmake[2]: Entering directory `/volatile/worksrc/zsh/Src'
gcc -c -I.  -DHAVE_CONFIG_H -Wall -Wmissing-prototypes -O2 -fPIC -o main.o main.c
main.c:30:19: zsh.mdh: No such file or directory
main.c:31:20: main.pro: No such file or directory
main.c: In function `main':
main.c:93: warning: implicit declaration of function `zsh_main'
gmake[2]: *** [main.o] Error 1
gmake[2]: Leaving directory `/volatile/worksrc/zsh/Src'
gmake[1]: *** [main.o] Error 2
gmake[1]: Leaving directory `/volatile/worksrc/zsh/Src'
gmake: *** [all] Error 1

$ make
rm -f stamp-modobjs.tmp
mv: rename stamp-modobjs.tmp to stamp-modobjs: No such file or directory
Updated `stamp-modobjs'.
rm -f libzsh-4.2.1-dev-1.so
gcc  -s -Wl,-x -shared --whole-archive -o libzsh-4.2.1-dev-1.so  `cat stamp-modobjs` -ltermcap -lm  -lc
cat: stamp-modobjs: No such file or directory
gcc -c -I.  -DHAVE_CONFIG_H -Wall -Wmissing-prototypes -O2 -fPIC -o main.o main.c
main.c:30:19: zsh.mdh: No such file or directory
main.c:31:20: main.pro: No such file or directory
main.c: In function `main':
main.c:93: warning: implicit declaration of function `zsh_main'
*** Error code 1

Stop.
make: stopped in /var/worksrc/zsh/Src
*** Error code 1

Stop.
make: stopped in /var/worksrc/zsh/Src
*** Error code 1

Stop.
make: stopped in /var/worksrc/zsh

--
Denis Lagno,
PGP key fingerprint: F94F F38F 1895 E673 4374 9D63 2B9E FAB3 8E83 584C

