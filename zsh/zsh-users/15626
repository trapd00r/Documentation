From zsh-users-return-15626-mason-zsh=primenet.com.au@zsh.org Mon Dec 06 19:03:09 2010
Return-Path: <zsh-users-return-15626-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19800 invoked by alias); 6 Dec 2010 19:03:09 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15626
Received: (qmail 26411 invoked from network); 6 Dec 2010 19:02:58 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at noid.net does not designate permitted sender hosts)
X-Mini-Diatribe: To fix America:
	1. Cut government in half
	2. Wait thirty years
	3. Repeat as necessary
From: zsh@noid.net
To: zsh-users@zsh.org
Subject: multiline ZLE w/ bash-like single line .zsh_history...?
Message-Id: <20101206190255.4B3CA1ED691A@scythe.noid.net>
Date: Mon,  6 Dec 2010 11:02:55 -0800 (PST)



Hi,

I like the multiline capability of ZLE, but when history lines are
appended to the .zsh_history file, I would like for multiline commands
to be morphed into a single line (similar to what bash does).

This is because I sometimes like to grep (or even edit) .zsh_history,
and if I find the command I'm looking for, I want to be able copy and
paste it into a new shell w/o having to make any changes to it.

For example, if I enter a multiline command like so:

  % echo \
  `> foo

... And then use 'up-line-or-history', I'll get to see it still as a
multiline in ZLE (which is good).  The line is not yet in my
.zsh_history file, because I have not set the INC_APPEND_HISTORY
option.

If I exit the shell and inspect .zsh_history, I see these two lines:

  echo \\
  foo

In bash (which does not have the excellent multiline capability), I
would see a single line, like so:

  echo foo

If I simply copy and paste the multiline entry, it will not behave the
way my original command did because of the double slash '\\'...

Is there a way to get zsh to be bash-like when it writes to the
history file...?  I'm willing to lose the multiline niceness for old
commands in new shells.

I have zsh setup to keep a smaller internal history and a larger
external history with these settings:

  HISTSIZE=9999  # internal
  SAVEHIST=99999 # external
  HISTFILE=$HOME/.zsh_history

And I have these helper aliases defined:

  alias history="fc -IA ; cat $HISTFILE" # access external history too
  alias h=history                        # a shortcut...

So when I want to find a really old command (usually because
history-incremental-search-backward failed to find it), I may do
something like this:

  h | grep 'some old cmd'

And here, again, having the history saved as a single line would be
helpful, because the output would be ready for copy and paste...

Maybe I do not know the "zsh way" to best do what I'm hoping to be
able to do...  Can I keep multiline in ZLE but lose it in HISTFILE?

Thanks for your time and consideration!

- Tor


