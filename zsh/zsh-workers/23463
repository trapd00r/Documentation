From zsh-workers-return-23463-mason-zsh=primenet.com.au@sunsite.dk Wed May 23 15:01:23 2007
Return-Path: <zsh-workers-return-23463-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23295 invoked from network); 23 May 2007 15:01:22 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.0 (2007-05-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=no
	version=3.2.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 May 2007 15:01:22 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 71916 invoked from network); 23 May 2007 15:01:16 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 May 2007 15:01:16 -0000
Received: (qmail 16724 invoked by alias); 23 May 2007 15:01:12 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23463
Received: (qmail 16714 invoked from network); 23 May 2007 15:01:11 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 23 May 2007 15:01:11 -0000
Received: (qmail 71603 invoked from network); 23 May 2007 15:01:11 -0000
Received: from vms042pub.verizon.net (206.46.252.42)
  by a.mx.sunsite.dk with SMTP; 23 May 2007 15:01:07 -0000
Received: from torch.brasslantern.com ([71.116.88.130])
 by vms042.mailsrvcs.net (Sun Java System Messaging Server 6.2-6.01 (built Apr
 3 2006)) with ESMTPA id <0JII00M0H1PFT4O6@vms042.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Wed, 23 May 2007 10:00:52 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id l4NF0ox3005967	for
 <zsh-workers@sunsite.dk>; Wed, 23 May 2007 08:00:50 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id l4NF0n4n005966	for zsh-workers@sunsite.dk; Wed,
 23 May 2007 08:00:49 -0700
Date: Wed, 23 May 2007 08:00:49 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: Subshell with multios causes hang
In-reply-to: <20070523111203.299233ec@news01.csr.com>
To: Zsh-Workers <zsh-workers@sunsite.dk>
Message-id: <070523080049.ZM5965@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <1179832903.3015.505.camel@aston.uk.cyberscience.com>
	<20070522182925.4c43a67e@news01.csr.com>
	<20070523111203.299233ec@news01.csr.com>
Comments: In reply to Peter Stephenson <pws@csr.com>
 "Re: Subshell with multios causes hang" (May 23, 11:12am)

On May 23, 11:12am, Peter Stephenson wrote:
}
} So what I've done is:

This all sounds sane to me.

I also agree with John's child blocking tweak for the race condition.

} I don't think it's straightforward to set up the multios before we
} fork, since globbing is allowed in multios and that's done after
} forking.

I don't think it's workable to push this up a level in any case. You
can always construct an example where "up a level" is still a subshell
and the problem returns.  To try to have the topmost shell "lift" all
the globs and multios out of the subshells would introduce sequencing
problems with complex commands that expect to be able to create a file
and then glob its name or redirect from it.

