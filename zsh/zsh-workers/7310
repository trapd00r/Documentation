From zsh-workers-return-7310-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Jul 28 17:23:55 1999
Return-Path: <zsh-workers-return-7310-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5651 invoked from network); 28 Jul 1999 17:23:53 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 28 Jul 1999 17:23:53 -0000
Received: (qmail 3823 invoked by alias); 28 Jul 1999 17:23:40 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7310
Received: (qmail 3816 invoked from network); 28 Jul 1999 17:23:39 -0000
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: _cvs
MIME-Version: 1.0 (generated by AKEMI 1.13.2 - =?ISO-2022-JP?B?Ig==?=
 =?ISO-2022-JP?B?GyRCQTA0Y0s8GyhCIg==?=)
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@jaist.ac.jp>
Date: 29 Jul 1999 02:23:37 +0900
Message-ID: <rsqvhb4bsdi.fsf@crane.jaist.ac.jp>
Lines: 99
User-Agent: Chao-gnus/6.12.5 AKEMI/1.13.2 (=?ISO-2022-JP?B?GyRCQTAbKEI=?=
 =?ISO-2022-JP?B?GyRCNGNLPBsoQg==?=) FLAM-DOODLE/1.12.6
 (=?ISO-2022-JP?B?GyRCM3cbKEI=?= 10R4.0/5.0) Emacs/20.4
 (sparc-sun-solaris2.6) MULE/4.0 (HANANOEN)

Hm. Since cvsignore may have patterns instead of concrete filenames, 
_cvs should not quote them.

--- Completion/User/_cvs	Thu Jul 29 01:09:13 1999
+++ Completion/User/_cvs	Thu Jul 29 02:17:47 1999
@@ -198,7 +198,7 @@
 _cvsdirentries () {
   setopt localoptions nullglob unset
   if [[ -f ${pref}CVS/Entries ]]; then
-    entries=( ${${${(M)${(f)"$(<${pref}CVS/Entries)"}:#D/*}#D/}%%/*} )
+    entries=( ${${${${(M)${(f)"$(<${pref}CVS/Entries)"}:#D/*}#D/}%%/*}:q} )
   else
     entries=()
   fi
@@ -207,7 +207,7 @@
 _cvsentries () {
   setopt localoptions nullglob unset
   if [[ -f ${pref}CVS/Entries ]]; then
-    entries=( ${${${${(f)"$(<${pref}CVS/Entries)"}:#D}#(D|)/}%%/*} )
+    entries=( ${${${${${(f)"$(<${pref}CVS/Entries)"}:#D}#(D|)/}%%/*}:q} )
   else
     entries=()
   fi
@@ -234,13 +234,13 @@
   local OLDTZ="$TZ"; if ! (( $+TZ )); then unset OLDTZ; fi; export TZ=GMT
 
   mtime=( ${(s:/:)${(j:/:)${${${${(M)${(f)Entries}:#/*}#/}%/*/*}/\\/*\\///}}} )
-  entries=( ${${${(M)${(f)Entries}:#D/*}#D/}%%/*} )
+  entries=( ${${${${(M)${(f)Entries}:#D/*}#D/}%%/*}:q} )
   builtin stat -n +mtime -F '%a %b %e %T %Y' "$pref${(@k)^mtime}" |
   while read line
   do
     line=${line#$pref}
     if [[ x"$mtime[${line%% *}]" != x"${line#* }" ]]; then
-      entries=($entries "${line%% *}")
+      entries=($entries "${${line%% *}:q}")
     fi
   done
 
@@ -252,8 +252,8 @@
     _cvsdirentries
     case $#entries in
       0) false;;
-      1) compgen "$@" -g "${entries:q}";;
-      *) compgen "$@" -g '('${(j:|:)entries:q}')';;
+      1) compgen "$@" -g "$entries";;
+      *) compgen "$@" -g '('${(j:|:)entries}')';;
     esac
   else
     _files
@@ -267,8 +267,8 @@
     _cvsentries
     case $#entries in
       0) false;;
-      1) compgen -g "${entries:q}";;
-      *) compgen -g '('${(j:|:)entries:q}')';;
+      1) compgen -g "$entries";;
+      *) compgen -g '('${(j:|:)entries}')';;
     esac
   else
     _files
@@ -282,8 +282,8 @@
     _cvsentries_modified
     case $#entries in
       0) false;;
-      1) compgen -g "${entries:q}";;
-      *) compgen -g '('${(j:|:)entries:q}')';;
+      1) compgen -g "$entries";;
+      *) compgen -g '('${(j:|:)entries}')';;
     esac
   else
     _files 
@@ -297,9 +297,9 @@
     _cvsentries
     setopt localoptions unset
     local omit
-    omit=( ${pref}*(D:t) )
-    eval 'entries=( ${entries:#('${(j:|:)omit:q}')} )'
-    compadd -P "$qpref" - ${entries:q} ||
+    omit=( ${pref}*(D:t:q) )
+    eval 'entries=( ${entries:#('${(j:|:)omit}')} )'
+    compadd -P "$qpref" - ${entries} ||
     _cvsdirs
   else
     _files
@@ -316,8 +316,8 @@
     omit=( CVS $entries ${=cvsignore} )
     [[ -r ~/.cvsignore ]] && omit=( $omit $(<~/.cvsignore) )
     [[ -r ${pref}.cvsignore ]] && omit=( $omit $(<${pref}.cvsignore) )
-    compgen -g '*~(*/|)('${(j:|:)omit:q}')(D)' ||
-    { _cvsdirentries; compgen -g '('${(j:|:)entries:q}')(D)' }
+    compgen -g '*~(*/|)('${(j:|:)omit}')(D)' ||
+    { _cvsdirentries; compgen -g '('${(j:|:)entries}')(D)' }
   else
     _files
   fi

-- 
Tanaka Akira

