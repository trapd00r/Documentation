From zsh-workers-return-28460-mason-zsh=primenet.com.au@zsh.org Sat Nov 27 02:04:10 2010
Return-Path: <zsh-workers-return-28460-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29769 invoked by alias); 27 Nov 2010 02:04:10 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28460
Received: (qmail 17395 invoked from network); 27 Nov 2010 02:03:57 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,HTML_MESSAGE,RCVD_IN_DNSWL_NONE autolearn=ham version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 74.125.82.171 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:sender:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:cc:content-type;
        bh=rJDVQI0bPi3mmDxNKK5tQ9UG0VIi37CgbHfSemG4iUw=;
        b=qDeq1eJD1kzXoaUL9Yrc9A4VmPdWWRnpw51dUX5hX1F4nB7+PGlqxPLdrOyMuHIATS
         1Rtprpm/V/m+750voD8jwY+BJkDifVRl05pwZMlFBPdwVM9l6ewnuwSa3XElAbYvDu54
         gXlItpN0W9+eRP1Bnuqz8RYEajEm3ABbxPKF8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
        b=CLJtN0ui1S6oj467wNLt3/lqZFC2oCrfPxs/sU2Q50UZ9e38opcrH4Xh+VmfL3XSBg
         mb0h4LfnFtUHrApcDsBW/RN7OdcGeFy9HlK7vGTeIbihztwATtH4tV9SnU3/tRWtmU/I
         DDe83JXzSEYQTiGjlSPr3ObvWZhhXeWzToLls=
MIME-Version: 1.0
Sender: 4wayned@gmail.com
In-Reply-To: <20101126225316.325fa5ca@pws-pc.ntlworld.com>
References: <20101126115148.GT1254@prunille.vinc17.org>
	<101126093810.ZM25915@torch.brasslantern.com>
	<20101126225316.325fa5ca@pws-pc.ntlworld.com>
Date: Fri, 26 Nov 2010 18:03:53 -0800
X-Google-Sender-Auth: 9OwOtc5hmlkI2gsME3WPNqcVi8Y
Message-ID: <AANLkTikCvm+68U+xq73=f4VAc2OD-xwvAUT9ejxM9v0S@mail.gmail.com>
Subject: Re: PROMPT_SP bug with local in precmd
From: Wayne Davison <wayned@users.sourceforge.net>
To: Peter Stephenson <p.w.stephenson@ntlworld.com>
Cc: zsh-workers@zsh.org
Content-Type: multipart/alternative; boundary=0016e6dd97b7343f540495ff40dc

--0016e6dd97b7343f540495ff40dc
Content-Type: text/plain; charset=UTF-8

On Fri, Nov 26, 2010 at 2:53 PM, Peter Stephenson <
p.w.stephenson@ntlworld.com> wrote:

> I hope I'm not undoing any magic with this.
>

That added fflush() seems like a good idea to me. I had assumed that shout
wasn't buffered, but that appears to not be the case.  Since the exit-output
cited above is going to stderr (I'm assuming that is coming from exec.c
around line 3188), your added flush should ensure that the PROMPT_SP "magic"
always gets output prior to the following use of stderr, and that should
make it work more consistently.

..wayne..

--0016e6dd97b7343f540495ff40dc--

