From zsh-workers-return-5577-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Mar 01 13:30:33 1999
Return-Path: <zsh-workers-return-5577-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26865 invoked from network); 1 Mar 1999 13:30:31 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 1 Mar 1999 13:30:31 -0000
Received: (qmail 28306 invoked by alias); 1 Mar 1999 13:30:09 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5577
Received: (qmail 28299 invoked from network); 1 Mar 1999 13:30:08 -0000
Date: Mon, 1 Mar 1999 14:29:26 +0100 (MET)
Message-Id: <199903011329.OAA13941@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Peter Stephenson's message of Mon, 01 Mar 1999 14:04:03 +0100
Subject: Re: PATCH: completion parameters etc.


Peter Stephenson wrote:

> There's a stray zsfree(compcommand) in finish_comp1() in comp1.c;
> compcommand is not mentioned anywhere else any more, can I just delete it?
> Also, there's a pm_type(...) in compunsetfn in compctl.c, that should
> probably be PM_TYPE(...).

But here I could compile it... that's what you get for using
dynamically loaded modules, I guess.

Bye
 Sven

diff -u os/Zle/comp1.c Src/Zle/comp1.c
--- os/Zle/comp1.c	Mon Mar  1 13:20:06 1999
+++ Src/Zle/comp1.c	Mon Mar  1 14:28:27 1999
@@ -457,11 +457,20 @@
     deletehashtable(compctltab);
     zfree(clwords, clwsize * sizeof(char *));
     compctlreadptr = fallback_compctlread;
-    zsfree(compcontext);
-    zsfree(compcommand);
+    freearray(compwords);
     zsfree(compprefix);
-    zsfree(compiprefix);
     zsfree(compsuffix);
+    zsfree(compiprefix);
+    zsfree(compmatcherstr);
+    zsfree(compcontext);
+    zsfree(compparameter);
+    zsfree(compredirect);
+    zsfree(compquote);
+    zsfree(compquoting);
+    zsfree(comprestore);
+    zsfree(complist);
+    zsfree(compinsert);
+    zsfree(compexact);
     return 0;
 }
 
diff -u os/Zle/compctl.c Src/Zle/compctl.c
--- os/Zle/compctl.c	Mon Mar  1 13:20:06 1999
+++ Src/Zle/compctl.c	Mon Mar  1 14:26:47 1999
@@ -1960,7 +1960,7 @@
 	if (PM_TYPE(pm->flags) == PM_SCALAR) {
 	    zsfree(*((char **) pm->u.data));
 	    *((char **) pm->u.data) = ztrdup("");
-	} else if (pm_type(pm->flags) == PM_ARRAY) {
+	} else if (PM_TYPE(pm->flags) == PM_ARRAY) {
 	    freearray(*((char ***) pm->u.data));
 	    *((char ***) pm->u.data) = zcalloc(sizeof(char *));
 	}

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

