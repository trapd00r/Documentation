From zsh-workers-return-9961-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Mar 01 18:21:54 2000
Return-Path: <zsh-workers-return-9961-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6687 invoked from network); 1 Mar 2000 18:21:52 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 1 Mar 2000 18:21:52 -0000
Received: (qmail 11581 invoked by alias); 1 Mar 2000 18:21:45 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9961
Received: (qmail 11557 invoked from network); 1 Mar 2000 18:21:43 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000301182139.ZM11795@candle.brasslantern.com>
Date: Wed, 1 Mar 2000 18:21:39 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: Misc. module stuff
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

"make check" now fails for statically linked zsh because zpty is not a
standard linked-in module.  I can't think of any reasonable fix except
to make the failure somewhat less noisy by attempting to load zpty in
the %prep section of 53completion.ztst.

Then while attempting to get zpty linked in so that I could run the test,
I discovered that INSTALL is somewhat out of date with respect to usage
of mymods.conf, and that adding a mymods.conf did not cause a rebuild of
modules-bltin and its dependents, nor did editing xmods.conf directly.

I added a dummy rule for building mymods.conf so that make won't choke
on a dependency on it for modules-bltin.

Index: INSTALL
===================================================================
@@ -97,6 +97,13 @@
 module name per line with no punctuation and no suffix.  See the zshmodules
 manual page for the list of available modules.
 
+Note that mymods.conf replaces the standard list of linked-in modules from
+Src/xmods.conf.  If you wish to add to the standard list, copy the lines
+that begin with "L " from xmods.conf into mymods.conf and remove the "L "
+from each such line in mymods.conf.  Then add the names of other modules
+that you want to link.  Module names typically must begin with "zsh/";
+only modules appearing in Src/Aliases/*.mdd may omit the "zsh/" prefix.
+
 Note that the modules depending on zle or complete (e.g.: complist and
 deltochar) cannot be loaded dynamically on systems which do not allow symbols
 in one dynamically loaded library to be visible from another; this is true,
Index: Src/Makefile.in
===================================================================
@@ -128,7 +128,10 @@
 
 # ========== LINKING IN MODULES ==========
 
-modules-bltin: Makefile
+mymods.conf:
+	@echo Linking with the standard modules.
+
+modules-bltin: Makefile $(sdir)/xmods.conf mymods.conf
 	if test -f mymods.conf; then \
 	    cat mymods.conf > $@; \
 	elif test @D@ = N; then \
Index: Test/53completion.ztst
===================================================================
@@ -1,6 +1,7 @@
 # Tests for completion system.
 
 %prep
+  zmodload -i zsh/zpty
 
   comptest () { $ZTST_testdir/../Src/zsh -f $ZTST_srcdir/comptest -z $ZTST_testdir/../Src/zsh -d $ZTST_testdir/compdump.tmp "$@" }
 
Index: Test/comptest
===================================================================
@@ -1,6 +1,6 @@
 #!/usr/local/bin/zsh -f
 
-zmodload zsh/zpty
+zmodload -i zsh/zpty
 setopt extendedglob
 
 debug=

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

