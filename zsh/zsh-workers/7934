From zsh-workers-return-7934-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Sep 19 00:49:49 1999
Return-Path: <zsh-workers-return-7934-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13645 invoked from network); 19 Sep 1999 00:49:48 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 19 Sep 1999 00:49:48 -0000
Received: (qmail 4686 invoked by alias); 19 Sep 1999 00:49:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7934
Received: (qmail 4674 invoked from network); 19 Sep 1999 00:49:33 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <990919004929.ZM6808@candle.brasslantern.com>
Date: Sun, 19 Sep 1999 00:49:29 +0000
In-Reply-To: <rsqaeqm73t4.fsf@crane.jaist.ac.jp>
Comments: In reply to Tanaka Akira <akr@jaist.ac.jp>
        "Re: PATCH: _hosts, _hostports, _telnet and _socket" (Sep 17,  9:57am)
References: <000001befd11$ba0b0bb0$21c9ca95@mow.siemens.ru> 
	<rsqvh9g8gf2.fsf@crane.jaist.ac.jp> 
	<rsqaeqm73t4.fsf@crane.jaist.ac.jp>
X-Mailer: Z-Mail (5.0.0 30July97)
To: <zsh-workers@sunsite.auc.dk>
Subject: Re: PATCH: _hosts, _hostports, _telnet and _socket
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Sep 17,  9:57am, Tanaka Akira wrote:
} Subject: Re: PATCH: _hosts, _hostports, _telnet and _socket
}
} In article <rsqvh9g8gf2.fsf@crane.jaist.ac.jp>,
}   Tanaka Akira <akr@jaist.ac.jp> writes:
} 
} > I agree that `telnet' has many variants and `_telnet' should complete
} > only valid options of `telnet' if it is possible.
} 
} Following patch tries this.

A minor improvement ...

Index: Completion/User/_telnet
===================================================================
@@ -9,55 +9,47 @@
 typeset -A options
 
 if (( ! $+_telnet_short )); then
-  local help="$(telnet -\? < /dev/null 2>&1)"
+  local k help="$(telnet -\? < /dev/null 2>&1)"
+  local -A optionmap
+  optionmap=( "[-8]" '-8[allow 8-Bit data]' \
+              "[-E]" '-E[disable an escape character]' \
+              "[-K]" '-K[no automatic login]' \
+              "[-L]" '-L[allow 8-Bit data on output]' \
+              "[-N]" '-N[supress reverse lookup]' \
+              "[-S tos]" '-S+:IP type-of-service:' \
+              "[-X atype]" '-X+:authentication type to disable:' \
+              "[-a]" '-a[attempt automatic login]' \
+              "[-c]" '-c[disable .telnetrc]' \
+              "[-d]" '-d[debug mode]' \
+              "[-e char]" '-e+[specify escape character]:escape character:' \
+              "[-f/" '-f' \
+              "/-F]" '-F' \
+              "[-k realm]" '-k+:realm:' \
+              "[-l user]" '-l+[specify user]:user:->users' \
+              "[-n tracefile]" '-n+[specify tracefile]:tracefile:_files' \
+              "[-r]" '-r[rlogin like user interface]' \
+              "[-s src_addr]" '-s+[set source IP address]:src_addr:' \
+              "[-x]" '-x' \
+              "[-t transcom]" '-t+:transcom:' )
+
   _telnet_short=()
-  [[ "$help" = *"[-8]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-8[allow 8-Bit data]')
-  [[ "$help" = *"[-E]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-E[disable an escape character]')
-  [[ "$help" = *"[-K]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-K[no automatic login]')
-  [[ "$help" = *"[-L]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-L[allow 8-Bit data on output]')
-  [[ "$help" = *"[-N]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-N[supress reverse lookup]')
-  [[ "$help" = *"[-S tos]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-S+:IP type-of-service:')
-  [[ "$help" = *"[-X atype]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-X+:authentication type to disable:')
-  [[ "$help" = *"[-a]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-a[attempt automatic login]')
-  [[ "$help" = *"[-c]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-c[disable .telnetrc]')
-  [[ "$help" = *"[-d]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-d[debug mode]')
-  [[ "$help" = *"[-e char]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-e+[specify escape character]:escape character:')
-  [[ "$help" = *"[-f/-F]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-f' '-F')
-  [[ "$help" = *"[-k realm]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-k+:realm:')
-  [[ "$help" = *"[-l user]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-l+[specify user]:user:->users')
-  [[ "$help" = *"[-n tracefile]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-n+[specify tracefile]:tracefile:_files')
-  [[ "$help" = *"[-r]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-r[rlogin like user interface]')
-  [[ "$help" = *"[-s src_addr]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-s+[set source IP address]:src_addr:')
-  [[ "$help" = *"[-x]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-x')
-  [[ "$help" = *"[-t transcom]"* ]] &&
-    _telnet_short=("$_telnet_short[@]" '-t+:transcom:')
+  for k in ${(k)optionmap}
+  do
+    [[ "$help" = *"$k"* ]] &&
+      _telnet_short=( "$_telnet_short[@]" "$optionmap[$k]" )
+  done
 
   # _arguments cannot handle following three options.
+  optionmap=( "[-noasynch]" '-noasynch' \
+              "[-noasyncnet]" '-noasyncnet' \
+              "[-noasynctty]" '-noasynctty' )
+
   _telnet_long=()
-  [[ "$help" = *"[-noasynch]"* ]] &&
-    _telnet_long=("$_telnet_long[@]" '-noasynch')
-  [[ "$help" = *"[-noasyncnet]"* ]] &&
-    _telnet_long=("$_telnet_long[@]" '-noasyncnet')
-  [[ "$help" = *"[-noasynctty]"* ]] &&
-    _telnet_long=("$_telnet_long[@]" '-noasynctty')
+  for k in ${(k)optionmap}
+  do
+    [[ "$help" = *"$k"* ]] &&
+      _telnet_long=( "$_telnet_long[@]" "$optionmap[$k]" )
+  done
 fi
 
 [[ $#_telnet_long != 0 && (

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

