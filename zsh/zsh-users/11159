From zsh-users-return-11159-mason-zsh=primenet.com.au@sunsite.dk Tue Jan 30 18:30:49 2007
Return-Path: <zsh-users-return-11159-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8349 invoked from network); 30 Jan 2007 18:30:43 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 30 Jan 2007 18:30:43 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 79185 invoked from network); 30 Jan 2007 18:30:37 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 30 Jan 2007 18:30:36 -0000
Received: (qmail 7745 invoked by alias); 30 Jan 2007 18:30:27 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11159
Received: (qmail 7735 invoked from network); 30 Jan 2007 18:30:26 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 30 Jan 2007 18:30:26 -0000
Received: (qmail 77917 invoked from network); 30 Jan 2007 18:30:26 -0000
Received: from web36812.mail.mud.yahoo.com (209.191.85.63)
  by a.mx.sunsite.dk with SMTP; 30 Jan 2007 18:30:19 -0000
Received: (qmail 98616 invoked by uid 60001); 30 Jan 2007 18:30:18 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=X-YMail-OSG:Received:Date:From:Subject:To:MIME-Version:Content-Type:Content-Transfer-Encoding:Message-ID;
  b=V0mqMBVDbiMpgD5BYLeNB8jI51Nme8cjApL5NNwBAK2epvA7cT9+oMGPOjcAIkNturnGM99ywOL3rFRtEWijePAY8a7wrAb7peSrIq3gNg9esgti6LCsrxu8oUayH/lLBCkGoebu5Ub3Tngso7LBGWxlOUqQTQdQq/3qyK1BHHk=;
X-YMail-OSG: 2tSvWNwVM1l2HZUo0STctCNmrjGcxQGt2m.sTM2ACDo5hiM.vRL9NWSLWrwEu6cTh19ZVkBvuhwLi.dAIIpb2Tc0gq838u1jcMcsawZyttjhYjEK3hlblbPfm4DitOPos7dvovSg0zvNi9m4rRDVAMw8kIGvmzcP
Received: from [88.114.230.68] by web36812.mail.mud.yahoo.com via HTTP; Tue, 30 Jan 2007 10:30:18 PST
Date: Tue, 30 Jan 2007 10:30:18 -0800 (PST)
From: Daniel Qarras <dqarras@yahoo.com>
Subject: Re: zsh handling of non-standard if-evaluations
To: zsh-users@sunsite.dk
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
Message-ID: <163305.96211.qm@web36812.mail.mud.yahoo.com>

Hi!

> > } Hmm, my login shell is zsh and I've set in my ~/.zshenv:
> > } 
> > } . /etc/profile
> > } 
> > } which in turns goes thru /etc/profile.d/*.sh and one of those
> > scripts
> > } is from the proprietary application. So perhaps I should do
> "setopt
> > } no_equals" before the above mentioned line?
> > 
> > Generally speaking ~/.zshenv is too early in the startup script
> order
> > to be reading /etc/profile from there.  If you need to read
> > /etc/profile you should do it from ~/.zprofile.
> 
> Good point. I definitely need to do it, I have an account on several
> machines where admins and applications add scripts under
> /etc/profile.d
> to set up various things like paths and variables.
> 
> > your original state, you need something like this:
> > 
> >     zmodload -i zsh/parameter && {
> >       __zsh=( ${(kv)options} )
> >       emulate sh
> >       . /etc/profile
> >       emulate zsh
> >       options=( $__zsh )
> >       unset __zsh
> >     }
> > 
> > This has the side-effect of vacating any option settings from any
> > scripts
> > in /etc/profile.d that happen to know about zsh, but I think of
> that
> > as a good thing.
> 
> I need to test this a bit. I'll get back to this when I've done some
> experiments.

Uh, oh..

I am testing this under RHEL4 / FC6, both have zsh RPMs that comes with
/etc/zprofile which has the following lines:

# source profile
if [ -f /etc/profile ]; then
        source /etc/profile
fi

And this is also failing. I made a bug for RH about this at:

https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=225454

But.. reading more about this it seems that placing settings etc in zsh
startup scripts seems to be a source for endless debate.

For example, admin sets locales in /etc/profile but I want use locale
settings I set up in my init files in any case. .zshenv would be
logical, I guess, but it's too early as /etc/profile gets sources
later. .zprofile won't work because it's not sources when starting an
xterm. And .zshrc is no good because it's not sourced when session is
not interactive!

D'oh!




 
____________________________________________________________________________________
Bored stiff? Loosen up... 
Download and play hundreds of games for free on Yahoo! Games.
http://games.yahoo.com/games/front

