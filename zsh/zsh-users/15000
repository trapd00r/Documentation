From zsh-users-return-15000-mason-zsh=primenet.com.au@zsh.org Sat Apr 10 17:37:22 2010
Return-Path: <zsh-users-return-15000-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2973 invoked by alias); 10 Apr 2010 17:37:21 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15000
Received: (qmail 21431 invoked from network); 10 Apr 2010 17:37:08 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,SPF_HELO_PASS
	autolearn=ham version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at m.gmane.org designates 80.91.229.12 as permitted sender)
X-Injected-Via-Gmane: http://gmane.org/
To: zsh-users@zsh.org
From: Thorsten Kampe <thorsten@thorstenkampe.de>
Subject: How to iterate over lines cross-platform
Date: Sat, 10 Apr 2010 19:36:37 +0200
Lines: 30
Message-ID: <hpqcvj$avi$1@dough.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Complaints-To: usenet@dough.gmane.org
X-Gmane-NNTP-Posting-Host: nat.scz.novell.com
User-Agent: MicroPlanet-Gravity/2.9.14

Hi,

I wrote a Zsh shell script which iterates over the output of an external 
tool ("slptool"). Each line of output is an item so I did this:

###
IFS=$'\n'

for scope in $(slptool findscopes); do
    for srvtype in $(slptool -s "$scope" findsrvtypes); do
        [inner loop]
    done
done
###

This works fine on Linux. Unfortunately the script does not works under 
Cygwin. It never enters the "for srvtype" loop (or it doesn't produce 
output). The reason is that the slptool on Windows is a native Win32 
application that outputs lines with "\r\n" endings (and not "\n").

So I simply set "IFS=$'\r\n'" and now the output is correct - but the 
scipt goes through an additional iteration for each loop so output is 
duplicated or results in an error at the end. I suspect that the shell 
does not split on "\r\n" but either on "\r" or "\n".

How can I iterate over lines of output when I don't know in advance 
whether the line endings will be DOS or Unix?!


Thorsten

