From zsh-workers-return-5967-mason-zsh=primenet.com.au@sunsite.auc.dk Sat Mar 27 21:45:09 1999
Return-Path: <zsh-workers-return-5967-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23985 invoked from network); 27 Mar 1999 21:45:08 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 27 Mar 1999 21:45:08 -0000
Received: (qmail 1788 invoked by alias); 27 Mar 1999 21:44:57 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5967
Received: (qmail 1780 invoked from network); 27 Mar 1999 21:44:54 -0000
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <990327134405.ZM2433@candle.brasslantern.com>
Date: Sat, 27 Mar 1999 13:44:05 -0800
In-Reply-To: <199903241142.MAA20894@beta.informatik.hu-berlin.de>
Comments: In reply to Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
        "RE: PATCH: _list completer" (Mar 24, 12:42pm)
References: <199903241142.MAA20894@beta.informatik.hu-berlin.de>
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: zsh-workers@sunsite.auc.dk
Subject: Meaning of $BUFFER (was Re: PATCH: _list completer)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Mar 24, 12:42pm, Sven Wischnowsky wrote:
} Subject: RE: PATCH: _list completer
}
} 
} Andrej Borsenkow wrote:
} 
} > But completion widget is a ZLE widget in the first place? And every
} > user-defined ZLE widget has some special parameters automatically setup -
} > and that includes BUFFER that does exactly what you need.
} 
} Err...  `BUFFER' only gives the current line, not the whole multi-line 
} buffer.

Not entirely true.  $BUFFER gives the whole multi-line buffer if you're
in a true multi-line edit, e.g. after backing up in the history to a
multi-line entry or after executing push-line-or-edit.

What we don't currently have is a way to get at all lines as far back
as the PS1 prompt when you're at a PS2 or more deeply nested prompt.

I would have expected this to work:

	function get_BUFFER {
	  zle push-input
	  zle get-line
	  echo $BUFFER
	}
	zle -N get-BUFFER get_BUFFER

But the whole function aborts after the `zle push-input` and never gets
as far as the `zle get-line`.  There appears to be a whole lot of work
left to make sure that widgets calling other widgets behaves sanely.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

