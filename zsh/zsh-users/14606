From zsh-users-return-14606-mason-zsh=primenet.com.au@zsh.org Wed Nov 25 14:15:41 2009
Return-Path: <zsh-users-return-14606-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16077 invoked by alias); 25 Nov 2009 14:15:41 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14606
Received: (qmail 23341 invoked from network); 25 Nov 2009 14:15:38 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at math.technion.ac.il does not designate permitted sender hosts)
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: ApoEADzKDEuERHMG/2dsb2JhbAC4fZ0FAoQwBA
X-IronPort-AV: E=Sophos;i="4.47,286,1257112800"; 
   d="scan'208";a="211675800"
X-Authentication-Warning: fermat.math.technion.ac.il: nyh set sender to nyh@math.technion.ac.il using -f
Date: Wed, 25 Nov 2009 16:15:32 +0200
From: "Nadav Har'El" <nyh@math.technion.ac.il>
To: Peter Stephenson <pws@csr.com>
Cc: zsh-users@zsh.org
Subject: Re: Redirecting shell output to a pipe
Message-ID: <20091125141532.GA26285@fermat.math.technion.ac.il>
References: <20091124143140.GA7612@fermat.math.technion.ac.il> <4B0C2709.5080307@sun.com> <20091125064801.GA8371@fermat.math.technion.ac.il> <20091125123743.79814faa@news01>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20091125123743.79814faa@news01>
User-Agent: Mutt/1.4.2.2i
Hebrew-Date: 8 Kislev 5770

On Wed, Nov 25, 2009, Peter Stephenson wrote about "Re: Redirecting shell output to a pipe":
>...
> > > > be able to redirect the scripts output to a pipe? E.g., a very useful
> > > > idiom could have been
> > > >
> > > > 	exec | tee filename
>...
> 
> different parts of the pipeline, then wait for them to finish.  What you
> want is beyond the limits of expression of the standard pipeline syntax:
> you want it to say create this pipeline and leave it running as a separate
> process with output redirected.
> 
> Zsh does have a syntax for exactly that:
> 
> exec > >(tee filename)
> 
> That might do what you want.

Beautiful!

> Note the "tee" process is asynchronous with respect to the rest of the
> script, i.e. the shell won't wait for it to exit before the script exits.
> That's normally the case with pipelines; the second process waits for the
> first to exit.  I'm noting it specially here because it's perhaps less
> clear that the shell is becoming the first part of a pipeline over which it
> has no overall control, i.e. that it's different from running a pipeline
> entirely within the shell.  But it may already be obvious that's the case.

Yes, my "coproc"-based solution also suffered from a related problem -
sometimes you lose the last line of output because the shell exited
(and killed the tee process) before it had the time to do its output.
I wonder, though, here, whether the shell will actually kill the tee or will
it continue to live forever (I didn't test).

Thanks,
Nadav.

-- 
Nadav Har'El                        |    Wednesday, Nov 25 2009, 8 Kislev 5770
nyh@math.technion.ac.il             |-----------------------------------------
Phone +972-523-790466, ICQ 13349191 |Attention: There will be a rain dance
http://nadav.harel.org.il           |Friday night, weather permitting.

