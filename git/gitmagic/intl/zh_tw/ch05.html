<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux (vers 25 March 2009), see www.w3.org">
  <meta http-equiv="Content-Type" content=
  "text/html; charset=utf-8">

  <title>Git Magic - 章 5. 關於歷史</title>
  <link rel="stylesheet" href="default.css" type="text/css">
  <meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
  <link rel="home" href="index.html" title="Git 魔法">
  <link rel="up" href="index.html" title="Git 魔法">
  <link rel="prev" href="ch04.html" title="章 4. 分支巫術">
  <link rel="next" href="ch06.html" title="章 6. 多人Git">
</head>

<body bgcolor="white" text="black" link="#0000FF" vlink="#840084"
alink="#0000FF">
    <div class="toc">
      <ul>
<li><b>Git Magic</b></li>
        <li>
          <span class="preface"><a href="index.html">前言</a></span>

          <ul>
            <li><span class="section"><a href=
            "index.html#_%E8%87%B4%E8%AC%9D">致謝！</a></span></li>

            <li><span class="section"><a href=
            "index.html#_%E8%A8%B1%E5%8F%AF">許可</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch01.html">1.
          入門</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch01.html#_%E5%B7%A5%E4%BD%9C%E6%98%AF%E7%8E%A9">工作是玩</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6">版本控制</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_%E5%88%86%E4%BD%88%E6%8E%A7%E5%88%B6">分佈控制</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_%E4%B8%80%E5%80%8B%E8%AA%A4%E5%8D%80">一個誤區</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_%E5%90%88%E4%BD%B5%E8%A1%9D%E7%AA%81">合併衝突</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch02.html">2.
          基本技巧</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch02.html#_%E4%BF%9D%E5%AD%98%E7%8B%80%E6%85%8B">保存狀態</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E6%B7%BB%E5%8A%A0_%E5%88%AA%E9%99%A4_%E9%87%8D%E5%91%BD%E5%90%8D">
            添加、刪除、重命名</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E9%80%B2%E9%9A%8E%E6%92%A4%E9%8A%B7_%E9%87%8D%E5%81%9A">
            進階撤銷/重做</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E6%92%A4%E9%8A%B7">撤銷</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E8%AE%8A%E6%9B%B4%E6%97%A5%E8%AA%8C%E7%94%9F%E6%88%90">
            變更日誌生成</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E4%B8%8B%E8%BC%89%E6%AA%94%E6%A1%88">下載檔案</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E5%88%B0%E6%9C%80%E6%96%B0">到最新</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E5%BF%AB%E9%80%9F%E7%99%BC%E4%BD%88">快速發佈</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E6%88%91%E5%80%91%E5%B7%B2%E7%B6%93%E5%81%9A%E4%BA%86%E4%BB%80%E9%BA%BC">
            我們已經做了什麼？</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E7%B7%B4%E7%BF%92">練習</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch03.html">3.
          克隆周邊</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch03.html#_%E8%A8%88%E7%AE%97%E6%A9%9F%E9%96%93%E5%90%8C%E6%AD%A5">
            計算機間同步</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E5%85%B8%E5%9E%8B%E6%BA%90%E7%A2%BC%E6%8E%A7%E5%88%B6">
            典型源碼控制</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E5%B0%81%E9%96%89%E6%BA%90%E7%A2%BC">封閉源碼</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E8%A3%B8%E5%80%89%E5%BA%AB">裸倉庫</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E6%8E%A8%E9%82%84%E6%98%AF%E6%8B%BD">推還是拽</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E9%A0%85%E7%9B%AE%E5%88%86%E5%8F%89">項目分叉</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E7%B5%82%E6%A5%B5%E5%82%99%E4%BB%BD">終極備份</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E8%BC%95%E5%BF%AB%E5%A4%9A%E4%BB%BB%E5%8B%99">
            輕快多任務</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E6%B8%B8%E6%93%8A%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6">
            游擊版本控制</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_mercurial">Mercurial</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_bazaar">Bazaar</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E6%88%91%E5%81%8F%E6%84%9Bgit%E7%9A%84%E5%8E%9F%E5%9B%A0">
            我偏愛Git的原因</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch04.html">4.
          分支巫術</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch04.html#_%E8%80%81%E9%97%86%E9%8D%B5">老闆鍵</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E9%AA%AF%E9%AB%92%E7%9A%84%E5%B7%A5%E4%BD%9C">
            骯髒的工作</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E5%BF%AB%E9%80%9F%E4%BF%AE%E8%A8%82">快速修訂</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E5%90%88%E4%BD%B5">合併</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E4%B8%8D%E9%96%93%E6%96%B7%E5%B7%A5%E4%BD%9C%E6%B5%81">
            不間斷工作流</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E9%87%8D%E7%B5%84%E9%9B%9C%E4%BA%82">重組雜亂</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E7%AE%A1%E7%90%86%E5%88%86%E6%94%AF">管理分支</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E8%87%A8%E6%99%82%E5%88%86%E6%94%AF">臨時分支</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E6%8C%89%E4%BD%A0%E5%B8%8C%E6%9C%9B%E7%9A%84%E6%96%B9%E5%BC%8F%E5%B7%A5%E4%BD%9C">
            按你希望的方式工作</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch05.html">5.
          關於歷史</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch05.html#_%E6%88%91%E8%AA%8D%E9%8C%AF">我認錯</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_%E6%9B%B4%E8%A4%87%E9%9B%9C%E6%83%85%E6%B3%81">
            更複雜情況</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_%E6%9C%AC%E5%9C%B0%E8%AE%8A%E6%9B%B4%E4%B9%8B%E5%BE%8C">
            本地變更之後</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_%E9%87%8D%E5%AF%AB%E6%AD%B7%E5%8F%B2">重寫歷史</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_%E8%A3%BD%E9%80%A0%E6%AD%B7%E5%8F%B2">製造歷史</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_%E5%93%AA%E5%85%92%E9%8C%AF%E4%BA%86">哪兒錯了？</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_%E8%AA%B0%E8%AE%93%E4%BA%8B%E6%83%85%E8%AE%8A%E7%B3%9F%E4%BA%86">
            誰讓事情變糟了？</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_%E5%80%8B%E4%BA%BA%E7%B6%93%E9%A9%97">個人經驗</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch06.html">6.
          多人Git</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch06.html#_%E6%88%91%E6%98%AF%E8%AA%B0">我是誰？</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_git%E5%9C%A8ssh_http%E4%B8%8A">Git在SSH,
            HTTP上</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_git%E5%9C%A8%E9%9A%A8%E4%BE%BF%E4%BB%80%E9%BA%BC%E4%B8%8A">
            Git在隨便什麼上</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_%E8%A3%9C%E4%B8%81_%E5%85%A8%E7%90%83%E8%B2%A8%E5%B9%A3">
            補丁：全球貨幣</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_%E5%B0%8D%E4%B8%8D%E8%B5%B7_%E7%A7%BB%E8%B5%B0%E4%BA%86">
            對不起，移走了</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_%E9%81%A0%E7%AB%AF%E5%88%86%E6%94%AF">遠端分支</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_%E5%A4%9A%E9%81%A0%E7%AB%AF">多遠端</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_%E6%88%91%E7%9A%84%E5%96%9C%E5%A5%BD">我的喜好</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch07.html">7.
          Git大師技</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch07.html#_%E6%BA%90%E7%A2%BC%E7%99%BC%E4%BD%88">源碼發佈</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_%E6%8F%90%E4%BA%A4%E8%AE%8A%E6%9B%B4">提交變更</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_%E6%88%91%E7%9A%84%E6%8F%90%E4%BA%A4%E5%A4%AA%E5%A4%A7%E4%BA%86">
            我的提交太大了！</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_%E7%B4%A2%E5%BC%95_git%E7%9A%84%E4%B8%AD%E8%BD%89%E5%8D%80%E5%9F%9F">
            索引：Git的中轉區域</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_%E5%88%A5%E4%B8%9F%E4%BA%86%E4%BD%A0%E7%9A%84head">
            別丟了你的HEAD</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_head%E6%8D%95%E7%8D%B5">HEAD捕獵</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_%E5%9F%BA%E4%BA%8Egit%E6%A7%8B%E5%BB%BA">基于Git構建</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_%E5%A4%A7%E8%86%BD%E7%9A%84%E7%89%B9%E6%8A%80">
            大膽的特技</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_%E9%98%BB%E6%AD%A2%E5%A3%9E%E6%8F%90%E4%BA%A4">
            阻止壞提交</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch08.html">8.
          揭開面紗</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch08.html#_%E5%A4%A7%E8%B1%A1%E7%84%A1%E5%BD%A2">大象無形</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_%E6%95%B8%E6%93%9A%E5%AE%8C%E6%95%B4%E6%80%A7">
            數據完整性</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_%E6%99%BA%E8%83%BD">智能</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_%E7%B4%A2%E5%BC%95">索引</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_git%E7%9A%84%E6%BA%90%E8%B5%B7">Git的源起</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_%E5%B0%8D%E8%B1%A1%E8%B3%87%E6%96%99%E5%BA%AB">
            對象資料庫</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_blob%E5%B0%8D%E8%B1%A1">Blob對象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_tree%E5%B0%8D%E8%B1%A1">Tree對象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_commit%E5%B0%8D%E8%B1%A1">Commit對象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_%E6%B2%92%E9%82%A3%E9%BA%BC%E7%A5%9E">沒那麼神</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch09.html">9. 附錄 A:
          Git的缺點</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch09.html#_sha1_%E7%9A%84%E5%BC%B1%E9%BB%9E">SHA1
            的弱點</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E5%BE%AE%E8%BB%9F_windows">微軟
            Windows</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E4%B8%8D%E7%9B%B8%E9%97%9C%E7%9A%84%E6%AA%94%E6%A1%88">
            不相關的檔案</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E8%AA%B0%E5%9C%A8%E7%B7%A8%E8%BC%AF%E4%BB%80%E9%BA%BC">
            誰在編輯什麼？</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E6%AA%94%E6%A1%88%E6%AD%B7%E5%8F%B2">檔案歷史</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E5%88%9D%E5%A7%8B%E5%85%8B%E9%9A%86">初始克隆</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E4%B8%8D%E7%A9%A9%E5%AE%9A%E7%9A%84%E9%A0%85%E7%9B%AE">
            不穩定的項目</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E5%85%A8%E5%B1%80%E8%A8%88%E6%95%B8%E5%99%A8">
            全局計數器</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E7%A9%BA%E5%AD%90%E7%9B%AE%E9%8C%84">空子目錄</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E5%88%9D%E5%A7%8B%E6%8F%90%E4%BA%A4">初始提交</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E4%BB%8B%E9%9D%A2%E6%80%AA%E7%99%96">介面怪癖</a></span></li>
          </ul>
        </li>

        <li><span class="chapter"><a href="ch10.html">10. 附錄 B:
        本指南的翻譯</a></span></li>
      </ul>
    </div>
<div class="content">
  <div class="chapter" title="章 5. 關於歷史">
    <div class="titlepage">
      <div>
        <div>
          <h2 class="title"><a name=
          "_%E9%97%9C%E6%96%BC%E6%AD%B7%E5%8F%B2"></a>章 5.
          關於歷史</h2>
        </div>
      </div>
    </div>

    <p>Git分散式本性使得歷史可以輕易編輯。但你若篡改過去，需要小心：只重寫你獨自擁有
    的那部分。正如民族間會無休止的爭論誰犯下了什麼暴行一樣，如果在另一個人的克隆
    裡，歷史版本與你的不同，當你們的樹互操作時，你會遇到一致性方面的問題。</p>

    <p>一些開發人員強烈地感覺歷史應該永遠不變，不好的部分也不變所有都不變。另一些覺
    得代碼樹在向外發佈之前，應該整得漂漂亮亮的。Git同時支持兩者的觀點。像克隆，分
    支和合併一樣，重寫歷史只是Git給你的另一強大功能，至于如何明智地使用它，那是你 的事了。</p>

    <div class="section" title="我認錯">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E6%88%91%E8%AA%8D%E9%8C%AF"></a>我認錯</h2>
          </div>
        </div>
      </div>

      <p>剛提交，但你期望你輸入的是一條不同的信息？那麼鍵入：</p>
      <pre class="literallayout">
$ git commit --amend
</pre>

      <p>來改變上一條信息。意識到你還忘記了加一個檔案？運行git add來加，然後運行上面的 命令。</p>

      <p>希望在上次提交裡包括多一點的改動？那麼就做這些改動並運行：</p>
      <pre class="literallayout">
$ git commit --amend -a
</pre>
    </div>

    <div class="section" title="更複雜情況">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E6%9B%B4%E8%A4%87%E9%9B%9C%E6%83%85%E6%B3%81"></a>更複雜情況</h2>
          </div>
        </div>
      </div>

      <p>假設前面的問題還要糟糕十倍。在漫長的時間裡我們提交了一堆。但你不太喜歡他們的
      組織方式，而且一些提交信息需要重寫。那麼鍵入：</p>
      <pre class="literallayout">
$ git rebase -i HEAD~10
</pre>

      <p>並且後10個提交會出現在你喜愛的$EDITOR。一個例子：</p>
      <pre class="literallayout">
pick 5c6eb73 Added repo.or.cz link
pick a311a64 Reordered analogies in "Work How You Want"
pick 100834f Added push target to Makefile
</pre>

      <p>之後：</p>

      <div class="itemizedlist">
        <ul class="itemizedlist">
          <li class="listitem">通過刪除行來移去提交。</li>

          <li class="listitem">通過為行重新排序行來重新排序提交。</li>

          <li class="listitem">
            <p class="simpara">替換 <code class="literal">pick</code>
            使用：</p>

            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem"><code class=
                "literal">edit</code> 標記一個提交需要修訂。</li>

                <li class="listitem"><code class=
                "literal">reword</code> 改變日誌信息。</li>

                <li class="listitem"><code class=
                "literal">squash</code> 將一個提交與其和前一個合併。</li>

                <li class="listitem"><code class=
                "literal">fixup</code> 將一個提交與其和前一個合併，並丟棄日誌信息。</li>
              </ul>
            </div>
          </li>
        </ul>
      </div>

      <p>保存退出。如果你把一個提交標記為可編輯，那麼運行</p>
      <pre class="literallayout">
$ git commit --amend
</pre>

      <p>否則，運行：</p>
      <pre class="literallayout">
$ git rebase --continue
</pre>

      <p>這樣儘早提交，經常提交：你之後還可以用rebase來規整。</p>
    </div>

    <div class="section" title="本地變更之後">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E6%9C%AC%E5%9C%B0%E8%AE%8A%E6%9B%B4%E4%B9%8B%E5%BE%8C">
            </a>本地變更之後</h2>
          </div>
        </div>
      </div>

      <p>你正在一個活躍的項目上工作。隨着時間推移，你做了幾個本地提交，然後你使用合併
      與官方版本同步。在你準備好提交到中心分支之前，這個循環會重複幾次。</p>

      <p>但現在你本地Git克隆摻雜了你的改動和官方改動。你更期望在變更列表裡，你所有的變 更能夠連續。</p>

      <p>這就是上面提到的 <span class="strong"><strong>git
      rebase</strong></span> 所做的工作。在很多情況下你可以使用 <span class=
      "strong"><strong>--onto</strong></span> 標 記以避免交互。</p>

      <p>另外參見 <span class="strong"><strong>git help
      rebase</strong></span> 以獲取這個讓人驚奇的命令更詳細的例子。你可以拆分提
      交。你甚至可以重新組織一棵樹的分支。</p>
    </div>

    <div class="section" title="重寫歷史">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E9%87%8D%E5%AF%AB%E6%AD%B7%E5%8F%B2"></a>重寫歷史</h2>
          </div>
        </div>
      </div>

      <p>偶爾，你需要做一些代碼控制，好比從正式的照片中去除一些人一樣，需要從歷史記錄
      裡面徹底的抹掉他們。例如，假設我們要發佈一個項目，但由於一些原因，項目中的某
      個檔案不能公開。或許我把我的信用卡號記錄在了一個文本檔案裡，而我又意外的把它
      加入到了這個項目中。僅僅刪除這個檔案是不夠的，因為從別的提交記錄中還是可以訪
      問到這個檔案。因此我們必須從所有的提交記錄中徹底刪除這個檔案。</p>
      <pre class="literallayout">
$ git filter-branch --tree-filter 'rm top/secret/file' HEAD
</pre>

      <p>參見 <span class="strong"><strong>git help
      filter-branch</strong></span> ，那裡討論了這個例子並給出一個更快的方法。一般 地，
      <span class="strong"><strong>filter-branch</strong></span>
      允許你使用一個單一命令來大範圍地更改歷史。</p>

      <p>此後，+.git/refs/original+目錄描述操作之前的狀態。檢查命令filter-branch的確做
      了你想要做的，然後刪除此目錄，如果你想運行多次filter-branch命令。</p>

      <p>最後，用你修訂過的版本替換你的項目克隆，如果你想之後和它們交互的話。</p>
    </div>

    <div class="section" title="製造歷史">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E8%A3%BD%E9%80%A0%E6%AD%B7%E5%8F%B2"></a>製造歷史</h2>
          </div>
        </div>
      </div>

      <p><a name="makinghistory" id=
      "makinghistory"></a>想把一個項目遷移到Git嗎？如果這個項目是在用比較有名氣的系統，那可以使用一些其
      他人已經寫好的腳本，把整個項目歷史記錄導出來放到Git裡。</p>

      <p>否則，查一下 <span class="strong"><strong>git
      fast-import</strong></span> ，這個命令會從一個特定格式的文本讀入，從頭來創
      建Git歷史記錄。通常可以用這個命令很快寫一個腳本運行一次，一次遷移整個項目。</p>

      <p>作為一個例子，粘貼以下所列到臨時檔案，比如/tmp/history：</p>
      <pre class="screen">
commit refs/heads/master
committer Alice &lt;alice@example.com&gt; Thu, 01 Jan 1970 00:00:00 +0000
data &lt;&lt;EOT
Initial commit.
EOT

M 100644 inline hello.c
data &lt;&lt;EOT
#include &lt;stdio.h&gt;

int main() {
  printf("Hello, world!\n");
  return 0;
}
EOT


commit refs/heads/master
committer Bob &lt;bob@example.com&gt; Tue, 14 Mar 2000 01:59:26 -0800
data &lt;&lt;EOT
Replace printf() with write().
EOT

M 100644 inline hello.c
data &lt;&lt;EOT
#include &lt;unistd.h&gt;

int main() {
  write(1, "Hello, world!\n", 14);
  return 0;
}
EOT
</pre>

      <p>之後從這個臨時檔案創建一個Git倉庫，鍵入：</p>
      <pre class="literallayout">
$ mkdir project; cd project; git init
$ git fast-import --date-format=rfc2822 &lt; /tmp/history
</pre>

      <p>你可以從這個項目checkout出最新的版本，使用：</p>
      <pre class="literallayout">
$ git checkout master .
</pre>

      <p>命令<span class="strong"><strong>git
      fast-export</strong></span> 轉換任意倉庫到 <span class=
      "strong"><strong>git fast-import</strong></span> 格式，你可以研究其輸
      出來寫導出程序， 也以可讀格式傳送倉庫。的確，這些命令可以發送倉庫文本檔案 通過只接受文本的渠道。</p>
    </div>

    <div class="section" title="哪兒錯了？">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E5%93%AA%E5%85%92%E9%8C%AF%E4%BA%86"></a>哪兒錯了？</h2>
          </div>
        </div>
      </div>

      <p>你剛剛發現程序裡有一個功能出錯了，而你十分確定幾個月以前它運行的很正常。天啊！
      這個臭蟲是從哪裡冒出來的？要是那時候能按照開發的內容進行過測試該多好啊。</p>

      <p>現在說這個已經太晚了。然而，即使你過去經常提交變更，Git還是可以精確的找出問題所在：</p>
      <pre class="literallayout">
$ git bisect start
$ git bisect bad HEAD
$ git bisect good 1b6d
</pre>

      <p>Git從歷史記錄中檢出一個中間的狀態。在這個狀態上測試功能，如果還是有問題：</p>
      <pre class="literallayout">
$ git bisect bad
</pre>

      <p>如果可以工作了，則把"bad"替換成"good"。Git會再次幫你找到一個以確定的好版本和
      壞版本之間的狀態，通過這種方式縮小範圍。經過一系列的迭代，這種二分搜索會幫你
      找到導致這個錯誤的那次提交。一旦完成了問題定位的調查，你可以返回到原始狀態， 鍵入：</p>
      <pre class="literallayout">
$ git bisect reset
</pre>

      <p>不需要手工測試每一次改動，執行如下命令可以自動的完成上面的搜索：</p>
      <pre class="literallayout">
$ git bisect run my_script
</pre>

      <p>Git使用指定命令（通常是一個一次性的腳本）的返回值來決定一次改動是否是正確的：
      命令退出時的代碼0代表改動是正確的，125代表要跳過對這次改動的檢查，1到127之間
      的其他數值代表改動是錯誤的。返回負數將會中斷整個bisect的檢查。</p>

      <p>你還能做更多的事情: 幫助文檔解釋了如何展示bisects, 檢查或重放bisect的日誌,並
      可以通過排除對已知正確改動的檢查，得到更好的搜索速度。</p>
    </div>

    <div class="section" title="誰讓事情變糟了？">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E8%AA%B0%E8%AE%93%E4%BA%8B%E6%83%85%E8%AE%8A%E7%B3%9F%E4%BA%86">
            </a>誰讓事情變糟了？</h2>
          </div>
        </div>
      </div>

      <p>和其他許多版本控制系統一樣，Git也有一個"blame"命令：</p>
      <pre class="literallayout">
$ git blame bug.c
</pre>

      <p>這個命令可以標註出一個指定的檔案裡每一行內容的最後修改者，和最後修改時間。但
      不像其他版本控制系統，Git的這個操作是在綫下完成的，它只需要從本地磁碟讀取信息。</p>
    </div>

    <div class="section" title="個人經驗">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E5%80%8B%E4%BA%BA%E7%B6%93%E9%A9%97"></a>個人經驗</h2>
          </div>
        </div>
      </div>

      <p>在一個中心版本控制系統裡，歷史的更改是一個困難的操作，並且只有管理員才有權這
      麼做。沒有網絡，克隆，分支和合併都沒法做。像一些基本的操作如瀏覽歷史，或提交
      變更也是如此。在一些系統裡，用戶使用網絡連接僅僅是為了查看他們自己的變更，或 打開檔案進行編輯。</p>

      <p>中心繫統排斥離線工作，也需要更昂貴的網絡設施，特別是當開發人員增多的時候。最
      重要的是，所有操作都一定程度變慢，一般在用戶避免使用那些能不用則不用的高級命
      令時。在極端的情況下，即使是最基本的命令也會變慢。當用戶必須運行緩慢的命令的 時候，由於工作流被打斷，生產力降低。</p>

      <p>我有這些的一手經驗。Git是我使用的第一個版本控制系統。我很快學會適應了它，用了
      它提供的許多功能。我簡單地假設其他系統也是相似的：選擇一個版本控制系統應該和 選擇一個編輯器或瀏覽器沒啥兩樣。</p>

      <p>在我之後被迫使用中心繫統的時候，我被震驚了。我那有些脆弱的網絡沒給Git帶來大麻
      煩，但是當它需要像本地硬碟一樣穩定的時候，它使開發困難重重。另外，我發現我自
      己有選擇地避免特定的命令，以避免踏雷，這極大地影響了我，使我不能按照我喜歡的 方式工作。</p>

      <p>當我不得不運行一個慢的命令的時候，這種等待極大地破壞了我思緒連續性。在等待服
      務器通訊完成的時候，我選擇做其他的事情以度過這段時光，比如查看郵件或寫其他的
      文檔。當我返回我原先的工作場景的時候，這個命令早已結束，並且我還需要浪費時間
      試圖記起我之前正在做什麼。人類不擅長場景間的切換。</p>

      <p>還有一個有意思的大眾悲劇效應：預料到網絡擁擠，為了減少將來的等待時間，每個人
      將比以往消費更多的頻寬在各種操作上。共同的努力加劇了擁擠，這等於是鼓勵個人下 次消費更多頻寬以避免更長時間的等待。</p>
    </div>
  </div><script type="text/javascript" src="find_selflink.js">
</script><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
  </script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1901330-2");
  pageTracker._initData();
  pageTracker._trackPageview();
  </script>
</div>
</div><div class="footer"><a href="/~blynn/">Ben Lynn</a></div>
</body>
</html>
