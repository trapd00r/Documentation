From zsh-workers-return-22335-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 08 08:16:10 2006
Return-Path: <zsh-workers-return-22335-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18263 invoked from network); 8 Mar 2006 08:16:09 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 8 Mar 2006 08:16:09 -0000
Received: (qmail 5652 invoked from network); 8 Mar 2006 08:16:03 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 8 Mar 2006 08:16:03 -0000
Received: (qmail 7989 invoked by alias); 8 Mar 2006 08:16:00 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22335
Received: (qmail 7980 invoked from network); 8 Mar 2006 08:16:00 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 8 Mar 2006 08:16:00 -0000
Received: (qmail 5316 invoked from network); 8 Mar 2006 08:16:00 -0000
Received: from dsl3-63-249-88-2.cruzio.com (HELO dot.blorf.net) (63.249.88.2)
  by a.mx.sunsite.dk with SMTP; 8 Mar 2006 08:15:59 -0000
Received: by dot.blorf.net (Postfix, from userid 1000)
	id 85BEFD2C; Wed,  8 Mar 2006 00:15:58 -0800 (PST)
Date: Wed, 8 Mar 2006 00:15:58 -0800
From: Wayne Davison <wayned@users.sourceforge.net>
To: zsh-workers@sunsite.dk
Subject: Silencing more compiler warnings and a question
Message-ID: <20060308081558.GE23512@dot.blorf.net>
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="nFreZHaLTZJo0R7j"
Content-Disposition: inline
User-Agent: Mutt/1.5.11+cvs20060126


--nFreZHaLTZJo0R7j
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Here's a simple diff that silences some "may be used uninitialized"
warnings, removes some code that I can't ever be triggered, and maybe
fixes a bug:

In silencing the compiler warnings, I assigned zmod to modsave at the
top of the function and then removed the two assignments lower down.
This seems to me to fix a bug where zmod could end up being accidentally
changed if the user specified both -N and -n.  Is this new behavior the
right thing to do?

..wayne..

--nFreZHaLTZJo0R7j
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="modsave.diff"

--- Src/Zle/zle_thingy.c	15 Nov 2005 08:44:18 -0000	1.23
+++ Src/Zle/zle_thingy.c	8 Mar 2006 08:10:35 -0000
@@ -640,15 +640,13 @@ static int
 bin_zle_call(char *name, char **args, UNUSED(Options ops), UNUSED(char func))
 {
     Thingy t;
-    struct modifier modsave;
+    struct modifier modsave = zmod;
     int ret, saveflag = 0;
     char *wname = *args++;
 
-    if (!wname) {
-	if (saveflag)
-	    zmod = modsave;
+    if (!wname)
 	return !zle_usable();
-    }
+
     if(!zle_usable()) {
 	zwarnnam(name, "widgets can only be called when ZLE is active",
 	    NULL, 0);
@@ -673,13 +671,11 @@ bin_zle_call(char *name, char **args, UN
 		}
 		if (!args[0][1])
 		    *++args = "" - 1;
-		modsave = zmod;
 		saveflag = 1;
 		zmod.mult = atoi(num);
 		zmod.flags |= MOD_MULT;
 		break;
 	    case 'N':
-		modsave = zmod;
 		saveflag = 1;
 		zmod.mult = 1;
 		zmod.flags &= ~MOD_MULT;

--nFreZHaLTZJo0R7j--

