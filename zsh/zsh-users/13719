From zsh-users-return-13719-mason-zsh=primenet.com.au@sunsite.dk Fri Jan 16 16:41:02 2009
Return-Path: <zsh-users-return-13719-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3622 invoked from network); 16 Jan 2009 16:40:59 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Jan 2009 16:40:59 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 783 invoked from network); 16 Jan 2009 16:40:48 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Jan 2009 16:40:48 -0000
Received: (qmail 23356 invoked by alias); 16 Jan 2009 16:40:30 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13719
Received: (qmail 23346 invoked from network); 16 Jan 2009 16:40:30 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 16 Jan 2009 16:40:30 -0000
Received: from flock1.newmail.ru (flock1.newmail.ru [82.204.219.207])
	by bifrost.dotsrc.org (Postfix) with SMTP id 408ED80271F0
	for <zsh-users@sunsite.dk>; Fri, 16 Jan 2009 17:40:25 +0100 (CET)
Received: (qmail 9648 invoked from network); 16 Jan 2009 16:40:05 -0000
Received: from unknown (HELO cooker.localnet) (arvidjaar@newmail.ru@91.77.194.200)
  by smtpd.newmail.ru with SMTP; 16 Jan 2009 16:40:05 -0000
From: Andrey Borzenkov <arvidjaar@newmail.ru>
To: zsh-users@sunsite.dk
Subject: Re: sourcing a sh file in zsh
Date: Fri, 16 Jan 2009 19:39:50 +0300
User-Agent: KMail/1.11.0 (Linux/2.6.28-1avb; KDE/4.1.96; i686; ; )
References: <BD9D2405-AD6A-4336-9C8A-85149165B6B8@gmail.com> <090116075615.ZM21871@torch.brasslantern.com>
In-Reply-To: <090116075615.ZM21871@torch.brasslantern.com>
MIME-Version: 1.0
Content-Type: multipart/signed;
  boundary="nextPart23699658.VHUWlLgglm";
  protocol="application/pgp-signature";
  micalg=pgp-sha1
Content-Transfer-Encoding: 7bit
Message-Id: <200901161939.54651.arvidjaar@newmail.ru>
X-Virus-Scanned: ClamAV 0.92.1/8871/Fri Jan 16 05:16:59 2009 on bifrost
X-Virus-Status: Clean

--nextPart23699658.VHUWlLgglm
Content-Type: text/plain;
  charset="utf-8"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline

On =D0=9F=D1=8F=D1=82=D0=BD=D0=B8=D1=86=D0=B0 16 =D1=8F=D0=BD=D0=B2=D0=B0=
=D1=80=D1=8F 2009 18:56:15 Bart Schaefer wrote:
> On Jan 16,  2:53pm, Evert Rol wrote:
> }
> } How do I source a .sh file in zsh? It works fine in bash or sh, but
> } gives an error when source in zsh.
>
> You'll probably need to do something like
>
>   emulate sh
>   source bla.sh
>
> That leaves the problem of getting back to your original zsh settings
> after the script is done.  Depending on what the script is supposed
> to accomplish, you might be able to wrap that in a shell function:
>
>   sh_source() {
>     emulate -L sh
>     source "$@"
>   }
>
> That won't work if the script wants to declare variables with typeset
> and have them remain set after it finishes.
>

I finally resorted to

# Poor man replacement for emulate -L
typeset -A __opts
__opts=3D(${(kv)options[*]})
emulate -R sh

for profile_func in /etc/profile.d/*.sh
do
        source $profile_func
done

options=3D(${(kv)__opts[*]})
unset profile_func __opts

Given that most distributions have equivalence of /etc/profile.d, having=20
simple zsh way to do it (without scoping issues) would be nice.

--nextPart23699658.VHUWlLgglm
Content-Type: application/pgp-signature; name=signature.asc 
Content-Description: This is a digitally signed message part.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)

iEYEABECAAYFAklwuFoACgkQR6LMutpd94yihwCeJ2p2p0ZH9OGwUUfbyv61E0j0
+HIAnA4NO46ilAcdcrz0/2cW/vzfQuk1
=V2A5
-----END PGP SIGNATURE-----

--nextPart23699658.VHUWlLgglm--

