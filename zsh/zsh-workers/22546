From zsh-workers-return-22546-mason-zsh=primenet.com.au@sunsite.dk Tue Jul 11 15:30:39 2006
Return-Path: <zsh-workers-return-22546-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15684 invoked from network); 11 Jul 2006 15:30:36 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.3 (2006-06-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 11 Jul 2006 15:30:36 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 75383 invoked from network); 11 Jul 2006 15:30:29 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 11 Jul 2006 15:30:29 -0000
Received: (qmail 1799 invoked by alias); 11 Jul 2006 15:30:26 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22546
Received: (qmail 1789 invoked from network); 11 Jul 2006 15:30:25 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 11 Jul 2006 15:30:25 -0000
Received: (qmail 75019 invoked from network); 11 Jul 2006 15:30:25 -0000
Received: from cluster-d.mailcontrol.com (217.69.20.190)
  by a.mx.sunsite.dk with SMTP; 11 Jul 2006 15:30:24 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly10d.srv.mailcontrol.com (MailControl) with ESMTP id k6BFTxL9020429
	for <zsh-workers@sunsite.dk>; Tue, 11 Jul 2006 16:30:00 +0100
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Tue, 11 Jul 2006 16:30:00 +0100
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.4/8.13.4) with ESMTP id k6BFU0eJ023296
	for <zsh-workers@sunsite.dk>; Tue, 11 Jul 2006 16:30:00 +0100
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.4/8.13.4/Submit) with ESMTP id k6BFU0mG023293
	for <zsh-workers@sunsite.dk>; Tue, 11 Jul 2006 16:30:00 +0100
Message-Id: <200607111530.k6BFU0mG023293@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: Re: Test issues 
In-reply-to: <20a807210607110749q205d2d07n5b6957098a3ca5a1@mail.gmail.com> 
References: <20a807210607110749q205d2d07n5b6957098a3ca5a1@mail.gmail.com>
Date: Tue, 11 Jul 2006 16:29:59 +0100
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 11 Jul 2006 15:30:00.0088 (UTC) FILETIME=[DF413980:01C6A4FE]
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A-07-00-10 (www.mailcontrol.com) on 10.68.0.120

"Vin Shelton" wrote:
> Greetings -
> 
> I'd like to bring up a few issues with the test scripts:
> 
> 1. Since yesterday, the A04 test has been failing on my linux systems
> at home (kubuntu) and at work (RHEL).  Here's the tail of
> 'ZTST_verbose=3 TESTNUM=A04 make test':
> 
> Running test: Using {fdvar}> syntax to open a new file descriptor
> ZTST_test: expecting status: 0
> Input: /tmp/zsh.ztst.in.26465, output: /tmp/zsh.ztst.out.26465, error:
> /tmp/zsh.ztst.terr.26465
> make: [test] Error 127 (ignored)

Thanks for spotting that... the feature you noticed that it was
failing silently must have been why I didn't.  I'm not sure why it
was doing that, but the problem must have made the entire test script
fall over somehow.  The bug it found was indeed parsing the syntax the
test was designed for.  I've extended the test to spot the failure
earlier.

I suppose the make file could check for missing "successful" or "failed"
messages.

Index: Src/parse.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/parse.c,v
retrieving revision 1.57
diff -u -r1.57 parse.c
--- Src/parse.c	10 Jul 2006 13:08:23 -0000	1.57
+++ Src/parse.c	11 Jul 2006 15:27:51 -0000
@@ -1603,7 +1603,7 @@
 
 		if (*ptr == Outbrace && ptr > tokstr + 1)
 		{
-		    if (itype_end(tokstr, IIDENT, 0) >= ptr - 1)
+		    if (itype_end(tokstr+1, IIDENT, 0) >= ptr - 1)
 		    {
 			char *toksave = tokstr;
 			char *idstring = dupstrpfx(tokstr+1, eptr-tokstr-1);
Index: Test/A04redirect.ztst
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/A04redirect.ztst,v
retrieving revision 1.10
diff -u -r1.10 A04redirect.ztst
--- Test/A04redirect.ztst	23 Sep 2005 17:03:17 -0000	1.10
+++ Test/A04redirect.ztst	11 Jul 2006 15:27:51 -0000
@@ -240,10 +240,15 @@
 <input
 >input
 
+  myfd=
   exec {myfd}>logfile
-  print This is my logfile. >&$myfd
-  print Examining contents of logfile...
-  cat logfile
+  if [[ -z $myfd ]]; then
+    print "Ooops, failed to set myfd to a file descriptor." >&2
+  else
+    print This is my logfile. >&$myfd
+    print Examining contents of logfile...
+    cat logfile
+  fi
 0:Using {fdvar}> syntax to open a new file descriptor
 >Examining contents of logfile...
 >This is my logfile.
Index: Test/D07multibyte.ztst
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/D07multibyte.ztst,v
retrieving revision 1.5
diff -u -r1.5 D07multibyte.ztst
--- Test/D07multibyte.ztst	10 Jul 2006 13:08:24 -0000	1.5
+++ Test/D07multibyte.ztst	11 Jul 2006 15:27:52 -0000
@@ -12,7 +12,7 @@
     fi
   done
   if [[ -z $mb_ok ]]; then
-    ZTST_unimplemented="no UTF-8 locale or multibyte mode is not implemnted"
+    ZTST_unimplemented="no UTF-8 locale or multibyte mode is not implemented"
   else
     print Testing multibyte with locale $LANG >&8
   fi

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


To access the latest news from CSR copy this link into a web browser:  http://www.csr.com/email_sig.php

