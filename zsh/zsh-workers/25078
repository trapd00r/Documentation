From zsh-workers-return-25078-mason-zsh=primenet.com.au@sunsite.dk Tue May 20 16:26:22 2008
Return-Path: <zsh-workers-return-25078-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8845 invoked from network); 20 May 2008 16:26:20 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 20 May 2008 16:26:20 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 57504 invoked from network); 20 May 2008 16:26:14 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 20 May 2008 16:26:14 -0000
Received: (qmail 9590 invoked by alias); 20 May 2008 16:26:12 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25078
Received: (qmail 9577 invoked from network); 20 May 2008 16:26:11 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 20 May 2008 16:26:11 -0000
Received: from vms173003pub.verizon.net (vms173003pub.verizon.net [206.46.173.3])
	by bifrost.dotsrc.org (Postfix) with ESMTP id CE82080589A4
	for <zsh-workers@sunsite.dk>; Tue, 20 May 2008 18:26:06 +0200 (CEST)
Received: from torch.brasslantern.com ([71.116.113.54])
 by vms173003.mailsrvcs.net
 (Sun Java System Messaging Server 6.2-6.01 (built Apr  3 2006))
 with ESMTPA id <0K1600AF9DIKHZF3@vms173003.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Tue, 20 May 2008 11:23:09 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id m4KGPwmI010387; Tue,
 20 May 2008 09:25:59 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id m4KGPwZH010386; Tue, 20 May 2008 09:25:58 -0700
Date: Tue, 20 May 2008 09:25:58 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: zpty woes (enhancement request)
In-reply-to: <5BA613C5-8227-4803-AFD1-EA2AF754DB20@mac.com>
To: Jaime Vargas <jev@mac.com>
Cc: Zsh hackers list <zsh-workers@sunsite.dk>
Message-id: <080520092558.ZM10385@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <34AE8142-F5DA-44FD-96BA-61BDE12BC74E@mac.com>
	<200805151318.m4FDIvKS015244@news01.csr.com>
	<20080515145054.GC5190@sc.homeunix.net>
	<99E8D43E-EC34-48DB-A5AD-BFA197A3AAA3@mac.com>	<480CEB80051F27AE@mac.com>
	<E46E7A2D-D023-435F-8EE0-4C0BFF105FA4@mac.com>
	<CBA06CD0-1461-4576-A778-08745CFD1F2D@mac.com>
	<BD6F35ED-1F18-4AF7-8A06-1FA46BD4A91A@mac.com>
	<5BA613C5-8227-4803-AFD1-EA2AF754DB20@mac.com>
Comments: In reply to Jaime Vargas <jev@mac.com>
 "Re: zpty woes (enhancement request)" (May 20, 10:28am)
X-Virus-Scanned: ClamAV 0.91.2/7181/Tue May 20 17:08:32 2008 on bifrost
X-Virus-Status: Clean

On May 20, 10:28am, Jaime Vargas wrote:
}
} It would be nice if zpty had a call to inspect the pseudo-terminal  
} buffer.

There is no "pseudo-terminal buffer" to examine.  From the point of
view of the calling shell, there's only a bi-directional pipe; things
can be read and written exacly once in each direction.  This isn't
like curses where there's an internal "screen image" maintained that
you might peek at.  It's only the process running on the pseudo-tty
that gets a buffered terminal-like view of the interaction.

} I find that `zpty -r' with or without pattern to be very  
} difficult to debug. Any ideas on below problem?

I don't know what might be causing the problem, though I suspect it's
something ssh-related.

Try changing
    zpty -b ch ssh -l ${user} ${host}
to
    zpty -b ch script -q -c \"ssh -l ${user} ${host}\"

Then examine the resulting typescript file.
 

