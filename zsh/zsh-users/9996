From zsh-users-return-9996-mason-zsh=primenet.com.au@sunsite.dk Mon Mar 06 16:50:41 2006
Return-Path: <zsh-users-return-9996-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25333 invoked from network); 6 Mar 2006 16:50:39 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 6 Mar 2006 16:50:39 -0000
Received: (qmail 41757 invoked from network); 6 Mar 2006 16:50:34 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 6 Mar 2006 16:50:34 -0000
Received: (qmail 5405 invoked by alias); 6 Mar 2006 16:50:26 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 9996
Received: (qmail 5395 invoked from network); 6 Mar 2006 16:50:25 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 6 Mar 2006 16:50:25 -0000
Received: (qmail 40567 invoked from network); 6 Mar 2006 16:50:25 -0000
Received: from vms048pub.verizon.net (206.46.252.48)
  by a.mx.sunsite.dk with SMTP; 6 Mar 2006 16:50:24 -0000
Received: from torch.brasslantern.com ([71.116.81.225])
 by vms048.mailsrvcs.net (Sun Java System Messaging Server 6.2-4.02 (built Sep
 9 2005)) with ESMTPA id <0IVP00C9YTFYC7E0@vms048.mailsrvcs.net> for
 zsh-users@sunsite.dk; Mon, 06 Mar 2006 10:50:23 -0600 (CST)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id k26GpaOm004151	for
 <zsh-users@sunsite.dk>; Mon, 06 Mar 2006 08:51:40 -0800
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id k26GpabM004150	for zsh-users@sunsite.dk; Mon,
 06 Mar 2006 08:51:36 -0800
Date: Mon, 06 Mar 2006 08:51:36 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: [zsh] Re: dirstack history: loving zsh, crashing zsh...
In-reply-to: <20060306130139.GA9256@let.rug.nl>
To: Zsh User <zsh-users@sunsite.dk>
Message-id: <060306085136.ZM4149@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <20060302175252.GA31734@let.rug.nl>
	<060305011947.ZM7258@torch.brasslantern.com>	<20060306130139.GA9256@let.rug.nl>
Comments: In reply to Francisco Borges <f.borges@rug.nl>
 "Re: [zsh] Re: dirstack history: loving zsh, crashing zsh..." (Mar  6,  2:01pm)

On Mar 6,  2:01pm, Francisco Borges wrote:
}
} it won't stop that accumulation of repeated directories at .zdirs
} (essentially since "dirs" always include the CWD).

If that's the only issue, then don't use "dirs" at all; instead use
"print $dirstack" which *won't* include the current directory.

} > 	dirstack=( ${(u)$(< ~/.zdirs)} )
} 
} But the "u" parameter solves it indeed! Thank you very much for pointing
} it.

One other thing that just occurred to me is that a single line of
output is unreliable when a directory name may contains whitespace.
You should use:

	print -l $dirstack > ~/.zdirs
and
	dirstack=( ${(uf)"$(< ~/.zdirs)"} )

} > } OR you guys are now going to say: "Don't you know you're not supposed
} > } to use typeset with dirstack!!"
} >
} > You aren't
} 
} Is there any reason for why?

We're having a discussion about that over on zsh-workers right now.  My
position is that $dirstack is just a view on an internal data structure
that cannot be held responsible for the flags set on the parameter, and
therefore for consistency the parameter should not be allowed to have
flags that conflict with that internal structure (it happens to be a
linked list).

} I assumed I could treat dirstack as any other array since, well,
} the *manual* says dirstack is "a normal array".

I think "normal array" just means it's not an "associative array".

The only way to impose consistency with "typeset -U dirstack" on the
underlying internal structure would be to add

    chpwd() { dirstack=( ${(u)dirstack} ) }

