From zsh-workers-return-8897-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Dec 05 12:48:15 1999
Return-Path: <zsh-workers-return-8897-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25074 invoked from network); 5 Dec 1999 12:48:13 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 5 Dec 1999 12:48:13 -0000
Received: (qmail 13902 invoked by alias); 5 Dec 1999 12:48:07 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8897
Received: (qmail 13894 invoked from network); 5 Dec 1999 12:48:07 -0000
Subject: Re: Bug with parameter module
In-Reply-To: <E11uPpM-0007KC-00.1999-12-05-00-47-00@mail12.svr.pol.co.uk> from Peter Stephenson at "Dec 5, 1999  0:47:37 am"
To: pws@pwstephenson.fsnet.co.uk (Peter Stephenson)
Date: Sun, 5 Dec 1999 12:48:05 +0000 (GMT)
Cc: zsh-workers@sunsite.auc.dk
X-Mailer: ELM [version 2.4ME+ PL48 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Message-Id: <E11ub5B-0003ke-00@crucigera.fysh.org>
From: Zefram <zefram@fysh.org>

Peter Stephenson wrote:
>The shell hangs.  It seems that executing fn uses some wrapper associated
>with the parameter module which then won't unload.

Count me as "not surprised".  Unloading modules before exit is all very
well, but hanging if they won't unload is just asking for trouble.

>                                                    There should be some
>mode to force unloading on exit

No, it's simpler than that.  Just ignore errors; *attempt* to unload
each module, but leave it if it doesn't unload.

Forcing an unload when the module's code may be on the call stack seems
dangerous, and will at least be confusing to those using debuggers.

>                                (this is the real problem worked around in
>the case of zle by Clint's patch in 8862, I would think).

Yes.  That patch isn't necessary if you just ignore errors.

-zefram

