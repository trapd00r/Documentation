From zsh-users-return-13482-mason-zsh=primenet.com.au@sunsite.dk Sun Nov 23 22:27:52 2008
Return-Path: <zsh-users-return-13482-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11024 invoked from network); 23 Nov 2008 22:27:48 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 Nov 2008 22:27:48 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 91355 invoked from network); 23 Nov 2008 22:27:40 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 Nov 2008 22:27:40 -0000
Received: (qmail 24903 invoked by alias); 23 Nov 2008 22:27:23 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13482
Received: (qmail 24892 invoked from network); 23 Nov 2008 22:27:22 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 23 Nov 2008 22:27:22 -0000
Received: from smtprelay07.ispgateway.de (smtprelay07.ispgateway.de [80.67.29.7])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 49CD880525B4
	for <zsh-users@sunsite.dk>; Sun, 23 Nov 2008 23:27:06 +0100 (CET)
Received: from [212.117.84.133] (helo=fsst.voodoo.lan)
	by smtprelay07.ispgateway.de with esmtpsa (TLSv1:AES256-SHA:256)
	(Exim 4.68)
	(envelope-from <ft@bewatermyfriend.org>)
	id 1L4NQ2-0000iw-EA
	for zsh-users@sunsite.dk; Sun, 23 Nov 2008 23:27:06 +0100
Received: from hawk by fsst.voodoo.lan with local (Exim 4.69)
	(envelope-from <ft@bewatermyfriend.org>)
	id 1L4NPv-0001xC-By
	for zsh-users@sunsite.dk; Sun, 23 Nov 2008 23:26:59 +0100
Date: Sun, 23 Nov 2008 23:26:58 +0100
From: Frank Terbeck <ft@bewatermyfriend.org>
To: zsh-users@sunsite.dk
Subject: Re: vcs_info problem
Message-ID: <20081123222658.GC2757@fsst.voodoo.lan>
Mail-Followup-To: zsh-users@sunsite.dk
References: <20081123213233.GA7984@ruderich.org> <20081123214438.GB2757@fsst.voodoo.lan> <20081123220446.GA8594@ruderich.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
In-Reply-To: <20081123220446.GA8594@ruderich.org>
User-Agent: Mutt/1.5.18 (2008-05-17)
X-Df-Sender: 430444
X-Virus-Scanned: ClamAV 0.92.1/8666/Sun Nov 23 11:41:19 2008 on bifrost
X-Virus-Status: Clean

Simon Ruderich <simon@ruderich.org>:
> On Sun, Nov 23, 2008 at 10:44:39PM +0100, Frank Terbeck wrote:
> > Simon Ruderich <simon@ruderich.org>:
> >> I'm using Zsh 4.3.9 and trying to use vcs_info. I added the following to my
> >> .zshrc as documented in zshcontrib.
> >>
> >>     autoload -Uz vcs_info
> >>
> >>     zstyle ':vcs_info:*' actionformats \
> >>         '%F{5}(%f%s%F{5})%F{3}-%F{5}[%F{2}%b%F{3}|%F{1}%a%F{5}]%f '
> >>     zstyle ':vcs_info:*' formats       \
> >>         '%F{5}(%f%s%F{5})%F{3}-%F{5}[%F{2}%b%F{5}]%f '
> >>     zstyle ':vcs_info:(sv[nk]|bzr):*' branchformat '%b%F{1}:%F{3}%r'
> >>     precmd () { vcs_info }
> >>     PS1='%F{5}[%F{2}%n%F{5}] %F{3}%3~ ${vcs_info_msg_0_}'"%f%# '
> >                     here is your unmatched double quote --^
> 
> Thanks for your answer,
> 
> but when I remove the double quote it still doesn't work and I get this error:
> 
>     unmatched '
> 
> I took the example from the zshcontrib man page so it looks like there is an
> error.

Oops, yes. That's obviously wrong. Thanks for noticing.
That should be: PS1='%F{5}[%F{2}%n%F{5}] %F{3}%3~ ${vcs_info_msg_0_}%f%# '

> >> But if I use this vcs_info_msg_0_ is not expanded and stays in the prompt all
> >> the time.
> >
> > If you want to use $vcs_info_msg_0_ like this, you will need to use:
> >     setopt promptsubst
> >
> > Regards, Frank
> 
> Thanks, setting promptsubst worked fine.
> 
> I followed the introduction in the zshcontrib man page. Would it be possible
> to add this information there so other users can set it up without any
> problems?

Absolutely. I thought I had mentioned it. Seems like I forgot.

Patch for both issues included below.

> Just curious, what other ways to use vcs_info than ${vcs_info_msg_0_} exist?

Well, a lot of people (me included) build their prompt in precmd().
That way you can always get the fresh value out of $vcs_info_msg_0_
without having to use prompt_subst. Here is how I am building my
prompt, if you're wondering what I'm talking about:
<http://ft.bewatermyfriend.org/comp/zsh/functions/prompt_ft_setup.html>

Regards, Frank


Index: Doc/Zsh/contrib.yo
===================================================================
RCS file: /cvsroot/zsh/zsh/Doc/Zsh/contrib.yo,v
retrieving revision 1.92
diff -u -r1.92 contrib.yo
--- Doc/Zsh/contrib.yo	20 Nov 2008 18:12:32 -0000	1.92
+++ Doc/Zsh/contrib.yo	23 Nov 2008 22:25:11 -0000
@@ -362,12 +362,15 @@
     '%F{5}(%f%s%F{5})%F{3}-%F{5}[%F{2}%b%F{5}]%f '
 zstyle ':vcs_info:(sv[nk]|bzr):*' branchformat '%b%F{1}:%F{3}%r'
 precmd () { vcs_info }
-PS1='%F{5}[%F{2}%n%F{5}] %F{3}%3~ ${vcs_info_msg_0_}'"%f%# ')
+PS1='%F{5}[%F{2}%n%F{5}] %F{3}%3~ ${vcs_info_msg_0_}%f%# ')
 
 Obviously, the last two lines are there for demonstration: You need to
 call var(vcs_info) from your var(precmd) function. Once that is done you need
 a tt(single quoted) var('${vcs_info_msg_0_}') in your prompt.
 
+To be able to use var('${vcs_info_msg_0_}') directly in your prompt like
+this, you will need to have the tt(PROMPT_SUBST) option enabled.
+
 Now call the tt(vcs_info_printsys) utility from the command line:
 
 example(% vcs_info_printsys

