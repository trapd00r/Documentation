From zsh-users-return-13717-mason-zsh=primenet.com.au@sunsite.dk Fri Jan 16 16:19:52 2009
Return-Path: <zsh-users-return-13717-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2711 invoked from network); 16 Jan 2009 16:19:49 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.3 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Jan 2009 16:19:49 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 91068 invoked from network); 16 Jan 2009 16:19:40 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Jan 2009 16:19:40 -0000
Received: (qmail 12512 invoked by alias); 16 Jan 2009 16:19:26 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13717
Received: (qmail 12496 invoked from network); 16 Jan 2009 16:19:25 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 16 Jan 2009 16:19:25 -0000
Received: from cluster-d.mailcontrol.com (cluster-d.mailcontrol.com [85.115.60.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id F016980271F0
	for <zsh-users@sunsite.dk>; Fri, 16 Jan 2009 17:19:22 +0100 (CET)
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly50d.srv.mailcontrol.com (MailControl) with ESMTP id n0GGJC36017768
	for <zsh-users@sunsite.dk>; Fri, 16 Jan 2009 16:19:13 GMT
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Fri, 16 Jan 2009 16:19:08 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.2/8.13.4) with ESMTP id n0GGJ352024326
	for <zsh-users@sunsite.dk>; Fri, 16 Jan 2009 16:19:03 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.2/8.14.2/Submit) with ESMTP id n0GGJ37U024322
	for <zsh-users@sunsite.dk>; Fri, 16 Jan 2009 16:19:03 GMT
Message-Id: <200901161619.n0GGJ37U024322@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-users@sunsite.dk
Subject: Re: sourcing a sh file in zsh
In-reply-to: <09EB3187-4928-4F3D-8B14-427ACA93F790@gmail.com>
References: <BD9D2405-AD6A-4336-9C8A-85149165B6B8@gmail.com> <2d460de70901160716ke6e1f86xe49ccc6391feef2d@mail.gmail.com> <09EB3187-4928-4F3D-8B14-427ACA93F790@gmail.com>
Comments: In-reply-to Evert Rol <evert.rol@gmail.com>
   message dated "Fri, 16 Jan 2009 17:13:46 +0100."
Date: Fri, 16 Jan 2009 16:19:03 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 16 Jan 2009 16:19:08.0282 (UTC) FILETIME=[288DEDA0:01C977F6]
X-Scanned-By: MailControl A_08_51_00 (www.mailcontrol.com) on 10.68.0.160
X-Virus-Scanned: ClamAV 0.92.1/8871/Fri Jan 16 05:16:59 2009 on bifrost
X-Virus-Status: Clean

Evert Rol wrote:
> It turns out the error is indeed not in line #1, but a bit later:
> 
>    a_temp=`egrep "^[  ]*$a_host[    ]" "$a_root/somefile"`
> 
> If I change that line to
> 
>    a_temp=`egrep "^[  ]*${a_host}[    ]" "$a_root/somefile"`
> 
> the script passes fine, with exit code 0.
> 
> So perhaps sh/bash are more lenient towards the use of braces in  
> variables. At least a quick'n'dirty test script shows this.
> I don't know; anyway can comment on that?

It's the opposite: zsh is more lenient about braces, turning $a_host[ ]
into an array expression with an incorrect subscript.  So your fix is
fine.  Having "setopt ksharrays" would fix this, and this option is used
in compatibility modes, so indeed if you were in sh emulation as
explained by Bart this will work without modification.  The emulation is
a much better general solution---there are other compatibility issues,
many of the most important of which are listed in the FAQ
(http://zsh.dotsrc.org/FAQ/zshfaq02.html#l10).

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

