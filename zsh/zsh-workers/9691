From zsh-workers-return-9691-mason-zsh=primenet.com.au@sunsite.auc.dk Sat Feb 12 05:59:51 2000
Return-Path: <zsh-workers-return-9691-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20504 invoked from network); 12 Feb 2000 05:59:46 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 12 Feb 2000 05:59:46 -0000
Received: (qmail 10852 invoked by alias); 12 Feb 2000 05:59:25 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9691
Received: (qmail 10843 invoked from network); 12 Feb 2000 05:59:24 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000212055846.ZM6576@candle.brasslantern.com>
Date: Sat, 12 Feb 2000 05:58:46 +0000
In-Reply-To: <slrn8a9qc6.j8r.mason@coral.primenet.com.au>
Comments: In reply to mason@primenet.com.au (Geoff Wing)
        "BUG: backgrounding zsh does bad tty stuff" (Feb 12,  5:03am)
References: <slrn8a9qc6.j8r.mason@coral.primenet.com.au>
X-Mailer: Z-Mail (5.0.0 30July97)
To: mason@primenet.com.au, zsh-workers@sunsite.auc.dk
Subject: Re: BUG: backgrounding zsh does bad tty stuff
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Feb 12,  5:03am, Geoff Wing wrote:
} Subject: BUG: backgrounding zsh does bad tty stuff
}
} Heyla,
} 
} % zsh-3.0.7 -f
} % echo $SHLVL
} 2
} % zsh-3.0.7 -f &
} [1] 19784

I immediately get

[1]  + suspended (tty output)  zsh -f

at this point, even with "stty -tostop".  Linux won't let any process
but the tty group leader poke settings into the tty driver.

What operating system are you using?

However, what did you expect?  "zsh -f" has no idea that it's in the
background, and attempts to start up ZLE as usual.  That's going to
play havoc with the parent shell's tty driver if the OS will let it
get away with it.

There's even a loop in init.c:init_io() where zsh repeatedly attempts to
force itself to be the tty foreground process, sending the pgrp leader
a SIGTTIN and then attempting to grab the tty.  Not pretty, but it has
been there for a very long time.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

