From zsh-users-return-6605-mason-zsh=primenet.com.au@sunsite.dk Fri Sep 19 16:32:35 2003
Return-Path: <zsh-users-return-6605-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28939 invoked from network); 19 Sep 2003 16:32:34 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 19 Sep 2003 16:32:34 -0000
Received: (qmail 24825 invoked by alias); 19 Sep 2003 16:32:14 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 6605
Received: (qmail 24806 invoked from network); 19 Sep 2003 16:32:13 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 19 Sep 2003 16:32:13 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [212.227.126.186] by sunsite.dk (MessageWall 1.0.8) with SMTP; 19 Sep 2003 16:32:13 -0000
Received: from [212.227.126.155] (helo=mrelayng.kundenserver.de)
	by moutng.kundenserver.de with esmtp (Exim 3.35 #1)
	id 1A0OB1-0002Va-00; Fri, 19 Sep 2003 18:32:11 +0200
Received: from [217.224.233.218] (helo=zaphod.home.lan)
	by mrelayng.kundenserver.de with asmtp (TLSv1:EDH-RSA-DES-CBC3-SHA:168)
	(Exim 3.35 #1)
	id 1A0OB1-0004o5-00; Fri, 19 Sep 2003 18:32:11 +0200
Received: from anarchy.home.lan (anarchy.home.lan [3ffe:b80:24b:1:20c:76ff:fe13:cf8a])
	by zaphod.home.lan (8.11.6/8.11.6) with ESMTP id h8JGW8n19054;
	Fri, 19 Sep 2003 18:32:09 +0200
From: Malte Starostik <malte.starostik@t-online.de>
To: zsh-users@sunsite.dk
Subject: Re: Completing possible elements of a comma-separated list
Date: Fri, 19 Sep 2003 18:31:59 +0200
User-Agent: KMail/1.5.9
Cc: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <200309181908.01862.malte.starostik@t-online.de> <9838.1063976598@gmcs3.local>
In-Reply-To: <9838.1063976598@gmcs3.local>
X-Security-Warning: All Your Base Are Belong To Us!
MIME-Version: 1.0
Content-Disposition: inline
Content-Type: Text/Plain;
  charset="iso-8859-15"
Content-Transfer-Encoding: quoted-printable
Message-Id: <200309191832.06224.malte.starostik@t-online.de>

=2D----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Friday 19 September 2003 15:03, Oliver Kiddle wrote:
> Malte Starostik wrote:
> > I'm trying to write a completion for slptool. One of its commands is
> >     slptool findattrs <service> [attr ids]
> >
> > Now I'd like to continue completion with the same list of possible
> > matches, completing any id in the comma separated list independently of
> > each other against the list of available ids.
>
> Easiest way is probably to use:
>   _values -s , 'attribute id' $(slptool findattrs ...)
>
> Otherwise, you can use:
>
> local -a suf
> compset -P '*,'
> compset -S ',*' || suf=3D( -S , )
> compadd ... "$suf[@]" ...
>
> That'll make it ignore anything before the cursor up the last comma
> (and the same in reverse for after the cursor).

Thanks, these both work, the latter a little better as it accepts -M to get=
=20
case-insensitivity.

> > Also, would be nice if
> >     slptool findattrs example.acme u,p<TAB>
> > could complete to
> >     slptool findattrs example.acme username,password,
> > as well.
>
> That's harder. _sep_parts or _multi_parts might help you. Otherwise, you
> need to start using compadd -O and it gets complicated.

for _multi_parts I'd need to add all possible permutations I gather? Anyway=
,=20
this Works For Me (TM):

    local -a attrs
    local parts
    attrs=3D($(slptool findattrs $words[2] | \
               perl -pi -e 's#\(([^()]+)=3D[^()]*\),?#$1\n#g'))
    parts=3D"_sep_parts -M 'm:{a-zA-Z}=3D{A-Za-z}'"
    repeat $[${#attrs}*5] do
        parts=3D"$parts attrs ,";
    done
    eval $parts

*5 is an arbitrary value that allows for listing attributes multiple times.=
=20
Not that useful but allowed and it look like the list can be continued almo=
st=20
indefinately :-)
I only wonder why it seems to ignore -M ...

Thanks alot,
=2D -Malte
=2D----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.3 (GNU/Linux)

iD8DBQE/ay+CVDF3RdLzx4cRAi1hAJ4zddBRSA23EXXCPQZhc7IhzEKooACgwg2T
rGMDXOsX/KKZivHzFz2gRDs=3D
=3D1ACe
=2D----END PGP SIGNATURE-----

