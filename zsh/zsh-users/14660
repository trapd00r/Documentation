From zsh-users-return-14660-mason-zsh=primenet.com.au@zsh.org Fri Dec 18 10:46:34 2009
Return-Path: <zsh-users-return-14660-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22046 invoked by alias); 18 Dec 2009 10:46:34 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14660
Received: (qmail 24393 invoked from network); 18 Dec 2009 10:46:23 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-3.0 required=5.0 tests=AWL,BAYES_00,
	RCVD_IN_DNSWL_LOW,SPF_HELO_PASS autolearn=ham version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at csr.com does not designate permitted sender hosts)
Date: Fri, 18 Dec 2009 10:46:16 +0000
From: Peter Stephenson <pws@csr.com>
To: zsh-users@zsh.org
Subject: Re: Force file completion when hitting TAB twice
Message-ID: <20091218104616.49dafffa@news01>
In-Reply-To: <20091217175808.2e860888@abz8111lx.eurac.edu>
References: <20091217175808.2e860888@abz8111lx.eurac.edu>
Organization: CSR
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.8; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 18 Dec 2009 10:46:16.0932 (UTC) FILETIME=[537FC240:01CA7FCF]
X-Scanned-By: MailControl A-09-22-10 (www.mailcontrol.com) on 10.68.0.115

On Thu, 17 Dec 2009 17:58:08 +0100
"Yuri D'Elia" <wavexx@users.sf.net> wrote:
> Hi everyone. I'm trying to customize the completion of zsh so that:
> 
> * when I hit TAB the default _complete completer is used.
> * if no completions are available, I get a beep.
> * if I hit TAB again, or hit TAB twice, I get a _files completer
>   (offering me to complete filenames regardless of the context).

Try this and let us know how you get on...  $LASTWIDGET test is
unsophisticated but probably covers the most obvious cases.


_complete_failed() {
  # Only complete if first attempt at completion failed.
  # Usage:
  #   zstyle ':completion:*' completer _complete _complete-failed
  #   zstyle ':completion:complete-failed:*' completer <your-completers>

  if [[ $LASTWIDGET = *complete* && -z $_complete_failed_active ]]; then
    local _complete_failed_active=1
    local -a completers
    local curcontext="complete-failed:::"
    _main_complete "${completers[@]}"
  fi
}
zstyle ':completion:*' completer _complete _complete-failed
zstyle ':completion:complete-failed:*' completer _files


-- 
Peter Stephenson <pws@csr.com>            Software Engineer
Tel: +44 (0)1223 692070                   Cambridge Silicon Radio Limited
Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, UK


Member of the CSR plc group of companies. CSR plc registered in England and Wales, registered number 4187346, registered office Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, United Kingdom

