From zsh-workers-return-19025-mason-zsh=primenet.com.au@sunsite.dk Wed Sep 03 15:53:34 2003
Return-Path: <zsh-workers-return-19025-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24238 invoked from network); 3 Sep 2003 15:53:33 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 3 Sep 2003 15:53:33 -0000
Received: (qmail 27831 invoked by alias); 3 Sep 2003 15:53:12 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19025
Received: (qmail 27776 invoked from network); 3 Sep 2003 15:53:11 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 3 Sep 2003 15:53:11 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [193.109.254.211] by sunsite.dk (MessageWall 1.0.8) with SMTP; 3 Sep 2003 15:53:10 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-8.tower-36.messagelabs.com!1062604389!325416
X-StarScan-Version: 5.0.7; banners=-,-,-
Received: (qmail 12056 invoked from network); 3 Sep 2003 15:53:09 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-8.tower-36.messagelabs.com with SMTP; 3 Sep 2003 15:53:09 -0000
Received: from gmcs3.local ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id h83Fr8HM010753
	for <zsh-workers@sunsite.dk>; Wed, 3 Sep 2003 16:53:09 +0100
Received: from gmcs3.local (localhost [127.0.0.1])
	by gmcs3.local (8.11.6/8.11.6/SuSE Linux 0.5) with ESMTP id h83FtAk27166
	for <zsh-workers@sunsite.dk>; Wed, 3 Sep 2003 17:55:10 +0200
To: zsh-workers@sunsite.dk (Zsh hackers list)
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <1030903143538.ZM19062@candle.brasslantern.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <25211.1062585848@csr.com> <13617.1062597424@gmcs3.local> <1030903143538.ZM19062@candle.brasslantern.com>
Subject: Re: PATCH: Re: completing commands 
Date: Wed, 03 Sep 2003 17:55:09 +0200
Message-ID: <27164.1062604509@gmcs3.local>

Bart wrote:
> On Sep 3,  3:57pm, Oliver Kiddle wrote:
> }
> } In addition to that, it refuses to complete local directories in the
> } current directory.
> 
> Really?  I get them completed in 4.0.6, even without your patch.  Can
> you show an example of the before and after behavior?

I get them completed in 4.0 too.

The cause is the last part of 15945. It prevents (in _cd) local
directory completion in command completion because "that's already
handled by _command_names". However, if you look at _command_names, you
will see that it only completes directories if  
  [[ -n "$path[(r).]" || $PREFIX = */* ]]

So my patch makes _cd again complete local directories when that
condition is not true.

That part of 15945 was an attempt to solve the problem Peter reported
but it only covered one of the two places where _cd was completing
directories.

Oliver

