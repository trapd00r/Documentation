From zsh-workers-request@euclid.skiles.gatech.edu Wed Mar 05 21:07:19 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 7087 invoked from network); 5 Mar 1997 21:07:17 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 5 Mar 1997 21:07:17 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id PAA01835; Wed, 5 Mar 1997 15:54:30 -0500 (EST)
Resent-Date: Wed, 5 Mar 1997 15:54:30 -0500 (EST)
From: <hzoli@VNET.IBM.COM> (Zoltan T. Hidvegi)
Message-Id: <9703052056.AA20981@lotto.fishkill.ibm.com>
Subject: Re: zle_refresh patch 2
In-Reply-To: <970203100507.ZM10555@candle.brasslantern.com> from Bart Schaefer at "Feb 3, 97 10:05:07 am"
To: schaefer@nbn.com
Date: Wed, 5 Mar 1997 15:56:25 -0500 (EST)
Cc: gwing@primenet.com.au, zsh-workers@math.gatech.edu
X-Mailer: ELM [version 2.4ME+ PL31 (25)]
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"zXbpv1.0.bS.5sT7p"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2953
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Bart Schaefer wrote:
> On Feb 3,  9:55pm, gwing@primenet.com.au wrote:
> } Subject: zle_refresh patch 2
> }
> } It fixes coredumps and bad displays when terms are 1 or 2 lines.
> } When a terminal is 1 or 2 lines high, the terminal will act as if
> } SINGLE_LINE_ZLE is set.  This avoids many problems with the status line.
>
> There's already code that causes SINGLE_LINE_ZLE to become set if the
> terminal starts out at, or is shrunk to, 1 line high or 1 column wide.
> (It happens when $COLUMNS or $LINES changes.)  Some of that code is a
> few lines above your changes to test (lines < 3).  If it's necessary to
> behave as SINGLE_LINE_ZLE for 2 lines as well, the other code should be
> changed so that SINGLE_LINE_ZLE *is* set when zsh is `acting as if' it
> is set.

I'm not exactly sure that it is a good idea to explicitely set
SINGLELINEZLE when the terminal shrinks to one or two lines.  It is similar
to that it is not good to unset SINGLELINEZLE when the terminal size
changes back to normal again.  If one resizes the terminal to one/two lines
he wants zsh to behave as if single_line_zle was set but after he brings
back the terminal to normal size, he wants the normal zle again.
I.e. single_line_zle unset should mean use normal zle if possible.

An other problem with Geoff's patch (whics is not a new problem, just this
patch brought it up.  tsetcap only works in multiline mode, as it simply
assumes that in single line mode termcap escapes are not available.  This
means that some prompt escapes do not work in single line mode, which is
especially annoying in print -P commands.  There should be a separate flag
which shows that termcap is not available and of course this involvs
single_line_zle but they are not equivalent.

I'd really like to release zsh-3.0.3 ASAP, but these problems should be
solved first.  Also there has been some bug reports about refresh problems
with some vt100 termcaps which are I think not fixed yet, but I do not have
the problematic termcap entry to test it so I'm not sure.

Unfortunately I still do not have a computer at home (I hope to get one
within two weeks), so I do not have much time to track down these problems,
and even if I had time, I'm not really an expert in zle_refrech.c, so I
hope that someone with more knowledge in this area can look at these
problems.

Zoltan

