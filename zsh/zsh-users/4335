From zsh-users-return-4335-mason-zsh=primenet.com.au@sunsite.dk Wed Oct 03 21:47:26 2001
Return-Path: <zsh-users-return-4335-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26170 invoked from network); 3 Oct 2001 21:47:26 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 3 Oct 2001 21:47:26 -0000
Received: (qmail 2757 invoked by alias); 3 Oct 2001 21:46:57 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4335
Received: (qmail 2740 invoked from network); 3 Oct 2001 21:46:55 -0000
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <011003144640.ZM29828@candle.brasslantern.com>
Date: Wed, 3 Oct 2001 14:46:40 -0700
In-Reply-To: <4ac3d14900vincent@vinc17.org>
Comments: In reply to Vincent Lefevre <vincent@vinc17.org>
        "Re: get the number of active jobs to show in the prompt?" (Oct  3, 10:08pm)
References: <20011002181324.A29201@greux.loria.fr> 
	<200110022325.JAA07306@bruce.csse.monash.edu.au> 
	<4ac3633923vincent@vinc17.org> 
	<1011003054350.ZM25561@candle.brasslantern.com> 
	<20011003162246.C32766@greux.loria.fr> 
	<1011003151104.ZM26311@candle.brasslantern.com> 
	<20011003173500.A1255@greux.loria.fr> 
	<1011003155807.ZM26499@candle.brasslantern.com> 
	<20011003184755.A1397@greux.loria.fr> 
	<1011003170926.ZM29592@candle.brasslantern.com> 
	<20011003213437.A1668@greux.loria.fr> 
	<011003130131.ZM29770@candle.brasslantern.com> 
	<4ac3d14900vincent@vinc17.org>
X-Mailer: Z-Mail Lite (5.0.0 30July97)
To: Vincent Lefevre <vincent@vinc17.org>, zsh-users@sunsite.dk
Subject: Re: get the number of active jobs to show in the prompt?
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Oct 3, 10:08pm, Vincent Lefevre wrote:
> > It's not the widget that's doing it.  It's the ZLE internal screen refresh
> 
> OK, so there could be another flag to tell whether to print "\n" or "\r".

Once again, it's not that simple.  It's not just printing a "\n" -- it's
moving the cursor to below the current editing area, which could be many
lines high.

And printing an '\r' instead might still put the new prompt in the middle
of said multi-line area.

At this point Geoff Wing is the right person to continue this discussion
if it's going to be continued, as he's the most recent primary author of
the ZLE screen refresh routines.

Meanwhile, since you know your own prompt doesn't change size, you could
try fooling with something like this:

    zmodload -i zsh/termcap
    function redraw-prompt {
	zle .clear-screen
	if (( BUFFERLINES < LINES - 1 ))
	then
	    precmd
	    echotc sc
	    echotc ho
	    print -nP "$PS1"
	    echotc rc
	fi
	return 0
    }
    zle -N clear-screen redraw-prompt

That'll only work for terminals that have sc/rc (save/restore cursor), and
your PS1 better not have %E in it.

