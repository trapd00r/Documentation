From zsh-workers-request@euclid.skiles.gatech.edu  Fri Jan  5 03:43:00 1996
Received: from euclid.skiles.gatech.edu (euclid.skiles.gatech.edu [130.207.146.50]) by werple.net.au (8.7/8.7.1) with ESMTP id DAA05023 for <mason@werple.mira.net.au>; Fri, 5 Jan 1996 03:42:55 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id LAA02331; Thu, 4 Jan 1996 11:16:14 -0500 (EST)
Resent-Date: Thu, 4 Jan 1996 11:16:14 -0500 (EST)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199601041616.RAA07946@bolyai.cs.elte.hu>
Subject: Token printig fix and a bug
To: zsh-workers@math.gatech.edu (zsh-workers)
Date: Thu, 4 Jan 1996 17:16:30 +0100 (MET)
Organization: Dept. of Comp. Sci., Eotvos University, Budapest, Hungary
Phone: (36 1)2669833 ext: 2667, home phone: (36 1) 2752368
X-Mailer: ELM [version 2.4 PL24 PGP3 *ALPHA*]
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"uSVvY3.0.La.Dr_wm"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/705
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

bolyai ~ % zsh -f
bolyai% echo *bar
zsh: no matches found: bar

As you can see the * is missing from the error message.  The fix for that is
below.

The other bug:

bolyai ~ % zsh -f
bolyai% echo foo > /dev/null 2>&1 2>&1
bolyai% echo foo >&2
bolyai% 

Note that the second echo did not print foo.

I admit you rarely do this but there is a more common idiom which produces
this bug:

bolyai ~ % zsh -f
bolyai% echo foo >& /dev/null >& /dev/null
bolyai% echo foo >&2 
bolyai% 

Here foo disappears again. 

Note that this redirection bug only happens with builtins (obviously since
otherwise redirection is done after forking).
Cheers,

Zoltan

*** Src/utils.c	1995/12/22 16:50:13	1.9
--- Src/utils.c	1996/01/03 23:02:33	1.10
***************
*** 157,164 ****
      char *s = buf;
      c &= 0xff;
      if (itok(c)) {
! 	if(c >= Pound && c <= Comma)
! 	    c = ztokens[c - Pound];
  	else 
  	    c = 0;
  	goto done;
--- 157,164 ----
      char *s = buf;
      c &= 0xff;
      if (itok(c)) {
! 	if(c >= STOUC(Pound) && c <= STOUC(Comma))
! 	    c = ztokens[c - STOUC(Pound)];
  	else 
  	    c = 0;
  	goto done;

