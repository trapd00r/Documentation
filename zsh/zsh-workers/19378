From zsh-workers-return-19378-mason-zsh=primenet.com.au@sunsite.dk Thu Jan 15 16:52:59 2004
Return-Path: <zsh-workers-return-19378-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21195 invoked from network); 15 Jan 2004 16:52:58 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 15 Jan 2004 16:52:58 -0000
Received: (qmail 5573 invoked by alias); 15 Jan 2004 16:52:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19378
Received: (qmail 5528 invoked from network); 15 Jan 2004 16:52:48 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 15 Jan 2004 16:52:48 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [193.109.254.211] by sunsite.dk (MessageWall 1.0.8) with SMTP; 15 Jan 2004 16:52:47 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-10.tower-36.messagelabs.com!1074185565!3130353
X-StarScan-Version: 5.1.15; banners=-,-,-
Received: (qmail 25656 invoked from network); 15 Jan 2004 16:52:45 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-10.tower-36.messagelabs.com with SMTP; 15 Jan 2004 16:52:45 -0000
Received: from gmcs3.local ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id i0FGqiuB005179
	for <zsh-workers@sunsite.dk>; Thu, 15 Jan 2004 16:52:45 GMT
Received: from gmcs3.local (localhost [127.0.0.1])
	by gmcs3.local (8.11.6/8.11.6/SuSE Linux 0.5) with ESMTP id i0FGurI12497
	for <zsh-workers@sunsite.dk>; Thu, 15 Jan 2004 17:56:53 +0100
X-VirusChecked: Checked
X-StarScan-Version: 5.1.13; banners=.,-,-
From: Oliver Kiddle <okiddle@yahoo.co.uk>
To: Zsh workers <zsh-workers@sunsite.dk>
Subject: PATCH: new _update-rc.d
Date: Thu, 15 Jan 2004 17:56:52 +0100
Message-ID: <12495.1074185812@gmcs3.local>

new completion function for update-rc.d (Debian's equivalent of chkconfig).

_services was picking up things like README files so I've restricted it to
executables.

Index: Completion/Debian/Command/_update-rc.d
===================================================================
RCS file: Completion/Debian/Command/_update-rc.d
diff -N Completion/Debian/Command/_update-rc.d
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ Completion/Debian/Command/_update-rc.d	15 Jan 2004 16:46:54 -0000
@@ -0,0 +1,28 @@
+#compdef update-rc.d
+
+local curcontext="$curcontext" state line expl
+
+_arguments -C \
+  '-n[show actions without performing them]' \
+  '-f[force removal of symlinks]' \
+  '1:service:_services' \
+  '2:command:(remove defaults start stop)' \
+  '*::args:->args' && return
+
+case $words[2] in
+  defaults)
+    _message -e number 'sequence number'
+  ;;
+  remove)
+    _message 'no more arguments'
+  ;;
+  st*)
+    case ${words[CURRENT-1]} in
+      .) _wanted commands expl commands compadd start stop && return ;;
+      start|stop) _message -e number 'sequence number' ;;
+      *) _message -e runlevels run\ level ;;
+    esac
+  ;;
+esac
+
+return 1
Index: Completion/Unix/Type/_services
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Type/_services,v
retrieving revision 1.2
diff -u -r1.2 _services
--- Completion/Unix/Type/_services	14 May 2002 08:08:45 -0000	1.2
+++ Completion/Unix/Type/_services	15 Jan 2004 16:46:54 -0000
@@ -8,7 +8,7 @@
   inits=( ${${${alls[1,(r)xinetd based*]}[1,-2]}/%[[:space:]]*/} )
   xinetds=( ${${${${alls[(r)xinetd based*,-1]}[2,-1]}/#[[:space:]]#}/%:*} )
 else
-  inits=( /etc/init.d/*(:t) )
+  inits=( /etc/init.d/*(-*:t) )
 fi
 
 _tags init xinetd

