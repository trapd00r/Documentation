From zsh-workers-return-6936-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Jul 01 06:39:27 1999
Return-Path: <zsh-workers-return-6936-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6261 invoked from network); 1 Jul 1999 06:39:26 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 1 Jul 1999 06:39:26 -0000
Received: (qmail 1575 invoked by alias); 1 Jul 1999 06:39:12 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6936
Received: (qmail 1568 invoked from network); 1 Jul 1999 06:39:12 -0000
Date: Thu, 1 Jul 1999 08:39:11 +0200 (MET DST)
Message-Id: <199907010639.IAA27678@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: mason@primenet.com.au's message of 30 Jun 1999 18:09:00 GMT
Subject: Re: BUG: zsh-3.1.5-pws-24: time is dead


mason@primenet.com.au wrote:

> Heyla,
> % zsh -f
> % time =echo foobar
> foobar
> % =time =echo foobar
> foobar
>         0.01 real         0.00 user         0.01 sys
> % which -a time
> time: shell reserved word
> /usr/bin/time
> %

It may well be that it was me who broke this.

This patch seems to work, but since I don't know why it worked before, 
I'm not really happy with it.

Bye
 Sven

diff -u os/jobs.c Src/jobs.c
--- os/jobs.c	Wed Jun 30 11:56:49 1999
+++ Src/jobs.c	Thu Jul  1 08:31:58 1999
@@ -494,9 +494,14 @@
     int conted = 0, lineleng = columns, skip = 0, doputnl = 0;
     FILE *fout = (synch == 2) ? stdout : shout;
 
-    if (jn->stat & STAT_NOPRINT)
+    if (jn->stat & STAT_NOPRINT) {
+	if ((jn->stat & (STAT_TIMED | STAT_DONE)) == (STAT_TIMED | STAT_DONE) &&
+	    should_report_time(jn)) {
+	    jn->stat &= ~STAT_TIMED;
+	    dumptime(jn);
+	}
 	return;
-
+    }
     if (lng < 0) {
 	conted = 1;
 	lng = 0;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

