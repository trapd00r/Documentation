From zsh-workers-return-16683-mason-zsh=primenet.com.au@sunsite.dk Thu Feb 21 06:50:52 2002
Return-Path: <zsh-workers-return-16683-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27475 invoked from network); 21 Feb 2002 06:50:51 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 21 Feb 2002 06:50:51 -0000
Received: (qmail 20149 invoked by alias); 21 Feb 2002 06:50:46 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16683
Received: (qmail 20136 invoked from network); 21 Feb 2002 06:50:44 -0000
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <1020221065017.ZM1834@candle.brasslantern.com>
Date: Thu, 21 Feb 2002 06:50:16 +0000
In-Reply-To: <20020218015523.GA23456@dman.com>
Comments: In reply to Clint Adams <schizo@debian.org>
        "Re: Bug#134474: zsh misbehaves if LINES=2" (Feb 17,  8:55pm)
References: <E16cYRl-00039Y-00@silk.kitenet.net> 
	<20020218015523.GA23456@dman.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Clint Adams <schizo@debian.org>, Zsh-workers <zsh-workers@sunsite.dk>
Subject: Re: Bug#134474: zsh misbehaves if LINES=2
Cc: Joey Hess <joeyh@debian.org>, 134474-forwarded@bugs.debian.org
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Feb 17,  8:55pm, Clint Adams wrote:
} Subject: Re: Bug#134474: zsh misbehaves if LINES=2
}
} > As you probably know, my zsh prompt sets the xterm title. Well, this
} > seems to not work in an xterm that is sized to 80x2. Updates to the
} > title, which should happen every time the prompt is displayed, do not.
} > 
} > My guess is that zsh is doing some kind of trimming of the prompt it
} > displays if the terminal seems to be too small to contain the whole
} > thing, or something like that.
} 
} Yes, it considers the terminal to be short if it's under 3 lines long;
} what I don't understand is why it's eliding everything within %{ %}.

This is from SINGLE_LINE_ZLE mode, which is automatically turned on when
LINES becomes too small, and is done by singlerefresh() rather than by
the prompt code.  The right-side prompt is turned off in this case as
well.  This is (sort of, not well) documented in "man zshzle".

However, the prompt code disables termcap sequences like underlining on
short terminals; see Src/prompt.c:tsetcap().  This is probably done in
support of SINGLE_LINE_ZLE, but if so I think it ought to be based on
the option setting rather than on (termflags & TERM_SHORT).

Geoff?

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

