From zsh-workers-request@euclid.skiles.gatech.edu Fri Dec 20 00:54:54 1996
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 6319 invoked from network); 20 Dec 1996 00:54:51 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 20 Dec 1996 00:54:51 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id TAA18476; Thu, 19 Dec 1996 19:54:38 -0500 (EST)
Resent-Date: Thu, 19 Dec 1996 19:54:38 -0500 (EST)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199612200055.BAA03549@bolyai.cs.elte.hu>
Subject: Re: zsh-3.0.2 repacked
In-Reply-To: <199612200038.BAA18599@sally.ifm.uni-kiel.de> from Wolfgang Hukriede at "Dec 20, 96 01:38:39 am"
To: whukriede@ifm.uni-kiel.de (Wolfgang Hukriede)
Date: Fri, 20 Dec 1996 01:55:42 +0100 (MET)
Cc: zsh-workers@math.gatech.edu
Organization: Dept. of Comp. Sci., Eotvos University, Budapest, Hungary
Phone: (36 1)2669833 ext: 2667, home phone: (36 1) 2752368
X-Mailer: ELM [version 2.4ME+ PL27 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"Tmiie.0.dW4.DFUko"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2601
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Wolfgang Hukriede wrote:
> I'm sorry, but definitely there's no such alleged bug in the NeXTStep libc.
[...]
> Then, after:
> 
>         setvbuf(shout, NULL, _IOFBF, 0);
> 
> shout->_bufsiz gives ZERO, as well as shout->_base still is ZERO, in other
> words, shout is unbuffered. I cannot imagine this should be different with
> other libc's. Have you actually checked this?

Yes of course.  On all other systems I know (and I tesed zsh on 8 different
Unix systems) setvbuf ignores the last argument of setvbuf if the second
argument is NULL.  And conditional compilation is probably has been put
there because there were some systems without setvbuf or _IOFBF.  And only
NeXTStep people complained about slow refresh so I'm pretty sure that
NeXTStep is the only system with this behaviour.

And I used static buffer instead of passing NULL to make sure that it will
really work.  I can imagine that some other system's buggy libc would
interpret non-zero last argument as if you had given it a buffer at address
NULL.

Zoltan

