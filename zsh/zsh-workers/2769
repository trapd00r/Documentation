From zsh-workers-request@euclid.skiles.gatech.edu Fri Jan 10 15:17:15 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 414 invoked from network); 10 Jan 1997 15:17:11 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 10 Jan 1997 15:17:11 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id JAA08476; Fri, 10 Jan 1997 09:58:56 -0500 (EST)
Resent-Date: Fri, 10 Jan 1997 09:58:56 -0500 (EST)
From: Zefram <zefram@dcs.warwick.ac.uk>
Message-Id: <28477.199701101459@stone.dcs.warwick.ac.uk>
Subject: undo and history
To: zsh-workers@math.gatech.edu (Z Shell workers mailing list)
Date: Fri, 10 Jan 1997 14:59:50 +0000 (GMT)
X-Patch: 191
X-Loop: zefram@dcs.warwick.ac.uk
X-Stardate: [-31]8708.12
X-US-Congress: Moronic fuckers
Content-Type: text
Resent-Message-ID: <"sC6YD3.0.N42.labro"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2769
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

-----BEGIN PGP SIGNED MESSAGE-----

This patch further modifies the ZLE undo system, after patch 2746.
It adds some collusion between the history event selection code and
the undo system, so that modifications of arbitrary history lines will
work correctly.  The code to switch to a different history event is also
moved into a single function, reducing code duplication.

begin 644 undo_patch_2.gz
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
BO(J8[!"JDU()*T:J;L=+PP(6):$*,.KY_2\X(;#:C5@`````
`
end

-----BEGIN PGP SIGNATURE-----
Version: 2.6.2

iQCVAwUBMtWPGnD/+HJTpU/hAQEymgP9EX+z6pJM3E4KrHuOozwM7b6m6yBCYLw+
4XyClh7FfGpSfNZo4L/VSk6N/iROwFDcbYgv++Cm5ChM49HHI6FKKRF+/CZ93RzU
Qb8r314k0g0VdzyXe+SISmgWnCYvATsaxeq/ncrf5j4Rf0EPQl8vL2Vz79tvyMJI
5B8xL+ZPtA0=
=KzDh
-----END PGP SIGNATURE-----

