From zsh-workers-return-21068-mason-zsh=primenet.com.au@sunsite.dk Sun Mar 27 00:37:09 2005
Return-Path: <zsh-workers-return-21068-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11618 invoked from network); 27 Mar 2005 00:37:08 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 27 Mar 2005 00:37:08 -0000
Received: (qmail 9658 invoked from network); 27 Mar 2005 00:37:02 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 27 Mar 2005 00:37:02 -0000
Received: (qmail 10764 invoked by alias); 27 Mar 2005 00:36:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21068
Received: (qmail 10749 invoked from network); 27 Mar 2005 00:36:58 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 27 Mar 2005 00:36:58 -0000
Received: (qmail 9353 invoked from network); 27 Mar 2005 00:36:58 -0000
Received: from acolyte.scowler.net (216.254.112.45)
  by a.mx.sunsite.dk with SMTP; 27 Mar 2005 00:36:55 -0000
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id 575EE7004D; Sat, 26 Mar 2005 19:36:52 -0500 (EST)
Date: Sat, 26 Mar 2005 19:36:52 -0500
From: Clint Adams <schizo@debian.org>
To: zsh-workers@sunsite.dk
Cc: Vincent Lefevre <vincent@vinc17.org>,
	299950-forwarded@bugs.debian.org
Subject: Re: Bug#299950: zsh: Better completion for "svn revert"
Message-ID: <20050327003652.GA20238@scowler.net>
Mail-Followup-To: zsh-workers@sunsite.dk,
	Vincent Lefevre <vincent@vinc17.org>,
	299950-forwarded@bugs.debian.org
References: <20050317142638.GA23797@dixsept.loria.fr> <20050325142839.GA32333@scowler.net> <20050325161734.GT19392@ay.vinc17.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20050325161734.GT19392@ay.vinc17.org>
User-Agent: Mutt/1.5.6+20040907i
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.5

> This wouldn't be sufficient. In the first column, this would be at
> least 'A', 'D' (note that the file no longer exists, but completion
> should be able to give the deleted file) and 'M'. In the second
> column, this would be 'M'.

I'm not sure I understand.  Does this patch make it do the right thing?

Index: Completion/Unix/Command/_subversion
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_subversion,v
retrieving revision 1.8
diff -u -r1.8 _subversion
--- Completion/Unix/Command/_subversion	23 Jan 2005 19:56:09 -0000	1.8
+++ Completion/Unix/Command/_subversion	27 Mar 2005 00:32:18 -0000
@@ -21,6 +21,11 @@
   [[ -f ${(M)REPLY##*/}.svn/text-base/${REPLY##*/}.svn-base ]]
 }
 
+(( $+functions[_svn_adm_files] )) ||
+_svn_adm_files() {
+  compadd ${${(M)${(f)"$(svn status)"}:#(#s)[ADM]*}##[ADM] ##}
+}
+
 (( $+functions[_svn_urls] )) ||
 _svn_urls() {
   local expl
@@ -82,6 +87,11 @@
 	'*:file:_files -g "*(e:_svn_controlled:)"'
       )
     ;;
+    (revert)
+      _svn_subcmds+=(
+	'*:file:_svn_adm_files'
+      )
+    ;;
     *)
       case $_svn_subcmd_usage in
         *(SRC|DST|TARGET|URL*PATH)*)

