From zsh-workers-return-15482-mason-zsh=primenet.com.au@sunsite.dk Wed Jul 25 10:44:33 2001
Return-Path: <zsh-workers-return-15482-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9018 invoked from network); 25 Jul 2001 10:44:31 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 25 Jul 2001 10:44:31 -0000
Received: (qmail 20737 invoked by alias); 25 Jul 2001 10:44:20 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15482
Received: (qmail 20726 invoked from network); 25 Jul 2001 10:44:20 -0000
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
Date: Wed, 25 Jul 2001 12:43:50 +0200 (MET DST)
Message-Id: <200107251043.MAA18601@beta.informatik.hu-berlin.de>
To: zsh-workers@sunsite.dk
Subject: Re: About the new long/short options changes
In-Reply-To: <Tc0a88d0154f6391fb8@mailsweeper01.cambridgesiliconradio.com>

Peter Stephenson wrote:

> Borsenkow Andrej wrote:
> > > 
> > > The result is the patch below, which is already quite satisfying, I
> > > think.
> > 
> > It looks a bit strange to me (no change in setup):
> 
> I don't get this, even with the complete set of styles and options.  Are
> you sure you've installed the new libraries?

It doesn't happen for all commands -- I used `-1' instead of `-2', which
removed consecutive dummy matches.  Ahem.  And then I found a possible
problem in the code that calculates the width needed for the options
(which didn't happen in this case, though).

> The format looks extremely impressive.  The only point I'd make is the
> utterly trivial one that using `--' to introduce the description is a bit
> confusing when there are lots of --'s around introducing options.  How
> about `#'?

Yes, I was slightly worried, too.  I'm not too sure about `#', I'd
prefer something less `bold' (I hope you understand what I mean, the `#'
is so `dark', err... ;-).  And the `--' is used elsewhere, but what
about making it configurable, it's just a little style, after all -- and
then we can use `#' or `--' as the default.


Bye
  Sven

Index: Doc/Zsh/compwid.yo
===================================================================
RCS file: /cvsroot/zsh/zsh/Doc/Zsh/compwid.yo,v
retrieving revision 1.31
diff -u -r1.31 compwid.yo
--- Doc/Zsh/compwid.yo	2001/07/25 08:52:34	1.31
+++ Doc/Zsh/compwid.yo	2001/07/25 10:38:26
@@ -673,7 +673,7 @@
 format completion lists and to make explanatory string be shown in
 completion lists (since empty matches can be given display strings
 with the tt(-d) option).  And because all but one empty string would
-otherwise be removed, this option implies the tt(-V) and tt(-1)
+otherwise be removed, this option implies the tt(-V) and tt(-2)
 options (even if an explicit tt(-J) option is given).
 )
 xitem(tt(-))
Index: Src/Zle/compcore.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compcore.c,v
retrieving revision 1.47
diff -u -r1.47 compcore.c
--- Src/Zle/compcore.c	2001/07/25 08:52:34	1.47
+++ Src/Zle/compcore.c	2001/07/25 10:38:27
@@ -1637,7 +1637,7 @@
 	return 1;
     }
     if (dat->dummies)
-        dat->aflags = dat->aflags | CAF_NOSORT | CAF_UNIQALL;
+        dat->aflags = (dat->aflags | CAF_NOSORT | CAF_UNIQCON) & ~CAF_UNIQALL;
     for (bp = brbeg; bp; bp = bp->next)
 	bp->curpos = ((dat->aflags & CAF_QUOTE) ? bp->pos : bp->qpos);
     for (bp = brend; bp; bp = bp->next)
Index: Src/Zle/computil.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/computil.c,v
retrieving revision 1.67
diff -u -r1.67 computil.c
--- Src/Zle/computil.c	2001/07/25 08:52:34	1.67
+++ Src/Zle/computil.c	2001/07/25 10:38:47
@@ -208,6 +208,8 @@
             for (str = set->strs; str; str = str->next) {
                 if (str->kind != 1) {
                     if (!str->kind && str->desc) {
+                        if (str->len > wids[0])
+                            wids[0] = str->len;
                         str->other = NULL;
                         *strp++ = str;
                     }
@@ -536,7 +538,7 @@
                 if (dp[0][0] == '-' && dp[0][1] == 'J')
                     break;
             if (*dp) {
-                char *s = tricat("-1V", "", dp[0] + 2);
+                char *s = tricat("-2V", "", dp[0] + 2);
 
                 zsfree(*dp);
                 *dp = s;
@@ -545,7 +547,7 @@
                         (arrlen(opts + 1) + 1) * sizeof(char *));
                 
             } else
-                opts[0] = ztrdup("-1V-default-");
+                opts[0] = ztrdup("-2V-default-");
             csl = "packed rows";
             break;
 

-- 
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

