From zsh-users-return-8433-mason-zsh=primenet.com.au@sunsite.dk Thu Jan 27 11:58:13 2005
Return-Path: <zsh-users-return-8433-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18129 invoked from network); 27 Jan 2005 11:58:11 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 27 Jan 2005 11:58:11 -0000
Received: (qmail 51211 invoked from network); 27 Jan 2005 11:58:01 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 27 Jan 2005 11:58:01 -0000
Received: (qmail 17706 invoked by alias); 27 Jan 2005 11:57:44 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8433
Received: (qmail 17693 invoked from network); 27 Jan 2005 11:57:44 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 27 Jan 2005 11:57:44 -0000
Received: (qmail 50061 invoked from network); 27 Jan 2005 11:57:44 -0000
Received: from mailhost1.csr.com (HELO MAILSWEEPER01.csr.com) (81.105.217.43)
  by a.mx.sunsite.dk with SMTP; 27 Jan 2005 11:57:39 -0000
Received: from exchange03.csr.com (unverified [10.100.137.60]) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.12) with ESMTP id <T6ec0701fda0a6c8d01694@MAILSWEEPER01.csr.com> for <zsh-users@sunsite.dk>;
 Thu, 27 Jan 2005 11:56:16 +0000
Received: from news01.csr.com ([10.103.143.38]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Thu, 27 Jan 2005 11:57:25 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.1/8.12.11) with ESMTP id j0RBvbeD017174
	for <zsh-users@sunsite.dk>; Thu, 27 Jan 2005 11:57:37 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.1/8.13.1/Submit) with ESMTP id j0RBvb8S017171
	for <zsh-users@sunsite.dk>; Thu, 27 Jan 2005 11:57:37 GMT
Message-Id: <200501271157.j0RBvb8S017171@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-users@sunsite.dk
Subject: Re: 4.2.3 
In-reply-to: <200501271044.j0RAib7l024315@news01.csr.com> 
References: <41F8B7A8.6020206@it.to-be.co.jp> <200501271044.j0RAib7l024315@news01.csr.com>
Date: Thu, 27 Jan 2005 11:57:37 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 27 Jan 2005 11:57:25.0807 (UTC) FILETIME=[5E2CE3F0:01C50467]
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.4

Peter Stephenson wrote:
> djh wrote:
> > I just downloaded zsh-4.2.3 and tried to build it on a new version of 
> > cygwin, but the
> > configure script dies somewhere after printing  a message like,  "Now 
> > checking FIFO"..
> > 
> > Does anyone know of a fix for this yet?
> 
> Meanwhile, if FIFOs are the problem it should be
> possible to doctor the script to tell them they don't work under
                                        ^^^^ it, as we say in English
> Cygwin.

Yes, this works... I upgraded a sacrificial laptop.  FIFOs never worked
anyway and every test that should pass does.  If stout-heartedness
prevails, we may produce a 4.2.4 with this fix and the fix for the
-nt/-ot test problem.

If you apply this to 4.2.3, you'll need autoconf 2.5x.  Otherwise you
can cheat by doctoring configure by hand...

After the lines at around 14722:

echo "$as_me:$LINENO: checking if named FIFOs work" >&5
echo $ECHO_N "checking if named FIFOs work... $ECHO_C" >&6
if test "${zsh_cv_sys_fifo+set}" = set; then
  echo $ECHO_N "(cached) $ECHO_C" >&6
else

insert:

  if test "$host_os" = cygwin; then
zsh_cv_sys_fifo=no
else

and insert an extra

fi

(there should already be two) before the lines at the end of the same block:

echo "$as_me:$LINENO: result: $zsh_cv_sys_fifo" >&5
echo "${ECHO_T}$zsh_cv_sys_fifo" >&6


Index: configure.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.ac,v
retrieving revision 1.23
diff -u -r1.23 configure.ac
--- configure.ac	19 Jan 2005 13:03:36 -0000	1.23
+++ configure.ac	27 Jan 2005 11:48:56 -0000
@@ -1635,7 +1635,10 @@
 dnl -----------
 AC_CACHE_CHECK(if named FIFOs work,
 zsh_cv_sys_fifo,
-[AC_TRY_RUN([
+[if test "$host_os" = cygwin; then
+zsh_cv_sys_fifo=no
+else
+AC_TRY_RUN([
 #include <fcntl.h>
 #include <signal.h>
 main()
@@ -1665,7 +1668,8 @@
 ],
   zsh_cv_sys_fifo=yes,
   zsh_cv_sys_fifo=no,
-  zsh_cv_sys_fifo=yes)])
+  zsh_cv_sys_fifo=yes)
+fi])
 AH_TEMPLATE([HAVE_FIFOS],
 [Define to 1 if system has working FIFOs.])
 if test $zsh_cv_sys_fifo = yes; then

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

This footnote also confirms that this email message has been swept by
MIMEsweeper for the presence of computer viruses.

www.mimesweeper.com
**********************************************************************

