From zsh-users-return-4204-mason-zsh=primenet.com.au@sunsite.dk Sat Sep 08 05:50:54 2001
Return-Path: <zsh-users-return-4204-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5910 invoked from network); 8 Sep 2001 05:50:53 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 8 Sep 2001 05:50:53 -0000
Received: (qmail 15222 invoked by alias); 8 Sep 2001 05:50:35 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4204
Received: (qmail 15209 invoked from network); 8 Sep 2001 05:50:32 -0000
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <1010908055006.ZM18450@candle.brasslantern.com>
Date: Sat, 8 Sep 2001 05:50:06 +0000
In-Reply-To: <20010907180418.A13819@astaroth.sweth.net>
Comments: In reply to Sweth Chandramouli <svc@sweth.net>
        "zsh dumping core because I don't grok TRAPEXIT" (Sep  7,  6:04pm)
References: <20010907180418.A13819@astaroth.sweth.net>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Sweth Chandramouli <svc@sweth.net>, ZSH Users <zsh-users@sunsite.dk>
Subject: Re: zsh dumping core because I don't grok TRAPEXIT
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Sep 7,  6:04pm, Sweth Chandramouli wrote:
}
} (astaroth)/tmp/zsh_is_wonky: echo $ZSH_VERSION
} 3.1.9
} 
} 	; I know that 4.0.2 is out now, but I just haven't had a
} chance to install it yet.

You need to install 4.0.2, or at least 3.1.9-dev-2+, because there were
several bug fixes in memory management of the exit trap handler shortly
after the 3.1.9 release.  This is almost certainly what is causing your
core dump.

} I'd still like to know how TRAPEXIT is really supposed to work

I'd like to know why mutt is exiting with 23.  It doesn't when I try it.

Anyway, TRAPEXIT is supposed to work pretty much like you thought it was.
It's the only trap-function that -always- behaves as if LOCAL_TRAPS is
set (which is how it got memory-management problems in the first place).
That is, the exit trap applies to all functions and subshells called
from the function that defines it, but it becomes undefined after it
is called when the defining function exits.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

