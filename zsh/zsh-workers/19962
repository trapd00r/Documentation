From zsh-workers-return-19962-mason-zsh=primenet.com.au@sunsite.dk Wed May 19 16:59:29 2004
Return-Path: <zsh-workers-return-19962-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11272 invoked from network); 19 May 2004 16:59:28 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.86)
  by ns1.primenet.com.au with SMTP; 19 May 2004 16:59:28 -0000
Received: (qmail 31098 invoked from network); 19 May 2004 16:59:08 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 19 May 2004 16:59:08 -0000
Received: (qmail 6213 invoked by alias); 19 May 2004 16:59:06 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19962
Received: (qmail 6188 invoked from network); 19 May 2004 16:59:06 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (qmailr@130.225.247.86)
  by sunsite.dk with SMTP; 19 May 2004 16:59:03 -0000
Received: (qmail 30264 invoked from network); 19 May 2004 16:58:33 -0000
Received: from dsl3-63-249-88-2.cruzio.com (HELO binome.blorf.net) (63.249.88.2)
  by a.mx.sunsite.dk with SMTP; 19 May 2004 16:58:32 -0000
Received: by binome.blorf.net (Postfix, from userid 1000)
	id 265116BDE; Wed, 19 May 2004 09:58:31 -0700 (PDT)
Date: Wed, 19 May 2004 09:58:31 -0700
From: Wayne Davison <wayned@users.sourceforge.net>
To: Peter Stephenson <pws@csr.com>
Cc: zsh-workers@sunsite.dk
Subject: Re: [PATCH] local history support, take 2
Message-ID: <20040519165831.GA21704@blorf.net>
References: <20040518195047.GA2578@blorf.net> <20778.1084959625@csr.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20778.1084959625@csr.com>
User-Agent: Mutt/1.5.5.1+cvs20040105i
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_44 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0

On Wed, May 19, 2004 at 10:40:25AM +0100, Peter Stephenson wrote:
> I might get a moment to look at this bit if you don't.

Feel free.  I had one idea on how to implement this:

The pushhiststack() function how returns the value of histsave_stack_pos
(i.e. the 1-relative spot where we stored the item).  This could be put
into a local variable named HISTPOP when `fc -p` was called for the
first time in a function.  Then, when HISTPOP got deleted, zsh would
call a new routine that would pop the list down through that value
(saving each history file on the way).

There may well be better ways to implement this than that, though (i.e.
not using the environment).

> I suspect you mean
> 
>     history -p [HISTFILE [HISTSIZE [SAVEHIST]]]

Yes, I certainly did.

When I went to document the new options, I noted that the entire
description of the "history" command is that it is the same as `fc -l'.
Because of this, I decided to switch the -p/-P options over to fc.

> I get an error if the HISTFILE on the command line doesn't exist.

Thanks -- fixed.

> Probably there should be an error if there are too many arguments

Yes, I had planned to do that, and it is now done.

You can fetch the latest patch from here:

    http://www.blorf.net/localhistory.patch

Shall I go ahead and check this in?  Or do we want to consider this a
bit more?  For instance, if you want to suggest a more pushd/popd style
command set for interactive use, let me know.

..wayne..

