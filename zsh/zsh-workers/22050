From zsh-workers-return-22050-mason-zsh=primenet.com.au@sunsite.dk Mon Dec 05 14:20:06 2005
Return-Path: <zsh-workers-return-22050-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25697 invoked from network); 5 Dec 2005 14:20:00 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 Dec 2005 14:20:00 -0000
Received: (qmail 30145 invoked from network); 5 Dec 2005 14:19:53 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 Dec 2005 14:19:53 -0000
Received: (qmail 1144 invoked by alias); 5 Dec 2005 14:19:51 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22050
Received: (qmail 1135 invoked from network); 5 Dec 2005 14:19:50 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 5 Dec 2005 14:19:50 -0000
Received: (qmail 29834 invoked from network); 5 Dec 2005 14:19:50 -0000
Received: from cluster-e.mailcontrol.com (HELO rly18e.srv.mailcontrol.com) (217.79.216.190)
  by a.mx.sunsite.dk with SMTP; 5 Dec 2005 14:19:47 -0000
Received: from porgy.logica.co.uk (porgy.logica.co.uk [158.234.250.67])
	by rly18e.srv.mailcontrol.com (MailControl) with ESMTP id jB5EJiOe008363
	for <zsh-workers@sunsite.dk>; Mon, 5 Dec 2005 14:19:44 GMT
Received: from localhost.localdomain ([158.234.142.59])
	by porgy.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id jB5EJiOF023834
	for <zsh-workers@sunsite.dk>; Mon, 5 Dec 2005 14:19:44 GMT
Received: from trentino (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (Postfix) with ESMTP id 23FF73B7F2
	for <zsh-workers@sunsite.dk>; Mon,  5 Dec 2005 15:21:18 +0100 (CET)
From: Oliver Kiddle <okiddle@yahoo.co.uk>
To: Zsh workers <zsh-workers@sunsite.dk>
Subject: PATCH: fixes for Debian kfreebsd
Date: Mon, 05 Dec 2005 15:21:17 +0100
Message-ID: <13861.1133792477@trentino>
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A-05-40-01 (www.mailcontrol.com) on 10.69.0.128

Following patch fixes issues on Debian GNU/kfreebsd.

Oliver

Index: configure.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.ac,v
retrieving revision 1.44
diff -u -r1.44 configure.ac
--- configure.ac	30 Nov 2005 08:34:55 -0000	1.44
+++ configure.ac	5 Dec 2005 14:16:51 -0000
@@ -2261,7 +2261,7 @@
     esac
   fi
   case "$host_os" in
-    freebsd*|linux*|irix*|osf*|gnu*|dragonfly*) DLLDFLAGS="${DLLDFLAGS=-shared}" ;;
+    *freebsd*|linux*|irix*|osf*|gnu*|dragonfly*) DLLDFLAGS="${DLLDFLAGS=-shared}" ;;
     sunos*)       DLLDFLAGS="${DLLDFLAGS=-assert nodefinitions}" ;;
     sysv4*|esix*) DLLDFLAGS="${DLLDFLAGS=-G $ldflags}" ;;
     netbsd*)      DLLDFLAGS="${DLLDFLAGS=${DLLDARG}-x -shared --whole-archive}" ;;
@@ -2285,7 +2285,7 @@
   esac
   case "$host" in
     *-hpux*)  EXTRA_LDFLAGS="${EXTRA_LDFLAGS=-Wl,-E}" ;;
-    *-freebsd[3-9]*|*-linux*|gnu*) EXTRA_LDFLAGS="${EXTRA_LDFLAGS=-rdynamic}" ;;
+    *-freebsd[3-9]*|*-kfreebsd*|*-linux*|gnu*) EXTRA_LDFLAGS="${EXTRA_LDFLAGS=-rdynamic}" ;;
     *openbsd*)
        if test $zsh_cv_sys_elf = yes; then
 	 EXTRA_LDFLAGS="${EXTRA_LDFLAGS=-Wl,-E}"
Index: Completion/Unix/Command/_mount
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_mount,v
retrieving revision 1.22
diff -u -r1.22 _mount
--- Completion/Unix/Command/_mount	8 Jun 2005 12:45:35 -0000	1.22
+++ Completion/Unix/Command/_mount	5 Dec 2005 14:16:51 -0000
@@ -475,7 +475,7 @@
       'swidth[specify stripe width]:size'
     )
     ;;
-  freebsd*|dragonfly*)
+  *freebsd*|dragonfly*)
     _fs_any=(
       '(sync)async[do all I/O asynchronously]'
       'current[use current options on already mounted file system]'
@@ -630,7 +630,7 @@
     deffs=hsfs
     typeops=-F
     ;;
-  freebsd*|dragonfly*)
+  *freebsd*|dragonfly*)
     args=( -s
       '(:)-a[mount all filesystems in fstab]'
       '-d[cause everything to be done except for the actual system call]'      
@@ -704,7 +704,7 @@
 	'*:dev or dir:->udevordir'
       )
     ;;
-    freebsd*|dragonfly*)
+    *freebsd*|dragonfly*)
       args=(
 	'(*)-a[unmount all mounted file systems]'
 	'-A[unmount all mounted file systems except the root]'
@@ -766,7 +766,7 @@
   fi
 
   case "$OSTYPE" in
-  freebsd*|dragonfly*)
+  *freebsd*|dragonfly*)
     while read mline; do 
       case $mline[(w)1] in
 	\#* )
Index: Completion/Unix/Command/_sysctl
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_sysctl,v
retrieving revision 1.6
diff -u -r1.6 _sysctl
--- Completion/Unix/Command/_sysctl	11 May 2005 09:27:10 -0000	1.6
+++ Completion/Unix/Command/_sysctl	5 Dec 2005 14:16:51 -0000
@@ -1,7 +1,7 @@
 #compdef sysctl
 
 case $OSTYPE in
-  freebsd[5-9].*|freebsd4.[4-9]*)
+  *freebsd[5-9].*|freebsd4.[4-9]*)
     local -a sysctlvars
     sysctlvars=( $(sysctl -aN) )
     _arguments -s -A "-*" \
Index: Completion/Unix/Type/_locales
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Type/_locales,v
retrieving revision 1.4
diff -u -r1.4 _locales
--- Completion/Unix/Type/_locales	8 Jun 2005 12:45:36 -0000	1.4
+++ Completion/Unix/Type/_locales	5 Dec 2005 14:16:51 -0000
@@ -4,7 +4,7 @@
 
 if (( $+commands[locale] )); then
   locales=( $(_call_program locales locale -a) )
-  [[ $OSTYPE = linux-gnu ]] && locales=( ${locales/utf8/UTF-8} )
+  [[ $OSTYPE = *-gnu ]] && locales=( ${locales/utf8/UTF-8} )
 else
   locales=( /usr/lib/locale/*(:t) )
 fi


This e-mail and any attachment is for authorised use by the intended recipient(s) only. It may contain proprietary material, confidential information and/or be subject to legal privilege. It should not be copied, disclosed to, retained or used by, any other party. If you are not an intended recipient then please promptly delete this e-mail and any attachment and all copies and inform the sender. Thank you.

