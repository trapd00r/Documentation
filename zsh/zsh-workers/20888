From zsh-workers-return-20888-mason-zsh=primenet.com.au@sunsite.dk Mon Feb 28 14:25:16 2005
Return-Path: <zsh-workers-return-20888-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14968 invoked from network); 28 Feb 2005 14:25:15 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 28 Feb 2005 14:25:15 -0000
Received: (qmail 31158 invoked from network); 28 Feb 2005 14:25:09 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Feb 2005 14:25:09 -0000
Received: (qmail 11702 invoked by alias); 28 Feb 2005 14:25:06 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20888
Received: (qmail 11689 invoked from network); 28 Feb 2005 14:25:05 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 28 Feb 2005 14:25:05 -0000
Received: (qmail 30866 invoked from network); 28 Feb 2005 14:25:05 -0000
Received: from mailhost1.csr.com (HELO MAILSWEEPER01.csr.com) (81.105.217.43)
  by a.mx.sunsite.dk with SMTP; 28 Feb 2005 14:25:01 -0000
Received: from exchange03.csr.com (unverified [10.100.137.60]) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.12) with ESMTP id <T6f65c26f630a6c8d018f0@MAILSWEEPER01.csr.com> for <zsh-workers@sunsite.dk>;
 Mon, 28 Feb 2005 14:23:31 +0000
Received: from news01.csr.com ([10.103.143.38]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Mon, 28 Feb 2005 14:26:09 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.1/8.12.11) with ESMTP id j1SEP0GF012508
	for <zsh-workers@sunsite.dk>; Mon, 28 Feb 2005 14:25:00 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.1/8.13.1/Submit) with ESMTP id j1SEOx2P012505
	for <zsh-workers@sunsite.dk>; Mon, 28 Feb 2005 14:24:59 GMT
Message-Id: <200502281424.j1SEOx2P012505@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-workers@sunsite.dk
Subject: Re: SIGTTOU old problem 
In-reply-to: <200502281413.j1SEDSP1011969@news01.csr.com> 
References: <20050228134145.9063.qmail@flock1.newmail.ru> <200502281413.j1SEDSP1011969@news01.csr.com>
Date: Mon, 28 Feb 2005 14:24:59 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 28 Feb 2005 14:26:09.0237 (UTC) FILETIME=[722C4050:01C51DA1]
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.5

Peter Stephenson wrote:
> By the way, this will fail if sh happens to be zsh since we don't strip
> the SIG from the signal name, which appears to be optional in other
> shells.  (ksh and bash differ in whether the output shows the SIG or not.)

This is easy to fix.

Index: Doc/Zsh/builtins.yo
===================================================================
RCS file: /cvsroot/zsh/zsh/Doc/Zsh/builtins.yo,v
retrieving revision 1.74
diff -u -r1.74 builtins.yo
--- Doc/Zsh/builtins.yo	19 Jan 2005 13:04:09 -0000	1.74
+++ Doc/Zsh/builtins.yo	28 Feb 2005 14:21:20 -0000
@@ -1157,8 +1157,9 @@
 item(tt(trap) [ var(arg) [ var(sig) ... ] ])(
 var(arg) is a series of commands (usually quoted to protect it from
 immediate evaluation by the shell) to be read and executed when the shell
-receives var(sig).  Each var(sig) can be given as a number
-or as the name of a signal.
+receives var(sig).  Each var(sig) can be given as a number,
+or as the name of a signal either with or without the string tt(SIG)
+in front.
 If var(arg) is `tt(-)', then all traps var(sig) are reset to their
 default values.  If var(arg) is the empty string, then this signal
 is ignored by the shell and by the commands it invokes.
Index: Src/jobs.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/jobs.c,v
retrieving revision 1.37
diff -u -r1.37 jobs.c
--- Src/jobs.c	14 Jan 2005 13:05:21 -0000	1.37
+++ Src/jobs.c	28 Feb 2005 14:21:20 -0000
@@ -1874,6 +1874,8 @@
 		    while (*++argv) {
 			sig = zstrtol(*argv, &signame, 10);
 			if (signame == *argv) {
+			    if (!strncmp(signame, "SIG", 3))
+				signame += 3;
 			    for (sig = 1; sig <= SIGCOUNT; sig++)
 				if (!cstrpcmp(sigs + sig, &signame))
 				    break;
@@ -1942,7 +1944,8 @@
 		} else
 		    signame = *argv;
 		makeuppercase(&signame);
-		if (!strncmp(signame, "SIG", 3)) signame+=3;
+		if (!strncmp(signame, "SIG", 3))
+		    signame+=3;
 
 		/* check for signal matching specified name */
 		for (sig = 1; sig <= SIGCOUNT; sig++)
@@ -2032,6 +2035,9 @@
 	return x;
 
     /* search for signal by name */
+    if (!strncmp(s, "SIG", 3))
+	s += 3;
+
     for (i = 0; i < VSIGCOUNT; i++)
 	if (!strcmp(s, sigs[i]))
 	    return i;

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

**********************************************************************

