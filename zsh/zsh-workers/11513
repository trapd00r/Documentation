From zsh-workers-return-11513-mason-zsh=primenet.com.au@sunsite.auc.dk Mon May 22 16:53:19 2000
Return-Path: <zsh-workers-return-11513-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4627 invoked from network); 22 May 2000 16:53:14 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 22 May 2000 16:53:14 -0000
Received: (qmail 20278 invoked by alias); 22 May 2000 16:53:05 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11513
Received: (qmail 20270 invoked from network); 22 May 2000 16:53:03 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000522165258.ZM29917@candle.brasslantern.com>
Date: Mon, 22 May 2000 16:52:57 +0000
In-Reply-To: <200005221444.QAA20403@beta.informatik.hu-berlin.de>
Comments: In reply to Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
        "Re: PATCH: Re: TAB and PS2 and multiline buffers and vared" (May 22,  4:44pm)
References: <200005221444.QAA20403@beta.informatik.hu-berlin.de>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: Re: PATCH: Re: TAB and PS2 and multiline buffers and vared
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On May 22,  4:44pm, Sven Wischnowsky wrote:
} Subject: Re: PATCH: Re: TAB and PS2 and multiline buffers and vared
}
} Bart Schaefer wrote:
} 
} > On May 22,  1:25pm, Sven Wischnowsky wrote:
} > } Subject: PATCH: Re: TAB and PS2 and multiline buffers and vared
} > }
} > } Bart Schaefer wrote:
} > } 
} > } > The situation is different in vared (again with a multiline buffer).
} > } > Sometimes it beeps and then asks me whether I want to see all 2200
} > } > possiblities, other times it just beeps and refuses to insert anything.
} > } > Whether it asks or just beeps seems to depend on whether I started out
} > } > on vared of a value containing newlines (e.g. vared functions[foo] vs.
} > } > vared foo).
} > } 
} > } Hm. Is that with the current CVS version?
} > 
} > Yes.  (Well, current at the time I sent the mail.)
} 
} I don't understand why it's completing commands then... Hm.

I've just tried comparing zsh with all patches up to but NOT including
11503, against zsh including 11503, and I see no differences between
those (maybe 11493 had an effect?).  So then I compared zsh including
11503 against zsh patched up to 11471 (e.g. code-wise should be identical
to -pre-4).  The newer zsh does NOT show the behavior above; the older
one does.

Since the newer version doesn't have the bad behavior, the following is
mainly for information, in case a light bulb goes on above Sven when he
sees it.

The test case was to run `vared functions[_complete_debug]', scroll up
to the line `local w="${(qq)words}"', then type ^E ESC RET to open a
line, and begin completing on that line.

If I immediately type ^X?, both versions beep at me.  Comparing the xtrace
output, the ONLY difference shown (other than line numbers) is the value
assigned to the _saved_colors local, which is irrelevant.  Both versions
output the string from _message.

If I start the test again from a fresh PS1, but type TAB and then ^X?,
zsh-11502 produces the same xtrace as before, but zsh-11471 has this
additional fragment:

+_main_complete:41:if: [[ tab automenu-unambiguous == tab* && _complete_debug != *list* ]]
+_main_complete:42:then cursh: zstyle -T :completion::::: insert-tab
+_main_complete:43:then cursh cmdand cursh: [[ ::: != :* || -z functions[_complete_debug] ]]
+_main_complete:44:then cursh cmdand cursh cmdor: zstyle -t :completion:vared:::: insert-tab
+_main_complete:46:then: compstate[insert]=automenu-unambiguous 

In this particular test they also both output the message, so I still
don't know exact steps to reproduce sending it into command completion.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

