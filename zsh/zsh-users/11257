From zsh-users-return-11257-mason-zsh=primenet.com.au@sunsite.dk Fri Mar 09 16:12:39 2007
Return-Path: <zsh-users-return-11257-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20077 invoked from network); 9 Mar 2007 16:12:33 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.8 (2007-02-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO
	autolearn=ham version=3.1.8
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 9 Mar 2007 16:12:33 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 38637 invoked from network); 9 Mar 2007 16:12:28 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 Mar 2007 16:12:28 -0000
Received: (qmail 80 invoked by alias); 9 Mar 2007 16:12:20 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11257
Received: (qmail 69 invoked from network); 9 Mar 2007 16:12:20 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 9 Mar 2007 16:12:20 -0000
Received: (qmail 37516 invoked from network); 9 Mar 2007 16:12:20 -0000
Received: from bes.cs.utk.edu (160.36.56.220)
  by a.mx.sunsite.dk with SMTP; 9 Mar 2007 16:12:14 -0000
Received: from localhost (localhost [127.0.0.1])
	by bes.cs.utk.edu (Postfix) with ESMTP id 9018310308A
	for <zsh-users@sunsite.dk>; Fri,  9 Mar 2007 11:12:13 -0500 (EST)
X-Virus-Scanned: by amavisd-new with ClamAV and SpamAssasin at cs.utk.edu
Received: from bes.cs.utk.edu ([127.0.0.1])
	by localhost (bes.cs.utk.edu [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id dtBK5WmVYd5J for <zsh-users@sunsite.dk>;
	Fri,  9 Mar 2007 11:12:10 -0500 (EST)
Received: from cetus30.cs.utk.edu (cetus30.cs.utk.edu [160.36.56.112])
	by bes.cs.utk.edu (Postfix) with ESMTP id 6173A1030A4
	for <zsh-users@sunsite.dk>; Fri,  9 Mar 2007 11:12:10 -0500 (EST)
Received: by cetus30.cs.utk.edu (Postfix, from userid 10605)
	id AD5D913B6B; Fri,  9 Mar 2007 11:12:09 -0500 (EST)
Date: Fri, 9 Mar 2007 11:12:09 -0500
From: Chris Johnson <cjohnson@cs.utk.edu>
To: zsh-users@sunsite.dk
Subject: cvsvimdiff zshism
Message-ID: <20070309161209.GA30333@cetus30.cs.utk.edu>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.9i

I've just started using cvs to manage some code, and sometimes I want to
compare my working copy of a file to some version in the repository.
cvs diff offers a facility to do this, but I really prefer vim's diff
capabilities.  With vim, you can do side by side comparison of files,
changes are highlighted, and so on.

So, in order to make cvs diff work with vimdiff, I wrote the following
function that exploits zsh's tmp file substitution mechanism.  It's not
very robust, 'cuz I don't know all the ways to break it yet.  But here's
a start:

cvsvimdiff() {
   if [[ $# -ne 2 ]] then
      print Usage: $0 old_version file >& 2
      return 1
   fi

   # $2 is the name of the working copy, $1 the version to compare to.
   # We grab the diff between the working copy and the version using
   # cvs, apply the patch to the working copy and send it to stdout,
   # and then vimdiff the working copy and the patched working copy.

   vimdiff $2 =(patch -R -o /dev/fd/1 $2 =(cvs diff -r $1 $2))
}

-- 
Chris Johnson
cjohnson@cs.utk.edu
http://www.cs.utk.edu/~cjohnson

