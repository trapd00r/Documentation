From zsh-workers-request@math.gatech.edu Mon Oct 05 05:38:27 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27587 invoked from network); 5 Oct 1998 05:38:25 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 5 Oct 1998 05:38:25 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id BAA12556;
	Mon, 5 Oct 1998 01:27:14 -0400 (EDT)
Resent-Date: Mon, 5 Oct 1998 01:27:14 -0400 (EDT)
To: zsh-workers@math.gatech.edu
Subject: Autoremoveslash bug?
User-Agent: SEMI/1.8.7.0 (Isurugi) FLAM-DOODLE/1.10.0
 (=?ISO-2022-JP?B?GyRCNDs7UhsoQg==?= 7.5YR7.0/11.0) Emacs/20.3.90
 (sparc-sun-solaris2.6) MULE/4.0 (HANANOEN)
MIME-Version: 1.0 (generated by SEMI 1.8.7.0 - "Isurugi")
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@jaist.ac.jp>
Date: 05 Oct 1998 14:27:15 +0900
Message-ID: <rsqogrrpoi4.fsf@crane.jaist.ac.jp>
Lines: 47
Resent-Message-ID: <"-xNAQ2.0.743.oY56s"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4406
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Hi. I'm using zsh-3.1.4 on Solaris-2.6.

I found a small bug with automenu.

% zsh -f
crane% cd /tmp
crane% mkdir tst
crane% touch tst/abc
crane% touch tst/abcdef
crane% echo tst

press <TAB>

crane% echo tst/

press <TAB>

crane% echo tst/abc

press <Return>

crane% echo tst/ab 
tst/ab
crane% 

So, zsh deletes a last character.

Following fix works for me.
Is this correct?

------------------------------------------------------------
--- zle_tricky.c.org	Mon Oct  5 06:12:39 1998
+++ zle_tricky.c	Mon Oct  5 08:16:01 1998
@@ -3269,7 +3269,10 @@
 	if(ae && !atend)
 	    inststrlen(firstm + strlen(firstm) - ae, 0, ae);
 	if(ab || (ae && !atend))
+	{
+	    makesuffix(menuinsc = 0);
 	    inv = 1;
+	}
 	/* If the LIST_AMBIGUOUS option (meaning roughly `show a list only *
 	 * if the completion is completely ambiguous') is set, and some    *
 	 * prefix was inserted, return now, bypassing the list-displaying  *
------------------------------------------------------------
-- 
[Tanaka Akira]

