From zsh-workers-return-12710-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Aug 28 07:03:49 2000
Return-Path: <zsh-workers-return-12710-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11644 invoked from network); 28 Aug 2000 07:03:47 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 28 Aug 2000 07:03:47 -0000
Received: (qmail 27445 invoked by alias); 28 Aug 2000 07:03:16 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12710
Received: (qmail 27437 invoked from network); 28 Aug 2000 07:03:15 -0000
Date: Mon, 28 Aug 2000 09:03:12 +0200 (MET DST)
Message-Id: <200008280703.JAA15291@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Bart Schaefer"'s message of Sun, 27 Aug 2000 16:50:52 +0000
Subject: PATCH: Re: Syntax error on "function ..." causes crash


Bart Schaefer wrote:

> zagzig% function
> function> :
> 
> Program received signal SIGSEGV, Segmentation fault.

This makes it be silent, as in 3.0.8.

Bye
 Sven

Index: Src/exec.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/exec.c,v
retrieving revision 1.17
diff -u -r1.17 exec.c
--- Src/exec.c	2000/08/08 14:57:03	1.17
+++ Src/exec.c	2000/08/28 07:02:34
@@ -3070,7 +3070,10 @@
     LinkList names;
 
     end = beg + WC_FUNCDEF_SKIP(state->pc[-1]);
-    names = ecgetlist(state, *state->pc++, EC_DUPTOK, &htok);
+    if (!(names = ecgetlist(state, *state->pc++, EC_DUPTOK, &htok))) {
+	state->pc = end;
+	return 0;
+    }
     nprg = end - beg;
     sbeg = *state->pc++;
     nstrs = *state->pc++;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

