From zsh-workers-return-16775-mason-zsh=primenet.com.au@sunsite.dk Thu Mar 07 08:32:57 2002
Return-Path: <zsh-workers-return-16775-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9185 invoked from network); 7 Mar 2002 08:32:56 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 7 Mar 2002 08:32:56 -0000
Received: (qmail 29125 invoked by alias); 7 Mar 2002 08:32:51 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16775
Received: (qmail 29113 invoked from network); 7 Mar 2002 08:32:50 -0000
From: Sven Wischnowsky <wischnow@berkom.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <15495.9545.670843.165481@wischnow.berkom.de>
Date: Thu, 7 Mar 2002 09:31:05 +0100
To: zsh-workers@sunsite.dk
Subject: Re: PATCH: _history_complete_word
In-Reply-To: <20020306145637.A21394@corelli.new.ox.ac.uk>
References: <200003310814.KAA06936@beta.informatik.hu-berlin.de>
	<20000426204917.A13452@thelonious.new.ox.ac.uk>
	<20020306145637.A21394@corelli.new.ox.ac.uk>
X-Mailer: VM 6.95 under 21.5 (patch 3) "asparagus" XEmacs Lucid


Adam Spiers wrote:

> Bringing more dead topics back to life ...
> 
> Adam Spiers (adam@spiers.net) wrote:
> > Just noticed another new quirk with h-c-w now.  I have:
> > 
> >   zstyle ':completion:*:descriptions' format '%B---- %d%b'
> >   zstyle ':completion:*:history-words' stop verbose
> >   zstyle ':completion:*:history-words' remove_all_dups yep
> >                                                         
> > The first time I press M-/ the message `---- history word' appears,
> > which means that I have to press it twice to get the first match,
> > which shouldn't really happen unless the `list' style is turned on.
> > How can this be fixed?
> 
> This tiny nit has grown into an itch big enough I need to scratch it.
> These days I also have 
> 
>     zstyle ':completion:*:history-words' list false
> 
> set, so I don't even get the message appearing.  This gives the
> impression of the first keystroke just being swallowed.  This is
> presumably because the
> 
>   [[ $LASTWIDGET = _history-complete-* &&
>      ( -n "$compstate[old_list]" || -n $_hist_stop ) ]]
> 
> condition returns false, so on the first stroke, the matches are
> generated but nothing else happens.  I'm not sure what the best
> solution is.

Please see the last discussion about this, which ended with the
patches in users/3752 and workers/13815.  First, stop has been made a
boolean style, so you want:

       zstyle ':completion:*:history-words' stop yes

Second, h-c-w now behaves normally w.r.t. menu-completion, so you have
to set the menu style if you want menu-completion-only behaviour:

       zstyle ':completion:*:history-words' menu yes

Good?


Bye
  Sven

P.S.: Including the message number of the old article would have
      helped me.

-- 
Sven Wischnowsky                          wischnow@berkom.de

