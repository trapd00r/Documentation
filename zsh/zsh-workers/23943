From zsh-workers-return-23943-mason-zsh=primenet.com.au@sunsite.dk Fri Oct 12 09:09:59 2007
Return-Path: <zsh-workers-return-23943-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1343 invoked from network); 12 Oct 2007 09:09:51 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 12 Oct 2007 09:09:51 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 48020 invoked from network); 12 Oct 2007 09:09:45 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 12 Oct 2007 09:09:45 -0000
Received: (qmail 10087 invoked by alias); 12 Oct 2007 09:09:42 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23943
Received: (qmail 10070 invoked from network); 12 Oct 2007 09:09:42 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 12 Oct 2007 09:09:42 -0000
Received: (qmail 47688 invoked from network); 12 Oct 2007 09:09:42 -0000
Received: from cluster-g.mailcontrol.com (85.115.41.190)
  by a.mx.sunsite.dk with SMTP; 12 Oct 2007 09:09:35 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly03g.srv.mailcontrol.com (MailControl) with ESMTP id l9C99HNs024115
	for <zsh-workers@sunsite.dk>; Fri, 12 Oct 2007 10:09:30 +0100
Received: from news01 ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Fri, 12 Oct 2007 10:09:25 +0100
Date: Fri, 12 Oct 2007 10:09:25 +0100
From: Peter Stephenson <pws@csr.com>
To: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: ZSH (CVS) configure problem?
Message-ID: <20071012100925.09dbc4f5@news01>
In-Reply-To: <20071011202308.GA22150@scowler.net>
References: <20071011182853.GA19842@scowler.net>
	<200710111918.l9BJI33N021057@pws-pc.ntlworld.com>
	<20071011202308.GA22150@scowler.net>
Organization: CSR
X-Mailer: Claws Mail 3.0.0 (GTK+ 2.10.14; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 12 Oct 2007 09:09:25.0567 (UTC) FILETIME=[960354F0:01C80CAF]
X-Scanned-By: MailControl A-07-08-10 (www.mailcontrol.com) on 10.71.0.113

On Thu, 11 Oct 2007 16:23:08 -0400
Clint Adams <schizo@debian.org> wrote:
> > Shall we try this?  I'd be interested to see how it works out.
> > If we end up not compiling in multibyte support, should be replacing
> > ncursesw with ncurses, or is that unnecessary?
> 
> Given my current understanding, if both ncurses{,w} -dev packages
> installed, this will link against the wide library but use the non-wide
> macros.  I assume this is harmless and equivalent to just linking
> against the non-wide library.

Maybe I'll commit the following.

Index: INSTALL
===================================================================
RCS file: /cvsroot/zsh/zsh/INSTALL,v
retrieving revision 1.31
diff -u -r1.31 INSTALL
--- INSTALL	2 Oct 2007 10:22:26 -0000	1.31
+++ INSTALL	12 Oct 2007 09:08:42 -0000
@@ -312,12 +312,21 @@
 termcap, which is now largely outmoded, and curses, which supersedes
 termcap and typically contains the same features as well as others.
 configure will search for an appropriate library; the default search order
-is "tinfo termcap ncurses curses" except on HP-UX and Solaris where it is
-"Hcurses ncurses curses termcap".  Note that even though termcap is usually
-searched first zsh tries to make features from curses available and if the
-curses library contains both curses and termcap features, as is normal,
-the curses variant is used.  ncurses is a newer version of curses
-and tinfo is related to it.
+is "ncursesw tinfo termcap ncurses curses" except on HP-UX and Solaris
+where it is "Hcurses ncursesw ncurses curses termcap".  Note that even
+though termcap is searched before traditional forms of curses zsh tries to
+make features from curses available and if the curses library contains both
+curses and termcap features, as is normal, the curses variant is used.
+ncurses is a newer version of curses and tinfo is related to it.
+
+The library ncursesw is a variant of ncurses that supports wide characters.
+zsh attempts to use this to provide functions needed by the zsh/curses
+module; the main shell does not require the additional functions.  As the
+integration of wide character support into ncurses is continuing, it is
+possible that on some systems attempting to use ncursesw may cause problems
+during building.  If so, please report this to the developers at
+zsh-workers@sunsite.dk and attempt to recompile with --with-term-lib="tinfo
+termcap ncurses curses" (see below).
 
 On some systems a suitable development package with a name such as
 curses-devel or ncurses-devel needs to be installed before zsh can
@@ -328,7 +337,7 @@
 You can tell configure which libraries to search by passing an
 argument via --with-term-lib.  This takes a space-separated list
 of libraries to try as its argument, so the default is equivalent to
---with-term-lib="tinfo termcap ncurses curses".  It replaces the
+--with-term-lib="ncursesw tinfo termcap ncurses curses".  It replaces the
 old option --with-curses-terminfo, which altered the search order but
 didn't allow an explicit search list to be passed.
 
Index: configure.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.ac,v
retrieving revision 1.70
diff -u -r1.70 configure.ac
--- configure.ac	8 Oct 2007 02:04:01 -0000	1.70
+++ configure.ac	12 Oct 2007 09:08:44 -0000
@@ -648,12 +648,12 @@
   termcap_curses_order="$withval"
   AC_SEARCH_LIBS(tigetstr, [$termcap_curses_order])
 else
-  termcap_curses_order="tinfo termcap ncurses curses"
+  termcap_curses_order="ncursesw tinfo termcap ncurses curses"
 fi],
 [case "$host_os" in
   hpux10.*|hpux11.*|solaris*)
-      termcap_curses_order="Hcurses ncurses curses termcap" ;;
-  *)             termcap_curses_order="tinfo termcap ncurses curses" ;;
+      termcap_curses_order="Hcurses ncursesw ncurses curses termcap" ;;
+  *)             termcap_curses_order="ncursesw tinfo termcap ncurses curses" ;;
 esac])dnl
 
 AH_TEMPLATE([HAVE_BOOLCODES],

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

