From zsh-workers-return-22274-mason-zsh=primenet.com.au@sunsite.dk Thu Feb 16 19:36:21 2006
Return-Path: <zsh-workers-return-22274-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19911 invoked from network); 16 Feb 2006 19:36:12 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Feb 2006 19:36:12 -0000
Received: (qmail 94156 invoked from network); 16 Feb 2006 19:35:55 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Feb 2006 19:35:55 -0000
Received: (qmail 26228 invoked by alias); 16 Feb 2006 19:35:52 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22274
Received: (qmail 26219 invoked from network); 16 Feb 2006 19:35:51 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 16 Feb 2006 19:35:51 -0000
Received: (qmail 93840 invoked from network); 16 Feb 2006 19:35:51 -0000
Received: from cluster-d.mailcontrol.com (217.69.20.190)
  by a.mx.sunsite.dk with SMTP; 16 Feb 2006 19:35:50 -0000
Received: from exchange03.csr.com (uuk202166.uk.customer.alter.net [62.189.241.194] (may be forged))
	by rly27d.srv.mailcontrol.com (MailControl) with ESMTP id k1GJYI2a012206
	for <zsh-workers@sunsite.dk>; Thu, 16 Feb 2006 19:35:43 GMT
Received: from csr.com ([10.103.143.38]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Thu, 16 Feb 2006 19:35:32 +0000
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: Re: Changes for dev-4 
In-reply-to: <20060216190317.GC1320@dot.blorf.net> 
References: <EXCHANGE032tgQSYwpb0000e051@exchange03.csr.com> <20060216190317.GC1320@dot.blorf.net>
Date: Thu, 16 Feb 2006 19:35:26 +0000
From: Peter Stephenson <pws@csr.com>
Message-ID: <EXCHANGE03FXfyY0QUU0000e4ba@exchange03.csr.com>
X-OriginalArrivalTime: 16 Feb 2006 19:35:32.0458 (UTC) FILETIME=[2688BCA0:01C63330]
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A-06-00-02 (www.mailcontrol.com) on 10.68.0.137

Wayne Davison wrote:
> Actually, I didn't change = because I was thinking that it would just
> turn into a scalar anyway.  However, since the assignment might be to an
> array, it could also benefit from the new array-split-preservation code.
> 
> Attached is a patch that fixes this.  Let me know if you agree that this
> is something that should make it into 4.3.1.  (I'll check-in the first
> tweak to the README file, since it fixes a typo.)

I certainly missed the fact that it doesn't fix a compatibility problem
since you can't assign to an array in the other shells that way.
Ideally we probably want it to be whatever would happen in bash or ksh,
seeing as sh doesn't have arrays, though by the looks of things it's the
same.

In ksh I get:
$ set -A foo
$ set "one word" "two words"
$ : ${foo:="$@"}
$ echo ${foo[0]}
one word two words

and in zsh I get:
% setopt shwordsplit
% set -A foo
% set "one word" "two words"
% : ${foo:="$@"}
% print ${(t)foo}
scalar

So it looks like from the compatibility point of view we're OK either
way.

I would guess that with zsh's ability to assign arrays it would be
better to keep this consistent with the other forms, as in your patch,
however.

(We should probably hold off on the other one, that moves the flag into
the link node, until 4.3.1, though it is useful simplification to have
later.)

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


To access the latest news from CSR copy this link into a web browser:  http://www.csr.com/email_sig.php

