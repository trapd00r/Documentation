From zsh-workers-return-10881-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Apr 20 12:44:12 2000
Return-Path: <zsh-workers-return-10881-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12392 invoked from network); 20 Apr 2000 12:44:11 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 20 Apr 2000 12:44:11 -0000
Received: (qmail 21090 invoked by alias); 20 Apr 2000 12:43:55 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10881
Received: (qmail 21078 invoked from network); 20 Apr 2000 12:43:55 -0000
Date: Thu, 20 Apr 2000 14:43:53 +0200 (MET DST)
Message-Id: <200004201243.OAA28914@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Thu, 20 Apr 2000 15:58:35 +0400
Subject: PATCH: RE: Q about zrecompile


Andrej Borsenkow wrote:

> > > bor@itsrm2% zfrecomp
> > > re-compiling
> > > /tools/share/zsh/3.1.7-pre-1/functions/Base/_arg_compile.zwc: failed
> >
> > As it says... it can't compile `.../_arg_compile.zwc'. Because, going
> > by the name, it probably isn't a shell code file.
> >
> > Use a pattern that includes only the *functions* (or scripts)
> > you want
> > to put in the zwc file(s).
> >
> 
> I do NOT have _arg_compile.zwc at all. I do have only functions
> installed by default under /tools/share/zsh/$ZSH_VERSION/functions/

Everybody guessed that already, of course... it was all my fault.

I tried to make zrecompile smart, removing zwc files from the file
list it gets. So it was either too smart or too stupid.

I had tried it without a .zwc in the first argument. Completely
automatically, since the .zwc is automatically added.

Bye
 Sven

Index: Functions/Misc/zrecompile
===================================================================
RCS file: /cvsroot/zsh/zsh/Functions/Misc/zrecompile,v
retrieving revision 1.2
diff -u -r1.2 zrecompile
--- Functions/Misc/zrecompile	2000/04/01 20:49:47	1.2
+++ Functions/Misc/zrecompile	2000/04/20 12:41:24
@@ -66,13 +66,15 @@
       argv=()
     fi
 
-    files=( ${files:#*(.zwc|~)} )
     if [[ $files[1] = -[RM] ]]; then
       map=( $files[1] )
       shift 1 files
     else
       map=()
     fi
+    (( $#files )) || continue
+
+    files=( $files[1] ${files[2,-1]:#*(.zwc|~)} )
 
     (( $#files )) || continue
 

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

