From zsh-workers-return-8874-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Dec 03 15:11:03 1999
Return-Path: <zsh-workers-return-8874-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24215 invoked from network); 3 Dec 1999 15:10:58 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 3 Dec 1999 15:10:58 -0000
Received: (qmail 12738 invoked by alias); 3 Dec 1999 15:10:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8874
Received: (qmail 12731 invoked from network); 3 Dec 1999 15:10:49 -0000
Date: Fri, 3 Dec 1999 16:10:48 +0100 (MET)
Message-Id: <199912031510.QAA00969@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Fri, 3 Dec 1999 17:46:02 +0300
Subject: Re: pws-10: _arguments problem


Andrej Borsenkow wrote:

> With stock pws-10:
> 
> bor@itsrm2:/tools/src/imap-4.7%> gdiff -u src/os/u/env_u<TAB>
> _arguments:comparguments:166: not enough arguments

_use_lo called _arguments without the `--' needed and _arguments
didn't test if it got any arguments.

Bye
 Sven

diff -u -r oldcompletion/Base/_arguments Completion/Base/_arguments
--- oldcompletion/Base/_arguments	Fri Dec  3 15:08:14 1999
+++ Completion/Base/_arguments	Fri Dec  3 16:00:17 1999
@@ -71,6 +71,7 @@
     lopts=("--${(@)^${(@)${(@)${(@M)${(@ps:\n:j:\n:)${(@)${(@M)${(@f)$(${~words[1]} --help 2>&1)//\[--/
 --}:#[ 	]#-*}//,/
 }}:#[ 	]#--*}#*--}%%[], ]*}:#}")
+    lopts=( "${(@)lopts:#--}" )
 
     # Now remove all ignored options ...
 
@@ -163,7 +164,7 @@
 
 _style -s options auto-description autod
 
-if comparguments -i "$autod" "$@"; then
+if (( $# )) && comparguments -i "$autod" "$@"; then
   local nm="$compstate[nmatches]" action noargs aret expl local
   local next direct odirect equal single match matched ws tmp1 tmp2 tmp3
   local opts subc prefix suffix
diff -u -r oldcompletion/User/_use_lo Completion/User/_use_lo
--- oldcompletion/User/_use_lo	Fri Dec  3 15:08:31 1999
+++ Completion/User/_use_lo	Fri Dec  3 15:53:52 1999
@@ -3,4 +3,4 @@
 # This is for GNU-like commands which understand the --help option,
 # but which do not otherwise require special completion handling.
 
-_arguments || _default
+_arguments -- || _default

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

