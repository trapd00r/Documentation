From joseph@d2.com Sat Mar 30 08:26:26 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3) with ESMTP id IAA15927 for <mason@werple.mira.net.au>; Sat, 30 Mar 1996 08:26:19 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id QAA08878; Fri, 29 Mar 1996 16:10:26 -0500 (EST)
Resent-Date: Fri, 29 Mar 1996 16:10:26 -0500 (EST)
Message-Id: <199603291836.KAA22874@altair-4.d2.com>
Content-Type: text/plain
MIME-Version: 1.0 (NeXT Mail 3.3 v118.2)
X-Nextstep-Mailer: Mail 3.3 (Enhance 1.1)
From: Joseph Goldstone <joseph@d2.com>
Date: Fri, 29 Mar 96 10:36:50 -0800
To: zsh-workers@math.gatech.edu
Subject: Problems with escaped close parens in ternary expressions in PROMPT
	string
Resent-Message-ID: <"fMaUK1.0.eA2.175Nn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/870
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 2107
Status: OR

I have my PROMPT variable set to:
    PROMPT='%B%m%b%0(#. (root\).)%0(?.. (last code exit status was %?\)): '

When commands complete with a nonzero exit status, I get:
  altair-4): foo                                                             
                                ~
  zsh: command not found: foo
  altair-4 (last code exit status was 1\):

Whereas commands that complete with a zero exit status give me:
  altair-4): echo foo                                                         ~
  foo
  altair-4):                                                                 
                                ~

I thought perhaps there's some reason why I would NOT have to escape the  
first of the two adjacent closing parens, so I tried:
    PROMPT='%B%m%b%0(#. (root\).)%0(?.. (last code exit status was %?)): '

With that change a nonzero exit status gives me:
  altair-4): foo                                                             
                                ~
  zsh: command not found: foo
  altair-4 (last code exit status was 1):                                    
                                ~
which is exactly what I want, but a zero exit status still gives me:
  altair-4 (last code exit status was 1): echo foo                           
                                ~
  foo
  altair-4):                                                                 
                                ~

I am presently seeing this on both NeXTSTEP 3.3 and IRIX 5.3, with both  
systems running zsh 2.6-beta13.

This problem was not present on the IRIX 5.3 system before I upgraded the  
zsh there to zsh-2.6beta13 -- it was running zsh-2.6-beta5 and didn't have  
the problem.  So has something changed in the ternary expression handling  
code for PROMPT sequences since beta5 that would explain this problem?

Thanks.

--joseph

(ps: please email to me directly as I am no longer on zsh-users or zsh-workers.)

pps: the tilde characters you see are from RPROMPT='%B%U%~%u%b' -- that's  
my homedir hanging out on the right hand edge of the screen, wrapping in  
this email message.


