From zsh-workers-return-10562-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Apr 06 22:10:24 2000
Return-Path: <zsh-workers-return-10562-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20662 invoked from network); 6 Apr 2000 22:10:23 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 6 Apr 2000 22:10:23 -0000
Received: (qmail 1936 invoked by alias); 6 Apr 2000 22:09:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10562
Received: (qmail 1920 invoked from network); 6 Apr 2000 22:09:47 -0000
X-Authentication-Warning: natanya.us.mandrakesoft.com: chmou set sender to chmouel@mandrakesoft.com using -f
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: --rebuild with _rpm should give *.src.rpm
From: Chmouel Boudjnah <chmouel@mandrakesoft.com>
Date: 06 Apr 2000 15:10:17 -0700
Message-ID: <m2ya6qnanq.fsf@natanya.us.mandrakesoft.com>
Lines: 38
User-Agent: Gnus/5.0804 (Gnus v5.8.4) Emacs/20.6
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii


When doing a rpm --rebuild  it's mainly to complete src.rpm, here is
the patch :

Index: Completion/Linux/_rpm
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Linux/_rpm,v
retrieving revision 1.3
diff -u -r1.3 _rpm
--- Completion/Linux/_rpm       2000/04/04 19:34:26     1.3
+++ Completion/Linux/_rpm       2000/04/06 22:06:24
@@ -70,8 +70,9 @@
   '--erase:*:uninstall:->uninstall' \
   -'b+[build mode (spec file)]:build stage:((p\:execute\ \%prep\ stage l\:do\ a\ list\ check c\:execute\ build\ stage i\:execute\ install\ stage b\:build\ a\ binary\ package a\:build\ binary\ and\ source\ packages)):*:build:->build_b' \
   -'t+[build mode (tar file)]:build stage:((p\:execute\ \%prep\ stage l\:do\ a\ list\ check c\:execute\ build\ stage i\:execute\ install\ stage b\:build\ a\ binary\ package a\:build\ binary\ and\ source\ packages)):*:build:->build_t' \
-  --{rebuild,rmsource,recompile,resign,addsign}':*:RPM package:->package' \
-  '-K+[signature check mode]:*:sigcheck:->sigcheck' \
+  --{rmsource,recompile,resign,addsign}':*:RPM package:->package' \
+  '--rebuild:*:Src RPM files:->package_src' \
+    '-K+[signature check mode]:*:sigcheck:->sigcheck' \
   '--checksig:*:sigcheck:->sigcheck' \
   '--rebuilddb:*:rebuild:->rebuild' && ret=0
 
@@ -201,6 +202,9 @@
          'prefixes:ftp URL prefix:compadd ftp://' && ret=0
     fi
     ;;
+  package_src)
+    _files -g \*.src\(\#i\).rpm
+   ;&
   tags)
     if compset -P '*%*\{'; then
       _wanted tags expl 'RPM tag' \


-- 
MandrakeSoft Inc                http://www.mandrakesoft.com
Pasadena, CA USA                                  --Chmouel

