From zsh-users-return-14830-mason-zsh=primenet.com.au@zsh.org Fri Feb 12 16:51:50 2010
Return-Path: <zsh-users-return-14830-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27363 invoked by alias); 12 Feb 2010 16:51:49 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14830
Received: (qmail 1378 invoked from network); 12 Feb 2010 16:51:47 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at closedmail.com does not designate permitted sender hosts)
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <100212085134.ZM20573@torch.brasslantern.com>
Date: Fri, 12 Feb 2010 08:51:34 -0800
In-reply-to: <87vde2zn07.fsf@ft.bewatermyfriend.org>
Comments: In reply to Frank Terbeck <ft@bewatermyfriend.org>
 "Re: FAQ : how to check for existence of a file  ABC*" (Feb 12, 12:55pm)
References: <tkrat.d1856a3e314a4383@igpm.rwth-aachen.de>
	<87vde2zn07.fsf@ft.bewatermyfriend.org>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: jarausch@igpm.rwth-aachen.de
Subject: Re: FAQ : how to check for existence of a file  ABC*
Cc: zsh-users@zsh.org
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii

On Feb 12, 12:55pm, Frank Terbeck wrote:
} Subject: Re: FAQ : how to check for existence of a file  ABC*
}
} Helmut Jarausch wrote:
} > if NULL_GLOB is unset the shell bails out if no such file exists;
} > but if NULL_GLOB is set, then the test   [[ -f XX* ]] is invalid since
} > XX* expands to a null string.

Actually [[ -f XX* ]] is invalid because [[ ]] doesn't do globbing.
You need the [ -f XX* ] form (see below).

} And if you don't want to introduce a function, you may want to use
} something along the lines of this:
}   <http://www.zsh.org/mla/users/2009/msg00512.html>

I'm not sure why I didn't suggest this back in that earlier thread,
but what you really want is NO_NOMATCH not NULL_GLOB.  (Unfortunately
there's no glob qualifier to turn on the former, or to turn *off*
CSH_NULL_GLOB which you also need to do.)

The other tricky bit is that [ -f XX* ] will fail if XX* expands to
more than one file, so you need to use the subscript glob qualifier
to be sure you pick off only one of those files:  XX*([1])

Fortunatly recent zsh now has inline functions:

  if (){ setopt localoptions nonomatch nocshnullglob; [ -f XX*([1]) ] }
  then
     ...
  fi

You might need to throw some other options into that setopt, like
nonullglob as well, to make it universal.

