From zsh-workers-return-22552-mason-zsh=primenet.com.au@sunsite.dk Sat Jul 15 19:08:50 2006
Return-Path: <zsh-workers-return-22552-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7949 invoked from network); 15 Jul 2006 19:08:48 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.3 (2006-06-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 15 Jul 2006 19:08:48 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 9650 invoked from network); 15 Jul 2006 19:08:39 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 15 Jul 2006 19:08:39 -0000
Received: (qmail 16554 invoked by alias); 15 Jul 2006 19:08:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22552
Received: (qmail 16545 invoked from network); 15 Jul 2006 19:08:36 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 15 Jul 2006 19:08:36 -0000
Received: (qmail 9348 invoked from network); 15 Jul 2006 19:08:36 -0000
Received: from acolyte.scowler.net (216.254.112.45)
  by a.mx.sunsite.dk with SMTP; 15 Jul 2006 19:08:34 -0000
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id 6477870E2F; Sat, 15 Jul 2006 15:08:32 -0400 (EDT)
Date: Sat, 15 Jul 2006 15:08:32 -0400
From: Clint Adams <clint@zsh.org>
To: zsh-workers@sunsite.dk
Subject: PATCH: _tla 1.3.4
Message-ID: <20060715190832.GA30048@scowler.net>
Mail-Followup-To: zsh-workers@sunsite.dk
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.11+cvs20060403

A couple of updates for tla 1.3.4.

Index: Completion/Unix/Command/_tla
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_tla,v
retrieving revision 1.6
diff -u -r1.6 _tla
--- Completion/Unix/Command/_tla	17 Apr 2005 13:40:27 -0000	1.6
+++ Completion/Unix/Command/_tla	15 Jul 2006 19:06:59 -0000
@@ -8,8 +8,13 @@
 # ask the user which version of tla this is
 if ! zstyle -s ":completion:${curcontext}" tla-version tla_version; then
   # ask tla instead
-  tla_version="${${$($TLA --version)#tla tla-}%% from regexps.com*}"
-  [[ $tla_version == *[a-zA-Z]* ]] && tla_version=1.3 # tla doesn't know
+  tla_version="$($TLA --version)"
+  if [[ "${${(f)tla_version}[1]}" == The\ GNU\ Arch\ Revision\ Control\ System\ \(tla\)\ (#b)([0-9.]##) ]]; then
+    tla_version="$match[1]"
+  else
+    tla_version="${${$($TLA --version)#tla tla-}%% from regexps.com*}"
+    [[ $tla_version == *[a-zA-Z]* ]] && tla_version=1.3 # tla doesn't know
+  fi
 fi
 
 # test whether to hide short options from completion
@@ -252,8 +257,9 @@
 cmd_inventory=('::separator:(--)' '*:directory:_files -/')
 cmd_srcfind=($cmd_inventory)
 
-local cmd_tree_lint
+local cmd_tree_lint cmd_lint
 cmd_tree_lint=('::directory:_files -/')
+cmd_lint=($cmd_tree_lint)
 
 local cmd_id cmd_invtag
 cmd_id=('*:file:_files')
@@ -417,9 +423,10 @@
 local cmd_new_merges
 cmd_new_merges=('::version:_tla_versions')
 
-local cmd_tag cmd_tagrev
+local cmd_tag cmd_tagrev cmd_branch
 cmd_tag=(':SOURCE-REVISION:_tla_revisions' ':TAG-VERSION:_tla_versions')
 cmd_tagrev=($cmd_tag)
+cmd_branch=($cmd_tag)
 
 local cmd_star_merge
 cmd_star_merge=(':FROM:_tla_revisions')
@@ -483,6 +490,12 @@
 local cmd_escape
 cmd_escape=(':string:')
 
+local cmd_diff
+cmd_diff=('::revision:_tla_revisions')
+
+local cmd_export
+cmd_export=(':revision:_tla_revisions' ':dir:_files -/')
+
 #mutually exclusive options
 
 local -A excludes

