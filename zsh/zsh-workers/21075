From zsh-workers-return-21075-mason-zsh=primenet.com.au@sunsite.dk Thu Mar 31 13:37:20 2005
Return-Path: <zsh-workers-return-21075-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18150 invoked from network); 31 Mar 2005 13:37:19 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 31 Mar 2005 13:37:19 -0000
Received: (qmail 91446 invoked from network); 31 Mar 2005 13:37:14 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 31 Mar 2005 13:37:14 -0000
Received: (qmail 23464 invoked by alias); 31 Mar 2005 13:37:10 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21075
Received: (qmail 23447 invoked from network); 31 Mar 2005 13:37:09 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 31 Mar 2005 13:37:09 -0000
Received: (qmail 91098 invoked from network); 31 Mar 2005 13:37:09 -0000
Received: from acolyte.scowler.net (216.254.112.45)
  by a.mx.sunsite.dk with SMTP; 31 Mar 2005 13:37:04 -0000
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id 373577004A; Thu, 31 Mar 2005 08:37:03 -0500 (EST)
Date: Thu, 31 Mar 2005 08:37:03 -0500
From: Clint Adams <clint@zsh.org>
To: zsh-workers@sunsite.dk
Subject: PATCH: _baz fixes
Message-ID: <20050331133703.GB19751@scowler.net>
Mail-Followup-To: zsh-workers@sunsite.dk
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.6+20040907i
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

I'm told that baz 1.3 won't have the -A option to a bunch of commands.
The same alternatives can probably be used for _tla too.

Index: Completion/Unix/Command/_baz
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_baz,v
retrieving revision 1.3
diff -u -r1.3 _baz
--- Completion/Unix/Command/_baz	11 Mar 2005 01:11:48 -0000	1.3
+++ Completion/Unix/Command/_baz	31 Mar 2005 13:31:36 -0000
@@ -80,7 +80,7 @@
     compset -P '*/'
     archive=${IPREFIX%/*}
     _description -V categories expl "${library:-}categories in $archive"
-    compadd $suffix "$expl[@]" `$BAZ ${library:-}categories -A $archive`
+    compadd $suffix "$expl[@]" `$BAZ ${library:-}categories $archive`
   elif [ -z $IPREFIX ]; then
     local index=$(( words[(i)-A] + 1 ))
     (( index < CURRENT )) || index=$(( words[(i)--archive] + 1 ))
@@ -88,7 +88,7 @@
 
     if [ $archive ]; then
       _description -V categories expl "${library:-}categories in $archive"
-      compadd "$expl[@]" $suffix `$BAZ ${library:-}categories -A $archive`
+      compadd "$expl[@]" $suffix `$BAZ ${library:-}categories $archive`
     fi
 
     _baz_archives -S / ${library:+--library}
@@ -111,7 +111,7 @@
     local category=${IPREFIX%--}
     _description -V branches expl "${library:-}branches"
     compadd $suffix "$expl[@]" \
-      ${${(@)$($BAZ ${library:-}branches -A $archive $category)}##*--}
+      ${${(@)$($BAZ ${library:-}branches $archive/$category)}##*--}
   fi
   if [ $1 -gt 1 ] && [[ $IPREFIX = *-- ]] && [[ $PREFIX = *--* ]]; then
     _baz_namespace_versions $(($1 - 1))
@@ -129,7 +129,7 @@
     local branch=${IPREFIX%--}
     _description -V versions expl "${library:-}versions"
     compadd $suffix "$expl[@]" \
-      ${${(@)$($BAZ ${library:-}versions -A $archive $branch)}##*--}
+      ${${(@)$($BAZ ${library:-}versions $archive/$branch)}##*--}
   fi
   if [ $1 -gt 1 ] && [[ $IPREFIX = *--*-- ]] && ([[ $IPREFIX = */*--*-- ]] \
     || [[ $PREFIX != */* ]]) && [[ $PREFIX = *--* ]]; then
@@ -146,22 +146,16 @@
     _description -V revisions expl "${library:-}revisions"
     local completions c
     completions=(
-      ${${(@)$($BAZ ${library:-}revisions -A $archive $version)}##*--}
+      ${${(@)$($BAZ ${library:-}revisions $archive/$version)}##*--}
     )
     (( exclude_library_revisions )) && \
-        foreach c ($($BAZ library-revisions -A $archive $version)); do completions[(r)$c]=(); done
+        foreach c ($($BAZ library-revisions $archive/$version)); do completions[(r)$c]=(); done
     compadd "$expl[@]" -a completions
   fi
 }
 
 (( $+functions[_baz_config] )) ||
 _baz_config () {
-
-  # zsh 4.1.1+ is recommended; 4.0.6 gives the error below when doing
-  # baz build-config e<TAB>
-  # _path_files:322: no matches found: configs//e/.(/)
-  # whereas 4.1.1 completes correctly
-
   local configdir root ret=1 n expl
 
   n=$opt_args[(i)(-d|--dir)]
@@ -192,7 +186,7 @@
 
     if [[ $PREFIX != *--* ]]; then
       _description -V categories expl "categories in $archive"
-      compadd -q -S -- "$expl[@]" `$BAZ categories -A $archive`
+      compadd -q -S -- "$expl[@]" `$BAZ categories $archive`
     else
       _baz_namespace_branches 3
     fi

