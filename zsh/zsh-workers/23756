From zsh-workers-return-23756-mason-zsh=primenet.com.au@sunsite.dk Mon Aug 13 20:42:44 2007
Return-Path: <zsh-workers-return-23756-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2587 invoked from network); 13 Aug 2007 20:42:38 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.1 (2007-05-02) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 13 Aug 2007 20:42:38 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 2944 invoked from network); 13 Aug 2007 20:42:33 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 13 Aug 2007 20:42:33 -0000
Received: (qmail 28977 invoked by alias); 13 Aug 2007 20:42:31 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23756
Received: (qmail 28965 invoked from network); 13 Aug 2007 20:42:30 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 13 Aug 2007 20:42:30 -0000
Received: (qmail 2679 invoked from network); 13 Aug 2007 20:42:30 -0000
Received: from ug-out-1314.google.com (66.249.92.170)
  by a.mx.sunsite.dk with SMTP; 13 Aug 2007 20:42:25 -0000
Received: by ug-out-1314.google.com with SMTP id u2so22591uge
        for <zsh-workers@sunsite.dk>; Mon, 13 Aug 2007 13:42:24 -0700 (PDT)
DKIM-Signature: a=rsa-sha1; c=relaxed/relaxed;
        d=gmail.com; s=beta;
        h=domainkey-signature:received:received:message-id:date:from:to:subject:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references;
        b=H0LeGAThDX0Lw8d+XhWiqVRpfLjpIjmvniM1o6LFHu2OGLBwuDHEX+8zQ8GLfNoZrHb8eP79YhIvDe9BjWir5444A9eKUBwUAsLsWKgAYOCtgIvT3yrvag1XeFXDZWNblhbMSFLfcVuix8iKNpBSRWnFPz2pUa4iZuYK9s38hJg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=beta;
        h=received:message-id:date:from:to:subject:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references;
        b=Q6U/ANKEc1tBNjy6avfDsUxJ8GK0A5K8fmC4AtoZMuXDu5pY1+xpDVSaMWjyvYPcW8jAAClFdEpzlMRb7c9hBBSYmUqb8IlUBBMbjv3zUqrpVO0c6KtPG2GqXL68m8wGw/3KY+8rlLdliASB7ePgbudtd1peMttd3kL9KgZr6ow=
Received: by 10.142.231.7 with SMTP id d7mr275145wfh.1187037743222;
        Mon, 13 Aug 2007 13:42:23 -0700 (PDT)
Received: by 10.143.43.10 with HTTP; Mon, 13 Aug 2007 13:42:23 -0700 (PDT)
Message-ID: <17393e3e0708131342v4f1054cdo42a7076a91b8f0b4@mail.gmail.com>
Date: Mon, 13 Aug 2007 16:42:23 -0400
From: "Matt Wozniski" <godlygeek@gmail.com>
To: zsh-workers@sunsite.dk
Subject: Re: Unexpected side effect of 'setopt correct'
In-Reply-To: <20070813210734.dbe4b58f.p.w.stephenson@ntlworld.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
References: <17393e3e0708051936m388bf6e4pdca167f03b8dcd5c@mail.gmail.com>
	 <20070813210734.dbe4b58f.p.w.stephenson@ntlworld.com>

On 8/13/07, Peter Stephenson <p.w.stephenson@ntlworld.com> wrote:
> On Sun, 5 Aug 2007 22:36:38 -0400
> "Matt Wozniski" <godlygeek@gmail.com> wrote:
> > I just noticed this effect of 'setopt correct'.. Is this intentional behavior?
>
> Ish.
>
> > mastermind% function pid() {
>                           ^^ (actually you don't want the () in this case)

I've seen you mention before that the () shouldn't be used after
'function', but the grammar says it's allowed:
function word ... [ () ] [ term ] { list }
Either you've made a tiny mistake in the grammar or on the lists.  :)

> > function>
> > mastermind%
> >
> > Is it intentional that it attempts to correct on a function
> > definition?  Is it intentional that it only attempts to correct one of
> > the two types of function definition?  Something about this behavior
> > caught me off guard.  :)
>
> Correction happens as the line is parsed.  In the first case, the shell
> has read as far as "pid", and assumes to begin with it's a command word,
> hence it applies correction.  It needs to do this early on because it
> has to correct the word before it starts parsing the arguments to it.
> To change this would require a lot more lookahead, or we'd have to live
> with side effects like not being able to correct to special shell
> constructs.
>
> In the second case, since we've found the keyword "function", we know
> the next word isn't expected to be an existing command and we can
> disable spelling correction immediately,

I understand what you're saying, but have a tiny suggestion to make: I
understand the necessity of correcting the command before parsing its
arguments, but in the case of "pid() {\n", the first word is not "pid"
but "pid()" - so, I haven't sourcedived on this, but I assume while
parsing out the command, it's iterating over the line, peeking at the
next character, and checking if it's a whitespace or '('...  Wouldn't
it be easy to special-case "word()" to turn off correction in the same
way as "function word" turns it off?  Of course, that wouldn't work as
easily for "word ()" with some whitespace stuck in there, but I'd
consider it a slight improvement if it's as easy a tweak as I think it
would be.  :)

~Matt

