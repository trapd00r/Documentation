From zsh-users-return-11125-mason-zsh=primenet.com.au@sunsite.dk Wed Jan 17 07:15:05 2007
Return-Path: <zsh-users-return-11125-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11892 invoked from network); 17 Jan 2007 07:15:00 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 17 Jan 2007 07:15:00 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 84497 invoked from network); 17 Jan 2007 07:14:53 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Jan 2007 07:14:53 -0000
Received: (qmail 12244 invoked by alias); 17 Jan 2007 07:14:45 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11125
Received: (qmail 12232 invoked from network); 17 Jan 2007 07:14:44 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 17 Jan 2007 07:14:44 -0000
Received: (qmail 83264 invoked from network); 17 Jan 2007 07:14:44 -0000
Received: from s1tank.virtdom.com (216.240.101.50)
  by a.mx.sunsite.dk with SMTP; 17 Jan 2007 07:14:38 -0000
Received: (qmail 26509 invoked by uid 89); 17 Jan 2007 07:13:59 -0000
Received: from ool-4577886b.dyn.optonline.net (HELO venti) (brian@aljex.com@69.119.136.107)
  by s1tank.virtdom.com with SMTP; 17 Jan 2007 07:13:59 -0000
Message-ID: <010301c73a07$1d094f80$0901a8c0@venti>
From: "Brian K. White" <brian@aljex.com>
To: <zsh-users@sunsite.dk>
References: <20070116231141.GC21799@sen> <00d801c739d5$7ce4b890$0901a8c0@venti> <20070117035048.GB10583@prunille.vinc17.org>
Subject: Re: recovering zombie process
Date: Wed, 17 Jan 2007 02:14:22 -0500
Organization: Aljex Software
MIME-Version: 1.0
Content-Type: text/plain;
	format=flowed;
	charset="iso-8859-1";
	reply-type=original
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.3028
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.3028


----- Original Message ----- 
From: "Vincent Lefevre" <vincent@vinc17.org>
To: <zsh-users@sunsite.dk>
Sent: Tuesday, January 16, 2007 10:50 PM
Subject: Re: recovering zombie process


> On 2007-01-16 20:19:08 -0500, Brian K. White wrote:
>> 2) freeware tty multiplexing/cloning software
>>    ttysnoop
>>    screen / mscreen
>
> Is there a way to use them transparently?

Except for screen that is exactly how they are designed to work.
They each work by different means though, resulting in different levels of 
perfection of transparency.

DoubleVision is the best, it's a kernel module and hooks in somewhere in the 
kernel tty layer.
And it impliments terminfo based terminal translation so a users on 
dissimilar terminals can dv each other and the escape codes and keystrokes 
all get translated so the two terminals stay sensible.
It's impractical to use on linux though because your kernel is always a 
moving target not supported by the module.
It's wonderful on commercial OS's where you have the same kernel as everyone 
else, or at least the interface for kernel modules is documented and very 
rarely changed, and very very very rarely changed in a way that breaks 
backwards compatibility.

ttysnoop works by replacing /bin/login
Thats both good and bad.

The good is:
  safer, all userland, no messing with your kernel.
  safer, can be used on some services, or even individual ttys, while others 
are not touched.
  doesn't require rebootig or disrupting the box to put in or take out.

The bad is:
more of a pain in the neck to get it in place since each service that might 
possibly generate a tty needs to be dealt with seperately. Even if you 
actually replace /bin/login instead of figuring out the individual service 
configurations like adding -L /some/program to telnetd, most services can be 
configured not to use /bin/login, and so you still have to go tell them to 
use it.
Some services simply can't use ttysnoop no matter what. FacetWin (commercial 
terminal emulator that only talks to it's proprietary server daemon) does 
not use any standalone login and does not have any option to do so, and so 
there is no place to inject ttysnoop. But in most cases, if you're using 
FacetWin instead of telnet or openssh, then you are also using 
sco,sun,aix,hpux,etc.. where doublevision is practical.

ttysnoop has other failings though. it's very crude, does no terminal type 
translation, and hasn't been maintained in years.
There are patched versions to support unix98 pty's but so far I don't think 
any are 100% yet. There is a known bug where, on unix98 pty's (2.6 kernels), 
ttysnoop fails to update utmp/wtmp when closing some sessions and so w/who 
etc show users logged in who aren't.

I've never used peek. If I'm gonna pay, DoubleVision is less than half the 
price and works at a lower level, and works awsome, and is proven up the 
wazoo since most of my sco customers over the years have gotten it.
For the price of peek on just one box, (unlimited version, which I'd need 
since my user count on any one of several boxes is over double than peek's 
next highest user count.) I could probably pay a programmer to nail down 
ttysnoop. I don't really have dissimilar terminals that much any more, at 
least not enough that this limitation would be insufferable.

I'm still in the process of really figuring out if ttysnoop can work out ok 
or not though. We definitely need something, be it 
doublevision,ttysnoop,peek,other...
We use it a lot for customer support and training.

It's useful for some sysadmin (both os and db type) tasks too but I think 
screen can be used for those.
We'd use dv to connect to a console tty before doing some critical procedure 
that would be ReallyBad(tm) if it crashed in the middle. If the net 
connection or terminal emulator barfs, just reconnect. The app kept running 
on the console. For that matter, if you can't reconnect you can actually 
drive to the site and access that console directly. We can probably just use 
screen for that.


>> By rights, these processes should have all received a hangup when the
>> parent went away.
>
> If the parent has crashed, there's no hangup.

Then shouldn't the next higher parent do it?
If it were a telnet session that'd be telnetd. In the case of an xterm I'm 
not sure where that responsibility should lie.
X? window manager? the shell that ran startx or xdm? init? the kernel?

Brian K. White  --  brian@aljex.com  --  http://www.aljex.com/bkw/
+++++[>+++[>+++++>+++++++<<-]<-]>>+.>.+++++.+++++++.-.[>+<---]>++.
filePro  BBx    Linux  SCO  FreeBSD    #callahans  Satriani  Filk!

