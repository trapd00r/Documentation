From zsh-workers-return-20254-mason-zsh=primenet.com.au@sunsite.dk Tue Aug 10 18:17:58 2004
Return-Path: <zsh-workers-return-20254-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21014 invoked from network); 10 Aug 2004 18:17:57 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 10 Aug 2004 18:17:57 -0000
Received: (qmail 94489 invoked from network); 10 Aug 2004 18:17:51 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 Aug 2004 18:17:51 -0000
Received: (qmail 20295 invoked by alias); 10 Aug 2004 18:17:38 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20254
Received: (qmail 20285 invoked from network); 10 Aug 2004 18:17:38 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by 130.225.247.90 with SMTP; 10 Aug 2004 18:17:38 -0000
Received: (qmail 93541 invoked from network); 10 Aug 2004 18:16:13 -0000
Received: from mail36.messagelabs.com (193.109.254.211)
  by a.mx.sunsite.dk with SMTP; 10 Aug 2004 18:16:11 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-20.tower-36.messagelabs.com!1092161769!8418003
X-StarScan-Version: 5.2.10; banners=-,-,-
X-Originating-IP: [158.234.9.163]
Received: (qmail 5520 invoked from network); 10 Aug 2004 18:16:09 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-20.tower-36.messagelabs.com with SMTP; 10 Aug 2004 18:16:09 -0000
Received: from trentino.logica.co.uk ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id i7AIG9f6010393
	for <zsh-workers@sunsite.dk>; Tue, 10 Aug 2004 19:16:09 +0100
Received: from trentino.logica.co.uk (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP id CE5E3791B004
	for <zsh-workers@sunsite.dk>; Tue, 10 Aug 2004 20:16:08 +0200 (CEST)
To: Zsh <zsh-workers@sunsite.dk>
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <16609.1091976020@trentino.logica.co.uk> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <200408061350.i76DovBi028948@news01.csr.com> <20040806180339.GA31854@scowler.net> <10094.1091886003@trentino.logica.co.uk> <20040808044557.GA8117@scowler.net> <16609.1091976020@trentino.logica.co.uk>
Subject: Re: default tag-order (was Re: zsh 4.2.1-test-A) 
Date: Tue, 10 Aug 2004 20:16:08 +0200
Message-ID: <14157.1092161768@trentino.logica.co.uk>
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_44 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0

I wrote:
> 
> One safe option is to insert `(( ! ${@[(I)options]} )) ||'.
> That checks if there is an options tag before applying the tag-order.

Unless anyone objects, I'll commit this as a temporary solution. Actual
patch is below. It is the one solution which, as far as I know, doesn't
break anything that isn't already broken (which is what I meant by
"safe" above). So at least _cdrecord can be fixed and this needn't hold
up 4.2.1.

As a longer term fix, that default tag-order has to go completely. I
just need to find all those things that removing it would break and find
a better fix.

Oliver

Index: Completion/Base/Core/_tags
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Base/Core/_tags,v
retrieving revision 1.3
diff -u -r1.3 _tags
--- Completion/Base/Core/_tags	29 May 2001 17:54:08 -0000	1.3
+++ Completion/Base/Core/_tags	8 Aug 2004 13:52:56 -0000
@@ -41,6 +41,7 @@
     "$_sort_tags" "$@"
   else
     zstyle -a ":completion:${curcontext}:" tag-order order ||
+        (( ! ${@[(I)options]} )) ||
         order=('(|*-)argument-* (|*-)option[-+]* values' options)
 
     for tag in $order; do

