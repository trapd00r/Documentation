From zsh-users-return-3472-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Oct 25 12:28:09 2000
Return-Path: <zsh-users-return-3472-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15695 invoked from network); 25 Oct 2000 12:28:08 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 25 Oct 2000 12:28:08 -0000
Received: (qmail 23345 invoked by alias); 25 Oct 2000 12:27:55 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 3472
Received: (qmail 23319 invoked from network); 25 Oct 2000 12:27:50 -0000
Date: Wed, 25 Oct 2000 14:27:44 +0200 (MET DST)
Message-Id: <200010251227.OAA00698@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-users@sunsite.auc.dk
In-reply-to: Vincent Lefevre's message of Wed, 25 Oct 2000 14:05:41 +0200
Subject: Re: File completion for co


Vincent Lefevre wrote:

> With zsh 3.1.9, file completion for co doesn't work. Why?

Because it only ever tried to complete files from the RCS
sub-directory (no attempt to complete all files per default).

Try this patch.

To workers: however wrote _rcs should have a look at these changes,
but ignoring the return value of _files and using $PREFIX*$SUFFIX for
matching wasn't the right thing to do.

Bye
 Sven

Index: Completion/User/_rcs
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/User/_rcs,v
retrieving revision 1.3
diff -u -r1.3 _rcs
--- Completion/User/_rcs	2000/05/31 09:38:26	1.3
+++ Completion/User/_rcs	2000/10/25 12:25:17
@@ -1,12 +1,14 @@
 #compdef co ci rcs
 
-local nm=$compstate[nmatches] cmd="${words[1]:t}"
+local nm=$compstate[nmatches] cmd="${words[1]:t}" ret=1
 
-[[ $cmd = ci || $cmd = rcs ]] && _files
-
 if [[ $compstate[nmatches] -eq nm && -d RCS && $cmd != ci ]]; then
   local rep expl
 
-  rep=(RCS/$PREFIX*$SUFFIX,v(:t:s/\,v//))
-  (( $#rep )) && _wanted files expl 'RCS file' compadd -a rep
+  rep=(RCS/*,v(:t:s/\,v//))
+  (( $#rep )) && _wanted files expl 'RCS file' compadd -a rep && ret=0
 fi
+
+[[ $cmd = ci || $cmd = rcs || ret -eq 1 ]] && _files && ret=0
+
+return ret

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

