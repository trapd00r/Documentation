From zsh-workers-return-21072-mason-zsh=primenet.com.au@sunsite.dk Thu Mar 31 01:02:59 2005
Return-Path: <zsh-workers-return-21072-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4109 invoked from network); 31 Mar 2005 01:02:58 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 31 Mar 2005 01:02:58 -0000
Received: (qmail 36865 invoked from network); 31 Mar 2005 01:02:52 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 31 Mar 2005 01:02:52 -0000
Received: (qmail 22750 invoked by alias); 31 Mar 2005 01:02:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21072
Received: (qmail 22730 invoked from network); 31 Mar 2005 01:02:48 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 31 Mar 2005 01:02:48 -0000
Received: (qmail 36456 invoked from network); 31 Mar 2005 01:02:48 -0000
Received: from vinc17.net4.nerim.net (HELO ay.vinc17.org) (62.212.121.106)
  by a.mx.sunsite.dk with SMTP; 31 Mar 2005 01:02:43 -0000
Received: from lefevre by ay.vinc17.org with local (Exim 4.50)
	id 1DGo53-0003gl-9i; Thu, 31 Mar 2005 03:02:41 +0200
Date: Thu, 31 Mar 2005 03:02:41 +0200
From: Vincent Lefevre <vincent@vinc17.org>
To: zsh-workers@sunsite.dk, 299950-forwarded@bugs.debian.org
Subject: Re: Bug#299950: zsh: Better completion for "svn revert"
Message-ID: <20050331010240.GU19392@ay.vinc17.org>
Mail-Followup-To: Vincent Lefevre <vincent@vinc17.org>,
	zsh-workers@sunsite.dk, 299950-forwarded@bugs.debian.org
References: <20050317142638.GA23797@dixsept.loria.fr> <20050325142839.GA32333@scowler.net> <20050325161734.GT19392@ay.vinc17.org> <20050327003652.GA20238@scowler.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <20050327003652.GA20238@scowler.net>
X-Mailer-Info: http://www.vinc17.org/mutt/
User-Agent: Mutt/1.5.9-vl-20050321i
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.5

On 2005-03-26 19:36:52 -0500, Clint Adams wrote:
> +(( $+functions[_svn_adm_files] )) ||
> +_svn_adm_files() {
> +  compadd ${${(M)${(f)"$(svn status)"}:#(#s)[ADM]*}##[ADM] ##}

Doing a recursive "svn status" is not a good idea, as it may take
a very long time. I suggest doing a "svn -N status" and completing
also on any directory containing a .svn subdirectory.

Moreover, the [ADM] pattern is incorrect. It should be ([ADM]|?M).
This would give:

  compadd ${${(M)${(f)"$(svn -N status)"}:#(#s)([ADM]|?M)*}##([ADM]|?M) ##}

+ the code to complete on directories (only those that contain a
.svn subdirectory, in fact).

When one tries to complete on

  svn revert path/to/dir/

zsh should do a "svn -N status path/to/dir", which returns lines like

A     path/to/dir/added_file
D     path/to/dir/deleted_file
M     path/to/dir/modified_file
 M    path/to/dir/modifprop_file

-- 
Vincent Lefèvre <vincent@vinc17.org> - Web: <http://www.vinc17.org/>
100% accessible validated (X)HTML - Blog: <http://www.vinc17.org/blog/>
Work: CR INRIA - computer arithmetic / SPACES project at LORIA

