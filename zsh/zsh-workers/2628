From zsh-workers-request@euclid.skiles.gatech.edu Tue Dec 24 11:26:48 1996
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 6358 invoked from network); 24 Dec 1996 11:26:46 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 24 Dec 1996 11:26:46 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id GAA01600; Tue, 24 Dec 1996 06:27:47 -0500 (EST)
Resent-Date: Tue, 24 Dec 1996 06:27:47 -0500 (EST)
From: Zefram <zefram@dcs.warwick.ac.uk>
Message-Id: <23496.199612241128@stone.dcs.warwick.ac.uk>
Subject: error message for lack of boot/cleanup function
To: zsh-workers@math.gatech.edu (Z Shell workers mailing list)
Date: Tue, 24 Dec 1996 11:28:50 +0000 (GMT)
X-Patch: 155
X-Loop: zefram@dcs.warwick.ac.uk
X-Stardate: [-31]8622.39
X-US-Congress: Moronic fuckers
Content-Type: text
Resent-Message-ID: <"fodAd2.0.tO.ouxlo"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2628
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

-----BEGIN PGP SIGNED MESSAGE-----

The patch makes zmodload give an error message if a module's boot or
cleanup function couldn't be found.  Previously it just silently failed,
which can be confusing and is certainly unhelpful.

 -zefram

      *** Src/module.c	1996/12/24 02:09:54	1.17
      --- Src/module.c	1996/12/24 02:31:26
      ***************
      *** 195,201 ****
            sprintf(buf, "boot_%s", s);
        #endif
            fn = (Module_func) dlsym(m->handle, buf);
      !     return fn ? fn(m) : 1;
        }
        
        /**/
      --- 195,204 ----
            sprintf(buf, "boot_%s", s);
        #endif
            fn = (Module_func) dlsym(m->handle, buf);
      !     if(fn)
      ! 	return fn(m);
      !     zwarnnam(m->nam, "no boot function", NULL, 0);
      !     return 1;
        }
        
        /**/
      ***************
      *** 270,276 ****
            sprintf(buf, "cleanup_%s", s);
        #endif
            fn = (Module_func) dlsym(m->handle, buf);
      !     return fn ? fn(m) : 1;
        }
        
        /**/
      --- 273,282 ----
            sprintf(buf, "cleanup_%s", s);
        #endif
            fn = (Module_func) dlsym(m->handle, buf);
      !     if(fn)
      ! 	return fn(m);
      !     zwarnnam(m->nam, "no cleanup function", NULL, 0);
      !     return 1;
        }
        
        /**/

-----BEGIN PGP SIGNATURE-----
Version: 2.6.2

iQCVAwUBMr9DtXD/+HJTpU/hAQEg9QQAvU8zqt4xrqxQ1UGdA/M0NdLF+w1M0Pcs
9SOH9ink9TMRknTmUKYDaYqlRhuibIMvbdQhGwA+fRv7I1aSdvMmVEQv7aRjnMuP
PhjjePP5UQUAaCuvfMr4o2J7FjKEJQgAssgqvZKQK8EZn8jle+J+9Est3V8QZetO
9aG47Te6Hwo=
=oNr0
-----END PGP SIGNATURE-----

