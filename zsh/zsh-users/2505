From zsh-users-return-2505-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Aug 24 08:00:12 1999
Return-Path: <zsh-users-return-2505-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23078 invoked from network); 24 Aug 1999 08:00:07 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 24 Aug 1999 08:00:07 -0000
Received: (qmail 6139 invoked by alias); 24 Aug 1999 07:59:31 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 2505
Received: (qmail 6131 invoked from network); 24 Aug 1999 07:59:29 -0000
Date: Tue, 24 Aug 1999 09:59:14 +0200 (MET DST)
Message-Id: <199908240759.JAA03954@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-users@sunsite.auc.dk
In-reply-to: Sven Wischnowsky's message of Mon, 23 Aug 1999 16:09:59 +0200
	(MET DST)
Subject: Re: compctl for export (with PATCH)


Matthew wrote (in private mail) that the patch didn't fix his problem, 
although it did for me. So I looked a agin and found another bug when
completing a parameter with non-empty prefix. I'll discuss with him if 
that fixes it...

Anyway, this patch is needed for old-style completion anyway.

Bye
 Sven

P.S.: One day I'd like to remove compctl, probably first replacing it
      with a (autoloaded) shell function that creates new-style
      functions on the fly.

diff -u os/Zle/zle_tricky.c Src/Zle/zle_tricky.c
--- os/Zle/zle_tricky.c	Mon Aug 23 16:11:04 1999
+++ Src/Zle/zle_tricky.c	Tue Aug 24 09:55:21 1999
@@ -800,10 +800,12 @@
 		/* Get the prefix (anything up to the character before the name). */
 		isuf = dupstring(e);
 		untokenize(isuf);
-		*e = '\0';
+		sav = *b;
+		*b = *e = '\0';
 		ripre = dyncat((ripre ? ripre : ""), s);
 		ipre = dyncat((ipre ? ipre : ""), s);
-		ripre[b - s] = '\0';
+		*b = sav;
+
 		untokenize(ipre);
 	    }
 	    else

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

