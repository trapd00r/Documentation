From zsh-users-return-8480-mason-zsh=primenet.com.au@sunsite.dk Thu Feb 10 18:41:34 2005
Return-Path: <zsh-users-return-8480-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23591 invoked from network); 10 Feb 2005 18:41:33 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 10 Feb 2005 18:41:33 -0000
Received: (qmail 51125 invoked from network); 10 Feb 2005 18:41:27 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 Feb 2005 18:41:27 -0000
Received: (qmail 25382 invoked by alias); 10 Feb 2005 18:41:20 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8480
Received: (qmail 25369 invoked from network); 10 Feb 2005 18:41:20 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 10 Feb 2005 18:41:20 -0000
Received: (qmail 50108 invoked from network); 10 Feb 2005 18:41:20 -0000
Received: from out001pub.verizon.net (HELO out001.verizon.net) (206.46.170.140)
  by a.mx.sunsite.dk with SMTP; 10 Feb 2005 18:41:17 -0000
Received: from candle.brasslantern.com ([4.11.10.129])
          by out001.verizon.net
          (InterMail vM.5.01.06.06 201-253-122-130-106-20030910) with ESMTP
          id <20050210184115.EVGP29541.out001.verizon.net@candle.brasslantern.com>
          for <zsh-users@sunsite.dk>; Thu, 10 Feb 2005 12:41:15 -0600
Received: from candle.brasslantern.com (IDENT:schaefer@localhost [127.0.0.1])
	by candle.brasslantern.com (8.12.11/8.12.11) with ESMTP id j1AIfCW7022492
	for <zsh-users@sunsite.dk>; Thu, 10 Feb 2005 10:41:12 -0800
Received: (from schaefer@localhost)
	by candle.brasslantern.com (8.12.11/8.12.11/Submit) id j1AIfB3M022491
	for zsh-users@sunsite.dk; Thu, 10 Feb 2005 10:41:11 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <1050210184111.ZM22490@candle.brasslantern.com>
Date: Thu, 10 Feb 2005 18:41:11 +0000
In-Reply-To: <20050210165417.GG30487@ay.vinc17.org>
Comments: In reply to Vincent Lefevre <vincent@vinc17.org>
        "History corruption (over NFS)" (Feb 10,  5:54pm)
References: <20050210165417.GG30487@ay.vinc17.org>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-users@sunsite.dk
Subject: Re: History corruption (over NFS)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Authentication-Info: Submitted using SMTP AUTH at out001.verizon.net from [4.11.10.129] at Thu, 10 Feb 2005 12:41:12 -0600
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On Feb 10,  5:54pm, Vincent Lefevre wrote:
}
} I've noticed history corruption (several times) when using screen,
} with the following .screenrc file: the end of the .zhistory file
} gets many null characters. I thought that zsh was using a lock
} mechanism.

My experience has been that this sort of thing occurs when a file is
shortened with e.g. ftruncate(), and is a problem with NFS and not
with whether a locking mechanism is in use.

One thing to check is whether the file on the NFS server actually does
contain those nul bytes, or if it's only the NFS client that sees them.
I vaguely recall that you may need to explicitly specify "noac" in the
NFS mount options, but it's been quite some time since I encountered
this particular problem.

