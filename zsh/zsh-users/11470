From zsh-users-return-11470-mason-zsh=primenet.com.au@sunsite.dk Fri May 04 06:03:38 2007
Return-Path: <zsh-users-return-11470-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19126 invoked from network); 4 May 2007 06:03:36 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.0 (2007-05-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=no
	version=3.2.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 4 May 2007 06:03:36 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 53889 invoked from network); 4 May 2007 06:03:27 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 May 2007 06:03:27 -0000
Received: (qmail 5266 invoked by alias); 4 May 2007 06:03:19 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11470
Received: (qmail 5256 invoked from network); 4 May 2007 06:03:18 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 4 May 2007 06:03:18 -0000
Received: (qmail 52678 invoked from network); 4 May 2007 06:03:18 -0000
Received: from redoubt.spodhuis.org (HELO mx.spodhuis.org) (193.202.115.177)
  by a.mx.sunsite.dk with SMTP; 4 May 2007 06:03:15 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws; s=first1; d=spodhuis.org;
	h=Received:Date:From:To:Cc:Subject:Message-ID:Mail-Followup-To:References:MIME-Version:Content-Type:Content-Disposition:In-Reply-To;
	b=YgFWs/qyG6IEIEbLbFW6v/UGSM0jHcmCG4Ra2kro4zKZ0CrHIpwINPG/yjwrmRAyGmY0Or05xrlTVnFAauN1jnags1jVfZIq5E3lFoK2YnS0OsV3F19b7CalmXN/VdTdgP3nZpEY3xiruU4QPjfgbMPOrvR5wTqGszgKP9SKyiU=;
Received: by smtp.spodhuis.org with local 
	id 1Hjqsp-0002CU-MX; Fri, 04 May 2007 06:03:11 +0000
Date: Thu, 3 May 2007 23:03:11 -0700
From: Phil Pennock <zsh-workers+phil.pennock@spodhuis.org>
To: zzapper <david@tvis.co.uk>
Cc: zsh-users@sunsite.dk
Subject: Re: Generate files from a template with values from a list
Message-ID: <20070504060311.GA7884@redoubt.spodhuis.org>
Mail-Followup-To: zzapper <david@tvis.co.uk>, zsh-users@sunsite.dk
References: <Xns9926797B3DB1zzappergmailcom@80.91.229.5>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <Xns9926797B3DB1zzappergmailcom@80.91.229.5>

On 2007-05-03 at 23:45 +0000, zzapper wrote:
> I have an html template file which contains two fields xx_ and yy_
> 
> I need to generate a number of copies of pages from this template each time 
> replacing the fields xx_ and yy_ with values from a list.
> 
> The list contains 49 xx_ yy_ pairs eg
> 
> 11,234
> 15,235
> 21,236
> ..
> ..
> etc
> 
> So I want to create 49 pages each populated from one pair from the list

You don't say how those new files will be named.  I'm sticking 1..49 in
them by using a shell variable "index" below.

If by list you mean a file with those items in it:

local -i index=0
while IFS=, read xx yy
do
  index+=1
  perl_that_is_below
done < listfile

otherwise, if you mean you have an array in zsh, then:

local -i index=0
for z in $list; do xx=${z%,*}; yy=${z#*,}
  index+=1
  perl_that_is_below
done

Note that this Perl is not safe if $xx or $yy can contain arbitrary
text, or anything with backslashes; if that is the case, the safest way
to pass them without any escaping issues is probably to pass via the
environment and use something like $xx = quotemeta $ENV{xx}
(and use single-quotes at the shell level to let those dollars through
to Perl).

perl <template >newfile.$index.html -pe "s/xx_/$xx/g; s/yy_/$yy/g"

All untested.  E&OE.  "man perlrun" for information on "-p".

You could do it all in Perl, but then use lose the convenience of
"perl -p"; you could do it all in zsh, I'm sure, but it's easier and
cleaner to do the substitution stuff in Perl.  For me.  Other people who
have minds less contaminated by Perl may well disagree.

-Phil

