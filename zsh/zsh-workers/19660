From zsh-workers-return-19660-mason-zsh=primenet.com.au@sunsite.dk Fri Mar 19 15:10:07 2004
Return-Path: <zsh-workers-return-19660-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23562 invoked from network); 19 Mar 2004 15:10:06 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 19 Mar 2004 15:10:06 -0000
Received: (qmail 19890 invoked by alias); 19 Mar 2004 15:09:53 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19660
Received: (qmail 19876 invoked from network); 19 Mar 2004 15:09:51 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 19 Mar 2004 15:09:51 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [195.34.32.101] by sunsite.dk (MessageWall 1.0.8) with SMTP; 19 Mar 2004 15:9:51 -0000
Received: from [62.118.250.235] (HELO master.altlinux.ru)
  by umail.ru (CommuniGate Pro SMTP 4.1.8)
  with ESMTP id 218126784 for zsh-workers@sunsite.dk; Fri, 19 Mar 2004 18:09:49 +0300
Received: from solemn.turbinal.org (localhost.localdomain [127.0.0.1])
	by master.altlinux.ru (Postfix) with ESMTP
	id 89039E31D9; Fri, 19 Mar 2004 18:09:48 +0300 (MSK)
Received: by solemn.turbinal.org (Postfix, from userid 500)
	id 516DC571B2; Fri, 19 Mar 2004 18:07:22 +0300 (MSK)
Date: Fri, 19 Mar 2004 18:07:22 +0300
From: Alexey Tourbin <at@altlinux.ru>
To: zsh-workers@sunsite.dk
Cc: Alexey Voinov <voins@altlinux.ru>
Subject: zsh-4.2.0-pre-4: problems with _remote_files
Message-ID: <20040319150721.GG27221@solemn.turbinal.org>
Mail-Followup-To: zsh-workers@sunsite.dk,
	Alexey Voinov <voins@altlinux.ru>
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="1giRMj6yz/+FOIRq"
Content-Disposition: inline


--1giRMj6yz/+FOIRq
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

Hi!

I've been testing zsh-4.2.0-pre-4 for a while, along with Alexey Voinov.
We've noticed a few problems with _remote_files completion (ssh).

First, Alexey Voinov reports a problem (that I can't reproduce):

$ scp localhost:s<tab>
No matches for: `file' or `remote file'
$ scp altair:<tab>
remote file
RPM@      archive/  tmp/
$

I.e. it says "no matches" or "remote file" (which is not expected), and
the file list is incomplete.

Second, I've noticed that quoting is broken inside _remote_files:

$ cd
$ scp localhost:t<TAB>
tmp/
$ touch \'
$ scp localhost:t<TAB>
<BEEP>
$ rm -f \'
$ scp localhost:t<TAB>
tmp/
$

I believe there were no such problems with zsh-4.1.1.
So I am about to blame the following chunk.
Can't you explain, please?
And thanks,

--=20
Alexey Tourbin
ALT Linux Team


--- zsh-4.1.1/Completion/Unix/Command/_ssh	2003-05-15 09:25:21 +0000
+++ zsh-4.2.0-pre-4/Completion/Unix/Command/_ssh	2004-02-24 13:00:50 +0000
@@ -4,9 +4,9 @@ _remote_files () {
   # There should be coloring based on all the different ls -F classifiers.
   local expl remfiles remdispf remdispd args suf ret=3D1
=20
-  if zstyle -T ":completion:${curcontext}:" remote-access; then
+  if zstyle -T ":completion:${curcontext}:files" remote-access; then
     zparseopts -D -E -a args p: 1 2 4 6 F:
-    remfiles=3D(${(M)${(f)"$(ssh $args -a -x ${IPREFIX%:} ls -d1F ${(Q)PRE=
FIX%%[^./][^/]#}\* 2>/dev/null)"}%%[^/]#(|/)})
+    remfiles=3D(${(M)${(f)"$(_call_program files ssh $args -a -x ${IPREFIX=
%:} ls -d1F ${(Q)PREFIX%%[^./][^/]#}\* 2>/dev/null)"}%%[^/]#(|/)})
     compset -P '*/'
     compset -S '/*' || suf=3D'remote file'
=20

--1giRMj6yz/+FOIRq
Content-Type: application/pgp-signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFAWwypfBKgtDjnu0YRAipvAKCiPaVoMLjq/ZaxB49FZm8ENhUW5QCguEKU
s3z+jgpvldUmUv8nXwNlGHA=
=hTl2
-----END PGP SIGNATURE-----

--1giRMj6yz/+FOIRq--

