From zsh-workers-return-9268-mason-zsh=primenet.com.au@sunsite.auc.dk Sat Jan 08 12:15:03 2000
Return-Path: <zsh-workers-return-9268-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14783 invoked from network); 8 Jan 2000 12:15:02 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 8 Jan 2000 12:15:02 -0000
Received: (qmail 962 invoked by alias); 8 Jan 2000 12:14:55 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9268
Received: (qmail 955 invoked from network); 8 Jan 2000 12:14:55 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer goliath.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "Sven Wischnowsky" <wischnow@informatik.hu-berlin.de>,
        <zsh-workers@sunsite.auc.dk>
Cc: <gene@bear.com>
Subject: Found RE: dev-14: ld.so: Src/zsh: relocation error: symbol not found: nbrbeg
Date: Sat, 8 Jan 2000 15:14:49 +0300
Message-ID: <000601bf59d1$f5f6eaa0$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="koi8-r"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2910.0)
In-reply-To: <200001061409.PAA18367@beta.informatik.hu-berlin.de>
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2919.6600
Importance: Normal

>
> > .zshrc:9: failed to load module: zsh/complete
> >
> > I tried this with two different OS/compiler versions.
> >
> > The message in subject is from dlerror() that I added to try_load_module()
>
> System type? Didn't we have this kind of problem (a dynamically loaded
> module could not get at the symbols of another dynamically loaded
> module) on SunOS4.x?
>


This is due to 9200 + somewhat unusual behaviour of our compiler. 9200 makes
module.c prefer dl.h to dlfcn.h. We do not have /use/include/dl.h but we do have
/usr/include/sys/dl.h (that has nothing to do with dynamic loading at all). Our
compiler does search in both /usr/include and /use/include/sys by default -
hence, AC_CHECK_HEADER finds /usr/include/sys/dl.h. This makes RTLD_*
(RTLD_GLOBAL is important here) be missed. Hence, no symbol from other modules
is ever exported.

In any case, I do not understand the logic here. If dlfcn.h is missing on hpux
11.0, the branch should go under #ifdef HAVE_DL_H and not under #ifdef
HAVE_DLFCN_H.

Could anybody finally suggest reasonable order of include checking here? I
totally fail to understand how patch in 9200 fixed the problem in text.

/andrej

