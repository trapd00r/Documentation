From zsh-workers-return-27497-mason-zsh=primenet.com.au@zsh.org Fri Dec 11 06:34:10 2009
Return-Path: <zsh-workers-return-27497-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21737 invoked by alias); 11 Dec 2009 06:34:10 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 27497
Received: (qmail 3410 invoked from network); 11 Dec 2009 06:34:07 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.7 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received-SPF: none (proxy.melb.primenet.com.au: domain at spodhuis.org does not designate permitted sender hosts)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; d=spodhuis.org; s=d200902;
	h=In-Reply-To:Content-Transfer-Encoding:Content-Type:MIME-Version:References:Message-ID:Subject:Cc:To:From:Date; bh=VGhMCoUZBhY4GirCQEBmrkfgzittMVJUDQDqbWyUbHw=;
	b=ToxoHe0PGkf690FZSX5ST5iDiZtSs0O+D57CB210lzpEo+GUtUwdyv0jFy23nibXwuJ1KRLvyw5uVCQYL7sFVwvDasalB4+gt1Bs1kywZegFn315NUxmwxK+Si1s+vOwzgyYi3E3vqUFTCldJOhDwmrArr9Bl9zfbYvpXSZXsTU=;
Date: Thu, 10 Dec 2009 22:33:55 -0800
From: Phil Pennock <zsh-workers+phil.pennock@spodhuis.org>
To: Vin Shelton <acs@alumni.princeton.edu>
Cc: zsh-workers@zsh.org
Subject: Re: segfault in opensuse-11.2 latest CVS sources
Message-ID: <20091211063355.GA5006@redoubt.spodhuis.org>
Mail-Followup-To: Vin Shelton <acs@alumni.princeton.edu>,
	zsh-workers@zsh.org
References: <20a807210912101737r144e6da0r57d37b489cc00eb0@mail.gmail.com>
 <20a807210912101739k33fd835y737e24317da9c92@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <20a807210912101739k33fd835y737e24317da9c92@mail.gmail.com>

On 2009-12-10 at 20:39 -0500, Vin Shelton wrote:
> It looks like it's crashing in setpwent().  The code in hashtable.c
> seems pretty straightforward.  Have I misconfigured my system somehow?

Yes.  Or your vendor provided a buggy system.

Look at /etc/nsswitch.conf.

Are you using NIS or something, so that you need libnss_compat?  If not,
I'd change s/compat/files/g in the values in /etc/nsswitch.conf and
remove the _compat entries.  One less library probed in every binary
doing any kind of name resolution, one less thing to go wrong.

If you're getting an abort() call inside free() then free() has been
passed a bad memory location, so if this is happening inside setpwent()
then something's very wrong down there.  Perhaps you've removed
nsswitch.conf or you've removed some of its contents.  Perhaps there's a
major platform bug.

But this is almost certainly not a zsh issue.

> Anyway, here's the backtrace:
> 
> #0  0x00007fd7890b04e5 in raise () from /lib64/libc.so.6
> (gdb) bt
> #0  0x00007fd7890b04e5 in raise () from /lib64/libc.so.6
> #1  0x00007fd7890b19b0 in abort () from /lib64/libc.so.6
> #2  0x00007fd7890eb66d in ?? () from /lib64/libc.so.6
> #3  0x00007fd7890f0c76 in ?? () from /lib64/libc.so.6
> #4  0x00007fd7890f596c in free () from /lib64/libc.so.6
> #5  0x00007fd788c6dc2a in ?? () from /lib64/libnsl.so.1
> #6  0x00007fd788c6dd5a in _nsl_default_nss () from /lib64/libnsl.so.1
> #7  0x00007fd788a58b61 in _nss_nis_setpwent () from
> /lib64/libnss_nis.so.2
> #8  0x00007fd788e78514 in ?? () from /lib64/libnss_compat.so.2
> #9  0x00007fd788e78686 in _nss_compat_setpwent () from
> /lib64/libnss_compat.so.2
> #10 0x00007fd789160850 in ?? () from /lib64/libc.so.6
> #11 0x00007fd78911d3fc in setpwent () from /lib64/libc.so.6

Regards,
-Phil

