From zsh-users-return-14238-mason-zsh=primenet.com.au@sunsite.dk Fri Jul 17 09:33:01 2009
Return-Path: <zsh-users-return-14238-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3539 invoked from network); 17 Jul 2009 09:32:57 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 17 Jul 2009 09:32:57 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 21449 invoked from network); 17 Jul 2009 09:32:39 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Jul 2009 09:32:39 -0000
Received: (qmail 8281 invoked by alias); 17 Jul 2009 09:32:06 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 14238
Received: (qmail 8260 invoked from network); 17 Jul 2009 09:32:05 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 17 Jul 2009 09:32:05 -0000
Received: from mail-ew0-f218.google.com (mail-ew0-f218.google.com [209.85.219.218])
	by bifrost.dotsrc.org (Postfix) with ESMTP id DEC278027106
	for <zsh-users@sunsite.dk>; Fri, 17 Jul 2009 11:32:01 +0200 (CEST)
Received: by ewy18 with SMTP id 18so688012ewy.45
        for <zsh-users@sunsite.dk>; Fri, 17 Jul 2009 02:32:00 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=XPsGL+Fd4TS1pJ8emGjBLAmu6PuXBLcnJzMckEB783Q=;
        b=qY6pBjFoI/wmEsoWJwTDfST2vMNJTX8tUqxmCPqJ+dvah96b22SOoPuGJ8vU7zOmhZ
         zED6/QhRfW1RdCSdvnbk0IKfi/GDzFScsSOq9/Z/skGYFNd1fMG3X/Qis8CRLUzHd2PX
         vi8tuID2qCevX49eZeDZMs+VaDSjEE9tHG+bU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=uSlmD5AtXyyU648+boenfybwFAO3bitd8FyiRzfp0m+AtMSZaF4CqWq2OiozDt2Bam
         ey2rTGez2U5HsZAodKtZTCpto1tun9OS7BhX+yiQEYX9pQdFXf97x1WO85/8oTjecHZS
         ewMdJB91WzhJ6xFLCv+0nTQ7IzdzTJUJBto2c=
MIME-Version: 1.0
Received: by 10.210.59.14 with SMTP id h14mr1031749eba.86.1247823120615; Fri, 
	17 Jul 2009 02:32:00 -0700 (PDT)
In-Reply-To: <20090717100656.535be86b@news01>
References: <tkrat.e1ca3b460deca95d@igpm.rwth-aachen.de>
	 <20090717073915.GA15461@miek.nl> <20090717100656.535be86b@news01>
Date: Fri, 17 Jul 2009 11:32:00 +0200
Message-ID: <237967ef0907170232p5abaddebw891f9b7bca1476ab@mail.gmail.com>
Subject: Re: N=5 echo $[N-1] why doesn't it work as expected
From: Mikael Magnusson <mikachu@gmail.com>
To: zsh-users@sunsite.dk
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: ClamAV 0.94.2/9578/Fri Jul 17 07:22:17 2009 on bifrost
X-Virus-Status: Clean

2009/7/17 Peter Stephenson <pws@csr.com>:
> On Fri, 17 Jul 2009 09:39:15 +0200
> Miek Gieben <miek@miek.nl> wrote:
>> [ Quoting Helmut Jarausch in "N=5 echo $[N-1] why doesn't it work"... ]
>> > Hi,
>> >
>> > sorry for this very simple question.
>> >
>> > N=2
>> > N=5 echo $[N-1]
>> > displays 1 - I'd expected 4.
>> > Would anybody please explain why?
>>
>> $N is evaluated first, so it says:
>> N=5 echo $[2-1]
>
> Kind of.  More precisely, the command line "echo $[N-1]" undergoes
> expansion ending up with "echo 1".  At this point, if this was an external
> command, a fork would take place and N=5 would be put permanently into the
> background of the exec'd command---this is the point of the that notation,
> for use inside the guts of the command being executed.  In this case it's a
> shell internal command, so there's no fork, but the shell mimics the
> behaviour with external commands by exporting the value before executing
> the command, and then removing it afterwards.  In both cases it's too late
> to affect expansion.  (So you get the same result with /bin/echo as with
> echo.)
>
> You can force the expansion to take place later with a function:
>
> % fn() { echo $((N-1)) }
> % N=5 fn
> 4
>
> This illustrates what I meant by the value in the environment being "for
> use inside the guts of the command being executed".

I thought of anonymous functions here and tried
N=5 () { echo $((N-1)) }
but I get no result, nothing is printed, and I don't seem to get a
function definition for any of "N", "N=5" or "5", and no error is
returned. It also seems to be illegal to put the expression in front
of a loop of some sort or a subshell or list, ie, N=5 for ... done,
N=5 { ... }, N=5 ( ... ), but at least those print "zsh: parse error
near `foo'".

If I'm not blind, it looks like zshparam(1) doesn't talk about this at
all and it's sort of hard to grep for; where is it documented?

-- 
Mikael Magnusson

