From zsh-workers-request@euclid.skiles.gatech.edu  Mon Aug 26 10:10:18 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by coral.primenet.com.au (8.7.5/8.7.3) with ESMTP id KAA06295 for <mason@primenet.com.au>; Mon, 26 Aug 1996 10:10:16 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id UAA19059; Sun, 25 Aug 1996 20:07:22 -0400 (EDT)
Resent-Date: Sun, 25 Aug 1996 20:07:22 -0400 (EDT)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199608252359.BAA30725@hzoli.ppp.cs.elte.hu>
Subject: Re: Reliable zsh-3.0.0 core dump
To: schaefer@nbn.com
Date: Mon, 26 Aug 1996 01:59:23 +0200 (MET DST)
Cc: zsh-workers@math.gatech.edu
In-Reply-To: <960825121028.ZM13983@candle.brasslantern.com> from Bart Schaefer at "Aug 25, 96 12:10:28 pm"
X-Mailer: ELM [version 2.4ME+ PL17 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"qG_Mm3.0.gf4.vgE8o"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2072
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

> I can't get a core dump either if I use --enable-zsh-mem ... only with
> the system malloc.  I hadn't tried zsh-mem before.

Did you try --enable-zsh-{debug,mem{,-debug},secure-free}?

The patch below fixes a bug which may cause that.  While testing this I
also discovered that pipe synchronization was really necessary.

> BTW, here's a probably-related oddity (vanilla 3.0.0 zsh -f withOUT the
> function above):
> 
> zagzig% set -vx
> zagzig% run-help<ESC h>			<-- cursor imediately after the `p'
> zagzig% run-help run-help
> run-help run-help
> + man run-help
> No manual entry for run-help
> zagzig% run-help <ESC h>		<-- space between `p' and cursor
> zagzig% run-help man
> run-help man
> + man man
> 
> In the second case, the built-in alias of run-help to man expanded before
> help was invoked; in the first case it did not.  I think it should be
> consistent (and I think the first case is how it should work, i.e. don't
> expand the alias, but that's less important).
> 
> Or is this intentional and simply not documented?

It is half-intentional.  When the current word for completion is requested
from the lexer alias expansion is disabled for that word which is good and
reasonable.  The same mechanism is used by run-help.

Zoltan


*** Src/zle_tricky.c	1996/08/23 19:18:43	2.73
--- Src/zle_tricky.c	1996/08/25 23:29:14
***************
*** 3871,3877 ****
--- 3871,3879 ----
      HEAPALLOC {
  	zleparse = 1;
  	lexsave();
+ 	metafy_line();
  	inpush(dupstrspace((char *) line), 0);
+ 	unmetafy_line();
  	strinbeg();
  	pushheap();
  	do {

