From zsh-users-return-13336-mason-zsh=primenet.com.au@sunsite.dk Thu Oct 16 20:13:12 2008
Return-Path: <zsh-users-return-13336-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20447 invoked from network); 16 Oct 2008 20:13:09 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Oct 2008 20:13:09 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 71881 invoked from network); 16 Oct 2008 20:12:53 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Oct 2008 20:12:53 -0000
Received: (qmail 26290 invoked by alias); 16 Oct 2008 20:12:09 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13336
Received: (qmail 26268 invoked from network); 16 Oct 2008 20:12:06 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 16 Oct 2008 20:12:06 -0000
Received: from mail.o2.co.uk (sidious.london.02.net [82.132.130.152])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 7815780524C0
	for <zsh-users@sunsite.dk>; Thu, 16 Oct 2008 22:12:00 +0200 (CEST)
Received: from sc.homeunix.net (78.105.216.138) by mail.o2.co.uk (8.0.013.3) (authenticated as stephane.chazelas)
        id 48BF35C509135E8C; Thu, 16 Oct 2008 21:11:55 +0100
Received: from chazelas by sc.homeunix.net with local (Exim 4.69)
	(envelope-from <stephane_chazelas@yahoo.fr>)
	id 1KqZCM-0007Vq-6b; Thu, 16 Oct 2008 21:11:54 +0100
Date: Thu, 16 Oct 2008 21:11:54 +0100
From: Stephane Chazelas <Stephane_Chazelas@yahoo.fr>
To: czech@sonic.net
Cc: zsh-users@sunsite.dk
Subject: Re: Creating function in zsh
Message-ID: <20081016201154.GC4773@sc.homeunix.net>
Mail-Followup-To: czech@sonic.net, zsh-users@sunsite.dk
References: <5956.148.87.1.170.1224187179.squirrel@webmail.sonic.net>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-15
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <5956.148.87.1.170.1224187179.squirrel@webmail.sonic.net>
User-Agent: Mutt/1.5.16 (2007-09-19)
X-Virus-Scanned: ClamAV 0.92.1/8435/Thu Oct 16 19:00:44 2008 on bifrost
X-Virus-Status: Clean

On Thu, Oct 16, 2008 at 12:59:39PM -0700, czech@sonic.net wrote:
> Hi -
> 
> I have created the following function in zsh on Mac OSX:
> 
> cd() {
>     builtin cd "$@" print -D $PWD
> }
> 
> This works find on OSX, but gives the following error on Fedora Core 8:
> 
> johann:czechar:.zfunc> cd /home/czechar
> cd /home/czechar
> cd:cd:1: too many arguments
> 
> I am running zsh 4.2.6 on Fedora.
> 
> Any notion what the problem could be?
[...]

I doubt it works on MaxOSX. You're not separating the two
commands, so "print", "-D" and $PWD are treated as arguments to
"builtin cd".

cd() {
  builtin cd "$@" &&
    print -rD $PWD
}

"&&" as you probably want to print the current directory only if
cd succeeds.

You need -r, as you don't want \x sequences to be expanded.

If you want to print the directory regardless of whether cd
succeeds, you should at least make sure you return cd's exit
status:

cd() {
  local ret
  builtin cd "$@"
  ret=$?
  print -rD $PWD
  return $ret
}

-- 
Stéphane

