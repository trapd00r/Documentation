From zsh-workers-return-21719-mason-zsh=primenet.com.au@sunsite.dk Fri Sep 09 14:51:17 2005
Return-Path: <zsh-workers-return-21719-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18069 invoked from network); 9 Sep 2005 14:51:14 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 9 Sep 2005 14:51:14 -0000
Received: (qmail 52147 invoked from network); 9 Sep 2005 14:51:08 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 Sep 2005 14:51:08 -0000
Received: (qmail 27487 invoked by alias); 9 Sep 2005 14:51:06 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21719
Received: (qmail 27472 invoked from network); 9 Sep 2005 14:51:05 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 9 Sep 2005 14:51:05 -0000
Received: (qmail 51900 invoked from network); 9 Sep 2005 14:51:05 -0000
Received: from mailhost1.csr.com (HELO MAILSWEEPER01.csr.com) (81.105.217.43)
  by a.mx.sunsite.dk with SMTP; 9 Sep 2005 14:50:57 -0000
Received: from exchange03.csr.com (unverified [10.100.137.60]) by 
    MAILSWEEPER01.csr.com (Content Technologies SMTPRS 4.3.12) with ESMTP id 
    <T7347fbbea60a6c8d012dc@MAILSWEEPER01.csr.com> for 
    <zsh-workers@sunsite.dk>; Fri, 9 Sep 2005 15:48:39 +0100
Received: from news01 ([10.103.143.38]) by exchange03.csr.com with Microsoft 
    SMTPSVC (5.0.2195.6713); Fri, 9 Sep 2005 15:52:02 +0100
Date: Fri, 9 Sep 2005 15:50:55 +0100
From: Peter Stephenson <pws@csr.com>
To: zsh-workers@sunsite.dk
Subject: Re: zsh 4.2.5 compile problem on AIX
Message-Id: <20050909155055.12408b26.pws@csr.com>
In-Reply-To: <43218EAE.5060009@davidfavor.com>
References: <43218EAE.5060009@davidfavor.com>
Organization: Cambridge Silicon Radio
X-Mailer: Sylpheed version 0.9.12 (GTK+ 1.2.10; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 09 Sep 2005 14:52:02.0296 (UTC) 
    FILETIME=[0997FF80:01C5B54E]
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.4

David Favor <david@davidfavor.com> wrote:
> I've built many version of zsh for AIX including 4.2.0
> which I'm currently running. This appears to be a new
> problem.
> 
> Building zsh-4.2.5 on AIX 5100-08 the following shows up:
> 
>     gmake[2]: Entering directory `/data/build/work/zsh-4.2.5/Src/Zle'
>     rm -f complete.so
>     xlc_r -s -bM:SRE -o complete.so -bI:zle.export -bI:../../Src/zsh.export \
>        -bE:complete.export -emodentry complete..o compcore..o compmatch..o \
>        compresult..o  ../../Src/modentry..o  -L/usr/local/lib -lpcre -liconv \
>        -ldl -lcurses -lm  -lc
>     ld: 0711-317 ERROR: Undefined symbol: nullstrsetfn

Thanks for spotting this:  there is a perennial problem with AIX which is
particularly finnicky about the declaration of symbols used in a library.
There's a script Util/check_exports which I should run before making a
release.  Here's a fix for 4.2; I'll commit the change for 4.3 directly.

Index: Src/builtin.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/builtin.c,v
retrieving revision 1.133.2.1
diff -u -r1.133.2.1 builtin.c
--- Src/builtin.c	25 Apr 2005 10:40:54 -0000	1.133.2.1
+++ Src/builtin.c	9 Sep 2005 14:47:27 -0000
@@ -4041,7 +4041,7 @@
 
 /* Flag that we should exit the shell as soon as all functions return. */
 /**/
-int
+mod_export int
 exit_pending;
 
 /* break, bye, continue, exit, logout, return -- most of these take   *
Index: Src/params.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/params.c,v
retrieving revision 1.94.2.3
diff -u -r1.94.2.3 params.c
--- Src/params.c	6 Sep 2005 15:28:40 -0000	1.94.2.3
+++ Src/params.c	9 Sep 2005 14:47:28 -0000
@@ -2608,7 +2608,7 @@
  */
 
 /**/
-void
+mod_export void
 nullstrsetfn(UNUSED(Param pm), char *x)
 {
     zsfree(x);


-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

**********************************************************************

