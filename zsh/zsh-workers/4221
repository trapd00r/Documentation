From zsh-workers-request@math.gatech.edu Thu Jul 09 23:51:00 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6085 invoked from network); 9 Jul 1998 23:50:58 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 9 Jul 1998 23:50:58 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id TAA00299;
	Thu, 9 Jul 1998 19:26:22 -0400 (EDT)
Resent-Date: Thu, 9 Jul 1998 19:26:22 -0400 (EDT)
Date: Thu, 9 Jul 1998 19:27:35 -0400
Message-Id: <199807092327.TAA09675@bobcat.eng.pgh.lycos.com.>
From: Gray Watson <gray@bobcat.eng.pgh.lycos.com>
To: zsh-workers@math.gatech.edu
Subject: compiling 3.1.4 on dux 4.0D and solaris 2.5.1
Reply-to: gwatson@lycos.com
Resent-Message-ID: <"UImr.0.a4.T6Lfr"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4221
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

First off, thanks for a great shell.  Been using it since I did a rm
-rf on my tcsh source tree in disgust many years ago.

Below are my comments while building 3.1.4.

gray

-------------------------------------------------------------------------------

1) There is a bug in the top Makefile with an extra ;\ there.  Patch
follows.

2) The following Makefile code which is used often in the 3.1.4
Makefiles does not work on some Unixes: DUX 4.0D and Solaris 2.5.1 for
starters.

       @if test -n '$(SUBDIRS)'; then \
	  target=`echo $@ | sed s/-recursive//`; \
	  for subdir in $(SUBDIRS) ; do \
	    (cd $$subdir && $(MAKE) $(MAKEDEFS) $$target) || exit 1; \
	  done; \
	fi

	I've included patches to config.mk and clean.mk below.  I'm
	not sure if it is the best way to fix the problems.

3) Also, my DUX 4.0D compiler complains about signal.h:

	cc: Warning: mem.c, line 289: In this statement, the
		expression "queue_front=++queue_front%16" modifies the
		variable "queue_front" more than once without an
		intervening sequence point.  This behavior is
		undefined.

	I've included patch to clean this code up as well.

4) All of the Makefiles complain 'No suffix list' on DUX if there is a
blank suffix list there.  Don't know if this is a feature or a bug.

-------------------------------------------------------------------------------

*** Makefile.in.ORG	Thu Jul  9 19:09:21 1998
--- Makefile.in	Thu Jul  9 19:22:18 1998
***************
*** 36,42 ****
  all: config.h
  	@for subdir in Src Doc; do \
  	  (cd $$subdir && $(MAKE) $(MAKEDEFS) $@) || exit 1; \
! 	done; \
  
  check test:
  	@echo zsh test suite not available yet
--- 36,42 ----
  all: config.h
  	@for subdir in Src Doc; do \
  	  (cd $$subdir && $(MAKE) $(MAKEDEFS) $@) || exit 1; \
! 	done
  
  check test:
  	@echo zsh test suite not available yet
*** Config/clean.mk.ORG	Wed Apr 29 17:35:38 1998
--- Config/clean.mk	Thu Jul  9 19:12:24 1998
***************
*** 37,43 ****
  mostlyclean-recursive clean-recursive distclean-recursive realclean-recursive:
  	@if test -n '$(SUBDIRS)'; then \
  	  target=`echo $@ | sed s/-recursive//`; \
! 	  for subdir in $(SUBDIRS); do \
! 	    (cd $$subdir && $(MAKE) $(MAKEDEFS) $$target) || exit 1; \
  	  done; \
  	fi
--- 37,45 ----
  mostlyclean-recursive clean-recursive distclean-recursive realclean-recursive:
  	@if test -n '$(SUBDIRS)'; then \
  	  target=`echo $@ | sed s/-recursive//`; \
! 	  for subdir in $(SUBDIRS) . ; do \
! 	    if test $$subdir != . ; then \
! 	      (cd $$subdir && $(MAKE) $(MAKEDEFS) $$target) || exit 1; \
! 	    fi; \
  	  done; \
  	fi
*** Config/config.mk.ORG	Wed Apr 29 17:35:40 1998
--- Config/config.mk	Thu Jul  9 19:13:04 1998
***************
*** 26,33 ****
  
  config: Makefile
  	@if test -n '$(SUBDIRS)'; then \
! 	  for subdir in $(SUBDIRS); do \
! 	    (cd $$subdir && $(MAKE) $(MAKEDEFS) $@) || exit 1; \
  	  done; \
  	fi
  
--- 26,35 ----
  
  config: Makefile
  	@if test -n '$(SUBDIRS)'; then \
! 	  for subdir in $(SUBDIRS) . ; do \
! 	    if test $$subdir != . ; then \
! 	      (cd $$subdir && $(MAKE) $(MAKEDEFS) $@) || exit 1; \
! 	    fi; \
  	  done; \
  	fi
  
*** Src/signals.h.ORG	Thu Jul  9 19:15:27 1998
--- Src/signals.h	Thu Jul  9 19:16:00 1998
***************
*** 85,91 ****
      if (!--queueing_enabled) { \
  	while (queue_front != queue_rear) {      /* while signals in queue */ \
  	    sigset_t oset; \
! 	    queue_front = ++queue_front % MAX_QUEUE_SIZE; \
  	    oset = signal_setmask(signal_mask_queue[queue_front]); \
  	    handler(signal_queue[queue_front]);  /* handle queued signal   */ \
  	    signal_setmask(oset); \
--- 85,91 ----
      if (!--queueing_enabled) { \
  	while (queue_front != queue_rear) {      /* while signals in queue */ \
  	    sigset_t oset; \
! 	    queue_front = (queue_front + 1) % MAX_QUEUE_SIZE; \
  	    oset = signal_setmask(signal_mask_queue[queue_front]); \
  	    handler(signal_queue[queue_front]);  /* handle queued signal   */ \
  	    signal_setmask(oset); \

