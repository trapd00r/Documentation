From zsh-workers-return-8062-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Sep 27 13:17:41 1999
Return-Path: <zsh-workers-return-8062-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16889 invoked from network); 27 Sep 1999 13:17:40 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 27 Sep 1999 13:17:40 -0000
Received: (qmail 1251 invoked by alias); 27 Sep 1999 13:17:28 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8062
Received: (qmail 1242 invoked from network); 27 Sep 1999 13:17:28 -0000
Date: Mon, 27 Sep 1999 14:17:24 +0100
From: Adam Spiers <adam@thelonious.new.ox.ac.uk>
To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Subject: PATCH: _man copes with : delimited manpath
Message-ID: <19990927141724.B10336@thelonious.new.ox.ac.uk>
Reply-To: Adam Spiers <adam@spiers.net>
Mail-Followup-To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 1.0pre2i
X-URL: http://www.new.ox.ac.uk/~adam/
X-OS: Linux 2.2.9 i686

On my system, `manpath' generates colon-delimited paths, rather than
space-delimited ones.  This patch solves that problem.  It also fixes
what I think is a typo, but someone should check this.

Index: Completion/User/_man
===================================================================
RCS file: /usr/local/cvsroot/zsh/Completion/User/_man,v
retrieving revision 1.1.1.4
diff -u -r1.1.1.4 _man
--- Completion/User/_man	1999/09/21 12:17:47	1.1.1.4
+++ Completion/User/_man	1999/09/27 01:14:03
@@ -14,12 +14,18 @@
   approx="(#a${_comp_correct})"
 fi
 
-(( $#manpath )) || manpath=$(manpath 2>/dev/null) ||
+if (( ! $#manpath )); then
+  local mp=$(manpath 2>/dev/null)
+  [[ "$mp" == *:* ]] && mp=( ${(s.:.)mp} )
+  manpath=( $mp )
+fi
+
+(( $#manpath )) ||
   manpath=( /usr/man(-/N) /(opt|usr)/(dt|share|X11R6|local)/(cat|)man(-/N) )
 
 # `sman' is the SGML manual directory for Solaris 7.
 
-if [[ $words[2] = (<->*|ln) ]]; then
+if [[ $words[2] = (<->*|l|n) ]]; then
   rep=(
   $manpath/(sman|man|cat)${words[2]}/${~approx}$PREFIX${~star}$SUFFIX.<->*(N:t) )
 else

