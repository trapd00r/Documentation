From zsh-workers-return-8601-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Nov 09 10:54:41 1999
Return-Path: <zsh-workers-return-8601-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1048 invoked from network); 9 Nov 1999 10:54:40 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 9 Nov 1999 10:54:40 -0000
Received: (qmail 14985 invoked by alias); 9 Nov 1999 10:54:25 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8601
Received: (qmail 14977 invoked from network); 9 Nov 1999 10:54:19 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <991109105326.ZM13606@candle.brasslantern.com>
Date: Tue, 9 Nov 1999 10:53:26 +0000
In-Reply-To: <199911090858.JAA20837@beta.informatik.hu-berlin.de>
Comments: In reply to Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
        "Re: PATCH: _whois" (Nov  9,  9:58am)
References: <199911090858.JAA20837@beta.informatik.hu-berlin.de>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: Re: PATCH: _whois
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Nov 9,  9:58am, Sven Wischnowsky wrote:
} Subject: Re: PATCH: _whois
}
} (patch-readers will notice that there even is some
} redundancy in this patch, trying to avoid getting this bug again
} later).

I always experience some ambivalence about this sort of thing:

} +    if (s) {
} +	char *os = s, *p = compqstack;
[...]
} +	return (s == os ? dupstring(s) : s);
}      }
} -    return (s == os ? dupstring(s) : s);
} +    return NULL;
}  }
}  
}  /**/
}  char *
}  tildequote(char *s, int ign)
}  {
} -    int tilde;
} +    if (s) {
} +	int tilde;
[...]
} +	return s;
} +    }
} +    return NULL;
}  }

On the one hand, it's never good for the shell to crash.

On the other hand, too much of this kind of "defensive programming" can
conceal the actual source of the error, leading to other, more confusing
failures in other places; cause bugs to go unfixed; and slow down the
execution with redundant error checking.

So it would seem to me that there should at least be a DPUTS() in there,
to mitigate the first couple of those effects.

Index: compcore.c
===================================================================
RCS file: /extra/cvsroot/zsh/zsh-3.1/Src/Zle/compcore.c,v
retrieving revision 1.8
diff -c -r1.8 compcore.c
--- compcore.c	1999/11/09 10:48:22	1.8
+++ compcore.c	1999/11/09 10:51:14
@@ -938,6 +938,7 @@
 	}
 	return (s == os ? dupstring(s) : s);
     }
+    DPUTS(1, "BUG: null pointer in multiquote()");
     return NULL;
 }
 
@@ -956,6 +957,7 @@
 
 	return s;
     }
+    DPUTS(1, "BUG: null pointer in tildequote()");
     return NULL;
 }
 

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

