From zsh-users-return-12034-mason-zsh=primenet.com.au@sunsite.dk Wed Oct 17 15:07:34 2007
Return-Path: <zsh-users-return-12034-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5412 invoked from network); 17 Oct 2007 15:07:24 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,HTML_MESSAGE
	autolearn=ham version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 17 Oct 2007 15:07:24 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 77898 invoked from network); 17 Oct 2007 15:07:18 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Oct 2007 15:07:18 -0000
Received: (qmail 15734 invoked by alias); 17 Oct 2007 15:07:10 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12034
Received: (qmail 15719 invoked from network); 17 Oct 2007 15:07:09 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 17 Oct 2007 15:07:09 -0000
Received: (qmail 76667 invoked from network); 17 Oct 2007 15:07:09 -0000
Received: from smtphost.cis.strath.ac.uk (130.159.196.96)
  by a.mx.sunsite.dk with SMTP; 17 Oct 2007 15:07:03 -0000
Received: from [130.159.185.46] (ws-mac-sinclair.cis.strath.ac.uk [130.159.185.46])
	(authenticated bits=0)
	by smtphost.cis.strath.ac.uk (8.13.4/8.13.4/Debian-3sarge3) with ESMTP id l9HF6vOa013325
	(version=TLSv1/SSLv3 cipher=AES128-SHA bits=128 verify=NOT)
	for <zsh-users@sunsite.dk>; Wed, 17 Oct 2007 16:06:57 +0100
Mime-Version: 1.0 (Apple Message framework v752.2)
In-Reply-To: <dbfc82860710170624l1cbba6a2qdf01bd6296297695@mail.gmail.com>
References: <200710081338.l98Dc2br012284@news01.csr.com> <20071008151949.GA18576@mastermind> <dbfc82860710080830r289c962eyde18f1564e7f0de0@mail.gmail.com> <20071008154632.GB18576@mastermind> <dbfc82860710081532m5672197crf568b7d120ab192f@mail.gmail.com> <071008184445.ZM25513@torch.brasslantern.com> <20071009015814.GA21038@mastermind> <2d460de70710170416i10627e1epc1f20811bc62859e@mail.gmail.com> <20071017114751.GB13054@mastermind> <2d460de70710170507j2317dab0r1440591912773b41@mail.gmail.com> <dbfc82860710170624l1cbba6a2qdf01bd6296297695@mail.gmail.com>
Content-Type: multipart/alternative; boundary=Apple-Mail-13--421948186
Message-Id: <470D9DAB-817B-45D1-86EF-B4F0445A5A28@cis.strath.ac.uk>
From: Duncan Sinclair <Duncan.Sinclair@cis.strath.ac.uk>
Subject: Re: Failing to write to history file if containing directory doesn't exist
Date: Wed, 17 Oct 2007 16:06:56 +0100
To: zsh-users@sunsite.dk
X-Mailer: Apple Mail (2.752.2)
X-CIS-MailScanner: Found to be clean
X-CIS-MailScanner-SpamCheck: not spam (whitelisted),
	SpamAssassin (score=0.001, required 6, autolearn=disabled,
	HTML_MESSAGE 0.00)
X-CIS-MailScanner-From: duncan.sinclair@cis.strath.ac.uk


--Apple-Mail-13--421948186
Content-Transfer-Encoding: 7bit
Content-Type: text/plain;
	charset=US-ASCII;
	delsp=yes;
	format=flowed

>> An easy, light and scriptable solution that solves 99% of all  
>> cases has
>> already been hinted at:
>>
>> export HISTDIR=foo
>> mkdir -p $HISTDIR || echo 'Woe is me!'
>> export HISTFILE=$HISTDIR/bar
>
> I'm sorry, but how does it solve 99% of all cases?  There are two  
> cases:
>
> 1.  $HISTFILE:h exists when writing $HISTFILE
> 2.  $HISTFILE:h does not exist when writing $HISTFILE
>
> The above solution makes case 1 more likely, sure, but it doesn't  
> solve case 2.

I think that the proposed code to create directories violates the  
principle of least surprise, and should not be included in the  
standard zsh distribution.

The reality is that in 99.99% of cases $HISTFILE:h is going to be  
someone's home directory.  If that doesn't exist you're pretty much  
screwed anyway.

Then in the 0.01% of cases where people put their $HISTFILE  
elsewhere, the code above, placed in their .zshenv file will work  
99.99% of the time.

So I'd say that 99.9999% of cases are covered.

In other words, it's a one in a million thing.


-- 
Duncan Sinclair  |  {+44|0}141 548 3095  |  cis.strath.ac.uk
System Administrator
Computer and Information Sciences
University of Strathclyde




--Apple-Mail-13--421948186
Content-Transfer-Encoding: quoted-printable
Content-Type: text/html;
	charset=ISO-8859-1

<html><body style=3D"word-wrap: break-word; -webkit-nbsp-mode: space; =
-webkit-line-break: after-white-space; ">
<div><blockquote type=3D"cite"><blockquote type=3D"cite"><div =
style=3D"margin-top: 0px; margin-right: 0px; margin-bottom: 0px; =
margin-left: 0px; ">An easy, light and scriptable solution that solves =
99% of all cases has</div><div style=3D"margin-top: 0px; margin-right: =
0px; margin-bottom: 0px; margin-left: 0px; ">already been hinted =
at:</div><div style=3D"margin-top: 0px; margin-right: 0px; =
margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div =
style=3D"margin-top: 0px; margin-right: 0px; margin-bottom: 0px; =
margin-left: 0px; ">export HISTDIR=3Dfoo</div><div style=3D"margin-top: =
0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">mkdir -p =
$HISTDIR || echo 'Woe is me!'</div><div style=3D"margin-top: 0px; =
margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">export =
HISTFILE=3D$HISTDIR/bar</div> </blockquote><div style=3D"margin-top: =
0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; =
min-height: 14px; "><br></div><div style=3D"margin-top: 0px; =
margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">I'm sorry, =
but how does it solve 99% of all cases?<span =
class=3D"Apple-converted-space">=A0 </span>There are two =
cases:</div><div style=3D"margin-top: 0px; margin-right: 0px; =
margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div =
style=3D"margin-top: 0px; margin-right: 0px; margin-bottom: 0px; =
margin-left: 0px; ">1.<span class=3D"Apple-converted-space">=A0 =
</span>$HISTFILE:h exists when writing $HISTFILE</div><div =
style=3D"margin-top: 0px; margin-right: 0px; margin-bottom: 0px; =
margin-left: 0px; ">2.<span class=3D"Apple-converted-space">=A0 =
</span>$HISTFILE:h does not exist when writing $HISTFILE</div><div =
style=3D"margin-top: 0px; margin-right: 0px; margin-bottom: 0px; =
margin-left: 0px; min-height: 14px; "><br></div><div style=3D"margin-top: =
0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">The =
above solution makes case 1 more likely, sure, but it doesn't solve case =
2.</div> </blockquote><br></div><div>I think that the proposed code to =
create directories violates the principle of least surprise, and should =
not be included in the standard zsh distribution.=A0</div><div><br =
class=3D"webkit-block-placeholder"></div><div>The reality is that in =
99.99% of cases $HISTFILE:h is going to be someone's home directory. =A0If=
 that doesn't exist you're pretty much screwed anyway.</div><div><br =
class=3D"webkit-block-placeholder"></div><div>Then in the 0.01% of cases =
where people put their $HISTFILE elsewhere, the code above, placed in =
their .zshenv file will work 99.99% of the time.</div><div><br =
class=3D"webkit-block-placeholder"></div><div>So I'd say that 99.9999% =
of cases are covered.</div><div><br =
class=3D"webkit-block-placeholder"></div><div>In other words, it's a one =
in a million thing.</div><div><br =
class=3D"webkit-block-placeholder"></div><div><br></div><div> <span =
class=3D"Apple-style-span" style=3D"border-collapse: separate; =
border-spacing: 0px 0px; color: rgb(0, 0, 0); font-family: Helvetica; =
font-size: 12px; font-style: normal; font-variant: normal; font-weight: =
normal; letter-spacing: normal; line-height: normal; text-align: auto; =
-khtml-text-decorations-in-effect: none; text-indent: 0px; =
-apple-text-size-adjust: auto; text-transform: none; orphans: 2; =
white-space: normal; widows: 2; word-spacing: 0px; =
"><div>--=A0</div><div>Duncan Sinclair=A0 |=A0 {+44|0}141 548 3095=A0 |=A0=
 cis.strath.ac.uk</div><div>System Administrator</div><div>Computer and =
Information Sciences</div><div>University of =
Strathclyde</div><div><br></div><br =
class=3D"Apple-interchange-newline"></span> </div><br></body></html>=

--Apple-Mail-13--421948186--

