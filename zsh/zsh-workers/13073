From zsh-workers-return-13073-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Oct 24 14:34:09 2000
Return-Path: <zsh-workers-return-13073-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3921 invoked from network); 24 Oct 2000 14:34:06 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 24 Oct 2000 14:34:06 -0000
Received: (qmail 6017 invoked by alias); 24 Oct 2000 14:33:55 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 13073
Received: (qmail 5973 invoked from network); 24 Oct 2000 14:33:54 -0000
To: zsh-workers@sunsite.auc.dk
Path: mason
From: mason@primenet.com.au (Geoff Wing)
X-Newsgroups: lists.zsh.workers
Subject: bug with completion (after 15 oct?)
Date: 24 Oct 2000 14:33:47 GMT
Organization: PrimeNet Computer Consultants
Lines: 64
Distribution: local
Message-ID: <slrn8vb7eb.3nh.mason@coral.primenet.com.au>
Reply-To: mason@primenet.com.au
NNTP-Posting-Host: coral.primenet.com.au
X-Trace: coral.primenet.com.au 972398027 3826 203.43.15.2 (24 Oct 2000 14:33:47 GMT)
X-Complaints-To: usenet@coral.primenet.com.au
NNTP-Posting-Date: 24 Oct 2000 14:33:47 GMT
User-Agent: slrn/0.9.6.3 (NetBSD)

Heyla,
am currently investigating a bug with completion which manifested in the
last week or so:

% zsh.new -f
% cd /tmp; mkdir foo; cd foo; touch bar baz
% ls ba<TAB>	# <TAB><RETURN> or CTRL-U or whatever
bar baz
% ls ba<TAB>	# OK
% exit
% zsh.new
% cd /tmp
% ls ba<TAB>	# <TAB><RETURN> or CTRL-U or whatever
--> completing file
bar   baz
% ls ba<TAB>
zsh: 20301 segmentation fault (core dumped)  zsh.new

A backtrace gives the following - maybe it's useful to someone - but I'll
try to narrow it down to a set of initialisation options.
Hmm, what's worse is that a version compiled --disable-dynamic sometimes
gives a segv a bit later (line 1034).

0x80af60b in compprintlist (showall=0) at complist.c:1023
1023            char **pp = g->ylist;
(gdb) p *lastg
$1 = {name = 0x0, prev = 0x0, next = 0x2, flags = 135607944, mcount = 2, 
  matches = 0x0, lcount = 0, llcount = 1, ylist = 0x8157fc8, ecount = 0, 
  expls = 0x0, ccount = 0, lexpls = 0x0, lmatches = 0x0, lfmatches = 0x1, 
  lallccs = 0x0, num = 0, nbrbeg = 0, nbrend = 2, new = 2, dcount = 1, 
  cols = 6, lins = 0, width = 12, widths = 0x6, totl = 0, shortest = 80, 
  perm = 0x0}
(gdb) bt
#0  0x80af60b in compprintlist (showall=0) at complist.c:1023
#1  0x80b0e6a in complistmatches (dummy=0x80dc2f4, dat=0xbfbfd504)
    at complist.c:1575
#2  0x8072666 in runhookdef (h=0x80dc2f4, d=0xbfbfd504) at module.c:1835
#3  0x80ad4d8 in list_matches (dummy=0x80df6e4, dummy2=0x0)
    at compresult.c:2080
#4  0x8072666 in runhookdef (h=0x80df6e4, d=0x0) at module.c:1835
#5  0x80c309a in zrefresh () at zle_refresh.c:607
#6  0x80b2817 in domenuselect (dummy=0x80dc2b8, dat=0xbfbfd654)
    at complist.c:2271
#7  0x807263f in runhookdef (h=0x80dc2b8, d=0xbfbfd654) at module.c:1829
#8  0x80a09f2 in after_complete (dummy=0x80df720, dat=0xbfbfd6b4)
    at compcore.c:496
#9  0x8072666 in runhookdef (h=0x80df720, d=0xbfbfd6b4) at module.c:1835
#10 0x80c6236 in docomplete (lst=0) at zle_tricky.c:786
#11 0x80c54d7 in expandorcomplete (args=0x80df674) at zle_tricky.c:282
#12 0x80c520d in completecall (args=0x80df674) at zle_tricky.c:176
#13 0x80be7d9 in execzlefunc (func=0x80dd620, args=0x80df674) at zle_main.c:655
#14 0x80be4d1 in zleread (lp=0x80ed4d0 "%b%s%u%m:%B%3c%b%# %B", 
    rp=0x80ed428 "%b%?:2:%h:%l %B%D{%R}%b", flags=3) at zle_main.c:567
#15 0x806519f in inputline () at input.c:265
#16 0x80650e1 in ingetc () at input.c:210
#17 0x805f8f5 in ihgetc () at hist.c:236
#18 0x80689f7 in gettok () at lex.c:628
#19 0x8068346 in yylex () at lex.c:344
#20 0x80786c6 in parse_event () at parse.c:425
#21 0x8062f56 in loop (toplevel=1, justonce=0) at init.c:123
#22 0x8064e6f in zsh_main (argc=1, argv=0xbfbfd85c) at init.c:1197
#23 0x804a6e6 in main (argc=1, argv=0xbfbfd85c) at ./main.c:37
#24 0x804a491 in ___start ()

