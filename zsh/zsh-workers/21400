From zsh-workers-return-21400-mason-zsh=primenet.com.au@sunsite.dk Sat Jul 02 12:17:46 2005
Return-Path: <zsh-workers-return-21400-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6897 invoked from network); 2 Jul 2005 12:17:45 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 2 Jul 2005 12:17:45 -0000
Received: (qmail 65952 invoked from network); 2 Jul 2005 12:17:39 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 2 Jul 2005 12:17:39 -0000
Received: (qmail 25852 invoked by alias); 2 Jul 2005 12:17:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21400
Received: (qmail 25842 invoked from network); 2 Jul 2005 12:17:36 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 2 Jul 2005 12:17:36 -0000
Received: (qmail 65677 invoked from network); 2 Jul 2005 12:17:36 -0000
Received: from mail-ihug.icp-qv1-irony1.iinet.net.au (203.59.1.195)
  by a.mx.sunsite.dk with SMTP; 2 Jul 2005 12:17:32 -0000
Received: from 203-206-244-150.dyn.iinet.net.au (HELO localhost.localdomain) (203.206.244.150)
  by mail-ihug.icp-qv1-irony1.iinet.net.au with ESMTP; 02 Jul 2005 20:11:49 +0800
X-BrightmailFiltered: true
X-Brightmail-Tracker: AAAAAA==
X-IronPort-AV: i="3.93,252,1114963200"; 
   d="scan'208"; a="12007348:sNHT15439452"
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.12.8/8.12.8) with ESMTP id j62CAt3o021517
	for <zsh-workers@sunsite.dk>; Sat, 2 Jul 2005 22:11:04 +1000
Received: (from doug@localhost)
	by localhost.localdomain (8.12.8/8.12.8/Submit) id j62CAkno021515
	for zsh-workers@sunsite.dk; Sat, 2 Jul 2005 22:10:46 +1000
X-Authentication-Warning: localhost.localdomain: doug set sender to dougkearns@gmail.com using -f
Date: Sat, 2 Jul 2005 22:10:46 +1000
From: Doug Kearns <dougkearns@gmail.com>
To: zsh-workers@sunsite.dk
Subject: PATCH: completion for ruby env variables
Message-ID: <20050702121046.GA9557@localhost.localdomain>
Mail-Followup-To: zsh-workers@sunsite.dk
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4i
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.4

This adds completion for RUBYOPT, RUBYPATH, and RUBYLIB

Regards,
Doug


Index: Completion/Unix/Command/_ruby
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_ruby,v
retrieving revision 1.4
diff -u -r1.4 _ruby
--- Completion/Unix/Command/_ruby	21 Jan 2004 13:53:29 -0000	1.4
+++ Completion/Unix/Command/_ruby	2 Jul 2005 12:08:06 -0000
@@ -1,13 +1,30 @@
-#compdef ruby
+#compdef ruby -P -value-,RUBY(LIB|OPT|PATH),-default-
 
 # ruby 1.8.0 (2003-08-14) [i686-linux]
 
-local expl curcontext="$curcontext" line state ret=1
+local curcontext="$curcontext" state line expl ret=1
 typeset -A opt_args
-local dirs
+
+local -a args
+args=(
+  '(-)1:script file:->script'
+  '*::script argument: _normal'
+)
+
+case "$service" in
+  *RUBY(LIB|PATH)*)
+    _dir_list && return 0
+  ;;
+  *RUBYOPT*)
+    compset -q
+    words=( fake "$words[@]" )
+    (( CURRENT++ ))
+    args=()
+  ;;
+esac
 
 _arguments -C -s -S \
-  '-0-[specify record separator]:input record separator in octal (default\: \0):' \
+  '-0-[specify record separator]:input record separator in octal (default \0):' \
   '-a[autosplit mode with -n or -p (splits $_ into $F)]' \
   '-c[check syntax only]' \
   '-C+[cd to directory, before executing your script]:directory:_files -/' \
@@ -23,20 +40,20 @@
   '*-r+[require the library, before executing your script]:library name:->library' \
   '-s[enable some switch parsing for switches after script name]' \
   '-S[look for the script using PATH environment variable]' \
-  '-T-[turn on tainting checks]:taint level (default\: 0):((0\:strings\ from\ streams/environment/ARGV\ are\ tainted 1\:no\ dangerous\ operation\ by\ tainted\ value 2\:process/file\ operations\ prohibited 3\:all\ generated\ objects\ are\ tainted 4\:no\ global\ \(non-tainted\)\ variable\ modification/no\ direct\ output))' \
+  '-T-[turn on tainting checks]:taint level (default 0):((0\:strings\ from\ streams/environment/ARGV\ are\ tainted 1\:no\ dangerous\ operation\ by\ tainted\ value 2\:process/file\ operations\ prohibited 3\:all\ generated\ objects\ are\ tainted 4\:no\ global\ \(non-tainted\)\ variable\ modification/no\ direct\ output))' \
   '(-v --verbose)'{-v,--verbose}'[print version number, then turn on verbose mode]' \
   '-w[turn warnings on for your script]' \
-  '-W-[set warning level]:warning level (default\: 2):((0\:silent 1\:medium 2\:verbose))' \
+  '-W-[set warning level]:warning level (default 2):((0\:silent 1\:medium 2\:verbose))' \
   '(-y --yydebug)'{-y,--yydebug}'[enable yacc debugging in the parser]' \
   '-x-[strip off text before #!ruby line and perhaps cd to directory]:directory:_files -/' \
   '(1 * -)--copyright[print the copyright]' \
   '(1 * -)'{-h,--help}'[print help message]' \
   '(1 * -)--version[print the version]' \
-  '(-)1:script file:_files -g "*.rb(-.)"' \
-  '*:script argument:_files' && ret=0
+  "$args[@]" && ret=0
 
 case $state in
   library)
+    local -a dirs
     dirs=($(_call_program directories $words[1] -e 'puts\ \$:'))
     _wanted directories expl library _path_files -W dirs && ret=0
   ;;

