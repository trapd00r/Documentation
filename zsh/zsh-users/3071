From zsh-users-return-3071-mason-zsh=primenet.com.au@sunsite.auc.dk Fri May 19 18:18:46 2000
Return-Path: <zsh-users-return-3071-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15309 invoked from network); 19 May 2000 18:18:45 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 19 May 2000 18:18:45 -0000
Received: (qmail 12713 invoked by alias); 19 May 2000 18:18:08 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 3071
Received: (qmail 12705 invoked from network); 19 May 2000 18:18:08 -0000
Date: Fri, 19 May 2000 19:17:37 +0100
From: Peter Stephenson <pws@cambridgesiliconradio.com>
Subject: PATCH: compdump with HOME=/
To: zsh-users@sunsite.auc.dk (Zsh users list)
Message-id: <0FUT005EZK5C24@la-la.cambridgesiliconradio.com>
Content-transfer-encoding: 7BIT

Further to the messages about zsh under cygwin earlier in the week...

I've just installed cygwin and compiled zsh.  Without the fix I posted,
undefining HAVE_MMAP as suggested by Geoff, external programmes don't work;
with it, everything went flawlessly: the only minor fly in the ointment was
that my home diretory came up as / and compdump rewrote this as //, which
apparently cygwin can't cope with (or it couldn't this time).  Everything
else I tried worked, including the new completion system, running other
cygwin executables, running WIN32 executables, basic job control.  This
seems a pretty good test of the basics.  (Actually, I was astonished.)

$OS is set to Windows_NT, $MACHTYPE is i686; it's a Pentium III running
Windows NT 4 sp 5 with the latest available cygwin release.

Index: Completion/Core/compdump
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Core/compdump,v
retrieving revision 1.2
diff -u -r1.2 compdump
--- Completion/Core/compdump	2000/04/01 20:43:43	1.2
+++ Completion/Core/compdump	2000/05/19 18:00:53
@@ -19,6 +19,7 @@
 typeset _d_file _d_f _d_bks _d_line _d_als
 
 _d_file=${_comp_dumpfile-${0:h}/compinit.dump}.$HOST.$$
+[[ $_d_file = //* ]] && _d_file=${_d_file[2,-1]}
 
 typeset -U _d_files
 _d_files=( ${^~fpath:/.}/^([^_]*|*~|*.zwc)(N:t) )

-- 
Peter Stephenson <pws@cambridgesiliconradio.com>
Cambridge Silicon Radio, Unit 300, Science Park, Milton Road,
Cambridge, CB4 0XL, UK                          Tel: +44 (0)1223 392070

