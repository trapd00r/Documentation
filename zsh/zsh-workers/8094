From zsh-workers-return-8094-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Sep 29 10:31:31 1999
Return-Path: <zsh-workers-return-8094-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11400 invoked from network); 29 Sep 1999 10:31:29 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 29 Sep 1999 10:31:29 -0000
Received: (qmail 574 invoked by alias); 29 Sep 1999 10:31:24 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8094
Received: (qmail 567 invoked from network); 29 Sep 1999 10:31:24 -0000
To: zsh-workers@sunsite.auc.dk
Subject: _a2ps completion is broken
X-Attribution: plx
From: pollux <duret_g@epita.fr>
Date: 29 Sep 1999 12:31:08 +0200
Message-ID: <mvbg0zy3t77.fsf@phobos.lrde.epita.fr>
Lines: 47
User-Agent: Gnus/5.070096 (Pterodactyl Gnus v0.96) Emacs/20.3
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

[please CC-me, I'm off the list]

Hi,

a2ps has changed its `--list=feature' output 
(somewhere between 4.10.4 and 4.12c, I don't know when)
which is used by zsh-3.1.6.pws6/Completion/User/_a2ps.

Besides this output is subject to locales so LC_ALL=C 
should be added (is there any other completion functions 
affected by this ?).  

The following patch should fix both things and still work 
with old a2ps. I would really like to know if there is an
easiest way to make these patterns matching case insensitive.


--- Completion/User/_a2ps.old	Wed Sep 29 11:45:48 1999
+++ Completion/User/_a2ps	Wed Sep 29 11:51:44 1999
@@ -7,17 +7,17 @@
 
   _a2ps_cache_cmd="$words[1]"
 
-  descr=( "${(@)${(f@)$($words[1] --list=features)//
+  descr=( "${(@)${(f@)$(LC_ALL=C $words[1] --list=features)//
  /	}:#}" )
 
   _a2ps_cache_values=(
-      "${descr[(r)Known style sheets*]#*	}"
-      "${descr[(r)Known encodings*]#*	}"
-      "${descr[(r)Known media*]#*	}"
-      "${descr[(r)Known prologues*]#*	}"
+      "${descr[(r)Known [Ss]tyle [Ss]heets*]#*	}"
+      "${descr[(r)Known [Ee]ncodings*]#*	}"
+      "${descr[(r)Known [Mm]edia*]#*	}"
+      "${descr[(r)Known [Pp]rologues*]#*	}"
       "${descr[(r)Known PostScript Printer Descriptions*]#*	}"
-      "${descr[(r)Known output destination*]#*	}"
-      "${descr[(r)Known user options*]#*	}"
+      "${descr[(r)Known [Oo]utput [Dd]estination*]#*	}"
+      "${descr[(r)Known [Uu]ser [Oo]ptions*]#*	}"
       "${descr[(r)Known Variables*]#*	}"
   )
 fi

-- 
Alexandre 'Pollux' Duret-Lutz

