From zsh-workers-return-28096-mason-zsh=primenet.com.au@zsh.org Tue Jul 20 19:22:00 2010
Return-Path: <zsh-workers-return-28096-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14828 invoked by alias); 20 Jul 2010 19:22:00 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28096
Received: (qmail 16746 invoked from network); 20 Jul 2010 19:21:57 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at ntlworld.com designates 81.103.221.58 as permitted sender)
Date: Tue, 20 Jul 2010 20:03:27 +0100
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-workers@zsh.org (Zsh hackers list)
Subject: Re: Recent directory tweaks
Message-ID: <20100720200327.4a2eccbc@pws-pc>
In-Reply-To: <3343.1279225565@pws-pc>
References: <3343.1279225565@pws-pc>
X-Mailer: Claws Mail 3.7.6 (GTK+ 2.18.9; x86_64-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Cloudmark-Analysis: v=1.1 cv=DhNl2YeytwJssBBGe49HJX82LNDFEEVkpVB34RXKaPo= c=1 sm=0 a=DogomfpGjd0A:10 a=kj9zAlcOel0A:10 a=NLZqzBF-AAAA:8 a=QwUvswpyvIk1sjkMxqoA:9 a=xFfgCgvAcD4wzjaey9NDuhG5Y3wA:4 a=CjuIK1q_8ugA:10 a=Peh4Twq3hjUA:10 a=_dQi-Dcv4p4A:10 a=HpAAvcLHHh0Zw7uRqdWCyQ==:117

On Thu, 15 Jul 2010 21:26:05 +0100
Peter Stephenson <p.w.stephenson@ntlworld.com> wrote:
> Point out in the documentation for people who aren't hardcore completion
> system users that it's possible to get a different set of recent
> directories in different locations.  Actually, I think this gets
> polluted by the handling for $OLDPWD in chpwd_recent_dirs, i.e. the
> directory you've come from may get added even if, if you were in it,
> you'd use a different file, but I'll look at that another time.

I think the answer is that's an unnecessary complexity anyway.  It's
enough to record directories you actually changed to, not ones you've
come from.  Most of the time this just means you don't put ~ in the list
when the shell started there.  I think.

Index: Functions/Chpwd/chpwd_recent_dirs
===================================================================
RCS file: /cvsroot/zsh/zsh/Functions/Chpwd/chpwd_recent_dirs,v
retrieving revision 1.1
diff -p -u -r1.1 chpwd_recent_dirs
--- Functions/Chpwd/chpwd_recent_dirs	9 Jul 2010 14:47:48 -0000	1.1
+++ Functions/Chpwd/chpwd_recent_dirs	20 Jul 2010 19:00:21 -0000
@@ -38,11 +38,6 @@ fi
 chpwd_recent_filehandler
 
 if [[ $reply[1] != $PWD ]]; then
-  if [[ -n $OLDPWD && $reply[1] != $OLDPWD ]]; then
-    # The first time we change directory we probably don't have
-    # the initial directory.
-    chpwd_recent_add $OLDPWD && changed=1
-  fi
   chpwd_recent_add $PWD && changed=1
 
   (( changed )) && chpwd_recent_filehandler $reply

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

