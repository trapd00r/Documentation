From zsh-workers-return-20855-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 23 13:43:03 2005
Return-Path: <zsh-workers-return-20855-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4912 invoked from network); 23 Feb 2005 13:43:02 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 Feb 2005 13:43:02 -0000
Received: (qmail 6216 invoked from network); 23 Feb 2005 13:42:57 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 Feb 2005 13:42:57 -0000
Received: (qmail 8938 invoked by alias); 23 Feb 2005 13:42:51 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20855
Received: (qmail 8924 invoked from network); 23 Feb 2005 13:42:51 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 23 Feb 2005 13:42:51 -0000
Received: (qmail 5947 invoked from network); 23 Feb 2005 13:42:51 -0000
Received: from morda.newmail.ru (HELO flock1.newmail.ru) (212.48.140.150)
  by a.mx.sunsite.dk with SMTP; 23 Feb 2005 13:42:47 -0000
Received: (qmail 31762 invoked from network); 23 Feb 2005 13:27:45 -0000
Received: from unknown (HELO ?10.0.0.1?) (arvidjaar@newmail.ru@83.237.106.71)
  by smtpd.newmail.ru with SMTP; 23 Feb 2005 13:27:45 -0000
From: Andrey Borzenkov <arvidjaar@newmail.ru>
To: zsh-workers@sunsite.dk
Subject: Re: PATCH: more zle fixes
Date: Wed, 23 Feb 2005 16:42:45 +0300
User-Agent: KMail/1.7.2
References: <200502231305.j1ND5p6F030160@news01.csr.com>
In-Reply-To: <200502231305.j1ND5p6F030160@news01.csr.com>
MIME-Version: 1.0
Content-Type: text/plain;
  charset="utf-8"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
Message-Id: <200502231642.45894.arvidjaar@newmail.ru>
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On Wednesday 23 February 2005 16:05, Peter Stephenson wrote:
> +    char s[MB_CUR_MAX+1];

MB_CUR_MAX is not required to be constant so the above may well be invalid on 
non-GCC.

conversion from wc to mb may require extra space for shift characters above 
MB_CUR_MAX. Completely bulletproof solution must check for resulting length 
and allocate buffer that is needed. Unfortunately it is not quite clear how 
to check length; wctomb(0, ...) does not return length, instead resets 
internal state.

