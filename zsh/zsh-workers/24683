From zsh-workers-return-24683-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 05 17:13:03 2008
Return-Path: <zsh-workers-return-24683-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27963 invoked from network); 5 Mar 2008 17:12:52 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 Mar 2008 17:12:52 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 53200 invoked from network); 5 Mar 2008 17:12:46 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 Mar 2008 17:12:46 -0000
Received: (qmail 29751 invoked by alias); 5 Mar 2008 17:12:42 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24683
Received: (qmail 29739 invoked from network); 5 Mar 2008 17:12:42 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 5 Mar 2008 17:12:42 -0000
Received: from cluster-d.mailcontrol.com (cluster-d.mailcontrol.com [217.69.20.190])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 7124B8028C67
	for <zsh-workers@sunsite.dk>; Wed,  5 Mar 2008 18:12:35 +0100 (CET)
Received: from rly26d.srv.mailcontrol.com (localhost.localdomain [127.0.0.1])
	by rly26d.srv.mailcontrol.com (MailControl) with ESMTP id m25HCWF0017564
	for <zsh-workers@sunsite.dk>; Wed, 5 Mar 2008 17:12:32 GMT
Received: from submission.mailcontrol.com (submission.mailcontrol.com [86.111.216.190])
	by rly26d.srv.mailcontrol.com (MailControl) id m25HCQPR017371
	for zsh-workers@sunsite.dk; Wed, 5 Mar 2008 17:12:26 GMT
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly26d-eth0.srv.mailcontrol.com (envelope-sender Peter.Stephenson@csr.com) (MIMEDefang) with ESMTP id m25HCPiD017143; Wed, 05 Mar 2008 17:12:26 +0000 (GMT)
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Wed, 5 Mar 2008 17:12:23 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.2/8.13.4) with ESMTP id m25HCN4Y006444;
	Wed, 5 Mar 2008 17:12:23 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.2/8.14.2/Submit) with ESMTP id m25HCNk6006441;
	Wed, 5 Mar 2008 17:12:23 GMT
Message-Id: <200803051712.m25HCNk6006441@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-workers@sunsite.dk, Sven Joachim <svenjoac@gmx.de>,
        369305-forwarded@bugs.debian.org
Subject: Re: Bug#369305: zsh: failed to write history file /home/sven/.zsh-history: no such file or directory
In-reply-to: <20080305144438.GA9541@scowler.net>
References: <87ir01bb68.fsf@gmx.de> <20080305144438.GA9541@scowler.net>
Comments: In-reply-to Clint Adams <schizo@debian.org>
   message dated "Wed, 05 Mar 2008 09:44:38 -0500."
Date: Wed, 05 Mar 2008 17:12:23 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 05 Mar 2008 17:12:23.0531 (UTC) FILETIME=[141F7BB0:01C87EE4]
X-Scanned-By: MailControl A-08-00-04 (www.mailcontrol.com) on 10.68.1.136
X-Virus-Scanned: ClamAV 0.91.2/6140/Wed Mar  5 15:44:05 2008 on bifrost
X-Virus-Status: Clean

Clint Adams wrote:
> On Wed, Mar 05, 2008 at 01:35:59PM +0100, Sven Joachim wrote:
> > I'm noticing the odd message in the subject when exiting from "sudo zsh".
> > However, the file ~/.zsh_history is actually updated anyway.  And despite
> > the claims in bug #347444, its ownership is not changed, fortunately.
> 
> That error message is indeed misleading.

You haven't said how to reproduce this (all I've seen is above), but
there are now lots tests in savehistfile() in hist.c for failure to
write and one of them is being overzealous.  Possibly ret is being set
to -1 without errno being set by the corresponding call, but it sounds
like there's more to it than that.  This should be easy enough to track
down if you can get it to happen.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

