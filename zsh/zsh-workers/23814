From zsh-workers-return-23814-mason-zsh=primenet.com.au@sunsite.dk Fri Sep 07 18:25:03 2007
Return-Path: <zsh-workers-return-23814-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12709 invoked from network); 7 Sep 2007 18:24:54 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 7 Sep 2007 18:24:54 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 84254 invoked from network); 7 Sep 2007 18:24:47 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 Sep 2007 18:24:47 -0000
Received: (qmail 29074 invoked by alias); 7 Sep 2007 18:24:41 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23814
Received: (qmail 29064 invoked from network); 7 Sep 2007 18:24:40 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 7 Sep 2007 18:24:40 -0000
Received: (qmail 83627 invoked from network); 7 Sep 2007 18:24:40 -0000
Received: from solo.fdn.fr (80.67.169.19)
  by a.mx.sunsite.dk with SMTP; 7 Sep 2007 18:24:34 -0000
Received: from localhost (reverse-66.fdn.fr [80.67.176.66])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(Client did not present a certificate)
	(Authenticated sender: arenevier)
	by smtp.fdn.fr (Postfix) with ESMTP id 6C4004E8580
	for <zsh-workers@sunsite.dk>; Fri,  7 Sep 2007 20:24:33 +0200 (CEST)
Date: Fri, 7 Sep 2007 20:24:34 +0200
From: arno <arenevier@fdn.fr>
To: zsh-workers@sunsite.dk
Subject: host completion in _dput
Message-ID: <20070907182434.GA16109@localhost.localdomain>
MIME-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="0F1p//8PRICkK4MW"
Content-Disposition: inline
User-Agent: Mutt/1.5.16 (2007-06-11)


--0F1p//8PRICkK4MW
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

Hi,
I modified _dput to get host completion.
I send you the diff in case other people find it useful.

arno.



--- /home/arno/debsrc/zsh-4.3.4/Completion/Debian/Command/_dput	2005-11-06 =
16:04:39.000000000 +0100
+++ zshfunc/_dput	2007-09-07 20:01:49.000000000 +0200
@@ -1,5 +1,18 @@
 #compdef dput
=20
+
+ (( $+functions[_dput_hosts] )) ||
+_dput_hosts() {
+    emulate -L zsh
+    setopt extendedglob
+    local -a hosts
+    local match mbegin mend
+    for conff in /etc/dput.cf ~/.dput.cf; do
+        hosts+=3D(${${(M)"${(f)$(<$conff)}":#\[(*~DEFAULT)\][[:blank:]]#}/=
\[(#b)(*)\][[:blank:]]#/${match[1]}})
+    done
+    _wanted hosts expl 'hosts' compadd "$@" -a - hosts
+}
+
 _arguments \
   '(-c --config)'{-c,--config}'[specify config file]:config file:_files' \
   '(-d --debug)'{-d,--debug}'[debug mode]' \
@@ -11,4 +24,5 @@
   '(-s --simulate)'{-s,--simulate}'[simulate an upload only]' \
   '(-u --unchecked)'{-u,--unchecked}'[do not check GPG signature on the ch=
anges file]' \
   '(-v --version)'{-v,--version}'[show version information]' \
-  '*:changes file:_files -g "*.changes(-.)"'
+  '1: : _alternative "host:host:_dput_hosts" "files:change file:_files -g =
\*\.changes\(-\.\)"' \
+  '*:file:_files -g "*.changes(-.)"'

--0F1p//8PRICkK4MW
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Digital signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFG4ZdiiH9aBScBsrMRAi3vAJ4q6z849MEQ4WB5LX5TSgIFyfvsrACggoul
w8dgmeae8q0M4j7zx5elDjU=
=gHyD
-----END PGP SIGNATURE-----

--0F1p//8PRICkK4MW--

From zsh-workers-return-23814-mason-zsh=primenet.com.au@sunsite.dk Thu Sep 13 16:02:40 2007
Return-Path: <zsh-workers-return-23814-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20775 invoked from network); 13 Sep 2007 16:02:32 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 13 Sep 2007 16:02:32 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 86331 invoked from network); 13 Sep 2007 16:02:26 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 13 Sep 2007 16:02:26 -0000
Received: (qmail 851 invoked by alias); 13 Sep 2007 11:57:33 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23814
Received: (qmail 27759 invoked from network); 13 Sep 2007 11:44:31 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 13 Sep 2007 11:44:31 -0000
Received: (qmail 53836 invoked from network); 11 Sep 2007 19:37:51 -0000
Received: from rcpt-mqugw2.biglobe.ne.jp (210.147.8.14)
  by a.mx.sunsite.dk with SMTP; 11 Sep 2007 19:37:44 -0000
Received: from rcpt-expgw3.biglobe.ne.jp
	by rcpt-mqugw2.biglobe.ne.jp (kbkr/4509131006) with ESMTP id l8BFuxdZ017524
	for <zsh-workers@sunsite.dk>; Wed, 12 Sep 2007 00:56:59 +0900
Received: from smtp-gw.biglobe.ne.jp
	by rcpt-expgw3.biglobe.ne.jp (kbkr/0214191006) with ESMTP id l8BFuiPX014361
	for <zsh-workers@sunsite.dk>; Wed, 12 Sep 2007 00:56:44 +0900
X-Biglobe-Sender: <takimoto-j@kba.biglobe.ne.jp>
Received: from [192.168.0.3] (221.171.153.109 [221.171.153.109]) by smtp-gw.biglobe.ne.jp
	id AAAAAC15AFD6; Wed, 12 Sep 2007 00:56:43 +0900 (JST)
Mime-Version: 1.0
X-Mailer: QUALCOMM MacOS X Eudora Version 6.2J rev3.3
Message-Id: <a06001003c30c66f3cc59@kba.biglobe.ne.jp>
Date: Wed, 12 Sep 2007 00:56:42 +0900
To: zsh-workers@sunsite.dk
From: "Jun T." <takimoto-j@kba.biglobe.ne.jp>
Subject: PATCH: _ls, _chflags, _file_systems, _comm
Content-Type: text/plain; charset="us-ascii"

Here are pathces for a few simple completion functions:

_ls, _chflags, _file_systems
     Support darwin (MacOSX)

_comm
     complete GNU options only if GNU version

I hope they have no problems.

===================================================================
diff -u zsh/Completion/Unix/Command/_ls zsh2/Completion/Unix/Command/_ls
--- zsh/Completion/Unix/Command/_ls     2006-05-25 16:58:07.000000000 +0900
+++ zsh2/Completion/Unix/Command/_ls    2007-09-12 00:09:01.000000000 +0900
@@ -5,7 +5,7 @@
 
 _pick_variant -r is_gnu gnu=gnu unix --help
 
-if [[ "$OSTYPE" = (netbsd*|freebsd*|openbsd*) && "$is_gnu" != gnu ]]; then
+if [[ "$OSTYPE" = (netbsd*|freebsd*|openbsd*|darwin*) && "$is_gnu" != gnu ]]; then
   arguments=(
     '(-A)-a[list entries starting with .]'
     '(-a)-A[list all except . and ..]'
@@ -54,6 +54,13 @@
 
     '*:files:_files'
   )
+  if [[ "$OSTYPE" = (freebsd*|darwin*) ]]; then
+    arguments+=(
+      '-G[enable colorized output]'
+      '-H[follow symlinks on the command line]'
+      '-P[do not follow symlinks]'
+    )
+  fi
 else
   arguments=(
     '(--all -a -A --almost-all)'{--all,-a}'[list entries starting with .]'

===================================================================
diff -u zsh/Completion/BSD/Command/_chflags zsh2/Completion/BSD/Command/_chflags 
--- zsh/Completion/BSD/Command/_chflags 2005-05-11 18:27:09.000000000 +0900
+++ zsh2/Completion/BSD/Command/_chflags        2007-09-09 23:39:32.000000000 +0900
@@ -25,7 +25,7 @@
   unset own
 fi
 
-if [[ $OSTYPE = (freebsd|dragonfly)* ]]; then
+if [[ $OSTYPE = (freebsd|dragonfly|darwin)* ]]; then
   flags=( $flags[@]
     '(nouunlnk)uunlnk[set the user undeletable flag]'
     '(uunlnk)nouunlnk[unset the user undeletable flag]'

===================================================================
diff -u zsh/Completion/Unix/Type/_file_systems zsh2/Completion/Unix/Type/_file_systems
--- zsh/Completion/Unix/Type/_file_systems      2005-06-08 21:45:35.000000000 +0900
+++ zsh2/Completion/Unix/Type/_file_systems     2007-09-11 23:01:53.000000000 +0900
@@ -20,6 +20,10 @@
     fss=( cd9660 devfs ext2fs fdesc kernfs linprocfs mfs msdos nfs 
           ntfs null nwfs portal procfs std udf ufs umap union )
   ;;
+  darwin*)
+    fss=( afp cd9660 cddafs devfs fdesc hfs lfs msdos nfs
+          ntfs smbfs synthfs udf ufs volfs webdav )
+  ;;
   *)
     # default for all other systems
     fss=( ufs )

===================================================================
diff -u zsh/Completion/Unix/Command/_comm zsh2/Completion/Unix/Command/_comm
--- zsh/Completion/Unix/Command/_comm   2007-03-12 09:02:11.000000000 +0900
+++ zsh2/Completion/Unix/Command/_comm  2007-09-08 01:04:19.000000000 +0900
@@ -1,10 +1,20 @@
 #compdef comm
 
-_arguments -s \
-  '-1[suppress lines unique to FILE1]' \
-  '-2[suppress lines unique to FILE2]' \
-  '-3[suppress lines that appear in both files]' \
-  '--help' \
-  '--version' \
-  '1:file1 to compare:_files' \
+local -a args
+
+args=(
+  '-1[suppress lines unique to FILE1]'
+  '-2[suppress lines unique to FILE2]'
+  '-3[suppress lines that appear in both files]'
+  '1:file1 to compare:_files'
   '2:file2 to compare:_files'
+)
+
+if _pick_variant gnu=GNU unix --version; then
+  args+=(
+    '(- : *)--version[display version information]'
+    '(- : *)--help[display help information]'
+  )
+fi
+
+_arguments -s $args

