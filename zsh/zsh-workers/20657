From zsh-workers-return-20657-mason-zsh=primenet.com.au@sunsite.dk Sun Jan 09 16:12:28 2005
Return-Path: <zsh-workers-return-20657-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20550 invoked from network); 9 Jan 2005 16:12:28 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 9 Jan 2005 16:12:28 -0000
Received: (qmail 63525 invoked from network); 9 Jan 2005 16:12:22 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 Jan 2005 16:12:22 -0000
Received: (qmail 23184 invoked by alias); 9 Jan 2005 16:12:18 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20657
Received: (qmail 23170 invoked from network); 9 Jan 2005 16:12:16 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 9 Jan 2005 16:12:16 -0000
Received: (qmail 63276 invoked from network); 9 Jan 2005 16:12:16 -0000
Received: from acolyte.scowler.net (216.254.112.45)
  by a.mx.sunsite.dk with SMTP; 9 Jan 2005 16:12:13 -0000
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id 9886E7004A; Sun,  9 Jan 2005 11:12:12 -0500 (EST)
Date: Sun, 9 Jan 2005 11:12:12 -0500
From: Clint Adams <clint@zsh.org>
To: zsh-workers@sunsite.dk, "Benjamin Hill (Mako)" <mako@debian.org>,
	289442@bugs.debian.org
Subject: Re: Bug#289442: zsh: completions do not respect LC_COLLATE
Message-ID: <20050109161212.GA21009@scowler.net>
References: <E1CnUVX-0005Di-00@nozomi> <20050109153543.GA7922@scowler.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20050109153543.GA7922@scowler.net>
User-Agent: Mutt/1.5.6+20040907i
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-1.4 required=6.0 tests=BAYES_20 autolearn=no 
	version=2.63
X-Spam-Hits: -1.4

> I think we could change the character comparison at the end of
> setbpcmp() to a strcoll(), or do setxfrm()'s at the beginning.

This does the trick.  I'll refrain from committing in case there's
an unacceptable performance hit or side effect.

Index: Src/Zle/zle_tricky.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_tricky.c,v
retrieving revision 1.45
diff -u -r1.45 zle_tricky.c
--- Src/Zle/zle_tricky.c	2 Jun 2004 22:15:02 -0000	1.45
+++ Src/Zle/zle_tricky.c	9 Jan 2005 16:09:21 -0000
@@ -1907,7 +1907,11 @@
 	    }
 	}
     }
+#ifndef HAVE_STRCOLL
     return (int)(*a - *b);
+#else
+    return strcoll(a,b);
+#endif
 }
 
 /* This is used to print the strings (e.g. explanations). *

