From zsh-workers-request@math.gatech.edu Tue Aug 19 09:21:38 1997
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 17004 invoked from network); 19 Aug 1997 09:21:36 -0000
Received: from euclid.skiles.gatech.edu (HELO math.gatech.edu) (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 19 Aug 1997 09:21:36 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id FAA02785;
	Tue, 19 Aug 1997 05:11:46 -0400 (EDT)
Resent-Date: Tue, 19 Aug 1997 05:11:24 -0400 (EDT)
From: Andrew Main <zefram@tao.co.uk>
Message-Id: <199708190911.KAA20324@taos.demon.co.uk>
Subject: Re: vim control-a at the shell
To: fk5a005@rrz.uni-hamburg.de (Matthias Kopfermann)
Date: Tue, 19 Aug 1997 10:11:43 +0100 (BST)
Cc: zsh-users@math.gatech.edu
In-Reply-To: <199708190836.KAA14162@rzaix43.rrz.uni-hamburg.de> from "Matthias Kopfermann" at Aug 19, 97 10:36:32 am
X-Loop: zefram@tao.co.uk
X-Headers: in preparation
X-Mailer: ELM [version 2.4 PL25]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"qvALj1.0.rg.xCM-p"@math>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/976
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Matthias Kopfermann wrote:
>i love that little feature within vim
>if you have a number say 20 and you press control-a with vim it becomes
>21 while control-x does 19.

This is more commonly on #+ and #-.

>our zsh is such a great shell that i am almost sure i can do that
>at the prompt, too but how should i do it?

A recent zsh beta is required (3.1.2 will do):

function increment-number {
  local n=${(M)LBUFFER%%[0-9]#}${(M)RBUFFER##[0-9]#}
  LBUFFER=${LBUFFER%%[0-9]#}$((n+1))
  RBUFFER=${RBUFFER##[0-9]#}
}
zle -N increment-number
bindkey -a '#+' increment-number     # nvi binding
bindkey -a '^A' increment-number     # vim binding

Similarly for decrement, but change $((n+1)) to $((n-1)) and adjust the
key bindings.  nvi et al also have a ## command, which repeats the last
of #+ and #- to be invoked explicitly.  To do this, add the command

  last_number=increment-number

to the increment-number function, and the corresponding line to
decrement-number, and then do

function last-number {
  [[ -n "$last_number" ]] && zle $last_number
}
zle -N last-number
bindkey -a '##' last-number

-zefram

