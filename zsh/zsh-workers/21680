From zsh-workers-return-21680-mason-zsh=primenet.com.au@sunsite.dk Tue Aug 23 02:52:31 2005
Return-Path: <zsh-workers-return-21680-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23284 invoked from network); 23 Aug 2005 02:52:28 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 Aug 2005 02:52:28 -0000
Received: (qmail 91374 invoked from network); 23 Aug 2005 02:52:23 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 Aug 2005 02:52:23 -0000
Received: (qmail 11819 invoked by alias); 23 Aug 2005 02:52:20 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21680
Received: (qmail 11810 invoked from network); 23 Aug 2005 02:52:19 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 23 Aug 2005 02:52:19 -0000
Received: (qmail 91051 invoked from network); 23 Aug 2005 02:52:19 -0000
Received: from vms046pub.verizon.net (206.46.252.46)
  by a.mx.sunsite.dk with SMTP; 23 Aug 2005 02:52:15 -0000
Received: from candle.brasslantern.com ([71.116.79.190])
 by vms046.mailsrvcs.net
 (Sun Java System Messaging Server 6.2 HotFix 0.04 (built Dec 24 2004))
 with ESMTPA id <0ILN00CU1MN13CY1@vms046.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Mon, 22 Aug 2005 21:52:14 -0500 (CDT)
Received: from candle.brasslantern.com (IDENT:schaefer@localhost [127.0.0.1])
	by candle.brasslantern.com (8.12.11/8.12.11) with ESMTP id j7N2qDmc007672	for
 <zsh-workers@sunsite.dk>; Mon, 22 Aug 2005 19:52:13 -0700
Received: (from schaefer@localhost)	by candle.brasslantern.com
 (8.12.11/8.12.11/Submit) id j7N2qCi2007671	for zsh-workers@sunsite.dk; Mon,
 22 Aug 2005 19:52:12 -0700
Date: Tue, 23 Aug 2005 02:52:12 +0000
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: dynamic modules without libzsh.so?
In-reply-to: <20050823000141.GA21090@bretton.ny.jpmorgan.com>
To: zsh-workers@sunsite.dk
Message-id: <1050823025212.ZM7670@candle.brasslantern.com>
MIME-version: 1.0
X-Mailer: Z-Mail (5.0.0 30July97)
Content-type: text/plain; charset=us-ascii
References: <20050823000141.GA21090@bretton.ny.jpmorgan.com>
Comments: In reply to Anthony Heading <aheading@jpmorgan.com>
 "dynamic modules without libzsh.so?" (Aug 22,  8:01pm)
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.4

On Aug 22,  8:01pm, Anthony Heading wrote:
}
} How does one build the core zsh statically (i.e. with
} builtin.o etc as part of the main executable, not in
} libzsh-4.2.5.so), while still having zle and zftp
} and so on created as loadable modules?

Several (though not all) of the dynamic linking schemes supported by
the zsh build process will not allow runtime-linkable libraries to
make reference to global symbols from a static library.  libzsh-*.so
forms a bridge in those environments, and therefore is always built
as a dynamic shared object unless the _entire_ zsh binary is static.

So the answer is, you can't do it, unless (a) your dynamic linker is
not one of those that requires it to be shared, and (b) you construct
the necessary compile and link commands by hand [or by editing the
zsh build system, which amounts to the same thing].

