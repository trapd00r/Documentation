From zsh-workers-return-20759-mason-zsh=primenet.com.au@sunsite.dk Mon Jan 31 05:11:32 2005
Return-Path: <zsh-workers-return-20759-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7934 invoked from network); 31 Jan 2005 05:11:30 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 31 Jan 2005 05:11:30 -0000
Received: (qmail 49546 invoked from network); 31 Jan 2005 05:11:24 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 31 Jan 2005 05:11:24 -0000
Received: (qmail 19795 invoked by alias); 31 Jan 2005 05:11:14 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20759
Received: (qmail 19781 invoked from network); 31 Jan 2005 05:11:13 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 31 Jan 2005 05:11:13 -0000
Received: (qmail 49144 invoked from network); 31 Jan 2005 05:10:14 -0000
Received: from ip-66-80-62-153.dsl.sca.megapath.net (HELO ripple.fruitbat.org) (66.80.62.153)
  by a.mx.sunsite.dk with SMTP; 31 Jan 2005 05:10:09 -0000
Received: (from daemon@localhost)
	by ripple.fruitbat.org (8.10.2/8.8.8/PAC-1.3) id j0V58LL23042
	for <zsh-workers@sunsite.dk>; Sun, 30 Jan 2005 21:08:21 -0800
Received: from ming.fruitbat.org(192.168.1.2) by ripple.fruitbat.org via smap (V2.1/2.1+anti-relay+anti-spam)
	id xma023038; Sun, 30 Jan 05 21:07:40 -0800
Received: from ming.fruitbat.org (IDENT:202@ming.fruitbat.org [192.168.1.2])
	by ming.fruitbat.org (8.12.10/8.10.2/PAC-1.6) with ESMTP id j0V57c8p022344
	for <zsh-workers@sunsite.dk>; Sun, 30 Jan 2005 21:07:39 -0800
Date: Sun, 30 Jan 2005 21:07:38 -0800 (PST)
From: "Peter A. Castro" <doctor@fruitbat.org>
To: zsh-workers@sunsite.dk
Subject: Patch for 4.2.3 building on Cygwin
In-Reply-To: <Pine.LNX.4.53.0404051424500.11532@gremlin.fruitbat.org>
Message-ID: <Pine.LNX.4.58.0501241602420.16726@ming.fruitbat.org>
References: <29767.1081186817@csr.com> <Pine.LNX.4.53.0404051424500.11532@gremlin.fruitbat.org>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-1463811071-1260860925-1081202913=:11532"
Content-ID: <Pine.LNX.4.58.0501241602421.16726@ming.fruitbat.org>
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---1463811071-1260860925-1081202913=:11532
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII
Content-ID: <Pine.LNX.4.58.0501241602422.16726@ming.fruitbat.org>

Cygwin updates against zsh-4.2.3.  See attached diffs:

configure.ac - check for iconv.h
             - check for libiconv() if cygwin
	     - call 'pcre-config --libs' to get LIBS if using pcre
Src/utils.c  - added if defined(HAVE_ICONV_H) to #if's which test for
               HAVE_ICONV or HAVE_LIBICONV

Notes:

Added iconv.h header to header check list.  This is really just for
completeness.  iconv() in Cygwin is really libiconv() (iconv.h does a
"#define iconv libiconv").  However the AC_CHECK_LIB() macro doesn't know
to include iconv.h.  I played with coding a custom conf test to #include
iconv.h but ran into prototype issues and decided it was simpler to just
look for the real function instead using AC_CHECK_LIB.

pcre's libs should be obtained by running pcre-config.  This isn't really
a cygwin-ism, but more of a generic pcre issue.

FIFO's in Cygwin are implemented using Windows' underlying named pipes
implementation and are somewhat buggy (like Windows, itself :).  Until
this is resolved, it makes more sense to disable their usage.  I'll
track this issue and send updates when things are working properly.

Thanks!

-- 
Peter A. Castro <doctor@fruitbat.org> or <Peter.Castro@oracle.com>
	"Cats are just autistic Dogs" -- Dr. Tony Attwood
---1463811071-1260860925-1081202913=:11532
Content-Type: TEXT/PLAIN; charset=US-ASCII; name="patch-to-zsh-list.patch"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.58.0501302107380.17079@ming.fruitbat.org>
Content-Description: zsh423cygwin.patch
Content-Disposition: attachment; filename="patch-to-zsh-list.patch"

ZGlmZiAtdXJOIC14IC5idWlsZCAteCAuaW5zdCAteCAuc2luc3QgenNoLTQu
Mi4zLW9yaWcvU3JjL3V0aWxzLmMgenNoLTQuMi4zL1NyYy91dGlscy5jDQot
LS0genNoLTQuMi4zLW9yaWcvU3JjL3V0aWxzLmMJMjAwNS0wMS0xMiAwMjo1
NjoxNi4wMDAwMDAwMDAgLTA4MDANCisrKyB6c2gtNC4yLjMvU3JjL3V0aWxz
LmMJMjAwNS0wMS0yMiAyMTozNzo1OC43NjU2MjUwMDAgLTA4MDANCkBAIC0z
NSw3ICszNSw3IEBADQogI2Vsc2UNCiAjIGlmZGVmIEhBVkVfTEFOR0lORk9f
SCAJCQkgICAgICAgDQogIyAgIGluY2x1ZGUgPGxhbmdpbmZvLmg+CQkJICAg
ICAgIA0KLSMgICBpZiBkZWZpbmVkKEhBVkVfSUNPTlYpIHx8IGRlZmluZWQo
SEFWRV9MSUJJQ09OVikgICANCisjICAgaWYgZGVmaW5lZChIQVZFX0lDT05W
X0gpIHx8IGRlZmluZWQoSEFWRV9JQ09OVikgfHwgZGVmaW5lZChIQVZFX0xJ
QklDT05WKSAgIA0KICMgICAgIGluY2x1ZGUgPGljb252Lmg+IAkJCSAgICAg
ICANCiAjICAgZW5kaWYJCQkJCSAgICAgICANCiAjIGVuZGlmIAkJCQkJICAg
ICAgIA0KQEAgLTM1MjEsNyArMzUyMSw3IEBADQogICAgIHNpemVfdCBjb3Vu
dDsNCiAjZWxzZQ0KICAgICB1bnNpZ25lZCBpbnQgd3ZhbDsNCi0jIGlmIGRl
ZmluZWQoSEFWRV9OTF9MQU5HSU5GTykgJiYgZGVmaW5lZChDT0RFU0VUKSAm
JiAoZGVmaW5lZChIQVZFX0lDT05WKSB8fCBkZWZpbmVkKEhBVkVfTElCSUNP
TlYpKQ0KKyMgaWYgZGVmaW5lZChIQVZFX05MX0xBTkdJTkZPKSAmJiBkZWZp
bmVkKENPREVTRVQpICYmIChkZWZpbmVkKEhBVkVfSUNPTlZfSCkgfHwgZGVm
aW5lZChIQVZFX0lDT05WKSB8fCBkZWZpbmVkKEhBVkVfTElCSUNPTlYpKQ0K
ICAgICBpY29udl90IGNkOw0KICAgICBjaGFyIGluYnVmWzRdOw0KICAgICBz
aXplX3QgaW5ieXRlcywgb3V0Ynl0ZXM7DQpAQCAtMzY0Miw3ICszNjQyLDcg
QEANCiAJCSAgICB0ICs9IHVjczR0b3V0ZjgodCwgd3ZhbCk7DQogCQkgICAg
Y29udGludWU7DQogCQl9IGVsc2Ugew0KLSMgICBpZiBkZWZpbmVkKEhBVkVf
SUNPTlYpIHx8IGRlZmluZWQoSEFWRV9MSUJJQ09OVikNCisjICAgaWYgZGVm
aW5lZChIQVZFX0lDT05WX0gpIHx8IGRlZmluZWQoSEFWRV9JQ09OVikgfHwg
ZGVmaW5lZChIQVZFX0xJQklDT05WKQ0KICAgICAJICAgIAkgICAgaW5ieXRl
cyA9IDQ7DQogCQkgICAgb3V0Ynl0ZXMgPSA2Ow0KICAgICAJICAgIAkgICAg
aW5wdHIgPSBpbmJ1ZjsNCmRpZmYgLXVyTiAteCAuYnVpbGQgLXggLmluc3Qg
LXggLnNpbnN0IHpzaC00LjIuMy1vcmlnL2NvbmZpZ3VyZS5hYyB6c2gtNC4y
LjMvY29uZmlndXJlLmFjDQotLS0genNoLTQuMi4zLW9yaWcvY29uZmlndXJl
LmFjCTIwMDUtMDEtMTIgMDI6NTU6MDYuMDAwMDAwMDAwIC0wODAwDQorKysg
enNoLTQuMi4zL2NvbmZpZ3VyZS5hYwkyMDA1LTAxLTI5IDExOjUzOjI0LjE4
NzUwMDAwMCAtMDgwMA0KQEAgLTEsNCArMSwzIEBADQotZG5sDQogZG5sICBj
b25maWd1cmUuYWM6IENvbmZpZ3VyZSB0ZW1wbGF0ZSBmb3IgenNoLg0KIGRu
bCAgUHJvY2VzcyB0aGlzIGZpbGUgd2l0aCBhdXRvY29uZiB0byBwcm9kdWNl
IGEgY29uZmlndXJlIHNjcmlwdC4NCiBkbmwNCkBAIC01MjksNyArNTI4LDcg
QEANCiAJCSBsb2NhbGUuaCBlcnJuby5oIHN0ZGlvLmggc3RkbGliLmggdW5p
c3RkLmggc3lzL2NhcGFiaWxpdHkuaCBcDQogCQkgdXRtcC5oIHV0bXB4Lmgg
c3lzL3R5cGVzLmggcHdkLmggZ3JwLmggcG9sbC5oIHN5cy9tbWFuLmggXA0K
IAkJIG5ldGluZXQvaW5fc3lzdG0uaCBwY3JlLmggbGFuZ2luZm8uaCB3Y2hh
ci5oIHN0ZGRlZi5oIFwNCi0JCSBzeXMvc3Ryb3B0cy5oKQ0KKwkJIHN5cy9z
dHJvcHRzLmggaWNvbnYuaCkNCiBpZiB0ZXN0ICRkeW5hbWljID0geWVzOyB0
aGVuDQogICBBQ19DSEVDS19IRUFERVJTKGRsZmNuLmgpDQogICBBQ19DSEVD
S19IRUFERVJTKGRsLmgpDQpAQCAtNzI3LDExICs3MjYsMTcgQEANCiANCiBB
Q19DSEVDS19MSUIoc29ja2V0LCBzb2NrZXQpDQogDQotQUNfQ0hFQ0tfTElC
KGljb252LCBpY29udikNCitkbmwgQUNfQ0hFQ0tfTElCKGljb252LCBpY29u
dikNCisNCitpZiB0ZXN0ICIkaG9zdF9vcyIgPSBjeWd3aW47IHRoZW4NCitk
bmwgY3lnd2luIGljb252KCkgaXMgcmVhbGx5IGxpYmljb252KCkNCitBQ19D
SEVDS19MSUIoaWNvbnYsIGxpYmljb252KQ0KK2ZpDQogDQogaWYgdGVzdCB4
JGVuYWJsZV9wY3JlID0geHllczsgdGhlbg0KIGRubCBwY3JlLWNvbmZpZyBz
aG91bGQgcHJvYmFibHkgYmUgZW1wbG95ZWQgaGVyZQ0KLUFDX1NFQVJDSF9M
SUJTKHBjcmVfY29tcGlsZSwgcGNyZSkNCitkbmwgQUNfU0VBUkNIX0xJQlMo
cGNyZV9jb21waWxlLCBwY3JlKQ0KKyAgTElCUz0iYHBjcmUtY29uZmlnIC0t
bGlic2AgJExJQlMiDQogZmkNCiANCiBkbmwgLS0tLS0tLS0tLS0tLS0tLS0t
LS0tDQpAQCAtMTYzMyw3ICsxNjM4LDExIEBADQogZG5sIC0tLS0tLS0tLS0t
DQogQUNfQ0FDSEVfQ0hFQ0soaWYgbmFtZWQgRklGT3Mgd29yaywNCiB6c2hf
Y3Zfc3lzX2ZpZm8sDQotW0FDX1RSWV9SVU4oWw0KK1tpZiB0ZXN0ICIkaG9z
dF9vcyIgPSBjeWd3aW47IHRoZW4NCitkbmwgZm9yIG5vdywgZmlmb3Mgbm8g
d29ya3kgaW4gY3lnd2luDQorenNoX2N2X3N5c19maWZvPW5vDQorZWxzZQ0K
K0FDX1RSWV9SVU4oWw0KICNpbmNsdWRlIDxmY250bC5oPg0KICNpbmNsdWRl
IDxzaWduYWwuaD4NCiBtYWluKCkNCkBAIC0xNjYzLDcgKzE2NzIsOCBAQA0K
IF0sDQogICB6c2hfY3Zfc3lzX2ZpZm89eWVzLA0KICAgenNoX2N2X3N5c19m
aWZvPW5vLA0KLSAgenNoX2N2X3N5c19maWZvPXllcyldKQ0KKyAgenNoX2N2
X3N5c19maWZvPXllcykNCitmaV0pDQogQUhfVEVNUExBVEUoW0hBVkVfRklG
T1NdLA0KIFtEZWZpbmUgdG8gMSBpZiBzeXN0ZW0gaGFzIHdvcmtpbmcgRklG
T3MuXSkNCiBpZiB0ZXN0ICR6c2hfY3Zfc3lzX2ZpZm8gPSB5ZXM7IHRoZW4N
Cg==

---1463811071-1260860925-1081202913=:11532--

