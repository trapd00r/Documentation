From zsh-users-return-15409-mason-zsh=primenet.com.au@zsh.org Sat Sep 18 23:16:15 2010
Return-Path: <zsh-users-return-15409-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2506 invoked by alias); 18 Sep 2010 23:16:15 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15409
Received: (qmail 6783 invoked from network); 18 Sep 2010 23:16:14 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.0 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE autolearn=ham
	version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.160.43 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:date:from:to:cc:subject
         :message-id:mail-followup-to:references:mime-version:content-type
         :content-disposition:in-reply-to:x-pgp-key-id:user-agent;
        bh=Cr8RZpo7gOUFEqURI8PJq8Ch85Wy2huLO2XCEB4Qvuc=;
        b=g0jT8tZdYzIq1NplkkccXHZnwl3MTukcp5Y2rfBI+hoq2+JsQ4kmHwOfZ9coRiaTQn
         n6yrvVnKT7FbjgBKrRGahbPcY4EKg+MP6U/iuAJGIueBQqpVOhwpJR5YSj6trIkrDCYq
         KIV3O9rE6c4PCe2YqYVyNFrhpGkPe1ANZUwKw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=date:from:to:cc:subject:message-id:mail-followup-to:references
         :mime-version:content-type:content-disposition:in-reply-to
         :x-pgp-key-id:user-agent;
        b=EcnIZl1rRn4fngdXpQU65uGlB9AEtx8g1LHcsy7b0hTCIBqNr//OcQ2WAK1aB8+FJw
         3hcB201al45AHYls+I4GsNxS/konBw95f4p5julrbjD3douND81IVb/3w2ElUDnpnIPb
         T6Ggp4LdurUpLGbmUsvZ6z7t7d3CCoRTQtOis=
Date: Sun, 19 Sep 2010 07:09:45 +0800
From: Roy Zuo <roylzuo@gmail.com>
To: Richard Hartmann <richih.mailinglist@gmail.com>
Cc: Julien Nicoulaud <julien.nicoulaud@gmail.com>,
	Sebastian Stark <seb-zsh@biskalar.de>,
	Michel <michel.barret@gmail.com>, zsh-users@zsh.org
Subject: Re: Dynamic colored command in zsh
Message-ID: <20100918230945.GA4530@Lancelot>
Mail-Followup-To: Richard Hartmann <richih.mailinglist@gmail.com>,
	Julien Nicoulaud <julien.nicoulaud@gmail.com>,
	Sebastian Stark <seb-zsh@biskalar.de>,
	Michel <michel.barret@gmail.com>, zsh-users@zsh.org
References: <AANLkTinNJXay4pibEiQmKR4PSRcNiwCJ3w==Scc9rco0@mail.gmail.com>
 <20100913130345.GA9240@Lancelot>
 <AANLkTikq=h-awW+-HAB8-QWdg0dWTuY+uydMu-Ezmt-0@mail.gmail.com>
 <6227C736-CCD3-4E09-A922-106573F3D70D@biskalar.de>
 <AANLkTimj6n_qSd3_5Egk6RN=v47GwWBb+W3_MjWpMs4t@mail.gmail.com>
 <AANLkTi=28cEq+XhxCy7pYKtu+bmSNG3QSKMfBUckJ7Tc@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
In-Reply-To: <AANLkTi=28cEq+XhxCy7pYKtu+bmSNG3QSKMfBUckJ7Tc@mail.gmail.com>
X-PGP-Key-ID: 3038867F
User-Agent: Mutt/1.5.20 (2009-06-14)

Not exactly the same code, but the same feature and less bugs. 

    recolor-cmd() {
        region_highlight=()
        colorize=true
        start_pos=0
        for arg in ${(z)BUFFER}; do
            ((start_pos+=${#BUFFER[$start_pos+1,-1]}-${#${BUFFER[$start_pos+1,-1]## #}}))
            ((end_pos=$start_pos+${#arg}))
            if $colorize; then
                colorize=false
                res=$(LC_ALL=C builtin type $arg 2>/dev/null)
                case $res in
                    *'reserved word'*)   style="fg=magenta,bold";;
                    *'alias for'*)       style="fg=cyan,bold";;
                    *'shell builtin'*)   style="fg=yellow,bold";;
                    *'shell function'*)  style='fg=green,bold';;
                    *"$arg is"*)
                        [[ $arg = 'sudo' ]] && style="fg=red,bold" || style="fg=blue,bold";;
                    *)                   style='none,bold';;
                esac
                region_highlight+=("$start_pos $end_pos $style")
            fi
            if [[ $arg = '|' ]] || [[ $arg = 'sudo' ]]; then
                  colorize=true
            fi
            start_pos=$end_pos
        done
    }

    check-cmd-self-insert() { zle .self-insert && recolor-cmd }
    check-cmd-backward-delete-char() { zle .backward-delete-char && recolor-cmd }

    zle -N self-insert check-cmd-self-insert
    zle -N backward-delete-char check-cmd-backward-delete-char

Roy

On Sat, Sep 18, 2010 at 06:03:42PM +0200, Richard Hartmann wrote:
> On Mon, Sep 13, 2010 at 16:34, Julien Nicoulaud
> <julien.nicoulaud@gmail.com> wrote:
> 
> > I created a collaborative notepad, feel free to improve it:
> > http://ethercodes.com/zDUmDAuWiV
> 
> That link does not seem to work, any more.
> 
> 
> Richard
> 

-- 
 ____________________________________________________________ 
/ Nothing will dispel enthusiasm like a small admission fee. \
|                                                            |
\ -- Kim Hubbard                                             /
 ------------------------------------------------------------ 
       \   ,__,
        \  (oo)____
           (__)    )\
              ||--|| *

