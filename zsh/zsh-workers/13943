From zsh-workers-return-13943-mason-zsh=primenet.com.au@sunsite.dk Wed Apr 11 00:02:31 2001
Return-Path: <zsh-workers-return-13943-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24399 invoked from network); 11 Apr 2001 00:02:30 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 11 Apr 2001 00:02:30 -0000
Received: (qmail 21017 invoked by alias); 11 Apr 2001 00:02:27 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13943
Received: (qmail 20988 invoked from network); 11 Apr 2001 00:02:26 -0000
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: Re: Baffling bug with ${(S)...} or ${...//p/r} and math context 
In-reply-to: ""Bart Schaefer""'s message of "Mon, 02 Apr 2001 04:41:19 -0000."
             <1010402044119.ZM14251@candle.brasslantern.com> 
Date: Wed, 11 Apr 2001 01:04:13 +0100
From: Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Message-Id: <20010411000413.E2B8F139CD@pwstephenson.fsnet.co.uk>

"Bart Schaefer" wrote:
> Now here's the strange bit:  If I use that in a math expression (( ... )),
> it gives the correct number, and the inequality evaluates correctly:
> 
> 	((${#${(f)${(%%)${(S)PS1//[%]\{*%\}/}}}[1]} > COLUMNS-2))
> 
> However, if I immediately evaluate the same expression again, the answer
> is different!  E.g., if I do
> 
> 	print ${#${(f)${(%%)${(S)PS1//[%]\{*%\}/}}}[1]}
> 	    ((${#${(f)${(%%)${(S)PS1//[%]\{*%\}/}}}[1]} > COLUMNS-2))
> 	print ${#${(f)${(%%)${(S)PS1//[%]\{*%\}/}}}[1]}
> 
> I'm likely to get
> 
> 	77
> 	86
> 
> as the output.

Hmm, it wouldn't be something to do with the fact that the length of the
output, even excluding %{...%}'s, varies with the status of the previous
command, by any chance?

-- 
Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Work: pws@csr.com
Web: http://www.pwstephenson.fsnet.co.uk

