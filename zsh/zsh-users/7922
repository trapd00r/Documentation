From zsh-users-return-7922-mason-zsh=primenet.com.au@sunsite.dk Tue Aug 24 19:08:19 2004
Return-Path: <zsh-users-return-7922-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1582 invoked from network); 24 Aug 2004 19:08:15 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 24 Aug 2004 19:08:15 -0000
Received: (qmail 4175 invoked from network); 24 Aug 2004 19:08:08 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 24 Aug 2004 19:08:08 -0000
Received: (qmail 20241 invoked by alias); 24 Aug 2004 19:07:24 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 7922
Received: (qmail 20210 invoked from network); 24 Aug 2004 19:07:24 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by 130.225.247.90 with SMTP; 24 Aug 2004 19:07:24 -0000
Received: (qmail 2061 invoked from network); 24 Aug 2004 19:05:25 -0000
Received: from unknown (HELO moonbase.zanshin.com) (167.160.213.139)
  by a.mx.sunsite.dk with SMTP; 24 Aug 2004 19:05:24 -0000
Received: from toltec.zanshin.com (toltec.zanshin.com [64.84.47.166])
	by moonbase.zanshin.com (8.12.11/8.12.11) with ESMTP id i7OJ5M9C027397
	for <zsh-users@sunsite.dk>; Tue, 24 Aug 2004 12:05:22 -0700
Date: Tue, 24 Aug 2004 12:05:22 -0700 (PDT)
From: Bart Schaefer <schaefer@brasslantern.com>
Reply-To: zsh-users@sunsite.dk
To: zsh-users@sunsite.dk
Subject: Re: Using zle outside zsh
In-Reply-To: <20040824170545.GA28326@DervishD>
Message-ID: <Pine.LNX.4.61.0408241153360.10235@toltec.zanshin.com>
References: <20040823155951.GA24279@DervishD> <Pine.LNX.4.61.0408231018430.5997@toltec.zanshin.com>
 <20040823194613.GA25072@DervishD> <Pine.LNX.4.61.0408231436340.3917@toltec.zanshin.com>
 <20040824093921.GA25290@DervishD> <Pine.LNX.4.61.0408240747380.5806@toltec.zanshin.com>
 <20040824170545.GA28326@DervishD>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_44 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0

On Tue, 24 Aug 2004, DervishD wrote:

> >  So pick the last line out of $response and
> > pass that to vared as the prompt, like so:
> > pmpt=${response##$'*\n'}
> 
>     I must use "${response##*$'\n'}" or it doesn't work because the
> '*' is quoted

Oh, yes.  Typo on my part.  Sorry.

> but otherwise it works perfectly. Is there a way of
> making 'vared' not to print a carriage return?

Not really.  'setopt nopromptcr' works initially, but the first time ZLE 
decides to redraw the whole line or minimize the number of characters used 
for a backwards motion, it emits a \r and then things get pretty garbled.  
(Maybe Wayne will see this and fix something.)

>     OTOH, I think that, for a program like 'ftp' that not only prints
> its own set of prompts but uses some server responses as prompts, it
> would be better to read line by line until no more lines are present

Unfortunately there's no way to know *when* "no more lines are present". 
It's a TTY, after all; you don't get an EOF.

>     Seems that the only possible solutions is to know in advance all
> possible prompts and use 'zpty -r COMMAND NAME PATTERN', or using
> zselect, or even using a proxy program that translates and normalizes
> all received prompts including a '\n', or something like that...

zselect might help, because you could look for input from the keyboard
and from the pty at the same time -- but then you can't use vared.

Or you could try something with "zle -F" but I don't know if that works
inside vared (I'd presume it does, but I've never tried).

