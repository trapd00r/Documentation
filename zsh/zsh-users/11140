From zsh-users-return-11140-mason-zsh=primenet.com.au@sunsite.dk Tue Jan 23 14:39:46 2007
Return-Path: <zsh-users-return-11140-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18485 invoked from network); 23 Jan 2007 14:39:41 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 Jan 2007 14:39:41 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 72930 invoked from network); 23 Jan 2007 14:39:35 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 Jan 2007 14:39:35 -0000
Received: (qmail 2410 invoked by alias); 23 Jan 2007 14:39:24 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11140
Received: (qmail 2401 invoked from network); 23 Jan 2007 14:39:23 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 23 Jan 2007 14:39:23 -0000
Received: (qmail 71298 invoked from network); 23 Jan 2007 14:39:23 -0000
Received: from cluster-d.mailcontrol.com (217.69.20.190)
  by a.mx.sunsite.dk with SMTP; 23 Jan 2007 14:39:17 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly19d.srv.mailcontrol.com (MailControl) with ESMTP id l0NEcCBu026401
	for <zsh-users@sunsite.dk>; Tue, 23 Jan 2007 14:39:14 GMT
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Tue, 23 Jan 2007 14:39:09 +0000
Date: Tue, 23 Jan 2007 14:39:06 +0000
From: Peter Stephenson <pws@csr.com>
To: zsh-users@sunsite.dk
Subject: Re: What makes %# tick?
Message-Id: <20070123143906.146ce338.pws@csr.com>
In-Reply-To: <86lkjurkpa.fsf@potato.vegetable.org.uk>
References: <86lkjurkpa.fsf@potato.vegetable.org.uk>
Organization: Cambridge Silicon Radio
X-Mailer: Sylpheed version 2.2.10 (GTK+ 2.10.4; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 23 Jan 2007 14:39:09.0622 (UTC) FILETIME=[3E000D60:01C73EFC]
X-Scanned-By: MailControl A-06-00-00 (www.mailcontrol.com) on 10.68.0.129

Tim Haynes <zsh@stirfried.vegetable.org.uk> wrote:
>  | zsh, sauce 12:15PM piglet/ # id
>  | uid=1000(piglet) gid=1000(piglet)
>  | groups=10(wheel),16(cron),18(audio),19(cdrom),250(portage),1000(piglet)
>  | zsh, sauce 12:15PM piglet/ # 
>                               ^oops.
> 
> I'm running zsh-4.2.5 on an amd64 box (gentoo linux) and am rather attached
> to my %# prompt specifier.

The test of %# uses the function privasserted which is commented thus:

/* Check whether the shell is running with privileges in effect.  *
 * This is the case if EITHER the euid is zero, OR (if the system *
 * supports POSIX.1e (POSIX.6) capability sets) the process'      *
 * Effective or Inheritable capability sets are non-empty.        */

I'm not sure what this feature gains in practice but it's possible your
realtime module means that there is something in the capability sets and
the shell therefore thinks that you are an enchanced lifeform.

There is a workaround.  The shell allows you to test for a particular
effective UID, and in this case there's no funny business about capability
sets.  You can make this otherwise mimic the behaviour of "%#" by replacing
that with "%(#.#.%%)".

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


To access the latest news from CSR copy this link into a web browser:  http://www.csr.com/email_sig.php

To get further information regarding CSR, please visit our Investor Relations page at http://ir.csr.com/csr/about/overview

