From zsh-workers-return-20009-mason-zsh=primenet.com.au@sunsite.dk Wed Jun 02 23:53:54 2004
Return-Path: <zsh-workers-return-20009-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1161 invoked from network); 2 Jun 2004 23:53:16 -0000
Received: from ns2.primenet.com.au (HELO primenet.com.au) (?CkMe6377VjGkvZfQ/k85o+dCdcqoLPeG?@203.24.36.3)
  by ns1.primenet.com.au with SMTP; 2 Jun 2004 23:53:16 -0000
Received: (qmail 5341 invoked from network); 2 Jun 2004 19:01:29 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.86)
  by proxy.melb.primenet.com.au with SMTP; 2 Jun 2004 19:01:29 -0000
Received: (qmail 12338 invoked from network); 2 Jun 2004 19:00:09 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 2 Jun 2004 19:00:09 -0000
Received: (qmail 6868 invoked by alias); 2 Jun 2004 19:00:07 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20009
Received: (qmail 6808 invoked from network); 2 Jun 2004 19:00:07 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (qmailr@130.225.247.86)
  by sunsite.dk with SMTP; 2 Jun 2004 19:00:04 -0000
Received: (qmail 11965 invoked from network); 2 Jun 2004 19:00:03 -0000
Received: from 209-128-98-052.bayarea.net (HELO Yost.com) (209.128.98.52)
  by a.mx.sunsite.dk with SMTP; 2 Jun 2004 19:00:00 -0000
Received: from [209.128.98.50] (ip2 [209.128.98.50])
	by Yost.com (Postfix) with ESMTP
	id 3B082221A70; Wed,  2 Jun 2004 11:59:30 -0700 (PDT)
Mime-Version: 1.0
X-Sender: yost@mail4.yost.com
Message-Id: <pdy98830611045dbce3ca1d0698@[209.128.98.50]>
In-Reply-To: <200406020932.i529WIfO024138@news01.csr.com>
References: <200406020932.i529WIfO024138@news01.csr.com>
Date: Wed, 2 Jun 2004 11:21:20 -0700
To: Peter Stephenson <pws@csr.com>
From: Dave Yost <Dave@Yost.com>
Subject: Re: zsh malloc bug
Cc: zsh-workers@sunsite.dk
Content-Type: text/plain; charset="us-ascii"
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

At 10:32 AM +0100 2004-06-02, Peter Stephenson wrote:
>Dave Yost wrote:
>> Z% echo $ZSH_VERSION
>> 4.1.1
>> Z% uname -a
>> Darwin ip2 7.4.0 Darwin Kernel Version 7.4.0: Wed May 12 16:58:24 PDT 2004; r
>> oot:xnu/xnu-517.7.7.obj~7/RELEASE_PPC  Power Macintosh powerpc
>
>Thanks for the report... could you try 4.2.0?  Traps have changed in
>various ways and this doesn't happen after a short test on my latest
>code.

zsh 4.2.0 hangs on my cygwin system when I try some of these scenarios.

BTW, the TRAPxxx documentation should be more explicit about whether trapping the event prevents exit and what happens if you exit explicitly from within the trap.

Thanks

Dave

==============================
#!/bin/zsh

reason=

TRAPINT() {
	#echo int
	reason=int
	exit 100
}

TRAPZERR() {
	#echo zerr
	reason=zerr
	exit 101 # is this necessary?
}

TRAPEXIT() {
	echo exit $reason
	# exit?
}

sleep $1

# Try ^C here sometimes.

echo after sleep

set -e

cp

echo after command

