From zsh-users-return-12154-mason-zsh=primenet.com.au@sunsite.dk Wed Oct 31 15:43:08 2007
Return-Path: <zsh-users-return-12154-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3294 invoked from network); 31 Oct 2007 15:42:59 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,HTML_MESSAGE
	autolearn=ham version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 31 Oct 2007 15:42:59 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 82093 invoked from network); 31 Oct 2007 15:42:53 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 31 Oct 2007 15:42:53 -0000
Received: (qmail 5585 invoked by alias); 31 Oct 2007 15:42:44 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12154
Received: (qmail 14137 invoked from network); 31 Oct 2007 15:14:41 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 31 Oct 2007 15:14:41 -0000
Received: (qmail 65655 invoked from network); 31 Oct 2007 15:14:41 -0000
Received: from rv-out-0910.google.com (209.85.198.184)
  by a.mx.sunsite.dk with SMTP; 31 Oct 2007 15:14:35 -0000
Received: by rv-out-0910.google.com with SMTP id b22so135734rvf
        for <zsh-users@sunsite.dk>; Wed, 31 Oct 2007 08:14:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=beta;
        h=domainkey-signature:received:received:message-id:date:from:to:subject:mime-version:content-type;
        bh=tE1Enczz1Y/GoQfBo14Q3KkpRrHSzSluMt2ycnYN4PQ=;
        b=qPXC8fiaudzIZmxns401YJVdweAhPhRIbICXumrb5RKxAvbCHWOW3mNs/7kyBuNZ4rPY+51nvDA7WppCkmL2fvjM9D1wMaZFFQGXOWXRGsHxX9uW3uUtC7tNDf/BU0dd41L+2RopzNcF0xCz34afDT3Zb+20VeACGhe+i9GHvss=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=beta;
        h=received:message-id:date:from:to:subject:mime-version:content-type;
        b=sDKKr0PURqYEIoPvd2bQDFwkjx+FEuyy51dn0x/LL5eCQW9Kp1lAbZ1mst1Ksilh5LzjT2K8+Saw+f1cf/+XKrcYzLZqxBJZdM3ea07PQhnzp3rILCKj2z1LMr0/vYlpCoPpU89Im2uDTwhmp+YJoMg2EViM+ptCgGzVS4nPWGQ=
Received: by 10.141.34.12 with SMTP id m12mr3998217rvj.1193843669186;
        Wed, 31 Oct 2007 08:14:29 -0700 (PDT)
Received: by 10.141.189.12 with HTTP; Wed, 31 Oct 2007 08:14:29 -0700 (PDT)
Message-ID: <fba8f3540710310814l66068e30h2263cf8c455d36ad@mail.gmail.com>
Date: Wed, 31 Oct 2007 10:14:29 -0500
From: "Ryan F" <urbaleeted@gmail.com>
To: zsh-users@sunsite.dk
Subject: _groups change for Mac OS X version 10.5
MIME-Version: 1.0
Content-Type: multipart/alternative; 
	boundary="----=_Part_4966_10175758.1193843669175"

------=_Part_4966_10175758.1193843669175
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

Hi,
In Mac OS X version 10.5, the lookupd command has been replaced with
dscacheutil, which requires a change to _groups in order for group
completion to work properly.  Here's what Apple has done:

--- zsh-4.3.4/Completion/Unix/Type/_groups 2005-06-08 07:45:35.000000000-0500
+++ /usr/share/zsh/4.3.4/functions/_groups 2007-09-23 20:40:47.000000000-0500
@@ -7,7 +7,7 @@
if ! zstyle -a ":completion:${curcontext}:" groups groups; then
 (( $+_cache_groups )) ||
     if [[ $OSTYPE = darwin* ]]; then
-        : ${(A)_cache_groups:=${${(M)${(f)"$(_call_program groups lookupd
-q group)"}:#name*}##*: }}
+        : ${(A)_cache_groups:=${${(M)${(f)"$(_call_program groups
dscacheutil -q group)"}:#name*}##*: }}
     elif (( ${+commands[getent]} )); then
       : ${(A)_cache_groups:=${${(s: :)$(_call_program groups getent group
2>/dev/null)}%%:*}}
     else

However, this change would break pre-10.5 systems which have lookupd and not
dscacheutil.  I propose something like this:

--- zsh-4.3.4/Completion/Unix/Type/_groups.orig 2007-10-28 16:41:
48.000000000 -0500
+++ zsh-4.3.4/Completion/Unix/Type/_groups 2007-10-28 16:42:55.000000000-0500
@@ -7,7 +7,11 @@
if ! zstyle -a ":completion:${curcontext}:" groups groups; then
 (( $+_cache_groups )) ||
     if [[ $OSTYPE = darwin* ]]; then
-        : ${(A)_cache_groups:=${${(M)${(f)"$(_call_program groups lookupd
-q group)"}:#name*}##*: }}
+        if (( ${+commands[lookupd]} )); then
+          : ${(A)_cache_groups:=${${(M)${(f)"$(_call_program groups lookupd
-q group)"}:#name*}##*: }}
+        elif (( ${+commands[dscacheutil]} )); then
+          : ${(A)_cache_groups:=${${(M)${(f)"$(_call_program groups
dscacheutil -q group)"}:#name*}##*: }}
+        fi
     elif (( ${+commands[getent]} )); then
       : ${(A)_cache_groups:=${${(s: :)$(_call_program groups getent group
2>/dev/null)}%%:*}}
     else

I suppose one could even get rid of the 'if [[ $OSTYPE == darwin* ]];
then...fi' part but that may not be as safe if non-OS X systems ever
implement lookupd and/or dscacheutil commands which behave differently from
the same commands on OS X.

------=_Part_4966_10175758.1193843669175
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

<font class="Apple-style-span" face="Monaco" size="3"><span class="Apple-style-span" style="font-size: 11px;">Hi,<br><span class="Apple-tab-span" style="white-space: pre; ">	</span>In Mac OS X version 10.5, the lookupd command has been replaced with dscacheutil, which requires a change to _groups in order for group completion to work properly. &nbsp;Here&#39;s what Apple has done:
<br><br>--- zsh-4.3.4/Completion/Unix/Type/_groups<span class="Apple-tab-span" style="white-space: pre; ">	</span>2005-06-08 07:45:35.000000000 -0500<br>+++ /usr/share/zsh/4.3.4/functions/_groups<span class="Apple-tab-span" style="white-space: pre; ">
	</span>2007-09-23 20:40:47.000000000 -0500<br>@@ -7,7 +7,7 @@<br>if ! zstyle -a &quot;:completion:${curcontext}:&quot; groups groups; then<br>&nbsp;(( $+_cache_groups )) ||<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if [[ $OSTYPE = darwin* ]]; then<br>- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ${(A)_cache_groups:=${${(M)${(f)&quot;$(_call_program groups lookupd -q group)&quot;}:#name*}##*: }}
<br>+ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ${(A)_cache_groups:=${${(M)${(f)&quot;$(_call_program groups dscacheutil -q group)&quot;}:#name*}##*: }}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif (( ${+commands[getent]} )); then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ${(A)_cache_groups:=${${(s: :)$(_call_program groups getent group 2&gt;/dev/null)}%%:*}}
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br><br>However, this change would break pre-10.5 systems which have lookupd and not dscacheutil. &nbsp;I propose something like this:<br><br>--- zsh-4.3.4/Completion/Unix/Type/_groups.orig<span class="Apple-tab-span" style="white-space: pre; ">
	</span>2007-10-28 16:41:48.000000000 -0500<br>+++ zsh-4.3.4/Completion/Unix/Type/_groups<span class="Apple-tab-span" style="white-space: pre; ">	</span>2007-10-28 16:42:55.000000000 -0500<br>@@ -7,7 +7,11 @@<br>if ! zstyle -a &quot;:completion:${curcontext}:&quot; groups groups; then
<br>&nbsp;(( $+_cache_groups )) ||<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if [[ $OSTYPE = darwin* ]]; then<br>- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ${(A)_cache_groups:=${${(M)${(f)&quot;$(_call_program groups lookupd -q group)&quot;}:#name*}##*: }}<br>+ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (( ${+commands[lookupd]} )); then
<br>+ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ${(A)_cache_groups:=${${(M)${(f)&quot;$(_call_program groups lookupd -q group)&quot;}:#name*}##*: }}<br>+ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif (( ${+commands[dscacheutil]} )); then<br>+ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ${(A)_cache_groups:=${${(M)${(f)&quot;$(_call_program groups dscacheutil -q group)&quot;}:#name*}##*: }}
<br>+ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif (( ${+commands[getent]} )); then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ${(A)_cache_groups:=${${(s: :)$(_call_program groups getent group 2&gt;/dev/null)}%%:*}}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br><br>I suppose one could even get rid of the &#39;if [[ $OSTYPE == darwin* ]]; then...fi&#39; part but that may not be as safe if non-OS X systems ever implement lookupd and/or dscacheutil commands which behave differently from the same commands on OS X.
</span></font>

------=_Part_4966_10175758.1193843669175--

