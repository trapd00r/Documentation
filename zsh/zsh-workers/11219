From zsh-workers-return-11219-mason-zsh=primenet.com.au@sunsite.auc.dk Fri May 05 20:32:52 2000
Return-Path: <zsh-workers-return-11219-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11070 invoked from network); 5 May 2000 20:32:46 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 5 May 2000 20:32:46 -0000
Received: (qmail 11998 invoked by alias); 5 May 2000 20:32:38 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11219
Received: (qmail 11872 invoked from network); 5 May 2000 20:32:28 -0000
To: "ZSH workers mailing list" <zsh-workers@sunsite.auc.dk>
Subject: Re: CVS completion and verbose listing
References: <002501bfb6b0$1c7433a0$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0 (generated by SEMI 1.13.7 - "Awazu")
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@m17n.org>
Date: 06 May 2000 05:33:26 +0900
In-Reply-To: <002501bfb6b0$1c7433a0$21c9ca95@mow.siemens.ru>
 (Andrej Borsenkow's message of "Fri, 5 May 2000 20:36:49 +0400")
Message-ID: <hvoln1oohyh.fsf@serein.m17n.org>
Lines: 727
User-Agent: T-gnus/6.14.1 (based on Gnus v5.8.3) (revision 16) SEMI/1.13.7 (Awazu) FLIM/1.13.2 (Kasanui) Emacs/20.6 (i686-pc-linux-gnu) MULE/4.0 (HANANOEN)

In article <002501bfb6b0$1c7433a0$21c9ca95@mow.siemens.ru>,
  "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru> writes:

> bor@itsrm2% cvs -
> Completing option
> --allow-root      -H                -e                -s
> --help            -Q                -f                -t
> --help-commands   -T                -l                -v
> --help-options    -a                -n                -w
> --help-synonyms   -b                -q                -x
> --version         -d                -r                -z
> 
> I do have verbose style set by default. And (unforunately) -x, -z, etc
> do not tell me much.

This patch adds verbose descriptions to _cvs.

But I didn't removed -x, -z, etc because cvs-1.10.8 has them.
Although some old cvs may not have them, I didn't tried to check it.

Would you add some version check?

This patch fix some typos in _diff_options.  Although I consider to
use _diff_options from _cvs, I didn't do it because _diff_options
completes some surplus options such as -l, -T, -r, etc.

Index: Completion/User/_cvs
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/User/_cvs,v
retrieving revision 1.5
diff -u -r1.5 _cvs
--- Completion/User/_cvs	2000/05/05 16:17:38	1.5
+++ Completion/User/_cvs	2000/05/05 20:21:53
@@ -5,15 +5,30 @@
 _cvs () {
   # "+Qqrwtnlvb:T:e:d:Hfz:s:xa"
   _arguments -s \
-    -{a,f,H,l,n,Q,q,r,t,v,w,x} \
-    '--version' '--help' '--help-commands' '--help-synonyms' '--help-options' \
-    '*--allow-root=:rootdir:_files -/' \
-    '-b+:bindir:_cvs_bindir' \
-    '-T+:temporary directory:_cvs_tempdir' \
-    '-d+:cvsroot:_cvs_root' \
-    '-e+:editor:_cvs_editor' \
-    '-s+:user variable:_cvs_user_variable' \
-    '-z+:gzip level:_cvs_gzip_level' \
+    '-a[authenticate]' \
+    '-f[disable .cvsrc]' \
+    '(-n)-l[disable logging]' \
+    '(-l)-n[no change]' \
+    '(-q)-Q[really quiet]' \
+    '(-Q)-q[somewhat quiet]' \
+    '(-w)-r[make new working file read only]' \
+    '-t[trace]' \
+    '(-r)-w[make new working file read-write]' \
+    '-x[encrypt client/server communication]' \
+    '(--version)-v[print version]' \
+    '(-v)--version[print version]' \
+    '(   --help --help-commands --help-synonyms --help-options)-H[print help]' \
+    '(-H        --help-commands --help-synonyms --help-options)--help[print help]' \
+    '(-H --help                 --help-synonyms --help-options)--help-commands[command help]' \
+    '(-H --help --help-commands                 --help-options)--help-synonyms[command synonyms help]' \
+    '(-H --help --help-commands --help-synonyms               )--help-options[global options help]' \
+    '*--allow-root=[allowable root for pserver]:rootdir:_files -/' \
+    '-b+[binary directory]:bindir:_cvs_bindir' \
+    '-T+[temporary directory]:temporary directory:_cvs_tempdir' \
+    '-d+[cvs root directory]:cvsroot:_cvs_root' \
+    '-e+[editor]:editor:_cvs_editor' \
+    '-s+[user variable]:user variable:_cvs_user_variable' \
+    '-z+[gzip level]:gzip level:_cvs_gzip_level' \
     '*::cvs command:_cvs_command'
 }
 
@@ -54,8 +69,8 @@
 _cvs_add () {
   # "+k:m:"
   _arguments -s \
-    '-k+:keyword substitution:_cvs_k' \
-    '-m+:message:_cvs_m' \
+    '-k+[keyword]:keyword substitution:_cvs_k' \
+    '-m+[message]:message:_cvs_m' \
     '*:file:_cvs_files_unmaintained' \
 }
 
@@ -63,22 +78,26 @@
 _cvs_admin () {
   # "+ib::c:a:A:e:l::u::LUn:N:m:o:s:t::IqxV:k:"
   _arguments -s \
-    -{i,L,U,I,q,x} \
-    '-b-:default branch:(1.1.1)' \
+    -{i,x} \
+    '(-U)-L[set lock strict]' \
+    '(-L)-U[set locl non-strict]' \
+    '-I[interactive]' \
+    '-q[quiet]' \
+    '-b-[default branch]:default branch:(1.1.1)' \
     '-c+:comment leader (not used):' \
     '-a+:login names (not work with CVS):' \
     '-A+:access list to append (not work with CVS):' \
     '-e+:access list to erase (not work with CVS):' \
-    '-l-:revision to lock:' \
-    '-u-:revision to unlock:' \
-    '-n+:symbolic-name(\:revision):' \
-    '-N+:symbolic-name(\:revision):' \
-    '-m+:revision\:msg:' \
-    '-o+:range to delete:' \
-    '-s+:state(\:revision):' \
-    '-t-:descriptive text:_cvs_admin_t' \
+    '-l-[lock]:revision to lock:' \
+    '-u-[unlock]:revision to unlock:' \
+    '-n+[name revision]:symbolic-name(\:revision):' \
+    '-N+[force to name revision]:symbolic-name(\:revision):' \
+    '-m+[replace log]:revision\:msg:' \
+    '-o+[delete revision]:range to delete:' \
+    '-s+[replace state attribute]:state(\:revision):' \
+    '-t-[replace descriptive text]:descriptive text:_cvs_admin_t' \
     '-V+:version (obsolete):' \
-    '-k+:keyword substitution:_cvs_k' \
+    '-k+[set keyword substitution]:keyword substitution:_cvs_k' \
     '*:file:_cvs_files'
 }
 
@@ -95,9 +114,11 @@
 _cvs_annotate () {
   # "+lr:D:fR"
   _arguments -s \
-    -{l,f,R} \
-    '-r+:tag:_cvs_revisions' \
-    '-D+:date:_cvs_D' \
+    '(-R)-l[don'\''t recursive]' \
+    '-f[use head revision]' \
+    '(-l)-R[recursive]' \
+    '(-f -D)-r+[specify revision]:tag:_cvs_revisions' \
+    '(-f -r)-D+[specify date]:date:_cvs_D' \
     '*:file:_cvs_files'
 }
 
@@ -105,12 +126,21 @@
 _cvs_checkout () {
   # "+ANnk:d:flRpQqcsr:D:j:P"
   _arguments -s \
-    -{A,N,n,f,l,R,q,c,s,P} \
-    '-k+:keyword substitution:_cvs_k' \
-    '-d+:directory:_files -/' \
-    '-r+:tag:_cvs_revisions' \
-    '-D+:date:_cvs_D' \
-    '-j+:tag:_cvs_revisions' \
+    '-A[reset sticky tags, dates and -k]' \
+    '-N[don'\''t shorten module paths]' \
+    '-n[disable checkout program]' \
+    '-f[use most recent revision if -D/-r is not matched]' \
+    '(-R)-l[don'\''t recursive]' \
+    '(-l)-R[recursive]' \
+    '(-s)-c[module database]' \
+    '(-c)-s[module database with status]' \
+    '-P[prune empty directory]' \
+    '-k+[keyword]:keyword substitution:_cvs_k' \
+    '-d+[directory]:directory:_files -/' \
+    '(-D)-r+[specify revision]:tag:_cvs_revisions' \
+    '(-r)-D+[specify date]:date:_cvs_D' \
+    '-j+[merge]:tag:_cvs_revisions' \
+    '-j+[merge]:tag:_cvs_revisions' \
     '*:module:_cvs_modules'
 }
 
@@ -118,59 +148,123 @@
 _cvs_commit () {
   # "+nlRm:fF:r:"
   _arguments -s \
-    -{n,l,R,f} \
-    '-m+:message:_cvs_m' \
-    '-F+:log message file:_files' \
-    '-r+:tag:_cvs_revisions' \
+    '-n[disable module program]' \
+    '(-R)-l[don'\''t recursive]' \
+    '(-l)-R[recursive]' \
+    '-f[force to commit]' \
+    '(-F)-m+[message]:message:_cvs_m' \
+    '(-m)-F+[message file]:log message file:_files' \
+    '-r+[specify revision]:tag:_cvs_revisions' \
     '*:file:_cvs_files_modified'
 }
 
 (( $+functions[_cvs_diff] )) ||
 _cvs_diff () {
+  local of ofwuc ouc oss ofwy ofwg ofwl
+  # output formats
+  of="-y --side-by-side -n --rcs -e -f --ed -q --brief -c -C --context -u -U \
+  --unified --old-group-format --new-group-format --changed-group-format \
+  --unchanged-group-format --line-format --old-line-format --new-line-format \
+  --unchanged-line-format"
+
+  # output formats w/o unified and context
+  ofwuc="-y --side-by-side -n --rcs -e -f --ed -q --brief --old-group-format \
+  --new-group-format --changed-group-format --unchanged-group-format \
+  --line-format --old-line-format --new-line-format --unchanged-line-format"
+
+  # option specific to unified or context diff
+  ouc='-L --label -p --show-c-function -F --show-function-line'
+
+  # option specific to side by side
+  oss='-W --width --left-column --suppress-common-lines'
+
+  # output formats w/o side by side
+  ofwy="-n --rcs -e -f --ed -q --brief -c -C --context -u -U --unified \
+  --old-group-format --new-group-format --changed-group-format \
+  --unchanged-group-format --line-format --old-line-format \
+  --new-line-format --unchanged-line-format"
+
+  # output formats w/o group format
+  ofwg="-n --rcs -e -f --ed -q --brief -c -C --context -u -U --unified \
+  --line-format --old-line-format --new-line-format --unchanged-line-format"
+
+  # output formats w/o line format
+  ofwl="-n --rcs -e -f --ed -q --brief -c -C --context -u -U --unified \
+  --old-group-format --new-group-format --changed-group-format \
+  --unchanged-group-format"
+
   # "+abcdefhilnpstuw0123456789BHNRC:D:F:I:L:U:V:W:k:r:"
   _arguments -s \
-    -{l,R} \
-    '-D+:date:_cvs_D' \
-    '-k+:keyword substitution:_cvs_k' \
-    '-r+:tag:_cvs_revisions' \
-    -{h,p,0,1,2,3,4,5,6,7,8,9} \
-    '--binary' \
-    '--brief' \
-    '--changed-group-format=:format:' \
-    '-c' '-C+:lines:' '--context=-:lines:' \
-    '-e' '--ed' \
-    '-t' '--expand-tabs' \
-    '-f' '--forward-ed' \
-    '--horizon-lines=:lines:' \
-    '--ifdef=:name:' \
-    '-w' '--ignore-all-space' \
-    '-B' '--ignore-blank-lines' \
-    '-i' '--ignore-case' \
-    '-I+:regex:' '--ignore-matching-lines=:regex:' \
-    '-b' '--ignore-space-change' \
-    '--initial-tab' \
-    '*-L+:label:' '*--label=:label:' \
-    '--left-column' \
-    '--line-format=:format:' \
-    '-d' '--minimal' \
-    '-N' '--new-file' \
-    '--new-group-format=:format:' \
-    '--new-line-format=:format:' \
-    '--old-group-format=:format:' \
-    '--old-line-format=:format:' \
-    '--paginate' \
-    '-n' '--rcs' \
-    '-s' '--report-identical-files' \
-    '--show-c-function' \
-    '-F+:regex:' '--show-function-line=:regex:' \
-    '-y' '--side-by-side' \
-    '-H' '--speed-large-files' \
-    '--suppress-common-lines' \
-    '-a' '--text' \
-    '--unchanged-group-format=:format:' \
-    '--unchanged-line-format=:format:' \
-    '-u' '-U+:lines:' '--unified=-:lines:' \
-    '-W:columns:' '--width=:columns:' \
+    '(-R)-l[don'\''t recursive]' \
+    '(-l)-R[recursive]' \
+    '-k+[keyword]:keyword substitution:_cvs_k' \
+    '(-r)-D+[specify date]:date:_cvs_D' \
+    '(-r)-D+[specify date]:date:_cvs_D' \
+    '(-D)-r+[specify revision]:tag:_cvs_revisions' \
+    '(-D)-r+[specify revision]:tag:_cvs_revisions' \
+    -{h,0,1,2,3,4,5,6,7,8,9} \
+    '--binary[binary mode]' \
+    '--ifdef=[set macro name for merged if-then-else format]:name:' \
+    '(-i)--ignore-case[case insensitive]' \
+    '(--ignore-case)-i[case insensitive]' \
+    '(-w)--ignore-all-space[ignore all white space]' \
+    '(--ignore-all-space)-w[ignore all white space]' \
+    '(-b)--ignore-space-change[ignore changes in the amount of white space]' \
+    '(--ignore-space-change)-b[ignore changes in the amount of white space]' \
+    '(-B)--ignore-blank-lines[ignore lines that are all blank]' \
+    '(--ignore-blank-lines)-B[ignore lines that are all blank]' \
+    '(-I)--ignore-matching-lines=[ignore lines that match regex]:line exclusion regex:' \
+    '(--ignore-matching-lines)-I+[ignore lines that match regex]:line exclusion regex:' \
+    '(-a)--text[treat all files as text]' \
+    '(--text)-a[treat all files as text]' \
+    "($of $oss)--context=-[context diff]:number of lines of copied context:" \
+    "($of $oss)-C+[output a context diff]:number of lines of copied context:" \
+    "($of $oss)-c[output a context diff]" \
+    "($of $oss)--unified=-[output a unified diff]:number of lines of unified context:" \
+    "($of $oss)-U+[output a unified diff]:number of lines of unified context:" \
+    "($of $oss)-u[output a unified diff]" \
+    "($ofwuc $oss -L)--label=[set label to use instead of file name]:label:" \
+    "($ofwuc $oss --label)-L+[set label to use instead of file name]:label:" \
+    "($ofwuc $oss -L)--label=[set label to use instead of file name]:label:" \
+    "($ofwuc $oss --label)-L+[set label to use instead of file name]:label:" \
+    "($ofwuc $oss -p)--show-c-function[show C function of each change]" \
+    "($ofwuc $oss --show-c-function)-p[show C function of each change]" \
+    "($ofwuc $oss -F)--show-function-line=[show the most recent line matching regex]:regex:" \
+    "($ofwuc $oss --show-function-line)-F+[show the most recent line matching regex]:regex:" \
+    "($of $ouc $oss)--brief[output only whether files differ]" \
+    "($of $ouc $oss)--ed[output an ed script]" \
+    "($of $ouc $oss)-e[output an ed script]" \
+    "($of $ouc $oss)--forward-ed[output a reversed ed script]" \
+    "($of $ouc $oss)-f[output a reversed ed script]" \
+    "($of $ouc $oss)--rcs[RCS format diff]" \
+    "($of $ouc $oss)-n[RCS format diff]" \
+    "($of $ouc)--side-by-side[output in two columns]" \
+    "($of $ouc)-y[output in two columns]" \
+    "($ofwy $ouc -W)--width=[set size of line]:number of characters per line:" \
+    "($ofwy $ouc --width)-W+[set size of line]:number of characters per line:" \
+    "($ofwy $ouc)--left-column[output only left column of common lines]" \
+    "($ofwy $ouc)--suppress-common-lines[do not output common lines]" \
+    "($ofwg $ouc $oss)--old-group-format=[set old group format]:old group format:" \
+    "($ofwg $ouc $oss)--new-group-format=[set new group format]:new group format:" \
+    "($ofwg $ouc $oss)--changed-group-format=[set changed group format]:changed group format:" \
+    "($ofwg $ouc $oss)--unchanged-group-format=[set unchanged group format]:unchanged group format:" \
+    "($ofwl $ouc $oss)--line-format=[set line format]:line format:" \
+    "($ofwl $ouc $oss)--old-line-format=[set old line format]:old line format:" \
+    "($ofwl $ouc $oss)--new-line-format=[set new line format]:new line format:" \
+    "($ofwl $ouc $oss)--unchanged-line-format=[set unchanged line format]:unchanged line format:" \
+    '--paginate[output through pr]' \
+    '(-t)--expand-tabs[expand tabs to spaces]' \
+    '(--expand-tabs)-t[expand tabs to spaces]' \
+    '--initial-tab[prepend a tab]' \
+    '(-N)--new-file[treat absent files as empty]' \
+    '(--new-file)-N[treat absent files as empty]' \
+    '(-s)--report-identical-files[report when two files are the same]' \
+    '(--report-identical-files)-s[report when two files are the same]' \
+    '--horizon-lines=[set number of lines to keep in prefix and suffix]:number of horizon lines:' \
+    '(-d)--minimal[try to find a smaller set of changes]' \
+    '(--minimal)-d[try to find a smaller set of changes]' \
+    '(-H)--speed-large-files[assume large files and many small changes]' \
+    '(--speed-large-files)-H[assume large files and many small changes]' \
     '*:file:_cvs_diff_arg'
 }
 
@@ -183,8 +277,9 @@
 _cvs_edit () {
   # "+lRa:"
   _arguments -s \
-    -{l,R} \
-    '-a+:action:(edit unedit commit all none)' \
+    '(-R)-l[don'\''t recursive]' \
+    '(-l)-R[recursive]' \
+    '-a+[specify action]:action:(edit unedit commit all none)' \
     '*:file:_cvs_files'
 }
 
@@ -192,7 +287,8 @@
 _cvs_editors () {
   # "+lR"
   _arguments -s \
-    -{l,R} \
+    '(-R)-l[don'\''t recursive]' \
+    '(-l)-R[recursive]' \
     '*:file:_cvs_files'
 }
 
@@ -200,11 +296,15 @@
 _cvs_export () {
   # "+Nnk:d:flRQqr:D:"
   _arguments -s \
-    -{N,n,f,l,R,Q,q} \
-    '-k+:keyword substitution:_cvs_k' \
-    '-d+:directory:_files -/' \
-    '-r+:tag:_cvs_revisions' \
-    '-D+:date:_cvs_D' \
+    '-N[don'\''t shorten module paths]' \
+    '-n[disable checkout program]' \
+    '-f[use most recent revision if -D/-r is not matched]' \
+    '(-R)-l[don'\''t recursive]' \
+    '(-l)-R[recursive]' \
+    '-k+[keyword]:keyword substitution:_cvs_k' \
+    '-d+[directory]:directory:_files -/' \
+    '(-D)-r+[specify revision]:tag:_cvs_revisions' \
+    '(-r)-D+[specify date]:date:_cvs_D' \
     '*:module:_cvs_modules'
 }
 
@@ -212,19 +312,25 @@
 _cvs_history () {
   # "+Tacelow?D:b:f:m:n:p:r:t:u:x:X:z:"
   _arguments -s \
-    -{T,a,c,e,l,o,w,\?} \
-    '-D+:date:_cvs_D' \
-    '-b+:string:' \
-    '-f+:file:_cvs_files' \
-    '-m+:module:_cvs_modules' \
-    '-n+:module:_cvs_modules' \
-    '*-p+:repository:' \
-    '-r+:rev:' \
-    '-t+:tag:' \
-    '-u+:user name:' \
-    '-x+:type:_cvs_history_x' \
-    '-X+:arg:' \
-    '-z+:timezone:' \
+    '-T[all tags]' \
+    '-a[all users]' \
+    '-c[modified files]' \
+    '-e[everything]' \
+    '-l[last modification]' \
+    '-o[check-outed modules]' \
+    '-w[working directory]' \
+    '-D+[since date]:date:_cvs_D' \
+    '-b+[back to record]:string:' \
+    '-f+[specify file]:file:_cvs_files' \
+    '-m+[specify module]:module:_cvs_modules' \
+    '*-n+[in module]:module:_cvs_modules' \
+    '*-p+[in repository]:repository:' \
+    '-r+[since revision]:rev:' \
+    '-t+[since tag]:tag:' \
+    '*-u+[specify user]:user name:' \
+    '-x+[specify type]:type:_cvs_history_x' \
+    '-X+[debugging]:arg:' \
+    '-z+[specify timezone]:timezone:' \
     '*:file:_cvs_files'
 }
 
@@ -248,12 +354,12 @@
 _cvs_import () {
   # "+Qqdb:m:I:k:W:"
   _arguments -s \
-    -{Q,q,d} \
-    '-b+:branch:' \
-    '-m+:message:_cvs_m' \
-    '*-I+:name:_files' \
-    '-k+:keyword substitution:_cvs_k' \
-    '*-W+:spec:' \
+    '-d[use file modification time]' \
+    '-b+[specify vendor branch]:branch:' \
+    '-m+[message]:message:_cvs_m' \
+    '*-I+[ignore files]:name:_files' \
+    '-k+[keyword]:keyword substitution:_cvs_k' \
+    '*-W+[wrapper specification]:spec:_files' \
     ':repository:_cvs_modules' \
     ':vendor tag:' \
     ':release tag:'
@@ -268,11 +374,16 @@
 _cvs_log () {
   # "+bd:hlNRr::s:tw::"
   _arguments -s \
-    -{b,h,l,N,R,t} \
-    '-d+:dates:' \
-    '-r-:revisions:' \
-    '-s+:states:' \
-    '-w-:logins:' \
+    '-b[default branch]' \
+    '(-t)-h[header]' \
+    '(-R)-l[don'\''t recursive]' \
+    '(-l)-R[recursive]' \
+    '-N[don'\''t list tags]' \
+    '(-h)-t[header with descriptive text]' \
+    '-d+[specify dates]:dates:' \
+    '-r-[specify revisions]:revisions:' \
+    '-s+[specify states]:states:(Exp Stab Rel dead)' \
+    '-w-[specify logins]:logins:' \
     '*:file:_cvs_files'
 }
 
@@ -290,11 +401,19 @@
 _cvs_rdiff () {
   # "+V:k:cuftsQqlRD:r:"
   _arguments -s \
-    -{c,u,f,t,s,Q,q,l,R} \
-    '-V+:version:' \
-    '-k+:keyword substitution:_cvs_k' \
-    '*-D+:date:_cvs_D' \
-    '*-r+:tag:_cvs_revisions' \
+    '-c[output a context diff]' \
+    '-u[output a unified diff]' \
+    '-f[use most recent revision if -D/-r is not matched]' \
+    '-s[short patch]' \
+    '(-R)-l[don'\''t recursive]' \
+    '(-l)-R[recursive]' \
+    '-V+[specify version]:version:' \
+    '-k+[keyword]:keyword substitution:_cvs_k' \
+    '(-D -D -r -r)-t[top two differences]' \
+    '(-t -r)-D+[specify date]:date:_cvs_D' \
+    '(-t -r)-D+[specify date]:date:_cvs_D' \
+    '(-t -D)-r+[specify revision]:tag:_cvs_revisions' \
+    '(-t -D)-r+[specify revision]:tag:_cvs_revisions' \
     '*:module:_cvs_modules'
 }
 
@@ -302,7 +421,7 @@
 _cvs_release () {
   # "+Qdq"
   _arguments -s \
-    -{Q,d,q} \
+    '-d[delete]' \
     '*:directory:_files -/'
 }
 
@@ -310,7 +429,9 @@
 _cvs_remove () {
   # "+flR"
   _arguments -s \
-    -{f,l,R} \
+    '-f[force to remove]' \
+    '(-R)-l[don'\''t recursive]' \
+    '(-l)-R[recursive]' \
     '*:file:_cvs_files_removed'
 }
 
@@ -318,9 +439,16 @@
 _cvs_rtag () {
   # "+FanfQqlRdbr:D:"
   _arguments -s \
-    -{F,a,n,f,Q,q,l,R,d,b} \
-    '*-D+:date:_cvs_D' \
-    '*-r+:tag:_cvs_revisions' \
+    '(-d)-F[move tag if already exists]' \
+    '(-d)-a[clear tag from removed files]' \
+    '-n[disable tag program]' \
+    '(-d)-f[force a head revision]' \
+    '(-R)-l[don'\''t recursive]' \
+    '(-l)-R[recursive]' \
+    '(-b)-d[delete tag]' \
+    '(-d)-b[create branch]' \
+    '-D+[specify date]:date:_cvs_D' \
+    '-r+[specify revision]:tag:_cvs_revisions' \
     ':tag:' \
     '*:module:_cvs_modules'
 }
@@ -329,7 +457,9 @@
 _cvs_status () {
   # "+vlR"
   _arguments -s \
-    -{v,l,R} \
+    '-v[verbose]' \
+    '(-R)-l[don'\''t recursive]' \
+    '(-l)-R[recursive]' \
     '*:file:_cvs_files'
 }
 
@@ -337,9 +467,15 @@
 _cvs_tag () {
   # "+FQqlRcdr:D:bf"
   _arguments -s \
-    -{F,Q,q,l,R,c,d,b,f} \
-    '-r+:tag:_cvs_revisions' \
-    '-D+:date:_cvs_D' \
+    '(-d)-F[move tag if already exists]' \
+    '(-R)-l[don'\''t recursive]' \
+    '(-l)-R[recursive]' \
+    '-c[check that working files unmodified]' \
+    '(-b)-d[delete tag]' \
+    '(-d)-b[create branch]' \
+    '(-d)-f[force a head revision]' \
+    '-r+[specify revision]:tag:_cvs_revisions' \
+    '-D+[specify date]:date:_cvs_D' \
     ':tag:' \
     '*:file:_cvs_files'
 }
@@ -348,7 +484,8 @@
 _cvs_unedit () {
   # "+lR"
   _arguments -s \
-    -{l,R} \
+    '(-R)-l[don'\''t recursive]' \
+    '(-l)-R[recursive]' \
     '*:file:_cvs_files'
 }
 
@@ -356,13 +493,20 @@
 _cvs_update () {
   # "+ApCPflRQqduk:r:D:j:I:W:"
   _arguments -s \
-    -{A,C,p,P,f,l,R,Q,q,d,u} \
-    '-k+:keyword substitution:_cvs_k' \
-    '-r+:tag:_cvs_revisions' \
-    '-D+:date:_cvs_D' \
-    '-j+:tag:_cvs_revisions' \
-    '*-I+:name:_files' \
-    '*-W+:spec:' \
+    '-A[reset sticky tags, dates and -k]' \
+    '-C[overwrite local modification]' \
+    '-p[check out to standard output]' \
+    '-P[prune empty directory]' \
+    '-f[use head revision]' \
+    '(-R)-l[don'\''t recursive]' \
+    '(-l)-R[recursive]' \
+    '-d[create directories]' \
+    '-k+[keyword]:keyword substitution:_cvs_k' \
+    '(-D)-r+[specify revision]:tag:_cvs_revisions' \
+    '(-r)-D+[specify date]:date:_cvs_D' \
+    '-j+[merge]:tag:_cvs_revisions' \
+    '*-I+[ignore files]:name:_files' \
+    '*-W+[wrapper specification]:spec:_files' \
     '*:file:_cvs_files'
 }
 
@@ -376,14 +520,16 @@
     case "$words[2]" in
       on|off) # "+lR"
 	_arguments -s \
-	    -{l,R} \
+	    '(-R)-l[don'\''t recursive]' \
+	    '(-l)-R[recursive]' \
 	    ':watch command:' \
 	    '*:file:_cvs_files'
 	;;
       add|remove) # "+lRa:"
 	_arguments -s \
-	    -{l,R} \
-	    '*-a+:action:(edit unedit commit all none)' \
+	    '(-R)-l[don'\''t recursive]' \
+	    '(-l)-R[recursive]' \
+	    '*-a+[specify action]:action:(edit unedit commit all none)' \
 	    ':watch command:' \
 	    '*:file:_cvs_files'
 	;;
@@ -395,7 +541,8 @@
 _cvs_watchers () {
   # "+lR"
   _arguments -s \
-      -{l,R} \
+      '(-R)-l[don'\''t recursive]' \
+      '(-l)-R[recursive]' \
       '*:file:_cvs_files'
 }
 
@@ -577,7 +724,8 @@
 _cvs_directories () {
   if [[ -d ${pref}CVS ]]; then
     _cvs_setup_direntries
-    (( $#entries )) && _files "$@" -g "${(j:|:)${(@)entries:q}}"
+    (( $#entries )) && _path_files "$@" -g "${(j:|:)${(@)entries:q}}" ||
+      _path_files -g '*~(*/|)CVS(/)'
   else
     _files "$@"
   fi
@@ -639,8 +787,9 @@
     omit=($_cvs_ignore_default ${entries:q} ${=cvsignore} $line)
     [[ -r ~/.cvsignore ]] && omit=($omit $(<~/.cvsignore))
     [[ -r ${pref}.cvsignore ]] && omit=($omit $(<${pref}.cvsignore))
+    entries=($entries CVS)
     _path_files "$@" -g '*~(*/|)('${(j:|:)omit}')(D)' ||
-        _path_files "$@" -g '*~(*/|)('${(j:|:)${(@)entries:q}}')(D)' ||
+      _path_files "$@" -g '*~(*/|)('${(j:|:)${(@)entries:q}}')(D)' ||
         _cvs_directories "$@"
   else
     _files "$@"
Index: Completion/User/_diff_options
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/User/_diff_options,v
retrieving revision 1.3
diff -u -r1.3 _diff_options
--- Completion/User/_diff_options	2000/04/14 12:28:04	1.3
+++ Completion/User/_diff_options	2000/05/05 20:21:53
@@ -16,16 +16,16 @@
 fi
 
 if [[ -n "$_is_gnu[$cmd]" ]]; then
-  # output formats 
+  # output formats
   of="-y --side-by-side -n --rcs -e -f --ed -q --brief -c -C --context -u -U \
   --unified --old-group-format --new-group-format --changed-group-format \
   --unchanged-group-format --line-format --old-line-format --new-line-format \
-  --changed-line-format"
+  --unchanged-line-format"
 
   # output formats w/o unified and context
   ofwuc="-y --side-by-side -n --rcs -e -f --ed -q --brief --old-group-format \
   --new-group-format --changed-group-format --unchanged-group-format \
-  --line-format --old-line-format --new-line-format --changed-line-format"
+  --line-format --old-line-format --new-line-format --unchanged-line-format"
 
   # option specific to unified or context diff
   ouc='-L --label -p --show-c-function -F --show-function-line'
@@ -37,11 +37,11 @@
   ofwy="-n --rcs -e -f --ed -q --brief -c -C --context -u -U --unified \
   --old-group-format --new-group-format --changed-group-format \
   --unchanged-group-format --line-format --old-line-format \
-  --new-line-format --changed-line-format"
+  --new-line-format --unchanged-line-format"
 
   # output formats w/o group format
   ofwg="-n --rcs -e -f --ed -q --brief -c -C --context -u -U --unified \
-  --line-format --old-line-format --new-line-format --changed-line-format"
+  --line-format --old-line-format --new-line-format --unchanged-line-format"
 
   # output formats w/o line format
   ofwl="-n --rcs -e -f --ed -q --brief -c -C --context -u -U --unified \
@@ -67,17 +67,18 @@
     "($of $oss)--unified=[output a unified diff]::number of lines of unified context:" \
     "($of $oss)-U+[output a unified diff]:number of lines of unified context:" \
     "($of $oss)-u[output a unified diff]" \
-    "($ofwuc $oss -L)--label[set label to use instead of file name]:label:" \
+    "($ofwuc $oss -L)--label=[set label to use instead of file name]:label:" \
     "($ofwuc $oss --label)-L+[set label to use instead of file name]:label:" \
     "($ofwuc $oss -p)--show-c-function[show C function of each change]" \
     "($ofwuc $oss --show-c-function)-p[show C function of each change]" \
     "($ofwuc $oss -F)--show-function-line=[show the most recent line matching regex]:regex:" \
-    "($ofwuc $oss --show-function-line)-F[show the most recent line matching regex]:regex:" \
+    "($ofwuc $oss --show-function-line)-F+[show the most recent line matching regex]:regex:" \
     "($of $ouc $oss)--brief[output only whether files differ]" \
     "($of $ouc $oss)-q[output only whether files differ]" \
     "($of $ouc $oss)--ed[output an ed script]" \
-    "($of $ouc $oss)-f[output a reversed ed script]" \
     "($of $ouc $oss)-e[output an ed script]" \
+    "($of $ouc $oss)--forward-ed[output a reversed ed script]" \
+    "($of $ouc $oss)-f[output a reversed ed script]" \
     "($of $ouc $oss)--rcs[RCS format diff]" \
     "($of $ouc $oss)-n[RCS format diff]" \
     "($of $ouc)--side-by-side[output in two columns]" \
@@ -93,7 +94,7 @@
     "($ofwl $ouc $oss)--line-format=[set line format]:line format:" \
     "($ofwl $ouc $oss)--old-line-format=[set old line format]:old line format:" \
     "($ofwl $ouc $oss)--new-line-format=[set new line format]:new line format:" \
-    "($ofwl $ouc $oss)--changed-line-format=[set changed line format]:changed line format:" \
+    "($ofwl $ouc $oss)--unchanged-line-format=[set unchanged line format]:unchanged line format:" \
     '(-l)--paginate[output through pr]' \
     '(--paginate)-l[output through pr]' \
     '(-t)--expand-tabs[expand tabs to spaces]' \
@@ -115,8 +116,8 @@
     '(-S)--starting-file=[set first file in comparison]:start with file:_files' \
     '(--starting-file)-S+[set first file in comparison]:start with file:_files' \
     '--horizon-lines=[set number of lines to keep in prefix and suffix]:number of horizon lines:' \
-    '(-d)--mininal[try to find a smaller set of changes]' \
-    '(--mininal)-d[try to find a smaller set of changes]' \
+    '(-d)--minimal[try to find a smaller set of changes]' \
+    '(--minimal)-d[try to find a smaller set of changes]' \
     '(-H)--speed-large-files[assume large files and many small changes]' \
     '(--speed-large-files)-H[assume large files and many small changes]' \
     '(--version)-v[output version info]' \
-- 
Tanaka Akira

