From zsh-workers-return-20286-mason-zsh=primenet.com.au@sunsite.dk Thu Aug 26 19:11:54 2004
Return-Path: <zsh-workers-return-20286-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14711 invoked from network); 26 Aug 2004 19:11:53 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 26 Aug 2004 19:11:52 -0000
Received: (qmail 79389 invoked from network); 26 Aug 2004 19:11:47 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 26 Aug 2004 19:11:47 -0000
Received: (qmail 27419 invoked by alias); 26 Aug 2004 19:06:10 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20286
Received: (qmail 27402 invoked from network); 26 Aug 2004 19:06:10 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by 130.225.247.90 with SMTP; 26 Aug 2004 19:06:10 -0000
Received: (qmail 64691 invoked from network); 26 Aug 2004 19:04:41 -0000
Received: from homer.w3.org (128.30.52.30)
  by a.mx.sunsite.dk with SMTP; 26 Aug 2004 19:04:40 -0000
Received: from buena (localhost [127.0.0.1])
	by homer.w3.org (Postfix) with ESMTP id 6ED4E4F1A9;
	Thu, 26 Aug 2004 14:37:19 -0400 (EDT)
Received: by buena (Postfix, from userid 1000)
	id 8779513AD0; Thu, 26 Aug 2004 12:10:53 -0400 (EDT)
Date: Thu, 26 Aug 2004 12:10:53 -0400
From: Hugo Haas <hugo@larve.net>
To: Wayne Davison <wayned@users.sourceforge.net>
Cc: zsh-workers@sunsite.dk, 262247@bugs.debian.org
Subject: Re: Bug#262247: zsh: Improved make completion
Message-ID: <20040826161053.GH19259@larve.net>
References: <20040730101751.GA11905@larve.net> <20040730153054.GA4059@scowler.net> <20040730165133.GL12279@larve.net> <20040818150736.GI4753@larve.net> <20040821180920.GA24266@blorf.net>
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-md5;
	protocol="application/pgp-signature"; boundary="jaoouwwPWoQSJZYp"
Content-Disposition: inline
In-Reply-To: <20040821180920.GA24266@blorf.net>
User-Agent: Mutt/1.5.6+20040722i
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_40 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0


--jaoouwwPWoQSJZYp
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

Hi Wayne.

* Wayne Davison <wayned@users.sourceforge.net> [2004-08-21 11:09-0700]
> On Wed, Aug 18, 2004 at 11:07:36AM -0400, Hugo Haas wrote:
> > Attached is an attempt at doing this. It seems to work, though I only
> > enabled it for the gnu case.
>=20
> I tried your patch, and it ignored targets that had dependencies (since
> it only matched a colon at the end of the line).

Oh, that's right=E2=80=A6

> Here's my attempt at a zsh-only verson of _make.  It not only
> follows include files, but it expands variables too.

It's pretty cool. I found an issue with the code though, which I don't
know how to work around: variable names are different in make and zsh.

In make:

  A variable name may be any sequence of characters not containing
  `:', `#', `=3D', or leading or trailing whitespace.

In zsh:

  A name may be any sequence of alphanumeric characters and
  underscores, or  the single  characters =E2=80=98*=E2=80=99, =E2=80=98@=
=E2=80=99, =E2=80=98#=E2=80=99, =E2=80=98?=E2=80=99, =E2=80=98-=E2=80=99,
  =E2=80=98$=E2=80=99, or =E2=80=98!=E2=80=99.

I guess that it's not a big deal: there will be cases where variables
won't be expanded, and certain rules will be missing, but it's better
than the previous code which didn't look at variables at all.

Also, the make documentation says:

  However, variable names containing characters other than letters,
  numbers, and underscores should be avoided, as they may be given
  special meanings in the future, and with some shells they cannot be
  passed through the environment to a sub-`make' (*note Communicating
  Variables to a Sub-`make': Variables/Recursion.).

Therefore, it's recommended to use cases which are actually going to
work with your code. So I think it's fine.

> I tried to make it handle both gnu and non-gnu include files, but I
> assume that the ".include <...>" form needs more code to handle
> where the include really resides.
>=20
> Since the patch was larger than the new _make script, I'm just attaching
> the new _make script here.  Give it a try and see how you like it.

I think it's a great improvement on the current _make script, and
would be happy to see it included in zsh.

Regards,

Hugo

--=20
Hugo Haas - http://larve.net/people/hugo/

--jaoouwwPWoQSJZYp
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Digital signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iQCVAwUBQS4LjaN/9WeKWvkNAQGXAwP/f7VxRyh6Msa1bbD8WTBLmy2M6OrESNV/
yeEYqggXxsyNyJvY1qHrYHMtw9zLfDNyArkg59+XlBCmQ6R4IijvH7URb2dNvS5e
07gUluk1Dd/0d9BBDJDVxdaGAWDsxkEeDk4UkTYYE3LQ58yax4hYbGj+qzkoKq8B
dHfhXbm9/BM=
=oMfM
-----END PGP SIGNATURE-----

--jaoouwwPWoQSJZYp--

