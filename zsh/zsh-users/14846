From zsh-users-return-14846-mason-zsh=primenet.com.au@zsh.org Sat Feb 20 21:28:04 2010
Return-Path: <zsh-users-return-14846-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9261 invoked by alias); 20 Feb 2010 21:28:04 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14846
Received: (qmail 11525 invoked from network); 20 Feb 2010 21:28:02 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00,DKIM_SIGNED,
	DKIM_VERIFIED autolearn=ham version=3.2.5
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.219.220 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:cc:content-type;
        bh=rVMR7f9GLYZfdnN+W/xMNJ3Zq04db349VcmrlEKpIJE=;
        b=w+8ITLadI15lcTJ7pULKTO4SdmFfeMoYTbiez1GlbHmPwlBjgvech4iDCi/b8vSHg9
         7l1uEKrNDebw5GyRl9KMD84p+FOzw9JwKcBft1xPhR9x79F9dUwMCzQvUs7PSvL2Bj6R
         /P36G4QIbZdB0S9rntWgBQnUvVCGKZh/l8G1g=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :cc:content-type;
        b=HdbdrH8kPyPIdNSDHSSKly2YFGzfxji2mXjCbIpBcOuEyvroyJ+wEjQA45gVYkFoHH
         q77I7enyVwBI3A3XOr82DdHpW3gjl6HiJIJZag7eb/aRqr0qvjUcqm80ow+RmYn6jwj9
         HLDIVtjZYoAIKNhatxAUX2j5MLwcvC+/vtJuQ=
MIME-Version: 1.0
In-Reply-To: <6910cba01002201120v65fc6904j758d41de17839b86@mail.gmail.com>
References: <6910cba01002201120v65fc6904j758d41de17839b86@mail.gmail.com>
Date: Sat, 20 Feb 2010 20:51:30 +0100
Message-ID: <237967ef1002201151y126f0e3ex83c83945b9e6fa59@mail.gmail.com>
Subject: Re: preexec and multi-line command.
From: Mikael Magnusson <mikachu@gmail.com>
To: Piotr Karbowski <jabberuser@gmail.com>
Cc: zsh-users@zsh.org
Content-Type: text/plain; charset=UTF-8

On 20 February 2010 20:20, Piotr Karbowski <jabberuser@gmail.com> wrote:
> Hi there!
>
> I have starge problem after I added preexec function to my zshrc to
> add in terminal TITLE what is running inside.
>
> ## cut here
> case $TERM in
>        rxvt*|xterm|nxterm|gnome|screen)
>        precmd () {print -Pn "\e]0;%n@%m: %~\a"}
>        preexec () { print -Pn "\e]0;$1 [%n@%m: %~]\a"}
>        ;;
> esac
> ## cut here
>
> Issue is that when I doing something multiline, I got:
>
> ## cut here
> slashbeast@ragnarok ~ % echo 1\
> slashbeast@ragnarok ~ > 2\
> slashbeast@ragnarok ~ > 3\
> slashbeast@ragnarok ~ >
>
> 2
> 3
>  [slashbeast@ragnarok: ~]123
> slashbeast@ragnarok ~ %
> ## cut here
>
> How can I fix it?

You need to quote $1 properly, how to do that depends on your
terminal. I use this:
    if [[ $TERM = rxvt-unicode ]]; then
      printf '\0\e:\e]0;%s\007' ${${${1//$'\x00'/\^@}//
/\\n}//(#m)[$'\x00'-$'\x1f']/$'\x16'$MATCH}

-- 
Mikael Magnusson

