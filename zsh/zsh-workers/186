From zsh-workers-request@math.gatech.edu  Sun Jul  9 13:20:36 1995
Received: from gatech.edu (gatech.edu [130.207.244.244]) by werple.mira.net.au (8.6.12/8.6.9) with SMTP id NAA20149 for <mason@werple.mira.net.au>; Sun, 9 Jul 1995 13:20:33 +1000
Received: from math (math.skiles.gatech.edu) by gatech.edu with SMTP id AA08537
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Sat, 8 Jul 1995 23:21:08 -0400
Received: by math (5.x/SMI-SVR4)
	id AA09243; Sat, 8 Jul 1995 23:17:52 -0400
Resent-Date: Sun, 9 Jul 1995 04:18:51 +0100 (BST)
Old-Return-Path: <zefram@dcs.warwick.ac.uk>
From: Zefram <A.Main@dcs.warwick.ac.uk>
Message-Id: <24342.199507090318@stone.dcs.warwick.ac.uk>
Subject: HIST_NO_STORE fix
To: zsh-workers@math.gatech.edu (Z Shell workers mailing list)
Date: Sun, 9 Jul 1995 04:18:51 +0100 (BST)
X-Loop: zefram@dcs.warwick.ac.uk
X-Stardate: [-31]5950.69
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-Id: <"_GCn_2.0.LG2.Vfq_l"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/186
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

-----BEGIN PGP SIGNED MESSAGE-----

The patch below fixes HIST_NO_STORE, which currently doesn't work at
all.  If anyone thinks the test ops['R'] etc. is actually useful, I
think another sensible semantic would be obtained by putting a ! before
the parentheses containing that test.

 -zefram

      *** Src/builtin.c.old	Sun Jul  9 04:09:51 1995
      --- Src/builtin.c	Sun Jul  9 04:10:44 1995
      ***************
      *** 2630,2637 ****
            }
            /* delayrem is set if the command is r */
            delayrem = !strcmp(nam, "r");
      !     if (!delayrem && !(ops['l'] && unset(HISTNOSTORE)) &&
      ! 	(ops['R'] || ops['W'] || ops['A']))
        	remhist();
            if (ops['R']) {
        	/* read history from a file */
      --- 2630,2636 ----
            }
            /* delayrem is set if the command is r */
            delayrem = !strcmp(nam, "r");
      !     if (!delayrem && !(ops['l'] && unset(HISTNOSTORE)))
        	remhist();
            if (ops['R']) {
        	/* read history from a file */

-----BEGIN PGP SIGNATURE-----
Version: 2.6.i

iQBVAgUBL/9KgWWJ8JfKi+e9AQFWWQH9FWb9LfH/5HfhnBmAXyAlFNiMkeNEj4ps
2AbYwoSl1uCcsrmyx7La0tyyRtallpSpT/Fi2c497dx0rZ8NRNSVjA==
=ZJeP
-----END PGP SIGNATURE-----

