From zsh-workers-return-26009-mason-zsh=primenet.com.au@sunsite.dk Wed Nov 05 17:50:42 2008
Return-Path: <zsh-workers-return-26009-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12989 invoked from network); 5 Nov 2008 17:50:29 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: *
X-Spam-Status: No, score=1.8 required=5.0 tests=BAYES_00,INVALID_DATE,
	MIME_BASE64_TEXT,MIME_QP_LONG_LINE autolearn=no version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 Nov 2008 17:50:29 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 28659 invoked from network); 5 Nov 2008 17:50:19 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 Nov 2008 17:50:19 -0000
Received: (qmail 22438 invoked by alias); 5 Nov 2008 17:50:13 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26009
Received: (qmail 22422 invoked from network); 5 Nov 2008 17:50:13 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 5 Nov 2008 17:50:13 -0000
Received: from smtp8-g19.free.fr (smtp8-g19.free.fr [212.27.42.65])
	by bifrost.dotsrc.org (Postfix) with ESMTP id C2D5380308BE
	for <zsh-workers@sunsite.dk>; Wed,  5 Nov 2008 18:50:09 +0100 (CET)
Received: from smtp8-g19.free.fr (localhost [127.0.0.1])
	by smtp8-g19.free.fr (Postfix) with ESMTP id C981832A9B2
	for <zsh-workers@sunsite.dk>; Wed,  5 Nov 2008 18:50:08 +0100 (CET)
Received: from laptop (vaf26-2-82-244-111-82.fbx.proxad.net [82.244.111.82])
	by smtp8-g19.free.fr (Postfix) with ESMTP id 8313C32AA88
	for <zsh-workers@sunsite.dk>; Wed,  5 Nov 2008 18:50:04 +0100 (CET)
To: zsh-workers@sunsite.dk
Subject: BeOS port
X-Mailer: BeMail - Mail Daemon Replacement 3.0.0 Final
From: "=?windows-1252?q?Fran=E7ois?= Revol" <revol@free.fr>
Date: Wed, 05 Nov 2008 18:53:59 +0100 CET
Message-Id: <1487794487-BeMail@laptop>
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary=----------Zoidberg-BeMail-temp--------
X-Virus-Scanned: ClamAV 0.92.1/8573/Wed Nov  5 17:42:48 2008 on bifrost
X-Virus-Status: Clean

This is a multipart message in MIME format.

------------Zoidberg-BeMail-temp--------
Mime-Version: 1.0
Content-Type: text/plain; charset="windows-1252"
Content-Transfer-Encoding: quoted-printable

Hi there,
I've had a working port of zsh to ZETA (BeOS R6) for quite a while, but 
since I'm not (yet) a big user I never managed to publish it. I was 
also too lazy to clean up the small C89 fix required (we require 
gcc2.95 due to the C++ ABI breackage on later versions).

I didn't try but it should likely compile fine on BeOS R5, at least 
with the BONE network stack.

It should also compile without much trouble in Haiku (MIT licenced 
rewrite of BeOS). It will probably need some more library check (socket 
in -lnetwork) though.

Some tests still break, but most are due to missing features, and at 
least they don't crash like they used to.
- BeOS defvs shows all devices as S=5FIFCHR, including block devices, so 
there is no S=5FIFBLK device in /dev per see.
- BeOS doesn't have /dev/tty (Haiku does though)
- BeOS natively uses UTF-8 everywhere, but has an old glibc, so it 
misses some wc*()... I still don't get the point of using ugly stuff 
like wchar anyway.
- zpty doesn't load yet for some reason

I'll likely have to port over all the bash=5Fcompletion stuff I wrote...
http://revolf.free.fr/beos/bash=5Fcompletion/zeta=5Fcompletion

Fran=E7ois.



---- make test:

[revol@Zeta /Data/zsh/build.zeta]# make test
cd Test ; /bin/make check
make[1]: Entering directory `/Data/zsh/build.zeta/Test'
if test -n "gcc"; then \
  cd .. && DESTDIR=3D \
  /bin/make MODDIR=3D`pwd`/Test/Modules install.modules > /dev/null; \
fi
if ZTST=5Ftestlist=3D"`for f in ../../zsh/Test/*.ztst; \
           do echo $f; done`" \
 ZTST=5Fsrcdir=3D"../../zsh/Test" \
 ZTST=5Fexe=3D../Src/zsh \
 ../Src/zsh +Z -f ../../zsh/Test/runtests.zsh; then \
 stat=3D0; \
else \
 stat=3D1; \
fi; \
rm -rf Modules .zcompdump; \
exit $stat
../../zsh/Test/A01grammar.ztst: starting.
Test ../../zsh/Test/A01grammar.ztst failed: bad status 1, expected 0 
from:
  - $ZTST=5Ftestdir/../Src/zsh -fc "[[ \$0 =3D \"-$ZTST=5Ftestdir/../Src/zsh\
" ]]"
Was testing: `-' precommand modifier
../../zsh/Test/A01grammar.ztst: test failed.
../../zsh/Test/A02alias.ztst: starting.
../../zsh/Test/A02alias.ztst: all tests successful.
../../zsh/Test/A03quoting.ztst: starting.
Test ../../zsh/Test/A03quoting.ztst failed: bad status 1, expected 0 
from:
  print '<\u0041>'
  printf '%s\n' $'<\u0042>'
  print '<\u0043>'
  printf '%s\n' $'<\u0044>'
Error output:
(eval):1: cannot do charset conversion (NLS not supported)
Was testing: \u in both print and printf
../../zsh/Test/A03quoting.ztst: test failed.
../../zsh/Test/A04redirect.ztst: starting.
../../zsh/Test/A04redirect.ztst: all tests successful.
../../zsh/Test/A05execution.ztst: starting.
../../zsh/Test/A05execution.ztst: all tests successful.
../../zsh/Test/A06assign.ztst: starting.
../../zsh/Test/A06assign.ztst: all tests successful.
../../zsh/Test/A07control.ztst: starting.
../../zsh/Test/A07control.ztst: all tests successful.
../../zsh/Test/B01cd.ztst: starting.
../../zsh/Test/B01cd.ztst: all tests successful.
../../zsh/Test/B02typeset.ztst: starting.
../../zsh/Test/B02typeset.ztst: all tests successful.
../../zsh/Test/B03print.ztst: starting.
../../zsh/Test/B03print.ztst: all tests successful.
../../zsh/Test/B04read.ztst: starting.
../../zsh/Test/B04read.ztst: all tests successful.
../../zsh/Test/B05eval.ztst: starting.
../../zsh/Test/B05eval.ztst: all tests successful.
../../zsh/Test/B06fc.ztst: starting.
../../zsh/Test/B06fc.ztst: all tests successful.
../../zsh/Test/C01arith.ztst: starting.
../../zsh/Test/C01arith.ztst: all tests successful.
../../zsh/Test/C02cond.ztst: starting.
Warning: Not testing [[ -b blockdevice ]] (no devices found)
Test ../../zsh/Test/C02cond.ztst failed: bad status 1, expected 0 from:
  # Use hardcoded /dev/tty because globbing inside /dev fails on Cygwin
  char=3D/dev/tty
  [[ -c $char && ! -c $zerolength ]]
Was testing: -c cond
../../zsh/Test/C02cond.ztst: test failed.
../../zsh/Test/C03traps.ztst: starting.
This test takes at least three seconds...
This test, too, takes at least three seconds...
Another test that takes three seconds
../../zsh/Test/C03traps.ztst: all tests successful.
../../zsh/Test/C04funcdef.ztst: starting.
../../zsh/Test/C04funcdef.ztst: all tests successful.
../../zsh/Test/C05debug.ztst: starting.
../../zsh/Test/C05debug.ztst: all tests successful.
../../zsh/Test/D01prompt.ztst: starting.
../../zsh/Test/D01prompt.ztst: all tests successful.
../../zsh/Test/D02glob.ztst: starting.
../../zsh/Test/D02glob.ztst: all tests successful.
../../zsh/Test/D03procsubst.ztst: starting.
../../zsh/Test/D03procsubst.ztst: skipped (process substitution is not 
supported)
../../zsh/Test/D04parameter.ztst: starting.
../../zsh/Test/D04parameter.ztst: all tests successful.
../../zsh/Test/D05array.ztst: starting.
../../zsh/Test/D05array.ztst: all tests successful.
../../zsh/Test/D06subscript.ztst: starting.
../../zsh/Test/D06subscript.ztst: all tests successful.
../../zsh/Test/D07multibyte.ztst: starting.
../../zsh/Test/D07multibyte.ztst: skipped (no UTF-8 locale or multibyte 
mode is not implemented)
../../zsh/Test/D08cmdsubst.ztst: starting.
../../zsh/Test/D08cmdsubst.ztst: all tests successful.
../../zsh/Test/E01options.ztst: starting.
*** /tmp/zsh.ztst.err.147519    Wed Nov  5 05:56:27 2008
--- /tmp/zsh.ztst.terr.147519   Wed Nov  5 05:56:27 2008
***************
*** 1,2 ****
! (eval):4: file exists: foo1
  (eval):6: no such file or directory: bar1
--- 1,2 ----
! (eval):4: file or Directory already exists: foo1
  (eval):6: no such file or directory: bar1
Test ../../zsh/Test/E01options.ztst failed: error output differs from 
expected as shown above for:
  setopt noclobber
  rm -f foo1 bar1 rod1
  echo waterbeach >foo1
  (echo landbeach >foo1)
  cat foo1
  (echo lode >>bar1)
  [[ -f bar1 ]] && print That shouldn\'t be there.
  echo denny >rod1
  echo wicken >>rod1
  cat rod1
  unsetopt noclobber
  rm -f foo2 bar2 rod2
  echo ely >foo2
  echo march >foo2
  cat foo2
  echo wimpole >>bar2
  cat bar2
  echo royston >rod2
  echo foxton >>rod2
  cat rod2
  rm -f foo* bar* rod*
Was testing: CLOBBER option
../../zsh/Test/E01options.ztst: test failed.
../../zsh/Test/E02xtrace.ztst: starting.
../../zsh/Test/E02xtrace.ztst: all tests successful.
../../zsh/Test/V01zmodload.ztst: starting.
*** /tmp/zsh.ztst.err.147628    Wed Nov  5 05:56:31 2008
--- /tmp/zsh.ztst.terr.147628   Wed Nov  5 05:56:31 2008
***************
*** 0 ****
--- 1,2 ----
+ (eval):3: module `zsh/terminfo' has no such feature: `b:echoti': 
autoload cancelled
+ (eval):3: module `zsh/terminfo' has no such feature: `p:terminfo': 
autoload cancelled
Test ../../zsh/Test/V01zmodload.ztst failed: error output differs from 
expected as shown above for:
 for m in $mods
 do
   zmodload -i $m || mods[(r)$m]=3D()
 done
Was testing: Test loading of all compiled modules
../../zsh/Test/V01zmodload.ztst: test failed.
../../zsh/Test/V02zregexparse.ztst: starting.
../../zsh/Test/V02zregexparse.ztst: all tests successful.
../../zsh/Test/V03mathfunc.ztst: starting.
../../zsh/Test/V03mathfunc.ztst: skipped (The module zsh/mathfunc is 
not available.)
../../zsh/Test/V04features.ztst: starting.
../../zsh/Test/V04features.ztst: all tests successful.
../../zsh/Test/V05styles.ztst: starting.
../../zsh/Test/V05styles.ztst: all tests successful.
../../zsh/Test/V06parameter.ztst: starting.
../../zsh/Test/V06parameter.ztst: all tests successful.
../../zsh/Test/Y01completion.ztst: starting.
../../zsh/Test/Y01completion.ztst: skipped (the zsh/zpty module is not 
available)
../../zsh/Test/Y02compmatch.ztst: starting.
../../zsh/Test/Y02compmatch.ztst: skipped (the zsh/zpty module is not 
available)
../../zsh/Test/Y03arguments.ztst: starting.
../../zsh/Test/Y03arguments.ztst: skipped (the zsh/zpty module is not 
available)
**************************************
26 successful test scripts, 5 failures, 6 skipped
**************************************
make[1]: *** [check] Error 1
make[1]: Leaving directory `/Data/zsh/build.zeta/Test'
make: *** [test] Error 2

------------Zoidberg-BeMail-temp--------
Content-Transfer-Encoding: base64
Content-Disposition: BMailAttachment
Content-Type: text/plain; name=zsh-beos.diff.001.txt

SW5kZXg6IGNvbmZpZ3VyZS5hYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvY3Zzcm9vdC96c2gvenNo
L2NvbmZpZ3VyZS5hYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS4xMTIKZGlmZiAtdSAtcjEuMTEy
IGNvbmZpZ3VyZS5hYwotLS0gY29uZmlndXJlLmFjCTMwIE9jdCAyMDA4IDEzOjAwOjIxIC0wMDAw
CTEuMTEyCisrKyBjb25maWd1cmUuYWMJNSBOb3YgMjAwOCAwNTowOTo0NiAtMDAwMApAQCAtNzQ1
LDYgKzc0NSw3IEBACiBmaQogCiBBQ19DSEVDS19MSUIoc29ja2V0LCBzb2NrZXQpCitBQ19DSEVD
S19MSUIoYmluZCwgZ2V0aG9zdGJ5bmFtZTIpCiAKIGRubCAtLS0tLS0tLS0tLS0tLS0KIGRubCBD
SEVDSyBGT1IgSUNPTlYKQEAgLTI1MjcsNiArMjUyOCw3IEBACiAgICAgYWl4KikgICAgICAgICBE
TExERkxBR1M9IiR7RExMREZMQUdTPS1HIC1iZXhwYWxsIC1sY30iIDs7CiAgICAgc29sYXJpcyp8
c3lzdjQqfGVzaXgqKSBETExERkxBR1M9IiR7RExMREZMQUdTPS1HfSIgOzsKICAgICBkYXJ3aW4q
KSAgICAgIERMTERGTEFHUz0iJHtETExERkxBR1M9LWJ1bmRsZSAtZmxhdF9uYW1lc3BhY2UgLXVu
ZGVmaW5lZCBzdXBwcmVzc30iIDs7CisgICAgYmVvcyp8aGFpa3UqKSBETExERkxBR1M9IiR7RExM
REZMQUdTPS1ub3N0YXJ0fSIgOzsKICAgICBvcGVuYnNkKikKICAgICAgIGlmIHRlc3QgeCR6c2hf
Y3Zfc3lzX2VsZiA9IHh5ZXM7IHRoZW4KIAlETExERkxBR1M9IiR7RExMREZMQUdTPS1zaGFyZWQg
LWZQSUN9IgpAQCAtMjU2OCw2ICsyNTcwLDE1IEBACiAgICAgICAgOzsKICAgICAgIGVzYWMKICAg
ICA7OworICAgICotYmVvcyopCisgICAgICAjIGdjYyBvbiBCZU9TIGRvZXNuJ3QgbGlrZSAtcmR5
bmFtaWMuLi4KKyAgICAgIEVYVFJBX0xERkxBR1M9IiR7RVhUUkFfTERGTEFHUz0gfSIKKyAgICAg
ICMgYWxzbywgZGxvcGVuKCkgYXQgbGVhc3QgaW4gWmV0YSByZXNwZWN0cyAkTElCUkFSWV9QQVRI
LCBzbyBuZWVkcyAlQSBhZGRlZCB0byBpdC4KKyAgICAgIGV4cG9ydCBMSUJSQVJZX1BBVEg9IiRM
SUJSQVJZX1BBVEg6JUEvIgorICAgIDs7CisgICAgKi1oYWlrdSopCisgICAgICAjIAorICAgIDs7
CiAgIGVzYWMKIAogICAjIERvbmUgd2l0aCBvdXIgc2hlbGwgY29kZSwgc28gcmVzdG9yZSBhdXRv
dG9vbHMgcXVvdGluZwpJbmRleDogU3JjL01vZHVsZXMvenB0eS5jCj09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZp
bGU6IC9jdnNyb290L3pzaC96c2gvU3JjL01vZHVsZXMvenB0eS5jLHYKcmV0cmlldmluZyByZXZp
c2lvbiAxLjM5CmRpZmYgLXUgLXIxLjM5IHpwdHkuYwotLS0gU3JjL01vZHVsZXMvenB0eS5jCTI5
IFNlcCAyMDA4IDA4OjQ2OjMzIC0wMDAwCTEuMzkKKysrIFNyYy9Nb2R1bGVzL3pwdHkuYwk1IE5v
diAyMDA4IDA1OjA5OjQ3IC0wMDAwCkBAIC0yNjAsNiArMjYwLDkgQEAKIAogICAgIGlmIChtYXN0
ZXIpIHsKIAlzdHJjcHkobmFtZSwgIi9kZXYvcHR5eHgiKTsKKyNpZiBkZWZpbmVkKF9fQkVPU19f
KSB8fCBkZWZpbmVkKF9fSEFJS1VfXykKKwluYW1lWzddID0gJy8nOworI2VuZGlmCiAKIAlmb3Ig
KHAxID0gY2hhcjE7ICpwMTsgcDErKykgewogCSAgICBuYW1lWzhdID0gKnAxOwpJbmRleDogU3Jj
L1psZS96bGVfcmVmcmVzaC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9jdnNyb290L3pzaC96c2gv
U3JjL1psZS96bGVfcmVmcmVzaC5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjcyCmRpZmYgLXUg
LXIxLjcyIHpsZV9yZWZyZXNoLmMKLS0tIFNyYy9abGUvemxlX3JlZnJlc2guYwkyMyBPY3QgMjAw
OCAwODo1MjowMiAtMDAwMAkxLjcyCisrKyBTcmMvWmxlL3psZV9yZWZyZXNoLmMJNSBOb3YgMjAw
OCAwNTowOTo0NyAtMDAwMApAQCAtMTg3OSw2ICsxODc5LDggQEAKIC8qIDM6IG1haW4gZGlzcGxh
eSBsb29wIC0gd3JpdGUgb3V0IHRoZSBidWZmZXIgdXNpbmcgd2hhdGV2ZXIgdHJpY2tzIHdlIGNh
biAqLwogCiAgICAgZm9yICg7OykgeworCWludCBub3dfb2ZmOworCiAjaWZkZWYgTVVMVElCWVRF
X1NVUFBPUlQKIAlpZiAoKCFubC0+Y2hyIHx8IG5sLT5jaHIgIT0gV0VPRikgJiYgKCFvbC0+Y2hy
IHx8IG9sLT5jaHIgIT0gV0VPRikpIHsKICNlbmRpZgpAQCAtMjA1MCw3ICsyMDUyLDcgQEAKIAkg
ICAgICogSWYgYW4gYXR0cmlidXRlIHdhcyBvbiBoZXJlIGJ1dCBpc24ndCBhbnkgbW9yZSwKIAkg
ICAgICogb3V0cHV0IHRoZSBzZXF1ZW5jZSB0byB0dXJuIGl0IG9mZi4KIAkgICAgICovCi0JICAg
IGludCBub3dfb2ZmID0gb2wtPmF0ciAmIH5ubC0+YXRyICYgVFhUX0FUVFJfT05fTUFTSzsKKwkg
ICAgbm93X29mZiA9IG9sLT5hdHIgJiB+bmwtPmF0ciAmIFRYVF9BVFRSX09OX01BU0s7CiAJICAg
IGlmIChub3dfb2ZmKQogCQlzZXR0ZXh0YXR0cmlidXRlcyhUWFRfQVRUUl9PRkZfRlJPTV9PTihu
b3dfb2ZmKSk7CiAK
------------Zoidberg-BeMail-temp----------

