From zsh-workers-return-28262-mason-zsh=primenet.com.au@zsh.org Thu Sep 16 08:47:01 2010
Return-Path: <zsh-workers-return-28262-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23584 invoked by alias); 16 Sep 2010 08:47:00 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28262
Received: (qmail 702 invoked from network); 16 Sep 2010 08:46:58 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.0 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,
	T_TO_NO_BRKTS_FREEMAIL autolearn=ham version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 74.125.82.171 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:date:from:to:subject
         :message-id:mime-version:content-type:content-disposition:user-agent;
        bh=+NPph+JOScDuLxzJ7TWrX/f0jD15NnKJTzXG/qMua4M=;
        b=pAgnnlCnZrtMYwIBSikEzGGNYgVhb8vXN+BExjDFVHtxMi+FTM96nDsCZ2To2ogKue
         tktI4RfZVfo/vso7Ho9c3IIc7UUgh5N4AgsjEacLt+WZTSNarO5xh6ixpoLXMyf/jas/
         ucvLAJUq2528NY7ZJC+XGDsqE5vWL3p6gp+iY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=date:from:to:subject:message-id:mime-version:content-type
         :content-disposition:user-agent;
        b=pPrRTkf1fmgSeq7bsWVJkxya2tmrBVZuR9pG7GgXpt8BIfomdx5hC8SGXZeFE72ONh
         Jbg1P1HXxUTGBWER1JblJGLxBEt7PziHHVE7E3DmZpyGsRsAV9cpjnwnmmGZJEK4+yL7
         8uTjadPEKznNOHOU63gxh4H9vZaU5QI1000So=
Date: Thu, 16 Sep 2010 10:38:31 +0200
From: Baptiste Daroussin <baptiste.daroussin@gmail.com>
To: zsh-workers@zsh.org
Subject: [PATCH] remove sed from _ffmpeg
Message-ID: <20100916083831.GA33761@azathoth.lan>
MIME-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="Fba/0zbH8Xs+Fj9o"
Content-Disposition: inline
User-Agent: Mutt/1.5.20 (2009-06-14)

--Fba/0zbH8Xs+Fj9o
Content-Type: multipart/mixed; boundary="wac7ysb48OaltWcw"
Content-Disposition: inline


--wac7ysb48OaltWcw
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hi,

Here is a patch to remove sed from _ffmpeg.

There still have the perl to be removed but let's see that later.

Regards,
Bapt

--wac7ysb48OaltWcw
Content-Type: text/x-diff; charset=us-ascii
Content-Disposition: attachment; filename="_ffmpeg_no_sed.diff"
Content-Transfer-Encoding: quoted-printable

diff --git a/Completion/Unix/Command/_ffmpeg b/Completion/Unix/Command/_ffm=
peg
index 7c0660e..7413fea 100644
--- a/Completion/Unix/Command/_ffmpeg
+++ b/Completion/Unix/Command/_ffmpeg
@@ -18,24 +18,24 @@ _ffmpeg_presets() {
=20
 _ffmpeg_acodecs() {
     local acodecs
-    acodecs=3D($(ffmpeg -codecs 2>/dev/null | sed -n '/^ .[E ]A/ {s/^ ....=
=2E..//; s/ .*//p;}'))
+    acodecs=3D(${${(M)${(f)"$(ffmpeg -codecs 2>/dev/null)"}:#[[:space:]][D=
[:space:]][E[:space:]]A[S[:space:]][D[:space:]][T[:space:]][[:space:]][^[:s=
pace:]]##*}//(#b)????????([^[:space:]]##)*/$match[1]})
     _ffmpeg_compadd 'force audio codec (''copy'' to copy stream)' acodecs =
''
 }
=20
 _ffmpeg_vcodecs() {
     local vcodecs
-    vcodecs=3D($(ffmpeg -codecs 2>/dev/null | sed -n '/^ .[E ]V/ {s/^ ....=
=2E..//; s/ .*//p;}'))
+    vcodecs=3D(${${(M)${(f)"$(ffmpeg -codecs 2>/dev/null)"}:#[[:space:]][D=
[:space:]][E[:space:]]V[S[:space:]][D[:space:]][T[:space:]][[:space:]][^[:s=
pace:]]##*}//(#b)????????([^[:space:]]##)*/$match[1]})
     _ffmpeg_compadd 'force video codec (''copy'' to copy stream)' vcodecs =
''
 }
=20
 _ffmpeg_formats() {
     local formats
-    formats=3D($(ffmpeg -formats 2>/dev/null | sed -e '1,/--/d' -e 's/^...=
=2E//' -e 's/ .*//' | tr , '\n' | sort | uniq))
+    ${(ou)${=3D${(s:,:)${${(M)${(f)"$(ffmpeg -formats 2>/dev/null)"}:#[[:s=
pace:]][D[:space:]][E[:space:]][[:space:]][^[:space:]]##*}//(#b)????([^[:sp=
ace:]]##)*/$match[1]}}}}
     _ffmpeg_compadd 'force format' formats ''
 }
=20
 _ffmpeg_list_pix_fmts() {
-    ffmpeg -pix_fmts 2>/dev/null | sed -e '1,/-----/d' -e 's/^......//' -e=
 's/ .*//'
+    print -l ${${(M)${(f)"$(ffmpeg -pix_fmts 2>/dev/null)"}:#[I.]*}//(#b)?=
?????([^[:space:]]##)*/$match[1]}
 }
=20
 _ffmpeg_pix_fmts() {
@@ -46,7 +46,7 @@ _ffmpeg_pix_fmts() {
=20
 _ffmpeg_bsfs() {
     local bsfs
-    bsfs=3D($(ffmpeg -bsfs 2>/dev/null | sed 1d))
+    bsfs=3D(${${(f)"$(ffmpeg -bsfs 2>/dev/null)"}:#*:})
     _ffmpeg_compadd 'set bitstream filter' bsfs ''
 }
=20

--wac7ysb48OaltWcw--

--Fba/0zbH8Xs+Fj9o
Content-Type: application/pgp-signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.16 (FreeBSD)

iEYEARECAAYFAkyR14cACgkQ8kTtMUmk6EzZ8QCgmukGlC6BrQTrjFnHfT1b1iZG
kF0AmgOkenilEYD7QsaTylSowSzpd6X3
=U7A6
-----END PGP SIGNATURE-----

--Fba/0zbH8Xs+Fj9o--

