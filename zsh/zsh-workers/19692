From zsh-workers-return-19692-mason-zsh=primenet.com.au@sunsite.dk Thu Mar 25 18:14:55 2004
Return-Path: <zsh-workers-return-19692-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7768 invoked from network); 25 Mar 2004 18:14:53 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 25 Mar 2004 18:14:53 -0000
Received: (qmail 27248 invoked by alias); 25 Mar 2004 18:14:40 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19692
Received: (qmail 25735 invoked from network); 25 Mar 2004 17:47:58 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 25 Mar 2004 17:47:58 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [130.225.247.86] by sunsite.dk (MessageWall 1.0.8) with SMTP; 25 Mar 2004 17:47:58 -0000
Received: (qmail 6236 invoked from network); 25 Mar 2004 17:47:58 -0000
Received: from ip-66-80-62-153.dsl.sca.megapath.net (HELO ripple.fruitbat.org) (66.80.62.153)
  by a.mx.sunsite.dk with SMTP; 25 Mar 2004 17:47:56 -0000
Received: (from daemon@localhost)
	by ripple.fruitbat.org (8.10.2/8.8.8/PAC-1.3) id i2PHkCG06354;
	Thu, 25 Mar 2004 09:46:12 -0800
Received: from ming.fruitbat.org(192.168.1.2) by ripple.fruitbat.org via smap (V2.1/2.1+anti-relay+anti-spam)
	id xma006349; Thu, 25 Mar 04 09:45:29 -0800
Received: from gremlin.fruitbat.org (IDENT:202@gremlin.fruitbat.org [192.168.1.4])
	by ming.fruitbat.org (8.10.2/8.10.2/PAC-1.6) with ESMTP id i2PIjTi13621;
	Thu, 25 Mar 2004 10:45:29 -0800
Date: Thu, 25 Mar 2004 09:45:34 -0800 (PST)
From: "Peter A. Castro" <doctor@fruitbat.org>
To: Peter Stephenson <pws@csr.com>
cc: cygwin@cygwin.com, Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: dllwrap fails to find last exported symbol alphabetically
In-Reply-To: <11205.1080219923@csr.com>
Message-ID: <Pine.LNX.4.53.0403250919390.5939@gremlin.fruitbat.org>
References: <11205.1080219923@csr.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

On Thu, 25 Mar 2004, Peter Stephenson wrote:

> A problem now seen by two of us with recent Cygwin installations:
> mine was updated to `current' status last week.  However, I don't think
> this is new since I've been seeing it on my own setup for a while.
>
> Zsh uses `dllwrap --export-all-symbols' to link against it's own DLL's.

This should be corrected.  I'd changed the Cygwin port to use
'gcc -shared -Wl,--export-all-symbols'
specifically to address export symbol and other loader related issues
under Cygwin.  Apparently my changes never made it back into the source.
I'll have to see why.

> On the systems in question, dllwrap failed to identify the last symbol
> exported from the main dll (zsh.dll) against which all the other DLL's
> are linked.  The symbol in question is `zwarnnam'; we've verified it
> really is the last symbol by adding a dummy one later in the alphabet,
> and the problem goes away.  (This is an easy workaround so consequently
> finding a real fix isn't a high priority for us.)
>
> It sounds like if this is fundamental lots of people would have fallen
> over it, but I've no idea what else might be relevant.

Don't know.  I've only recently pulled it and started my porting.  I'll
figure out what's happening and feed back.

> Anyway, on systems where it does trigger, it will show up by downloading
> zsh 4.2.0 from ftp://ftp.zsh.org/pub/ and trying to compile with default

4.2.0 has only been out for a few days.  Gimme a little time!

I'll get to the bottom of this.

> options.  You will see warnings about failures to find the symbol
> zwarnnam when linking DLL's.  (The failure seen by users is a crash on
> an attempt to print warning messages form libraries.  Running `vared
> nonexistentvar' form the installed shell will do this.)  We haven't
> narrowed it down any further.
>
> If you (the Cygwin people) need more information, it's probably best to
> prod zsh@sunsite.org (this list runs qconfirm but you only need to
> confirm once).

-- 
Peter A. Castro <doctor@fruitbat.org> or <Peter.Castro@oracle.com>
	"Cats are just autistic Dogs" -- Dr. Tony Attwood

