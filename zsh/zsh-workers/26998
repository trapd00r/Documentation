From zsh-workers-return-26998-mason-zsh=primenet.com.au@sunsite.dk Tue May 26 09:40:57 2009
Return-Path: <zsh-workers-return-26998-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4642 invoked from network); 26 May 2009 09:40:54 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.7 required=5.0 tests=AWL,BAYES_00,URIBL_SBL
	autolearn=no version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 26 May 2009 09:40:54 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 56328 invoked from network); 26 May 2009 09:32:47 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 26 May 2009 09:32:47 -0000
Received: (qmail 20640 invoked by alias); 26 May 2009 09:32:41 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26998
Received: (qmail 20629 invoked from network); 26 May 2009 09:32:41 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 26 May 2009 09:32:41 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [208.87.233.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 17170801E289
	for <zsh-workers@sunsite.dk>; Tue, 26 May 2009 11:32:24 +0200 (CEST)
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly22g.srv.mailcontrol.com (MailControl) with ESMTP id n4Q9Vmd7004811
	for <zsh-workers@sunsite.dk>; Tue, 26 May 2009 10:32:15 +0100
Received: from news01 ([10.99.50.25]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Tue, 26 May 2009 10:25:57 +0100
Date: Tue, 26 May 2009 10:25:57 +0100
From: Peter Stephenson <pws@csr.com>
To: zsh-workers@sunsite.dk
Subject: Re: [PATCH] Respect ./configure --htmldir, keeping our default
Message-ID: <20090526102557.19420500@news01>
In-Reply-To: <20090525181349.GA15763@scru.org>
References: <arvidjaar@gmail.com>
	<200905252131.06325.arvidjaar@gmail.com>
	<200905251806.n4PI6Tt9007174@pws-pc.ntlworld.com>
	<20090525181349.GA15763@scru.org>
Organization: CSR
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.8; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 26 May 2009 09:25:57.0439 (UTC) FILETIME=[F9C2FCF0:01C9DDE3]
X-Scanned-By: MailControl A-06-00-00 (www.mailcontrol.com) on 10.71.0.132
X-Virus-Scanned: ClamAV 0.94.2/9392/Tue May 26 09:37:35 2009 on bifrost
X-Virus-Status: Clean

On Mon, 25 May 2009 18:13:49 +0000
Clint Adams <clint@zsh.org> wrote:
> On Mon, May 25, 2009 at 07:06:29PM +0100, Peter Stephenson wrote:
> > But I'm not sure what's going on here anyway.  Anything that needs to be
> > configurable in the make system is either set by configure or if for
> > some reason that's not appropriate is overridden using shell syntax.
> > Should this be an option to configure?
> 
> Bump the AC_PREREQ to 2.59c and you should guarantee its existence.

So the question is how we keep the same default but use any value on the
command line.  This tests whether the value is the configure default, which
is a value you'd never give on the command line, but it's a bit brittle
since the default can potentially change.  I don't know how to second guess
the standard argument processing; does anyone know?  (This is a completely
different problem from adding an argument not supported internally by
autoconf.)

Index: configure.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.ac,v
retrieving revision 1.124
diff -u -r1.124 configure.ac
--- configure.ac	16 May 2009 12:13:00 -0000	1.124
+++ configure.ac	26 May 2009 09:19:49 -0000
@@ -26,7 +26,7 @@
 dnl
 
 AC_INIT(Src/zsh.h)
-AC_PREREQ(2.53b)
+AC_PREREQ(2.59c)
 AC_CONFIG_HEADER(config.h)
 
 dnl What version of zsh are we building ?
@@ -304,6 +304,12 @@
 AC_SUBST(scriptdir)dnl
 AC_SUBST(sitescriptdir)dnl
 
+dnl htmldir is already handled, but if it wasn't set, use
+dnl the standard zsh default.
+if test x$htmldir = x'${docdir}' || test x$htmldir = x; then
+  htmldir='$(datadir)/$(tzsh)/htmldoc'
+fi
+
 AH_TEMPLATE([CUSTOM_PATCHLEVEL],
 [Define to a custom value for the ZSH_PATCHLEVEL parameter])
 AC_ARG_ENABLE(custom-patchlevel,
Index: Config/defs.mk.in
===================================================================
RCS file: /cvsroot/zsh/zsh/Config/defs.mk.in,v
retrieving revision 1.14
diff -u -r1.14 defs.mk.in
--- Config/defs.mk.in	13 Mar 2008 11:11:04 -0000	1.14
+++ Config/defs.mk.in	26 May 2009 09:19:49 -0000
@@ -50,7 +50,7 @@
 sitefndir       = @sitefndir@
 scriptdir       = @scriptdir@
 sitescriptdir   = @sitescriptdir@
-htmldir         = $(datadir)/$(tzsh)/htmldoc
+htmldir         = @htmldir@
 
 # compilation
 CC              = @CC@


-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

