From zsh-workers-return-25748-mason-zsh=primenet.com.au@sunsite.dk Thu Sep 25 16:06:09 2008
Return-Path: <zsh-workers-return-25748-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15078 invoked from network); 25 Sep 2008 16:05:57 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 Sep 2008 16:05:57 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 69817 invoked from network); 25 Sep 2008 16:05:51 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 25 Sep 2008 16:05:51 -0000
Received: (qmail 20622 invoked by alias); 25 Sep 2008 16:05:45 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25748
Received: (qmail 20606 invoked from network); 25 Sep 2008 16:05:45 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 25 Sep 2008 16:05:45 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [208.87.233.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 99FA580307AB
	for <zsh-workers@sunsite.dk>; Thu, 25 Sep 2008 18:05:37 +0200 (CEST)
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly06g.srv.mailcontrol.com (MailControl) with ESMTP id m8PG54g5010357
	for <zsh-workers@sunsite.dk>; Thu, 25 Sep 2008 17:05:34 +0100
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 25 Sep 2008 17:05:15 +0100
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.2/8.13.4) with ESMTP id m8PG5BEe016712
	for <zsh-workers@sunsite.dk>; Thu, 25 Sep 2008 17:05:11 +0100
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.2/8.14.2/Submit) with ESMTP id m8PG5BmQ016708
	for <zsh-workers@sunsite.dk>; Thu, 25 Sep 2008 17:05:11 +0100
Message-Id: <200809251605.m8PG5BmQ016708@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: Re: PATCH: dynamic named directories
In-reply-to: <080925085108.ZM30831@torch.brasslantern.com>
References: <15726.1222353125@csr.com> <080925085108.ZM30831@torch.brasslantern.com>
Comments: In-reply-to Bart Schaefer <schaefer@brasslantern.com>
   message dated "Thu, 25 Sep 2008 08:51:08 -0700."
Date: Thu, 25 Sep 2008 17:05:11 +0100
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 25 Sep 2008 16:05:15.0688 (UTC) FILETIME=[7F9C6A80:01C91F28]
X-Scanned-By: MailControl A-08-50-15 (www.mailcontrol.com) on 10.71.0.116
X-Virus-Scanned: ClamAV 0.92.1/8336/Thu Sep 25 17:39:47 2008 on bifrost
X-Virus-Status: Clean

Bart Schaefer wrote:
> Only maybe without the corresponding gaping security hole.
> 
> } -			    doshfunc(shfunc, l, 0, 1);
> } +			    doshfunc(shfunc, l, 1);
> 
> Are you sure this is still equivalent to the old way?  Looks like here
> [and in several similar places] doshfunc() was being explicitly told to
> ignore shfunc->node.flags, whereas with your change it will always pay
> attention to them.

The flags in question are PM_UNDEFINED and PM_TAGGED.  The former is
just used to decide whether to set a script name (don't ask me why, but
it looks like an internal consistency matter rather than anything
user-visible); the latter to do tracing by setting XTRACE.  Hence I
don't think it's a security hole.  I suspect that 0 was being passed in
a lot of cases simply because the caller couldn't be bothered to keep
the flags around, which was what was happening even with the function
name in some cases before I changed the interface to pass in the shell
function rather than the code within it.

(By the way, I wonder if, for functions where tracing has been
requested, it would be a good idea if "emulate" didn't turn it off
again...)

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

