From zsh-workers-request@euclid.skiles.gatech.edu Wed Jun 04 16:08:10 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 16522 invoked from network); 4 Jun 1997 16:08:08 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 4 Jun 1997 16:08:08 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id LAA20938; Wed, 4 Jun 1997 11:58:54 -0400 (EDT)
Resent-Date: Wed, 4 Jun 1997 11:58:54 -0400 (EDT)
Message-Id: <199706041601.SAA07220@hydra.ifh.de>
To: Bruce Stephens <B.Stephens@isode.com>,
        zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: Re: Bug in 3.1.2-beta compared with -test1 
In-reply-to: "Bruce Stephens"'s message of "Wed, 04 Jun 1997 14:34:36 MET."
             <199706041331.JAA14313@euclid.skiles.gatech.edu> 
Date: Wed, 04 Jun 1997 18:01:08 +0200
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"8lphK1.0.575.-2Pbp"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3196
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Bruce Stephens wrote:
> I enclose full details, but briefly, with reasonably sane tty settings, after
>  
> "sleep 1&" returns (or some other background job), some stty settings seem 
> wrong: eof, susp, etc., get zapped.  I've never noticed this in previous 
> versions.

Any advance on the following patch?  inforeground seems to me to be
the minimum you would need to do before grabbing the tty settings, so
this can't be far wrong.  It seems to do the trick, anyway.

*** ./Src/jobs.c.old	Wed Jun  4 17:51:43 1997
--- ./Src/jobs.c	Wed Jun  4 17:53:39 1997
***************
*** 155,161 ****
  	}
      }
  
!     if (shout && !ttyfrozen && !jn->stty_in_env)
  	gettyinfo(&shttyinfo);
  
      if (isset(MONITOR)) {
--- 155,161 ----
  	}
      }
  
!     if (shout && !ttyfrozen && !jn->stty_in_env && inforeground)
  	gettyinfo(&shttyinfo);
  
      if (isset(MONITOR)) {

-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77413
Deutsches Elektronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.

