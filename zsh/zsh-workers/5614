From zsh-workers-return-5614-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Mar 03 08:38:19 1999
Return-Path: <zsh-workers-return-5614-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6644 invoked from network); 3 Mar 1999 08:38:17 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 3 Mar 1999 08:38:17 -0000
Received: (qmail 9637 invoked by alias); 3 Mar 1999 08:37:58 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5614
Received: (qmail 9575 invoked from network); 3 Mar 1999 08:37:50 -0000
X-Authentication-Warning: awayteam.zanshin.com: schaefer set sender to schaefer@tiny.zanshin.com using -f
From: Bart Schaefer <schaefer@tiny.zanshin.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14044.62578.384100.791572@localhost.localdomain>
Date: Wed, 3 Mar 1999 00:36:02 -0800 (PST)
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: 3.1.5-pws-10 and then some: _match_test is too strict
X-Mailer: VM 6.65a under Emacs 20.3.5.1
Reply-To: Bart Schaefer <schaefer@zanshin.com>

I just applied all the patches from Sven, Peter, and Matt that have
appeared since pws-10, configured with --disable-dynamic, compiled
without a hitch, ran the new zsh, set up my fpath and sourced the
compinit file.

And no file-related completions worked for me at all.

After staring at the output of repeated completions with `set -vx` in
effect, I finally concluded that the culprit is _match_test.  It seems
that you must have at least one compctl -M spec in effect in order for
_match_test to return true.  Since I don't have any compctl -M at all
and don't particularly want any at the moment, this would appear to be
a minor drawback to the current system.

I realize _match_test is intended to be edited to reflect the user's
personal matcher settings, but it ought to work "out of the box" in a
`zsh -f` situation, oughtn't it?

The following appears to deal with it; does it break something when
there *are* matcher specs?  What's the point of testing for exactly
the first matcher spec, anyway?

Index: Completion/Base/_match_test
===================================================================
diff -u -r1.2 _match_test
--- _match_test	1999/03/03 07:31:03	1.2
+++ _match_test	1999/03/03 08:28:46
@@ -12,4 +12,4 @@
 # match specifications and modify the function `_match_pattern' to build the
 # pattern to use in the calling function.
 
-(( compstate[matcher] == 1 ))
+(( compstate[matcher] <= 1 ))

