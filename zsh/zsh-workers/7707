From zsh-workers-return-7707-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Sep 07 23:03:55 1999
Return-Path: <zsh-workers-return-7707-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23470 invoked from network); 7 Sep 1999 23:03:52 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 7 Sep 1999 23:03:52 -0000
Received: (qmail 6970 invoked by alias); 7 Sep 1999 23:03:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7707
Received: (qmail 6963 invoked from network); 7 Sep 1999 23:03:36 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <990907230328.ZM11775@candle.brasslantern.com>
Date: Tue, 7 Sep 1999 23:03:28 +0000
In-Reply-To: <19990907182401.A28749@dman.com>
Comments: In reply to Clint Adams <schizo@debian.org>
        "PATCH: [3.1.6-pws-3] fix use of DESTDIR in fns" (Sep  7,  6:24pm)
References: <19990907182401.A28749@dman.com>
X-Mailer: Z-Mail Lite (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: Re: PATCH: [3.1.6-pws-3] fix use of DESTDIR in fns
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Sep 7,  6:24pm, Clint Adams wrote:

> +      olddir="$DESTDIR$fndir.old/$subdir"
> +      instdir="$DESTDIR$fndir/$subdir"

> +      olddir="$DESTDIR$fndir.old"
> +      instdir="$DESTDIR$fndir"

Etc. etc.

This is getting out of hand.  Whatever happened to factoring?

Index: Config/installfns.sh
===================================================================
RCS file: /extra/cvsroot/zsh/zsh-3.1/Config/installfns.sh,v
retrieving revision 1.5
diff -u -r1.5 installfns.sh
--- installfns.sh	1999/09/07 22:48:46	1.5
+++ installfns.sh	1999/09/07 23:00:15
@@ -1,10 +1,12 @@
 #!/bin/sh
 
-if test -d $DESTDIR$fndir.old; then
+fndir=$DESTDIR$fndir
+
+if test -d $fndir.old; then
   add_old=1
 fi
 
-$sdir_top/mkinstalldirs $DESTDIR$fndir || exit 1;
+$sdir_top/mkinstalldirs $fndir || exit 1;
 
 # If the source directory is somewhere else, we need to force
 # the shell to expand it in that directory, then strip it off.
@@ -22,17 +24,17 @@
     if test x$FUNCTIONS_SUBDIRS != x -a x$FUNCTIONS_SUBDIRS != xno; then
       subfile="$file"
       subdir="`echo $file | sed -e 's%/[^/]*$%%'`"
-      olddir="$DESTDIR$fndir.old/$subdir"
-      instdir="$DESTDIR$fndir/$subdir"
+      olddir="$fndir.old/$subdir"
+      instdir="$fndir/$subdir"
     else
       subfile="`echo $file | sed -e 's%^.*/%%'`"
-      olddir="$DESTDIR$fndir.old"
-      instdir="$DESTDIR$fndir"
+      olddir="$fndir.old"
+      instdir="$fndir"
     fi
-    if test -f $DESTDIR$fndir/$subfile; then
-      if cmp $DESTDIR$fndir/$subfile $sdir/$file >/dev/null; then :; else
+    if test -f $fndir/$subfile; then
+      if cmp $fndir/$subfile $sdir/$file >/dev/null; then :; else
 	$sdir_top/mkinstalldirs $olddir
-        mv $DESTDIR$fndir/$subfile $olddir
+        mv $fndir/$subfile $olddir
         : ${add_old:=1}
       fi
     fi
@@ -42,7 +44,7 @@
 done
 
 if test x$add_old != x1; then
-  rm -rf $DESTDIR$fndir.old
+  rm -rf $fndir.old
 fi
 
 exit 0
Index: Config/uninstallfns.sh
===================================================================
RCS file: /extra/cvsroot/zsh/zsh-3.1/Config/uninstallfns.sh,v
retrieving revision 1.3
diff -u -r1.3 uninstallfns.sh
--- uninstallfns.sh	1999/09/01 18:04:00	1.3
+++ uninstallfns.sh	1999/09/07 23:00:15
@@ -11,18 +11,20 @@
   fi
 done
 
+fndir=$DESTDIR$fndir
+
 for file in $install; do
   if test -f $sdir/$file; then
     if test x$FUNCTIONS_SUBDIRS != x -a x$FUNCTIONS_SUBDIRS != xno; then
-      rm -f $DESTDIR$fndir/$file;
-      if test -f $DESTDIR$fndir.old/$file; then
-	mv $DESTDIR$fndir.old/$file $DESTDIR$fndir/$file
+      rm -f $fndir/$file;
+      if test -f $fndir.old/$file; then
+	mv $fndir.old/$file $fndir/$file
       fi
     else
       bfile="`echo $file | sed -e 's%^.*/%%'`"
-      rm -f "$DESTDIR$fndir/$bfile"; \
-      if test -f $DESTDIR$fndir.old/$bfile; then
-        mv $DESTDIR$fndir.old/$bfile $DESTDIR$fndir/$bfile
+      rm -f "$fndir/$bfile"; \
+      if test -f $fndir.old/$bfile; then
+        mv $fndir.old/$bfile $fndir/$bfile
       fi
     fi
   fi

