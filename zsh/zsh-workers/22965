From zsh-workers-return-22965-mason-zsh=primenet.com.au@sunsite.dk Sun Nov 05 07:45:00 2006
Return-Path: <zsh-workers-return-22965-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27088 invoked from network); 5 Nov 2006 07:44:56 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 Nov 2006 07:44:56 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 57168 invoked from network); 5 Nov 2006 07:44:49 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 Nov 2006 07:44:49 -0000
Received: (qmail 3373 invoked by alias); 5 Nov 2006 07:44:46 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22965
Received: (qmail 3360 invoked from network); 5 Nov 2006 07:44:46 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 5 Nov 2006 07:44:46 -0000
Received: (qmail 56868 invoked from network); 5 Nov 2006 07:44:45 -0000
Received: from p50891edb.dip0.t-ipconnect.de (HELO moooo.ath.cx) (80.137.30.219)
  by a.mx.sunsite.dk with SMTP; 5 Nov 2006 07:44:44 -0000
Date: Sun, 5 Nov 2006 08:44:35 +0100
From: Matthias Lederhofer <matled@gmx.net>
To: zsh-workers@sunsite.dk
Subject: Re: [BUG] zgetdir() in a directory of a bind mount returns "."
Message-ID: <20061105074435.GA19782@moooo.ath.cx>
References: <20061104192423.GA11308@moooo.ath.cx>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20061104192423.GA11308@moooo.ath.cx>

The problem is that one device can be mounted on itself using bind
mounts.  In this case in line 311 of compat.c pdev and dev are equal
but the inodes differ because readdir() returns the inode of the
target directory of the bind mount and stat(".") in line 252 returned
the inode of the source directory.
Undefining HAVE_STRUCT_DIRENT_D_INO works and I don't know if there is
any other way to work with bind-mounts than not using the inode
returned by readdir().

