From zsh-workers-return-12243-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Jul 13 12:24:28 2000
Return-Path: <zsh-workers-return-12243-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28552 invoked from network); 13 Jul 2000 12:24:26 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 13 Jul 2000 12:24:26 -0000
Received: (qmail 27406 invoked by alias); 13 Jul 2000 12:24:06 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12243
Received: (qmail 27387 invoked from network); 13 Jul 2000 12:23:55 -0000
Date: Thu, 13 Jul 2000 14:23:20 +0200 (MET DST)
Message-Id: <200007131223.OAA26508@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Sven Wischnowsky's message of Thu, 13 Jul 2000 10:40:19 +0200
	(MET DST)
Subject: Re: PATCH: Re: Bug in ${(z)...} lexing, or what?


I wrote:

> ...
> 
> Now we need a way to detect which opening parens in conditions are
> parts of words and I'm not sure where and when to do that (Peter?).

The parser uses the `trick' to increment/decrement incond at the
appropriate places. This seems to do the right thing to make
bufferwords() do the same (well, it only sets incond to 2 at the right 
places).

Anyone sees a problem with this?

Bye
 Sven

Index: Src/hist.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/hist.c,v
retrieving revision 1.10
diff -u -r1.10 hist.c
--- Src/hist.c	2000/07/13 08:42:10	1.10
+++ Src/hist.c	2000/07/13 12:22:30
@@ -2099,6 +2099,10 @@
     strinbeg(0);
     noaliases = 1;
     do {
+	if (incond)
+	    incond = 1 + (tok != DINBRACK && tok != INPAR &&
+			  tok != DBAR && tok != DAMPER &&
+			  tok != BANG);
 	ctxtlex();
 	if (tok == ENDINPUT || tok == LEXERR)
 	    break;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

