From zsh-workers-return-7230-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Jul 21 06:22:33 1999
Return-Path: <zsh-workers-return-7230-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22996 invoked from network); 21 Jul 1999 06:22:31 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 21 Jul 1999 06:22:31 -0000
Received: (qmail 4974 invoked by alias); 21 Jul 1999 06:22:21 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7230
Received: (qmail 4967 invoked from network); 21 Jul 1999 06:22:20 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <990721062216.ZM5628@candle.brasslantern.com>
Date: Wed, 21 Jul 1999 06:22:16 +0000
In-Reply-To: <990721061534.ZM5601@candle.brasslantern.com>
Comments: In reply to "Bart Schaefer" <schaefer@candle.brasslantern.com>
        "PATCH: 3.1.6-test-2: Premature `return' in cancd2()" (Jul 21,  6:15am)
References: <990721061534.ZM5601@candle.brasslantern.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: Re: PATCH: 3.1.6-test-2: Premature `return' in cancd2()
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Jul 21,  6:15am, Bart Schaefer wrote:
} Subject: PATCH: 3.1.6-test-2: Premature `return' in cancd2()
}
} Surely those lines are in the wrong order.

Surely I've been up too late too often recently.  It's actually a good thing
that I snipped one too many lines from the header of the previous attempt,
so you probably can't even apply 7229; here's a better try (ignore 7229).

Index: Src/exec.c
===========================================================================
@@ -3145,6 +3145,7 @@
 {
     struct stat buf;
     char *us, *us2 = NULL;
+    int ret;
 
     /*
      * If CHASEDOTS and CHASELINKS are not set, we want to rationalize the
@@ -3159,9 +3160,10 @@
 	fixdir(us2 = us);
     } else
 	us = unmeta(s);
-    return !(access(us, X_OK) || stat(us, &buf) || !S_ISDIR(buf.st_mode));
+    ret = !(access(us, X_OK) || stat(us, &buf) || !S_ISDIR(buf.st_mode));
     if (us2)
 	free(us2);
+    return ret;
 }
 
 /**/

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

