From zsh-workers-return-21215-mason-zsh=primenet.com.au@sunsite.dk Sat Apr 30 05:31:59 2005
Return-Path: <zsh-workers-return-21215-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13327 invoked from network); 30 Apr 2005 05:31:58 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 30 Apr 2005 05:31:58 -0000
Received: (qmail 33386 invoked from network); 30 Apr 2005 05:31:52 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 30 Apr 2005 05:31:52 -0000
Received: (qmail 3176 invoked by alias); 30 Apr 2005 05:31:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21215
Received: (qmail 3166 invoked from network); 30 Apr 2005 05:31:49 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 30 Apr 2005 05:31:49 -0000
Received: (qmail 33094 invoked from network); 30 Apr 2005 05:31:49 -0000
Received: from vms048pub.verizon.net (206.46.252.48)
  by a.mx.sunsite.dk with SMTP; 30 Apr 2005 05:31:45 -0000
Received: from candle.brasslantern.com ([4.11.1.68])
 by vms048.mailsrvcs.net (Sun Java System Messaging Server 6.2 HotFix 0.04
 (built Dec 24 2004)) with ESMTPA id <0IFQ00LSJVCTFD9G@vms048.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Sat, 30 Apr 2005 00:31:42 -0500 (CDT)
Received: from candle.brasslantern.com (IDENT:schaefer@localhost [127.0.0.1])
	by candle.brasslantern.com (8.12.11/8.12.11) with ESMTP id j3U5VYS0005769	for
 <zsh-workers@sunsite.dk>; Fri, 29 Apr 2005 22:31:40 -0700
Received: (from schaefer@localhost)	by candle.brasslantern.com
 (8.12.11/8.12.11/Submit) id j3U5VTUI005768	for zsh-workers@sunsite.dk; Fri,
 29 Apr 2005 22:31:29 -0700
Date: Sat, 30 Apr 2005 05:31:28 +0000
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: PATCH: Trap test cleanup
To: zsh-workers@sunsite.dk
Message-id: <1050430053129.ZM5767@candle.brasslantern.com>
MIME-version: 1.0
X-Mailer: Z-Mail (5.0.0 30July97)
Content-type: text/plain; charset=us-ascii
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

The test for autoloaded trap functions was leaving the TRAPEXIT file.
The other bit of this is just so we don't have the name of the zsh
executable hardwired in the test script.  (There are some other test
scripts that could use this same trick.)

Index: C03traps.ztst
===================================================================
RCS file: /extra/cvsroot/zsh/zsh-4.0/Test/C03traps.ztst,v
retrieving revision 1.5
diff -c -r1.5 C03traps.ztst
--- C03traps.ztst	18 Feb 2005 17:05:19 -0000	1.5
+++ C03traps.ztst	30 Apr 2005 02:49:19 -0000
@@ -228,14 +228,14 @@
 # Autoloaded traps are horrid, but unfortunately people expect
 # them to work if we support them.
   echo "print Running exit trap" >TRAPEXIT
-  $ZTST_testdir/../Src/zsh -fc '
+  ${${ZTST_exe##[^/]*}:-$ZTST_testdir/$ZTST_exe} -fc '
     fpath=(. $fpath)
     autoload TRAPEXIT
     print "Exiting, attempt 1"
     exit
     print "What?"
   '
-  $ZTST_testdir/../Src/zsh -fc '
+  ${${ZTST_exe##[^/]*}:-$ZTST_testdir/$ZTST_exe} -fc '
     fpath=(. $fpath)
     autoload TRAPEXIT;
     fn() { print Some function }
@@ -249,3 +249,7 @@
 >Some function
 >Exiting, attempt 2
 >Running exit trap
+
+%clean
+
+  rm -f TRAPEXIT

