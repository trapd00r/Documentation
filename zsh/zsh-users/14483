From zsh-users-return-14483-mason-zsh=primenet.com.au@sunsite.dk Sun Oct 11 17:59:33 2009
Return-Path: <zsh-users-return-14483-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3855 invoked from network); 11 Oct 2009 17:59:20 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 11 Oct 2009 17:59:20 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 33937 invoked from network); 11 Oct 2009 17:59:08 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 11 Oct 2009 17:59:08 -0000
Received: (qmail 29301 invoked by alias); 11 Oct 2009 17:58:57 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 14483
Received: (qmail 29279 invoked from network); 11 Oct 2009 17:58:56 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 11 Oct 2009 17:58:56 -0000
Received: from mtaout03-winn.ispmail.ntl.com (mtaout03-winn.ispmail.ntl.com [81.103.221.49])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 6B9A1805D09E
	for <zsh-users@sunsite.dk>; Sun, 11 Oct 2009 19:58:49 +0200 (CEST)
Received: from aamtaout04-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout03-winn.ispmail.ntl.com
          (InterMail vM.7.08.04.00 201-2186-134-20080326) with ESMTP
          id <20091011175848.NGVP17277.mtaout03-winn.ispmail.ntl.com@aamtaout04-winn.ispmail.ntl.com>
          for <zsh-users@sunsite.dk>; Sun, 11 Oct 2009 18:58:48 +0100
Received: from pws-pc ([82.6.98.90]) by aamtaout04-winn.ispmail.ntl.com
          (InterMail vG.2.02.00.01 201-2161-120-102-20060912) with ESMTP
          id <20091011175848.EJHB22934.aamtaout04-winn.ispmail.ntl.com@pws-pc>
          for <zsh-users@sunsite.dk>; Sun, 11 Oct 2009 18:58:48 +0100
Date: Sun, 11 Oct 2009 18:58:36 +0100
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-users@sunsite.dk
Subject: Re: How to make underlining of a command line disappear after an 
 ordinary key press? (2)
Message-ID: <20091011185836.1c887e18@pws-pc>
In-Reply-To: <433290.81065.qm@web65608.mail.ac4.yahoo.com>
References: <237967ef0910101440k4cf7e2e6t4cf2dc132b514ec@mail.gmail.com>
	<433290.81065.qm@web65608.mail.ac4.yahoo.com>
X-Mailer: Claws Mail 3.7.2 (GTK+ 2.16.6; x86_64-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Cloudmark-Analysis: v=1.0 c=1 a=msrThg0DyCgA:10 a=CjxXgO3LAAAA:8 a=NLZqzBF-AAAA:8 a=PeZ-ZV9FtWEkoUqEp-EA:9 a=HcP1Qw1VKcqY3SueUUoA:7 a=1Echcj-k3NHNnpIEnA1un5LfUbIA:4 a=rC2wZJ5BpNYA:10 a=_dQi-Dcv4p4A:10
X-Virus-Scanned: ClamAV 0.94.2/9881/Sat Oct 10 11:21:35 2009 on bifrost
X-Virus-Status: Clean

On Sat, 10 Oct 2009 15:07:42 -0700 (PDT)
Guido van Steen <gvsteen@yahoo.com> wrote:
> I had actually tried that before, but I got: 
> 
> "ordinary-key-press:2: job table full or recursion limit 
> exceeded" 

Are you sure you called .self-insert and not self-insert within the new
widget?  If you used self-insert the widget would call the function over
and over, with that error.  If you use .self-insert you're guaranteed
it's calling the internal widget and you can't get recursion.

> Moreover "zle -N self-insert ordinary-key-press"
> might bind some non-ordinary keys as well. 

You can check within the widget.  The string $KEYS contains the literal
keystrokes used to invoke the command.  Test with something like

if [[ $KEYS = [[:print:]] ]]; then
  # reset behaviour for any printable character
fi
zle .self-insert

although of course it's up to you what keys to bind the special
behaviour too.

By the way, with space be sure it's not bound to magic-space.

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

