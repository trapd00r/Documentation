From zsh-workers-return-8394-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Oct 24 21:04:19 1999
Return-Path: <zsh-workers-return-8394-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16234 invoked from network); 24 Oct 1999 21:04:15 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 24 Oct 1999 21:04:15 -0000
Received: (qmail 20923 invoked by alias); 24 Oct 1999 21:04:09 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8394
Received: (qmail 20916 invoked from network); 24 Oct 1999 21:04:09 -0000
Subject: Re: PATCH: 3.1.6 install without rebuild (Re: 3.0 DESTDIR)
In-Reply-To: <991024175838.ZM6757@candle.brasslantern.com> from Bart Schaefer at "Oct 24, 1999  5:58:38 pm"
To: schaefer@candle.brasslantern.com (Bart Schaefer)
Date: Sun, 24 Oct 1999 22:04:07 +0100 (BST)
Cc: schizo@debian.org, zsh-workers@sunsite.auc.dk
X-Mailer: ELM [version 2.4ME+ PL48 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Message-Id: <E11fUoB-0007l4-00@crucigera.fysh.org>
From: Zefram <zefram@fysh.org>

Bart Schaefer wrote:
>This means that "make MODDIR=/some/new/path fndir=/some/other/new/path"
>does not recompile zsh,

I intentionally wrote that code so that that *would* cause a recompile.
make MODDIR=foo guarantees to build a zsh which has the module directory
specified.  After your patch, changing MODDIR for make results in a zsh
with indeterminate module directory.  You would require a "make clean"
to reliably change the module directory, when in reality only a couple of
files need to be rebuilt.  (I'm operating under a more general principle
that the final result of make should be the same regardless of files
already built; make's job is simply to minimise the amount that gets
rebuilt, reusing a partial build if possible.)

Btw, my view is that giving different parameters to "make install"
from those one gave to "make" is a bad practice, but if it is to be
supported then the parameters from "make install" must take precedence.
After all, those are the parameters that will take effect if anything
changes and gets rebuilt during the "make install".

All of this is a matter of "least surprise", too.

>I'm now considering backing out the $DESTDIR stuff, because with this patch
>you can do this kind of thing (which works in 3.0.7 as well, by the way):
>
>	configure --prefix='${INSTROOT}/usr/local'
>	make
>	make INSTROOT=/tmp/zshtest install

Surely you're joking, Mr Schaefer.  OK, that's a nice hack, but DESTDIR
is a whole lot clearer.  Let's keep configured pathnames and install
paths properly distinct.

-zefram

