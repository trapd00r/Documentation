From zsh-users-return-8868-mason-zsh=primenet.com.au@sunsite.dk Thu May 19 09:38:31 2005
Return-Path: <zsh-users-return-8868-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21185 invoked from network); 19 May 2005 09:38:29 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 19 May 2005 09:38:29 -0000
Received: (qmail 7271 invoked from network); 19 May 2005 09:38:22 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 19 May 2005 09:38:22 -0000
Received: (qmail 17137 invoked by alias); 19 May 2005 09:33:35 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8868
Received: (qmail 17119 invoked from network); 19 May 2005 09:33:33 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 19 May 2005 09:33:33 -0000
Received: (qmail 95193 invoked from network); 19 May 2005 09:33:33 -0000
Received: from mailhost1.csr.com (HELO MAILSWEEPER01.csr.com) (81.105.217.43)
  by a.mx.sunsite.dk with SMTP; 19 May 2005 09:33:27 -0000
Received: from exchange03.csr.com (unverified [10.100.137.60]) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.12) with ESMTP id <T7100eae9a70a6c8d01618@MAILSWEEPER01.csr.com> for <zsh-users@sunsite.dk>;
 Thu, 19 May 2005 10:31:39 +0100
Received: from csr.com ([10.102.144.127]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Thu, 19 May 2005 10:34:53 +0100
To: zsh-users@sunsite.dk
Subject: Re: zsh compiling on Apple OSX v. 10.4.x 
In-Reply-To: Message from William Scott <wgscott@chemistry.ucsc.edu> 
   of "Thu, 19 May 2005 00:02:36 PDT." <294439D0-476D-43F3-8326-8209C1F3FE9C@chemistry.ucsc.edu> 
References: <294439D0-476D-43F3-8326-8209C1F3FE9C@chemistry.ucsc.edu> 
Date: Thu, 19 May 2005 10:33:26 +0100
Message-ID: <29834.1116495206@csr.com>
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 19 May 2005 09:34:53.0589 (UTC) FILETIME=[02EBFC50:01C55C56]
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

William Scott wrote:
> When I tried compiling zsh on OSX v. 10.4, I found that the resulting  
> zsh, when invoked, did not appear to respond to arrow keys, back- 
> spaces and so-forth (I say "appear" because apparently it just  
> doesn't update the terminal display).  Following Apple's patch, I  
> configured and then edited the file config.h to remove the lines
> 
> 
>      391 /* Define to 1 if you have the `poll' function. */
>      392 /* #define HAVE_POLL 1 */
>      393
>      394 /* Define to 1 if you have the <poll.h> header file. */
>      395 /* #define HAVE_POLL_H 1 */
> 
> Then compiled and installed and the problem went away.
> 
> However, I have two questions:
> 
> 1.  What did I do, and is it harmful?

There are various ways for the shell to wait for input, in particular
a key press, without using CPU time while it does so.  The poll()
system call is one.  Chances are that your system also has the
select() system call, in which case when you comment out the lines above
zsh will use that instead.  (You could check for HAVE_SELECT in
config.h.)  As long as keyboard input is working the shell must be happy;
if removing poll() had done anything harmful, you'd certainly know by now.

> 2.  When root uses zsh (either the one I compiled or the one Apple  
> provided) the problem returns.  What's going on with that?

The possibilities are (i) some shell option is different, which you can
check by running in both cases without initilisation files (ii) something
in the environment is different, the TERM variable being an obvious
possibility (or TERMCAP, or TERMINFO) (iii) there are a different set
of dynamic libraries in use as root (iv) different STREAMS modules
have been pushed onto the terminal I/O stream; we had problems with the
zpty module owing to STREAMS weirdness (sorry if this sounds rather opaque,
it's rather opaque to me too) (v) something I haven't thought of.  It's
hard to guess.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

**********************************************************************

