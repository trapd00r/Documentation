From zsh-workers-return-16236-mason-zsh=primenet.com.au@sunsite.dk Mon Nov 12 09:11:48 2001
Return-Path: <zsh-workers-return-16236-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7314 invoked from network); 12 Nov 2001 09:11:47 -0000
Received: from ns2.primenet.com.au (HELO primenet.com.au) (?HEqILvybXnguoEBSaBlBga3r4cyUSxro?@203.24.36.3)
  by ns1.primenet.com.au with SMTP; 12 Nov 2001 09:11:47 -0000
Received: (qmail 8628 invoked from network); 12 Nov 2001 09:11:43 -0000
Received: from sunsite.dk (130.225.247.90)
  by proxy.melb.primenet.com.au with SMTP; 12 Nov 2001 09:11:43 -0000
Received: (qmail 25945 invoked by alias); 12 Nov 2001 09:11:28 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16236
Received: (qmail 25933 invoked from network); 12 Nov 2001 09:11:26 -0000
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <1011112091032.ZM18280@candle.brasslantern.com>
Date: Mon, 12 Nov 2001 09:10:31 +0000
In-Reply-To: <20011112113910O.ohm@rcac.tdi.co.jp>
Comments: In reply to Akitoshi MORISHIMA <ohm@rcac.tdi.co.jp>
        "[bug report] 4.0.2 / 4.0.4 dumps core" (Nov 12, 11:39am)
References: <20011112113910O.ohm@rcac.tdi.co.jp>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Akitoshi MORISHIMA <ohm@rcac.tdi.co.jp>, zsh-workers@sunsite.dk
Subject: Re: [bug report] 4.0.2 / 4.0.4 dumps core
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Nov 12, 11:39am, Akitoshi MORISHIMA wrote:
}
} Condition:
} 	put only the following line
} 
} 	setopt extendedglob globcomplete
} 
} 	in .zshrc, and inactivate(remove) every other startup files,
} 	and invoke zsh
} 
} Type:
} 	!^ then [TAB]
} 
} then zsh dumps core...
} 
} I guess "!^" accesses to "previous command line", which is expectd to
} be always present even without history-related settings, but this
} isn't true in this "special" case...

This is a mis-diagnosis.

Zsh is attempting to complete reserved words (in this case, the word "!").
The reswords table contains static strings, but the completion code tries
to poke '\0' byte in at the end of the word, resulting in a segfault on any
platform where static strings aren't writable.

The combination of extendedglob and globcomplete (which makes "^" mean
something), plus lack of history, tickles the bug, but is not the reason
for it:

schaefer[524] Src/zsh -f
zagzig% setopt extendedglob globcomplete nobanghist
zagzig% !^<TAB>zsh: segmentation fault (core dumped)  Src/zsh -f


-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

