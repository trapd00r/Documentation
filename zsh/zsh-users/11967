From zsh-users-return-11967-mason-zsh=primenet.com.au@sunsite.dk Mon Oct 08 15:47:05 2007
Return-Path: <zsh-users-return-11967-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13445 invoked from network); 8 Oct 2007 15:46:56 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 8 Oct 2007 15:46:56 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 69602 invoked from network); 8 Oct 2007 15:46:51 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 8 Oct 2007 15:46:51 -0000
Received: (qmail 16058 invoked by alias); 8 Oct 2007 15:46:43 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11967
Received: (qmail 16039 invoked from network); 8 Oct 2007 15:46:42 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 8 Oct 2007 15:46:42 -0000
Received: (qmail 68260 invoked from network); 8 Oct 2007 15:46:42 -0000
Received: from an-out-0708.google.com (209.85.132.240)
  by a.mx.sunsite.dk with SMTP; 8 Oct 2007 15:46:35 -0000
Received: by an-out-0708.google.com with SMTP id c14so141968anc
        for <zsh-users@sunsite.dk>; Mon, 08 Oct 2007 08:46:34 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=beta;
        h=domainkey-signature:received:received:received:date:from:to:subject:message-id:references:mime-version:content-type:content-disposition:in-reply-to:user-agent;
        bh=mFc9j+X5ge61Px0zxNPRzZkWS2ISKPgiLSgDlbVQpKk=;
        b=Kg7ZtZCjkaF9s3o1oEB+zYOvbDOlU6RXkgJNGu4cUkyp5kh4v23eNEYAv7rUnn8x9i7NZFdqy6cNfv4m52hl6ag8a7zHlDw9jQsYB+x9xnyaPAr5jT1S22vHaZpuCwJRpBMQWHsph0LslGMYPd7f9YJVWLYu5Z6pleCwZNxpn8Y=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=beta;
        h=received:date:from:to:subject:message-id:references:mime-version:content-type:content-disposition:in-reply-to:user-agent;
        b=m6kz3Ijo+u+8NLQxiVMw4RPXOsTOFFegmkh/Clz+aoo4fTlTWM9iBAIADC4zfru2Ue/o7QHOmRW7yykcd6SReZRCm6IA9fpH04vMRhVwAoie1JkMzr7GwUrB1nC0F9xHFs0YkObftCHiexeScftEKmC7yFbP6icF4pGlGU9zffw=
Received: by 10.142.142.16 with SMTP id p16mr2088299wfd.1191858393809;
        Mon, 08 Oct 2007 08:46:33 -0700 (PDT)
Received: from mastermind ( [76.99.60.158])
        by mx.google.com with ESMTPS id h9sm7113024wxd.2007.10.08.08.46.31
        (version=TLSv1/SSLv3 cipher=OTHER);
        Mon, 08 Oct 2007 08:46:33 -0700 (PDT)
Received: by mastermind (sSMTP sendmail emulation); Mon, 08 Oct 2007 11:46:32 -0400
Date: Mon, 8 Oct 2007 11:46:32 -0400
From: Matthew Wozniski <godlygeek@gmail.com>
To: zsh-users@sunsite.dk
Subject: Re: Failing to write to history file if containing directory
	doesn't exist
Message-ID: <20071008154632.GB18576@mastermind>
References: <dbfc82860710080309m41cfa984q5aa0474c6b4bdf62@mail.gmail.com> <200710081015.l98AFlIU018448@news01.csr.com> <dbfc82860710080508o3ef1de0br957caf39bb2aa19f@mail.gmail.com> <200710081338.l98Dc2br012284@news01.csr.com> <dbfc82860710080705w6e90db9i2a9714caf27460c4@mail.gmail.com> <20071008141403.GA25326@scowler.net> <20071008151949.GA18576@mastermind> <dbfc82860710080830r289c962eyde18f1564e7f0de0@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <dbfc82860710080830r289c962eyde18f1564e7f0de0@mail.gmail.com>
User-Agent: Mutt/1.5.15+20070412 (2007-04-11)

On Mon, Oct 08, 2007 at 05:30:08PM +0200, Nikolai Weibull wrote:
> On 10/8/07, Matthew Wozniski wrote:
> 
> > I don't know that I'd be shocked, but I would err on the side of
> > a smaller, faster, more maintainable shell, given how easy to handle
> > in shell code the problem is.  Shell code is more easily maintained
> > than C, and for an error condition that should only exist when the
> > HISTFILE parameter is set, I think adding code to the shell itself
> > would be overkill.  If you're already setting HISTFILE yourself, it's
> > not too much extra work to add an mkdir -p above it.
> 
> And what if the directory gets deleted between the time HISTFILE is
> set and the shell exits?
The only way that should ever happen is if the user removed (or moved)
the directory himself.  If that's the case, the shell should certainly
not recreate a directory that the user intentionally deleted, each and
every time the history is updated.  That would make it impossible for
a user with HISTFILE=~/.zsh/history to do something as simple as:

% mv .zsh .zsh-4.3.4
% ln -s .zsh-4.3.4 .zsh

without first unsetting and later setting HISTFILE, since the
directory would be recreated between the two commands.

> I'd rather err on the side of a more intelligent, "work hard for the
> user"-type shell that doesn't let my data disappear out into oblivion
> without doing its best to keep said data around.

But really, you're talking about recreating a directory that was just
deleted.  In this case we really ought to err on the principle of
least surprise.  After all, that directory didn't just get up and walk
away, someone had to delete it.  ;)

~Matt

