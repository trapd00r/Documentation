From zsh-workers-return-20171-mason-zsh=primenet.com.au@sunsite.dk Fri Jul 16 19:48:34 2004
Return-Path: <zsh-workers-return-20171-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17862 invoked from network); 16 Jul 2004 19:48:33 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Jul 2004 19:48:33 -0000
Received: (qmail 58016 invoked from network); 16 Jul 2004 19:48:27 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Jul 2004 19:48:27 -0000
Received: (qmail 16290 invoked by alias); 16 Jul 2004 19:48:15 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20171
Received: (qmail 16275 invoked from network); 16 Jul 2004 19:48:15 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by 130.225.247.90 with SMTP; 16 Jul 2004 19:48:15 -0000
Received: (qmail 54575 invoked from network); 16 Jul 2004 19:46:16 -0000
Received: from acolyte.scowler.net (216.254.112.45)
  by a.mx.sunsite.dk with SMTP; 16 Jul 2004 19:46:15 -0000
Received: from localhost (localhost [127.0.0.1])
	by acolyte.scowler.net (Postfix) with ESMTP id 919087004E;
	Fri, 16 Jul 2004 15:46:14 -0400 (EDT)
Received: from acolyte.scowler.net ([127.0.0.1])
	by localhost (acolyte [127.0.0.1]) (amavisd-new, port 10024)
	with LMTP id 28726-01-2; Fri, 16 Jul 2004 15:46:11 -0400 (EDT)
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id F1A0570014; Fri, 16 Jul 2004 15:46:10 -0400 (EDT)
Date: Fri, 16 Jul 2004 15:46:10 -0400
From: Clint Adams <clint@zsh.org>
To: zsh-workers@sunsite.dk
Cc: 251378@bugs.debian.org, 259768@bugs.debian.org,
	251378-submitter@bugs.debian.org, 259768-submitter@bugs.debian.org,
	mdz@debian.org
Subject: Re: Bug#251378: zsh: segfaults when globing includes too many files
Message-ID: <20040716194610.GA28706@scowler.net>
References: <20040706192223.GA378@scowler.net> <200407131106.i6DB6AZT009203@news01.csr.com> <20040716175620.GA22143@scowler.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20040716175620.GA22143@scowler.net>
User-Agent: Mutt/1.5.6+20040523i
X-Virus-Scanned: by amavisd-new-20030616-p10 (Debian) at scowler.net
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

> Attached is a script from Peter Palfrader which seems to trigger the
> same type of segfault in zhalloc().

This is HEAD with the mremap patch, which seems to be irrelevant.
Should dyncat(s,"") just duplicate s, or should that be avoided earlier?

#0  0x0007cb78 in zhalloc (size=32) at /home/clint/tmp/zsh/Src/mem.c:353
#1  0x000b2bd0 in dyncat (s1=0x10de88 ".Maillists.aaaa.2004.06/", s2=0x7001e1cc "")
    at /home/clint/tmp/zsh/Src/string.c:100
#2  0x00046644 in insert (s=0x7001e1cc "", checked=0) at /home/clint/tmp/zsh/Src/glob.c:352
#3  0x0004720c in scanner (q=0x7001e1d0) at /home/clint/tmp/zsh/Src/glob.c:514
#4  0x000478e0 in scanner (q=0x7001e198) at /home/clint/tmp/zsh/Src/glob.c:615
#5  0x0004b428 in zglob (list=0x7001e0f0, np=0x7001e104, nountok=0)
    at /home/clint/tmp/zsh/Src/glob.c:1578
#6  0x000b48b8 in globlist (list=0x7001e0f0, nountok=0) at /home/clint/tmp/zsh/Src/subst.c:273
#7  0x0003dd1c in execcmd (state=0xeffffae8, input=0, output=0, how=18, last1=2)
    at /home/clint/tmp/zsh/Src/exec.c:2161
#8  0x00039e54 in execpline2 (state=0xeffffae8, pcode=45699, how=18, input=0, output=0, last1=0)
    at /home/clint/tmp/zsh/Src/exec.c:1274
#9  0x00038c30 in execpline (state=0xeffffae8, slcode=4098, how=18, last1=0)
    at /home/clint/tmp/zsh/Src/exec.c:1064
#10 0x000380a0 in execlist (state=0xeffffae8, dont_change_job=0, exiting=0)
    at /home/clint/tmp/zsh/Src/exec.c:870
#11 0x00037bc8 in execode (p=0x7001e090, dont_change_job=0, exiting=0)
    at /home/clint/tmp/zsh/Src/exec.c:771
#12 0x0005da74 in loop (toplevel=1, justonce=0) at /home/clint/tmp/zsh/Src/init.c:165
#13 0x00061c78 in zsh_main (argc=3, argv=0xeffffd34) at /home/clint/tmp/zsh/Src/init.c:1274
#14 0x00019d90 in main (argc=3, argv=0xeffffd34) at /home/clint/tmp/zsh/Src/main.c:93

