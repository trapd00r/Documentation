From zsh-workers-return-27626-mason-zsh=primenet.com.au@zsh.org Sat Jan 23 22:17:38 2010
Return-Path: <zsh-workers-return-27626-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23682 invoked by alias); 23 Jan 2010 22:17:38 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 27626
Received: (qmail 28782 invoked from network); 23 Jan 2010 22:17:36 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,SPF_HELO_PASS
	autolearn=ham version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at bewatermyfriend.org does not designate permitted sender hosts)
From: Frank Terbeck <ft@bewatermyfriend.org>
To: zsh-workers@zsh.org
Cc: richih.mailinglist@gmail.com
Subject: Re: PATCH: PATCH: Add `sourcetrace' option
In-Reply-To: <1264283601-27005-1-git-send-email-ft@bewatermyfriend.org> (Frank
	Terbeck's message of "Sat, 23 Jan 2010 22:53:21 +0100")
References: <2d460de71001231216x76bd0320y2bd29c31c685ca26@mail.gmail.com>
	<1264283601-27005-1-git-send-email-ft@bewatermyfriend.org>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.1 (gnu/linux)
Date: Sat, 23 Jan 2010 23:14:43 +0100
Message-ID: <877hr8xycs.fsf@ft.bewatermyfriend.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Df-Sender: 430444

Frank Terbeck writes:
[...]
> diff --git a/Src/init.c b/Src/init.c
> index 123e20e..c59d632 100644
> --- a/Src/init.c
> +++ b/Src/init.c
> @@ -1102,6 +1102,11 @@ source(char *s)
>  	return SOURCE_NOT_FOUND;
>      }
>  
> +    if (isset(SOURCETRACE)) {
> +	fprintf(stderr, "sourcetrace> \"%s\"\n", s);
> +	fflush(stderr);
> +    }
> +
>      /* save the current shell state */
>      fd        = SHIN;            /* store the shell input fd                  */
>      obshin    = bshin;          /* store file handle for buffered shell input */
[...]

Okay, this breaks menu selection for me...

I've got no idea what's going on. Needless to say, this patch is worth
nothing if it breaks other parts of the shell. The test suite seems to
pass just fine. But menu selection, as I said doesn't work anymore.

I'm really interested in why the code above blows up menu selection.
Anyone who knows what's going on, feel free to explain what the deal
is here.


Regards, Frank - puzzled.

