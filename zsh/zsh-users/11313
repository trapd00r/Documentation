From zsh-users-return-11313-mason-zsh=primenet.com.au@sunsite.dk Mon Mar 19 00:59:17 2007
Return-Path: <zsh-users-return-11313-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25901 invoked from network); 19 Mar 2007 00:59:15 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.8 (2007-02-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO
	autolearn=ham version=3.1.8
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 19 Mar 2007 00:59:15 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 13835 invoked from network); 19 Mar 2007 00:59:09 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 19 Mar 2007 00:59:09 -0000
Received: (qmail 21264 invoked by alias); 19 Mar 2007 00:59:01 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11313
Received: (qmail 21255 invoked from network); 19 Mar 2007 00:59:01 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 19 Mar 2007 00:59:01 -0000
Received: (qmail 12634 invoked from network); 19 Mar 2007 00:59:01 -0000
Received: from vms046pub.verizon.net (206.46.252.46)
  by a.mx.sunsite.dk with SMTP; 19 Mar 2007 00:58:58 -0000
Received: from torch.brasslantern.com ([71.116.70.212])
 by vms046.mailsrvcs.net (Sun Java System Messaging Server 6.2-6.01 (built Apr
 3 2006)) with ESMTPA id <0JF40032ULDWK2M6@vms046.mailsrvcs.net> for
 zsh-users@sunsite.dk; Sun, 18 Mar 2007 19:58:45 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id l2J0wgpR007015	for
 <zsh-users@sunsite.dk>; Sun, 18 Mar 2007 17:58:43 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id l2J0wgMG007014	for zsh-users@sunsite.dk; Sun,
 18 Mar 2007 17:58:42 -0700
Date: Sun, 18 Mar 2007 17:58:42 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: compsys argument-n not working
In-reply-to: <fe1bad250703180003k78f13d5aq17b855c575b8ef91@mail.gmail.com>
To: zsh-users@sunsite.dk
Message-id: <070318175842.ZM7013@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <fe1bad250703180003k78f13d5aq17b855c575b8ef91@mail.gmail.com>
Comments: In reply to "Benjamin Andresen" <bandresen@gmail.com>
 "compsys argument-n not working" (Mar 18,  8:03am)

On Mar 18,  8:03am, Benjamin Andresen wrote:
}
} zstyle -e ':completion:*:cd:*' fake 'reply=TEST'
}
} this works, but will complete for both arguments to cd.

Really?  I can't get "cd" to complete anything for a second argument,
no matter what styles I've defined.  In fact it won't even tell me
a context with ^Xh at that point, which is probably a bug.

} zstyle -e ':completion:*:cd:*:argument-1:*' fake 'reply=TEST'
} 
} is supposed to work if I interprete the manual correctly.

     "... However, this is only the case if
      the command line is parsed with standard UNIX-style options and
      arguments, so many completions do not set this."

What that really means is that argument-N context is created only if
the completion is implemented in terms of the "comparguments" builtin,
which _cd is not.  And even then the value of N might not be a number,
but instead could be the string "rest" meaning that all remaining
arguments are to be treated the same.

(Even if _cd did support argument-N, the placement in the context
would be :completion:*:cd:argument-1: -- the context you used above
has too many colons after the command name field.)

The approach to use here is to explicitly check the argument position
within the style, rather than relying on the context string.

zstyle -e ':completion:*:cd:*' fake '(( CURRENT == 2 )) && reply=TEST'

However, as I said, for me that's not needed because cd won't complete
a second argument in any case.

