From zsh-workers-return-24685-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 05 22:42:41 2008
Return-Path: <zsh-workers-return-24685-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8225 invoked from network); 5 Mar 2008 22:42:30 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 Mar 2008 22:42:30 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 92405 invoked from network); 5 Mar 2008 22:42:21 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 Mar 2008 22:42:21 -0000
Received: (qmail 9888 invoked by alias); 5 Mar 2008 22:42:18 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24685
Received: (qmail 9876 invoked from network); 5 Mar 2008 22:42:18 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 5 Mar 2008 22:42:18 -0000
Received: from smarty.dreamhost.com (smarty.dreamhost.com [208.113.175.8])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 1630D8029404
	for <zsh-workers@sunsite.dk>; Wed,  5 Mar 2008 23:42:11 +0100 (CET)
Received: from herod.dreamhost.com (herod.dreamhost.com [208.113.239.72])
	by smarty.dreamhost.com (Postfix) with ESMTP id 62185EE24E;
	Wed,  5 Mar 2008 14:42:10 -0800 (PST)
Received: by herod.dreamhost.com (Postfix, from userid 130321)
	id B3A716049A; Wed,  5 Mar 2008 14:41:58 -0800 (PST)
Date: Wed, 5 Mar 2008 14:41:58 -0800
From: Wayne Davison <wayned@users.sourceforge.net>
To: Peter Stephenson <pws@csr.com>, zsh-workers@sunsite.dk,
	Sven Joachim <svenjoac@gmx.de>, 369305@bugs.debian.org
Subject: Re: Bug#369305: zsh: failed to write history file /home/sven/.zsh-history: no such file or directory
Message-ID: <20080305224158.GB9620@herod.dreamhost.com>
References: <87ir01bb68.fsf@gmx.de> <20080305144438.GA9541@scowler.net> <200803051712.m25HCNk6006441@news01.csr.com> <20080305202936.GA24616@scowler.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20080305202936.GA24616@scowler.net>
User-Agent: Mutt/1.5.9i
X-Virus-Scanned: ClamAV 0.91.2/6142/Wed Mar  5 21:09:30 2008 on bifrost
X-Virus-Status: Clean

On Wed, Mar 05, 2008 at 03:29:36PM -0500, Clint Adams wrote:
> As Sven notes, any history added before exiting will make it into the
> history file despite the error message.

The history being added is the appending going on due to SHARE_HISTORY.
The error is referring to the inability to rewrite the history file on
exit, and it is actually failing (because the write-new, then rename
steps would cause the file to change ownership).  If incremental history
updating was not happening, the failed rewrite would indeed not save
anything new.  The "no such file or directory" error string is
presumably a left-over errno that Peter noticed.

Aside:  I like to make sure to never mix user history and root history,
so I define a different HISTFILE for root (e.g. .zhist_$USER).

..wayne..

