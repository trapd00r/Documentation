From zsh-workers-return-19892-mason-zsh=primenet.com.au@sunsite.dk Fri May 07 10:51:06 2004
Return-Path: <zsh-workers-return-19892-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28305 invoked from network); 7 May 2004 10:51:05 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.86)
  by ns1.primenet.com.au with SMTP; 7 May 2004 10:51:05 -0000
Received: (qmail 487 invoked from network); 7 May 2004 10:50:51 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 May 2004 10:50:51 -0000
Received: (qmail 4731 invoked by alias); 7 May 2004 10:50:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19892
Received: (qmail 2499 invoked from network); 7 May 2004 10:35:47 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (qmailr@130.225.247.86)
  by sunsite.dk with SMTP; 7 May 2004 10:35:44 -0000
Received: (qmail 25086 invoked from network); 7 May 2004 10:35:44 -0000
Received: from smtp4.cern.ch (137.138.131.165)
  by a.mx.sunsite.dk with SMTP; 7 May 2004 10:35:42 -0000
Received: from pcitadc13.cern.ch (pcitadc13.cern.ch [137.138.41.226])
	by smtp4.cern.ch (8.12.1-20030924/8.12.1) with ESMTP id i47AZFk1023067
	for <zsh-workers@sunsite.dk>; Fri, 7 May 2004 12:35:15 +0200 (MET DST)
Received: by pcitadc13.cern.ch (Postfix, from userid 32266)
	id 6F41D1B887; Fri,  7 May 2004 12:35:15 +0200 (CEST)
Date: Fri, 7 May 2004 12:35:15 +0200
From: KELEMEN Peter <Peter.Kelemen@cern.ch>
To: zsh-workers@sunsite.dk
Subject: [4.2.0] Src/hist.c:lockhistfile() endless loop
Message-ID: <20040507103515.GE12559@chihiro.cern.ch>
Mail-Followup-To: KELEMEN Peter <Peter.Kelemen@cern.ch>,
	zsh-workers@sunsite.dk
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
Organization: CERN European Laboratory for Particle Physics, Switzerland
X-GPG-KeyID: 1024D/9FF0CABE 2004-04-03
X-GPG-Fingerprint: 6C9E 5917 3B06 E4EE 6356  7BF0 8F3E CAB6 9FF0 CABE
X-Comment: Personal opinion.  Paragraphs might have been reformatted.
X-Copyright: Forwarding or publishing without permission is prohibited.
X-Accept-Language: hu,en
User-Agent: Mutt/1.5.6i
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_44 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0

[ Please Cc: me since I'm not subscribed.  Thanks. ]

Hello,

  2141              while (link(tmpfile, lockfile) < 0) {
  2142                  if (stat(lockfile, &sb) < 0) {
  2143                      if (errno == ENOENT)
  2144                          continue;

This looks like an endless loop if
 1) link() fails, and
 2) stat() returns -ENOENT.

It was the case for me with $HOME being on OpenAFS and an expired
ticket (link() returned -EACCES).  What guarantees do we have here
to say that link() will eventually succeed?

Peter

-- 
    .+'''+.         .+'''+.         .+'''+.         .+'''+.         .+''
 Kelemen Péter     /       \       /       \     Peter.Kelemen@cern.ch
.+'         `+...+'         `+...+'         `+...+'         `+...+'

