From zsh-workers-return-20177-mason-zsh=primenet.com.au@sunsite.dk Wed Jul 21 21:32:44 2004
Return-Path: <zsh-workers-return-20177-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13934 invoked from network); 21 Jul 2004 21:32:42 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 21 Jul 2004 21:32:42 -0000
Received: (qmail 87944 invoked from network); 21 Jul 2004 21:32:32 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 21 Jul 2004 21:32:32 -0000
Received: (qmail 25789 invoked by alias); 21 Jul 2004 21:32:07 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20177
Received: (qmail 15954 invoked from network); 21 Jul 2004 21:17:06 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by 130.225.247.90 with SMTP; 21 Jul 2004 21:17:06 -0000
Received: (qmail 56965 invoked from network); 21 Jul 2004 21:15:08 -0000
Received: from postfix4-2.free.fr (213.228.0.176)
  by a.mx.sunsite.dk with SMTP; 21 Jul 2004 21:15:07 -0000
Received: from watt.caraldi.com (toulouse-1-62-147-36-197.dial.proxad.net [62.147.36.197])
	by postfix4-2.free.fr (Postfix) with ESMTP id 2EC1A1AE010
	for <zsh-workers@sunsite.dk>; Wed, 21 Jul 2004 23:15:05 +0200 (CEST)
Received: by watt.caraldi.com (Postfix, from userid 1001)
	id 362B5F7; Wed, 21 Jul 2004 23:15:33 +0200 (CEST)
Date: Wed, 21 Jul 2004 23:15:33 +0200
From: Jean-Baptiste Quenot <jb.quenot@caraldi.com>
To: zsh-workers@sunsite.dk
Subject: [PATCH] killall completion for FreeBSD
Message-ID: <20040721211529.GA2406@watt.intra.caraldi.com>
Mail-Followup-To: Jean-Baptiste Quenot <jb.quenot@caraldi.com>,
	zsh-workers@sunsite.dk
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="h31gzZEtNLTqOjlF"
Content-Disposition: inline
User-Agent: Mutt/1.5.6i
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: *
X-Spam-Status: No, hits=1.5 required=6.0 tests=RCVD_IN_SORBS autolearn=no 
	version=2.63
X-Spam-Hits: 1.5


--h31gzZEtNLTqOjlF
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Dear workers,

I noticed that killall completion does  not work on FreeBSD.  This patch
addresses the issue, as the  completion was originally only intended for
GNU/Linux.   Indeed,  FreeBSD  uses  a  slightly  different  syntax  for
expressing ps output options.

Best regards,
-- 
Jean-Baptiste Quenot
http://caraldi.com/jbq/

--h31gzZEtNLTqOjlF
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename=zsh-killall-freebsd

--- Completion/Unix/_killall.orig	Wed Jul 21 22:31:12 2004
+++ Completion/Unix/_killall	Wed Jul 21 23:13:13 2004
@@ -4,6 +4,10 @@
   _alternative \
       'signals:: _signals -p' \
       'processes:process:{ compadd "$expl[@]" ${${${${(f)"$(_call_program processes-names ps ${${EUID/(#s)0(#e)/xa}//[0-9]#/} ho cmd 2> /dev/null)"//[][\(\)]/}:#(ps|COMMAND|-*)}%%\ *}:t} }'
+elif [[ $service = killall && "$OSTYPE" = freebsd* ]]; then
+  _alternative \
+      'signals:: _signals -p' \
+      'processes:process:{ compadd "$expl[@]" ${${${${(f)"$(_call_program processes-names ps ${${EUID/(#s)0(#e)/xa}//[0-9]#/}ho comm 2> /dev/null)"//[][\(\)]/}:#(ps|COMMAND|-*)}%%\ *}:t} }'
 else
   _signals -p
 fi

--h31gzZEtNLTqOjlF--

