From zsh-workers-request@math.gatech.edu Tue Dec 09 09:16:07 1997
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 1526 invoked from network); 9 Dec 1997 09:16:05 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 9 Dec 1997 09:16:05 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id DAA25939;
	Tue, 9 Dec 1997 03:59:07 -0500 (EST)
Resent-Date: Tue, 9 Dec 1997 03:59:07 -0500 (EST)
Message-Id: <199712090859.JAA00493@hydra.ifh.de>
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: Re: typeset -U broken in 3.1.2? 
In-reply-to: "Bernd Eggink"'s message of "Mon, 08 Dec 1997 15:55:14 MET."
             <348C0A52.9D868E10@rrz.uni-hamburg.de> 
Date: Tue, 09 Dec 1997 09:59:53 +0100
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"58a7T.0.EL6.QXGZq"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3647
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Bernd Eggink wrote:
> Any comments (or, preferably, patches)?

The typeset code needs rewriting completely.  The interaction between
local variables and other typeset options is generally very poor.  One
other difficulty with the code is if you use typeset to change the behaviour
of a variable:  maintaining consistency between the two values can be
a big job (changing from an integer to a string is one example which is
currently handled, but there are all sorts of others).

Adding typeset -A isn't a bad idea either; it might provide an obvious
way of tying arrays and colon-separated variables together, i.e.
typeset -A arrayname -? colonname[=colon:value:with:colons] \
    [ array value in words ]
(I don't know what the ? should be; obviously you wouldn't set both the
colon version and array version at once) which would make the typeset -A
part on its own a natural counterpart to set -A, but would make the array
local if necessary (except maybe if you give -? ! That's another
problem of consistency to sort out: sometimes you don't want a
typeset made local, and some times it should depend on the name by
which it's called, e.g. export and typeset -x should be different).

But that justs makes the code even more complicated... I've always been
put off from this because you really need to start from scratch, and in
that case there's just so much to get right which in the current code has
partially agglomerated [I just checked that in WWWebster] over the centuries.

-- 
Peter Stephenson <pws@ifh.de>       Tel: +39 50 911239
WWW:  http://www.ifh.de/~pws/
Gruppo Teorico, Dipartimento di Fisica
Piazza Torricelli 2, 56100 Pisa, Italy

