From zsh-workers-return-27431-mason-zsh=primenet.com.au@zsh.org Tue Nov 24 15:34:55 2009
Return-Path: <zsh-workers-return-27431-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7549 invoked by alias); 24 Nov 2009 15:34:55 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 27431
Received: (qmail 28241 invoked from network); 24 Nov 2009 15:34:52 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00,
	UNPARSEABLE_RELAY autolearn=ham version=3.2.5
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.219.222 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:received:date:from:to:subject
         :message-id:mime-version:content-type:content-disposition:user-agent;
        bh=lyV0ediAbFX9z68ib2HME0GwQBtgS/U/ttFt4dhMihQ=;
        b=uQE+4apft2dyhG9fBFkElCQSGmRbSGY4OdC78Nv6d1jl/H92+JY+N9KgEbPToNLTHR
         eEwMtwOw3S210bcm6oNeYg49LHgM2vHBic5zdZPmM9lfx+ooyhypGbGrAlz3GhK4sBFY
         K0rFNoUD8wx8MOZzsTb1LBlFy1wgU0QTp0UuU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=date:from:to:subject:message-id:mime-version:content-type
         :content-disposition:user-agent;
        b=B8UdRO/ygS1B+BKlA21wqdhdpEwHtNY/r2RPzCatWj+22MVMx8yBx3L2xeKjCPQXwU
         pkD4bTBY4y/51wGk7K42wwj3iqjDsrvAHlCNw6O/R+8TO9mn2lU4DVRAlFXeMxW0X/EQ
         pEAX3MJzXYBSv+T1WqBGLBVZJscyI31/cfv20=
Date: Tue, 24 Nov 2009 16:28:50 +0100
From: Baptiste Daroussin <baptiste.daroussin@gmail.com>
To: zsh-workers@zsh.org
Subject: make _make works at finding targets with freebsd's make
Message-ID: <20091124152850.GA61961@wicklow.lan>
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="GvXjxJ+pjyke8COw"
Content-Disposition: inline
User-Agent: Mutt/1.5.20 (2009-06-14)

--GvXjxJ+pjyke8COw
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hi,

Here is a patch to make _make work at finding (so completing) targets using
freebsd's make
unfortunatly bsdmake are different on netbsd and openbsd so that only works on
freebsd.

I don't know if the case is the right way to do that, I did it to prepare the
case for NetBSD and OpenBSD

regards,
Bapt

--GvXjxJ+pjyke8COw
Content-Type: text/x-diff; charset=us-ascii
Content-Disposition: attachment; filename="0001-Add-support-for-FreeBSD-s-make.patch"

>From dc5e357927db945ebdb130ee12c0a48ff006cfef Mon Sep 17 00:00:00 2001
From: Bapt <baptiste.daroussin@gmail.com>
Date: Tue, 24 Nov 2009 16:22:18 +0100
Subject: [PATCH] Add support for FreeBSD's make

---
 Completion/Unix/Command/_make |    8 +++++++-
 1 files changed, 7 insertions(+), 1 deletions(-)

diff --git a/Completion/Unix/Command/_make b/Completion/Unix/Command/_make
index f0d2088..e404d16 100644
--- a/Completion/Unix/Command/_make
+++ b/Completion/Unix/Command/_make
@@ -193,7 +193,13 @@ else
     then
       parseMakefile $PWD < <(_call_program targets "$words[1]" -nsp --no-print-directory -f "$file" .PHONY 2> /dev/null)
     else
-      parseMakefile $PWD < $file
+      case "$OSTYPE" in
+        freebsd*)
+        parseMakefile $PWD < <(_call_program targets "$words[1]" -nsp -f "$file" .PHONY 2> /dev/null)
+	;;
+	*)
+        parseMakefile $PWD < $file
+      esac
     fi
   fi
 
-- 
1.6.4.4


--GvXjxJ+pjyke8COw--

