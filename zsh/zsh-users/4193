From zsh-users-return-4193-mason-zsh=primenet.com.au@sunsite.dk Tue Sep 04 16:53:27 2001
Return-Path: <zsh-users-return-4193-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18259 invoked from network); 4 Sep 2001 16:53:26 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 4 Sep 2001 16:53:26 -0000
Received: (qmail 23168 invoked by alias); 4 Sep 2001 16:53:12 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4193
Received: (qmail 23155 invoked from network); 4 Sep 2001 16:53:11 -0000
Date: Tue, 4 Sep 2001 16:52:58 +0000
From: Kevin Way <kevin.way@overtone.org>
To: Bart Schaefer <schaefer@brasslantern.com>
Cc: zsh-users@sunsite.dk
Subject: Re: TRAPALRM and vlock problem
Message-ID: <20010904165258.A4946@bean.overtone.org>
References: <20010904161322.B49337@bean.overtone.org> <1010904162403.ZM13062@candle.brasslantern.com>
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-md5;
	protocol="application/pgp-signature"; boundary="k+w/mQv8wyuph6w0"
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <1010904162403.ZM13062@candle.brasslantern.com>; from schaefer@brasslantern.com on Tue, Sep 04, 2001 at 04:24:03PM +0000


--k+w/mQv8wyuph6w0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

On Tue, Sep 04, 2001 at 04:24:03PM +0000, Bart Schaefer wrote:
> On Sep 4,  4:13pm, Kevin Way wrote:
> }
> } The problem is that when called by zsh in this manner, vlock will only
> } accept one character, making it impossible to unlock the terminal.
>=20
> Try replacing the call to "vlock -c" with a call to "stty -a" just to
> find out what the tty settings are at the time vlock runs.

Your suggestion below worked, but seeing as you thought this might be a
bug, I thought I should include:

The output of stty -a from within the trap:

speed 115200 baud; 25 rows; 80 columns;
lflags: -icanon isig iexten -echo echoe -echok echoke -echonl echoctl
        -echoprt -altwerase -noflsh -tostop -flusho -pendin -nokerninfo
        -extproc
iflags: -istrip icrnl inlcr -igncr ixon -ixoff ixany imaxbel -ignbrk
        brkint -inpck -ignpar -parmrk
oflags: opost onlcr -ocrnl -oxtabs -onocr -onlret
cflags: cread cs8 -parenb -parodd hupcl -clocal -cstopb -crtscts -dsrflow
        -dtrflow -mdmbuf
cchars: discard =3D <undef>; dsusp =3D <undef>; eof =3D ^D; eol =3D <undef>;
        eol2 =3D <undef>; erase =3D ^H; erase2 =3D ^H; intr =3D ^C; kill =
=3D ^U;
        lnext =3D <undef>; min =3D 1; quit =3D <undef>; reprint =3D ^R;
        start =3D ^Q; status =3D ^T; stop =3D ^S; susp =3D <undef>; time =
=3D 0;
        werase =3D ^W;

And the output of stty -a from a regular command line:

speed 115200 baud; 25 rows; 80 columns;
lflags: icanon isig iexten echo echoe -echok echoke -echonl echoctl
        -echoprt -altwerase -noflsh -tostop -flusho pendin -nokerninfo
        -extproc
iflags: -istrip icrnl -inlcr -igncr ixon -ixoff ixany imaxbel -ignbrk
        brkint -inpck -ignpar -parmrk
oflags: opost onlcr -ocrnl -oxtabs -onocr -onlret
cflags: cread cs8 -parenb -parodd hupcl -clocal -cstopb -crtscts -dsrflow
        -dtrflow -mdmbuf
cchars: discard =3D ^O; dsusp =3D ^Y; eof =3D ^D; eol =3D <undef>;
        eol2 =3D <undef>; erase =3D ^H; erase2 =3D ^H; intr =3D ^C; kill =
=3D ^U;
        lnext =3D ^V; min =3D 1; quit =3D ^\; reprint =3D ^R; start =3D ^Q;
        status =3D ^T; stop =3D ^S; susp =3D ^Z; time =3D 0; werase =3D ^W;

> If for some reason the ZLE tty settings are not being reset properly
> from inside a trap (which would be a bug, but could be happening), try
> replacing "vlock -c" in the trap with
>=20
> 	STTY=3Dsane vlock -c

This fixes the problem for me, thank you!

Kevin Way

--k+w/mQv8wyuph6w0
Content-Type: application/pgp-signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.6 (FreeBSD)
Comment: For info see http://www.gnupg.org

iD8DBQE7lQbpKxA01iDoLN4RApkcAJ9Ccjr4xIUtJ2dmEViEDxt6spPFLwCglrJ3
G8X867TSIRvA0k3wEtHegog=
=iCsx
-----END PGP SIGNATURE-----

--k+w/mQv8wyuph6w0--

