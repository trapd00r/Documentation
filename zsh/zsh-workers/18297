From zsh-workers-return-18297-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 26 03:14:57 2003
Return-Path: <zsh-workers-return-18297-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13033 invoked from network); 26 Feb 2003 03:14:56 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 26 Feb 2003 03:14:56 -0000
Received: (qmail 25082 invoked by alias); 26 Feb 2003 03:14:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18297
Received: (qmail 25069 invoked from network); 26 Feb 2003 03:14:48 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 26 Feb 2003 03:14:48 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [207.172.4.61] by sunsite.dk (MessageWall 1.0.8) with SMTP; 26 Feb 2003 3:14:48 -0000
Received: from 209-122-247-161.c3-0.nwt-ubr2.sbo-nwt.ma.cable.rcn.com ([209.122.247.161] helo=zion.rcn.com)
	by smtp02.mrf.mail.rcn.net with esmtp (Exim 3.35 #4)
	id 18ns1w-0006ej-00
	for zsh-workers@sunsite.dk; Tue, 25 Feb 2003 22:14:48 -0500
Received: by zion.rcn.com (Postfix, from userid 501)
	id 8465E79CF; Tue, 25 Feb 2003 22:13:42 -0500 (EST)
To: zsh-workers@sunsite.dk
Subject: Yank-pop Dumps Core
From: Vin Shelton <acs@alumni.princeton.edu>
Organization: EtherSoft, Inc
Date: Tue, 25 Feb 2003 22:13:42 -0500
Message-ID: <m2d6lfraxl.fsf@zion.rcn.com>
Lines: 41
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

In the latest CVS sources, the following recipe dumps core:

zsh -f
bindkey -e
asdf^A^K^Y<esc>y

Popping one too many yanks off the stack causes a crash.

Here is the backtrace:

Loaded symbols for /home/acs/zsh-debug/lib/zsh/4.1.0-dev-7/zsh/compctl.so
#0  0x4020a97d in yankpop (args=0x40225250) at /opt/src/zsh-2003-02-25-1603/Src/Zle/zle_misc.c:413
413         } while (!buf->buf || !*buf->buf);
(gdb) bt
#0  0x4020a97d in yankpop (args=0x40225250) at /opt/src/zsh-2003-02-25-1603/Src/Zle/zle_misc.c:413
#1  0x40207ca2 in execzlefunc (func=0x402241d0, args=0x40225250)
    at /opt/src/zsh-2003-02-25-1603/Src/Zle/zle_main.c:892
#2  0x402073f3 in zlecore () at /opt/src/zsh-2003-02-25-1603/Src/Zle/zle_main.c:690
#3  0x40207977 in zleread (lp=0x80e17d0 "%m%# ", rp=0x0, flags=3)
    at /opt/src/zsh-2003-02-25-1603/Src/Zle/zle_main.c:824
#4  0x0807c560 in inputline () at /opt/src/zsh-2003-02-25-1603/Src/input.c:275
#5  0x0807c41c in ingetc () at /opt/src/zsh-2003-02-25-1603/Src/input.c:214
#6  0x080740c9 in ihgetc () at /opt/src/zsh-2003-02-25-1603/Src/hist.c:241
#7  0x080825e4 in gettok () at /opt/src/zsh-2003-02-25-1603/Src/lex.c:631
#8  0x08081ea3 in yylex () at /opt/src/zsh-2003-02-25-1603/Src/lex.c:347
#9  0x080997c7 in parse_event () at /opt/src/zsh-2003-02-25-1603/Src/parse.c:449
#10 0x0807953f in loop (toplevel=1, justonce=0) at /opt/src/zsh-2003-02-25-1603/Src/init.c:128
#11 0x0807c090 in zsh_main (argc=2, argv=0xbffffa54) at /opt/src/zsh-2003-02-25-1603/Src/init.c:1266
#12 0x080516da in main (argc=2, argv=0xbffffa54) at /opt/src/zsh-2003-02-25-1603/Src/main.c:37
#13 0x400bb082 in __libc_start_main () from /lib/i686/libc.so.6

zsh-4.0.6 does not seem to have this problem.

This is on my x86 Linux box at home; uname -a reports:

Linux zion.rcn.com 2.4.19-24acs #4 SMP Tue Feb 25 20:10:27 EST 2003
i686 unknown unknown GNU/Linux


HTH,
  Vin

