From zsh-workers-return-28905-mason-zsh=primenet.com.au@zsh.org Fri Mar 18 01:57:44 2011
Return-Path: <zsh-workers-return-28905-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14154 invoked by alias); 18 Mar 2011 01:57:44 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28905
Received: (qmail 12749 invoked from network); 18 Mar 2011 01:57:33 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_LOW
	autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at mired.org does not designate permitted sender hosts)
Date: Thu, 17 Mar 2011 21:50:41 -0400
From: Mike Meyer <mwm@mired.org>
To: zsh-workers@zsh.org
Subject: Re: How to contribute VCSInfo back end for fossil
Message-ID: <20110317215041.0ddd1e80@bhuda.mired.org>
In-Reply-To: <87hbb1ibyl.fsf@ft.bewatermyfriend.org>
References: <20110317182628.63ad9100@bhuda.mired.org>
	<87hbb1ibyl.fsf@ft.bewatermyfriend.org>
Organization: Meyer Consulting
X-Mailer: Claws Mail 3.7.7 (GTK+ 2.22.1; amd64-portbld-freebsd8.1)
Face: iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAG1BMVEXguIzRkGnhyaz069mXhW0WHRnbrnR9WCQ6LB0CchNMAAACSUlEQVQ4jV2TQW7jMAxFGaPQOgQEdZaGMsgBrAvUA03dCxj1Uu4U2gfwQD7AGNax51NK07RcxXz6/CSl0Ij450vkPG1jzpIZM1UwDCl/xB14TWnNX8A00Qj5a0mnVFVbVUz4MeErea2HikSRqZzY894zwg9p2+/AtO8LzxFED+tNAUFeU29iFOLRxlZAcdo9A8wi8ZBMV4BKPde82Oxrvs6BTkulQIClte0DLFzzsKk9j1MBex8iUaP00Bd78S/muyFScrTXz6zLkEUxJp+SabQfNOs4f4Jpx5qSZ/304PWwlEWP1cOn/mJQR7EOD+uKhjcBLziuL7xoY5Xm+VFAUSw/LwwwsHEHxihpwV4EJH0xXRkbw1PkRw+X4pEuSJwBggqk+HEYKkiL5/74/nQkogigzQsAFrakxZyfw3wMIEEZPv4AWMfxwqE5GNxGaERjmH+PG8AE0L4/w9g0lsp1raLYAN5azQa+AOoO9NwcpFkTrG2VKNMNEL5UKUUAw34tha0z7onUG0oBoNtczE04GwFE3wCHc0ChezAJ6A1WMV81AtY7wDAJSlXwV+4cwBvsOsrQMRawfQEBz0deEZ7WNpV2szckIKo5VpDHDSDvF1GItwqqAlG01Hh50BGtVhuUkjkasg/14bYFGCgWg1fSWHvmOoJck2xdp9ZvZBHzDVTzX23TkrOn7qe5U2COEw5D4Vx3qEQpFY2Z/3QFnJxzp7YCmSMG19nOUoe869zZfOQb5ywQuWu0yCn5+8gxZz+BE7vG3j4/wbf4D/sXN9Wug1s7AAAAAElFTkSuQmCC
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

On Fri, 18 Mar 2011 00:06:26 +0100
Frank Terbeck <ft@bewatermyfriend.org> wrote:

> Mike Meyer wrote:
> > Sorry if this is the wrong place, but neither google nor
> > hand-examining the zsh sites turned up a place for such submissions...
> This is exactly the right place.

Cool.

> As you can see, I've removed the code that surrounded the `$fsrev'
> variable. Specifically, the `fsrevformat' style and the
> `set-fsrev-format' hook. They didn't add much, as you've got full access
> to the same data in with the `branchformat' style and the
> `set-branch-format' hook (I kept the `$fsrev' variable for clarity).

That was modeled after the hgrevformat variable. If that's gone away
in later versions, then fsrevformat should go away.

I initially did this without fsrevformat. I changed it because it
seems slightly cleaner to have vcs-specific variables that control how
the revision value is presented for each vcs rather than having to
tweak branchformat for each vcs with a hash-based revision - which
seems to be required because once you shorten it, zformat can't make
it longer, so that %r has to be the entire hash, which is unwieldy.
With fsrevformat, I only have to change branchformat and the various
VCS's follow automatically, rather than having to change branchformat
for each VCS using hash-based revisions. Maybe the hook facility
solves this - I haven't really explored that.

Either way is fine with me. I just wanted to present the reason before
committing to the other way.

> Like this, the only required documentation update would be to name
> fossil among the supported systems in zshcontrib(1).
> 
> If you're okay with those changes, it would be good if you could check
> whether the above code works or not - I didn't test those changes.

They don't work. You deleted the setting of hook_com prior to setting
fsrev, which meant fsrev was set to "".  It needs to be set to
${fshash}. I think the fshash name is better, as it is the hash
string. If you want it without fsrevformat, I'll wind up pushing that
to the repo in any case, but let me know if you'd rather I email you
that version.

While I'm here - it seems that the git backend doesn't pay attention
to branchformat. Is that a bug (possibly fixed later) or intentional?

      Thanks,
      <mike
-- 
Mike Meyer <mwm@mired.org>		http://www.mired.org/consulting.html
Independent Software developer/SCM consultant, email for more information.

O< ascii ribbon campaign - stop html mail - www.asciiribbon.org

