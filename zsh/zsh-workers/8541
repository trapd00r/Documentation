From zsh-workers-return-8541-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Nov 04 16:29:56 1999
Return-Path: <zsh-workers-return-8541-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8003 invoked from network); 4 Nov 1999 16:29:55 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 4 Nov 1999 16:29:55 -0000
Received: (qmail 28819 invoked by alias); 4 Nov 1999 16:29:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8541
Received: (qmail 28799 invoked from network); 4 Nov 1999 16:29:47 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <991104162933.ZM26120@candle.brasslantern.com>
Date: Thu, 4 Nov 1999 16:29:33 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: 3.1.6-bart-8: bad configure test, misc.
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

This fixes the bad getpwent() test, and changes the handling of (lack of)
yodl to (a) avoid producing errors like ":2txt: command not found" and (b)
produce (hopefully) less confusing output from "make".  Note that it uses
"exit 0" because the old way attempted (badly) to be a successful no-op
when the file to be built already exists, which is the case when you've
unpacked a zsh distribution tar.gz (but NOT when you're using CVS'd source
because zsh.texi et al. are in the .cvsignore files).

(Have I (parenthetically) explained that well enough?)

Also included are .distfiles changes for the recent new and moved files.

Index: configure.in
===================================================================
RCS file: /extra/cvsroot/zsh/zsh-3.1/configure.in,v
retrieving revision 1.48
diff -u -r1.48 configure.in
--- configure.in	1999/11/03 09:49:23	1.48
+++ configure.in	1999/11/04 03:50:33
@@ -398,7 +398,7 @@
 AC_PROG_INSTALL             dnl Check for BSD compatible `install'
 AC_PROG_AWK                 dnl Check for mawk,gawk,nawk, then awk.
 AC_PROG_LN                  dnl Check for working ln, for "make install"
-AC_CHECK_PROGS([YODL], [yodl], [:])
+AC_CHECK_PROGS([YODL], [yodl], [exit 0; yodl])
 
 dnl ------------------
 dnl CHECK HEADER FILES
@@ -1273,12 +1273,13 @@
 #include <pwd.h>
 main() {
     struct passwd *pw1, *pw2;
-    char buf[1024];
+    char buf[1024], name[1024];
     sprintf(buf, "%d:%d", getpid(), rand());
     pw1=getpwnam(buf);
+    if (pw1) strcpy(name, pw1->pw_name);
     sprintf(buf, "%d:%d", rand(), getpid());
     pw2=getpwnam(buf);
-    exit(pw1!=0 && pw2!=0 && !strcmp(pw1->pw_name, pw2->pw_name));
+    exit(pw1!=0 && pw2!=0 && !strcmp(name, pw2->pw_name));
 }
 ],
       zsh_cv_sys_getpwnam_faked=no,
Index: Completion/Base/.distfiles
===================================================================
RCS file: /extra/cvsroot/zsh/zsh-3.1/Completion/Base/.distfiles,v
retrieving revision 1.7
diff -u -r1.7 .distfiles
--- .distfiles	1999/11/03 09:49:23	1.7
+++ .distfiles	1999/11/04 03:52:44
@@ -1,7 +1,7 @@
 DISTFILES_SRC='
     .distfiles 
     _arg_compile _arguments _brace_parameter _combination _command_names
-    _condition _default _describe _equal _first _job _math _parameter
+    _condition _default _describe _equal _first _jobs _math _parameter
     _precommand _redirect _regex_arguments _subscript _tilde _value
     _values _vars
 '
Index: Completion/Builtins/.distfiles
===================================================================
RCS file: /extra/cvsroot/zsh/zsh-3.1/Completion/Builtins/.distfiles,v
retrieving revision 1.4
diff -u -r1.4 .distfiles
--- .distfiles	1999/11/03 09:49:23	1.4
+++ .distfiles	1999/11/04 03:53:15
@@ -1,7 +1,7 @@
 DISTFILES_SRC='
     .distfiles
     _aliases _arrays _autoload _bg_jobs _bindkey _builtin _cd _command
-    _compdef _disable _echotc _enable _fc _functions _hash _jobs _kill
+    _compdef _disable _echotc _enable _fc _functions _hash _kill
     _limits _nothing _popd _sched _set _setopt _source _stat _trap _unhash
     _unsetopt _vars_eq _wait _which _zftp _zle _zmodload
 '
Index: Completion/Core/.distfiles
===================================================================
RCS file: /extra/cvsroot/zsh/zsh-3.1/Completion/Core/.distfiles,v
retrieving revision 1.3
diff -u -r1.3 .distfiles
--- .distfiles	1999/09/07 17:19:31	1.3
+++ .distfiles	1999/11/04 03:53:28
@@ -1,6 +1,6 @@
 DISTFILES_SRC='
     .distfiles
-    _approximate _compalso _complete _correct _description _display _expand
+    _approximate _compalso _complete _correct _description _expand
     _files _list _main_complete _match _menu _multi_parts
     _message _normal _oldlist _options _parameters _path_files
     _sep_parts _set_options _unset_options
Index: Completion/Debian/.distfiles
===================================================================
RCS file: /extra/cvsroot/zsh/zsh-3.1/Completion/Debian/.distfiles,v
retrieving revision 1.1.3.2
diff -u -r1.1.3.2 .distfiles
--- .distfiles	1999/09/13 15:35:30	1.1.3.2
+++ .distfiles	1999/11/04 03:54:34
@@ -1,5 +1,4 @@
 DISTFILES_SRC='
     .distfiles
-    _apt _deb_packages
+    _apt _deb_packages _dpkg _dpkg-source
 '
-

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

