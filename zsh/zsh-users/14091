From zsh-users-return-14091-mason-zsh=primenet.com.au@sunsite.dk Tue May 05 18:01:17 2009
Return-Path: <zsh-users-return-14091-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2404 invoked from network); 5 May 2009 18:01:05 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 May 2009 18:01:05 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 59397 invoked from network); 5 May 2009 18:00:52 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 May 2009 18:00:52 -0000
Received: (qmail 10301 invoked by alias); 5 May 2009 18:00:28 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 14091
Received: (qmail 10273 invoked from network); 5 May 2009 18:00:27 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 5 May 2009 18:00:27 -0000
Received: from vms173017pub.verizon.net (vms173017pub.verizon.net [206.46.173.17])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 31A6080590A3
	for <zsh-users@sunsite.dk>; Tue,  5 May 2009 19:59:35 +0200 (CEST)
Received: from torch.brasslantern.com ([96.249.201.13])
 by vms173017.mailsrvcs.net
 (Sun Java(tm) System Messaging Server 6.3-7.04 (built Sep 26 2008; 32bit))
 with ESMTPA id <0KJ600CU8NCCT9KO@vms173017.mailsrvcs.net> for
 zsh-users@sunsite.dk; Tue, 05 May 2009 13:00:13 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id n45I0BMq012547	for
 <zsh-users@sunsite.dk>; Tue, 05 May 2009 11:00:12 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id n45I0A2e012546	for zsh-users@sunsite.dk; Tue,
 05 May 2009 11:00:10 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <090505110010.ZM12545@torch.brasslantern.com>
Date: Tue, 05 May 2009 11:00:10 -0700
In-reply-to: <20090505175739.7b2e4aca@news01>
Comments: In reply to Peter Stephenson <pws@csr.com>
 "Re: Set difference between sets of files" (May  5,  5:57pm)
References: <94de1b620905050936g442490e4t3da42ac3946cb29@mail.gmail.com>
	<20090505175739.7b2e4aca@news01>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: zsh-users@sunsite.dk
Subject: Re: Set difference between sets of files
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii
X-Virus-Scanned: ClamAV 0.92.1/9330/Tue May  5 18:18:50 2009 on bifrost
X-Virus-Status: Clean

On May 5,  5:57pm, Peter Stephenson wrote:
}
} > For instance, say I have two directories - master/ and backup/ -
} > containing (mostly) identical files. I would like to remove from
} > backup/ all files which have been removed from master/. I would like
} > to achieve this by doing something like this:
} >
} >     cd master/
} >     MASTER_FILES=(**/*(.))
} >     cd ../backup
} >     BACKUP_FILES=(**/*(.))
} >     TO_REMOVE=<set difference between BACKUP_FILES and MASTER_FILES>
} >     rm -f $TO_REMOVE

I'd typically do this like so:

rm $(for f in backup/**/*(.); [[ -e ${f:s@backup/@master/} ]] || print $f)

Of course that needs a bit of cleanup if any of the file names might have
spaces in them.

Another way is this:

    cd backup
    rm -f **/*(.e:'[[ ! -f ../master/$REPLY ]]':)

Neither of these uses set-differencing on arrays; sometimes you have to
think about alternate approaches to the original problem.

} It might be useful to have a special expression for excluding anything
} that matches an element of a given array, but there isn't one.

Here's another way:

typeset -A differ
eval differ\[${(q)^MASTER_FILES}\]=a
eval differ\[${(q)^BACKUP_FILES}\]=b
print -l -- ${(k)differ[(R)a]}

I tried using

eval noglob unset differ\[${(q)^BACKUP_FILES}\]

but that failed on names containing spaces, for some reason.

