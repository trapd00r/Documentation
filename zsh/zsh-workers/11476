From zsh-workers-return-11476-mason-zsh=primenet.com.au@sunsite.auc.dk Sat May 20 17:34:48 2000
Return-Path: <zsh-workers-return-11476-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27352 invoked from network); 20 May 2000 17:34:47 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 20 May 2000 17:34:47 -0000
Received: (qmail 20083 invoked by alias); 20 May 2000 17:34:40 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11476
Received: (qmail 20073 invoked from network); 20 May 2000 17:34:38 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000520173431.ZM9577@candle.brasslantern.com>
Date: Sat, 20 May 2000 17:34:31 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: Core dump doing accept-and-menu-complete in menu-selection
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

This is with something close to the very latest patches ...

In the top zsh source directory:

zagzig[71] ls *<C-x e>

I now have a menu-selection with all-expansions first and then the individual
files below that, and finally the original string below that.  My styles put
the list of files in most-recently-modified order.

I typed TAB to move to the first file name (Completion), typed ^X TAB (which
I have bound to accept-and-menu-complete) to get to Config, typed TAB to move
on to Doc, typed ^X TAB again, and kaboom.

#0  0x401649fe in domenuselect (dummy=0x4013502c, dat=0xbffff3fc)
    at ../../../zsh-3.1.6/Src/Zle/complist.c:1804
1804                        if (*p == minfo.cur)

It looks as if `p' is garbage at this point, see below.

(gdb) where
#0  0x401649fe in domenuselect (dummy=0x4013502c, dat=0xbffff3fc)
    at ../../../zsh-3.1.6/Src/Zle/complist.c:1804
#1  0x8085694 in runhookdef (h=0x4013502c, d=0xbffff3fc)
    at ../../zsh-3.1.6/Src/module.c:1609
#2  0x4011fe6d in after_complete (dummy=0x40115bb0, dat=0xbffff488)
    at ../../../zsh-3.1.6/Src/Zle/compcore.c:507
#3  0x80856f6 in runhookdef (h=0x40115bb0, d=0xbffff488)
    at ../../zsh-3.1.6/Src/module.c:1615
#4  0x40105bf6 in docomplete (lst=0)
    at ../../../zsh-3.1.6/Src/Zle/zle_tricky.c:773
#5  0x40104577 in completeword (args=0x40115b04)
    at ../../../zsh-3.1.6/Src/Zle/zle_tricky.c:203
#6  0x40104461 in completecall (args=0x40115b04)
    at ../../../zsh-3.1.6/Src/Zle/zle_tricky.c:180
#7  0x400f9b33 in execzlefunc (func=0x80d9cb8, args=0x40115b04)
    at ../../../zsh-3.1.6/Src/Zle/zle_main.c:645
#8  0x400f959f in zleread (lp=0x80c4c68 "%m%(#.#.%1v)%h%(#.#.%2v) ", 
    rp=0x80d0068 "3.1.7-pre-3", flags=3)
    at ../../../zsh-3.1.6/Src/Zle/zle_main.c:564
#9  0x80737da in inputline () at ../../zsh-3.1.6/Src/input.c:265
#10 0x80736cd in ingetc () at ../../zsh-3.1.6/Src/input.c:210
#11 0x806cd6c in ihgetc () at ../../zsh-3.1.6/Src/hist.c:242
#12 0x80785a0 in gettok () at ../../zsh-3.1.6/Src/lex.c:621
#13 0x8077d41 in yylex () at ../../zsh-3.1.6/Src/lex.c:337
#14 0x808d918 in parse_event () at ../../zsh-3.1.6/Src/parse.c:421
#15 0x80710a3 in loop (toplevel=1, justonce=0)
    at ../../zsh-3.1.6/Src/init.c:121
#16 0x8050dc0 in main (argc=2, argv=0xbffff6bc)
    at ../../zsh-3.1.6/Src/main.c:86
(gdb) p p
$1 = (struct cmatch ***) 0x8101000
(gdb) 

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

