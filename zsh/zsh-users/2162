From zsh-users-return-2162-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Feb 16 22:43:55 1999
Return-Path: <zsh-users-return-2162-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4508 invoked from network); 16 Feb 1999 22:43:54 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 16 Feb 1999 22:43:54 -0000
Received: (qmail 1105 invoked by alias); 16 Feb 1999 22:41:59 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 2162
Received: (qmail 1087 invoked from network); 16 Feb 1999 22:41:57 -0000
Message-Id: <199902162241.OAA11943@bebop.clari.net>
To: Sweth Chandramouli <sweth@astaroth.nit.gwu.edu>
Cc: ZSH Users <zsh-users@sunsite.auc.dk>
In-reply-to: sweth's message of Mon, 15 Feb 1999 19:15:09 -0500.
	     <19990215191509.A28737@astaroth.nit.gwu.edu> 
Subject: Re: making sudo work with functions/builtins 
Date: Tue, 16 Feb 1999 14:41:41 -0800
From: Wayne Davison <wayne@clari.net>

Sweth Chandramouli writes:
> i just had a little brainstorm about how to get around this:
> 
> % alias mv='nocorrect mv'
> % ls
> cmd foo
> % alias sudo='sudo cmd '
> % cat cmd
> #!/bin/sh
> eval $SHELL -c \"$@\"
> % sudo mv foo bar
> % ls
> bar cmd
> %

While this cures the error of sudo trying to run "nocorrect", it
does not propagate the "nocorrect" forward soon enough to turn off
spelling corrections on the command.  This delayed application is
more of a problem with a command that has the "noglob" modifier:

% alias e='noglob echo'
% e f*
f*
% sudo e f*
foo

I know of no way around this problem.

Note that your solution also some quoting problems:

% sudo echo 'f*'
foo
% sudo echo 'one    two'   'three    four'
one two three four
% touch 'one two'
% sudo cat 'one two'
cat: cannot open one
cat: cannot open two

One way to fix these is by changing your "cmd" shell script to be:

#!/local/bin/zsh
noglob $@

The way I worked around the sudo problem was to use the following
alias and function.  In addition to avoiding the errors, it also
allows me to type just "sudo" to get the effect of "sudo zsh":

alias sudo='my_sudo '

function my_sudo {
	while [[ $# > 0 ]]; do
		case "$1" in
		command) shift ; break ;;
		nocorrect|noglob) shift ;;
		*) break ;;
		esac
	done
	if [[ $# = 0 ]]; then
		command sudo zsh
	else
		noglob command sudo $@
	fi
}

It doesn't allow me to run any shell builtins or functions, though.

..wayne..

