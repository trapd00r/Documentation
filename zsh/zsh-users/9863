From zsh-users-return-9863-mason-zsh=primenet.com.au@sunsite.dk Sat Jan 28 20:32:57 2006
Return-Path: <zsh-users-return-9863-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15405 invoked from network); 28 Jan 2006 20:32:55 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 28 Jan 2006 20:32:55 -0000
Received: (qmail 2580 invoked from network); 28 Jan 2006 20:32:47 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Jan 2006 20:32:47 -0000
Received: (qmail 24394 invoked by alias); 28 Jan 2006 20:32:40 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 9863
Received: (qmail 24357 invoked from network); 28 Jan 2006 20:32:40 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 28 Jan 2006 20:32:40 -0000
Received: (qmail 1521 invoked from network); 28 Jan 2006 20:32:39 -0000
Received: from vms040pub.verizon.net (206.46.252.40)
  by a.mx.sunsite.dk with SMTP; 28 Jan 2006 20:32:39 -0000
Received: from candle.brasslantern.com ([71.116.81.225])
 by vms040.mailsrvcs.net
 (Sun Java System Messaging Server 6.2-4.02 (built Sep  9 2005))
 with ESMTPA id <0ITT0067CL2DNCD0@vms040.mailsrvcs.net> for
 zsh-users@sunsite.dk; Sat, 28 Jan 2006 14:32:38 -0600 (CST)
Received: from candle.brasslantern.com (IDENT:schaefer@localhost [127.0.0.1])
	by candle.brasslantern.com (8.12.11/8.12.11) with ESMTP id k0SKWaN7001044	for
 <zsh-users@sunsite.dk>; Sat, 28 Jan 2006 12:32:36 -0800
Received: (from schaefer@localhost)	by candle.brasslantern.com
 (8.12.11/8.12.11/Submit) id k0SKWal6001043	for zsh-users@sunsite.dk; Sat,
 28 Jan 2006 12:32:36 -0800
Date: Sat, 28 Jan 2006 20:32:36 +0000
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: history trouble
In-reply-to: <20060128190424.GC19690@thomas-richter.de>
To: list zsh-users <zsh-users@sunsite.dk>
Message-id: <1060128203236.ZM1042@candle.brasslantern.com>
MIME-version: 1.0
X-Mailer: Z-Mail (5.0.0 30July97)
Content-type: text/plain; charset=us-ascii
References: <20060128074156.GA19690@thomas-richter.de>
	<1060128155351.ZM730@candle.brasslantern.com>
	<20060128190424.GC19690@thomas-richter.de>
Comments: In reply to Thomas Richter <richter@thomas-richter.de>
 "Re: history trouble" (Jan 28,  8:04pm)

On Jan 28,  8:04pm, Thomas Richter wrote:
} Subject: Re: history trouble
}
} Hi Bart Schaefer <schaefer@brasslantern.com>,
} you wrote on Saturday, 2006-01-28 15:53:51 +0000:
} > On Jan 28,  8:41am, Thomas Richter wrote:  
} > }
} > } The options look ok for me:
} > 
} > I don't see "login".  Only login shells read the history automatically.
} 
} On my other computer (zsh 4.1.1 (i386-suse-linux)) there also no 
} login set - but it read my history ...

Sorry, I'm being dense this morning.  I forgot that it's my own setup
that skips history settings for non-login shells.

Possible reasons for the history not to be read are:

- the NO_RCS option is set (the doc says this prevents history from
  being written, but it also suppresses reading it)

- the INTERACT option is not set

- lockhistfile() fails because
  + a temporary lock file can't be created in the same directory
    as the HISTFILE
  + a link to that temp file can't be created
  + something else [possibly several somethings] has the file locked
    for more than about 10 seconds (but this shouldn't apply at shell
    startup, only for incremental history)

- the file can't be opened for reading

- some part of the file is corrupt

- HISTSIZE is zero (in which case, I believe, the file is read but all
  the contents are discarded)

My (new, ahem) guess is that the problem is with the lock file.

