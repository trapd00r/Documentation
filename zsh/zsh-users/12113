From zsh-users-return-12113-mason-zsh=primenet.com.au@sunsite.dk Thu Oct 25 11:14:40 2007
Return-Path: <zsh-users-return-12113-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11092 invoked from network); 25 Oct 2007 11:14:31 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 Oct 2007 11:14:31 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 96684 invoked from network); 25 Oct 2007 11:14:24 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 25 Oct 2007 11:14:24 -0000
Received: (qmail 7249 invoked by alias); 25 Oct 2007 11:14:15 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12113
Received: (qmail 7223 invoked from network); 25 Oct 2007 11:14:14 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 25 Oct 2007 11:14:14 -0000
Received: (qmail 95369 invoked from network); 25 Oct 2007 11:14:14 -0000
Received: from smtp.eu.citrix.com (62.200.22.115)
  by a.mx.sunsite.dk with SMTP; 25 Oct 2007 11:14:08 -0000
X-IronPort-AV: E=Sophos;i="4.21,328,1188792000"; 
   d="scan'208";a="11520322"
Received: from lonpexchmx01.citrite.net ([10.30.224.191])
  by LONPIPO01.EU.CITRIX.COM with ESMTP; 25 Oct 2007 07:14:08 -0400
Received: from lonpexch01.citrite.net ([10.30.224.136]) by lonpexchmx01.citrite.net with Microsoft SMTPSVC(6.0.3790.1830);
	 Thu, 25 Oct 2007 12:13:09 +0100
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Slow compdump on Vista - no .zcompdump created
Date: Thu, 25 Oct 2007 12:12:59 +0100
Message-ID: <DD74FBB8EE28D441903D56487861CD9D22835ED2@lonpexch01.citrite.net>
In-Reply-To: <200710251044.l9PAi9Ag016224@news01.csr.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Slow compdump on Vista - no .zcompdump created
thread-index: AcgW9CoahtrZg5c1RGuI2vHi0mpCKAAAx9SQ
References: <DD74FBB8EE28D441903D56487861CD9D22719534@lonpexch01.citrite.net> <016801c8164c$301c5d70$90551850$@com> <DD74FBB8EE28D441903D56487861CD9D2271979B@lonpexch01.citrite.net> <018501c81658$6beebbc0$43cc3340$@com> <DD74FBB8EE28D441903D56487861CD9D2271A057@lonpexch01.citrite.net> <200710251044.l9PAi9Ag016224@news01.csr.com>
From: "John Cooper" <John.Cooper@citrix.com>
To: "Peter Stephenson" <pws@csr.com>,
	"Zsh Users" <zsh-users@sunsite.dk>
Cc: "John Cooper" <John.Cooper@citrix.com>
X-OriginalArrivalTime: 25 Oct 2007 11:13:09.0196 (UTC) FILETIME=[0635F8C0:01C816F8]

For some reason the following line in compdump causes compdump to return
too early:
  [[ -w ${_d_file:h} ]] || return 1

Commenting out this line resolves the problem: .zcompdump is created and
compinit now runs in less than a second.

For me, the above line was being executed with the following path:
  +compdump:24> [[ -w /c/Users/johnc.CITRITE/Documents ]]

I can create files in this directory:
  $ touch /c/Users/johnc.CITRITE/Documents/foo=20
  $

.. although Cygwin seems to think it is not writeable:
  $ ls -ld /c/Users/johnc.CITRITE/Documents

  dr-x------+ 16 johnc mkpasswd 16384 Oct 25 12:10
/c/Users/johnc.CITRITE/Documents/

    --- John.


-----Original Message-----
From: Peter Stephenson [mailto:pws@csr.com]=20
Sent: 25 October 2007 11:44
To: Zsh Users
Subject: Re: Slow compdump on Vista - no .zcompdump created

"John Cooper" wrote:
> Still, it does seem odd that .zcompdump is not created by default.
> Presumably, if it were, compinit would likely run in a fraction of a
> second?
> Does anyone know why .zcompdump might not be getting created on
Cygwin,
> and whether I can force it?

Run "compdump" with "set -x" in effect (you'll probably have to add it
to the first "setopt" in the file) and see why it's not running the
"compdump" around line 493, or if it is why that's not doing anything.

You should be able to force a dump with "compinit -d", which takes an
option file argument to use for dumping.

--=20
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

