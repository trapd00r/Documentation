<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux/x86 (vers 25 March 2009), see www.w3.org">
  <meta http-equiv="Content-Type" content=
  "text/html; charset=utf-8">

  <title>Git Magic - 第&nbsp;2&nbsp;章&nbsp;基本技巧</title>
  <link rel="stylesheet" href="default.css" type="text/css">
  <meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
  <link rel="home" href="index.html" title="Git 魔法">
  <link rel="up" href="index.html" title="Git 魔法">
  <link rel="prev" href="ch01.html" title=
  "第&nbsp;1&nbsp;章&nbsp;入门">
  <link rel="next" href="ch03.html" title=
  "第&nbsp;3&nbsp;章&nbsp;克隆周边">
</head>

<body bgcolor="white" text="black" link="#0000FF" vlink="#840084"
alink="#0000FF">
    <div class="toc">
      <ul>
<li><b>Git Magic</b></li>
        <li>
          <span class="preface"><a href="index.html">前言</a></span>

          <ul>
            <li><span class="section"><a href=
            "index.html#__2">致谢！</a></span></li>

            <li><span class="section"><a href=
            "index.html#__3">许可</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch01.html">1.
          入门</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch01.html#__5">工作是玩</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#__6">版本控制</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#__7">分布控制</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#__8">一个误区</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#__9">合并冲突</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch02.html">2.
          基本技巧</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch02.html#__11">保存状态</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__12">添加、删除、重命名</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__13">进阶撤销/重做</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__14">撤销</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__15">变更日志生成</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__16">下载文件</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__17">到最新</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__18">快速发布</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__19">我们已经做了什么？</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#__20">练习</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch03.html">3.
          克隆周边</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch03.html#__22">计算机间同步</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__23">典型源码控制</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__24">封闭源码</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__25">裸仓库</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__26">推还是拽</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__27">项目分叉</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__28">终极备份</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__29">轻快多任务</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#__30">游击版本控制</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_mercurial">Mercurial</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_bazaar">Bazaar</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_git">我偏爱Git的原因</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch04.html">4.
          分支巫术</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch04.html#__32">老板键</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__33">肮脏的工作</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__34">快速修订</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__35">合并</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__36">不间断工作流</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__37">重组杂乱</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__38">管理分支</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__39">临时分支</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#__40">按你希望的方式工作</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch05.html">5.
          关于历史</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch05.html#__42">我认错</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__43">更复杂情况</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__44">本地变更之后</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__45">重写历史</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__46">制造历史</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__47">哪儿错了？</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__48">谁让事情变糟了？</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#__49">个人经验</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch06.html">6.
          多人Git</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch06.html#__50">我是谁？</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_git_ssh_http">Git在SSH,
            HTTP上</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_git_3">Git在随便什么上</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__51">补丁：全球货币</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__52">对不起，移走了</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__53">远端分支</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__54">多远端</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#__55">我的喜好</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch07.html">7.
          Git大师技</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch07.html#__56">源码发布</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#__57">提交变更</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#__58">我的提交太大了！</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_git_5">索引：Git的中转区域</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_head">别丢了你的HEAD</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_head_2">HEAD捕猎</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_git_6">基于Git构建</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#__59">大胆的特技</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#__60">阻止坏提交</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch08.html">8.
          揭开面纱</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch08.html#__62">大象无形</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__63">数据完整性</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__64">智能</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__65">索引</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_git_7">Git的源起</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__66">对象数据库</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_blob">Blob对象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_tree">Tree对象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_commit">Commit对象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#__67">没那么神</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch09.html">9. 附录 A:
          Git的缺点</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch09.html#_sha1">SHA1 的弱点</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_windows">微软 Windows</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__68">不相关的文件</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__69">谁在编辑什么？</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__70">文件历史</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__71">初始克隆</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__72">不稳定的项目</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__73">全局计数器</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__74">空子目录</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__75">初始提交</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#__76">接口怪癖</a></span></li>
          </ul>
        </li>

        <li><span class="chapter"><a href="ch10.html">10. 附录 B:
        本指南的翻译</a></span></li>
      </ul>
    </div>
<div class="content">
  <div class="chapter" title="第&nbsp;2&nbsp;章&nbsp;基本技巧">
    <div class="titlepage">
      <div>
        <div>
          <h2 class="title"><a name=
          "__10"></a>第&nbsp;2&nbsp;章&nbsp;基本技巧</h2>
        </div>
      </div>
    </div>

    <p>与其一头扎进Git命令的海洋中，不如来点基本的例子试试手。它们简单而且实用。实际
    上，在开始使用Git的头几个月，我所用的从来没超出本章介绍的内容。</p>

    <div class="section" title="保存状态">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__11"></a>保存状态</h2>
          </div>
        </div>
      </div>

      <p>要不来点猛的？在做之前，先为当前目录所有文件做个快照，使用：</p>
      <pre class="literallayout">
$ git init
$ git add .
$ git commit -m "My first backup"
</pre>

      <p>现在如果你的编辑乱了套，恢复之前的版本：</p>
      <pre class="literallayout">
$ git reset --hard
</pre>

      <p>再次保存状态：</p>
      <pre class="literallayout">
$ git commit -a -m "Another backup"
</pre>
    </div>

    <div class="section" title="添加、删除、重命名">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__12"></a>添加、删除、重命名</h2>
          </div>
        </div>
      </div>

      <p>以上命令将只跟踪你第一次运行 <span class="strong"><strong>git
      add</strong></span> 命令时就已经存在的文件。如果要添加新文 件或子目录，你需要告诉Git：</p>
      <pre class="literallayout">
$ git add readme.txt Documentation
</pre>

      <p>类似，如果你想让Git忘记某些文件：</p>
      <pre class="literallayout">
$ git rm kludge.h obsolete.c
$ git rm -r incriminating/evidence/
</pre>

      <p>这些文件如果还没删除，Git删除它们。</p>

      <p>重命名文件和先删除旧文件，再添加新文件的一样。也有一个快捷方式 <span class=
      "strong"><strong>git mv</strong></span> ，和 <span class=
      "strong"><strong>mv</strong></span> 命令的用法一样。例如：</p>
      <pre class="literallayout">
$ git mv bug.c feature.c
</pre>
    </div>

    <div class="section" title="进阶撤销/重做">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__13"></a>进阶撤销/重做</h2>
          </div>
        </div>
      </div>

      <p>有时候你只想把某个时间点之后的所有改动都回滚掉，因为这些的改动是不正确的。那 么：</p>
      <pre class="literallayout">
$ git log
</pre>

      <p>来显示最近提交列表，以及他们的SHA1哈希值:</p>
      <pre class="screen">
commit 766f9881690d240ba334153047649b8b8f11c664
Author: Bob &lt;bob@example.com&gt;
Date:   Tue Mar 14 01:59:26 2000 -0800

    Replace printf() with write().

commit 82f5ea346a2e651544956a8653c0f58dc151275c
Author: Alice &lt;alice@example.com&gt;
Date:   Thu Jan 1 00:00:00 1970 +0000

    Initial commit.
</pre>

      <p>哈希值的前几个字符足够确定一个提交；也可以拷贝粘贴完整的哈希值，键入：</p>
      <pre class="literallayout">
$ git reset --hard 766f
</pre>

      <p>来恢复到一个指定的提交状态，并从记录里永久抹掉所有比该记录新一些的提交。</p>

      <p>另一些时候你想简单地跳到一个旧状态。这种情况，键入：</p>
      <pre class="literallayout">
$ git checkout 82f5
</pre>

      <p>这个操作将把你带回过去，同时也保留较新提交。然而，像科幻电影里时光旅行一样，
      如果你这时编辑并提交的话，你将身处另一个现实里，因为你的动作与开始时相比是不 同的。</p>

      <p>这另一个现实叫作“分支”（branch），之后 <a class="link" href=
      "ch04.html#branch">我们会对这点多讨论一些</a>。 至于现在，只要记住：</p>
      <pre class="literallayout">
$ git checkout master
</pre>

      <p>会把你带到当下来就可以了。另外，为避免Git的抱怨，应该在每次运行checkout之前提
      交（commit）或重置（reset）你的改动。</p>

      <p>还以电脑游戏作为类比：</p>

      <div class="itemizedlist">
        <ul class="itemizedlist">
          <li class="listitem"><span class=
          "strong"><strong><code class="literal">git reset
          --hard</code></strong></span>: 加载一个旧记录并删除所有比之新的记录。</li>

          <li class="listitem"><span class=
          "strong"><strong><code class="literal">git
          checkout</code></strong></span>:
          加载一个旧记录，但如果你在这个记录上玩，游戏状态将偏离第
          一轮的较新状态。你现在打的所有游戏记录会在你刚进入的、代表另一个真实的分支 里。<a class="link"
          href="ch04.html#branch">我们稍后论述</a>。</li>
        </ul>
      </div>

      <p>你可以选择只恢复特定文件和目录，通过将其加在命令之后：</p>
      <pre class="literallayout">
$ git checkout 82f5 some.file another.file
</pre>

      <p>小心，这种形式的 <span class=
      "strong"><strong>checkout</strong></span>
      会不声不响地覆盖文件。为阻止意外发生，在运行任何
      checkout命令之前做提交，尤其在初学Git的时候。通常，任何时候你觉得对运行某个命
      令不放心，无论Git命令还是不是Git命令，就先运行一下 <span class="strong"><strong>git
      commit -a</strong></span> 。</p>

      <p>不喜欢拷贝站题哈希值？那就用：</p>
      <pre class="literallayout">
$ git checkout :/"My first b"
</pre>

      <p>来跳到以特定字符串开头的提交。你也可以回到倒数第五个保存状态：</p>
      <pre class="literallayout">
$ git checkout master~5
</pre>
    </div>

    <div class="section" title="撤销">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__14"></a>撤销</h2>
          </div>
        </div>
      </div>

      <p>在法庭上，事件可以从法庭记录里敲出来。同样，你可以检出特定提交以撤销。</p>
      <pre class="literallayout">
$ git commit -a
$ git revert 1b6d
</pre>

      <p>讲撤销给定哈希值的提交。本撤销被记录为一个新的提交，你可以通过运行 <span class=
      "strong"><strong>git log</strong></span> 来确认这一点。</p>
    </div>

    <div class="section" title="变更日志生成">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__15"></a>变更日志生成</h2>
          </div>
        </div>
      </div>

      <p>一些项目要求生成变更日志<a class="ulink" href=
      "http://en.wikipedia.org/wiki/Changelog" target=
      "_top">changelog</a>. 生 成一个，通过键入：</p>
      <pre class="literallayout">
$ git log &gt; ChangeLog
</pre>
    </div>

    <div class="section" title="下载文件">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__16"></a>下载文件</h2>
          </div>
        </div>
      </div>

      <p>得到一个由Git管理的项目的拷贝，通过键入：</p>
      <pre class="literallayout">
$ git clone git://server/path/to/files
</pre>

      <p>例如，得到我用来创建该站的所有文件：</p>
      <pre class="literallayout">
$ git clone git://git.or.cz/gitmagic.git
</pre>

      <p>我们很快会对 <span class="strong"><strong>clone</strong></span>
      命令谈的很多。</p>
    </div>

    <div class="section" title="到最新">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__17"></a>到最新</h2>
          </div>
        </div>
      </div>

      <p>如果你已经使用 <span class="strong"><strong>git
      clone</strong></span> 命令得到了一个项目的一份拷贝，你可以更新到最新版， 通过：</p>
      <pre class="literallayout">
$ git pull
</pre>
    </div>

    <div class="section" title="快速发布">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__18"></a>快速发布</h2>
          </div>
        </div>
      </div>

      <p>假设你写了一个脚本，想和他人分享。你可以只告诉他们从你的计算机下载，但如果此
      时你正在改进你的脚本，或加入试验性质的改动，他们下载了你的脚本，他们可能由此
      陷入困境。当然，这就是发布周期存在的原因。开发人员可能频繁进行项目修改，但他
      们只在他们觉得代码可以见人的时候才择时发布。</p>

      <p>用Git来完成这项，需要进入你的脚本所在目录：</p>
      <pre class="literallayout">
$ git init
$ git add .
$ git commit -m "First release"
</pre>

      <p>然后告诉你的用户去运行：</p>
      <pre class="literallayout">
$ git clone your.computer:/path/to/script
</pre>

      <p>来下载你的脚本。这要假定他们有ssh访问权限。如果没有，需要运行 <span class=
      "strong"><strong>git daemon</strong></span> 并 告诉你的用户去运行：</p>
      <pre class="literallayout">
$ git clone git://your.computer/path/to/script
</pre>

      <p>从现在开始，每次你的脚本准备好发布时，就运行：</p>
      <pre class="literallayout">
$ git commit -a -m "Next release"
</pre>

      <p>并且你的用户可以通过进入包含你脚本的目录，并键入下列命令，来更新他们的版本：</p>
      <pre class="literallayout">
$ git pull
</pre>

      <p>你的用户永远也不会取到你不想让他们看到的脚本版本。显然这个技巧对所有的东西都 是可以，不仅是对脚本。</p>
    </div>

    <div class="section" title="我们已经做了什么？">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__19"></a>我们已经做了什么？</h2>
          </div>
        </div>
      </div>

      <p>找出自从上次提交之后你已经做了什么改变：</p>
      <pre class="literallayout">
$ git diff
</pre>

      <p>或者自昨天的改变：</p>
      <pre class="literallayout">
$ git diff "@{yesterday}"
</pre>

      <p>或者一个特定版本与倒数第二个变更之间：</p>
      <pre class="literallayout">
$ git diff 1b6d "master~2"
</pre>

      <p>输出结果都是补丁格式，可以用 <span class="strong"><strong>git
      apply</strong></span> 来把补丁打上。也可以试一下：</p>
      <pre class="literallayout">
$ git whatchanged --since="2 weeks ago"
</pre>

      <p>我也经常用<a class="ulink" href=
      "http://sourceforge.net/projects/qgit" target="_top">qgit</a>
      浏览历史, 因为他的图形界 面很养眼，或者 <a class="ulink" href=
      "http://jonas.nitro.dk/tig/" target="_top">tig</a>
      ，一个文本界面的东西，很慢的网 络状况下也工作的很好。也可以安装web 服务器，运行 <span class=
      "strong"><strong>git instaweb</strong></span> ，就可以用任
      何浏览器浏览了。</p>
    </div>

    <div class="section" title="练习">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="__20"></a>练习</h2>
          </div>
        </div>
      </div>

      <p>比方A，B，C，D是四个连续的提交，其中B与A一样，除了一些文件删除了。我们想把这
      些删除的文件加回D。我们如何做到这个呢？</p>

      <p>至少有三个解决方案。假设我们在D：</p>

      <div class="orderedlist">
        <ol class="orderedlist" type="1">
          <li class="listitem">
            <p class="simpara">
            A与B的差别是那些删除的文件。我们可以创建一个补丁代表这些差别，然后吧补丁 打上：</p>
            <pre class="literallayout">
$ git diff B A | git apply
</pre>
          </li>

          <li class="listitem">
            <p class="simpara">既然这些文件存在A，我们可以把它们拿出来：</p>
            <pre class="literallayout">
$ git checkout A foo.c bar.h
</pre>
          </li>

          <li class="listitem">
            <p class="simpara">我们可以把从A到B的变化视为可撤销的变更：</p>
            <pre class="literallayout">
$ git revert B
</pre>
          </li>
        </ol>
      </div>

      <p>哪个选择最好？这取决于你的喜好。利用Git满足自己需求是容易，经常还有多个方法。</p>
    </div>
  </div><script type="text/javascript" src="find_selflink.js">
</script><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
  </script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1901330-2");
  pageTracker._initData();
  pageTracker._trackPageview();
  </script>
</div>
</div><div class="footer"><a href="/~blynn/">Ben Lynn</a></div>
</body>
</html>
