From zsh-workers-return-5736-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Mar 10 16:51:26 1999
Return-Path: <zsh-workers-return-5736-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6588 invoked from network); 10 Mar 1999 16:51:25 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 10 Mar 1999 16:51:25 -0000
Received: (qmail 2823 invoked by alias); 10 Mar 1999 16:50:53 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5736
Received: (qmail 2815 invoked from network); 10 Mar 1999 16:50:51 -0000
Date: Wed, 10 Mar 1999 17:50:44 +0100 (MET)
Message-Id: <199903101650.RAA17939@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Bart Schaefer's message of Wed, 10 Mar 1999 08:33:18 -0800 (PST)
Subject: Re: Repeatable crash in latest zsh


Bart Schaefer wrote:

> This has been happening for about a week, I think, so it isn't something
> from the most recent patches, but it still happens even with everything
> posted so far.  This input:
> 
> zsh% setopt completeinword
> zsh% ZSH=<C-b><TAB>
> 
> (that is, expand-or-complete before the '=') causes `zsh -f` to crash.

The code was to eager to restrict the things to `the string after the
equal sign', forgetting to test if it was after it.

Bye
 Sven

--- os/Zle/zle_tricky.c	Wed Mar 10 10:49:47 1999
+++ Src/Zle/zle_tricky.c	Wed Mar 10 17:49:18 1999
@@ -1278,7 +1278,7 @@
 	    *s = sav;
 	    if (skipparens(Inbrack, Outbrack, &s) > 0 || s > tt + cs - wb)
 		s = NULL, inwhat = IN_MATH, insubscr = 1;
-	    else if (*s == '=') {
+	    else if (*s == '=' && cs > wb + (s - tt)) {
 		s++;
 		wb += s - tt;
 		t0 = STRING;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

