From zsh-workers-return-7336-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Aug 02 06:53:02 1999
Return-Path: <zsh-workers-return-7336-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20235 invoked from network); 2 Aug 1999 06:52:57 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 2 Aug 1999 06:52:57 -0000
Received: (qmail 12066 invoked by alias); 2 Aug 1999 06:52:37 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7336
Received: (qmail 12059 invoked from network); 2 Aug 1999 06:52:36 -0000
Date: Sun, 1 Aug 1999 23:52:17 -0700
From: Irving_Wolfe@Happy-Man.com
To: Geoff Wing <mason@primenet.com.au>
Cc: zsh-workers@sunsite.auc.dk, i-a-o@Happy-Man.com
Subject: Re: Couldn't Build 3.1.6 on Nextstep 3.3 m68k System
Message-ID: <19990801235217.J13052@Happy-Man.com>
Reply-To: Irving_Wolfe@Happy-Man.com
References: <Pine.NXT.3.96.990801214243.13380A-100000@reddog> <slrn7qadb5.3pf.mason@coral.primenet.com.au>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 0.95.6i
In-Reply-To: <slrn7qadb5.3pf.mason@coral.primenet.com.au>; from Geoff Wing on Mon, Aug 02, 1999 at 06:06:29AM +0000

Thanks for the great help!

On Mon, Aug 02, 1999 at 06:06:29AM +0000, Geoff Wing wrote:
> 
> Try the following; with F_GETFL, all args are ignored anyway.
> 
> 
> --- Src/init.c.org	Wed Jun 30 02:33:52 1999
> +++ Src/init.c	Mon Aug  2 16:05:27 1999
> @@ -353,7 +353,7 @@
>  	 * Try both stdin and stdout before trying /dev/tty. -- Bart
>  	 */
>  #if defined(HAVE_FCNTL_H) && defined(F_GETFL)
> -#define rdwrtty(fd)	((fcntl(fd, F_GETFL) & O_RDWR) == O_RDWR)
> +#define rdwrtty(fd)	((fcntl(fd, F_GETFL, 0) & O_RDWR) == O_RDWR)
>  #else
>  #define rdwrtty(fd)	1
>  #endif

That worked for init.c, but I had to make
a similar change in utils.c:

--- /Maurice/irving/todelete/01utils.c  Sun Aug  1 23:27:41 1999
+++ Src/utils.c Sun Aug  1 23:28:36 1999
@@ -1249,7 +1249,7 @@
     long mode;

     if (!fstat(0, &st) && !S_ISREG(st.st_mode)) {
-       mode = fcntl(0, F_GETFL);
+       mode = fcntl(0, F_GETFL, 0);
        if (mode != -1 && (mode & NONBLOCK) &&
            !fcntl(0, F_SETFL, mode & ~NONBLOCK))
            return 1;

Then, zsh was built (and seems to run okay)
but my "make" still failed:

 cc  -s  -o zsh main.o `cat stamp-modobjs`   -ltermcap
makeinfo ./zsh.texi; exit 0
Making info file `zsh.info' from `./zsh.texi'.
./zsh.texi:19: Unknown info command `dircategory'.
./zsh.texi:20: Unknown info command `direntry'.
./zsh.texi:23: Bad argument to `end', `direntry', using `ifinfo'.
./zsh.texi:23: Unmatched `@end'.
*** Exit 2
*** `zsh.info' removed
Stop.
*** Exit 1

If there is anything after that info step,
I wonder if it should fail more gracefully,
since even FSF's efforts haven't gotten me
to read info files very often.

Regards,
 - Irving

