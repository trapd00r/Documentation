From zsh-users-return-14380-mason-zsh=primenet.com.au@sunsite.dk Tue Sep 15 09:01:10 2009
Return-Path: <zsh-users-return-14380-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16531 invoked from network); 15 Sep 2009 09:00:57 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 15 Sep 2009 09:00:57 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 81699 invoked from network); 15 Sep 2009 09:00:44 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 15 Sep 2009 09:00:44 -0000
Received: (qmail 24043 invoked by alias); 15 Sep 2009 09:00:25 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 14380
Received: (qmail 23993 invoked from network); 15 Sep 2009 09:00:24 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 15 Sep 2009 09:00:24 -0000
Received: from vms173013pub.verizon.net (vms173013pub.verizon.net [206.46.173.13])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 95B168026E39
	for <zsh-users@sunsite.dk>; Tue, 15 Sep 2009 11:00:17 +0200 (CEST)
Received: from torch.brasslantern.com ([96.238.222.107])
 by vms173013.mailsrvcs.net
 (Sun Java(tm) System Messaging Server 6.3-7.04 (built Sep 26 2008; 32bit))
 with ESMTPA id <0KQ000H0G909OXY6@vms173013.mailsrvcs.net> for
 zsh-users@sunsite.dk; Tue, 15 Sep 2009 04:00:12 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id n8F9082T001763	for
 <zsh-users@sunsite.dk>; Tue, 15 Sep 2009 02:00:08 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id n8F907uS001762	for zsh-users@sunsite.dk; Tue,
 15 Sep 2009 02:00:07 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <090915020007.ZM1761@torch.brasslantern.com>
Date: Tue, 15 Sep 2009 02:00:07 -0700
In-reply-to: <20090915125419.3528@binki>
Comments: In reply to "d.henman" <dhenman@gmail.com>
 "alternative method for a simple for" (Sep 15, 12:54pm)
References: <20090915125419.3528@binki>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: <zsh-users@sunsite.dk>
Subject: Re: alternative method for a simple for
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii
X-Virus-Scanned: ClamAV 0.94.2/9806/Mon Sep 14 20:37:58 2009 on bifrost
X-Virus-Status: Clean

On Sep 15, 12:54pm, d.henman wrote:
}
} (Method 1.) Note that I could not not use this method as shown below
}   $ zmv -p ffmpeg -o " -b 160k -i" '(*).wav' '$1.mp3'
} 
} because it puts two hypens, "--", between -i and filename, as below:
}      ffmpeg -b 160k -i -- song1.wav song1.mp3
}      ffmpeg -b 160k -i -- song2.wav song2.mp3

Yes, as the zmv doc says:

    -p PROGRAM
          Call PROGRAM instead of cp, ln or mv.  Whatever it does, it
          should at least understand the form
               PROGRAM -- OLDNAME NEWNAME
          where OLDNAME and NEWNAME are filenames generated by zmv.

So you need to satisfy those constraints.

    function wav2mp3 {
      [[ "$1" == "--" ]] && shift
      ffmpeg -b 160k -i ffmpeg -b 160k -i "$@"
    }

    zmv -p wav2mp3 '(*).wav' '$1.mp3'

} --------
} 
} (Method 2.) Likewise I could not use zargs, yet at least,
}      because replacements or expansions //l/r or :r didn't seem to work..
} 
} $ zargs --replace=arg -e.. -- *.wav .. ffmpeg -b 160k -i arg ${${file::=arg}//.wav/.mp3}

Close, but you need to delay the expansion of your ${...} expression
until zargs executes the command.  The way you wrote it, the parameter
substitution occurs before zargs is even run.  Quotes are needed:

    zargs --replace=arg -e.. -- *.wav .. eval \
      ffmpeg -b 160k -i '"arg"' '${${file::="arg"}//.wav/.mp3}'

However, it's pretty hard to get the quoting perfect with that eval
in there.

