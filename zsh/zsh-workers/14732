From zsh-workers-return-14732-mason-zsh=primenet.com.au@sunsite.dk Wed Jun 06 08:46:16 2001
Return-Path: <zsh-workers-return-14732-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4591 invoked from network); 6 Jun 2001 08:46:13 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 6 Jun 2001 08:46:13 -0000
Received: (qmail 4189 invoked by alias); 6 Jun 2001 08:45:53 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14732
Received: (qmail 4175 invoked from network); 6 Jun 2001 08:45:52 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer david.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: <zsh-workers@sunsite.dk>
Subject: Commited: RE: PATCH: Re: zsh and autoconf-2.50
Date: Wed, 6 Jun 2001 12:45:59 +0400
Message-ID: <001d01c0ee65$1bc2e940$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4522.1200
In-Reply-To: <1010603184301.ZM30412@candle.brasslantern.com>
Importance: Normal

>
> How about the following:
>
> Create a new file "zshconf.ac" (or "zshconf.in" or whatever, it really
> doesn't matter).  Most of the contents of the current configure go into
> this file -- everything up to the "missing some essential features" hack.
>
> Add a macro to aczsh.m4 to output the "zsh configuration" report at that
> appears at the end of the current configure.in.
>
> Create a new file configure.ac that contains:
>
>     m4_include([zshconf.ac])
>     test "$real_no_create" = yes ||
> 	${CONFIG_SHELL-/bin/sh} $CONFIG_STATUS || exit 1
>     zsh_SHOWCONFIG
>
> Change configure.in to be a file that contains only:
>
>     dnl Backwards compatibility with autoconf 2.13.
>
>     builtin([include], [zshconf.ac])
>
>     dnl The standard config.status is missing some essential features.
>     dnl (etc. etc.)
>
>     test "$real_no_create" = yes ||
> 	${CONFIG_SHELL-/bin/sh} $CONFIG_STATUS || exit 1
>     zsh_SHOWCONFIG
>

I commited it in HEAD. I do not post diffs as this would be just current
configure.in; still here are configu.in and conifgure.ac for review.

I had to use AC_INIT to allow overriding of no_create; I then decided to use
correct AC_INIT for 2.50 and found one more problem. It requires literal
version number; having two versions (in configure.in and Config/version.mk)
is obviously silly. I'm inclined to put version in configure.{in,ac} and
create version.mk out of version.mk.in. This means the least changes in
Makefiles.

Please add any copyrights you feel needed.

Note, that config.cache is incompatible between two versions. 2.50 by
default does not cache anything; you can persuade it but then better remove
old cache.

-andrej

bor@itsrm2% cat configure.in

AC_INIT(Src/zsh.h)

real_no_create=$no_create
no_create=yes

builtin([include], [zshconfig.ac])

dnl The standard config.status is missing some essential features.
dnl So add them now.  See the comment at the end of Src/mkmakemod.sh.
[rm -f $CONFIG_STATUS.old
cp $CONFIG_STATUS $CONFIG_STATUS.old
sed '1,$s@^\( *ac_file_inputs=\).*$@\1`echo $ac_file_in | sed -e "s%^%:%" -e
"s%:\\([^!]\\)% $ac_given_srcdir/\\1%g" -e "s%:!% %"`@' \
 $CONFIG_STATUS.old >$CONFIG_STATUS
 echo "# Hack for autoconf-2.13" >>$CONFIG_STATUS
 chmod +x $CONFIG_STATUS
 rm -f $CONFIG_STATUS.old]

test "$real_no_create" = yes || ${CONFIG_SHELL-/bin/sh} $CONFIG_STATUS ||
exit 1


bor@itsrm2% cat configure.ac

AC_INIT(zsh, 4.1.0-dev-0, [zsh-workers@sunsite.dk])
AC_PREREQ(2.50)
AC_CONFIG_SRCDIR(Src/zsh.h)

m4_include([zshconfig.ac])

