From zsh-workers-return-26692-mason-zsh=primenet.com.au@sunsite.dk Fri Mar 06 09:53:14 2009
Return-Path: <zsh-workers-return-26692-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6339 invoked from network); 6 Mar 2009 09:53:11 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 6 Mar 2009 09:53:11 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 58186 invoked from network); 6 Mar 2009 09:53:04 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 6 Mar 2009 09:53:04 -0000
Received: (qmail 4882 invoked by alias); 6 Mar 2009 09:52:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26692
Received: (qmail 4870 invoked from network); 6 Mar 2009 09:52:58 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 6 Mar 2009 09:52:58 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [208.87.233.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id BE13980307FC
	for <zsh-workers@sunsite.dk>; Fri,  6 Mar 2009 10:52:54 +0100 (CET)
Received: from rly23g.srv.mailcontrol.com (localhost.localdomain [127.0.0.1])
	by rly23g.srv.mailcontrol.com (MailControl) with ESMTP id n269qgRJ002206
	for <zsh-workers@sunsite.dk>; Fri, 6 Mar 2009 09:52:52 GMT
Received: from submission.mailcontrol.com (submission.mailcontrol.com [86.111.216.190])
	by rly23g.srv.mailcontrol.com (MailControl) id n269po3M028397
	for zsh-workers@sunsite.dk; Fri, 6 Mar 2009 09:51:50 GMT
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly23g-eth0.srv.mailcontrol.com (envelope-sender Peter.Stephenson@csr.com) (MIMEDefang) with ESMTP id n269peRi027327; Fri, 06 Mar 2009 09:51:49 +0000 (GMT)
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Fri, 6 Mar 2009 09:51:40 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.2/8.13.4) with ESMTP id n269peV3002063;
	Fri, 6 Mar 2009 09:51:40 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.2/8.14.2/Submit) with ESMTP id n269pdmT002060;
	Fri, 6 Mar 2009 09:51:40 GMT
Message-Id: <200903060951.n269pdmT002060@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: Bart Schaefer <schaefer@brasslantern.com>
cc: zsh-workers@sunsite.dk
Subject: Re: expansion of environment variables
In-reply-to: <090305205421.ZM5160@torch.brasslantern.com>
References: <d5baa8100903050235ofd66039jf2c29b58684bc8d8@mail.gmail.com> <090305081548.ZM4603@torch.brasslantern.com> <20090305165400.3fd18bc6@news01> <090305092126.ZM4727@torch.brasslantern.com> <200903051746.n25HkB77026580@news01.csr.com> <090305205421.ZM5160@torch.brasslantern.com>
Comments: In-reply-to Bart Schaefer <schaefer@brasslantern.com>
   message dated "Thu, 05 Mar 2009 20:54:19 -0800."
Date: Fri, 06 Mar 2009 09:51:39 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 06 Mar 2009 09:51:40.0339 (UTC) FILETIME=[25F11830:01C99E41]
X-Scanned-By: MailControl A_08_51_00 (www.mailcontrol.com) on 10.71.1.133
X-Virus-Scanned: ClamAV 0.92.1/9077/Fri Mar  6 03:48:57 2009 on bifrost
X-Virus-Status: Clean

Bart Schaefer wrote:
> [>workers]
> 
> On Mar 5,  5:46pm, Peter Stephenson wrote:
> }
> } You're right, I missed that last step, there is indeed stuff in tmp1
> } including the correct completion.
> 
> I've been staring at this and I've concluded (possibly wrongly) that
> even the stuff in tmp1 is a bit of a red herring.
> 
> Correct me, but isn't the real problem that the string on the line
> still looks like "$key." but all of the possible matches look like
> "2345.xml"?

Yep, I'd eventually come to that conclusion.  I think compfiles is
generating files without doing any matching at this stage (I think it
would do clever stuff with globbing if requested for limiting the
matches, but that's not the case here), so we get a complete list of
files that may or may not match the command line.  Then the compadd -D
is doing the matching, and that's where it all falls over for the reason
you say.  We'd need at the least to massage or hide the $PREFIX/$SUFFIX
seen by that second step, or equivalent sneaky trick.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

