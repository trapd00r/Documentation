From zsh-workers-return-21233-mason-zsh=primenet.com.au@sunsite.dk Fri May 06 21:29:50 2005
Return-Path: <zsh-workers-return-21233-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11424 invoked from network); 6 May 2005 21:29:49 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 6 May 2005 21:29:49 -0000
Received: (qmail 94994 invoked from network); 6 May 2005 21:29:41 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 6 May 2005 21:29:41 -0000
Received: (qmail 22798 invoked by alias); 6 May 2005 21:29:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21233
Received: (qmail 22787 invoked from network); 6 May 2005 21:29:38 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 6 May 2005 21:29:38 -0000
Received: (qmail 94736 invoked from network); 6 May 2005 21:29:38 -0000
Received: from mx4.netwood.net (209.247.184.2)
  by a.mx.sunsite.dk with SMTP; 6 May 2005 21:29:34 -0000
Received: from netwood.net (mail.netwood.net [209.247.184.35])
	by MX4.NetWood.net (Postfix) with ESMTP id 33D451DE818
	for <zsh-workers@sunsite.dk>; Fri,  6 May 2005 14:29:55 -0700 (PDT)
Received: from [66.81.16.27] [66.81.16.27] by netwood.net with ESMTP
  (SMTPD32-8.15) id A1BB15D0234; Fri, 06 May 2005 14:29:31 -0700
Mime-Version: 1.0 (Apple Message framework v619)
To: zsh-workers@sunsite.dk
Message-Id: <3A44AC58-BE76-11D9-9F87-000A957CB0EE@netwood.net>
Content-Type: multipart/mixed; boundary=Apple-Mail-2--331055693
From: Jesse W <jessw@netwood.net>
Subject: Adding dpkg-query support to _dpkg patch
Date: Fri, 6 May 2005 14:31:37 -0700
X-Mailer: Apple Mail (2.619)
X-Declude-Sender: jessw@netwood.net [66.81.16.27]
X-Note: This E-mail was scanned by Declude JunkMail (www.declude.com) for spam.
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=6.0 tests=AWL,BAYES_00,
	RCVD_IN_SORBS_WEB autolearn=ham version=3.0.2
X-Spam-Hits: -2.4


--Apple-Mail-2--331055693
Content-Transfer-Encoding: 7bit
Content-Type: text/plain;
	charset=US-ASCII;
	format=flowed

Here's a patch to add support to dpkg-query to _dpkg.  The one 
aditional change in it is commenting out the local defs of the two 
arrays that are already commented out.  As per clint's suggestion, it 
is attached.  Let me know if any changes are needed.

Jesse Weinstein

--Apple-Mail-2--331055693
Content-Transfer-Encoding: 7bit
Content-Type: application/octet-stream;
	x-unix-mode=0644;
	name="_dpkg.patch"
Content-Disposition: attachment;
	filename=_dpkg.patch

*** /Users/jesse/_dpkg.old	Fri May  6 13:52:18 2005
--- /Users/jesse/_dpkg2	Fri May  6 14:28:05 2005
***************
*** 1,13 ****
! #compdef dpkg dpkg-deb dpkg-reconfigure
  
  local _dpkg_deb_actions _dpkg_common_actions _dpkg_actions _dpkg_options
! local _dpkg_options_recursive _dpkg_actions_install _dpkg_actions_record_avail
  local _dpkg_deb_only_actions
  local curcontext="$curcontext" context state line expl ret
  typeset -A opt_args
  
  _dpkg_deb_only_actions=(
!   '(--show -W)'{--show,-W}'[show package info]:Debian package:_files -g \*.u\#deb'
  )
  
  _dpkg_deb_actions=(
--- 1,19 ----
! #compdef dpkg dpkg-deb dpkg-query dpkg-reconfigure
  
  local _dpkg_deb_actions _dpkg_common_actions _dpkg_actions _dpkg_options
! local _dpkg_options_recursive #_dpkg_actions_install _dpkg_actions_record_avail
  local _dpkg_deb_only_actions
+ local _dpkg_deb_and_query_only_actions _dpkg_deb_and_query_only_options 
+ local _dpkg_query_actions
  local curcontext="$curcontext" context state line expl ret
  typeset -A opt_args
  
  _dpkg_deb_only_actions=(
!     '-D[debugging output]'
!     '(--new)--old[old archive format]'
!     '(--old)--new[new archive format]'
!     '--nocheck[suppress control file check]'
!     '-z+[compression level]:compression number:(1 2 3 4 5 6 7 8 9)'
  )
  
  _dpkg_deb_actions=(
***************
*** 33,52 ****
    '--configure[reconfigure specified packages]:*:package:->configure'
    '(--remove -r)'{--remove,-r}'[remove package]:*:package:->remove'
    '(--purge -P)'{--purge,-P}'[purge package]:*:package:->purge'
-   '(--print-avail -p)'{--print-avail,-p}'[display available details]:packages:_deb_packages avail'
    '--update-avail[update available]:package file:_files'
    '--merge-avail[merge available]:package file:_files'
    '(--record-avail -A)'{--record-avail,-A}'[record available]:*:package files:->record_avail'
    '--forget-old-unavail[forget uninstalled unavailable]'
    '--clear-avail[clear available]'
-   '(--list -l)'{--list,-l}'[list packages]:*:packages:->list'
-   '(--status -s)'{--status,-s}'[display package status]:*:packages:->status'
    '(--audit -C)'{--audit,-C}'[check for broken pkgs]'
    '--get-selections[get selections]:pattern:'
    '--set-selections[set selections]'
    '--yet-to-unpack[list uninstalled]'
-   '(--listfiles, -L)'{--listfiles,-L}'[list owned files]:*:packages:->listfiles'
-   '(--search -S)'{--search,-S}'[search for file owner]:*:pattern:->search'
    '--print-architecture[print target architecture]'
    '--print-gnu-build-architecture'
    '--print-installation-architecture'
--- 39,53 ----
***************
*** 55,61 ****
  
  _dpkg_options=(
    '--abort-after[abort after errors]:number of errors:'
-   '--admindir=[data directory]:directory:_files -/'
    '--root=[alternative root]:root:_files -/'
    '--instdir=[change inst root but not data dir]:_files -/'
    '(--selected-only -O)'{--selected-only,-O}'[skip unselected packages]'
--- 56,61 ----
***************
*** 73,78 ****
--- 73,95 ----
  
  _dpkg_options_recursive=( '(--recursive -R)'{--recursive,-R}'[recursive]' )
  
+ _dpkg_deb_and_query_only_actions=(
+     '(--show -W)'{--show,-W}'[show package info]:Debian package:_files -g \*.u\#deb'
+ )
+ 
+ _dpkg_deb_and_query_only_options=(
+     '--showformat=-[alternative format]:format: '
+ )
+ 
+ _dpkg_query_actions=(
+       '(--status -s)'{--status,-s}'[display package status]:*:packages:->status'
+       '(--print-avail -p)'{--print-avail,-p}'[display available details]:packages:_deb_packages avail'
+       '(--listfiles, -L)'{--listfiles,-L}'[list owned files]:*:packages:->listfiles'
+       '(--list -l)'{--list,-l}'[list packages]:*:packages:->list'
+       '(--search -S)'{--search,-S}'[search for file owner]:*:pattern:->search'
+       '--admindir=[data directory]:directory:_files -/'
+ )
+ 
  # not needed anymore?
  #  _dpkg_actions_install=('(--install)-i[install]' '(-i)--install')
  #  _dpkg_actions_record_avail=('(--record-avail)-A[record available]' '(-A)--record-avail')
***************
*** 84,96 ****
        "$_dpkg_deb_actions[@]" \
        "$_dpkg_common_actions[@]" \
        "$_dpkg_options[@]" \
!       "$_dpkg_options_recursive[@]" && return 0
    ;;
  
    dpkg-deb)
      _arguments "$_dpkg_deb_actions[@]" \
! 	"$_dpkg_deb_only_actions[@]" \
! 	"$_dpkg_common_actions[@]" && return 0
    ;;
    dpkg-reconfigure)
      _arguments -sw \
--- 101,124 ----
        "$_dpkg_deb_actions[@]" \
        "$_dpkg_common_actions[@]" \
        "$_dpkg_options[@]" \
!       "$_dpkg_options_recursive[@]" \
!       "$_dpkg_query_actions[@]" && return 0
    ;;
  
    dpkg-deb)
      _arguments "$_dpkg_deb_actions[@]" \
!         "$_dpkg_deb_only_actions[@]" \
!         "$_dpkg_common_actions[@]" \
!         "$_dpkg_deb_and_query_only_actions[@]" \
!         "$_dpkg_deb_and_query_only_options[@]" && return 0
! 
!   ;;
! 
!   dpkg-query)
!     _arguments "$_dpkg_query_actions[@]" \
!            "$_dpkg_common_actions[@]" \
!            "$_dpkg_deb_and_query_only_actions[@]" \
!            "$_dpkg_deb_and_query_only_options[@]" && return 0
    ;;
    dpkg-reconfigure)
      _arguments -sw \

--Apple-Mail-2--331055693--

