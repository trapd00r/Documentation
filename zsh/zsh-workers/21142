From zsh-workers-return-21142-mason-zsh=primenet.com.au@sunsite.dk Thu Apr 14 18:06:08 2005
Return-Path: <zsh-workers-return-21142-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14405 invoked from network); 14 Apr 2005 18:06:08 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 14 Apr 2005 18:06:08 -0000
Received: (qmail 54078 invoked from network); 14 Apr 2005 18:06:02 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 14 Apr 2005 18:06:02 -0000
Received: (qmail 25904 invoked by alias); 14 Apr 2005 18:05:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21142
Received: (qmail 25892 invoked from network); 14 Apr 2005 18:05:59 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 14 Apr 2005 18:05:59 -0000
Received: (qmail 53777 invoked from network); 14 Apr 2005 18:05:59 -0000
Received: from smtp-out3.blueyonder.co.uk (195.188.213.6)
  by a.mx.sunsite.dk with SMTP; 14 Apr 2005 18:05:55 -0000
Received: from sc ([80.192.8.102]) by smtp-out3.blueyonder.co.uk with Microsoft SMTPSVC(5.0.2195.6713);
	 Thu, 14 Apr 2005 19:06:32 +0100
Received: from chazelas by sc with local (Exim 3.36 #1 (Debian))
	id 1DM8nE-0001Pw-00
	for <zsh-workers@sunsite.dk>; Thu, 14 Apr 2005 19:10:20 +0100
Date: Thu, 14 Apr 2005 19:10:20 +0100
From: Stephane Chazelas <Stephane_Chazelas@yahoo.fr>
To: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: PATCH: allocating a new file descriptor
Message-ID: <20050414181020.GA5064@sc>
Mail-Followup-To: Zsh hackers list <zsh-workers@sunsite.dk>
References: <200504121257.j3CCvkXr003286@news01.csr.com> <1050414045748.ZM13551@candle.brasslantern.com> <200504140949.j3E9n5Kp006216@news01.csr.com> <1050414142337.ZM14042@candle.brasslantern.com> <200504141616.j3EGGR7O023489@news01.csr.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-15
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <200504141616.j3EGGR7O023489@news01.csr.com>
User-Agent: Mutt/1.5.6i
Sender: Stephane Chazelas <stephane_chazelas@yahoo.fr>
X-OriginalArrivalTime: 14 Apr 2005 18:06:32.0671 (UTC) FILETIME=[B08AE6F0:01C5411C]
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

I understand that

exec {fd}> file

is the shell equivalent of

fd = open(file, O_WRONLY|O_CREAT);

given that we already have ztcp, zsocket... that allocate fds,
and sysread, syswrite..., I would find it more consistent to
have:

sysopen -w file
fd=$REPLY

(with -x (O_EXCL), -r (read), -w (write), -a (append), -n (don't
create), -d <fd> and possibly extensions for O_SYNC, O_NOATIME...)

I find the:

print ... {fd}> file

that keeps the file open a bit confusing and unconsistent (and
useless).

It would be good to have a sysclose as well. At least until
recently, exec 12>&- didn't work. I had the problem with my
mouse support, where I couldn't close the fd opened by zsocket
for gpm interaction.

I also noticed several problems when fidling with fds used
internally by zsh (zsocket -d10 or -d11 ended up in a core
dump).

sysdup2 may come handy as well if exec 12>&13, or exec $a>&$b
don't work.

regards,
Stéphane

