From zsh-workers-return-13967-mason-zsh=primenet.com.au@sunsite.dk Thu Apr 12 22:30:08 2001
Return-Path: <zsh-workers-return-13967-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7640 invoked from network); 12 Apr 2001 22:30:07 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 12 Apr 2001 22:30:07 -0000
Received: (qmail 8480 invoked by alias); 12 Apr 2001 22:30:05 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13967
Received: (qmail 8451 invoked from network); 12 Apr 2001 22:30:03 -0000
Date: Thu, 12 Apr 2001 15:29:55 -0700 (PDT)
From: Wayne Davison <wayned@users.sourceforge.net>
To: Bart Schaefer <schaefer@candle.brasslantern.com>
Cc: <zsh-workers@sunsite.dk>
Subject: Re: PATCH: Re: Build Failures on SunOS-4.1 and 5.5
In-Reply-To: <1010412162037.ZM32221@candle.brasslantern.com>
Message-ID: <Pine.LNX.4.30.0104121518110.32060-200000@phong.blorf.net>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-1463796991-1440021784-987114595=:32060"

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---1463796991-1440021784-987114595=:32060
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 12 Apr 2001, Bart Schaefer wrote:
> Ignoring my patch in 13962, which was the right fix for my local variant
> of Vin's symptoms but not for the actual bug report, here's the complete
> change:

Even with these changes, I can no longer build zsh under Solaris 2.6
(x86).  The biggest problem is that you can't include term.h without
first including curses.h (since term.h needs the SGTTY macro defined).
So, I moved the include of curses.h into Sys/system.h, and had to put
it before the inclusion of termios.h (or else the sgtty structure
would not get completely defined).  THEN, term.h defines several
lower-case macros that interfere with variable names in zsh, so I had
to undef "tab", "lines", and "columns".  And if that weren't enough, I
had to change the name of the "move" function pointer in files.c
because curses.h defined a move() macro (though I suppose I could have
undef'ed that too). Finally, just to get rid of a superfluous warning,
I decided to make the supplemental function gethostbyname2() not be
defined "static" since Solaris actually defines the prototype for this
function but then doesn't seem to include it in a library anywhere.

I haven't checked this in yet.  Comments?

..wayne..

---1463796991-1440021784-987114595=:32060
Content-Type: TEXT/PLAIN; charset=US-ASCII; name="term.patch"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.30.0104121529550.32060@phong.blorf.net>
Content-Description: Fixes for Solaris 2.6
Content-Disposition: attachment; filename="term.patch"

SW5kZXg6IFNyYy9zeXN0ZW0uaA0KQEAgLTI4Niw2ICsyODYsOSBAQA0KICMg
aW5jbHVkZSA8c3lzL2ZpbGlvLmg+DQogI2VuZGlmDQogDQorI2lmZGVmIEhB
VkVfQ1VSU0VTX0gNCisjIGluY2x1ZGUgPGN1cnNlcy5oPg0KKyNlbmRpZg0K
ICNpZmRlZiBIQVZFX1RFUk1JT1NfSA0KICMgaWZkZWYgX19zY28NCiAgICAv
KiB0ZXJtaW9zLmggaW5jbHVkZXMgc3lzL3Rlcm1pby5oIGluc3RlYWQgb2Yg
c3lzL3Rlcm1pb3MuaDsgKg0KQEAgLTMxNSw2ICszMTgsMTUgQEANCiAjZWxz
ZQ0KICMgaWZkZWYgSEFWRV9URVJNX0gNCiAjICBpbmNsdWRlIDx0ZXJtLmg+
DQorIyBlbmRpZg0KKyMgaWZkZWYgdGFiDQorIyAgdW5kZWYgdGFiDQorIyBl
bmRpZg0KKyMgaWZkZWYgY29sdW1ucw0KKyMgIHVuZGVmIGNvbHVtbnMNCisj
IGVuZGlmDQorIyBpZmRlZiBsaW5lcw0KKyMgIHVuZGVmIGxpbmVzDQogIyBl
bmRpZg0KICNlbmRpZg0KIA0KSW5kZXg6IFNyYy9Nb2R1bGVzL2ZpbGVzLmMN
CkBAIC0xODUsNyArMTg1LDcgQEANCiBzdGF0aWMgaW50DQogYmluX2xuKGNo
YXIgKm5hbSwgY2hhciAqKmFyZ3MsIGNoYXIgKm9wcywgaW50IGZ1bmMpDQog
ew0KLSAgICBNb3ZlRnVuYyBtb3ZlOw0KKyAgICBNb3ZlRnVuYyBtb3ZlZnVu
YzsNCiAgICAgaW50IGZsYWdzLCBlcnIgPSAwOw0KICAgICBjaGFyICoqYSwg
KnB0ciwgKnJwLCAqYnVmOw0KICAgICBzdHJ1Y3Qgc3RhdCBzdDsNCkBAIC0x
OTMsMTggKzE5MywxOCBAQA0KIA0KIA0KICAgICBpZihmdW5jID09IEJJTl9N
Vikgew0KLQltb3ZlID0gKE1vdmVGdW5jKSByZW5hbWU7DQorCW1vdmVmdW5j
ID0gKE1vdmVGdW5jKSByZW5hbWU7DQogCWZsYWdzID0gb3BzWydmJ10gPyAw
IDogTVZfQVNLTlc7DQogCWZsYWdzIHw9IE1WX0FUT01JQzsNCiAgICAgfSBl
bHNlIHsNCiAJZmxhZ3MgPSBvcHNbJ2YnXSA/IE1WX0ZPUkNFIDogMDsNCiAj
aWZkZWYgSEFWRV9MU1RBVA0KIAlpZihvcHNbJ3MnXSkNCi0JICAgIG1vdmUg
PSAoTW92ZUZ1bmMpIHN5bWxpbms7DQorCSAgICBtb3ZlZnVuYyA9IChNb3Zl
RnVuYykgc3ltbGluazsNCiAJZWxzZQ0KICNlbmRpZg0KIAl7DQotCSAgICBt
b3ZlID0gKE1vdmVGdW5jKSBsaW5rOw0KKwkgICAgbW92ZWZ1bmMgPSAoTW92
ZUZ1bmMpIGxpbms7DQogCSAgICBpZighb3BzWydkJ10pDQogCQlmbGFncyB8
PSBNVl9OT0RJUlM7DQogCX0NCkBAIC0yMjgsNyArMjI4LDcgQEANCiAJZWxz
ZQ0KIAkgICAgYXJnc1sxXSA9IGFyZ3NbMF07DQogICAgIH0NCi0gICAgcmV0
dXJuIGRvbW92ZShuYW0sIG1vdmUsIGFyZ3NbMF0sIGFyZ3NbMV0sIGZsYWdz
KTsNCisgICAgcmV0dXJuIGRvbW92ZShuYW0sIG1vdmVmdW5jLCBhcmdzWzBd
LCBhcmdzWzFdLCBmbGFncyk7DQogIGhhdmVkaXI6DQogICAgIGJ1ZiA9IHp0
cmR1cCgqYSk7DQogICAgICphID0gTlVMTDsNCkBAIC0yNDQsNyArMjQ0LDcg
QEANCiANCiAJYnVmW2JsZW5dID0gMDsNCiAJYnVmID0gYXBwc3RyKGJ1Ziwg
cHRyKTsNCi0JZXJyIHw9IGRvbW92ZShuYW0sIG1vdmUsICphcmdzLCBidWYs
IGZsYWdzKTsNCisJZXJyIHw9IGRvbW92ZShuYW0sIG1vdmVmdW5jLCAqYXJn
cywgYnVmLCBmbGFncyk7DQogICAgIH0NCiAgICAgenNmcmVlKGJ1Zik7DQog
ICAgIHJldHVybiBlcnI7DQpAQCAtMjUyLDcgKzI1Miw3IEBADQogDQogLyoq
Lw0KIHN0YXRpYyBpbnQNCi1kb21vdmUoY2hhciAqbmFtLCBNb3ZlRnVuYyBt
b3ZlLCBjaGFyICpwLCBjaGFyICpxLCBpbnQgZmxhZ3MpDQorZG9tb3ZlKGNo
YXIgKm5hbSwgTW92ZUZ1bmMgbW92ZWZ1bmMsIGNoYXIgKnAsIGNoYXIgKnEs
IGludCBmbGFncykNCiB7DQogICAgIHN0cnVjdCBzdGF0IHN0Ow0KICAgICBj
aGFyICpwYnVmLCAqcWJ1ZjsNCkBAIC0zMDIsNyArMzAyLDcgQEANCiAJaWYo
ZG9pdCAmJiAhKGZsYWdzICYgTVZfQVRPTUlDKSkNCiAJICAgIHVubGluayhx
YnVmKTsNCiAgICAgfQ0KLSAgICBpZihtb3ZlKHBidWYsIHFidWYpKSB7DQor
ICAgIGlmKG1vdmVmdW5jKHBidWYsIHFidWYpKSB7DQogCXp3YXJubmFtKG5h
bSwgIiVzOiAlZSIsIHAsIGVycm5vKTsNCiAJenNmcmVlKHBidWYpOw0KIAly
ZXR1cm4gMTsNCkluZGV4OiBTcmMvTW9kdWxlcy90ZXJtaW5mby5jDQpAQCAt
MzQsOSArMzQsNiBAQA0KIA0KIC8qKi8NCiAjaWZkZWYgSEFWRV9USUdFVFNU
Ug0KLSMgaWZkZWYgSEFWRV9DVVJTRVNfSA0KLSMgIGluY2x1ZGUgPGN1cnNl
cy5oPg0KLSMgZW5kaWYNCiANCiBzdGF0aWMgUGFyYW0gdGVybWluZm9fcG07
DQogDQpJbmRleDogU3JjL01vZHVsZXMvemZ0cC5jDQpAQCAtMjIwLDcgKzIy
MCw3IEBADQogIyBpZm5kZWYgSEFWRV9HRVRIT1NUQllOQU1FMg0KIA0KIC8q
Ki8NCi1zdGF0aWMgc3RydWN0IGhvc3RlbnQgKg0KK3N0cnVjdCBob3N0ZW50
ICoNCiBnZXRob3N0YnluYW1lMihjaGFyIGNvbnN0ICpuYW1lLCBpbnQgYWYp
DQogew0KIAlpZihhZiAhPSBBRl9JTkVUKSB7DQo=
---1463796991-1440021784-987114595=:32060--

