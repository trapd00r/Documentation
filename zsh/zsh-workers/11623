From zsh-workers-return-11623-mason-zsh=primenet.com.au@sunsite.auc.dk Mon May 29 07:42:22 2000
Return-Path: <zsh-workers-return-11623-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 900 invoked from network); 29 May 2000 07:42:21 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 29 May 2000 07:42:21 -0000
Received: (qmail 3646 invoked by alias); 29 May 2000 07:42:10 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11623
Received: (qmail 3639 invoked from network); 29 May 2000 07:42:09 -0000
Date: Mon, 29 May 2000 09:42:00 +0200
From: jarausch@igpm.rwth-aachen.de
Subject: Re: zftp.c doesn't compile on IRIX6.5
In-reply-to: <E12wA0m-000319-00.2000-05-28-21-50-16@cmailg2.svr.pol.co.uk>
To: pws@pwstephenson.fsnet.co.uk
Cc: zsh-workers@sunsite.auc.dk, schaefer@candle.brasslantern.com
Reply-to: jarausch@igpm.rwth-aachen.de
Message-id: <200005290742.JAA88415@numa1.igpm.rwth-aachen.de>
MIME-version: 1.0
Content-type: TEXT/plain; charset=us-ascii

On 28 May, Peter Stephenson wrote:
> jarausch@igpm.rwth-aachen.de wrote:
>> The cvs version from today doesn't compile on IRIX 6.5
>> 
>> It seems there is a bug on IRIX.
>> It uses a type 'n_long' within <netinet/ip.h>
>> but fails to include <netinet/in_systm.h>
>> where this is defined.
>> 
>> I had to apply the following (ugly) workaround
>> 
>> *** zftp.c.orig Sun May 28 17:34:38 2000
>> --- zftp.c      Sun May 28 17:34:39 2000
>> ***************
>> *** 64,69 ****
>> --- 64,72 ----
>>   #ifdef HAVE_NETINET_IN_SYSTM_H
>>   # include <netinet/in_systm.h>
>>   #endif
>> + #ifdef __sgi
>> +   #include <netinet/in_systm.h>
>> + #endif
>>   #include <netinet/in.h>
>>   #include <netinet/ip.h>
>>   #include <arpa/inet.h>
> 
> There's something extremely screwy here.  If <netinet/in_systm.h> exists,
> why does configure not detect it?  I looked, and whether for the same
> reason or not the test fails on linux, where gcc is outputting a warning
> message:
> 
> In file included from /usr/include/sys/cdefs.h:24,
>                  from /usr/include/netinet/in_systm.h:23,
>                  from configure:2634:
> /usr/include/features.h:254: warning: `__USE_LARGEFILE' redefined
> /usr/include/features.h:198: warning: this is the location of the previous defin
> ition
> 
> which is enough to make the test fail.
> 
> This is hard to fix, since it's not our problem.  For now we can just not
> include the file where we know it's missing, and cygwin is the only case I
> know, since no-one else every complained.
> 
> It would be splendid if this could be tested as soon as possible.
> 
> Index: Src/Modules/zftp.c
> ===================================================================
> RCS file: /cvsroot/zsh/zsh/Src/Modules/zftp.c,v
> retrieving revision 1.5
> diff -u -r1.5 zftp.c
> --- Src/Modules/zftp.c	2000/05/26 09:47:28	1.5
> +++ Src/Modules/zftp.c	2000/05/28 20:48:01
> @@ -61,7 +61,16 @@
>  #include <sys/types.h>
>  #include <sys/socket.h>
>  #include <netdb.h>
> -#ifdef HAVE_NETINET_IN_SYSTM_H
> +/*
> + * For some reason, configure doesn't always detect netinet/in_systm.h.
> + * On some systems, including linux, this seems to be because gcc is
> + * throwing up a warning message about the redefinition of
> + * __USE_LARGEFILE.  This means the problem is somewhere in the
> + * header files where we can't get at it.  For now, revert to
> + * not including this file only on systems where we know it's missing.
> + * Currently this is just cygwin.
> + */
> +#ifndef __CYGWIN__
>  # include <netinet/in_systm.h>
>  #endif
>  #include <netinet/in.h>
> 

This works fine on IRIX with GCC.

-- 
Helmut Jarausch
Lehrstuhl fuer Numerische Mathematik
Institute of Technology, RWTH Aachen
D 52056 Aachen, Germany

