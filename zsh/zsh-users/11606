From zsh-users-return-11606-mason-zsh=primenet.com.au@sunsite.dk Tue Jul 10 21:16:32 2007
Return-Path: <zsh-users-return-11606-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25517 invoked from network); 10 Jul 2007 21:16:30 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.1 (2007-05-02) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 10 Jul 2007 21:16:30 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 65817 invoked from network); 10 Jul 2007 21:16:24 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 Jul 2007 21:16:24 -0000
Received: (qmail 3656 invoked by alias); 10 Jul 2007 21:16:15 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11606
Received: (qmail 3646 invoked from network); 10 Jul 2007 21:16:15 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 10 Jul 2007 21:16:15 -0000
Received: (qmail 64620 invoked from network); 10 Jul 2007 21:16:15 -0000
Received: from mtaout02-winn.ispmail.ntl.com (81.103.221.48)
  by a.mx.sunsite.dk with SMTP; 10 Jul 2007 21:16:11 -0000
Received: from aamtaout04-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout02-winn.ispmail.ntl.com with ESMTP
          id <20070710211610.TCMX4.mtaout02-winn.ispmail.ntl.com@aamtaout04-winn.ispmail.ntl.com>
          for <zsh-users@sunsite.dk>; Tue, 10 Jul 2007 22:16:10 +0100
Received: from pws-pc.ntlworld.com ([81.107.45.67])
          by aamtaout04-winn.ispmail.ntl.com with ESMTP
          id <20070710211610.SMTG29112.aamtaout04-winn.ispmail.ntl.com@pws-pc.ntlworld.com>
          for <zsh-users@sunsite.dk>; Tue, 10 Jul 2007 22:16:10 +0100
Received: from pws-pc.ntlworld.com (pws-pc.ntlworld.com [127.0.0.1])
	by pws-pc.ntlworld.com (8.14.1/8.13.8) with ESMTP id l6ALEiUi004476
	for <zsh-users@sunsite.dk>; Tue, 10 Jul 2007 22:14:45 +0100
Message-Id: <200707102114.l6ALEiUi004476@pws-pc.ntlworld.com>
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-users@sunsite.dk
Subject: Re: Help on filename generation
In-Reply-To: Message from jadamson@partners.org (Joel J. Adamson)
   of "Tue, 10 Jul 2007 15:13:22 EDT." <87bqekgjhp.fsf@W0053328.mgh.harvard.edu>
Date: Tue, 10 Jul 2007 22:14:44 +0100

Joel J. Adamson wrote:
> Oh, since you seem eager to help, that's not the function -- this is
> the function:
> ----------------------------------------
> function doit() {

Remove the "function".

>    for file in $1/*(generic)*

As discussed previously.

>        # no backup files $1/data/*(generic)*~*(~)
>        do
>        filename=${file##$1}
>        newfilename=${filename/\/generic/$title}
>        cp $file ./$newfilename
>        ci -u -zLT $newfilename	

You need

        ci -m'updated' -u -zLT $newfilename

(or some more informative message) to stop being prompted
for a message.  "man ci" should explain it (though it certainly
helps to know what you're looking for first).

>        chgrp biostat ./$newfilename	# how do I make this the default behavi
> or?

The command "newgrp <group>" starts up a shell with a different default
group, so that becomes the default for files you create; that's
interactive, I don't know of any easy way non-interactively.
(I've noticed that to be able to use newgrp on recent Linux systems
you need to be a member of the group in /etc/gshadow, not just
/etc/group).

> In general, how do I
> answer an interactive prompt within a shell function (i.e.,
> non-interactively)?

The general answer's fairly tricky.  It depends a great deal on how the
programme is written.  If it's simple, it's just a question of
redirecting input into it with "<".  If it's not, however---if it's
something like "telnet" that really expects interactive input---and you
can't avoid using that programme, then you're stuck with nasty tricks
with pseudoterminals.  Zsh provides a module zsh/zpty, documented in
zshmodules, that helps with this, but it tends to take some playing
around to get a programme to respond helpfully.

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

