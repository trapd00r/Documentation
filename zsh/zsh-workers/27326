From zsh-workers-return-27326-mason-zsh=primenet.com.au@zsh.org Sat Oct 31 23:36:28 2009
Return-Path: <zsh-workers-return-27326-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20826 invoked by alias); 31 Oct 2009 23:36:28 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 27326
Received: (qmail 24502 invoked from network); 31 Oct 2009 23:36:15 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received-SPF: pass (ns1.primenet.com.au: SPF record at ntlworld.com designates 81.103.221.31 as permitted sender)
Message-Id: <200910312300.n9VN0787007148@pws-pc.ntlworld.com>
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-workers@zsh.org
Subject: Re: zsh eats 100% CPU with completion in /
In-Reply-To: Message from Mikael Magnusson <mikachu@gmail.com>
   of "Sat, 31 Oct 2009 23:43:33 +0100." <237967ef0910311543y648f6511q3bc5ad097175a80b@mail.gmail.com>
Date: Sat, 31 Oct 2009 23:00:07 +0000
X-Cloudmark-Analysis: v=1.0 c=1 a=KKLPYScoP6YA:10 a=NLZqzBF-AAAA:8 a=UMsHhRFaZcAVnrFcqz4A:9 a=2SwgC-TMQvyiCy6no25UplstUl8A:4 a=_dQi-Dcv4p4A:10

Mikael Magnusson wrote:
>         zlemetacs_qsub = 2
>         s = 0x82d7248 ""
>         tt = 0x82d7248 ""

It looks like it's already gone wrong by that point; s is an empty
string while it thinks the cursor is 2 characters in (which appears to
be correct from the original completion; zlemetaline should show "./x",
which I think it must since that's what's in tmp at this point).

So somehow the command line string has been emptied incorrectly.  I can
fix the symptom at this point but it doesn't look like the real bug.  It
would be good to find out where s is being set in get_comp_string().  In
this simple case it should have come from line 1356 (the token type
should be STRING), in which case maybe the clwords array contains
something funny or clwpos is incorrect (it should be 0 from line 1306 or
1262, I'm not quite sure what the difference is).

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

