From zsh-workers-return-19618-mason-zsh=primenet.com.au@sunsite.dk Fri Mar 12 19:01:26 2004
Return-Path: <zsh-workers-return-19618-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22966 invoked from network); 12 Mar 2004 19:01:24 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 12 Mar 2004 19:01:24 -0000
Received: (qmail 25541 invoked by alias); 12 Mar 2004 19:01:16 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19618
Received: (qmail 25526 invoked from network); 12 Mar 2004 19:01:16 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 12 Mar 2004 19:01:16 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [193.109.254.211] by sunsite.dk (MessageWall 1.0.8) with SMTP; 12 Mar 2004 19:1:15 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-18.tower-36.messagelabs.com!1079118074!4535161
X-StarScan-Version: 5.2.5; banners=-,-,-
X-Originating-IP: [158.234.9.163]
Received: (qmail 31087 invoked from network); 12 Mar 2004 19:01:14 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-18.tower-36.messagelabs.com with SMTP; 12 Mar 2004 19:01:14 -0000
Received: from trentino.logica.co.uk ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id i2CJ1DCk012270
	for <zsh-workers@sunsite.dk>; Fri, 12 Mar 2004 19:01:14 GMT
Received: from trentino.logica.co.uk (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP id 9F23979721C1
	for <zsh-workers@sunsite.dk>; Fri, 12 Mar 2004 20:00:29 +0100 (CET)
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <28707.1079110560@csr.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <28707.1079110560@csr.com>
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: Re: PATCH: omit completion tests if no zpty 
Date: Fri, 12 Mar 2004 20:00:29 +0100
Message-ID: <2673.1079118029@trentino.logica.co.uk>

Peter wrote:
> 
> Presumably the problem is in get_pty(), which isn't all that long.
> Probably strace or truss ought to say where the difficulty is.

I'm not sure it is get_pty(). All is seemingly okay when creating a zpty
command but trying to read from it (-r, -t, -L etc) just hangs till I
press Ctrl-C.

> Or we can try explicitly #undef USE_DEV_PTMX and see if that works.

That results in exactly the same happening so isn't much help.

Could we perhaps try taking code from here:
http://cvs.sourceforge.net/viewcvs.py/expect/expect/pty_termios.c?rev=5.37

At the top, it says the file is in the public domain so we can use it.
It seems to indicate that we need to trap some ioctls. Also looks like
it uses /dev/ptym.

Is it worth trying to do something before 4.2?

Oliver

