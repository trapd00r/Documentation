From zsh-workers-return-27768-mason-zsh=primenet.com.au@zsh.org Wed Mar 03 21:39:41 2010
Return-Path: <zsh-workers-return-27768-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8366 invoked by alias); 3 Mar 2010 21:39:41 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 27768
Received: (qmail 19702 invoked from network); 3 Mar 2010 21:39:39 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00,SPF_HELO_PASS
	autolearn=ham version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at bewatermyfriend.org does not designate permitted sender hosts)
From: Frank Terbeck <ft@bewatermyfriend.org>
To: zsh-workers@zsh.org
Cc: Mikael Magnusson <mikachu@gmail.com>,
	Bart Trojanowski <bart@jukie.net>
Subject: PATCH: vcs_info: Make use of cd's -q option
Date: Wed,  3 Mar 2010 22:30:46 +0100
Message-Id: <1267651846-17995-1-git-send-email-ft@bewatermyfriend.org>
X-Mailer: git-send-email 1.7.0
X-Df-Sender: 430444

---
 Functions/VCS_Info/VCS_INFO_realpath |   15 +++------------
 1 files changed, 3 insertions(+), 12 deletions(-)

diff --git a/Functions/VCS_Info/VCS_INFO_realpath b/Functions/VCS_Info/VCS_INFO_realpath
index c0f48a4..ce4a694 100644
--- a/Functions/VCS_Info/VCS_INFO_realpath
+++ b/Functions/VCS_Info/VCS_INFO_realpath
@@ -2,15 +2,6 @@
 ## Written by Frank Terbeck <ft@bewatermyfriend.org>
 ## Distributed under the same BSD-ish license as zsh itself.
 
-# a portable 'readlink -f'
-# forcing a subshell, to ensure chpwd() is not removed
-# from the calling shell (if VCS_INFO_realpath() is called
-# manually).
-
-setopt localoptions NO_shwordsplit
-
-(
-    (( ${+functions[chpwd]} )) && unfunction chpwd
-    setopt chaselinks
-    builtin cd $1 2>/dev/null && pwd
-)
+setopt localoptions NO_shwordsplit chaselinks
+# -q to avoid chpwd() invocations
+( builtin cd -q $1 2>/dev/null && pwd; )
-- 
1.7.0

