From zsh-users-return-13941-mason-zsh=primenet.com.au@sunsite.dk Thu Mar 19 23:49:27 2009
Return-Path: <zsh-users-return-13941-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17765 invoked from network); 19 Mar 2009 23:49:23 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 19 Mar 2009 23:49:23 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 7774 invoked from network); 19 Mar 2009 23:49:13 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 19 Mar 2009 23:49:13 -0000
Received: (qmail 26805 invoked by alias); 19 Mar 2009 23:48:58 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13941
Received: (qmail 26795 invoked from network); 19 Mar 2009 23:48:57 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 19 Mar 2009 23:48:57 -0000
Received: from mtaout03-winn.ispmail.ntl.com (mtaout03-winn.ispmail.ntl.com [81.103.221.49])
	by bifrost.dotsrc.org (Postfix) with ESMTP id A7BB082CF026
	for <zsh-users@sunsite.dk>; Fri, 20 Mar 2009 00:48:53 +0100 (CET)
Received: from aamtaout03-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout03-winn.ispmail.ntl.com
          (InterMail vM.7.08.04.00 201-2186-134-20080326) with ESMTP
          id <20090319234851.SLPE7670.mtaout03-winn.ispmail.ntl.com@aamtaout03-winn.ispmail.ntl.com>;
          Thu, 19 Mar 2009 23:48:51 +0000
Received: from pws-pc ([81.107.42.185]) by aamtaout03-winn.ispmail.ntl.com
          (InterMail vG.2.02.00.01 201-2161-120-102-20060912) with ESMTP
          id <20090319234850.KVJE2093.aamtaout03-winn.ispmail.ntl.com@pws-pc>;
          Thu, 19 Mar 2009 23:48:50 +0000
Date: Thu, 19 Mar 2009 23:48:48 +0000
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: ugaciaka <ugaciaka@gmail.com>
Cc: zsh-users@sunsite.dk
Subject: Re: help for a function and its completion
Message-ID: <20090319234848.4eca9a7d@pws-pc>
In-Reply-To: <e7db6e960903191458g1986e80ag7452db9e59d07469@mail.gmail.com>
References: <e7db6e960903191458g1986e80ag7452db9e59d07469@mail.gmail.com>
X-Mailer: Claws Mail 3.7.0 (GTK+ 2.14.7; x86_64-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Cloudmark-Analysis: v=1.0 c=1 a=Iyumap0jrNUA:10 a=pGLkceISAAAA:8 a=NLZqzBF-AAAA:8 a=VgyfpQ7YRHsxkGq_XfcA:9 a=IGtgGgFeuC4F0vUJK14t0b9Ecu0A:4 a=LY0hPdMaydYA:10 a=MSl-tDqOz04A:10 a=_dQi-Dcv4p4A:10
X-Virus-Scanned: ClamAV 0.92.1/9142/Thu Mar 19 21:19:47 2009 on bifrost
X-Virus-Status: Clean

On Thu, 19 Mar 2009 22:58:39 +0100
ugaciaka <ugaciaka@gmail.com> wrote:
> ##################
> #extract files eg: ex tarball.tar#
> ##################
> ex () {
>...
> }
> 
> ##################
> #compress directory eg: cm tarball.tar tarball#
> ##################
> cm () {
> ...
> }

(I don't think your "compress" and "gzip" items will work quite the way
you've written them.  Also, "ex" is the name of an editor, although you
probably wouldn't want to run it directly, so that may not matter.
However, that's not what you're asking about.)

> I tried to understand how to write zstyle completion to make your life
> easier but are not very good.
> 
> I only wish that when I enter, eg,
> 
> cm directory directory.tar
> 
> postfix tar appear on a list where there are tar, tar.gz, etc.

You can use zstyle to tell the system that you only want certain files
completed after a command.  However, since you want something a little
bit more than that, to complete an archive as the first argument and a
directory as the second, it's best to use a new function.  You can call
the following "_cm" and put it in your function path (make sure the
#compdef is in the first line of the file):


#compdef cm ex

local expl

if [[ CURRENT -eq 3 && $service = cm ]]; then
  # Complete directory
  _wanted directories expl directory _path_files -/
else
  # Complete archive
  _wanted archives expl archive \
      _files -g '*.(tar.gz|bz2|rar|gz|tar|tbz2|tgz|zip|Z|7z)'
fi


Here's a summary of what's going on.

- The "#compdef cm ex" means that when you run "compinit" and it
  searches all your functions beginning with "_", it will find that this
  function does completion for the commands "cm" and "ex".

- The local variable "expl" is used by the completion system for
  temporarily saving explanations to display.  You'll see it's the
  second argument after "_wanted" later on.

- If the current argument is 3 (where the command counts a s 1), and the
  command is "cm" ($service stores the name of the command), then complete
  directories.

- Else complete a pattern giving one of the forms of compressed file or
  archive you want.

- The "_wanted <tag> expl <description>" is there to help the
  completion system know how to deal with the completion you're giving
  it.  It adds a description to the completion, as well as a tag that
  can be used if you want to make a zstyle for this completion.

- The important bit of the completions are these: for directories,
    _path_files -/
  This says complete files, with an option saying that the files must
  be directories.

- For the archives or compressed files,
    _files -g '*.(tar.gz|bz2|rar|gz|tar|tbz2|tgz|zip|Z|7z)'
  says complete files, and gives as an option the pattern that the files
  must match.

- The difference betewen _path_files and _files is that _files will
  also complete directories.  So if your archive is in another
  directory, you can still use completion to find it.  If you don't want
  that, you can change it to
    _path_files -g '*.(tar.gz|bz2|rar|gz|tar|tbz2|tgz|zip|Z|7z)'
  and it will still complete the archives, but not directories.

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

