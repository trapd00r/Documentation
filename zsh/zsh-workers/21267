From zsh-workers-return-21267-mason-zsh=primenet.com.au@sunsite.dk Thu May 19 11:29:20 2005
Return-Path: <zsh-workers-return-21267-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9948 invoked from network); 19 May 2005 11:29:19 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 19 May 2005 11:29:19 -0000
Received: (qmail 4474 invoked from network); 19 May 2005 11:29:13 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 19 May 2005 11:29:13 -0000
Received: (qmail 27484 invoked by alias); 19 May 2005 11:29:09 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21267
Received: (qmail 27474 invoked from network); 19 May 2005 11:29:09 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 19 May 2005 11:29:09 -0000
Received: (qmail 4147 invoked from network); 19 May 2005 11:29:09 -0000
Received: from mail36.messagelabs.com (193.109.254.211)
  by a.mx.sunsite.dk with SMTP; 19 May 2005 11:29:01 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-23.tower-36.messagelabs.com!1116502141!2339681!1
X-StarScan-Version: 5.4.15; banners=-,-,-
X-Originating-IP: [158.234.9.163]
Received: (qmail 2575 invoked from network); 19 May 2005 11:29:01 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-23.tower-36.messagelabs.com with SMTP; 19 May 2005 11:29:01 -0000
Received: from trentino.logica.co.uk ([158.234.142.59])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id j4JBT0Ze003070;
	Thu, 19 May 2005 12:29:00 +0100
Received: from trentino.groupinfra.com (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP id 7C8DA54C42;
	Thu, 19 May 2005 13:29:00 +0200 (CEST)
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <428A59D9.9050305@krose.org> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <428A59D9.9050305@krose.org>
To: zsh-workers@sunsite.dk
Cc: Kyle Rose <krose@krose.org>
Subject: Re: Completion strangeness 
Date: Thu, 19 May 2005 13:29:00 +0200
Message-ID: <10766.1116502140@trentino.groupinfra.com>
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

Kyle Rose wrote:
> This relates to zsh 4.2.5's ssh command line completion.  I don't know
> if this problem exists in earlier versions.

This is unrelated to the bug Bart pointed to. I can't reproduce what you
show exactly but I have isolated this down to what is undoubtably a bug.
Whether this is the problem you're having, I'm not sure.

>   krose@jihl ~% ssh krose@yupa..org
> 
> with the cursor over the second ".".

I always found that sort of stuff (filling in characters to the right of
the cursor) a bit weird. I've seen it before and assumed Sven meant it
as a feature. Maybe he didn't.

We can cut this down to a minimal setup to see problems:

zsh -f
autoload -U compinit; compinit
zstyle ':completion:*:::' _complete
_try() {       
compset -P '*@'
compadd -M 'r:|.=* r:|=*' \
        yupa-dmz.valley-of-wind.krose.org \
        yupa.krose.org yupa.valley-of-wind.krose.org
}
compdef _try t

Now compare the following:
% t y<tab>
  -> t yupa_
% t kr@y<tab>
  -> t kr@yupa_
% t kro@y<tab>
  -> t kro@yupa._.

Where _ is the cursor.

Patterns like '???' and '????' in compset also work. If compset has
removed four or more characters, we get the separator character (.)
inserted. So the problem is in the C code.

Oliver

