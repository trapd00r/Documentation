From zsh-workers-return-12395-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Jul 27 07:45:20 2000
Return-Path: <zsh-workers-return-12395-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9755 invoked from network); 27 Jul 2000 07:45:17 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 27 Jul 2000 07:45:17 -0000
Received: (qmail 6280 invoked by alias); 27 Jul 2000 07:44:41 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12395
Received: (qmail 6271 invoked from network); 27 Jul 2000 07:44:39 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000727074427.ZM26773@candle.brasslantern.com>
Date: Thu, 27 Jul 2000 07:44:27 +0000
In-Reply-To: <20000726212448.A11510@thelonious.new.ox.ac.uk>
Comments: In reply to Adam Spiers <adam@spiers.net>
        "problem with _arguments" (Jul 26,  9:24pm)
References: <20000726212448.A11510@thelonious.new.ox.ac.uk>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Subject: Core dump in compdescribe (Re: problem with _arguments)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Jul 26,  9:24pm, Adam Spiers wrote:
} Subject: problem with _arguments
}
} _foo () {
}   _arguments \
}     '-l[]' \
}     ':description for first param: ' \
}     '*:description for files:_files'
} }
} 
} But with the latest CVS:
} 
} $ foo -<TAB>
} $ foo -
} ---- description for first param
} 
} What am I doing wrong, or is it a bug?

I think it's a bug.  The value of `next' at _arguments line 341 is
"-l:message for option" but nothing is ever done with it after that.
It does the right thing if the ':description for first param: ' is
removed (though you can only see "message for option" if you ask for
an explicit listing with `foo -<C-d>').

Fiddling with this, I caused a core dump in computil:

zagzig<5> compdef _foo foo
zagzig<6> foo -
_describe:compdescribe:36: invalid argument: -Q

Program received signal SIGSEGV, Segmentation fault.
0x80d486b in cd_get (params=0xbfffb208)
    at ../../../zsh-3.1.6/Src/Zle/computil.c:173
173             for (p = set->strs; *p; p++)
(gdb) where 2
#0  0x80d486b in cd_get (params=0xbfffb208)
    at ../../../zsh-3.1.6/Src/Zle/computil.c:173
#1  0x80d4d9c in bin_compdescribe (nam=0x400e83c8 "compdescribe", 
    args=0xbfffb204, ops=0xbfffb27c "", func=0)
    at ../../../zsh-3.1.6/Src/Zle/computil.c:276


I didn't think the entire 168 stack frames would be useful.  I got this
core dump when I accidentally deleted the word "option" at _arguments
line 342:

           next=( "$next[@]" "$odirect[@]" )
-          _describe -o option \
+          _describe -o \
                     next -Q -M "$matcher" -- \
                     direct -QS '' -M "$matcher" -- \
                     equal -QqS= -M "$matcher"


-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

