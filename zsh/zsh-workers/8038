From zsh-workers-return-8038-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Sep 24 10:20:57 1999
Return-Path: <zsh-workers-return-8038-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23095 invoked from network); 24 Sep 1999 10:20:56 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 24 Sep 1999 10:20:56 -0000
Received: (qmail 21102 invoked by alias); 24 Sep 1999 10:20:42 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8038
Received: (qmail 21095 invoked from network); 24 Sep 1999 10:20:41 -0000
Message-Id: <9909240945.AA22486@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: PATCH: 3.1.6-pws-5: _tar
Date: Fri, 24 Sep 1999 11:45:09 +0200
From: Peter Stephenson <pws@ibmth.df.unipi.it>

_tar can't handle reading from tar archives if the archive name begins with
a ~.  The following handles it the simplest way, but there are still
possible quoting problems.

--- Completion/User/_tar~	Mon Aug 30 17:27:36 1999
+++ Completion/User/_tar	Fri Sep 24 10:00:28 1999
@@ -53,15 +53,15 @@
 
 tmp="$words[(I)--file=*]"
 if (( tmp )); then
-  tf="${words[tmp][8,-1]}"
+  tf=${~words[tmp][8,-1]}
   _tar_cmd="f$_tar_cmd"
 elif [[ "$words[2]" != -* && "$words[2]" = *f* ]]; then
-  tf="$words[3]"
+  tf=${~words[3]}
   _tar_cmd="f$_tar_cmd"
 else
   tmp="${words[(I)-*f*~--*]}"
   if (( tmp )); then
-    tf="$words[tmp+1]"
+    tf=${~words[tmp+1]}
     _tar_cmd="f$_tar_cmd"
   fi
 fi

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

