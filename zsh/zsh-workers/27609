From zsh-workers-return-27609-mason-zsh=primenet.com.au@zsh.org Wed Jan 20 13:39:08 2010
Return-Path: <zsh-workers-return-27609-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22595 invoked by alias); 20 Jan 2010 13:39:08 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 27609
Received: (qmail 19376 invoked from network); 20 Jan 2010 13:39:05 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00,DKIM_SIGNED,
	DKIM_VERIFIED,UNPARSEABLE_RELAY autolearn=ham version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at yahoo.fr does not designate permitted sender hosts)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.fr;
  h=Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Date:From:To:Subject:Message-ID:Mail-Followup-To:References:MIME-Version:Content-Type:Content-Disposition:In-Reply-To:User-Agent;
  b=1XRk5FbFcGv3KX1QyElpmh8BRriUz0iRCneaSrxjQ3gYY740tMtonjqDn6EhrX1HB1nFiea57boXInsD1EAfQYGouOM7VReFxwYkgoo87edNj5aw9Bd+Hdvf/fc8FNLJN0l+mYZo+hWhskHt98j1oDeUmHLqATX+fZDMpg3gFvc=  ;
X-Yahoo-SMTP: V1UR0WuswBDVD1eFhM33188Ir8ciBckz4W8ZMsAh
X-YMail-OSG: lKibRlwVM1kch5sYDU1qHf.Y343jbtUMDmnGIWY1PxXYIOJ_IK8JZiEjvsxoGJR3coOsQzAYBiWAMbqVjgY5UbOji6Aa1UAVt_B_VRPuMKxz2YaFg7KHQEpCw67fyjgT2o_91FuQGRRE_yjTmDv_xOZy2r1jaQ14.Q1_3yLmK0vHiC1eCAVemp9hPBEG2xWf1HeeYy6HN5SYNi_fAvZ_yz10cxPwAzutoj.Pr_RkJoDL9PCr3YrT67h.d3cED4wWJVX.ZSjxjBM-
X-Yahoo-Newman-Property: ymail-3
Date: Wed, 20 Jan 2010 13:32:18 +0000
From: Stephane Chazelas <stephane_chazelas@yahoo.fr>
To: Zsh hackers list <zsh-workers@zsh.org>
Subject: subscript expanded twice in a[subcript]++ (Was: problem with
	RANDOM and arrays)
Message-ID: <chaz20100120133218.GB3872@yahoo.fr>
Mail-Followup-To: Zsh hackers list <zsh-workers@zsh.org>
References: <chaz20100111201312.GB3902@seebyte.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <chaz20100111201312.GB3902@seebyte.com>
User-Agent: Mutt/1.5.16 (2007-09-19)

2010-01-11 20:13:12 +0000, Stephane Chazelas:
[...]
> someone reported the exact same problem with bash. And it also
> occurs with zsh and ksh93.

Note that this bug has already been fixed in ksh93
(http://mailman.research.att.com/pipermail/ast-developers/2010q1/000550.html),
not in bash yet.

> ~$ unset x; for i ({1..1000}) ((x[RANDOM%2+1]++)); echo $x
> 508 509
> 
> (see how the sum is not 1000 and how the numbers are close
> together).
> 
> My understanding is that
> 
> x[RANDOM%2+1]++
> 
> is handled as
> 
> x[RANDOM%2+1] = x[RANDOM%2] + 1
> 
> and the 2 RANDOMs above are expanded twice, so will generally be
> different. But I would still say it's a bug.
> 
> Similar problem:
> 
> $ x=0; ((a[++x]++)); echo $x
> 2
> 
> All the +=, -=, *=... operators are also affected.

-- 
Stephane

