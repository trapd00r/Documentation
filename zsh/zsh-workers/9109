From zsh-workers-return-9109-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Dec 17 16:33:14 1999
Return-Path: <zsh-workers-return-9109-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22202 invoked from network); 17 Dec 1999 16:33:13 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Dec 1999 16:33:13 -0000
Received: (qmail 17561 invoked by alias); 17 Dec 1999 16:33:05 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9109
Received: (qmail 17553 invoked from network); 17 Dec 1999 16:33:04 -0000
Date: Fri, 17 Dec 1999 16:33:03 +0000
From: Adam Spiers <adam@spiers.net>
To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Subject: no_glob_subst fix for _hosts
Message-ID: <19991217163303.A8182@thelonious.new.ox.ac.uk>
Reply-To: Adam Spiers <adam@spiers.net>
Mail-Followup-To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 1.0pre3i
X-URL: http://www.new.ox.ac.uk/~adam/
X-OS: Linux 2.2.12 i686

Completion/User/_hosts has problems if /etc/hosts contains globbing
characters (e.g. `#', which is quite common).

It would be nice to get rid of _cache_hosts and use zstyle, but I
haven't had time to learn all the details yet.

Index: _hosts
===================================================================
RCS file: /projects/zsh/zsh/Completion/User/_hosts,v
retrieving revision 1.1.1.20
diff -u -r1.1.1.20 _hosts
--- _hosts	1999/12/10 14:47:58	1.1.1.20
+++ _hosts	1999/12/17 16:29:54
@@ -4,7 +4,7 @@
 
 if ! zstyle -a ":completion${curcontext}:hosts" hosts hosts; then
   (( $+_cache_hosts )) ||
-      : ${(A)_cache_hosts:=${(s: :)${(ps:\t:)${${(f)"$(</etc/hosts)"}%%\#*}##[:blank:]#[^[:blank:]]#}}}
+      : ${(A)_cache_hosts:=${(s: :)${(ps:\t:)${${(f)~~"$(</etc/hosts)"}%%\#*}##[:blank:]#[^[:blank:]]#}}}
 
   hosts=( "$_cache_hosts[@]" )
 fi

