From zsh-workers-return-22561-mason-zsh=primenet.com.au@sunsite.dk Sat Jul 29 22:03:50 2006
Return-Path: <zsh-workers-return-22561-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13585 invoked from network); 29 Jul 2006 22:03:48 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.3 (2006-06-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 29 Jul 2006 22:03:48 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 87720 invoked from network); 29 Jul 2006 22:03:40 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 29 Jul 2006 22:03:40 -0000
Received: (qmail 7294 invoked by alias); 29 Jul 2006 22:03:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22561
Received: (qmail 7279 invoked from network); 29 Jul 2006 22:03:35 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 29 Jul 2006 22:03:35 -0000
Received: (qmail 87473 invoked from network); 29 Jul 2006 22:03:35 -0000
Received: from vms040pub.verizon.net (206.46.252.40)
  by a.mx.sunsite.dk with SMTP; 29 Jul 2006 22:03:32 -0000
Received: from torch.brasslantern.com ([71.116.116.250])
 by vms040.mailsrvcs.net
 (Sun Java System Messaging Server 6.2-4.02 (built Sep  9 2005))
 with ESMTPA id <0J360034OQLU1656@vms040.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Sat, 29 Jul 2006 17:03:31 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id k6TM3TFE012262	for
 <zsh-workers@sunsite.dk>; Sat, 29 Jul 2006 15:03:29 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id k6TM3T7g012261	for zsh-workers@sunsite.dk; Sat,
 29 Jul 2006 15:03:29 -0700
Date: Sat, 29 Jul 2006 15:03:29 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: PATCH: incremental-complete-word
To: zsh-workers@sunsite.dk
Message-id: <060729150329.ZM12260@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii

This fixes some display bugs that had crept in as the rest of the code
evolved around this, and adds some recommendations for common failure
cases that it's really not possible to fix within the function.  It's
unclear to me whether contrib.yo needs to be updated.

There are still some pretty nasty bugs; e.g., if you start incremental
completion in the middle of a word, and then backspace past the point
where incremental completion began, confusing things begin to happen
(which vary depending on zstyles governing completion listings, etc.).

Index: incremental-complete-word
===================================================================
RCS file: /extra/cvsroot/zsh/zsh-4.0/Functions/Zle/incremental-complete-word,v
retrieving revision 1.1.1.1
diff -c -r1.1.1.1 incremental-complete-word
--- incremental-complete-word	9 Apr 2001 20:14:12 -0000	1.1.1.1
+++ incremental-complete-word	29 Jul 2006 21:49:15 -0000
@@ -10,6 +10,15 @@
 #
 # This works only with the new function based completion system.
 
+# Recommended settings:
+#   zstyle ':completion:incremental:*' completer _complete _ignored
+#   zstyle :incremental stop-keys $'[\e\C-b\C-f\C-n\C-p\C-u-\C-x]'
+
+# BUGS:
+# The _oldlist completer breaks incremental completion.  Use a context-
+# specific completer zstyle as shown above to disable the _oldlist
+# completer in this function.
+
 # The main widget function.
 
 incremental-complete-word() {
@@ -52,7 +61,7 @@
     state=''
   fi
   zformat -f pstr "$pmpt" "u:${word}" "s:$state" "n:$num" \
-                          "l:$toolong" "c:${_lastcomp[completer][2,-1]}"
+                          "l:$toolong" "c:${_lastcomp[completer]}"
   zle -R "$pstr"
   read -k key
 
@@ -95,7 +104,7 @@
         state=''
       fi
       zformat -f pstr "$pmpt" "u:${word}" "s:$state" "n:$num" \
-                              "l:$toolong" "c:${_lastcomp[completer][2,-1]}"
+                              "l:$toolong" "c:${_lastcomp[completer]}"
       zle -R "$pstr"
     else
       zle -R

