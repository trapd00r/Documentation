From zsh-workers-return-21030-mason-zsh=primenet.com.au@sunsite.dk Mon Mar 21 01:57:26 2005
Return-Path: <zsh-workers-return-21030-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7218 invoked from network); 21 Mar 2005 01:57:25 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 21 Mar 2005 01:57:25 -0000
Received: (qmail 85303 invoked from network); 21 Mar 2005 01:57:19 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 21 Mar 2005 01:57:19 -0000
Received: (qmail 6317 invoked by alias); 21 Mar 2005 01:57:16 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21030
Received: (qmail 6306 invoked from network); 21 Mar 2005 01:57:16 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 21 Mar 2005 01:57:16 -0000
Received: (qmail 85020 invoked from network); 21 Mar 2005 01:57:15 -0000
Received: from wproxy.gmail.com (64.233.184.203)
  by a.mx.sunsite.dk with SMTP; 21 Mar 2005 01:57:12 -0000
Received: by wproxy.gmail.com with SMTP id 69so544152wri
        for <zsh-workers@sunsite.dk>; Sun, 20 Mar 2005 17:57:10 -0800 (PST)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:reply-to:to:subject:mime-version:content-type:content-transfer-encoding;
        b=WsBqw9uqmHIIAT4d7lbL1tP/ap/A3oXJygQgjMQUo9x2VXwO0Y9YvtM+F1JW3anZvkvjAa7TIzJ5NMnGB7ghxA77n4k25QcbbQg78VmwmDZa0vX291i8qSSSoV0HnIf34e+ftw6+P2ogBvwGuSvv2jt6teFzlHJ6B36GXeAlfNg=
Received: by 10.54.39.76 with SMTP id m76mr1353946wrm;
        Sun, 20 Mar 2005 17:57:10 -0800 (PST)
Received: by 10.54.29.39 with HTTP; Sun, 20 Mar 2005 17:57:10 -0800 (PST)
Message-ID: <237967ef05032017571464ae4f@mail.gmail.com>
Date: Mon, 21 Mar 2005 02:57:10 +0100
From: Mikael Magnusson <mikachu@gmail.com>
Reply-To: Mikael Magnusson <mikachu@gmail.com>
To: zsh-workers <zsh-workers@sunsite.dk>
Subject: crash in tabcompleting
Mime-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.2 required=6.0 tests=AWL,BAYES_00,RCVD_BY_IP 
	autolearn=ham version=3.0.2
X-Spam-Hits: -2.2

I'm using latest cvs (as of 20th march) and I'm getting segfaults when
i tabcomplete some files with utf-8 names. I'm not running in a UTF-8
locale though, and I think this worked earlier. I have in one
directory two files called
"=E5=A4=A7=E5=A1\232=E6\204\233 - =E5=A4=A7=E5=A5=BD=E3\201\215=E3\201\237=
=E3\202\231=E3\202\210=E3\200\202.avi"
and
"=E5=A4=A7=E5=A1\232=E6\204\233 - =E9\207\221=E9=AD\232=E8\212=B1=E7\201=AB=
.mpg"
(listed with ls --quoting-style=3Dc)

if i try to tabcomplete in that directory, i get the following backtrace:
If i'm leaving some vital information out, please say so and i will do
my best to help.

Program received signal SIGSEGV, Segmentation fault.
ztrsub (t=3D0x82ac9fe "", s=3D0x82d9000 <Address 0x82d9000 out of bounds>)
at utils.c:2992
2992=09=09if (*s++ =3D=3D Meta) {
(gdb) bt
#0  ztrsub (t=3D0x82ac9fe "", s=3D0x82d9000 <Address 0x82d9000 out of
bounds>) at utils.c:2992
#1  0x080c5d2a in pattryrefs (prog=3D0x811e9b8, string=3D0x442fc700 "",
stringlen=3D6, patoffset=3D0,
    nump=3D0x0, begp=3D0x0, endp=3D0x0) at pattern.c:1567
#2  0x080c6420 in pattry (prog=3D0x0, string=3D0x0) at pattern.c:1499
#3  0xb7d7bf94 in do_comp_vars (test=3D186, na=3D1, sa=3D0xb7d29928 "\213",
nb=3D137021950,
    sb=3D0xb7d29928 "\213", mod=3D1) at complete.c:829
#4  0xb7d7c255 in bin_compset (name=3D0xb7d29928 "\213", argv=3D0x0,
ops=3D0xbffee4a0, func=3D0)
    at complete.c:939
#5  0x08053b54 in execbuiltin (args=3D0xbffee4a0, bn=3D0xb7d93ba4) at built=
in.c:439
#6  0x08070c8e in execcmd (state=3D0xbfffdec0, input=3D0, output=3D0,
how=3D18, last1=3D2) at exec.c:2435
#7  0x08071865 in execpline2 (state=3D0xbfffdec0, pcode=3D0, how=3D18,
input=3D0, output=3D0, last1=3D0)
    at exec.c:1283
#8  0x08071e71 in execpline (state=3D0xbfffdec0, slcode=3D1143981824,
how=3D18, last1=3D0) at exec.c:1069
#9  0x08073833 in execlist (state=3D0xbfffdec0, dont_change_job=3D1,
exiting=3D0) at exec.c:875
#10 0x0809a6f0 in execif (state=3D0xbfffdec0, do_exec=3D0) at loop.c:505
#11 0x08070027 in execcmd (state=3D0xbfffdec0, input=3D0, output=3D0,
how=3D18, last1=3D2) at exec.c:2382
#12 0x08071865 in execpline2 (state=3D0xbfffdec0, pcode=3D0, how=3D18,
input=3D0, output=3D0, last1=3D0)
    at exec.c:1283
#13 0x08071e71 in execpline (state=3D0xbfffdec0, slcode=3D1143981824,
how=3D18, last1=3D0) at exec.c:1069
#14 0x08073833 in execlist (state=3D0xbfffdec0, dont_change_job=3D1,
exiting=3D0) at exec.c:875
#15 0x0809a799 in execif (state=3D0xbfffdec0, do_exec=3D0) at loop.c:520
#16 0x08070027 in execcmd (state=3D0xbfffdec0, input=3D0, output=3D0, how=
=3D2,
last1=3D2) at exec.c:2382
#17 0x08071865 in execpline2 (state=3D0xbfffdec0, pcode=3D0, how=3D2,
input=3D0, output=3D0, last1=3D0)
    at exec.c:1283
#18 0x08071e71 in execpline (state=3D0xbfffdec0, slcode=3D1143981824,
how=3D2, last1=3D0) at exec.c:1069
#19 0x08073833 in execlist (state=3D0xbfffdec0, dont_change_job=3D1,
exiting=3D0) at exec.c:875
#20 0x08073b6a in runshfunc (prog=3D0x82a7c28, wrap=3D0x82a7c28,
name=3D0xb7d28030 "_main_complete")
    at exec.c:775
#21 0xb7d7ccba in comp_wrapper (prog=3D0x0, w=3D0x0, name=3D0x0) at complet=
e.c:1298
---Type <return> to continue, or q <return> to quit---
#22 0x08073f6a in doshfunc (name=3D0x814b918 "_main_complete",
prog=3D0x82a7c28, doshargs=3D0xb7d28030,
    flags=3D0, noreturnval=3D0) at exec.c:3692
#23 0xb7d842b6 in makecomplist (s=3D0x8151d70 "=E5=A4=A7=E5=A1\203=BA=E6\20=
3=A4\203=BB -
", incmd=3D0, lst=3D0)
    at compcore.c:787
#24 0xb7d85368 in do_completion (dummy=3D0xb7dc7e74, dat=3D0x442fc700) at
compcore.c:342
#25 0xb7db7ef4 in docomplete (lst=3D0) at zle_tricky.c:1845
#26 0xb7db94cf in completeword (args=3D0x0) at zle_tricky.c:208
#27 0xb7db3a09 in completecall (args=3D0x442fc700) at zle_tricky.c:184
#28 0xb7da7042 in execzlefunc (func=3D0xb7dc5330, args=3D0xb7dc817c) at
zle_main.c:1053
#29 0xb7da7868 in zlecore () at zle_main.c:828
#30 0xb7da829a in zleread (lp=3D0x810ab90, rp=3D0x0, flags=3D0, context=3D0=
)
at zle_main.c:982
#31 0x0808ac74 in inputline () at input.c:278
#32 0x0808b31a in ingetc () at input.c:214
#33 0x08081777 in ihgetc () at hist.c:240
#34 0x08097126 in gettok () at lex.c:627
#35 0x08098e86 in yylex () at lex.c:343
#36 0x080bba5a in parse_event () at parse.c:449
#37 0x08087c38 in loop (toplevel=3D1, justonce=3D0) at init.c:128
#38 0x0808a854 in zsh_main (argc=3D1, argv=3D0xbfffeca4) at init.c:1282
#39 0x080534ce in main (argc=3D0, argv=3D0x0) at main.c:93

--=20
Mikael Magnusson

