From zsh-workers-return-28855-mason-zsh=primenet.com.au@zsh.org Fri Mar 04 13:45:13 2011
Return-Path: <zsh-workers-return-28855-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3465 invoked by alias); 4 Mar 2011 13:45:13 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28855
Received: (qmail 29522 invoked from network); 4 Mar 2011 13:45:11 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-0.4 required=5.0 tests=BAYES_00,FAKE_REPLY_C
	autolearn=ham version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at spf.stack.nl designates 131.155.140.107 as permitted sender)
Date: Fri, 4 Mar 2011 14:36:34 +0100
From: Jilles Tjoelker <jilles@stack.nl>
To: Zsh Hackers' List <zsh-workers@zsh.org>
Subject: Re: sh compatibility issue
Message-ID: <20110304133634.GB35982@stack.nl>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20110222200259.2aab2dcc@pws-pc.ntlworld.com>
User-Agent: Mutt/1.5.21 (2010-09-15)

I notice that the patches were committed. This indeed fixes some things
(FreeBSD sh testsuite errors/redirection-error.0 which checks that
redirection errors for special builtins are fatal) but breaks another
test which happened to pass before: errors/redirection-error3.0 which
checks that redirection errors are not fatal for special builtins
preceded by the command builtin.

Although 'command' is often implemented as some sort of precommand
modifier, the POSIX specification says it is a regular builtin,
therefore redirection errors are not fatal (and variable assignments do
not persist). The specification also says that 'command' causes operand
(syntax) errors to be non-fatal.

A useful example is in the Application Usage section of the 'command'
page:
  command exec > unwritable-file
This does not cause the shell to abort, so the exit status can be
checked by the script.

This works as specified in ksh93, bash --posix and FreeBSD 9 sh, for
example.

-- 
Jilles Tjoelker

