From zsh-workers-request@euclid.skiles.gatech.edu Sun Mar 30 21:33:30 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 17100 invoked from network); 30 Mar 1997 21:33:28 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 30 Mar 1997 21:33:28 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id QAA16655; Sun, 30 Mar 1997 16:26:23 -0500 (EST)
Resent-Date: Sun, 30 Mar 1997 16:26:23 -0500 (EST)
Date: Sun, 30 Mar 1997 22:29:12 +0100 (BST)
From: Zefram <zefram@dcs.warwick.ac.uk>
Message-Id: <13887.199703302129@stone.dcs.warwick.ac.uk>
Subject: nolog option
X-Patch: 239
Resent-Message-ID: <"C6L5H.0.A44.zfjFp"@euclid>
To: zsh-workers@math.gatech.edu
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3050
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

-----BEGIN PGP SIGNED MESSAGE-----

This patch adds a HIST_NO_FUNCTIONS option, with the functionality of
ksh's `nolog' option.  (An option alias is added to make the ksh name
available.)  With the recent histactive changes, this takes impressively
little code.

 -zefram

      *** Doc/Zsh/options.yo	1997/03/30 17:09:18	1.10
      --- Doc/Zsh/options.yo	1997/03/30 17:33:40
      ***************
      *** 384,389 ****
      --- 384,393 ----
        Do not enter command lines into the history list
        if any command on the line begins with a blank.
        )
      + pindex(HIST_NO_FUNCTIONS)
      + item(tt(HIST_NO_FUNCTIONS))(
      + Do not store function definitions in the history list.
      + )
        pindex(HIST_NO_STORE)
        item(tt(HIST_NO_STORE))(
        Remove the tt(history) (tt(fc -l)) command from
      ***************
      *** 872,877 ****
      --- 876,886 ----
        item(tt(HIST_EXPAND))(
        tt(BANG_HIST)
        (bash compatibility)
      + )
      + pindex(LOG)
      + item(tt(LOG))(
      + em(NO_)tt(HIST_NO_FUNCTIONS)
      + (ksh compatibility)
        )
        pindex(MAIL_WARN)
        item(tt(MAIL_WARN))(
      *** Src/exec.c	1997/03/29 23:35:54	1.56
      --- Src/exec.c	1997/03/30 17:30:04
      ***************
      *** 2451,2456 ****
      --- 2451,2458 ----
        	    shfunctab->addnode(shfunctab, ztrdup(s), shf);
        	}
            } LASTALLOC;
      +     if(isset(HISTNOFUNCTIONS))
      + 	remhist();
            return 0;
        }
        
      *** Src/options.c	1997/03/30 17:09:23	1.9
      --- Src/options.c	1997/03/30 17:29:31
      ***************
      *** 113,118 ****
      --- 113,119 ----
        {NULL, "histbeep",	      OPT_ALL,			 HISTBEEP},
        {NULL, "histignoredups",      0,			 HISTIGNOREDUPS},
        {NULL, "histignorespace",     0,			 HISTIGNORESPACE},
      + {NULL, "histnofunctions",     0,			 HISTNOFUNCTIONS},
        {NULL, "histnostore",	      0,			 HISTNOSTORE},
        {NULL, "histreduceblanks",    0,			 HISTREDUCEBLANKS},
        {NULL, "histverify",	      0,			 HISTVERIFY},
      ***************
      *** 177,182 ****
      --- 178,184 ----
        {NULL, "hashall",	      OPT_ALIAS, /* bash */	 HASHCMDS},
        {NULL, "histappend",	      OPT_ALIAS, /* bash */	 APPENDHISTORY},
        {NULL, "histexpand",	      OPT_ALIAS, /* bash */	 BANGHIST},
      + {NULL, "log",		      OPT_ALIAS, /* ksh */	 -HISTNOFUNCTIONS},
        {NULL, "mailwarn",	      OPT_ALIAS, /* bash */	 MAILWARNING},
        {NULL, "onecmd",	      OPT_ALIAS, /* bash */	 SINGLECOMMAND},
        {NULL, "physical",	      OPT_ALIAS, /* ksh/bash */	 CHASELINKS},
      *** Src/zsh.h	1997/03/30 17:09:24	1.53
      --- Src/zsh.h	1997/03/30 17:28:08
      ***************
      *** 1001,1006 ****
      --- 1001,1007 ----
            HISTBEEP,
            HISTIGNOREDUPS,
            HISTIGNORESPACE,
      +     HISTNOFUNCTIONS,
            HISTNOSTORE,
            HISTREDUCEBLANKS,
            HISTVERIFY,

-----BEGIN PGP SIGNATURE-----
Version: 2.6.3ia
Charset: ascii

iQCVAwUBMz6nJHD/+HJTpU/hAQHMTQP+JM+rv4/E+xuahiNvRQ8/tOHLY2ZPYqiS
tbbTRXwSxMsNn+nwbOMibCYazlHk5Xt/9cZj3NOYBnkrP/eY0eSGGIg5adTBJt4M
usBnNh1Wu0TuynUONH7sa8PLoafRoU3oC/dd8EnqfIZ+i5fh4eHIc4h+410mzXc4
iR92Yfs5i0I=
=K1qo
-----END PGP SIGNATURE-----

