From zsh-workers-return-27029-mason-zsh=primenet.com.au@sunsite.dk Thu Jun 04 11:07:16 2009
Return-Path: <zsh-workers-return-27029-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 302 invoked from network); 4 Jun 2009 11:07:13 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 4 Jun 2009 11:07:13 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 91230 invoked from network); 4 Jun 2009 10:59:48 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Jun 2009 10:59:48 -0000
Received: (qmail 15841 invoked by alias); 4 Jun 2009 10:59:35 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 27029
Received: (qmail 15802 invoked from network); 4 Jun 2009 10:59:34 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 4 Jun 2009 10:59:34 -0000
Received: from fg-out-1718.google.com (fg-out-1718.google.com [72.14.220.153])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 8E8CC801E289
	for <zsh-workers@sunsite.dk>; Thu,  4 Jun 2009 12:59:19 +0200 (CEST)
Received: by fg-out-1718.google.com with SMTP id 13so219188fge.14
        for <zsh-workers@sunsite.dk>; Thu, 04 Jun 2009 03:59:19 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:received:date:from:to:subject
         :message-id:mime-version:content-type:content-disposition:user-agent;
        bh=qKd47CdSGG3Qm0SuMfZb9yP5GkTOSSnyIXX98Flk9Es=;
        b=Q8IW1/WG3gwyc6RgoQW7vZ4Q0tV5Q5onSzX5bIslF2vjFWmBM3wqSdusFZ1cUGHtFv
         HhirCuL3i9ubGvJQ9Cu9dmfGDPnf7CDOxXK1fdojqNf1eCb4xy6dNZMk/o69mtEpgwlT
         XmmLNLS6xgzXu22WSktzz/XMlXk1heBcdnJ6E=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=date:from:to:subject:message-id:mime-version:content-type
         :content-disposition:user-agent;
        b=e466ra0YEvbfg7OfvhnS/34GJL/WjGINO570WR028FbAkAst87J31V5r944mqAsbPm
         Kz3k9mDD5zPfU4oGWjIbUv1tmBMI5bPTY8UjKQB4hW69YE54fWFC1/mX3j1GTyzBtWhy
         3ZuLK9qxlzsTQMBOFvDG43FQZSRPy5qPe/noI=
Received: by 10.86.91.16 with SMTP id o16mr2371492fgb.26.1244113158975;
        Thu, 04 Jun 2009 03:59:18 -0700 (PDT)
Received: from wicklow.lan (stc92-3-82-245-249-89.fbx.proxad.net [82.245.249.89])
        by mx.google.com with ESMTPS id d6sm2279495fga.17.2009.06.04.03.59.17
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 04 Jun 2009 03:59:18 -0700 (PDT)
Received: by wicklow.lan (Postfix, from userid 1002)
	id 4742726B2B; Thu,  4 Jun 2009 12:59:16 +0200 (CEST)
Date: Thu, 4 Jun 2009 12:59:16 +0200
From: Baptiste Daroussin <baptiste.daroussin@gmail.com>
To: zsh-workers@sunsite.dk
Subject: new completion function for pfctl
Message-ID: <20090604105915.GD40721@wicklow.lan>
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="x+6KMIRAuhnl3hBn"
Content-Disposition: inline
User-Agent: Mutt/1.5.19 (2009-01-05)
X-Virus-Scanned: ClamAV 0.94.2/9419/Thu Jun  4 04:47:46 2009 on bifrost
X-Virus-Status: Clean


--x+6KMIRAuhnl3hBn
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hi all,

Here is a new completion for pfctl (I think it should be placed in
Completion/BSD/Command)

regards,
Bapt

--x+6KMIRAuhnl3hBn
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename=_pfctl

#compdef pfctl

local pfctl_flush_modifiers pfctl_optimizer_level pfctl_show_modifiers pfctl_tables_command pfctl_debug_level

pfctl_flush_modifiers=(
    'all:Flush all'
    'info:Flush the filter information'
    'nat:Flush the NAT rules'
    'osfp:Flush the passive operating system fingerprints'
    'queue:Flush the queue rules'
    'rules:Flush the filter rules'
    'state:Flush the stable table'
    'Sources:Flush the source tracking table'
    'Tables:Flush the tables'
)

pfctl_show_modifiers=(
    'nat:Show the currently loaded NAT rules'
    'queue:Show the currently loaded queue rules'
    'rules:Show the currently loaded filter rules'
    'Anchors:Show the currently loaded anchors directly attached to the main ruleset'
    'state:Show the contents of the state table'
    'Sources:Show the contents of the source tracking table'
    'info:Show filter information'
    'labels:Show per-rule statistics of filter rules with labels'
    'timeouts:Show the current global timeouts'
    'memory:Show the current pool memory hard limits'
    'Tables:Show the list of tables'
    'osfp:Show the list of operating system fingerprints'
    'Interfaces:Show the list of interfaces and interface drivers available to PF'
    'all:Show all except for the lists of interfaces and operating system fingerprints'
)

pfctl_optimizer_level=(
    'none:Disable the ruleset optimizer'
    'basic:Enable basic ruleset optimizations'
    'profile:Enable basic ruleset optimizations with profiling'
)
pfctl_tables_command=(
    'kill:Kill a table'
    'flush:Flush all addresses of a table'
    'add:Add one or more addresses in a table'
    'delete:Delete one or more addresses from a table'
    'expire:Delete addresses which had their statistics cleared more than number seconds ago'
    'replace:Replace the addresses of the table'
    'show:Show the content (addresses) of a table'
    'test:Test if the given addresses match a table'
    'zero:Clear all the statistics of a table'
    'load:Load only the table definitions from pf.conf(5)'
)
pfctl_debug_level=(
    "none:Don\'t generate debug messages" 
    'urgent:Generate debug messages only for serious errors' 
    'misc:Generate debug messages for various errors' 
    'loud:Generate debug messages for common conditions'
)
_iface() {
    local pfctl_iface
    pfctl_iface=($(pfctl -s Interfaces))
    compadd $pfctl_iface
}
_tables() {
    local pfctl_tables
    pfctl_tables=($(pfctl -s Tables))
     compadd $pfctl_tables
}
# TODO:
# Missing -a
#
_arguments -s \
    '-F[Flush the filter parameters specified by modifier]:modifier:(($pfctl_flush_modifiers))' \
    '-A[Load only the queue rules present in the rule file]' \
    '-D[Define macro to be set to value]:macro:' \
    '-d[Disable the packet filter]' \
    '-e[Enable the packet filter]' \
    '-f[Load the rules contained in a file]:configuration file:_files' \
    '-g[Include output helpful for debugging]' \
    '-h[Help]' \
    '-i[Restrict the operation to the given interface]:interface:_iface' \
    '-K[Kill all of the source tracking entries originating from the specified host or network]:host or network:_hosts' \
    '-k[Kill all of the state entries originating from the specified host or network]:host or network:_hosts' \
    '-m[Merge in explicitly given options]' \
    '-N[Load only the NAT rules present in the rule file]' \
    '-n[Do not actually load rules, just parse them]' \
    '-O[Load only the options present in the rule file]' \
    '-o[Control the ruleset optimizer]:level:(($pfctl_optimizer_level))' \
    '-p[Use the device file device instead of the default /dev/pf]:device:_files' \
    '-q[Only print errors and warnings]' \
    '-R[Load only the filter rules present in the rule file]' \
    '-r[Perform reverse DNS lookups on states when displaying them]' \
    '-s[Show the filter parameters specified by modifier]:modifier:(($pfctl_show_modifiers ))' \
    '-T[Specify the command to apply to the table]:command:(($pfctl_tables_command))' \
    '-t[Specify the name of the table]:table:_tables' \
    '-v[Produce more verbose output]' \
    '-x[Set the debug level]:debug level:(($pfctl_debug_level))' \
    '-z[Clear per-rule statistics]'

--x+6KMIRAuhnl3hBn--

