From zsh-workers-return-21110-mason-zsh=primenet.com.au@sunsite.dk Thu Apr 07 17:37:53 2005
Return-Path: <zsh-workers-return-21110-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28527 invoked from network); 7 Apr 2005 17:37:52 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 7 Apr 2005 17:37:52 -0000
Received: (qmail 98385 invoked from network); 7 Apr 2005 17:37:46 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 Apr 2005 17:37:46 -0000
Received: (qmail 25390 invoked by alias); 7 Apr 2005 17:37:42 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21110
Received: (qmail 25374 invoked from network); 7 Apr 2005 17:37:42 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 7 Apr 2005 17:37:42 -0000
Received: (qmail 98071 invoked from network); 7 Apr 2005 17:37:42 -0000
Received: from flock1.newmail.ru (212.48.140.157)
  by a.mx.sunsite.dk with SMTP; 7 Apr 2005 17:37:35 -0000
Received: (qmail 27993 invoked from network); 7 Apr 2005 17:37:32 -0000
Received: from unknown (HELO ?10.0.0.1?) (arvidjaar@newmail.ru@83.237.13.36)
  by smtpd.newmail.ru with SMTP; 7 Apr 2005 17:37:32 -0000
From: Andrey Borzenkov <arvidjaar@newmail.ru>
To: zsh-workers@sunsite.dk
Subject: Re: zsh-4_2-patches
Date: Thu, 7 Apr 2005 21:37:21 +0400
User-Agent: KMail/1.7.2
References: <200504011051.j31ApiMa016381@news01.csr.com> <200504031754.19932.arvidjaar@newmail.ru> <200504061049.j36Anavj020286@news01.csr.com>
In-Reply-To: <200504061049.j36Anavj020286@news01.csr.com>
Content-Type: Multipart/Mixed;
  boundary="Boundary-00=_b/WVCQmJZdEfSMF"
Message-Id: <200504072137.32051.arvidjaar@newmail.ru>
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=6.0 tests=AWL,BAYES_00,
	MIME_HEADER_CTYPE_ONLY autolearn=no version=3.0.2
X-Spam-Hits: -2.5

--Boundary-00=_b/WVCQmJZdEfSMF
Content-Type: text/plain;
  charset="utf-8"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Wednesday 06 April 2005 14:49, Peter Stephenson wrote:
> Andrey Borzenkov wrote:
> > > Zsh in current Mandrake (4.2.4) crashes when completing rsync. I can
> > > currently reproduce it by using the following (_rsync is from current
> > > CVS):
> >
> > it also crashes in current CVS
>
> It doesn't look like I'm going to be able to jump through enough hoops
> to be able to reproduce the problem in this form.
>
> Is this only on the zsh-4_2-patches branch? 

No. It segfaults just as nicely in current CVS.

> Can you reproduce it by 
> completing with the same list of files recreated locally? 

yes. Using attached "foo" and "list" - drop them in current directory and do

pts/3}% ~/pkg/bin/zsh -f
localhost% autoload -U compinit; compinit
localhost% setopt nolistambiguous
localhost% zstyle ':completion:*' menu select=0
localhost% source foo; compdef _foo foo
localhost% foo xxx/<TAB>
zsh: do you wish to see all 276 possibilities (306 lines)?

press "y", press TAB, press any cursor key - zsh segfaults 

Several times it also aborted with the message

*** glibc detected *** corrupted double-linked list: 0x08190db0 ***

(glibc 2.3.4 on Mandrake 10.2). I was not able to reliably reproduce it. 
Sometimes it does not crash immediately but usually does it anyway later.

> From the line 
> number, it looks like the error is probably that the variable "g" is
> NULL, hence mgtab[ml2 * columns * mc2] is NULL?

1563        g = mgtab[ml1 * columns + mc1];
1564        clprintm(g, mtab[ml1 * columns + mc1], mcc1, ml1, lc1,
1565                 (g->widths ? g->widths[mcc1] : g->width));
1566        putc('\r', shout);

(gdb) print g
$4 = 0x8183c20
(gdb) print mtab
$5 = (Cmatch **) 0x8191748
(gdb) print mtab[ml1*columns + mc1]
$6 = (Cmatch *) 0x81837e0
(gdb) print mcc1
$8 = 0
(gdb) print ml1
$9 = 0
(gdb) print lc1
$10 = 1
(gdb) print g->widths[mcc1]
Cannot access memory at address 0x31322033
(gdb) print g->widths
$11 = (int *) 0x31322033
(gdb) print *g
$12 = {name = 0x818ec00 "`�030\b\220�030\b�\030\b", prev = 0x818ed30,
  next = 0x818ee08, flags = 135851744, mcount = 0, matches = 0x19,
  lcount = 135383392, llcount = 135773768, ylist = 0x818efd8, ecount = 0,
  expls = 0x18, ccount = 16, lexpls = 0x656c6966, lmatches = 0x73,
  lfmatches = 0x0, lallccs = 0x59, num = 762802733, nbrbeg = 1915563378,
  nbrend = 538979629, new = 538976288, dcount = 892744243, cols = 840972086,
  lins = 791949360, width = 825176624, widths = 0x31322033, totl = 976237114,
  shortest = 1478506803, perm = 0x65657246}
(gdb) print **mtab[ml1*columns + mc1]
$16 = {str = 0x81155a8 "freeradius-mysql-0.9.3-1.1.i386.rpm",
  orig = 0x810ff38 "freeradius-mysql-0.9.3-1.1.i386.rpm",
  ipre = 0x810fcc8 "xxx/", ripre = 0x0, isuf = 0x0, ppre = 0x0, psuf = 0x0,
  prpre = 0x0, pre = 0x0, suf = 0x0,
  disp = 0x8161038 "-rw-r--r--        7958 2004/02/16 19:22:27 
freeradius-mysql-0.9.3-1.1.i386.rpm", autoq = 0x0, flags = 0, brpl = 0x0, 
brsl = 0x0,
  rems = 0x0, remf = 0x0, qipl = 0, qisl = 0, rnum = 1, gnum = 1, mode = 0,
  modec = 0 '\0'}



-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.0 (GNU/Linux)

iD8DBQFCVW/bR6LMutpd94wRArvKAJ9ddoU0yh+oIkdlLmHg1O2doHERgQCgh5bf
t2LVVleTfXMaao31RtuuXCg=
=y4Pf
-----END PGP SIGNATURE-----

--Boundary-00=_b/WVCQmJZdEfSMF
Content-Type: application/x-tgz;
  name="comptest.tar.gz"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
	filename="comptest.tar.gz"

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
xms2XNJr1T64bPo6lKTTWv/ie6TpS7RZtDaBY+oYU7Z3/CcD68hAHwu+JgPrn3NA2LFS2h2ENG8x
plGJ5L3Bb54hWj8xmxzrbFc0AY3CJRLecAQq98zY3s421tHHcRiOPOS72U8AM01lWxHqihZcGjHo
ougp4CknvzoNSpwyfBTUiJPt79L9Cn1iBArzf90t0kvULt/nu3QbQwLFuBsktsaXt4G6Hx72VDZj
uNrLrE6pgBY4YhKTUzvGcZ5zqkTE4mixZKeV6uRu8aBgyPZQ3dJ7AjrwMOVpueWnDLNJ/ZvuJ0HR
w9MSz8Tav88zoYIeSHpL/0y16VGyTZ58Lwb3YRBMKKPQykLXWiboYRAYsmYYVDytvLNXuCRFmQl6
YB42aJxxZlnfSdNkKNR2J5Kn3a7JInx7WBE8aFaoy4z+XmOCRH/lRjAzQpINqbrP93Ey+YDGjdqR
z8ddd90zMGdv3ry5PRx+978xGP77j2hCje7+/qPhDP+7MUJc//7j/8X4iArw7n3y69skoYxgiwlr
/Sd4i/83v03QPBdVViezH5Kvvr756u+T+i7bvyVdK7MdPcys/vTuy1+//PXd7fs/fPnuH7Z5Vb//
w2+LL979x+mUJP/13999/+NfFu+//u392/YH13lV3NIPtpDFF2v6+uDLa/ryu+/eP/sO/y0fH1PM
odeJ/wL9oYpt8hV+36HO/H9KDmWyzkvfTPX5q+Q/3/4dzSJdr5PZuvvtif/l/tMvvvg6+S354x/9
xNn/9ld8uBn8mnX/a9bPfk2CoLe/vf3/3v3ruI7ruI7ruI7ruI7ruI7ruI7ruI7ruI7ruI7ruI7r
uI7ruI7ruI7ruI7ruI7ruI7r+Fsf/wM91/O7AHgAAA==

--Boundary-00=_b/WVCQmJZdEfSMF--

