From zsh-workers-request@euclid.skiles.gatech.edu  Sat Mar  2 01:00:23 1996
Received: from euclid.skiles.gatech.edu (euclid.skiles.gatech.edu [130.207.146.50]) by werple.net.au (8.7/8.7.1) with ESMTP id BAA29326 for <mason@werple.mira.net.au>; Sat, 2 Mar 1996 01:00:19 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id IAA04093; Fri, 1 Mar 1996 08:38:54 -0500 (EST)
Resent-Date: Fri, 1 Mar 1996 08:38:54 -0500 (EST)
Message-Id: <9603011336.AA12720@hydra.ifh.de>
To: Eskandar Ensafi <esky@CS.UCLA.EDU>
Cc: zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: Re: UGLY CRASHES UNDER ZSH 2.6 BETA 12 
In-Reply-To: "esky@cs.ucla.edu"'s message of "Wed, 28 Feb 1996 09:17:17 MET."
             <9602281717.AA06717@marathon.cs.ucla.edu> 
Date: Fri, 01 Mar 1996 14:36:42 +0100
From: Peter Stephenson <pws@hydra.ifh.de>
Resent-Message-ID: <"eKJtJ2.0.q_.jtlDn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/788
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

esky@cs.ucla.edu wrote:
> Starting program: /usr/local/bin/zsh 
> marathon% bvi foo
> zsh: correct `bvi' to `vi' [nyae]? n
> zsh: command not found: bvi
> marathon% !!
> Program generated(1): Memory access exception on address 0x10 (protection fai
> lure).
> 0x164c2 in clearalstack ()

I can't reproduce this either for some reason, but my guess is that
the alias stack has got a NULL on it, which signifies history
expansion, and the lexrestore() is assuming it's an alias and trying
to dereference it.  Have a go at this (should be completely safe to
give to the kids at home):

*** Src/hist.c~	Mon Feb 19 10:09:38 1996
--- Src/hist.c	Fri Mar  1 14:31:05 1996
***************
*** 440,447 ****
      Alias ix;
  
      while (alstackind) {
! 	ix = alstack[--alstackind];
! 	ix->inuse = 0;
      }
  }
  
--- 440,447 ----
      Alias ix;
  
      while (alstackind) {
! 	if ((ix = alstack[--alstackind]))
! 	  ix->inuse = 0;
      }
  }
  

-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77330
Deutches Electronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.

