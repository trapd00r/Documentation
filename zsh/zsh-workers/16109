From zsh-workers-return-16109-mason-zsh=primenet.com.au@sunsite.dk Mon Oct 22 14:48:41 2001
Return-Path: <zsh-workers-return-16109-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15004 invoked from network); 22 Oct 2001 14:48:40 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 22 Oct 2001 14:48:40 -0000
Received: (qmail 24691 invoked by alias); 22 Oct 2001 14:48:27 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16109
Received: (qmail 24673 invoked from network); 22 Oct 2001 14:48:23 -0000
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <1011022144813.ZM16441@candle.brasslantern.com>
Date: Mon, 22 Oct 2001 14:48:13 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.dk
Subject: PATCH: Constant initial fdtable_size
Cc: Matthew Braun <matthew@ans.net>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

This is intended for the 4-0-patches branch; it should fix the crash reported
in 16082.  Presumably it's sufficiently noncontroversial to commit?

Index: Src/init.c
===================================================================
--- Src/init.c	2001/09/24 15:40:12	1.6
+++ Src/init.c	2001/10/22 14:41:42
@@ -1190,7 +1190,8 @@
 	  break;
     } while (zsh_name);
 
-    fdtable_size = zopenmax();
+    /* Not zopenmax() here: it may return a number too big for zcalloc(). */
+    fdtable_size = 256; /* This grows as necessary, see utils.c:movefd(). */
     fdtable = zcalloc(fdtable_size);
 
     createoptiontable();

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

