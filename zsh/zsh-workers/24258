From zsh-workers-return-24258-mason-zsh=primenet.com.au@sunsite.dk Fri Dec 14 18:01:53 2007
Return-Path: <zsh-workers-return-24258-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2955 invoked from network); 14 Dec 2007 18:01:45 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 14 Dec 2007 18:01:45 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 40705 invoked from network); 14 Dec 2007 18:01:37 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 14 Dec 2007 18:01:37 -0000
Received: (qmail 14503 invoked by alias); 14 Dec 2007 18:01:33 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24258
Received: (qmail 14480 invoked from network); 14 Dec 2007 18:01:31 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 14 Dec 2007 18:01:31 -0000
Received: from virusfilter.dotsrc.org (bifrost [127.0.0.1])
	by spamfilter.dotsrc.org (Postfix) with ESMTP id 1267B8058F55
	for <zsh-workers@sunsite.dk>; Fri, 14 Dec 2007 18:58:43 +0100 (CET)
Received: from prunille.vinc17.org (vinc17.pck.nerim.net [213.41.242.187])
	by bifrost.dotsrc.org (Postfix) with ESMTP
	for <zsh-workers@sunsite.dk>; Fri, 14 Dec 2007 18:58:42 +0100 (CET)
Received: by prunille.vinc17.org (Postfix, from userid 501)
	id 6068B1C7680B; Fri, 14 Dec 2007 19:01:27 +0100 (CET)
Date: Fri, 14 Dec 2007 19:01:27 +0100
From: Vincent Lefevre <vincent@vinc17.org>
To: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: History file locking (was Re: 4.3.4-dev-4 and 4.2.6-dev-2
	available)
Message-ID: <20071214180127.GA982@prunille.vinc17.org>
Mail-Followup-To: Zsh hackers list <zsh-workers@sunsite.dk>
References: <22582.1197372038@csr.com> <20071211235807.GB10374@prunille.vinc17.org> <200712120948.lBC9motE009939@news01.csr.com> <20071214165524.GA13214@prunille.vinc17.org> <200712141745.lBEHjlvd017945@news01.csr.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <200712141745.lBEHjlvd017945@news01.csr.com>
X-Mailer-Info: http://www.vinc17.org/mutt/
User-Agent: Mutt/1.5.17-vl-r19795 (2007-12-11)
X-Virus-Scanned: ClamAV using ClamSMTP

On 2007-12-14 17:45:47 +0000, Peter Stephenson wrote:
> We can probably add your stuff as an option; I'm a bit worried about
> forcing fcntl() locking on everybody willy nilly.

A runtime option would be the best solution. On the NFS server here,
fcntl locking sometimes no longer works (probably because the lockd
daemon has crashed), though in general, the NFS server completely
crashes a few hours later. A runtime option would allow ones to work
in a degraded mode.

>  This probably needs to wait till after 4.3.5 otherwise that will
> never get out at this rate.

OK.

> It's possible there's an overagressive test for a write failure; I added
> some more after reports of problems.  You might be able to track down
> where this is coming from fairly easily.

I'll try to look at it.

-- 
Vincent Lefèvre <vincent@vinc17.org> - Web: <http://www.vinc17.org/>
100% accessible validated (X)HTML - Blog: <http://www.vinc17.org/blog/>
Work: CR INRIA - computer arithmetic / Arenaire project (LIP, ENS-Lyon)

