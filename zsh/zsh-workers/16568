From zsh-workers-return-16568-mason-zsh=primenet.com.au@sunsite.dk Tue Feb 05 18:09:04 2002
Return-Path: <zsh-workers-return-16568-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2914 invoked from network); 5 Feb 2002 18:09:03 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 5 Feb 2002 18:09:03 -0000
Received: (qmail 24341 invoked by alias); 5 Feb 2002 18:08:56 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16568
Received: (qmail 24328 invoked from network); 5 Feb 2002 18:08:55 -0000
Date: Tue, 5 Feb 2002 13:08:50 -0500
From: Clint Adams <clint@zsh.org>
To: Oliver Kiddle <okiddle@yahoo.co.uk>
Cc: zsh-workers@sunsite.dk, david@debian.org
Subject: Re: PATCH: _ssh (scp)
Message-ID: <20020205180850.GA2743@dman.com>
References: <20020204175927.GA12977@dman.com> <20020205102420.39912.qmail@web9304.mail.yahoo.com> <20020205174702.GA2325@dman.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20020205174702.GA2325@dman.com>
User-Agent: Mutt/1.3.25i

> ls -a1F /dir (thereby getting all the dotfiles and potentially
> respecting the local setting of GLOB_DOTS)
> or
> ls -d1F /dir/* (thereby respecting the remote setting of GLOB_DOTS or
> equivalent)

I opted for the latter, but it doesn't quite work.

3.0.8% SLASH=/
3.0.8% print $SLASH
/
3.0.8% print $SLASH:h
/

4.0.4% SLASH=/
4.0.4% print $SLASH
/
4.0.4% print $SLASH:h
.

Was this change intentional?

Index: Completion/Unix/Command/_ssh
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_ssh,v
retrieving revision 1.8
diff -u -r1.8 _ssh
--- Completion/Unix/Command/_ssh	2002/02/05 18:03:26	1.8
+++ Completion/Unix/Command/_ssh	2002/02/05 18:05:04
@@ -5,13 +5,7 @@
   local expl remfiles remdispf remdispd
 
   if zstyle -T ":completion:${curcontext}:" remote-access; then
-    if [[ $options[globdots] == "on" ]] && [[ "$PREFIX" == */ || -z "$PREFIX" ]];
-    then
-      print ssh -a -x ${words[CURRENT]%:*} ls -a1F ${words[CURRENT]#*:}
-      remfiles=(${(f)"$(ssh -a -x ${words[CURRENT]%:*} ls -a1F ${words[CURRENT]#*:} 2>/dev/null)"})
-    else
-      remfiles=(${(f)"$(ssh -a -x ${words[CURRENT]%:*} ls -d1F ${words[CURRENT]#*:}\* 2>/dev/null)"})
-    fi
+    remfiles=(${(f)"$(ssh -a -x ${words[CURRENT]%:*} ls -d1F ${${${words[CURRENT]#*:}:h}/\\/(#e)/}/\* 2>/dev/null)"})
 
     remdispf=(${remfiles:#*/})
     remdispd=(${(M)remfiles:#*/})

