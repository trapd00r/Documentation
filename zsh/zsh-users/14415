From zsh-users-return-14415-mason-zsh=primenet.com.au@sunsite.dk Mon Sep 21 13:55:04 2009
Return-Path: <zsh-users-return-14415-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25821 invoked from network); 21 Sep 2009 13:54:51 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 21 Sep 2009 13:54:51 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 18081 invoked from network); 21 Sep 2009 13:54:39 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 21 Sep 2009 13:54:38 -0000
Received: (qmail 1190 invoked by alias); 21 Sep 2009 13:54:30 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 14415
Received: (qmail 1177 invoked from network); 21 Sep 2009 13:54:30 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 21 Sep 2009 13:54:30 -0000
Received: from mail-fx0-f220.google.com (mail-fx0-f220.google.com [209.85.220.220])
	by bifrost.dotsrc.org (Postfix) with ESMTP id A8F29804CE03
	for <zsh-users@sunsite.dk>; Mon, 21 Sep 2009 15:54:23 +0200 (CEST)
Received: by fxm20 with SMTP id 20so2153521fxm.38
        for <zsh-users@sunsite.dk>; Mon, 21 Sep 2009 06:54:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=dyg+tN0bI6I/86/0qcnx9EkjopJQPjqaOGcyPNKo0Zk=;
        b=xYIlXA6IMk8exPc1oJWudpsbkwZtbJE+F+LMUjjpa6D/cP9Qa+varmRFoCi/2KgIbY
         LwT99zY7Xhe7+cpQbmDKVMoS/GrLpH7kD23SP/+KgSJjlWJzeQn2s/5S/QZzg/ljPwtD
         LjHt5Sz1oSTwve/roYkrEhjh3SdQmzaOA+ids=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=yDEODmARlMh0ygmAfBVqieKhSuDE1Ur1JZlKPF/5aRU2Ousf7JjVXktVp81XCUCbwk
         Bpb711YWfxzqyqgHoxbg9xUOhyjUMgmrqlGlLbYweiztlbkBV97NCvgLZUPTyHm08Gsr
         rIwD/7tMhKA/1bkeRTQyjC2e4NYyECj1Rb36c=
MIME-Version: 1.0
Received: by 10.204.32.13 with SMTP id a13mr431901bkd.22.1253541262438; Mon, 
	21 Sep 2009 06:54:22 -0700 (PDT)
In-Reply-To: <20090921134728.GA10174@fsst.voodoo.lan>
References: <20090921134728.GA10174@fsst.voodoo.lan>
Date: Mon, 21 Sep 2009 15:54:22 +0200
Message-ID: <237967ef0909210654i62d97df7nff45ad96c408db2@mail.gmail.com>
Subject: Re: _expand completer and hashed dirs
From: Mikael Magnusson <mikachu@gmail.com>
To: zsh-users@sunsite.dk
Content-Type: text/plain; charset=UTF-8
X-Virus-Scanned: ClamAV 0.94.2/9818/Mon Sep 21 05:27:45 2009 on bifrost
X-Virus-Status: Clean

2009/9/21 Frank Terbeck <ft@bewatermyfriend.org>:
> Hey list,
>
> Some time back I started using the _expand completer in my setup.
> And so far I like it.
>
> However, with hashed directories, I got a little problem I cannot seem
> to fix. Suppose, I got the following:
>
> hash -d vim=${HOME}/.vim
>
> While this works fine:
>
>    % ls ~vi<tab>
>    % ls ~vim/
>
> This doesn't:
>
>    % ls ~vim<tab>
>    - all expansions -
>    /home/hawk/.vim
>    - original -
>    ~vim
>
> I would much rather like to get 'ls ~vim/' out of it.
> I've been playing with a number of styles, but they don't seem to
> have any impact on the situation.
>
> Here's a minimal zshrc, to reproduce what I'm seeing:
>
> [snip]
> bindkey -e
> hash -d vim=${HOME}/.vim
> autoload -Uz compinit
> compinit
> zstyle ':completion:*:descriptions' format "- %d -"
> zstyle ':completion:*' group-name ''
> zstyle ':completion:*' completer _expand _complete _ignored _approximate
> [snap]
>
> Does anybody have a clue as to how to cure this?

You could try putting _expand after _complete, but maybe you won't
like what it does with other constructs then. (I'm guessing you
rebound ^I to complete-word rather than expand-or-complete). If that
doesn't do what you want, I think you'd have to use two different
keybinds for completing and expanding.

ie something like
zstyle ':completion:most-recent-file:*' match-original both
zstyle ':completion:most-recent-file:*' file-sort modification
zstyle ':completion:most-recent-file:*' file-patterns '*:all\ files'
zstyle ':completion:most-recent-file:*' hidden all
zstyle ':completion:most-recent-file:*' completer _files
zle -C most-recent-file menu-complete _generic
bindkey "^N"      most-recent-file

but not _files and another name for the completer would probably make sense :).

-- 
Mikael Magnusson

