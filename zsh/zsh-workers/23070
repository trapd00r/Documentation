From zsh-workers-return-23070-mason-zsh=primenet.com.au@sunsite.dk Tue Dec 19 11:45:17 2006
Return-Path: <zsh-workers-return-23070-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12490 invoked from network); 19 Dec 2006 11:45:12 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 19 Dec 2006 11:45:12 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 48960 invoked from network); 19 Dec 2006 11:45:05 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 19 Dec 2006 11:45:05 -0000
Received: (qmail 7788 invoked by alias); 19 Dec 2006 11:45:00 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23070
Received: (qmail 7779 invoked from network); 19 Dec 2006 11:44:59 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 19 Dec 2006 11:44:59 -0000
Received: (qmail 48431 invoked from network); 19 Dec 2006 11:44:59 -0000
Received: from cluster-c.mailcontrol.com (168.143.177.190)
  by a.mx.sunsite.dk with SMTP; 19 Dec 2006 11:44:55 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly12c.srv.mailcontrol.com (MailControl) with ESMTP id kBJBgDfe023041
	for <zsh-workers@sunsite.dk>; Tue, 19 Dec 2006 11:44:52 GMT
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Tue, 19 Dec 2006 11:41:59 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.8/8.13.4) with ESMTP id kBJBfu39030848
	for <zsh-workers@sunsite.dk>; Tue, 19 Dec 2006 11:41:56 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.8/8.13.8/Submit) with ESMTP id kBJBft8B030845
	for <zsh-workers@sunsite.dk>; Tue, 19 Dec 2006 11:41:56 GMT
Message-Id: <200612191141.kBJBft8B030845@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: PATCH: stop [[ -N file ]] test failing under NFS
Date: Tue, 19 Dec 2006 11:41:55 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 19 Dec 2006 11:41:59.0565 (UTC) FILETIME=[B188D3D0:01C72362]
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A-07-06-00 (www.mailcontrol.com) on 10.67.0.122

This is to prevent the perennial error in the test suite when using [[
-N file ]] under NFS because it doesn't store modification time and
access time separately.  The "-fstype nfs" test of find is widely enough
supported that we can use that (I've written it so we're no worse off if
it doesn't work).

Probably something similar would work on HFS+, but as is widely known we
don't have a Mac OS X expert.

Index: Test/C02cond.ztst
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/C02cond.ztst,v
retrieving revision 1.15
diff -u -r1.15 C02cond.ztst
--- Test/C02cond.ztst	2 Feb 2005 17:03:51 -0000	1.15
+++ Test/C02cond.ztst	19 Dec 2006 11:27:44 -0000
@@ -131,6 +131,9 @@
   if [[ $OSTYPE == "cygwin" ]]; then
     print -u8 "Warning: not testing [[ -N file ]] (not supported on Cygwin)"
     true
+  elif [[ "$(find . -prune -fstype nfs 2>/dev/null)" == "." ]]; then
+    print -u8 "Warning: not testing [[ -N file ]] (not supported with NFS)"
+    true
   else
     [[ -N newnewnew && ! -N unmodified ]]
   fi

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


To access the latest news from CSR copy this link into a web browser:  http://www.csr.com/email_sig.php

