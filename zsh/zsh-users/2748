From zsh-users-return-2748-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Nov 28 18:41:39 1999
Return-Path: <zsh-users-return-2748-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10886 invoked from network); 28 Nov 1999 18:41:39 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 28 Nov 1999 18:41:39 -0000
Received: (qmail 18588 invoked by alias); 28 Nov 1999 18:41:25 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 2748
Received: (qmail 18581 invoked from network); 28 Nov 1999 18:41:23 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <991128184113.ZM28661@candle.brasslantern.com>
Date: Sun, 28 Nov 1999 18:41:13 +0000
In-Reply-To: <19991128135255.A2371@one.sttr.net>
Comments: In reply to Stefan Troeger <stefan.troeger@wirtschaft.tu-chemnitz.de>
        "No `you have running jobs.' message" (Nov 28,  1:52pm)
References: <19991128135255.A2371@one.sttr.net>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Stefan Troeger <stefan.troeger@wirtschaft.tu-chemnitz.de>,
        zsh-users@sunsite.auc.dk
Subject: Re: No `you have running jobs.' message
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Nov 28,  1:52pm, Stefan Troeger wrote:
} Subject: No `you have running jobs.' message
}
} is it possible to turn of the `you have running jobs.' warning
} that pops up when exiting the shell while there are running
} background jobs and keep the `you have suspended jobs.' message?

No.  Suggested patch below; opinions from zsh-workers requested (please
follow-up to zsh-workers, not zsh-users).

The effect of this patch is that "setopt nohup" suppresses the "running
jobs" message.  Note that in 3.1.6-bart-8 and -pws-9, "unsetopt checkjobs"
suppresses both messages, no matter what the value of "nohup".

The change is smaller than the patch (lots of re-indented lines).

Index: Src/builtin.c
===================================================================
@@ -3159,22 +3159,25 @@
 {
     int i;
 
-    for (i = 1; i < MAXJOB; i++)
+    for (i = 1; i < MAXJOB; i++) {
 	if (i != thisjob && (jobtab[i].stat & STAT_LOCKED) &&
-	    !(jobtab[i].stat & STAT_NOPRINT))
-	    break;
-    if (i < MAXJOB) {
-	if (jobtab[i].stat & STAT_STOPPED) {
+	    !(jobtab[i].stat & STAT_NOPRINT)) {
+	    if (jobtab[i].stat & STAT_STOPPED) {
 
 #ifdef USE_SUSPENDED
-	    zerr("you have suspended jobs.", NULL, 0);
+		zerr("you have suspended jobs.", NULL, 0);
 #else
-	    zerr("you have stopped jobs.", NULL, 0);
+		zerr("you have stopped jobs.", NULL, 0);
 #endif
 
-	} else
-	    zerr("you have running jobs.", NULL, 0);
-	stopmsg = 1;
+		stopmsg = 1;
+	    } else if (isset(HUP)) {
+		zerr("you have running jobs.", NULL, 0);
+		stopmsg = 1;
+	    }
+	    if (stopmsg)
+		break;
+	}
     }
 }
 

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

