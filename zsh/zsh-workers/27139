From zsh-workers-return-27139-mason-zsh=primenet.com.au@sunsite.dk Sun Jul 12 19:35:49 2009
Return-Path: <zsh-workers-return-27139-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2148 invoked from network); 12 Jul 2009 19:35:36 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 12 Jul 2009 19:35:36 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 53569 invoked from network); 12 Jul 2009 19:35:25 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 12 Jul 2009 19:35:25 -0000
Received: (qmail 14723 invoked by alias); 12 Jul 2009 19:35:16 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 27139
Received: (qmail 14694 invoked from network); 12 Jul 2009 19:35:15 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 12 Jul 2009 19:35:15 -0000
Received: from mtaout02-winn.ispmail.ntl.com (mtaout02-winn.ispmail.ntl.com [81.103.221.48])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 3472B8027106
	for <zsh-workers@sunsite.dk>; Sun, 12 Jul 2009 21:35:12 +0200 (CEST)
Received: from aamtaout03-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout02-winn.ispmail.ntl.com
          (InterMail vM.7.08.04.00 201-2186-134-20080326) with ESMTP
          id <20090712193512.BEQR6611.mtaout02-winn.ispmail.ntl.com@aamtaout03-winn.ispmail.ntl.com>
          for <zsh-workers@sunsite.dk>; Sun, 12 Jul 2009 20:35:12 +0100
Received: from pws-pc.ntlworld.com ([81.107.42.185])
          by aamtaout03-winn.ispmail.ntl.com
          (InterMail vG.2.02.00.01 201-2161-120-102-20060912) with ESMTP
          id <20090712193511.OEKW2093.aamtaout03-winn.ispmail.ntl.com@pws-pc.ntlworld.com>
          for <zsh-workers@sunsite.dk>; Sun, 12 Jul 2009 20:35:11 +0100
Received: from pws-pc (pws-pc [127.0.0.1])
	by pws-pc.ntlworld.com (8.14.3/8.14.2) with ESMTP id n6CJZ5K0018519
	for <zsh-workers@sunsite.dk>; Sun, 12 Jul 2009 20:35:05 +0100
Message-Id: <200907121935.n6CJZ5K0018519@pws-pc.ntlworld.com>
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-workers@sunsite.dk
Subject: Re: non-interactive set -m
In-Reply-To: Message from Bart Schaefer <schaefer@brasslantern.com>
   of "Sun, 12 Jul 2009 11:28:01 PDT." <090712112801.ZM14389@torch.brasslantern.com>
Date: Sun, 12 Jul 2009 20:35:05 +0100
X-Cloudmark-Analysis: v=1.0 c=1 a=NLZqzBF-AAAA:8 a=bHEMpb0lq3_rKGZp7XEA:9 a=P84y0eClD497Jg88qDAA:7 a=NkuFlDtEVcLYRqQwkdz-MW-IQOgA:4 a=_dQi-Dcv4p4A:10
X-Virus-Scanned: ClamAV 0.94.2/9556/Sun Jul 12 17:03:47 2009 on bifrost
X-Virus-Status: Clean

Bart Schaefer wrote:
> POSIX doesn't specify whether the left or right side of a pipeline
> will run in the current shell, which means that with POSIX_JOBS set
> and this patch applied zsh will produce different results for the
> piping of "jobs" to something.  Since it's only been about a year (?)
> since we went through all the rigamarole of making "jobs" in a sub-
> shell have access to (a snapshot of) the parent's job table, it seems
> hasty to break that again even an as option.

It seems to me it should one thing or the other---either have job
control in the shell with its own separate job table, or report the
parent's.  A mixture is madness.

> Also look here:
> 
> $ sleep 30 &
> [1] 14341
> $ ( sleep 40 & jobs )
> [2] + Running              sleep 40 
> [1] - Running              sleep 30 
> $ 
> 
> Note that in pdksh the job in the subshell is added to the table of
> jobs inherited from the parent shell (testing with pdksh 5.2.14).

Yuk.  So you've got a real job you can manipulate, and one phantom job
from the parent shell you can't and which is presumably fixed like that
for eternity.  In other words, pdksh (unlike zsh) doesn't clear the job
table while keeping a copy of the parent's around, it just uses the same
job table.  This doesn't strike me as the right way to do it.

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

