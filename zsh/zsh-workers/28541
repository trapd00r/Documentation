From zsh-workers-return-28541-mason-zsh=primenet.com.au@zsh.org Mon Dec 20 17:16:07 2010
Return-Path: <zsh-workers-return-28541-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12406 invoked by alias); 20 Dec 2010 17:16:07 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28541
Received: (qmail 14252 invoked from network); 20 Dec 2010 17:15:54 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_LOW,
	SPF_HELO_PASS autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at csr.com does not designate permitted sender hosts)
X-Authentication-Warning: pwslap01u.europe.root.pri: pws owned process doing -bs
To: zsh-workers@zsh.org (Zsh hackers list)
Subject: make oddity
X-Mailer: MH-E 8.2; nmh 1.3; GNU Emacs 23.2.1
Date: Mon, 20 Dec 2010 17:15:47 +0000
Message-ID: <22105.1292865347@csr.com>
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 20 Dec 2010 17:15:48.0253 (UTC) FILETIME=[8B7E94D0:01CBA069]
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A_10_80_00 (www.mailcontrol.com) on 10.71.0.132

I had to work around a problem with make in releasing 4.3.11: in
previous releases 'make' from a clean directory performed the equivalent
of 'make prep' in the Src directory, this time it didn't.  I assume that
there's some dependency missing (the standard answer) and that the
timestamps of two files have somehow got out of order so some assumption
isn't valid any more.

Here's the change I committed to work around it (with a later change to
fix a minor unintentional slip with the phony files that it's not worth
updating the release for).  As it works well enough in practice I'm not
going to waste time on it, but maybe somebody can see more quickly than
I can why this step should have happened automatically in everything up to
4.3.10-test-3 but doesn't in the 4.3.11 release without the change.

Index: Makefile.in
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Makefile.in,v
retrieving revision 1.16
retrieving revision 1.18
diff -p -u -u -r1.16 -r1.18
--- Makefile.in	18 Dec 2010 23:03:20 -0000	1.16
+++ Makefile.in	20 Dec 2010 16:51:25 -0000	1.18
@@ -221,7 +221,10 @@ mostlyclean-modules clean-modules distcl
 
 install.modules uninstall.modules \
 modobjs modules headers proto $(MAIN_OBJS) zsh.export: Makemod
+	@if [ ! -f Builtins/Makefile.in ]; then \
+	   $(MAKE) prep; \
+	fi
 	@$(MAKE) -f Makemod $(MAKEDEFS) $@
-.PHONY: install.modules uninstall.modules
+.PHONY: install.modules uninstall.modules headers proto
 
 $(MAIN_OBJS): $(sdir)/zsh.h

-- 
Peter Stephenson <pws@csr.com>            Software Engineer
Tel: +44 (0)1223 692070                   Cambridge Silicon Radio Limited
Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, UK


Member of the CSR plc group of companies. CSR plc registered in England and Wales, registered number 4187346, registered office Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, United Kingdom

