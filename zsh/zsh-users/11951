From zsh-users-return-11951-mason-zsh=primenet.com.au@sunsite.dk Sun Oct 07 23:56:01 2007
Return-Path: <zsh-users-return-11951-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1326 invoked from network); 7 Oct 2007 23:55:54 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,SPF_HELO_PASS
	autolearn=ham version=3.2.3
Received: from ns2.primenet.com.au (HELO primenet.com.au) (@203.24.36.3)
  by ns1.primenet.com.au with (DHE-RSA-AES256-SHA encrypted) SMTP; 7 Oct 2007 23:55:54 -0000
Received: (qmail 12439 invoked from network); 7 Oct 2007 23:29:10 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by proxy.melb.primenet.com.au with SMTP; 7 Oct 2007 23:29:10 -0000
Received-SPF: none (proxy.melb.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 43418 invoked from network); 7 Oct 2007 23:28:03 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 Oct 2007 23:28:03 -0000
Received: (qmail 10691 invoked by alias); 7 Oct 2007 23:27:53 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11951
Received: (qmail 10633 invoked from network); 7 Oct 2007 23:27:52 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 7 Oct 2007 23:27:52 -0000
Received: (qmail 41724 invoked from network); 7 Oct 2007 23:27:52 -0000
Received: from atom.smasher.org (69.55.237.145)
  by a.mx.sunsite.dk with SMTP; 7 Oct 2007 23:27:46 -0000
Received: (qmail 18529 invoked by uid 1000); 7 Oct 2007 23:27:45 -0000
Message-ID: <20071007232744.18528.qmail@smasher.org>
Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed
Date: Mon, 8 Oct 2007 12:27:37 +1300 (NZDT)
From: Atom Smasher <atom@smasher.org>
In-Reply-To: <071007103242.ZM23816@torch.brasslantern.com>
MIME-Version: 1.0
OpenPGP: id=0xB88D52E4D9F57808; algo=1 (RSA); size=4096; url=http://atom.smasher.org/pgp.txt
References: <20071007103407.33577.qmail@smasher.org>
 <071007103242.ZM23816@torch.brasslantern.com>
Subject: Re: PROMPT escape sequences
To: zsh-users@sunsite.dk
X-POM: The Moon is Waning Crescent (10% of Full)
X-Hashcash: 1:20:0710072327:zsh-users@sunsite.dk::0shPfSBI9WhjY5qW:0000000000000
	0000000000000000000000008hdc

On Sun, 7 Oct 2007, Bart Schaefer wrote:

> So the answer to this question is:
>
> } is there a way to set a color at the prompt that doesn't reset to default
> } when i tab-complete?
>
> No, there isn't, because you're relying on the entire prompt being re- 
> painted every time zsh needs to redraw the line that begins with the 
> prompt, but ZLE is optimized to use cursor motions and only redraw the 
> bits of the line that actually need changing.  It has no idea what the 
> color settings are at any given position on the terminal, so it can't 
> restore color; it only knows what the non-zero-width characters are.
===================

this gets me very close:


expand-or-complete () {
     PREDISPLAY=${fg[cyan]}
     zle .expand-or-complete
}
zle -N expand-or-complete


but it doesn't output any escape characters... just the text string 
"^[[36m" as if there's an implied ${(V)fg[cyan]}. what do i need to do to 
make that output a literal escape sequence? why doesn't it work that way 
by default?

i also tried including "reset-prompt" within the redefined 
"expand-or-complete", but didn't have any luck with that. i thought that 
in re-displaying the prompt, it would also re-colorize the text typed at 
the prompt, but apparently it doesn't.


-- 
         ...atom

  ________________________
  http://atom.smasher.org/
  762A 3B98 A3C3 96C9 C6B7 582A B88D 52E4 D9F5 7808
  -------------------------------------------------

 	"I never did give them hell. I just told the truth,
 	 and they thought it was hell."
 		-- Harry S Truman, 3 Apr 1956


