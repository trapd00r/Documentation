From zsh-workers-return-8030-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Sep 23 14:08:03 1999
Return-Path: <zsh-workers-return-8030-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8088 invoked from network); 23 Sep 1999 14:07:54 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 23 Sep 1999 14:07:54 -0000
Received: (qmail 5750 invoked by alias); 23 Sep 1999 14:07:35 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8030
Received: (qmail 5733 invoked from network); 23 Sep 1999 14:07:28 -0000
Date: Thu, 23 Sep 1999 16:07:21 +0200 (MET DST)
Message-Id: <199909231407.QAA24734@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 23 Sep 1999 22:57:30 +0900
Subject: Re: Chatty little precompiler for _arguments


Tanaka Akira wrote:

> In article <199909230913.LAA23608@beta.informatik.hu-berlin.de>,
>   Sven Wischnowsky <wischnow@informatik.hu-berlin.de> writes:
> 
> > The longest string a character can be quoted to is three characters...
> 
> It's not longest, in current implementation at least.
> 
> Z:akr@is27e1u11% Src/zsh -f
> is27e1u11% a="'''''''''''"
> is27e1u11% print -lr - ${(qq)a}
> zsh: segmentation fault (core dumped)  Src/zsh -f
> Z:akr@is27e1u11% 

Ouch.

Bye
 Sven

--- os/utils.c	Thu Sep 23 12:30:20 1999
+++ Src/utils.c	Thu Sep 23 16:05:22 1999
@@ -2976,7 +2976,7 @@
 {
     const char *u, *tt;
     char *v;
-    char *buf = ncalloc(3 * strlen(s) + 1);
+    char *buf = ncalloc(4 * strlen(s) + 1);
     int sf = 0;
 
     tt = v = buf;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

