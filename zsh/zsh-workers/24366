From zsh-workers-return-24366-mason-zsh=primenet.com.au@sunsite.dk Mon Jan 07 19:22:47 2008
Return-Path: <zsh-workers-return-24366-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25078 invoked from network); 7 Jan 2008 19:22:38 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-3.3 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 7 Jan 2008 19:22:38 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 81078 invoked from network); 7 Jan 2008 19:22:28 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 Jan 2008 19:22:28 -0000
Received: (qmail 21643 invoked by alias); 7 Jan 2008 19:22:24 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24366
Received: (qmail 21630 invoked from network); 7 Jan 2008 19:22:24 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 7 Jan 2008 19:22:24 -0000
Received: from virusfilter.dotsrc.org (bifrost [127.0.0.1])
	by spamfilter.dotsrc.org (Postfix) with ESMTP id 21ED68058FF2
	for <zsh-workers@sunsite.dk>; Mon,  7 Jan 2008 20:22:21 +0100 (CET)
Received: from uucp.gnuu.de (banki.eumelnet.de [83.246.114.63])
	by bifrost.dotsrc.org (Postfix) with ESMTP
	for <zsh-workers@sunsite.dk>; Mon,  7 Jan 2008 20:22:19 +0100 (CET)
Received: by uucp.gnuu.de (Postfix, from userid 10)
	id BF48848807A; Mon,  7 Jan 2008 20:22:18 +0100 (CET)
Received: from news by alea.gnuu.de with local (Exim 4.63)
	(envelope-from <news@alea.gnuu.de>)
	id 1JBvx1-0006sx-OX
	for zsh-workers@sunsite.dk; Mon, 07 Jan 2008 18:39:51 +0100
To: zsh-workers@sunsite.dk
Path: not-for-mail
From: =?UTF-8?Q?J=C3=B6rg?= Sommer <joerg@alea.gnuu.de>
Newsgroups: local.mailinglist.zsh
Subject: Segfault with newer .zwc
Date: Mon, 7 Jan 2008 17:39:51 +0000 (UTC)
Lines: 55
Message-ID: <slrnfo4ov7.cgh.joerg@alea.gnuu.de>
Mime-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
X-Trace: alea.gnuu.de 1199727591 26469 192.168.0.5 (7 Jan 2008 17:39:51 GMT)
X-Complaints-To: usenet@alea.gnuu.de
User-Agent: slrn/pre0.9.9-75 (Debian)
Sender: news <news@alea.gnuu.de>
X-Virus-Scanned: ClamAV using ClamSMTP

Hi,

I've built a zwc with “zcompile .zshrc” from the zsh-beta package in
Debian (last Changelog entry is 2007-12-27). When using this file with
zsh from the zsh package (last Changelog entry is 2007-12-20) it crashes.
I can start with this file, but accessing an alias defined in this file
the shell segfaults.

Further tests should it is much more tricky. My .zshrc and .zshenv are at
http://www.minet.uni-jena.de/~joergs/zshrc
http://www.minet.uni-jena.de/~joergs/zshenv
Starting zsh-beta as *normal* user compiles the .zshrc.zwc and
.zshenv.zwc. Starting then zsh as *root* and running agi test crashes the
shell.

I think the problem is this part:
    agi()
    {
        local rc=0
        ag install $@ || rc=$?
        check-etc
        deborphan
        return $rc
    }
    alias agi='noglob agi'

While this works don't doing that above, it creates a loop in the above
situation. gdb shows 1526 stack frames and repeats the following:

#1508 0x10027500 in execlist ()
#1509 0x100276cc in execode ()
#1510 0x10027834 in runshfunc ()
#1511 0x10027c70 in doshfunc ()
#1512 0x10025bf0 in ?? ()
#1513 0x10026124 in ?? ()
#1514 0x1002662c in ?? ()
#1515 0x10027500 in execlist ()
#1516 0x100276cc in execode ()
#1517 0x10027834 in runshfunc ()
#1518 0x10027c70 in doshfunc ()
#1519 0x10025bf0 in ?? ()
#1520 0x10026124 in ?? ()
#1521 0x1002662c in ?? ()
#1522 0x10027174 in execlist ()
#1523 0x100276cc in execode ()
#1524 0x1003a4b0 in loop ()
#1525 0x1003b3a4 in zsh_main ()
#1526 0x1000dc10 in main ()

Or is gdb broken?

Bye, Jörg.
-- 
Nichts ist so langweilig, wie die Wiederholung seinerselbst.
                                        (Marcel Reich‐Ranicki)

