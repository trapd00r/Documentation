From zsh-workers-return-28656-mason-zsh=primenet.com.au@zsh.org Wed Jan 26 08:48:58 2011
Return-Path: <zsh-workers-return-28656-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28760 invoked by alias); 26 Jan 2011 08:48:58 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28656
Received: (qmail 17650 invoked from network); 26 Jan 2011 08:48:45 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_NONE,
	SPF_HELO_PASS autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at bewatermyfriend.org does not designate permitted sender hosts)
From: Frank Terbeck <ft@bewatermyfriend.org>
To: Julien Nicoulaud <julien.nicoulaud@gmail.com>
Cc: cheer_xiao <xiaqqaix@gmail.com>,  zsh-workers@zsh.org
Subject: Re: Slow completion when using aptitude
In-Reply-To: <AANLkTinYiKLp11GTOKaMb_8BTPKvjP+U6won9V4BFHxk@mail.gmail.com>
	(Julien Nicoulaud's message of "Wed, 26 Jan 2011 08:51:45 +0100")
References: <AANLkTimtzJnpA=_QQgz4bSYZEjHydCSh6PLMKzFtwueS@mail.gmail.com>
	<AANLkTimYBY7nA_FCXTA8n-ukYwBxnobmoUNowJ6kxaGz@mail.gmail.com>
	<AANLkTikAKmnTt+9o5ibUGevk+m=rZJg9WrxV1WP+hX6w@mail.gmail.com>
	<AANLkTinYiKLp11GTOKaMb_8BTPKvjP+U6won9V4BFHxk@mail.gmail.com>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
Date: Wed, 26 Jan 2011 09:35:33 +0100
Message-ID: <87oc74dpuy.fsf@ft.bewatermyfriend.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Df-Sender: 430444

Julien Nicoulaud wrote:
> Same here.

+ Fullquote? :)

> 2011/1/26 cheer_xiao <xiaqqaix@gmail.com>
>
>> On Wed, Jan 19, 2011 at 8:33 PM, Richard Hartmann
>> <richih.mailinglist@gmail.com> wrote:
[...]
>> >> And another small related issue: the command tab-completion of zsh
>> >> doesn't seem to know aptitude build-dep, which has been around for a
>> >> few years but (unfortunately) undocumented.
[...]

It does know `build-dep' for a while now; it was first introduced here:
    <http://www.zsh.org/mla/workers/2009/msg00193.html>


>> Thanks for your attention. I posted this to zsh-workers because I
>> found it weird enough to be very likely a bug in source code. Could
>> you tell me if you are having performance problem with aptitude
>> tab-complete? Also, let me describe my problems in more detail.
>>
>> If I type "sudo apt-get install a" and hit Tab, I only get a short
>> (yet noticeable) delay of about one second. But when I type "sudo
>> aptitude install a" and hit Tab, zsh freezes, one of the CPU cores get
>> 100% loaded. It will recover after some 10 seconds. However after
>> this, the tab-completion of aptitude is as quick as apt-get's, until I
>> log out of zsh.

_aptitude does more than _apt-get. If the second <tab> doesn't take as
long as the first, you probably got caching enabled via zstyle.

>> I am using the version from git repo:
>>
>> xiaq@~> zsh --version
>> zsh 4.3.11-dev-1 (i686-pc-linux-gnu)
>>
>> and my system:
>>
>> xiaq@~> uname -a
>> Linux xxx 2.6.32-28-generic #55-Ubuntu SMP Mon Jan 10 21:21:01 UTC
>> 2011 i686 GNU/Linux
>>
>> After typing "sudo aptitude" and hitting Tab, the output is (build-dep
>> is absent):
>>
>> xiaq@~> sudo aptitude
>> autoclean                 -- erase old downloaded package files
>> changelog                 -- view a package's changelog

My installation is also from the git repo:

[snip]
% uname -srm
Linux 2.6.32-5-686 i686

% print $ZSH_VERSION
4.3.11-dev-1

% print $ZSH_PATCHLEVEL
1.5174

% sudo aptitude <tab>
- aptitude command -
autoclean                      -- erase old downloaded package files.
build-dep                      -- install the build-dependencies of packages.
changelog                      -- view a package's changelog.
[snip]

Are you sure you don't have two competing versions of zsh installed?
Then it may be possible that "print $ZSH_VERSION" and "zsh --version"
would yield different results.

Regards, Frank

-- 
In protocol design, perfection has been reached not when there is
nothing left to add, but when there is nothing left to take away.
                                                  -- RFC 1925

