From zsh-workers-return-13433-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 07 02:58:23 2001
Return-Path: <zsh-workers-return-13433-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4657 invoked from network); 7 Feb 2001 02:58:22 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 7 Feb 2001 02:58:22 -0000
Received: (qmail 14278 invoked by alias); 7 Feb 2001 02:58:11 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13433
Received: (qmail 14266 invoked from network); 7 Feb 2001 02:58:09 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010207025802.ZM20171@candle.brasslantern.com>
Date: Wed, 7 Feb 2001 02:58:02 +0000
In-Reply-To: <1010206202315.ZM4635@candle.brasslantern.com>
Comments: In reply to "Bart Schaefer" <schaefer@candle.brasslantern.com>
        "zregexparse.ztst fails with latest CVS" (Feb  6,  8:23pm)
References: <1010206202315.ZM4635@candle.brasslantern.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.dk
Subject: 53completion.ztst (Re: zregexparse.ztst fails with latest CVS)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Feb 6,  8:23pm, Bart Schaefer wrote:
} Subject: zregexparse.ztst fails with latest CVS
}
} It goes into an infinite loop getting an I/O error on read, according to
} strace.  This is with the standard default dynamic linkage.

This is on linux, redhat 5.2; sorry for not mentioning it sooner.

It's not the zregexparse test, it's the completion test.

With ZTST_verbose=1, I get to:

...
../../zsh-3.1.6/Test/52zregexparse.ztst: all tests successful.
Running test: directories and files

and then it hangs forever.  It appears that the zsh started on the zpty
slave has died, leaving zpty in a read loop getting I/O error.

A statically linked zsh passes all tests successfully.

I noticed that "make clean" doesn't remove the module .so files, so I
explicitly blew them away and rebuilt.  Makes no difference.

Tricking comptest into attaching an strace to the zsh on the pty, I find
this (after reams of output):

10480 open("/usr/src/local/zsh/zsh-3.1.6-dynamic/Test/../../zsh-3.1.6/Test/../Completion/Core/_setup", O_RDONLY|O_NOCTTY) = 7
10480 lseek(7, 0, SEEK_END)             = 1941
10480 lseek(7, 0, SEEK_SET)             = 0
10480 read(7, "#autoload\n\nlocal val nm=\"$com"..., 1941) = 1941
10480 close(7)                          = 0
10480 sigprocmask(SIG_BLOCK, [CHLD], [CHLD]) = 0
10480 sigprocmask(SIG_BLOCK, [CHLD], [CHLD]) = 0
10480 sigprocmask(SIG_UNBLOCK, [CHLD], [CHLD]) = 0
10480 sigprocmask(SIG_BLOCK, [CHLD], []) = 0
10480 sigprocmask(SIG_BLOCK, [CHLD], [CHLD]) = 0
10480 sigprocmask(SIG_BLOCK, [CHLD], [CHLD]) = 0
10480 sigprocmask(SIG_UNBLOCK, [CHLD], [CHLD]) = 0
10480 sigprocmask(SIG_BLOCK, [CHLD], []) = 0
10480 --- SIGSEGV (Segmentation fault) ---
10480 +++ killed by SIGSEGV +++

I was able to locate the core file, here's a partial stack trace:

(gdb) where 
#0  0x1d42 in ?? ()
#1  0x808a3a8 in dyn_boot_module (m=0x80d6fa0)
    at ../../zsh-3.1.6/Src/module.c:625
#2  0x808a525 in boot_module (m=0x80d6fa0) at ../../zsh-3.1.6/Src/module.c:677
#3  0x808b263 in load_module (name=0x80de630 "zsh/complist")
    at ../../zsh-3.1.6/Src/module.c:846


-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

