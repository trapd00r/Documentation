From zsh-workers-return-27236-mason-zsh=primenet.com.au@sunsite.dk Fri Aug 28 15:11:32 2009
Return-Path: <zsh-workers-return-27236-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26022 invoked from network); 28 Aug 2009 15:11:19 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 28 Aug 2009 15:11:19 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 44854 invoked from network); 28 Aug 2009 15:11:14 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Aug 2009 15:11:14 -0000
Received: (qmail 5697 invoked by alias); 28 Aug 2009 15:11:10 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 27236
Received: (qmail 5683 invoked from network); 28 Aug 2009 15:11:10 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 28 Aug 2009 15:11:10 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [208.87.233.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 52CB480450A0
	for <zsh-workers@sunsite.dk>; Fri, 28 Aug 2009 17:11:02 +0200 (CEST)
Received: from rly17g.srv.mailcontrol.com (localhost.localdomain [127.0.0.1])
	by rly17g.srv.mailcontrol.com (MailControl) with ESMTP id n7SFAnp6012412
	for <zsh-workers@sunsite.dk>; Fri, 28 Aug 2009 16:10:52 +0100
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by rly17g.srv.mailcontrol.com (MailControl) id n7SF9oZR007423
	for <zsh-workers@sunsite.dk>; Fri, 28 Aug 2009 16:09:50 +0100
Received: from dalamsexb02.AMERICAS.ROOT.PRI ([65.208.56.47])
	by rly17g-eth0.srv.mailcontrol.com (envelope-sender <Peter.Stephenson@csr.com>) (MIMEDefang) with ESMTP id n7SF9ciN006797; Fri, 28 Aug 2009 16:09:47 +0100 (BST)
Received: from SJOAMSEXB01.AMERICAS.ROOT.PRI ([10.110.12.58]) by dalamsexb02.AMERICAS.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Fri, 28 Aug 2009 10:08:31 -0500
Received: from cameurexb01.EUROPE.ROOT.PRI ([10.100.137.61]) by SJOAMSEXB01.AMERICAS.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Fri, 28 Aug 2009 08:08:29 -0700
Received: from news01 ([10.99.50.25]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Fri, 28 Aug 2009 16:08:27 +0100
Date: Fri, 28 Aug 2009 16:08:27 +0100
From: Peter Stephenson <pws@csr.com>
To: "Zsh Hackers' List" <zsh-workers@sunsite.dk>
Cc: Aaron Davies <aaron.davies@gmail.com>
Subject: Re: CPPFLAGS Ignored?
Message-ID: <20090828160827.1b9867aa@news01>
In-Reply-To: <94CA6876-4CF1-4547-B8FC-5CFDC2F14A37@gmail.com>
References: <94CA6876-4CF1-4547-B8FC-5CFDC2F14A37@gmail.com>
Organization: CSR
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.8; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 28 Aug 2009 15:08:27.0864 (UTC) FILETIME=[65997D80:01CA27F1]
X-Scanned-By: MailControl A-09-22-00 (www.mailcontrol.com) on 10.71.1.127
X-Virus-Scanned: ClamAV 0.94.2/9757/Fri Aug 28 15:16:44 2009 on bifrost
X-Virus-Status: Clean

On Wed, 19 Aug 2009 11:57:17 +0800
Aaron Davies <aaron.davies@gmail.com> wrote:
> There are several places in configure and make where bare $CPP
> commands are issued without including flags (signal.h, error.h, etc.).
> Is there a reason foe this, or is it just really rare to have the
> entire include tree relocated?

I don't think there's a reason, but nobody's ever complained.  I've tried
the following locally and nothing horrible happened, but then I don't think
there's anything horrible to happen locally...

Index: configure.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.ac,v
retrieving revision 1.126
diff -u -r1.126 configure.ac
--- configure.ac	30 May 2009 22:28:50 -0000	1.126
+++ configure.ac	28 Aug 2009 15:05:46 -0000
@@ -1345,7 +1345,7 @@
 dnl The backslash substitution is to persuade cygwin to cough up
 dnl slashes rather than doubled backslashes in the path.
 echo "#include <signal.h>" > nametmp.c
-sigfile_list="`$CPP nametmp.c |
+sigfile_list="`$CPP $CPPFLAGS nametmp.c |
 sed -n -e 's/^#line[ 	].*\"\(.*\)\"/\1/p' \
        -e 's/^#[ 	].*\"\(.*\)\"/\1/p' |
 sed 's/\\\\\\\\/\//g' |
@@ -1393,7 +1393,7 @@
 dnl The backslash substitution is to persuade cygwin to cough up
 dnl slashes rather than doubled backslashes in the path.
 echo "#include <errno.h>" > nametmp.c
-errfile_list="`$CPP nametmp.c |
+errfile_list="`$CPP $CPPFLAGS nametmp.c |
 sed -n -e 's/^#line[ 	].*\"\(.*\)\"/\1/p' \
        -e 's/^#[ 	0-9].*\"\(.*\)\"/\1/p' |
 sed 's/\\\\\\\\/\//g' |
@@ -1462,7 +1462,7 @@
   echo "#include <$zsh_cv_path_curses_header>" >nametmp.c
 fi
 
-curses_list="`$CPP nametmp.c |
+curses_list="`$CPP $CPPFLAGS nametmp.c |
 sed -n -e 's/^#line[ 	].*\"\(.*\)\"/\1/p' \
        -e 's/^#[ 	0-9].*\"\(.*\)\"/\1/p' |
 sed 's/\\\\\\\\/\//g' |
@@ -1584,7 +1584,7 @@
 [dnl Look at the output from the preprocessor.
 dnl Copied from the search for the signal names above.
 echo "#include <sys/resource.h>" >restmp.c
-resourcefile_list="`$CPP restmp.c |
+resourcefile_list="`$CPP $CPPFLAGS restmp.c |
 sed -n -e 's/^#line[ 	].*\"\(.*\)\"/\1/p' \
        -e 's/^#[ 	].*\"\(.*\)\"/\1/p' |
 sed 's/\\\\\\\\/\//g' |


-- 
Peter Stephenson <pws@csr.com>            Software Engineer
Tel: +44 (0)1223 692070                   Cambridge Silicon Radio Limited
Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, UK


Member of the CSR plc group of companies. CSR plc registered in England and Wales, registered number 4187346, registered office Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, United Kingdom

