From zsh-users-return-11305-mason-zsh=primenet.com.au@sunsite.dk Thu Mar 15 10:45:02 2007
Return-Path: <zsh-users-return-11305-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26159 invoked from network); 15 Mar 2007 10:44:57 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.8 (2007-02-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO
	autolearn=ham version=3.1.8
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 15 Mar 2007 10:44:57 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 71389 invoked from network); 15 Mar 2007 10:44:50 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 15 Mar 2007 10:44:50 -0000
Received: (qmail 8183 invoked by alias); 15 Mar 2007 10:44:41 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11305
Received: (qmail 8174 invoked from network); 15 Mar 2007 10:44:41 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 15 Mar 2007 10:44:41 -0000
Received: (qmail 70204 invoked from network); 15 Mar 2007 10:44:41 -0000
Received: from esacom89-ext.esoc.esa.int (HELO esacom89-int.esoc.esa.int) (131.176.86.4)
  by a.mx.sunsite.dk with SMTP; 15 Mar 2007 10:44:29 -0000
Received: from esacom53.esoc.esa.int (131-176-86-254.esoc.esa.int [131.176.86.254])
	by esacom89-int.esoc.esa.int (8.13.3/8.13.3/ESA-External-v4.0) with ESMTP id l2FAiMUQ009547;
	Thu, 15 Mar 2007 10:44:22 GMT
Received: from dcle12.dev.esoc.esa.int (dcle12.dev.esoc.esa.int [131.176.58.71])
	by esacom53.esoc.esa.int (8.12.10/8.12.10/ESA-Internal-v3.2) with ESMTP id l2FAiGDb027047;
	Thu, 15 Mar 2007 10:44:16 GMT
Received: from dcle12 (localhost [127.0.0.1])
	by dcle12.dev.esoc.esa.int (8.13.6+Sun/8.13.6) with ESMTP id l2FAiGUY017510;
	Thu, 15 Mar 2007 10:44:16 GMT
cc: zsh-users@sunsite.dk
In-reply-to: <fb3648c60703142111g5407c97v9473b00ccf3d7ce8@mail.gmail.com>
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <fb3648c60703142111g5407c97v9473b00ccf3d7ce8@mail.gmail.com>
To: fREW <frioux@gmail.com>
Subject: Re: Macro's
Date: Thu, 15 Mar 2007 11:44:16 +0100
Message-ID: <17509.1173955456@dcle12>

fREW wrote:
> I was reading the book From Bash to Z Shell and it mentioned that
> macros are possible with Bash but not zsh, so I did a search on Google
> and found a patch for readline style macros that had been submitted
> just shy of TEN YEARS ago.  Is there any possibility that such a
> feature still may be added?  Or will it have to be either a hack or
> too much reworking to happen?

It's the sort of thing that can be written as a custom editor command
(see chapter 14).

As a very quick attempt to make something work, try the following:
  start-kbd-macro() {
    local macro
    while
      read -k 1
    [[ $REPLY != \) ]] || (( ##$macro[-1] != 24 )); do
      macro+="$REPLY"
    done
    bindkey -s '^Xe' "$macro[1,-2]"
  }
  zle -N start-kbd-macro
  bindkey '^X)' start-kbd-macro

This can be improved in many ways. It doesn't pass the keys pressed on
to the line editor so they don't work as you record the macro. It
doesn't display a message to tell you that macro recording is in
progress. It has also hard coded the key for ending macro recording.

Oliver

