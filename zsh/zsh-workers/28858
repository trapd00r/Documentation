From zsh-workers-return-28858-mason-zsh=primenet.com.au@zsh.org Sat Mar 05 00:54:00 2011
Return-Path: <zsh-workers-return-28858-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23230 invoked by alias); 5 Mar 2011 00:53:59 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28858
Received: (qmail 4827 invoked from network); 5 Mar 2011 00:53:57 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-4.3 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,RCVD_IN_DNSWL_MED autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at spodhuis.org does not designate permitted sender hosts)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; d=spodhuis.org; s=d200912;
	h=Content-Type:MIME-Version:Message-ID:Subject:To:From:Date; bh=PU7hA9914aZHFBmIjNBDVMXBOZH+cIsDqd0dcVZK4TQ=;
	b=BBYQFQR2kMRlH602IH5+gpPkHortuHmYCXzGLcg/7TEz1NpDhR3kc/Vt6lyVAJKi6uuxlr60TJfNzn9mot78jOOmPSKicDX14dm8UFCGYAoj1J4ivtE0Cr2j0uyV2J1rBbAW0oEAhgOWJim1D4a6MeRaYhXRzaxJMHc8TUDPLAU=;
Date: Fri, 4 Mar 2011 19:37:34 -0500
From: Phil Pennock <zsh-workers+phil.pennock@spodhuis.org>
To: zsh-workers@zsh.org
Subject: zcompile dir oddity with unmatched `
Message-ID: <20110305003734.GA26518@redoubt.spodhuis.org>
Mail-Followup-To: zsh-workers@zsh.org
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

I was working on a prompt adjustment, ran zsh, got:
% zsh
update_zcompile_dirs:14: unmatched `
update_zcompile_dirs:zcompile:4: can't read file: /home/pdp/bin/zsh-funcs

Okay, reduce to:
% zcompile /home/pdp/bin/zsh-funcs 
zsh: unmatched `
zcompile: can't read file: /home/pdp/bin/zsh-funcs

Moved new functions out of dir, no difference.

% cd ~/bin
% mkdir N
% zcompile N
% for f in zsh-funcs/*; do print $f; cp $f N; zcompile N; done 
[ 8 items go in, before a problem, which then disappears with the 9th
  item; reappears with 23rd item, disappears again ]
% zcompile N
% diff -ur zsh-funcs N
Only in zsh-funcs: .svn
% cp -pR zsh-funcs/.svn N
% zcompile N
% diff -ur zsh-funcs N
% zcompile N          
% zcompile zsh-funcs 
zsh: unmatched `
zcompile: can't read file: zsh-funcs
% mv zsh-funcs zsh-funcs-X
% mv N zsh-funcs
% zcompile zsh-funcs
% zcompile zsh-funcs-X
zsh: unmatched `
zcompile: can't read file: zsh-funcs-X
%

In the middle there, I updated system zsh from 4.3.10 to 4.3.11 and it
had no impact.

% fgrep -r '`' zsh-funcs
zsh-funcs/fix-home-svn-perms:   if ! test ".`/bin/pwd`" = ".$master_dir"
zsh-funcs/.svn/text-base/fix-home-svn-perms.svn-base:   if ! test ".`/bin/pwd`" = ".$master_dir"
%

Something hinky; I don't have time to investigate further right now, so
throwing this out in case someone else has seen this and knows what
might be happening.

FreeBSD/amd64

-Phil

