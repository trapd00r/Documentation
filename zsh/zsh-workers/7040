From zsh-workers-return-7040-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Jul 08 12:57:00 1999
Return-Path: <zsh-workers-return-7040-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4099 invoked from network); 8 Jul 1999 12:56:59 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 8 Jul 1999 12:56:59 -0000
Received: (qmail 4406 invoked by alias); 8 Jul 1999 12:56:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7040
Received: (qmail 4399 invoked from network); 8 Jul 1999 12:56:48 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer david.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "Oliver Kiddle" <opk@thoth.u-net.com>, <zsh-workers@sunsite.auc.dk>
Subject: RE: 4855 does not work in all cases
Date: Thu, 8 Jul 1999 16:56:38 +0400
Message-ID: <000701bec941$512d19c0$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2910.0)
In-Reply-To: <378494E5.FC4E0462@thoth.u-net.com>
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2314.1300
Importance: Normal

>
> I hadn't tried this but it is the first thing which actually works
> for both xterm
> and aixterm. It doesn't work when you turn of line wrapping but I take it that
> we can get this out of terminfo/termcap (am?)? This blank,backspace thing is a
> bit of a hack so I think we should attempt to find a proper way of
> handling the
> different cases - how does ncurses or something else handle this.
>
> Looking at the man page for terminfo, I found this which might be relevant:
>
> Boolean Capabilities
>
> Variable            Cap Name  I. Code  Description
> eat_newline_glitch  xenl      xn       Ignores new-line character after 80
>                                        columns
>

Yes, ncurses looks at the eat_newline_glitch and basically does the CR-NL in
this case (look at the comments to wrap_cursor() in ncurses/do_update.c - it is
really interesting).

Unfortunately, it is not defined for dtterm (at least on our system). It seems
to be defined for xterm and one more terminal type that do have the feature. But
this is the general problem - how can you be sure that terminfo/termcap reflect
the truth? Users are free to  modify settings on the fly :-(

So, the story looks someting like

if (!am || xenl)
  puts("\r\n");

Not sure, that "\r\n" looks much better than " \n", but this works without
auto-margin as well. Funnily enough, it will work even on my dtterm (that is
configured for am but with terminfo that does not list this :-)

/andrej

