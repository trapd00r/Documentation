From zsh-users-return-13944-mason-zsh=primenet.com.au@sunsite.dk Fri Mar 20 03:16:00 2009
Return-Path: <zsh-users-return-13944-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17287 invoked from network); 20 Mar 2009 03:15:56 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 20 Mar 2009 03:15:56 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 75655 invoked from network); 20 Mar 2009 03:15:43 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 20 Mar 2009 03:15:43 -0000
Received: (qmail 1246 invoked by alias); 20 Mar 2009 03:15:22 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13944
Received: (qmail 19270 invoked from network); 20 Mar 2009 02:48:40 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 20 Mar 2009 02:48:40 -0000
Received: from mx.spodhuis.org (redoubt-new.spodhuis.org [94.142.241.89])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id BEB3482CF026
	for <zsh-users@sunsite.dk>; Fri, 20 Mar 2009 03:48:37 +0100 (CET)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws; s=d200902; d=spodhuis.org;
	h=Received:Date:From:To:Cc:Subject:Message-ID:Mail-Followup-To:References:MIME-Version:Content-Type:Content-Disposition:In-Reply-To;
	b=zw+Xo/dIn6ToNUROypQKSDOhyk6ZgPGyI2owTnK9/J1xO7CvAPioz1lCcpPaE+ZM/ncIJuW8m0UTWv15ozsb5oqbsufpOSn3PR+Q/awZBKuMM1YyONjElNqxc7p3Kcv+YnvGwQpBS4tFFNT+lkqB7Em4KIETEhIq8RR1tlnJ70s=;
Received: by smtp.spodhuis.org with local 
	id 1LkUmh-000Gl2-CJ; Fri, 20 Mar 2009 02:48:35 +0000
Date: Thu, 19 Mar 2009 19:48:35 -0700
From: Phil Pennock <zsh-workers+phil.pennock@spodhuis.org>
To: TjL <luomat@gmail.com>
Cc: Zsh Users List <zsh-users@sunsite.dk>
Subject: Re: up-arrow no longer works right
Message-ID: <20090320024835.GA64103@redoubt.spodhuis.org>
Mail-Followup-To: TjL <luomat@gmail.com>,
	Zsh Users List <zsh-users@sunsite.dk>
References: <d2ecb10b0903191838y68e1dfbbsa80289a52256eb2a@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <d2ecb10b0903191838y68e1dfbbsa80289a52256eb2a@mail.gmail.com>
X-Virus-Scanned: ClamAV 0.92.1/9142/Thu Mar 19 21:19:47 2009 on bifrost
X-Virus-Status: Clean

On 2009-03-19 at 21:38 -0400, TjL wrote:
> The oddity is that sometimes (usually after exiting from ssh and/or
> screen) zsh seems to "forget" that, and pressing the up-arrow will
> just go back through my history line by line, ignoring what I have
> already typed.
> 
> Usually at that point I just exit the shell and open a new one, but
> I'd really like to be able to kick-start my existing session if
> possible (especially when I've ssh'd somewhere).
> 
> Any ideas what might cause this and (more importantly) what I can do to fix it?

Perhaps the cursor keys have been put into application mode and your
terminal type isn't supporting them in that mode?

When things are working, if you run:
  print -n '\e[?1h'
do they stop working?

If you run "bindkey", you'll see two batches for the two sets of cursor
keys; for me:
"^[OA" up-line-or-history
"^[OB" down-line-or-history
"^[OC" forward-char
"^[OD" backward-char
[...]
"^[[A" up-line-or-history
"^[[B" down-line-or-history
"^[[C" forward-char
"^[[D" backward-char

If those two sets ^[O<foo> and ^[[<foo> differ then this might explain
it.  So, (1) bind both sets the same and (2) see if "stty sane" helps.
And:  print -n '\e[?1l'

Regards,
-Phil

