From zsh-workers-request@euclid.skiles.gatech.edu Wed Jun 04 17:21:35 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 16906 invoked from network); 4 Jun 1997 17:21:34 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 4 Jun 1997 17:21:34 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id NAA23268; Wed, 4 Jun 1997 13:12:58 -0400 (EDT)
Resent-Date: Wed, 4 Jun 1997 13:12:58 -0400 (EDT)
From: <hzoli@VNET.IBM.COM> (Zoltan T. Hidvegi)
Message-Id: <9706041716.AA21360@belgium.fishkill.ibm.com>
Subject: Re: Bug in 3.1.2-beta compared with -test1
In-Reply-To: <199706041601.SAA07220@hydra.ifh.de> from Peter Stephenson at "Jun 4, 97 06:01:08 pm"
To: zsh-workers@math.gatech.edu (Zsh workers list)
Date: Wed, 4 Jun 1997 13:16:37 -0400 (EDT)
X-Mailer: ELM [version 2.4ME+ PL31H (25)]
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"WeIPn1.0.Vh5.P8Qbp"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3199
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Peter Stephenson wrote:
> Bruce Stephens wrote:
> > "sleep 1&" returns (or some other background job), some stty settings seem
> > wrong: eof, susp, etc., get zapped.  I've never noticed this in previous
>
> Any advance on the following patch?  inforeground seems to me to be
> the minimum you would need to do before grabbing the tty settings, so
> this can't be far wrong.  It seems to do the trick, anyway.

Yes, this patch seems to be OK.  Unfortunately the same bug is in zsh-3.0.3
so I may have to release zsh-3.0.4 with this one line fix.  The original
condition in zsh-3.1.1 was

    pgrp = gettygrp();           /* get process group of tty      */

    /* is this job in the foreground of an interactive shell? */
    if ((jn->gleader == pgrp || (pgrp > 1 && kill(-pgrp, 0) == -1)) &&
        !ttyfrozen && !val && !jn->stty_in_env)
        gettyinfo(&shttyinfo);

Looks horrible, that cannot be right.  I did not notice this bug since I
use ttyctl -f.

That whole job control stuff looks like noone had any clue how it works so
everyone just put in more and more conditions until it seemd to work.  I
still do not fully understand everything here, but hopefully things are
better now.

Zoltan

