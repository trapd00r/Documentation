From zsh-users-return-3682-mason-zsh=primenet.com.au@sunsite.dk Sun Mar 18 04:57:34 2001
Return-Path: <zsh-users-return-3682-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26029 invoked from network); 18 Mar 2001 04:57:33 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 18 Mar 2001 04:57:33 -0000
Received: (qmail 24529 invoked by alias); 18 Mar 2001 04:57:18 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 3682
Received: (qmail 24518 invoked from network); 18 Mar 2001 04:57:17 -0000
Sender: morton@uow.edu.au
Message-ID: <3AB4408C.18E66E6C@uow.edu.au>
Date: Sun, 18 Mar 2001 15:58:52 +1100
From: Andrew Morton <andrewm@uow.edu.au>
X-Mailer: Mozilla 4.7 [en] (X11; I; Linux 2.4.3-pre3 i586)
X-Accept-Language: en
MIME-Version: 1.0
To: Bart Schaefer <schaefer@candle.brasslantern.com>
CC: zsh-users@sunsite.dk
Subject: Re: `make' completion in zsh-3.1.9
References: <3AB37F1C.FF6C67F6@uow.edu.au>,
		<3AB37F1C.FF6C67F6@uow.edu.au> <1010317165153.ZM6844@candle.brasslantern.com>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

Bart Schaefer wrote:
> 
> On Mar 18,  2:13am, Andrew Morton wrote:
> } Subject: `make' completion in zsh-3.1.9
> }
> } /usr/src/linux> make menu<tab>
> }
> } the shell locks up for about ten seconds, recurring into every
> } directory of the kernel tree doing *something*.  Finally,
> } it comes back with `make menuconfig'.
> 
> It's running "make -nsp --no-print-directory -f Makefile .PHONY" to cause
> make itself to output the list of possible completions.  I don't know why
> this would be taking 10 seconds or more -- it finishes in 1 second or so
> on my machine.

Oh I see.  `make -nsp' takes a very long time to complete in the top level of
the kernel tree.  It produces 34 megabytes of output.

zsh-3.1.6 does this:

	awk /^[a-zA-Z0-9][^\/ \t]+:/ {print $1}

to find potential targets in the makefile, whereas 3.1.9 does this:

    if [[ -n "$_is_gnu[$words[1]]" ]]; then
      	< make -n stuff >
    else
        <awk '/^[a-zA-Z0-9][^\/\t=]+:/ stuff>

And the 3.1.9 behaviour actually doesn't work properly - it
matches things which can't possibly be built from this directory
such as floppy.c

Ho hum.  I'll just edit /usr/share/zsh/3.1.9/functions/User/_make
and put it back the old way.

Thanks.

