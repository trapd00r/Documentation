From zsh-workers-return-20785-mason-zsh=primenet.com.au@sunsite.dk Thu Feb 03 19:02:01 2005
Return-Path: <zsh-workers-return-20785-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 468 invoked from network); 3 Feb 2005 19:02:01 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 3 Feb 2005 19:02:01 -0000
Received: (qmail 18849 invoked from network); 3 Feb 2005 19:01:55 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 3 Feb 2005 19:01:55 -0000
Received: (qmail 10706 invoked by alias); 3 Feb 2005 19:01:52 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20785
Received: (qmail 10691 invoked from network); 3 Feb 2005 19:01:51 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 3 Feb 2005 19:01:51 -0000
Received: (qmail 18250 invoked from network); 3 Feb 2005 19:01:15 -0000
Received: from mail3.ecc.u-tokyo.ac.jp (133.11.171.218)
  by a.mx.sunsite.dk with SMTP; 3 Feb 2005 19:01:11 -0000
Received: from spam002.ecc.u-tokyo.ac.jp (spam002.ecc.u-tokyo.ac.jp [133.11.50.195])
	by mail3.ecc.u-tokyo.ac.jp (Postfix) with ESMTP id 1F35370060
	for <zsh-workers@sunsite.dk>; Fri,  4 Feb 2005 04:01:10 +0900 (JST)
Received: from [192.168.1.12] ( [222.13.222.114])
	by spam002.ecc.u-tokyo.ac.jp (SpamBlock.pst 3.4.25)
	with ESMTP id <a2cd090851702fd1519fbabaa1e3ab4f@h8.dion.ne.jp>
	for <zsh-workers@sunsite.dk>; Fri, 4 Feb 2005 04:01:07 +0900
In-Reply-To: <200502031615.j13GFnuc005915@news01.csr.com>
References: <200502031615.j13GFnuc005915@news01.csr.com>
Mime-Version: 1.0 (Apple Message framework v619.2)
Content-Type: text/plain; charset=US-ASCII; format=flowed
Message-Id: <a2cd090851702fd1519fbabaa1e3ab4f@h8.dion.ne.jp>
Content-Transfer-Encoding: 7bit
Cc: Zsh hackers list <zsh-workers@sunsite.dk>
From: Motoi Washida <a66@h8.dion.ne.jp>
Subject: Re: 4.2.4 failure on MacOS X
Date: Fri, 4 Feb 2005 04:01:02 +0900
To: Peter Stephenson <pws@csr.com>
X-Mailer: Apple Mail (2.619.2)
X-IP: 222.13.222.114
X-FROM-DOMAIN: h8.dion.ne.jp
X-FROM-EMAIL: a66@h8.dion.ne.jp
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

I also failed to build zsh on Mac OS X 10.3.7.

I think this is because configure can't find iconv(), because iconv() 
is defined as libiconv() in /usr/include/iconv.h and the configure 
script checks iconv() without using the header file.

I modified configure.ac a bit and seems to work. Here is the patch.

--
Motoi Washida



Index: configure.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.ac,v
retrieving revision 1.25
diff -d -u -r1.25 configure.ac
--- configure.ac	1 Feb 2005 10:53:10 -0000	1.25
+++ configure.ac	3 Feb 2005 18:42:05 -0000
@@ -729,10 +729,11 @@

  AC_CHECK_LIB(iconv, iconv)

-if test "$host_os" = cygwin; then
-dnl cygwin iconv() is really libiconv()
-AC_CHECK_LIB(iconv, libiconv)
-fi
+case "$host_os" in
+  cygwin | darwin*)
+    dnl cygwin iconv() is really libiconv()
+    AC_CHECK_LIB(iconv, libiconv) ;;
+esac

  if test x$enable_pcre = xyes; then
  dnl pcre-config should probably be employed here

