From zsh-workers-return-16771-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 06 14:57:43 2002
Return-Path: <zsh-workers-return-16771-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22642 invoked from network); 6 Mar 2002 14:57:42 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 6 Mar 2002 14:57:42 -0000
Received: (qmail 21709 invoked by alias); 6 Mar 2002 14:57:37 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16771
Received: (qmail 21697 invoked from network); 6 Mar 2002 14:57:37 -0000
Date: Wed, 6 Mar 2002 14:56:37 +0000
From: Adam Spiers <adam@spiers.net>
To: zsh-workers@sunsite.auc.dk
Subject: Re: PATCH: _history_complete_word
Message-ID: <20020306145637.A21394@corelli.new.ox.ac.uk>
Reply-To: Adam Spiers <adam@spiers.net>
Mail-Followup-To: zsh-workers@sunsite.auc.dk
References: <200003310814.KAA06936@beta.informatik.hu-berlin.de> <20000426204917.A13452@thelonious.new.ox.ac.uk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <20000426204917.A13452@thelonious.new.ox.ac.uk>; from adam@spiers.net on Wed, Apr 26, 2000 at 08:49:17PM +0100
X-URL: http://tigerpig.org/
X-OS: RedHat Linux
Sender: "Adam Spiers,,07775562717,020 88 30 30 35" <adam@corelli.new.ox.ac.uk>

Bringing more dead topics back to life ...

Adam Spiers (adam@spiers.net) wrote:
> Just noticed another new quirk with h-c-w now.  I have:
> 
>   zstyle ':completion:*:descriptions' format '%B---- %d%b'
>   zstyle ':completion:*:history-words' stop verbose
>   zstyle ':completion:*:history-words' remove_all_dups yep
>                                                         
> The first time I press M-/ the message `---- history word' appears,
> which means that I have to press it twice to get the first match,
> which shouldn't really happen unless the `list' style is turned on.
> How can this be fixed?

This tiny nit has grown into an itch big enough I need to scratch it.
These days I also have 

    zstyle ':completion:*:history-words' list false

set, so I don't even get the message appearing.  This gives the
impression of the first keystroke just being swallowed.  This is
presumably because the

  [[ $LASTWIDGET = _history-complete-* &&
     ( -n "$compstate[old_list]" || -n $_hist_stop ) ]]

condition returns false, so on the first stroke, the matches are
generated but nothing else happens.  I'm not sure what the best
solution is.

