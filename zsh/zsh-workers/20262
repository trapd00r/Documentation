From zsh-workers-return-20262-mason-zsh=primenet.com.au@sunsite.dk Mon Aug 16 08:38:42 2004
Return-Path: <zsh-workers-return-20262-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21712 invoked from network); 16 Aug 2004 08:38:41 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Aug 2004 08:38:41 -0000
Received: (qmail 68388 invoked from network); 16 Aug 2004 08:38:35 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Aug 2004 08:38:35 -0000
Received: (qmail 25439 invoked by alias); 16 Aug 2004 08:38:23 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20262
Received: (qmail 25429 invoked from network); 16 Aug 2004 08:38:23 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by 130.225.247.90 with SMTP; 16 Aug 2004 08:38:23 -0000
Received: (qmail 67446 invoked from network); 16 Aug 2004 08:37:42 -0000
Received: from unknown (HELO moonbase.zanshin.com) (167.160.213.139)
  by a.mx.sunsite.dk with SMTP; 16 Aug 2004 08:37:40 -0000
Received: from toltec.zanshin.com (toltec.zanshin.com [64.84.47.166])
	by moonbase.zanshin.com (8.12.11/8.12.11) with ESMTP id i7G8bc0W017655
	for <zsh-workers@sunsite.dk>; Mon, 16 Aug 2004 01:37:38 -0700
Date: Mon, 16 Aug 2004 01:37:38 -0700 (PDT)
From: Bart Schaefer <schaefer@brasslantern.com>
Reply-To: zsh-workers@sunsite.dk
To: zsh-workers@sunsite.dk
Subject: Re: Some questions regarding prompt themes
In-Reply-To: <2004-08-16T08-32-23@devnull.michael-prokop.at>
Message-ID: <Pine.LNX.4.61.0408160052080.21654@toltec.zanshin.com>
References: <2004-08-16T08-32-23@devnull.michael-prokop.at>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="1413522991-2074471311-1092643343=:21654"
Content-ID: <Pine.LNX.4.61.0408160105440.21654@toltec.zanshin.com>
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_44 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--1413522991-2074471311-1092643343=:21654
Content-Type: TEXT/PLAIN; CHARSET=iso-8859-1
Content-Transfer-Encoding: 8BIT
Content-ID: <Pine.LNX.4.61.0408160105441.21654@toltec.zanshin.com>

On Mon, 16 Aug 2004, Michael Prokop wrote:

>   Is using 'export PROMPT' in prompt-themes reasonable?

Evidently Colin Walters thought so, or whoever stole from him.  It's not 
ideal.  The prompinit wrapper saves and restores PS1 et al., but not 
PROMPT nor RPROMPT, when running preview.  I would have expected the 
restoration of PS1 at exit from the function to restore PROMPT as a 
side-effect of their linkage, and it seems to do so when I try it, so I 
don't know offhand what's happening to you.

The "mike@tweety ~ % " prompt doesn't look like it came from any of the
zsh prompt themes I'm familiar with.  Certainly not walters, which would 
be "mike@tweety> ", nor zefram which is always the last theme previewed.

> * Is it possible to "break out" of a precmd­statement?

I don't know what you're asking.

>   Some themes are using the precmd-option

Yes, sadly, several of the themes assume you don't have anything better to 
do with your precmd than fiddle with the prompt.  You'll note the "bart"
theme goes to some lengths to avoid wrecking any existing precmd function.

>   e.g. prompt_adam1_setup sets the prompt via the precmd statement.
>   AFAICS this results in problems when running stuff like
>     export PS1='test'
>   manually ­ which IMHO does not work as it should.

Hey, you either get a themed prompt or you don't.  Why would you expect 
that assigning to PS1 was enough to disable an entire prompt theme?

(Just wait until we get ksh-style "discipline functions," though.)

> * Would it be possible that 'prompt -p' does *not* export any
>   prompt-variables so the prompt doesn't get modified by just
>   running a preview of one/some/all themes?

"prompt -p" doesn't do anything except make a stab at saving state and 
then blindly run each of the theme setup and preview functions in turn.  
It's up to the theme writers to make the themes play nice, and some of 
them don't, er, didn't.

Probably preview (and help) could be executed in a subshell nowadays, to 
avoid all this hassle.  When the theme system was first written, some 
things like the job table didn't behave well in subshells, but that's 
pretty much been fixed up in 4.2.x.

> * Does there exist a way to reset all prompt-values? Something like
>   'prompt reset' would be very nice IMHO.

Nothing's changed since I wrote the previous response that you excerpted:
| To really have "prompt off" mean what it seems to mean, the theme system
| would have to save and restore the original values of all the variables.

The theme system does not save the original values of all the variables.

> * What's the "right" way to set variables in a prompt-theme to avoid
>   problems with other themes?  Would it make sense to "unset PS1
>   PS2..." at the beginning of a prompt-theme to avoid any
>   side-effects from other themes?

It's a philosophical thing.  E.g. "prompt bart" doesn't mess with RPS1 
except to color it; so whatever the previous value was will still be 
there, which is fine because my prompt doesn't need it for anything.  My 
theme also keeps whatever was in PS1 to begin with, it just prefixes it 
with more stuff.

But none of the prompt themes know about RPS2, because it didn't exist
when the theme system was written.
--1413522991-2074471311-1092643343=:21654--

