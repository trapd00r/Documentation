From zsh-workers-return-18063-mason-zsh=primenet.com.au@sunsite.dk Thu Jan 09 13:38:54 2003
Return-Path: <zsh-workers-return-18063-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4898 invoked from network); 9 Jan 2003 13:38:53 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 9 Jan 2003 13:38:53 -0000
Received: (qmail 9055 invoked by alias); 9 Jan 2003 13:38:46 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18063
Received: (qmail 9042 invoked from network); 9 Jan 2003 13:38:45 -0000
Subject: zsh HP-UX build problems
To: zsh-workers@sunsite.dk
X-Mailer: Lotus Notes Release 5.0.8  June 18, 2001
Message-ID: <OFC2BAB899.420F6573-ON80256CA9.004A0978@amadeus.net>
From: eavis@amadeus.net
Date: Thu, 9 Jan 2003 13:37:35 +0000
X-MIMETrack: Serialize by Router on MUCSMTP2/MUC/AMAEXTMAIL(Release 5.0.10 |March 22, 2002) at
 09/01/2003 14:38:44
MIME-Version: 1.0
Content-type: text/plain; charset=us-ascii

I downloaded zsh-4.0.6.tar.bz2 and did the normal build steps.  I have
shown some, but not all, of the output of each command in this message.

% ./configure --prefix=$HOME
[...]
zsh configuration
-----------------
zsh version               : 4.0.6
host operating system     : hppa2.0w-hp-hpux11.11
source code location      : .
compiler                  : gcc
preprocessor flags        :
executable compiler flags :  -Wall -Wmissing-prototypes -O2
module compiler flags     :  -Wall -Wmissing-prototypes -O2 -fPIC
executable linker flags   :   -s -Wl,-E
module linker flags       :   -s -b
library flags             : -lnsl -lcurses -lm  -lc
installation basename     : zsh
binary install path       : /users/eavis/bin
man page install path     : /users/eavis/man
info install path         : /users/eavis/info
functions install path    : /users/eavis/share/zsh/4.0.6/functions
See config.modules for installed modules and functions.

% make
[all seemed to build correctly.  It didn't work with make -j, but that's
another story]

% make test
[several tests passed, then:]
./V01zmodload.ztst: starting.
*** /tmp/zsh.ztst.err.788       Thu Jan  9 11:24:20 2003
--- /tmp/zsh.ztst.terr.788      Thu Jan  9 11:24:20 2003
***************
*** 0 ****
--- 1,7 ----
+ ZTST_execchunk:2: failed to load module: zsh/complete
+ ZTST_execchunk:2: failed to load module: zsh/complete
+ ZTST_execchunk:2: failed to load module: zsh/complete
+ ZTST_execchunk:2: failed to load module: zsh/complete
+ ZTST_execchunk:2: failed to load module: zsh/complete
+ ZTST_execchunk:2: failed to load module: zsh/deltochar
+ ZTST_execchunk:2: failed to load module: zsh/zleparameter
Test ./V01zmodload.ztst failed: error output differs from expected as shown
above for:
 for m in $mods
 do
   zmodload -i $m || mods[(r)$m]=()
 done
Was testing: Test loading of all compiled modules
./V01zmodload.ztst: test failed.
./V02zregexparse.ztst: starting.
ZTST_execchunk:2: failed to load module: zsh/complete
Test ./V02zregexparse.ztst failed: non-zero status from preparation code:
  zmodload zsh/zutil
./V02zregexparse.ztst: test failed.
Test ./V02zregexparse.ztst failed: bad status 1, expected 0 from:
  zregexparse p1 p2 ''
Error output:
ZTST_execchunk:2: failed to load module: zsh/complete
ZTST_execchunk:zregexparse:2: autoload failed
Was testing: empty
./V02zregexparse.ztst: test failed.
./Y01completion.ztst: starting.
[hangs]

So the tests depending on dynamic loading fail, and also Y01completion
hangs.  To work around the problem, I unpacked a fresh tarball and did:

% ./configure --prefix=$HOME --disable-dynamic
[...]
% make
[...]
% make test
[...]
./V01zmodload.ztst: starting.
Warning: zsh/example not linked: not checking autoloading
./V01zmodload.ztst: all tests successful.
./V02zregexparse.ztst: starting.
./V02zregexparse.ztst: all tests successful.
./Y01completion.ztst: starting.
comptestinit:7: failed to load module: zsh/zpty
comptestinit:19: command not found: zpty
comptestinit:21: command not found: zpty
Test ./Y01completion.ztst failed: non-zero status from preparation code:
  comptestinit -z $ZTST_testdir/../Src/zsh &&
  {
    mkdir dir1
    mkdir dir2
    touch file1
    touch file2
  }
./Y01completion.ztst: test failed.
Test ./Y01completion.ztst failed: bad status 1, expected 0 from:
  comptest $': \t\t\t\t\t\t\t'
Error output:
comptest:2: command not found: zpty
comptest:3: command not found: zpty
Was testing: directories and files
./Y01completion.ztst: test failed.
./Y02compmatch.ztst: starting.
comptestinit:7: failed to load module: zsh/zpty
comptestinit:19: command not found: zpty
comptestinit:21: command not found: zpty
Test ./Y02compmatch.ztst failed: non-zero status from preparation code:
  comptestinit -z $ZTST_testdir/../Src/zsh &&
  {
    list1=(IndianRed IndianRed2 IndianRed3 IndianRed4)
    test_code () {
        matcher=$1;
        list=$2;
        code="compdef _tst tst ; _tst () { echo -n '<COMPADD>';compadd -M
'"
        code="$code$matcher"
        code="$code'  - ${(P)list} ; echo  -n '</COMPADD>'"
        code="$code; $extra_cmd"
        code="$code; echo -n '<INSERT_POSITIONS>'"
        code="$code; echo \$compstate[insert_positions]"
        code="$code; echo -n '</INSERT_POSITIONS>'"
        code="$code}"
        comptesteval "$code"
    }
  }
./Y02compmatch.ztst: test failed.
Test ./Y02compmatch.ztst failed: bad status 1, expected 0 from:
 test_code z: list1
 comptest  $'tst \t'
Error output:
ZTST_execchunk:2: command not found: test_code
comptest:2: command not found: zpty
comptest:3: command not found: zpty
Was testing: Match Error for "z:"
./Y02compmatch.ztst: test failed.
./Y03arguments.ztst: starting.
comptestinit:7: failed to load module: zsh/zpty
comptestinit:19: command not found: zpty
comptestinit:21: command not found: zpty
Test ./Y03arguments.ztst failed: non-zero status from preparation code:
  comptestinit -z $ZTST_testdir/../Src/zsh &&
  {
    comptesteval 'compdef _tst tst'
    tst_arguments () { comptesteval "_tst () { _arguments ${${(@qq)*}} }" }
  }
./Y03arguments.ztst: test failed.
Test ./Y03arguments.ztst failed: bad status 1, expected 0 from:
 tst_arguments ':desc1:(arg1)'
 comptest $'tst \t\C-wa\t\C-war\t\C-warg\t\C-warg1\t\C-wr\t\C-wx\t \ty \t'
Error output:
ZTST_execchunk:2: command not found: tst_arguments
comptest:2: command not found: zpty
comptest:3: command not found: zpty
Was testing: one non-option argument
./Y03arguments.ztst: test failed.
gmake.exe[1]: [check] Error 1 (ignored)
rm -rf Modules .zcompdump
gmake.exe[1]: Leaving directory `/tmp/eavis/zsh-4.0.6/Test'

Here a lot of the tests want to find a 'zpty' command which has not been
built.  So I think there are two main bugs to report: the failure of the
dynamic loading tests (or arguably the failure of --configure to autodetect
that dynamic loading won't work), and the failure of the tests wanting
'zpty'.

% uname -a
HP-UX lonhp02 B.11.11 U 9000/800 589734997 unlimited-user license

What can I do to track down these bugs further?  Please cc replies to me
since I do not read this list.

--
Ed Avis <eavis@amadeus.net>



