From zsh-workers-return-9279-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Jan 09 18:42:49 2000
Return-Path: <zsh-workers-return-9279-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1541 invoked from network); 9 Jan 2000 18:42:48 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 9 Jan 2000 18:42:48 -0000
Received: (qmail 18366 invoked by alias); 9 Jan 2000 18:42:43 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9279
Received: (qmail 18336 invoked from network); 9 Jan 2000 18:42:43 -0000
To: zsh-workers@sunsite.auc.dk
Subject: Re: core dump with autoloading failure. 
In-reply-to: "Tanaka Akira"'s message of "10 Jan 2000 01:03:26 +0900."
             <rsqu2knxmep.fsf@crane.jaist.ac.jp> 
Date: Sun, 09 Jan 2000 18:44:37 +0000
From: Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Message-Id: <E127NIX-0005AM-00.2000-01-09-18-42-41@mail3.svr.pol.co.uk>

Tanaka Akira wrote:
> zsh dumps core as follows:
> 
> Z:akr@thorax% Src/zsh -f
> thorax% bindkey -e; autoload -U compinit; compinit -D 
> thorax% compdef _xxx xxx; autoload -U _xxx
> thorax% xxx 
> _xxx: _xxx: function definition file not found
> zsh: segmentation fault (core dumped)  Src/zsh -f

My guess is this.  Sven, are there are any more like this?

Index: Src/mem.c
===================================================================
RCS file: /home/pws/CVSROOT/projects/zsh/Src/mem.c,v
retrieving revision 1.3
diff -u -r1.3 mem.c
--- Src/mem.c	1999/12/21 15:18:28	1.3
+++ Src/mem.c	2000/01/09 18:11:45
@@ -181,7 +181,11 @@
     for (h = heaps; h; h = n) {
 	n = h->next;
 	DPUTS(h->sp, "BUG: old_heaps() with pushed heaps");
+#ifdef USE_MMAP
+	munmap((void *) h, sizeof(*h));
+#else
 	zfree(h, sizeof(*h));
+#endif
     }
     heaps = old;
     fheap = NULL;

-- 
Peter Stephenson <pws@pwstephenson.fsnet.co.uk>

