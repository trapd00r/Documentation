From zsh-users-return-11353-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 28 00:45:03 2007
Return-Path: <zsh-users-return-11353-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6287 invoked from network); 28 Mar 2007 00:45:01 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.8 (2007-02-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.7 required=5.0 tests=AWL,BAYES_00,FORGED_RCVD_HELO,
	WEIRD_QUOTING autolearn=no version=3.1.8
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 28 Mar 2007 00:45:01 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 99903 invoked from network); 27 Mar 2007 20:44:55 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 27 Mar 2007 20:44:55 -0000
Received: (qmail 15231 invoked by alias); 27 Mar 2007 20:44:46 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11353
Received: (qmail 15218 invoked from network); 27 Mar 2007 20:44:46 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 27 Mar 2007 20:44:46 -0000
Received: (qmail 98468 invoked from network); 27 Mar 2007 20:44:46 -0000
Received: from smtpout0156.sc1.he.tucows.com (HELO n064.sc1.he.tucows.com) (64.97.136.156)
  by a.mx.sunsite.dk with SMTP; 27 Mar 2007 20:44:43 -0000
Received: from sc.homeunix.net (82.26.160.246) by n064.sc1.he.tucows.com (7.2.069.1)
        id 45FC2AFB000CC068; Tue, 27 Mar 2007 20:44:40 +0000
Received: from chazelas by sc.homeunix.net with local (Exim 4.63)
	(envelope-from <stephane_chazelas@yahoo.fr>)
	id 1HWIWn-0003zM-0W; Tue, 27 Mar 2007 21:44:25 +0100
Date: Tue, 27 Mar 2007 21:44:25 +0100
From: Stephane Chazelas <Stephane_Chazelas@yahoo.fr>
To: "Brian K. White" <brian@aljex.com>
Cc: zsh-users@sunsite.dk
Subject: Re: Lonely spacecowboy
Message-ID: <20070327204424.GE4885@sc.homeunix.net>
Mail-Followup-To: "Brian K. White" <brian@aljex.com>, zsh-users@sunsite.dk
References: <20070327175336.GA22601@solfire> <003c01c770a2$5bb43ca0$9502a8c0@venti> <20070327193132.GD4885@sc.homeunix.net> <007001c770ad$1da98310$9502a8c0@venti>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-15
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <007001c770ad$1da98310$9502a8c0@venti>
User-Agent: Mutt/1.5.6i

On Tue, Mar 27, 2007 at 04:18:43PM -0400, Brian K. White wrote:
[...]
> >~$ echo foo | read
> >~$ echo $REPLY
> >foo
[...]
> This is latest freestanding (static binary not needing cygwin dll) version 
> of zsh for windows that I have been able to locate, which is quite old,
> $P$Gecho $VERSION
> 3.0.5.001

Will be 10 years old in a few months. How time flies... :)

> The way cygwin only works by having the cygwin dll installed in the os and 
> can't be delivered in a self-contained package with the file makes cygwin 
> unsuitable for me.

Well, at least some time ago (time flying as well), you only
needed one DLL file so could put that in the same directory as
the zsh binary or something like that.

Even now, I don't think you need any superuser priviledge to run
cygwined command (don't quote me on that). Latest version of
zsh works fine on cygwin.

[...]
> >>awk '{system("somecommand \""$0"\"")}' files.txt
> >
> >Then you'd run into more problems (possibly serious) if the
> >lines in files.txt contain any ", \, $, `...
> 
> Well I quoted the string, we do already know it contains spaces.
> I suppose it wouldn't be that much harder to get it single-quoted instead 
> of double-quoted and then it's just up to command to continue handling the 
> string safely.

single quotes would still be a problem for a single quoted
string. You could then escape the single quotes withing awk. I
find that there's not portable way to do so though.

Another possibility is:

{
  {
    echo 'exec <&3 3<&-'
    sed 's/./\\&/g; s/^/somecommand /' < files.txt
  } 3<&- | sh
} 3<&0

> Or you could add as much sanity checking to the awk script as seems 
> necessary.
> 
> But I forgot all about xargs, that was nicer than this anyways.

The example I gave was using GNU's -d option. Standardly, you
have:

sed 's/./\\&/g' | xargs -n1 cmd

But note that xargs is kind of a joke command, the SUSv3 page
about it is a quite a nice one in itself as well. POSIX allows
very low limitations, many implementations have enormous bugs.
It's generally safer to stay away from it except for the GNU/BSD
xargs -r0 in combination with some NUL aware commands.

regards,
Stéphane

