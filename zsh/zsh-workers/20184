From zsh-workers-return-20184-mason-zsh=primenet.com.au@sunsite.dk Fri Jul 23 17:43:03 2004
Return-Path: <zsh-workers-return-20184-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26990 invoked from network); 23 Jul 2004 17:43:02 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 Jul 2004 17:43:02 -0000
Received: (qmail 11525 invoked from network); 23 Jul 2004 17:42:57 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 Jul 2004 17:42:57 -0000
Received: (qmail 8127 invoked by alias); 23 Jul 2004 17:42:45 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20184
Received: (qmail 8117 invoked from network); 23 Jul 2004 17:42:45 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by 130.225.247.90 with SMTP; 23 Jul 2004 17:42:45 -0000
Received: (qmail 10855 invoked from network); 23 Jul 2004 17:40:47 -0000
Received: from acolyte.scowler.net (216.254.112.45)
  by a.mx.sunsite.dk with SMTP; 23 Jul 2004 17:40:45 -0000
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id 041297004A; Fri, 23 Jul 2004 13:40:44 -0400 (EDT)
Date: Fri, 23 Jul 2004 13:40:44 -0400
From: Clint Adams <schizo@debian.org>
To: zsh-workers@sunsite.dk
Cc: Vincent Lefevre <vincent@vinc17.org>,
	221875-forwarded@bugs.debian.org
Subject: Re: zsh sometimes sets $PWD to "." when executed
Message-ID: <20040723174044.GA10121@scowler.net>
References: <20031224182536.GU1501@ay.nerim.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20031224182536.GU1501@ay.nerim.net>
User-Agent: Mutt/1.5.6+20040523i
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

Is this still happening?  What does "pwd -P" return in such
circumstances?

> I'm reassigning the bug to zsh, as I now know that the problem doesn't
> come from screen. However it has always occurred in screen (but this
> isn't necessarily meaningful).
> 
> This time, the bug occurred on another account (but still in screen and
> still in an NFS directory). Instead of opening a new screen window, I did
> the following, where z is:
> 
> alias z='if [[ -o login ]]
>   then exec $SHELL -l;
>   else exec $SHELL;
>   fi'
> 
> liberte:~/oldtests[130]> z                                            <18:13:16
> zshenv...
> zshrc...
> Shell level: 2 (login shell)
> The tty is frozen
> zlogin...
> liberte:.> pwd                                                        <18:13:19
> .
> liberte:.> ll /proc/$$                                                <18:14:00
> total 0
> -r--r--r--    1 vlefevre lip             0 Dec 24 18:14 cantmove
> -r--r--r--    1 vlefevre lip             0 Dec 24 18:14 cmdline
> -r--r--r--    1 vlefevre lip             0 Dec 24 18:14 cpu
> lrwxrwxrwx    1 vlefevre lip             0 Dec 24 18:14 cwd -> /home/vlefevre/
> -rw-r--r--    1 vlefevre lip             0 Dec 24 18:14 disclosure
> -r--------    1 vlefevre lip             0 Dec 24 18:14 environ
> lrwxrwxrwx    1 vlefevre lip             0 Dec 24 18:14 exe -> /home/vlefevre/bin-i386/zsh*
> dr-x------    2 vlefevre lip             0 Dec 24 18:14 fd/
> --w--w--w-    1 vlefevre lip             0 Dec 24 18:14 goto
> -rw-r--r--    1 vlefevre lip             0 Dec 24 18:14 lock
> -r--r--r--    1 vlefevre lip             0 Dec 24 18:14 maps
> -rw-------    1 vlefevre lip             0 Dec 24 18:14 mem
> -rw-r--r--    1 vlefevre lip             0 Dec 24 18:14 migfilter
> -rw-r--r--    1 vlefevre lip             0 Dec 24 18:14 miggroup
> -rw-r--r--    1 vlefevre lip             0 Dec 24 18:14 mignodes
> -rw-r--r--    1 vlefevre lip             0 Dec 24 18:14 migpolicy
> --w-------    1 vlefevre lip             0 Dec 24 18:14 migrate
> -r--r--r--    1 vlefevre lip             0 Dec 24 18:14 mounts
> -r--r--r--    1 vlefevre lip             0 Dec 24 18:14 nmigs
> lrwxrwxrwx    1 vlefevre lip             0 Dec 24 18:14 root -> //
> -rw-r--r--    1 vlefevre lip             0 Dec 24 18:14 selected
> -rw-r--r--    1 vlefevre lip             0 Dec 24 18:14 sigmig
> -r--r--r--    1 vlefevre lip             0 Dec 24 18:14 stat
> -r--r--r--    1 vlefevre lip             0 Dec 24 18:14 statm
> -r--r--r--    1 vlefevre lip             0 Dec 24 18:14 status
> -r--r--r--    1 vlefevre lip             0 Dec 24 18:14 where
> 
> Both $PWD and the cwd are incorrect. They should both have been
> "/home/vlefevre/oldtests".
> 
> Or is it a bug in the Linux kernel for the cwd part? FYI, for both
> machines where the bug occurred, the kernel is respectively 2.4.20
> and 2.4.22.

