From zsh-users-return-8538-mason-zsh=primenet.com.au@sunsite.dk Mon Feb 21 18:35:47 2005
Return-Path: <zsh-users-return-8538-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 930 invoked from network); 21 Feb 2005 18:35:46 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 21 Feb 2005 18:35:46 -0000
Received: (qmail 63393 invoked from network); 21 Feb 2005 18:35:39 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 21 Feb 2005 18:35:39 -0000
Received: (qmail 3028 invoked by alias); 21 Feb 2005 18:35:32 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8538
Received: (qmail 3010 invoked from network); 21 Feb 2005 18:35:32 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 21 Feb 2005 18:35:32 -0000
Received: (qmail 62393 invoked from network); 21 Feb 2005 18:35:32 -0000
Received: from mail36.messagelabs.com (193.109.254.211)
  by a.mx.sunsite.dk with SMTP; 21 Feb 2005 18:35:24 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-7.tower-36.messagelabs.com!1109010927!14165678!1
X-StarScan-Version: 5.4.11; banners=-,-,-
X-Originating-IP: [158.234.9.163]
Received: (qmail 28955 invoked from network); 21 Feb 2005 18:35:27 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-7.tower-36.messagelabs.com with SMTP; 21 Feb 2005 18:35:27 -0000
Received: from trentino.logica.co.uk ([158.234.142.59])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id j1LIZM61030322
	for <zsh-users@sunsite.dk>; Mon, 21 Feb 2005 18:35:22 GMT
Received: from trentino.logica.co.uk (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP id D544B13ACD
	for <zsh-users@sunsite.dk>; Mon, 21 Feb 2005 19:35:01 +0100 (CET)
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <qb3k11po2sl4puu08gubtld0s5cv6s5vcd@4ax.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <c6d01b09219451054fb9bd977875b4f6@poellath.org> <qb3k11po2sl4puu08gubtld0s5cv6s5vcd@4ax.com>
To: zsh-users@sunsite.dk
Subject: Re: Colorize command output 
Date: Mon, 21 Feb 2005 19:35:01 +0100
Message-ID: <3967.1109010901@trentino.logica.co.uk>
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

zzapper wrote:
> On Mon, 21 Feb 2005 17:16:43 +0100,  wrote:
> 
> >
> >To make conflicts stand out, I'd like to colorize the output of the svn 
> >command so that lines starting with C are displayed in red. My first 
> >shot at this was
> >
> >% svn status | sed -e 's/^C/\e[31mC\e[0m/g'

Escapes like \e are not expanded by sed. You can used the shell's $'...'
form of quoting to expand them, however.

    svn status | sed -e $'s/^C/\e[31m&\e[0m/g'

Note also, that you can use & in the replacement part of sed's s
command. That substitutes whatever was matched.

> I guess you could cheat by using grep as a colorizer
> 
> echo "fred" | grep --color '.' 

That's not quite the same. It highlights matching parts of a line so
lines not beginning with a C will be lost. I've attached below my old
hgrep script which highlights matches but outputs all lines. I find it
more useful than grep --color. It's meant for general cases, though, and
wouldn't be much use for colouring svn output.

Oliver

# hgrep - highlight grep

if (( ! $# )); then
  echo "Usage: $0:t [-e pattern...] [file...]" >&2
  return 1
fi

local -a regex
local htext=`echotc so` ntext=`echotc se`

while [[ "$1" = -e ]]; do
  regex=( $regex "$2" )
  shift 2
done

if (( ! $#regex )); then
  regex=( "$1" )
  shift
fi

regex=( "-e
s/${^regex[@]}/$htext&$ntext/g" )
sed ${(Ff)regex[@]} "$@"

