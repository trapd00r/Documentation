From zsh-users-return-10928-mason-zsh=primenet.com.au@sunsite.dk Fri Nov 03 19:43:12 2006
Return-Path: <zsh-users-return-10928-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22689 invoked from network); 3 Nov 2006 19:43:05 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 3 Nov 2006 19:43:05 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 85893 invoked from network); 3 Nov 2006 19:42:58 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 3 Nov 2006 19:42:58 -0000
Received: (qmail 1519 invoked by alias); 3 Nov 2006 19:42:50 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10928
Received: (qmail 1510 invoked from network); 3 Nov 2006 19:42:49 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 3 Nov 2006 19:42:49 -0000
Received: (qmail 84668 invoked from network); 3 Nov 2006 19:42:49 -0000
Received: from cluster-d.mailcontrol.com (217.69.20.190)
  by a.mx.sunsite.dk with SMTP; 3 Nov 2006 19:42:43 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly29d.srv.mailcontrol.com (MailControl) with ESMTP id kA3Jgdvl025781
	for <zsh-users@sunsite.dk>; Fri, 3 Nov 2006 19:42:40 GMT
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Fri, 3 Nov 2006 19:42:39 +0000
Date: Fri, 3 Nov 2006 19:42:39 +0000
From: Peter Stephenson <pws@csr.com>
To: zsh-users@sunsite.dk
Subject: Re: jobs -d &>/dev/null still produces output?
Message-Id: <20061103194239.9587ede2.pws@csr.com>
In-Reply-To: <17393e3e0611031048j2c28e9b4w996c1690926d7b95@mail.gmail.com>
References: <17393e3e0611031048j2c28e9b4w996c1690926d7b95@mail.gmail.com>
Organization: Cambridge Silicon Radio
X-Mailer: Sylpheed version 2.2.9 (GTK+ 2.8.20; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 03 Nov 2006 19:42:39.0595 (UTC) FILETIME=[3887ABB0:01C6FF80]
X-Scanned-By: MailControl A-07-06-70 (www.mailcontrol.com) on 10.68.0.139

"Matt Wozniski" <godlygeek@gmail.com> wrote:
> I'm a bit confused by something zsh is doing.
> 
> Test case:
> 
> sleep 1000 &
> jobs -d &>/dev/null
> 
> Why does this still produce output?

The line you're seeing is the same line that would usually be produced
when, for example, you run "fg" and the process that's brought to the
foreground is running in a different directory.  Since this is purely an
interactive informational message it's directed straight to the terminal.

It's less useful when this happens in the "jobs" command, however, since in
that case the above doesn't apply and you'd expect the output to appear in
one place.  I think it would be more consistent to do what we already
do with other output and send it to stdout rather than the terminal if
it's run from "jobs".

Index: Src/jobs.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/jobs.c,v
retrieving revision 1.48
diff -u -r1.48 jobs.c
--- Src/jobs.c	30 Oct 2006 10:37:18 -0000	1.48
+++ Src/jobs.c	3 Nov 2006 19:41:31 -0000
@@ -954,10 +954,10 @@
 
     if ((lng & 4) || (interact && job == thisjob &&
 		      jn->pwd && strcmp(jn->pwd, pwd))) {
-	fprintf(shout, "(pwd %s: ", (lng & 4) ? "" : "now");
-	fprintdir(((lng & 4) && jn->pwd) ? jn->pwd : pwd, shout);
-	fprintf(shout, ")\n");
-	fflush(shout);
+	fprintf(fout, "(pwd %s: ", (lng & 4) ? "" : "now");
+	fprintdir(((lng & 4) && jn->pwd) ? jn->pwd : pwd, fout);
+	fprintf(fout, ")\n");
+	fflush(fout);
     }
 /* delete job if done */
 
@@ -1827,11 +1827,12 @@
 		printjob(jobtab + job, (stopped) ? -1 : lng, 1);
 	    if (func != BIN_BG) {		/* fg or wait */
 		if (jobtab[job].pwd && strcmp(jobtab[job].pwd, pwd)) {
-		    fprintf(shout, "(pwd : ");
-		    fprintdir(jobtab[job].pwd, shout);
-		    fprintf(shout, ")\n");
+		    FILE *fout = (func == BIN_JOBS) ? stdout : shout;
+		    fprintf(fout, "(pwd : ");
+		    fprintdir(jobtab[job].pwd, fout);
+		    fprintf(fout, ")\n");
+		    fflush(fout);
 		}
-		fflush(shout);
 		if (func != BIN_WAIT) {		/* fg */
 		    thisjob = job;
 		    if ((jobtab[job].stat & STAT_SUPERJOB) &&


To access the latest news from CSR copy this link into a web browser:  http://www.csr.com/email_sig.php

