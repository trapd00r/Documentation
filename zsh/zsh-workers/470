From zsh-workers-request@math.gatech.edu  Wed Oct 18 14:12:53 1995
Received: from gatech.edu (gatech.edu [130.207.244.244]) by werple.net.au (8.7/8.7) with SMTP id OAA23921 for <mason@werple.mira.net.au>; Wed, 18 Oct 1995 14:12:49 +1000 (EST)
Received: from euclid (euclid.skiles.gatech.edu) by gatech.edu with SMTP id AA19523
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Wed, 18 Oct 1995 00:05:15 -0400
Received: by euclid (5.x/SMI-SVR4)
	id AA02111; Wed, 18 Oct 1995 00:03:21 -0400
Resent-Date: Wed, 18 Oct 1995 00:00:29 -0400
Old-Return-Path: <coleman@math.gatech.edu>
Message-Id: <9510180400.AA23776@redwood.skiles.gatech.edu>
X-Mailer: exmh version 1.6.4 10/10/95
To: carlos@snfep1.if.usp.br, hzoli@cs.elte.hu, brian@nds.com
Cc: zsh-workers@math.gatech.edu
Subject: workaround for rsh problem
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Date: Wed, 18 Oct 1995 00:00:29 -0400
From: Richard Coleman <coleman@math.gatech.edu>
Resent-Message-Id: <"SLrSm1.0.vW.8o7Xm"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/470
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

The following workaround for the rsh problem was in the
zsh-2.5.03 sources.  It was removed in the transition from
buildzsh to autoconf.  Currently this workaround is not defined
by default in the zsh baseline, so you will need to add the
RSH_BUG_WORKAROUND to the defines in the Makefile.  The optimal
thing would be to check for this problem in configure, but I don't
know how that could be done.  If we can determine which architectures
for which this is necessary, I'll put a note about this in the
MACHINES file.

rc


*** init.c	1995/10/06 04:08:12	1.55
--- init.c	1995/10/18 03:46:30
***************
*** 318,321 ****
  {
-     long ttpgrp;
      static char *outbuf, *errbuf;
  
--- 318,325 ----
  {
      static char *outbuf, *errbuf;
+     long ttpgrp;
+ 
+ #ifdef RSH_BUG_WORKAROUND
+     int i;
+ #endif
  
***************
*** 333,334 ****
--- 337,347 ----
      setbuffer(stderr, errbuf, BUFSIZ);
+ #endif
+ 
+     /* This works around a bug in some versions of in.rshd *
+      * Currently this is not defined by default.           */
+ #ifdef RSH_BUG_WORKAROUND
+     if (isset('c')) {
+ 	for (i = 3; i < 10; i++)
+ 	    close(i);
+     }
  #endif


