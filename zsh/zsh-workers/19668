From zsh-workers-return-19668-mason-zsh=primenet.com.au@sunsite.dk Sun Mar 21 01:50:09 2004
Return-Path: <zsh-workers-return-19668-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28516 invoked from network); 21 Mar 2004 01:50:08 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 21 Mar 2004 01:50:08 -0000
Received: (qmail 5821 invoked by alias); 21 Mar 2004 01:50:02 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19668
Received: (qmail 5803 invoked from network); 21 Mar 2004 01:50:01 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 21 Mar 2004 01:50:01 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [167.160.213.139] by sunsite.dk (MessageWall 1.0.8) with SMTP; 21 Mar 2004 1:50:0 -0000
Received: from moonbase.zanshin.com (IDENT:schaefer@localhost [127.0.0.1])
	by moonbase.zanshin.com (8.12.11/8.12.11) with ESMTP id i2L1nxwH029294
	for <zsh-workers@sunsite.dk>; Sat, 20 Mar 2004 17:49:59 -0800
Received: (from schaefer@localhost)
	by moonbase.zanshin.com (8.12.11/8.12.11/Submit) id i2L1nx4e029293
	for zsh-workers@sunsite.dk; Sat, 20 Mar 2004 17:49:59 -0800
Received: (from schaefer@localhost)
	by candle.brasslantern.com (8.11.6/8.11.6) id i2L1nnN18813;
	Sat, 20 Mar 2004 17:49:49 -0800
X-Authentication-Warning: candle.brasslantern.com: schaefer set sender to schaefer@closedmail.com using -f
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <1040321014949.ZM18812@candle.brasslantern.com>
Date: Sun, 21 Mar 2004 01:49:49 +0000
In-Reply-To: <20040320214200.GA22845@scowler.net>
Comments: In reply to Clint Adams <schizo@debian.org>
        "Re: Bug#239070: zsh: scp completion expands * too soon (patch)" (Mar 20,  4:42pm)
References: <200403201750.i2KHo83C009843@soup.in.ql.org> 
	<20040320214200.GA22845@scowler.net>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.dk
Subject: Re: Bug#239070: zsh: scp completion expands * too soon (patch)
Cc: 239070@bugs.debian.org
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Envelope-Sender:  <schaefer@closedmail.com>

On Mar 20,  4:42pm, Clint Adams wrote:
}
} I think the tmda-like thing on the zsh lists probably blocked your
} message, so I'm just going to quote your entire report in reply.

bugs.debian.org is probably going to block _my_ reply next, but I'll try
it anyway.

} On Sat, Mar 20, 2004 at 12:50:08PM -0500, Jay Berkenbilt wrote:
} > 
} > In a recent upgrade to zsh, completion for scp broke when resolving
} > remote files.  There are two problems: wildcards are expanded too
} > soon, and completion through symbolic links to directories doesn't
} > work right (no trailing slash is provided).
} > 
} > Here's the patch.
} > 
} > -    remfiles=(${(M)${(f)"$(_call_program files ssh $args -a -x ${IPREFIX%:} ls -d1F ${(Q)PREFIX%%[^./][^/]#}\* 2>/dev/null)"}%%[^/]#(|/)})
} > +    remfiles=(${(M)${(f)"$(ssh $args -a -x ${IPREFIX%:} ls -d1FL ${(Q)PREFIX%%[^./][^/]#}\* 2>/dev/null)"}%%[^/]#(|/)})

Thanks, but this is not the right way to fix the first of these two
issues.  The use of "_call_program files" is intentional, and necessary
for certain zstyle settings to work.

The right solution is simply to put double quotes around the "${(Q)...}\*"
expression.

