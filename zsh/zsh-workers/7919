From zsh-workers-return-7919-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Sep 17 14:27:55 1999
Return-Path: <zsh-workers-return-7919-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18329 invoked from network); 17 Sep 1999 14:27:53 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Sep 1999 14:27:53 -0000
Received: (qmail 5059 invoked by alias); 17 Sep 1999 14:27:44 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7919
Received: (qmail 5051 invoked from network); 17 Sep 1999 14:27:41 -0000
Message-ID: <37E24FD4.30CED0F9@u.genie.co.uk>
Date: Fri, 17 Sep 1999 15:27:32 +0100
From: Oliver Kiddle <opk@u.genie.co.uk>
X-Mailer: Mozilla 4.61 [en] (Win95; I)
X-Accept-Language: en
MIME-Version: 1.0
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: Re: _man only uses $manpath
References: <199909170945.LAA02310@beta.informatik.hu-berlin.de> <19990917085427.B1029@dman.com> <19990917090418.C1029@dman.com>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

Clint Adams wrote:

> And if you want that as a colon-delimited list, you can run
> the manpath binary.

As far as I can tell, running manpath will always work where man -w will
and in other cases such as debian where man -w doesn't so we can use
that. I've attached a basic patch which tries running manpath and
failing that, uses filename expansion to generate a reasonable guessed
manpath. No doubt we'll shortly find that everyone can think of many
more directories which can be in the default manpath. I couldn't think
of a much better way to check the directories other than determining
that they are existing directories. A for loop can be used if someone
can think of a suitable check.

I'm not convinced that it is worth it to parse files in /etc for any
system where a the manpath command exists so I haven't bothered with it.

As an aside, can the filename generation below be put all in one word:
it seems that I can't nest brackets with | and can't do things like (|/)
without getting a zsh: bad pattern error.

Oliver Kiddle

*** _man.old	Fri Sep 17 14:39:09 1999
--- _man	Fri Sep 17 15:08:42 1999
***************
*** 14,19 ****
--- 14,22 ----
    approx="(#a${_comp_correct})"
  fi
  
+ [ "$manpath" ] || manpath=$(manpath 2>/dev/null) || \
+   manpath=( /usr/man(-/N)
/(opt|usr)/(dt|share|X11R6|local)/(cat|)man(-/N) )
+ 
  if [[ $words[2] = (<->*|ln) ]]; then
    rep=(
   
$manpath/(man|cat)${words[2]}/${~approx}$PREFIX${~star}$SUFFIX.<->*(N:t:r)
)

