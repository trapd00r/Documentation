From zsh-workers-return-12341-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Jul 21 13:39:56 2000
Return-Path: <zsh-workers-return-12341-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10682 invoked from network); 21 Jul 2000 13:39:55 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 21 Jul 2000 13:39:55 -0000
Received: (qmail 589 invoked by alias); 21 Jul 2000 13:39:41 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12341
Received: (qmail 582 invoked from network); 21 Jul 2000 13:39:40 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer david.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "Peter Stephenson" <pws@cambridgesiliconradio.com>,
   "Zsh hackers list" <zsh-workers@sunsite.auc.dk>
Subject: RE: Cygwin: environ problem
Date: Fri, 21 Jul 2000 17:39:36 +0400
Message-ID: <000301bff319$1c736600$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="koi8-r"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
In-reply-to: <0FY10078PTYVGJ@la-la.cambridgesiliconradio.com>
Importance: Normal
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4133.2400

> Andrej wrote:
> > We _could_try_ to directly manipulate __cygwin_environ, but I do not
> > like it - who knows, where and how it is used. BTW comments
> imply, that
> > DLLs should actually refer to __cygwin_environ :-)
>
> Without some major rewriting, we may have to: the
> export-related machinery
> assumes it has direct control of the (new) environment's
> memory.  This is
> certainly a contender for the problems people have been
> seeing.  Strange it
> usually works, though.
>

Can you garantee, that no internal libc function and no module will ever
use putenv()? In this case it will happily realloc() environment, thus
getting it out of zsh control again. Oh, even worse, it will try to
realloc() memory, allocated by Zsh. Oops.

BTW the same argument holds for Unix as well.

What's wrong with using "standard" environment?

>
> Is there any chance this could be network-related?

You mean completion speed? Very probable. But in this case my primary
concern is that I cannot see russian filenames :-) I can live with
completion as is.

-andrej

