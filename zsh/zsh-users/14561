From zsh-users-return-14561-mason-zsh=primenet.com.au@zsh.org Thu Nov 12 19:00:40 2009
Return-Path: <zsh-users-return-14561-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23255 invoked by alias); 12 Nov 2009 19:00:40 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14561
Received: (qmail 26608 invoked from network); 12 Nov 2009 19:00:38 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received-SPF: none (proxy.melb.primenet.com.au: domain at benizi.com does not designate permitted sender hosts)
Date: Thu, 12 Nov 2009 14:00:56 -0500 (EST)
From: "Benjamin R. Haskell" <zsh@benizi.com>
To: Zsh Users <zsh-users@zsh.org>
Subject: Using another command's completion function with an alias
Message-ID: <alpine.LNX.2.01.0911121316020.26715@hp.internal>
User-Agent: Alpine 2.01 (LNX 1266 2009-07-14)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

Back in March, Bart Schaefer recommended the following useful advice for 
getting 'sshfs' to use the completion for 'scp':

compdef sshfs=scp

I have several commands that I use regularly that do some setup of the 
environment or other kinds of filtering.  For example, daemontools' 
fixcrio fixes up LF line endings to emit CRLF:

Usage is roughly: fixcrio program [args]
E.g. fixcrio nc mail.example.com smtp

I managed to get the ones that are commands to work the way I want them to 
by using:

compdef commandname=-command-

I also have some that are straightforward enough to set them as 
aliases.

alias noagent='env -u SSH_AGENT_PID -u SSH_AUTH_SOCK'

But, compdef noagent=-command-  doesn't have the desired effect.  I 
instead get the completion for 'env':

$ noagent <C-x><h>
tags in context :completion::complete:-u::
    all-files  (_files _default (eval))
tags in context :completion::complete:env::
    argument-rest  (_arguments _env (eval))

Obviously my completion-fu is still in its infancy.  Is there something 
simple to fix the 'alias' version?

Also, commandname=-command- works fine for my purposes.  But, '-command-' 
is too general: for starters, it also picks up builtins and aliases.  Is 
there something better I should use?

Thanks,
Ben

