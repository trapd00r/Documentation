From zsh-workers-return-14390-mason-zsh=primenet.com.au@sunsite.dk Sat May 19 12:14:47 2001
Return-Path: <zsh-workers-return-14390-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6066 invoked from network); 19 May 2001 12:14:43 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 19 May 2001 12:14:43 -0000
Received: (qmail 9275 invoked by alias); 19 May 2001 12:14:27 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14390
Received: (qmail 9258 invoked from network); 19 May 2001 12:14:25 -0000
Date: Sat, 19 May 2001 05:13:55 -0700 (PDT)
From: Wayne Davison <wayned@users.sourceforge.net>
X-X-Sender:  <wayne@phong.blorf.net>
To: Bart Schaefer <schaefer@candle.brasslantern.com>
Cc: <zsh-workers@sunsite.dk>
Subject: Re: PATCH: Icky little array slice assignment bug
In-Reply-To: <1010518181629.ZM17512@candle.brasslantern.com>
Message-ID: <Pine.LNX.4.33L2.0105190449500.7240-200000@phong.blorf.net>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-1463796991-333254034-990274435=:7240"

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---1463796991-333254034-990274435=:7240
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Fri, 18 May 2001, Bart Schaefer wrote:
> zagzig% a=(x y z)
> zagzig% a[(I)q]=W
> zagzig% echo $a
> x y W x y z

I patched this in a similar way to your diff, but I also made a[(I)q]=W
prepend the 'W' to the array.

> x y W x y z V		<-- this is ok
> zagzig% a[(R)q]=U
> zagzig% echo $a
> U y W x y z V		<-- this is probably unexpected

This is because we currently have a[0] as an alias for a[1].  Did we
have a good reason for that?  I think it would make more sense to have
a[0] return an empty string, while setting it should prepend an element
to the array.  My appended patch goes this route.

> Well, whaddya know; you CAN do an "unshift", you just have to use a
> seemingly-impossible range to accomplish it.

You can also insert a new element anywhere with something like
"a[3,2]=middle".  I think that this is a good thing.

> zagzig% a=(a b c)
> zagzig% a[2,(R)q]=x
> zagzig% echo $a
> a x a b c

Yeah, that's really non-intuitive, isn't it?  You actually told zsh that
you wanted all elements before 2 ("a") before the new string, and all
the elements after 0, ("a b c") after the string.  I think that this
should work the same as a[2,1] -- i.e. it should insert the string
without duplicating any existing elements.  My patch also does this.

If we decide that changing a[0] is a bad idea, I can change $a[(R)q]
to return an empty string when there is no match (rather than the first
element of the array), and I could even make "a[(R)q]=prepend" work
without affecting "a[0]=newfirstelement".  I had such a patch all worked
up when I decided that a[0] should just behave consistently no matter
where the 0 came from.

Thoughts?

..wayne..

---1463796991-333254034-990274435=:7240
Content-Type: TEXT/PLAIN; charset=US-ASCII; name="array.diff"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.33L2.0105190513550.7240@phong.blorf.net>
Content-Description: Array fixes
Content-Disposition: attachment; filename="array.diff"

SW5kZXg6IFNyYy9wYXJhbXMuYw0KQEAgLTEyNTIsOCArMTI1Miw2IEBADQog
CSAgICB9DQogCSAgICBpZiAoc3RhcnQgPiAwKQ0KIAkJc3RhcnQtLTsNCi0J
ICAgIGVsc2UgaWYgKHN0YXJ0ID09IDAgJiYgZW5kID09IDApDQotCQllbmQr
KzsNCiAJICAgIGlmIChzID09IHRicmFjaykgew0KIAkJcysrOw0KIAkJaWYg
KHYtPmlzYXJyICYmIHN0YXJ0ID09IGVuZC0xICYmICFjb20gJiYNCkBAIC0x
NzIxLDggKzE3MTksMTMgQEANCiAJCSB2LT5wbS0+bmFtLCAwKTsNCiAJICAg
IHJldHVybjsNCiAJfQ0KLQlpZiAodi0+aW52ICYmIHVuc2V0KEtTSEFSUkFZ
UykpDQotCSAgICB2LT5zdGFydC0tLCB2LT5lbmQtLTsNCisJaWYgKHYtPmlu
diAmJiB1bnNldChLU0hBUlJBWVMpKSB7DQorCSAgICBpZiAodi0+c3RhcnQg
PiAwKQ0KKwkJdi0+c3RhcnQtLTsNCisJICAgIHYtPmVuZC0tOw0KKwl9DQor
CWlmICh2LT5lbmQgPCB2LT5zdGFydCkNCisJICAgIHYtPmVuZCA9IHYtPnN0
YXJ0Ow0KIAlxID0gb2xkID0gdi0+cG0tPmdldHMuYWZuKHYtPnBtKTsNCiAJ
biA9IGFycmxlbihvbGQpOw0KIAlpZiAodi0+c3RhcnQgPCAwKSB7DQo=
---1463796991-333254034-990274435=:7240--

