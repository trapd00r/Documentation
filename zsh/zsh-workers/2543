From zsh-workers-request@euclid.skiles.gatech.edu Sun Dec 08 05:16:45 1996
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 16425 invoked from network); 8 Dec 1996 05:16:44 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 8 Dec 1996 05:16:44 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id AAA21678; Sun, 8 Dec 1996 00:08:33 -0500 (EST)
Resent-Date: Sun, 8 Dec 1996 00:08:33 -0500 (EST)
From: gwing@primenet.com.au
Message-ID: <19961208050946.16374.qmail@primenet.com.au>
Subject: bug fix: synchronise prompts
To: zsh-workers@math.gatech.edu (zsh-workers)
Date: Sun, 8 Dec 1996 16:09:46 +1100 (EST)
X-Mailer: ELM [version 2.4 PL25]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"Cq_WK1.0.fI5.Grago"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2543
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Heyla,
 Bug fix: regenerate prompts more often - necessary when term size changes.
Previously if you set the terminal width less than pptw (prompt width on
line) there would be a multitude of illegal read and writes.
Now the prompt stuff is synchronous with the text buffers.


*** zle_refresh.c.org	Sun Dec  8 15:48:59 1996
--- zle_refresh.c	Sun Dec  8 16:00:43 1996
***************
*** 70,75 ****
--- 70,76 ----
      int ln;
      static int lwinw = -1, lwinh = -1;	/* last window width & height */
   
+     genprompts();
      winw = columns;  /* terminal width */
      if (isset(SINGLELINEZLE) || termok != TERM_OK)
  	winh = 1;

*** zle_main.c.org	Sun Dec  8 15:48:49 1996
--- zle_main.c	Sun Dec  8 15:59:12 1996
***************
*** 419,425 ****
  	    putc('\r', shout);
  	if (tmout)
  	    alarm(tmout);
- 	genprompts();
  	zleactive = 1;
  	resetneeded = 1;
  	refresh();
--- 419,424 ----

-- 
Geoff Wing [gwing@primenet.com.au]   Technical Manager
  Phone    : +61-3-9818 2977	     PrimeNet - Internet Consultancy
  Facsimile: +61-3-9819 3788	     Web : <URL:http://www.primenet.com.au/>
  Mobile   : 0412 162 441

