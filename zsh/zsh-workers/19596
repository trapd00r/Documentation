From zsh-workers-return-19596-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 10 18:09:39 2004
Return-Path: <zsh-workers-return-19596-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9224 invoked from network); 10 Mar 2004 18:09:39 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 10 Mar 2004 18:09:39 -0000
Received: (qmail 4567 invoked by alias); 10 Mar 2004 18:09:26 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19596
Received: (qmail 4549 invoked from network); 10 Mar 2004 18:09:24 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 10 Mar 2004 18:09:24 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [193.109.254.211] by sunsite.dk (MessageWall 1.0.8) with SMTP; 10 Mar 2004 18:9:24 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-13.tower-36.messagelabs.com!1078942163!4541218
X-StarScan-Version: 5.2.5; banners=-,-,-
X-Originating-IP: [158.234.9.163]
Received: (qmail 3509 invoked from network); 10 Mar 2004 18:09:23 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-13.tower-36.messagelabs.com with SMTP; 10 Mar 2004 18:09:23 -0000
Received: from trentino.logica.co.uk ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id i2AI9NCk028872
	for <zsh-workers@sunsite.dk>; Wed, 10 Mar 2004 18:09:23 GMT
Received: from trentino.logica.co.uk (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP id CF9D379721BE
	for <zsh-workers@sunsite.dk>; Wed, 10 Mar 2004 19:08:38 +0100 (CET)
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <6316.1078935662@csr.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <6316.1078935662@csr.com>
To: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: 4.2.0-pre-3; HP-UX 
Date: Wed, 10 Mar 2004 19:08:38 +0100
Message-ID: <4024.1078942118@trentino.logica.co.uk>

Peter wrote:
> > Warning 942: "module.c", line 429 # Types 'void *' and 'int' are not
> >     assignment-compatible.
> >             ret = dlopen(unmeta(buf), RTLD_LAZY | RTLD_GLOBAL);
> >             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
> 
> Looks like a missing header.

This led me to the problem. It was including dl.h (which contains all
the shl_* functions) instead of dlfcn.h.

With the following patch, the modules now all load and seem to work.

It still isn't 100% though judging by make check.
./A01grammar.ztst: starting.
sh[2]: 14893 Bus error(coredump)
and A04 hangs.

but I'm off home now so that (and the signals stuff) will have to wait.

Oliver

Index: module.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/module.c,v
retrieving revision 1.12
diff -u -r1.12 module.c
--- module.c    29 Oct 2003 19:17:30 -0000      1.12
+++ module.c    10 Mar 2004 17:55:12 -0000
@@ -349,7 +349,7 @@
 #else

 #ifdef HAVE_DLFCN_H
-# if defined(HAVE_DL_H) && defined(__hpux)
+# if defined(HAVE_DL_H) && defined(HPUXDYNAMIC)
 #  include <dl.h>
 # else
 #  include <dlfcn.h>

