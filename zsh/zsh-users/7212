From zsh-users-return-7212-mason-zsh=primenet.com.au@sunsite.dk Sun Mar 21 01:35:03 2004
Return-Path: <zsh-users-return-7212-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28275 invoked from network); 21 Mar 2004 01:35:02 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 21 Mar 2004 01:35:02 -0000
Received: (qmail 28954 invoked by alias); 21 Mar 2004 01:34:52 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 7212
Received: (qmail 28940 invoked from network); 21 Mar 2004 01:34:51 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 21 Mar 2004 01:34:51 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [167.160.213.139] by sunsite.dk (MessageWall 1.0.8) with SMTP; 21 Mar 2004 1:34:50 -0000
Received: from moonbase.zanshin.com (IDENT:schaefer@localhost [127.0.0.1])
	by moonbase.zanshin.com (8.12.11/8.12.11) with ESMTP id i2L1YnaR015211
	for <zsh-users@sunsite.dk>; Sat, 20 Mar 2004 17:34:49 -0800
Received: (from schaefer@localhost)
	by moonbase.zanshin.com (8.12.11/8.12.11/Submit) id i2L1YnE0015210
	for zsh-users@sunsite.dk; Sat, 20 Mar 2004 17:34:49 -0800
Received: (from schaefer@localhost)
	by candle.brasslantern.com (8.11.6/8.11.6) id i2L1Yhw18770
	for schaefer+zsh-users@zanshin.com; Sat, 20 Mar 2004 17:34:43 -0800
X-Authentication-Warning: candle.brasslantern.com: schaefer set sender to schaefer@closedmail.com using -f
Resent-From: Bart Schaefer <schaefer@brasslantern.com>
Resent-Message-Id: <1040321013443.ZM18769@candle.brasslantern.com>
Resent-Date: Sun, 21 Mar 2004 01:34:43 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
Resent-To: schaefer+zsh-users@zanshin.com
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <1040321000001.ZM18557@candle.brasslantern.com>
Date: Sun, 21 Mar 2004 00:00:01 +0000
In-Reply-To: <20040320192851.GG7334@blorf.net>
Comments: In reply to Wayne Davison <wayned@users.sourceforge.net>
        "Re: Wish for rprompt feature" (Mar 20, 11:28am)
References: <cmy4g3am024u$.dlg@thorstenkampe.de> 
	<1040320171038.ZM18075@candle.brasslantern.com> 
	<20040320192851.GG7334@blorf.net>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-users@sunsite.dk
Subject: Re: Wish for rprompt feature
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Envelope-Sender:  <schaefer@closedmail.com>

On Mar 20, 11:28am, Wayne Davison wrote:
} Subject: Re: Wish for rprompt feature
}
} If I use "prompt bart", the spacing prior to the date is missing and I
} get this error:
} 
} prompt_bart_precmd:14: : parameter not set
} 
} I added "unset" to the "setopt localoptions" in prompt_bart_precmd and
} the error went away.  Is that the right fix?

Yes, that is the right fix.  I have it in my copy here at home, but I
apparently never remembered to commit it. :-(

Index: Functions/Prompts/prompt_bart_setup
===================================================================
RCS file: /cvsroot/zsh/zsh/Functions/Prompts/prompt_bart_setup,v
retrieving revision 1.6
diff -u -r1.6 prompt_bart_setup
--- Functions/Prompts/prompt_bart_setup 11 Apr 2001 22:25:27 -0000      1.6
+++ Functions/Prompts/prompt_bart_setup 20 Mar 2004 23:49:03 -0000
@@ -58,7 +58,7 @@
 }
 
 prompt_bart_precmd () {
-    setopt localoptions noxtrace noksharrays
+    setopt localoptions noxtrace noksharrays unset
     local zero='%([BSUbsu]|{*%})'
 
     # Using psvar here protects against unwanted promptsubst expansions.
@@ -111,7 +111,7 @@
 }
 
 prompt_bart_winch () {
-    setopt localoptions noksharrays
+    setopt localoptions noksharrays unset
 
     # Delete ourself from TRAPWINCH if not using our precmd insert.
     [[ $functions[precmd] = *prompt_bart_precmd* ]] && prompt_bart_ps1 ||
@@ -119,7 +119,7 @@
 }
 
 prompt_bart_setup () {
-    setopt localoptions noksharrays
+    setopt localoptions noksharrays unset
 
     # A few extra niceties ...
     repeat 1 case "$1:l" in

