From zsh-workers-return-13962-mason-zsh=primenet.com.au@sunsite.dk Thu Apr 12 15:31:21 2001
Return-Path: <zsh-workers-return-13962-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23135 invoked from network); 12 Apr 2001 15:31:21 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 12 Apr 2001 15:31:21 -0000
Received: (qmail 17056 invoked by alias); 12 Apr 2001 15:31:18 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13962
Received: (qmail 17044 invoked from network); 12 Apr 2001 15:31:17 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010412152857.ZM31425@candle.brasslantern.com>
Date: Thu, 12 Apr 2001 15:28:56 +0000
In-Reply-To: <545wv8qb31n.fsf@icd.teradyne.com>
Comments: In reply to Vin Shelton <shelton@icd.teradyne.com>
        "Build Failures on SunOS-4.1 and 5.5" (Apr 12, 10:33am)
References: <545wv8qb31n.fsf@icd.teradyne.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Vin Shelton <shelton@icd.teradyne.com>, zsh-workers@sunsite.auc.dk
Subject: Re: Build Failures on SunOS-4.1 and 5.5
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Apr 12, 10:33am, Vin Shelton wrote:
} Subject: Build Failures on SunOS-4.1 and 5.5
}
} Yesterday's changes to terminfo.c were no good for SunOS-4.1 and
} SunOS-5.5.

The problem is that Src/system.h globally includes <termcap.h> when it
exists, but that clashes with <curses.h> and/or <term.h> where they're
wanted in terminfo.c.

<termcap.h> or an equivalent is needed in init.c for tgetstr() and in
zle_refresh.c for tgoto().  Src/prototypes.h has the necessary proto-
types to avoid this, but they're #ifndef HAVE_TERMCAP_H.

Since configure won't find terminfo once it's found termcap, I believe
a minimal workaround is the patch that follows.  Much more extensive
fiddling is going to be necessary if we really want to use both termcap
and terminfo simultaneously.

Please let me know if this gets your build working again.

Index: Src/Modules/terminfo.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/terminfo.c,v
retrieving revision 1.12
diff -u -r1.12 terminfo.c
--- Src/Modules/terminfo.c	2001/04/12 04:08:37	1.12
+++ Src/Modules/terminfo.c	2001/04/12 14:53:35
@@ -29,17 +29,17 @@
 
 #include "terminfo.mdh"
 #include "terminfo.pro"
+
+static char terminfo_nam[] = "terminfo";
+
+/**/
+#ifdef HAVE_TIGETSTR
 #ifdef HAVE_CURSES_H
 # include <curses.h>
 #endif
 #ifdef HAVE_TERM_H
 # include <term.h>
 #endif
-
-static char terminfo_nam[] = "terminfo";
-
-/**/
-#ifdef HAVE_TIGETSTR
 
 static Param terminfo_pm;
 

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

