From zsh-workers-return-20340-mason-zsh=primenet.com.au@sunsite.dk Thu Sep 09 12:42:06 2004
Return-Path: <zsh-workers-return-20340-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14014 invoked from network); 9 Sep 2004 12:42:05 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 9 Sep 2004 12:42:05 -0000
Received: (qmail 50386 invoked from network); 9 Sep 2004 12:41:59 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 Sep 2004 12:41:59 -0000
Received: (qmail 23400 invoked by alias); 9 Sep 2004 12:41:46 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20340
Received: (qmail 23385 invoked from network); 9 Sep 2004 12:41:46 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 9 Sep 2004 12:41:46 -0000
Received: (qmail 49949 invoked from network); 9 Sep 2004 12:41:00 -0000
Received: from mail36.messagelabs.com (193.109.254.211)
  by a.mx.sunsite.dk with SMTP; 9 Sep 2004 12:40:53 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-15.tower-36.messagelabs.com!1094733652!9140061
X-StarScan-Version: 5.2.10; banners=-,-,-
X-Originating-IP: [158.234.9.163]
Received: (qmail 29573 invoked from network); 9 Sep 2004 12:40:52 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-15.tower-36.messagelabs.com with SMTP; 9 Sep 2004 12:40:52 -0000
Received: from trentino.logica.co.uk ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id i89CeqSt009240
	for <zsh-workers@sunsite.dk>; Thu, 9 Sep 2004 13:40:52 +0100
Received: from trentino.logica.co.uk (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP id 4B5A6791B004
	for <zsh-workers@sunsite.dk>; Thu,  9 Sep 2004 14:40:28 +0200 (CEST)
To: zsh-workers@sunsite.dk (Zsh hackers list)
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <200409091113.i89BDHcG013466@news01.csr.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <200409091113.i89BDHcG013466@news01.csr.com>
Subject: Re: Trial patch for showing completion in progress 
Date: Thu, 09 Sep 2004 14:40:27 +0200
Message-ID: <4018.1094733627@trentino.logica.co.uk>
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

Peter wrote:
> I often want to find out what completion is doing when it goes away for
> a while.  Here's a simple patch that helps, though I think there's more
> that can be done.  No documentation yet.

In most cases, if it takes a while it is filename completion trying to
look for files in the full path: the stuff which allows /u/l/b to
complete to /usr/local/bin.

> As defined, you set the show-completer style to true in any context
> where you want to show the status.  It is examined when each element of
> the completer list is tried.  The message is overwritten by any list
> output.
> 
> Is there a better place for this?  On the whole I think this point is OK.

It depends what you are trying to do. Are you trying to show the
completers or the zstyle context? _main_complete is not the only place
the context is changed so for showing the context, _description or
_setup would be a better place.

> Is there a way of doing this only if completion takes a certain time?
> E.g. store SECONDS as floating point and examine it at certain key
> points?

Why not just stick $SECONDS (as floating point) in PS4 and use
_complete_debug.

I'm not convinced we should be sticking debug stuff like this into
completion unless it really is proven to be useful. I normally prefer to
use a second tty for completion debug output instead of zle. And it
isn't hard to make temporary changes to _main_complete (or whatever) for
debugging.

> Is there a way of removing the zle -M output if the completion produced
> no output?

Either you have to replace compadd with a function or, depending on
where you produce the debug, you might be able to check
compstate[nmatches].

Oliver

