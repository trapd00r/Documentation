From zsh-users-return-11464-mason-zsh=primenet.com.au@sunsite.dk Mon Apr 30 12:20:31 2007
Return-Path: <zsh-users-return-11464-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21350 invoked from network); 30 Apr 2007 12:20:29 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.8 (2007-02-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO
	autolearn=ham version=3.1.8
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 30 Apr 2007 12:20:29 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 12834 invoked from network); 30 Apr 2007 12:20:23 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 30 Apr 2007 12:20:23 -0000
Received: (qmail 23783 invoked by alias); 30 Apr 2007 12:20:14 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11464
Received: (qmail 23773 invoked from network); 30 Apr 2007 12:20:13 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 30 Apr 2007 12:20:13 -0000
Received: (qmail 11603 invoked from network); 30 Apr 2007 12:20:13 -0000
Received: from main.gmane.org (HELO ciao.gmane.org) (80.91.229.2)
  by a.mx.sunsite.dk with SMTP; 30 Apr 2007 12:20:10 -0000
Received: from list by ciao.gmane.org with local (Exim 4.43)
	id 1HiUrM-0006ew-LF
	for zsh-users@sunsite.dk; Mon, 30 Apr 2007 14:20:04 +0200
Received: from de-lt-054776l.eu.frd.uu.net ([62.191.185.105])
        by main.gmane.org with esmtp (Gmexim 0.1 (Debian))
        id 1AlnuQ-0007hv-00
        for <zsh-users@sunsite.dk>; Mon, 30 Apr 2007 14:20:04 +0200
Received: from kai by de-lt-054776l.eu.frd.uu.net with local (Gmexim 0.1 (Debian))
        id 1AlnuQ-0007hv-00
        for <zsh-users@sunsite.dk>; Mon, 30 Apr 2007 14:20:04 +0200
X-Injected-Via-Gmane: http://gmane.org/
To: zsh-users@sunsite.dk
From:  Kai Grossjohann <kai@emptydomain.de>
Subject:  How to add completion: variant of "make" command
Date:  Mon, 30 Apr 2007 14:19:53 +0200
Lines: 26
Message-ID:  <868xca9hqu.fsf@ketchup.de.uu.net>
Mime-Version:  1.0
Content-Type:  text/plain; charset=us-ascii
X-Complaints-To: usenet@sea.gmane.org
X-Gmane-NNTP-Posting-Host: de-lt-054776l.eu.frd.uu.net
User-Agent: Gnus/5.110006 (No Gnus v0.6) Emacs/22.0.97 (gnu/linux)
Cancel-Lock: sha1:nAM7bI23s3QZTvwrMacgZXmGgvk=
Sender: news <news@sea.gmane.org>

I would like to configure zsh to support completion of make targets,
in the following setup.  I have no idea how to go about this: Where to
start reading docs, for instance.

* Our Makefiles depend on the environment because they contain
  "include $(FOO)" where FOO comes from the environment.

* I have a shell script, say "xmake", that

  - searches for a project root directory amongst the ancestors of the
    current directory, then
  - changes into that directory (if found),
  - then sources a file ENV from that directory (if it exists), and
    finally
  - invokes regular "make".

  (The shell script also prints GNU-style "Entering directory `foo'"
  and "Leaving directory `foo'" messages to enable Emacs to parse the
  error messages.)

So how do I make a variant of "make" completion that does what the
shell script does before it invokes regular "make" completion?

Thanks,
Kai


