From zsh-users-return-11927-mason-zsh=primenet.com.au@sunsite.dk Thu Oct 04 16:56:03 2007
Return-Path: <zsh-users-return-11927-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18439 invoked from network); 4 Oct 2007 16:55:55 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 4 Oct 2007 16:55:55 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 97010 invoked from network); 4 Oct 2007 16:55:49 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Oct 2007 16:55:49 -0000
Received: (qmail 27424 invoked by alias); 4 Oct 2007 16:55:42 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11927
Received: (qmail 27407 invoked from network); 4 Oct 2007 16:55:41 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 4 Oct 2007 16:55:41 -0000
Received: (qmail 95881 invoked from network); 4 Oct 2007 16:55:41 -0000
Received: from cluster-g.mailcontrol.com (85.115.41.190)
  by a.mx.sunsite.dk with SMTP; 4 Oct 2007 16:55:34 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly04g.srv.mailcontrol.com (MailControl) with ESMTP id l94GrlSH005934
	for <zsh-users@sunsite.dk>; Thu, 4 Oct 2007 17:55:28 +0100
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Thu, 4 Oct 2007 17:55:24 +0100
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.1/8.13.4) with ESMTP id l94GtOWi016648
	for <zsh-users@sunsite.dk>; Thu, 4 Oct 2007 17:55:24 +0100
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.1/8.14.1/Submit) with ESMTP id l94GtOvC016645
	for <zsh-users@sunsite.dk>; Thu, 4 Oct 2007 17:55:24 +0100
Message-Id: <200710041655.l94GtOvC016645@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-users@sunsite.dk
Subject: Re: menu-select doesn't work with zle -C/_describe
In-reply-to: <20071004142214.GC22954@plenz.com>
References: <20071004142214.GC22954@plenz.com>
Comments: In-reply-to Julius Plenz <julius@plenz.com>
   message dated "Thu, 04 Oct 2007 16:22:14 +0200."
Date: Thu, 04 Oct 2007 17:55:24 +0100
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 04 Oct 2007 16:55:24.0729 (UTC) FILETIME=[5BAAE290:01C806A7]
X-Scanned-By: MailControl A-07-08-10 (www.mailcontrol.com) on 10.71.0.114

Julius Plenz wrote:
... abbreviated to the following effect ...
> _x() {
>     local -a x expl
>     x=(one two three four)
>     _wanted files expl 'xxx' compadd -a x
> }
> zle -C x menu-select _x
> bindkey '^Xx' x
> 
> When I press Ctrl-X x now, the menu is printed with a caption and the
> prompt is re-printed below it, but I am not able to select anything
> from the menu (no entry is highlighted).

The function is OK (the _wanted form is the preferred one) but
entering the completion system directly at menu-select is likely to do
odd things---most of the controls assume the completion system itself is
in charge of setting up menus etc.

Try using the function in the following manner (this replaces your "zle
-C" line):

zle -C x complete-word _generic
zstyle ':completion:x:*' completer _x
zstyle ':completion:x:*' menu select

Now you're entering the completion system the normal way, but with the
styles set to use menu selection.  This should work better.  Obviously,
if you use a more descriptive name, the "x"s in the style context need
to change, too.

See the description of the _generic completer in the zshcompsys manual.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

