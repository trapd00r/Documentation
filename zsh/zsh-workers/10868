From zsh-workers-return-10868-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Apr 20 11:00:45 2000
Return-Path: <zsh-workers-return-10868-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1145 invoked from network); 20 Apr 2000 11:00:40 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 20 Apr 2000 11:00:40 -0000
Received: (qmail 5384 invoked by alias); 20 Apr 2000 11:00:32 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10868
Received: (qmail 5375 invoked from network); 20 Apr 2000 11:00:31 -0000
Date: Thu, 20 Apr 2000 13:00:30 +0200 (MET DST)
Message-Id: <200004201100.NAA28705@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Thu, 20 Apr 2000 13:35:58 +0400
Subject: Re: Some problems with list scrolling and  menu selection


Andrej Borsenkow wrote:

> 1. The default for starting menu selection is less than user friendly.
> Normally, menu selection is started on the second TAB (assuming more or
> less standard config; zstyle output follows). With list scrolling TAB
> first pages to the end of list and only then starts selection. I think,
> TAB should behave the same way here as well. Probably, "least surprise"
> for user would be, when TAB in list scrolling jumps to the first shown
> match (and not to the very first item in the list). Consider usage - you
> first find needed page and then select needed item there.

Hm, `less than user friendly'? See also below: the reference to
10816. Currently, the listing code is intentionally separated from the 
menu-selection code to make the listing code (including scrolling)
work on (almost) every terminal.

For the jump-into-menu-selection-now: I'm not sure if this is really
more user friendly. And remember, that any widget without special
meaning stops listing and is executed right away, so:

  bindkey -M listscroll '^I' .menu-select

Is that enough? If we document it?

> 2. There are problems with scrolling back in menu selection. Try GNU
> diff (with verbose on). I did it on dtterm from TriTeal TED 4.2 with
> 24x80 size.
>
> ...
> 
> Note, that the line just under the prompt disappears.

A nasty off-by-one error when displaying matches with line-oriented
display strings. You probably guessed that.

> 3. Is it possible to retain current Zle line (prompt) at the top when
> listing completions? Like menu selection does it. I find it somewhat
> confusing as it is.
> 
> 4. And, of course, scrolling back in completion listing :-)

Have you read 10816?

Bye
 Sven

Index: Src/Zle/complist.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/complist.c,v
retrieving revision 1.4
diff -u -r1.4 complist.c
--- Src/Zle/complist.c	2000/04/19 06:49:37	1.4
+++ Src/Zle/complist.c	2000/04/20 10:53:45
@@ -1122,21 +1122,12 @@
 		    n = lastn;
 		    nl = lastnl;
 		    lastused = 1;
+		    pnl = 0;
 		} else
 		    p = g->matches;
 
 		for (; (m = *p); p++) {
 		    if (m->disp && (m->flags & CMF_DISPLINE)) {
-			if (!lasttype && ml >= mlbeg) {
-			    lasttype = 2;
-			    lastg = g;
-			    lastbeg = mlbeg;
-			    lastml = ml;
-			    lastp = p;
-			    lastn = n;
-			    lastnl = nl;
-			    lastused = 1;
-			}
 			if (pnl) {
 			    if (dolistnl(ml) && compprintnl(ml))
 				goto end;
@@ -1147,6 +1138,16 @@
 				if (tccan(TCCLEAREOD))
 				    tcout(TCCLEAREOD);
 			    }
+			}
+			if (!lasttype && ml >= mlbeg) {
+			    lasttype = 2;
+			    lastg = g;
+			    lastbeg = mlbeg;
+			    lastml = ml;
+			    lastp = p;
+			    lastn = n;
+			    lastnl = nl;
+			    lastused = 1;
 			}
 			if (mfirstl < 0)
 			    mfirstl = ml;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

