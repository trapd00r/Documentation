From zsh-workers-return-8617-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Nov 11 11:17:20 1999
Return-Path: <zsh-workers-return-8617-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4102 invoked from network); 11 Nov 1999 11:17:15 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 11 Nov 1999 11:17:15 -0000
Received: (qmail 20970 invoked by alias); 11 Nov 1999 10:04:28 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8617
Received: (qmail 19203 invoked from network); 11 Nov 1999 09:59:55 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <991111095903.ZM19087@candle.brasslantern.com>
Date: Thu, 11 Nov 1999 09:59:03 +0000
In-Reply-To: <199911100819.JAA27910@beta.informatik.hu-berlin.de>
Comments: In reply to Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
        "suggested PATCH" (Nov 10,  9:19am)
References: <199911100819.JAA27910@beta.informatik.hu-berlin.de>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>,
        zsh-workers@sunsite.auc.dk
Subject: Re: suggested PATCH
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Nov 10,  9:19am, Sven Wischnowsky wrote:
} Subject: suggested PATCH
}
} If you exit a shell with running jobs you get this `n jobs SIGHUPed'
} message. Exiting is done in zexit(), which calls killrunjobs(), which
} in turn prints that message using zerr() -- and that sets errflag=1.

Seems to me that ought to be calling zwarn().

} So this patch makes the returned value in mathevall() be initialised
} to zero

That's good.

} but it also makes errflag be reset in zexit(). It's that last 
} part I'm not so sure about -- maybe you all like this history-saving-
} avoidance?

No, that's got to be wrong.  Since killrunjobs() is never called from
anywhere except zexit(), I think using zwarn() rather than setting and
then clearing errflag is the way to go.

So, my suggestion is to use only the math.c hunk of Sven's patch, and
use this instead of the builtin.c hunk:

Index: Src/signals.c
===================================================================
@@ -576,7 +576,7 @@
                 killed++;
         }
     if (killed)
-        zerr("warning: %d jobs SIGHUPed", NULL, killed);
+        zwarn("warning: %d jobs SIGHUPed", NULL, killed);
 }
 
 

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

