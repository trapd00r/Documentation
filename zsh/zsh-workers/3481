From zsh-workers-request@math.gatech.edu Mon Sep 08 11:00:23 1997
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 8381 invoked from network); 8 Sep 1997 11:00:22 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 8 Sep 1997 11:00:22 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id GAA11647;
	Mon, 8 Sep 1997 06:51:58 -0400 (EDT)
Resent-Date: Mon, 8 Sep 1997 06:51:58 -0400 (EDT)
To: Mark Borges <mdb@cdc.noaa.gov>
cc: ZSH mailing list <zsh-workers@math.gatech.edu>
Subject: Re: [list abuse] bug in /bin/csh and /usr/local/bin/tcsh? 
In-reply-to: Your message of "05 Sep 1997 14:16:16 MDT."
Date: Mon, 08 Sep 1997 11:52:06 +0100
Message-ID: <5767.873715926@dis.strath.ac.uk>
From: Duncan Sinclair <sinclair@dis.strath.ac.uk>
Resent-Message-ID: <"QXtwL2.0.wr2.DZz4q"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3481
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu


>Q: Why do /bin/csh and /usr/local/bin/tcsh, as part of their startup
>   process, do an lstat of every directory in the root partition where
>   the shell was invoked?

They both do a getwd() call, which does the lstat()s.

The problem is that getwd() needs to search through each directory
as it moves up the file system heirarchy.  If they stumble across
a dead NFS mount, they hang.

For sh, it doesn't try to maintain a "PWD" variable, so it couldn't
care less.

For ksh, and zsh, it first tries to see if "HOME" or "PWD" is
the actual current working directory.  If so, they don't need
to do the getwd() call.

This is *the* feature I was prepared to sell my soul for when
Paul F. was first writing zsh, those many years ago.

The general solution, almost a mantra in some unix news groups,
is that you shouldn't NFS mount *anything* in /.

You might want to try a symlink to a more secure mount point.



Duncan.

