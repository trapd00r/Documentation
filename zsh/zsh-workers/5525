From zsh-workers-return-5525-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Feb 25 12:13:14 1999
Return-Path: <zsh-workers-return-5525-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2047 invoked from network); 25 Feb 1999 12:13:13 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 25 Feb 1999 12:13:13 -0000
Received: (qmail 20054 invoked by alias); 25 Feb 1999 12:12:52 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5525
Received: (qmail 20047 invoked from network); 25 Feb 1999 12:12:51 -0000
Date: Thu, 25 Feb 1999 13:11:59 +0100 (MET)
Message-Id: <199902251211.NAA29445@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Peter Stephenson's message of Thu, 25 Feb 1999 12:14:05 +0100
Subject: Re: globcomplete bug + bug when compctl.so not loaded + init patch


Peter Stephenson wrote:

> This doesn't seem to fix it for me; there's still something wrong in
> addmatch() on the same test:
> 
> % setopt globcomplete
> % setopt glob*e<TAB>

Sorrysorrysorry, tested it only with files (ahem).

Bye
 Sven

--- os/Zle/zle_tricky.c	Wed Feb 24 16:09:57 1999
+++ Src/Zle/zle_tricky.c	Thu Feb 25 13:08:49 1999
@@ -4272,8 +4272,10 @@
 	    mpl = fpl; msl = fsl;
 	} else {
 	    if ((cp = filecomp)) {
-		if ((test = domatch(s, filecomp, 0)))
+		if ((test = domatch(s, filecomp, 0))) {
+		    e = s + sl;
 		    cc = 1;
+		}
 	    } else {
 		e = s + sl - fsl;
 		if ((test = !strncmp(s, fpre, fpl)))
@@ -4340,9 +4342,10 @@
 		  ((addwhat & CC_EXCMDS)  && !(hn->flags & DISABLED)))) ||
 		((addwhat & CC_BINDINGS) && !(hn->flags & DISABLED))))) {
 	if (sl >= rpl + rsl || mstack) {
-	    if (cp)
+	    if (cp) {
 		test = domatch(s, patcomp, 0);
-	    else {
+		e = s + sl;
+	    } else {
 		e = s + sl - rsl;
 		if ((test = !strncmp(s, rpre, rpl)))
 		    if ((test = !strcmp(e, rsuf))) {

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

