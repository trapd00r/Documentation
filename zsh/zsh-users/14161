From zsh-users-return-14161-mason-zsh=primenet.com.au@sunsite.dk Fri May 22 14:36:58 2009
Return-Path: <zsh-users-return-14161-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26927 invoked from network); 22 May 2009 14:36:55 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 22 May 2009 14:36:55 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 56268 invoked from network); 22 May 2009 14:36:39 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 22 May 2009 14:36:39 -0000
Received: (qmail 13993 invoked by alias); 22 May 2009 14:36:20 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 14161
Received: (qmail 13980 invoked from network); 22 May 2009 14:36:20 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 22 May 2009 14:36:20 -0000
Received: from vms173019pub.verizon.net (vms173019pub.verizon.net [206.46.173.19])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 253D480307FA
	for <zsh-users@sunsite.dk>; Fri, 22 May 2009 16:36:15 +0200 (CEST)
Received: from torch.brasslantern.com ([96.249.201.13])
 by vms173019.mailsrvcs.net
 (Sun Java(tm) System Messaging Server 6.3-7.04 (built Sep 26 2008; 32bit))
 with ESMTPA id <0KK100CDTV8E3APA@vms173019.mailsrvcs.net> for
 zsh-users@sunsite.dk; Fri, 22 May 2009 09:36:15 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id n4MEaDKa016716	for
 <zsh-users@sunsite.dk>; Fri, 22 May 2009 07:36:13 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id n4MEaCSo016715	for zsh-users@sunsite.dk; Fri,
 22 May 2009 07:36:12 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <090522073612.ZM16714@torch.brasslantern.com>
Date: Fri, 22 May 2009 07:36:12 -0700
In-reply-to: <20090522081926.GV27141@prunille.vinc17.org>
Comments: In reply to Vincent Lefevre <vincent@vinc17.org>
 "Re: prompt and ssh" (May 22, 10:19am)
References: <e7db6e960905190954j7be72739p6b521bca8e90fe7f@mail.gmail.com>
	<20090519200217.35368.qmail@smasher.org>
	<20090521074103.GN27141@prunille.vinc17.org>
	<090521092207.ZM14221@torch.brasslantern.com>
	<20090522010850.GU27141@prunille.vinc17.org>
	<090521203747.ZM15323@torch.brasslantern.com>
	<20090522081926.GV27141@prunille.vinc17.org>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: zsh-users@sunsite.dk
Subject: Re: prompt and ssh
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii
X-Virus-Scanned: ClamAV 0.94.2/9381/Fri May 22 15:21:20 2009 on bifrost
X-Virus-Status: Clean

On May 22, 10:19am, Vincent Lefevre wrote:
} Subject: Re: prompt and ssh
}
} On 2009-05-21 20:37:47 -0700, Bart Schaefer wrote:
} > On May 22,  3:08am, Vincent Lefevre wrote:
} > } 3. Resume the screen session from a different ssh connection (e.g.
} > }    because the first one has died -- BTW, this is even one of the
} > }    reasons of using screen).
} > 
} > ... is one of the situations the netstat test is meant to discover.
} 
} No, because the port $SSH_CONNECTION[(w)2] is, in general, not
} the same.

Yes, exactly.  So the grep would not find that connection in the output
of netstat, the "else" branch would be taken, and you'd know that you
need to reload the value of SSH_CONNECTION from somewhere.

As I said, though, it's harmless to simply always reload the values, so
in this context the test is only of academic interest.

I noticed while testing that always reloading has an additional benefit:
You pick up changes in the SSH_AGENT environment.  A useful extension
would be to pick up changes in forwarded X11 connections, etc.

} 1. If a screen session is resumed or if a -S option is provided, then
}    $STY can be guessed by parsing the options, and possibly by using
}    the output of "screen -ls", e.g. in case of "screen -r".
} 
} 2. If a screen session doesn't exist yet and a -S option isn't
}    provided, then do not create a file: create it from the screen
}    session.

If you read the two functions I posted, this is in fact what they do,
though I didn't bother handling the "-r" case.

}   -R   attempts to resume the youngest (in terms of creation time)
}        detached screen session it finds.
} 
} As the creation time is provided by "screen -ls", it is possible
} to find the session name.
} 
} > } When resuming a screen session, one should detect
} > } which one, and use a filename corresponding to this session.
} > 
} > I don't know any good way to do that from "outside" of screen.  Maybe
} > something involving using the -X option could be hacked up.
} 
} See above.

Parsing the output of screen -ls in order to sort by date is not what
I'd call a "good way". :-)  In any event it's not something I'm
interested in working out; so, left as an exercise.

