From zsh-workers-request@math.gatech.edu  Tue Jul 11 03:59:16 1995
Received: from gatech.edu (gatech.edu [130.207.244.244]) by werple.mira.net.au (8.6.12/8.6.9) with SMTP id DAA13567 for <mason@werple.mira.net.au>; Tue, 11 Jul 1995 03:59:13 +1000
Received: from math (math.skiles.gatech.edu) by gatech.edu with SMTP id AA23556
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Mon, 10 Jul 1995 13:59:46 -0400
Received: by math (5.x/SMI-SVR4)
	id AA22294; Mon, 10 Jul 1995 13:56:40 -0400
Resent-Date: Mon, 10 Jul 1995 19:55:42 +0100 (MET DST)
Old-Return-Path: <hzoli@cs.elte.hu>
From: hzoli@cs.elte.hu (Zoltan Hidvegi)
Message-Id: <9507101755.AA07857@turan.elte.hu>
Subject: Re: Doc fix for :s/l/r/ modifier
To: kaefer@aglaia.snafu.de (Thorsten Meinecke)
Date: Mon, 10 Jul 1995 19:55:42 +0100 (MET DST)
In-Reply-To: <m0sULiv-00000PC@aglaia.snafu.DE> from "Thorsten Meinecke" at Jul 8, 95 00:18:11 am
X-Mailer: ELM [version 2.4 PL21]
Content-Type: text
Sender: hzoli@cs.elte.hu
Resent-Message-Id: <"4g6cm.0.CS5.MdM0m"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/194
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Thorsten Meinecke wrote:
> Since aeons, the error message for `!:s//r/' (and no previous match) is:
> 
>     zsh: no previous substitution with &
> 
> This is at least confusing for the casual user.

If this substitution gives an error, then the parameter modifier sould also
give error. Here is a patch for that. It depends on my previous patch for
:s//r/ (art. 176).

Zoltan

*** 1.13	1995/07/07 15:59:57
--- Src/subst.c	1995/07/10 17:51:04
***************
*** 1476,1485 ****
  		    zsfree(hsubl);
  		    hsubl = ztrdup(ptr1);
  		}
! 		if (hsubl)
! 		    for (tt = hsubl; *tt; tt++)
! 			if (INULL(*tt))
! 			    chuck(tt);
  		for (tt = hsubr = ztrdup(ptr2); *tt; tt++)
  		    if (INULL(*tt))
  			chuck(tt);
--- 1476,1488 ----
  		    zsfree(hsubl);
  		    hsubl = ztrdup(ptr1);
  		}
! 		if (!hsubl) {
! 		    zerr("no previous substitution", NULL, 0);
! 		    return;
! 		}
! 		for (tt = hsubl; *tt; tt++)
! 		    if (INULL(*tt))
! 			chuck(tt);
  		for (tt = hsubr = ztrdup(ptr2); *tt; tt++)
  		    if (INULL(*tt))
  			chuck(tt);

