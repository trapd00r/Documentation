From zsh-workers-return-10317-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Mar 29 17:21:01 2000
Return-Path: <zsh-workers-return-10317-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21926 invoked from network); 29 Mar 2000 17:20:59 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 29 Mar 2000 17:20:59 -0000
Received: (qmail 17841 invoked by alias); 29 Mar 2000 17:20:47 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10317
Received: (qmail 17803 invoked from network); 29 Mar 2000 17:20:44 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000329171958.ZM20502@candle.brasslantern.com>
Date: Wed, 29 Mar 2000 17:19:58 +0000
In-Reply-To: <E12Zgt3-0000L5-00.2000-03-27-22-17-25@cmailg1.svr.pol.co.uk>
Comments: In reply to Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
        "Bugs with exclusion using file paths." (Mar 26, 11:17pm)
References: <E12Zgt3-0000L5-00.2000-03-27-22-17-25@cmailg1.svr.pol.co.uk>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Peter Stephenson <pws@pwstephenson.fsnet.co.uk>,
        zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: Re: Bugs with exclusion using file paths.
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Mar 26, 11:17pm, Peter Stephenson wrote:
} Subject: Bugs with exclusion using file paths.
}
} 1. Some idiot messed up the exclusion of absolute paths
} 2. print **/*~(.)# dumped core
} 
} We need some real globbing tests to pick up this sort of thing; pattern
} matching in tests is insensitive to it.

Here's a patch to 11glob.ztst .. but like Sven I get piles of BUG: output,
so some of the other tests fail as well, and on top of that the **/~(.)#
test still dumps core for me even after applying 10284.  And even before
applying 10284, I *sometimes* got success, and other times got core dumps,
from the /*~/* test.

Index: Test/11glob.ztst
===================================================================
@@ -3,6 +3,13 @@
 %prep
   globtest () { $ZTST_testdir/../Src/zsh -f $ZTST_srcdir/../Misc/$1 }
 
+  regress_absolute_path_and_core_dump() {
+    local absolute_srcdir=$(cd $ZTST_srcdir/.. && pwd -P) || return 1
+    setopt localoptions extendedglob nonomatch
+    print $absolute_srcdir/*~/*
+    print $absolute_srcdir/**/*~(.)#
+  }
+
 %test
 
   globtest globtests
@@ -234,3 +241,6 @@
 >0:  [[ FOO = @(bar|(#i)foo) ]]
 >0:  [[ Modules = (#i)*m* ]]
 >0 tests failed.
+
+  ( regress_absolute_path_and_core_dump )
+0:exclusions regression test

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

