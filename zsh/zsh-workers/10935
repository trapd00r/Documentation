From zsh-workers-return-10935-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Apr 26 16:39:02 2000
Return-Path: <zsh-workers-return-10935-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7593 invoked from network); 26 Apr 2000 16:39:01 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 26 Apr 2000 16:39:01 -0000
Received: (qmail 2986 invoked by alias); 26 Apr 2000 16:38:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10935
Received: (qmail 2943 invoked from network); 26 Apr 2000 16:38:45 -0000
Date: Wed, 26 Apr 2000 17:37:59 +0100
From: Adam Spiers <adam@spiers.net>
To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Subject: PATCH: bugfixes for _rpm
Message-ID: <20000426173759.A11067@thelonious.new.ox.ac.uk>
Reply-To: Adam Spiers <adam@spiers.net>
Mail-Followup-To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 1.0.1i
X-Home-Page: http://www.new.ox.ac.uk/~adam/
X-OS: RedHat Linux

rpm --recompile takes a src.rpm as argument, and rpm --rmsource takes
a spec file as argument.

--rmsource completion still doesn't work exactly as I'd like it to
after the patch is applied - it completes all files, not just *.spec.
Have I done something wrong, or do I have to finally take the plunge
and try to understand the file-patterns style?

As a result of this doubt, I haven't committed it to CVS yet.


Index: Completion/Linux/_rpm
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Linux/_rpm,v
retrieving revision 1.6
diff -u -r1.6 _rpm
--- Completion/Linux/_rpm	2000/04/17 08:42:18	1.6
+++ Completion/Linux/_rpm	2000/04/26 16:33:22
@@ -70,8 +70,9 @@
   '--erase:*:uninstall:->uninstall' \
   -'b+[build mode (spec file)]:build stage:((p\:execute\ \%prep\ stage l\:do\ a\ list\ check c\:execute\ build\ stage i\:execute\ install\ stage b\:build\ a\ binary\ package a\:build\ binary\ and\ source\ packages)):*:build:->build_b' \
   -'t+[build mode (tar file)]:build stage:((p\:execute\ \%prep\ stage l\:do\ a\ list\ check c\:execute\ build\ stage i\:execute\ install\ stage b\:build\ a\ binary\ package a\:build\ binary\ and\ source\ packages)):*:build:->build_t' \
-  --{rmsource,recompile,resign,addsign}':*:RPM package:->package' \
-  '--rebuild:*:Src RPM files:->package_src' \
+  --{resign,addsign}':*:RPM package:->package' \
+  '--rmsource:*:spec file:->spec_file' \
+  --{rebuild,recompile}':*:Src RPM files:->package_src' \
     '-K+[signature check mode]:*:sigcheck:->sigcheck' \
   '--checksig:*:sigcheck:->sigcheck' \
   '--rebuilddb:*:rebuild:->rebuild' && ret=0
@@ -198,13 +199,17 @@
     _wanted packages expl 'RPM package' \
         compadd -M 'r:|-=* r:|=*' - $(_call packages rpm -qa) && ret=0
     ;;
+  spec_file)
+    _wanted specfiles expl 'spec file' \
+        _files "$expl[@]" -g \*.spec && ret=0
+    ;;
   package_file)
     if compset -P ftp://; then
       _hosts -S/ && ret=0
     else
       _alternative \
           'files:RPM package file:_files -g \*.\(\#i\)rpm' \
-	  'prefixes:ftp URL prefix:compadd ftp://' && ret=0
+          'prefixes:ftp URL prefix:compadd ftp://' && ret=0
     fi
     ;;
   package_src)

