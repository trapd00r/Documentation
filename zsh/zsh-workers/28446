From zsh-workers-return-28446-mason-zsh=primenet.com.au@zsh.org Wed Nov 24 21:14:44 2010
Return-Path: <zsh-workers-return-28446-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29489 invoked by alias); 24 Nov 2010 21:14:44 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28446
Received: (qmail 27426 invoked from network); 24 Nov 2010 21:14:33 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.0 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FROM,MISSING_HEADERS,RCVD_IN_DNSWL_NONE,
	T_TO_NO_BRKTS_FREEMAIL autolearn=no version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.213.43 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:content-type:mime-version
         :subject:from:in-reply-to:date:cc:content-transfer-encoding
         :message-id:references:x-mailer;
        bh=D5KpYQ1VmU5TAKIrpsVxXwqS/uhQb66viNCVLOUB8d4=;
        b=Ro2bcItMwK2YrTzkUXiTR0U6G4gmlF+nMx3ooMr1cJydSgLltZaPpzLtV0lul4DNIk
         KW82guGkYZOxTvAaVE4CdmyGtN+iz184uWAnAeTbIKpNhqZAI0o+U3SyHFPjkAklHmzv
         GuSWfUIlGddSn5kmFOJpSOI/oMaspvPDc4JiE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=content-type:mime-version:subject:from:in-reply-to:date:cc
         :content-transfer-encoding:message-id:references:x-mailer;
        b=dvqhKlW+aU59cvkzaSWaYx9Jjl4XudNnAbFTyeIgDVjSxsNQ/vZLhT0pQYf27uE9h8
         ytfDr3YhbzYWy4HJb9xS8BXxTWxvl10z4jbSqv4CpGDSOWo5wAwQa1EcwLUGhXYf9G1B
         QI5IIYtW/rddsUdDek/nO2zs+5bhBXYB1ii4o=
Content-Type: text/plain; charset=windows-1252
Mime-Version: 1.0 (Apple Message framework v1082)
Subject: Re: Mac OS X Prompt Bug
From: Sorin Ionescu <sorin.ionescu@gmail.com>
In-Reply-To: <alpine.LNX.2.01.1011241242320.2792@hp>
Date: Wed, 24 Nov 2010 16:14:28 -0500
Cc: zsh-workers@zsh.org
Content-Transfer-Encoding: quoted-printable
Message-Id: <2A1FA6CC-8EE8-4E01-AE40-5F02F4F340AE@gmail.com>
References: <BAB9C52A-B68A-4B5A-99C2-F85B310B1380@gmail.com> <20101124153007.GF1727@prunille.vinc17.org> <9ADAD50F-12F2-4B0A-A494-F339583AEDEC@gmail.com> <alpine.LNX.2.01.1011241242320.2792@hp>
X-Mailer: Apple Mail (2.1082)

There is no /etc/zshprofile, /etc/zshrc or any other combination. =
/etc/profile is not sourced.

I have found nothing in the output of zsh -l -x. Like I said, it=92s not =
a configuration issue. It=92s something in ZSH or Terminal.app or both. =
Nothing hooks on those functions. It=92s possible that ZSH outputs some =
sequences Terminal.app does not like and generates those lines. Perhaps, =
they are invisible characters.

Output of zsh -l -x.

krustyroo% zsh -l -x
+/etc/zshenv:2> [ -x /usr/libexec/path_helper ']'
+/etc/zshenv:3> /usr/libexec/path_helper -s
+/etc/zshenv:3> eval =
'PATH=3D"/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin:/Users/=
sorin/.local/bin:/Users/sorin/.local/sbin";' export 'PATH;'
+(eval):1> =
PATH=3D/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin:/Users/so=
rin/.local/bin:/Users/sorin/.local/sbin=20
+(eval):1> export PATH


On 24 Nov 2010, at 12:49, Benjamin R. Haskell wrote:

> On Wed, 24 Nov 2010, Sorin Ionescu wrote:
>=20
>> Yes, iTerm2 does not have this problem. While unsetopt PROMPT_SP =
removes the %, the blank lines are still echoed. The easiest way to test =
this is to touch ~/.hushlogin and open Terminal.app. Notice the =
scrollbar.
>>=20
>> So, PROMPT_SP is definitely not the problem. It seems the prompt is =
being pushed down by the blank lines. Hence why % is not being =
overwritten by the prompt in the screenshot.
>=20
> So, figure out what's printing out the blank lines.
>=20
> You mentioned /etc/zshenv.  What about /etc/zshprofile or /etc/zshrc? =
Or maybe even /etc/profile, which is often sourced by system Zsh startup =
files, depending on how Zsh is distributed.
>=20
> Maybe see if something is set up with hook functions:
>=20
> $ functions preexec precmd chpwd periodic TRAPDEBUG
>=20
> As a last resort, try to run Zsh with tracing enabled:
>=20
> zsh -x  (then Ctrl-d or quit)
> [produces lots of output, but maybe near the end you'll see something =
printing out some blank lines]
>=20
> Might need: zsh -l -x
> (not sure how you start your commands in OS X terminal)
>=20
> --=20
> Best,
> Ben

