From zsh-users-return-14097-mason-zsh=primenet.com.au@sunsite.dk Wed May 06 10:12:53 2009
Return-Path: <zsh-users-return-14097-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26579 invoked from network); 6 May 2009 10:12:40 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 6 May 2009 10:12:40 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 31474 invoked from network); 6 May 2009 10:12:28 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 6 May 2009 10:12:28 -0000
Received: (qmail 15043 invoked by alias); 6 May 2009 10:12:08 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 14097
Received: (qmail 15032 invoked from network); 6 May 2009 10:12:08 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 6 May 2009 10:12:08 -0000
Received: from vms173019pub.verizon.net (vms173019pub.verizon.net [206.46.173.19])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 81B1F82D4B6C
	for <zsh-users@sunsite.dk>; Wed,  6 May 2009 12:11:38 +0200 (CEST)
Received: from torch.brasslantern.com ([96.249.201.13])
 by vms173019.mailsrvcs.net
 (Sun Java(tm) System Messaging Server 6.3-7.04 (built Sep 26 2008; 32bit))
 with ESMTPA id <0KJ700J7MWBNU7Q2@vms173019.mailsrvcs.net> for
 zsh-users@sunsite.dk; Wed, 06 May 2009 05:11:48 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id n46ABk0e013090	for
 <zsh-users@sunsite.dk>; Wed, 06 May 2009 03:11:47 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id n46ABkNY013089	for zsh-users@sunsite.dk; Wed,
 06 May 2009 03:11:46 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <090506031146.ZM13088@torch.brasslantern.com>
Date: Wed, 06 May 2009 03:11:46 -0700
In-reply-to: <20090505195410.2b220325@pws-pc>
Comments: In reply to Peter Stephenson <p.w.stephenson@ntlworld.com>
 "Re: Set difference between sets of files" (May  5,  7:54pm)
References: <94de1b620905050936g442490e4t3da42ac3946cb29@mail.gmail.com>
	<20090505175739.7b2e4aca@news01>	<090505110010.ZM12545@torch.brasslantern.com>
	<20090505195410.2b220325@pws-pc>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: zsh-users@sunsite.dk
Subject: Re: Set difference between sets of files
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii
X-Virus-Scanned: ClamAV 0.92.1/9333/Wed May  6 05:55:26 2009 on bifrost
X-Virus-Status: Clean

On May 5,  7:54pm, Peter Stephenson wrote:
} Subject: Re: Set difference between sets of files
}
} On Tue, 05 May 2009 11:00:10 -0700
} Bart Schaefer <schaefer@brasslantern.com> wrote:
} > typeset -A differ
} > eval differ\[${(q)^MASTER_FILES}\]=a
} > eval differ\[${(q)^BACKUP_FILES}\]=b
} > print -l -- ${(k)differ[(R)a]}
} 
} I was trying to come up with something that "just works", which is
} difficult if you're manipulating variable substitution and usually ends
} up looking like a bus smash.

Thd following is arcane, but seems to do the trick:

MASTER_FILES=('a[b' '$cd' 'ef}' 'g h' 1 2 3)
BACKUP_FILES=('a[b' '$cd' 'ef}')

typeset -A differ
eval 'differ[${:-'${(q)^BACKUP_FILES}'}]=b'
eval 'differ[${:-'${(q)^MASTER_FILES}'}]=a'
print -l -- ${(k)differ[(R)b]}

I still can't get the "unset" approach to work.  (Note I had the order
of operations reversed in my original example, it's the backup less the
master that's wanted in this case.)

The above came from the epiphany that the (shorter to type but longer
to execute)

for f in $BACKUP_FILES; differ[$f]=b
for f in $MASTER_FILES; differ[$f]=a

works fine, merely requiring an additional local "f".  So the trick is
to force parameter substitution, thereby subverting the subscript magic
almost-but-not-quite double-quoting.

} ("Bus smash" may be British slang; it indicates ugliness.)

I got the ugliness, but if that's rhyming slang I haven't managed to
un-rhyme it.

