From zsh-workers-return-16756-mason-zsh=primenet.com.au@sunsite.dk Mon Mar 04 14:53:05 2002
Return-Path: <zsh-workers-return-16756-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22772 invoked from network); 4 Mar 2002 14:53:04 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 4 Mar 2002 14:53:04 -0000
Received: (qmail 24952 invoked by alias); 4 Mar 2002 14:52:58 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16756
Received: (qmail 24938 invoked from network); 4 Mar 2002 14:52:57 -0000
Date: Mon, 4 Mar 2002 08:51:51 -0600
Subject: zsh breaks configure scripts
Content-Type: text/plain; charset=US-ASCII; format=flowed
Mime-Version: 1.0 (Apple Message framework v481)
Cc: fink-devel@lists.sourceforge.net
To: zsh-workers@sunsite.dk
From: Eric Norum <eric.norum@usask.ca>
Content-Transfer-Encoding: 7bit
Message-Id: <5CD7CBD8-2F7F-11D6-9666-00039366A118@usask.ca>
X-Mailer: Apple Mail (2.481)

Apple uses zsh as /bin/sh on Mac OS X.  Unfortunately zsh has a 
`feature' that breaks many autoconf configure scripts.  The scripts 
contain lines like:
if test "`CDPATH=:; cd $srcdir && pwd`" != "`pwd`" && .......

The problem is that the zsh cd command insists on printing the directory!

The offending code is in cd_new_pwd() in Src/builtins.c around line 1047:
    if (unset(PUSHDSILENT) && func != BIN_CD && isset(INTERACTIVE))
         printdirstack();
     else if (doprintdir) {
         fprintdir(pwd, stdout);
         putchar('\n');
     }

I suggest that the fprintdir/putchar be called only in interactive 
shells:
    if (unset(PUSHDSILENT) && func != BIN_CD && isset(INTERACTIVE))
         printdirstack();
     else if (doprintdir && isset(INTERACTIVE)) {
         fprintdir(pwd, stdout);
         putchar('\n');
     }

--
Eric Norum <eric.norum@usask.ca>
Department of Electrical Engineering
University of Saskatchewan
Saskatoon, Canada.
Phone: (306) 966-5394   FAX:   (306) 966-5407

