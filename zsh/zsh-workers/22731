From zsh-workers-return-22731-mason-zsh=primenet.com.au@sunsite.dk Sun Sep 17 22:53:50 2006
Return-Path: <zsh-workers-return-22731-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23990 invoked from network); 17 Sep 2006 22:53:49 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.5 (2006-08-29) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 17 Sep 2006 22:53:49 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 77354 invoked from network); 17 Sep 2006 22:53:43 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Sep 2006 22:53:43 -0000
Received: (qmail 6114 invoked by alias); 17 Sep 2006 22:53:40 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22731
Received: (qmail 6104 invoked from network); 17 Sep 2006 22:53:39 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 17 Sep 2006 22:53:39 -0000
Received: (qmail 77049 invoked from network); 17 Sep 2006 22:53:39 -0000
Received: from vms044pub.verizon.net (206.46.252.44)
  by a.mx.sunsite.dk with SMTP; 17 Sep 2006 22:53:39 -0000
Received: from torch.brasslantern.com ([71.116.118.106])
 by vms044.mailsrvcs.net
 (Sun Java System Messaging Server 6.2-4.02 (built Sep  9 2005))
 with ESMTPA id <0J5R00MUME87M100@vms044.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Sun, 17 Sep 2006 17:52:55 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id k8HMqsXH000314	for
 <zsh-workers@sunsite.dk>; Sun, 17 Sep 2006 15:52:54 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id k8HMqsPH000313	for zsh-workers@sunsite.dk; Sun,
 17 Sep 2006 15:52:54 -0700
Date: Sun, 17 Sep 2006 15:52:54 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: PATCH: functrace [was Re: funcstack and backtraces]
In-reply-to: <20060917191418.GA22898@scowler.net>
To: zsh-workers@sunsite.dk
Message-id: <060917155254.ZM312@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <20060901191034.GA31335@scowler.net>
	<060904142643.ZM9472@torch.brasslantern.com>
	<20060917191418.GA22898@scowler.net>
Comments: In reply to Clint Adams <clint@zsh.org>
 "PATCH: functrace [was Re: funcstack and backtraces]" (Sep 17,  3:14pm)

On Sep 17,  3:14pm, Clint Adams wrote:
} Subject: PATCH: functrace [was Re: funcstack and backtraces]
}
} This is buggy when either FUNCTIONARGZERO is unset, int is larger than
} 64-bits, or... I forget.

Adding an extra level of function stack avoids the crash, but this
still doesn't look right to me:

schaefer<505> (bar() { foo } ; foo() { print $functrace } ; bar )
bar:0 Src/zsh:bar:0

No mention of "foo" at all?  Whose idea of useful is that?  And here:

schaefer<506> (baz() { bar }; 
 bar() { foo } ;                                   
 foo() { print $functrace } ;      
 baz )
bar:0 baz:0 Src/zsh:bar:0

What does that it mean that "bar" is at both ends of the stack?

You're right about it being buggy when functionargzero is not set.
Even the examples above that don't crash when it is set, crash when
it is not set (with effectively the same backtrace).

