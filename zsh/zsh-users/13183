From zsh-users-return-13183-mason-zsh=primenet.com.au@sunsite.dk Tue Sep 02 08:45:07 2008
Return-Path: <zsh-users-return-13183-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22914 invoked from network); 2 Sep 2008 08:45:04 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 2 Sep 2008 08:45:04 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 14252 invoked from network); 2 Sep 2008 08:44:34 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 2 Sep 2008 08:44:34 -0000
Received: (qmail 9387 invoked by alias); 2 Sep 2008 08:43:50 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13183
Received: (qmail 9362 invoked from network); 2 Sep 2008 08:43:48 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 2 Sep 2008 08:43:48 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [208.87.233.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 600D88030848
	for <zsh-users@sunsite.dk>; Tue,  2 Sep 2008 10:43:44 +0200 (CEST)
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly27g.srv.mailcontrol.com (MailControl) with ESMTP id m828hfCX021466
	for <zsh-users@sunsite.dk>; Tue, 2 Sep 2008 09:43:42 +0100
Received: from news01 ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Tue, 2 Sep 2008 09:43:22 +0100
Date: Tue, 2 Sep 2008 09:43:22 +0100
From: Peter Stephenson <pws@csr.com>
To: <zsh-users@sunsite.dk>
Subject: Re: Capitalization tuning
Message-ID: <20080902094322.69a5e519@news01>
In-Reply-To: <20080902083645.3516@blackhawk>
References: <20080831093724.444@blackhawk>
	<237967ef0808302014s150e5aedtaea77d6cffbdf0f6@mail.gmail.com>
	<20080902083645.3516@blackhawk>
Organization: CSR
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.8; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 02 Sep 2008 08:43:22.0080 (UTC) FILETIME=[F4C4A600:01C90CD7]
X-Scanned-By: MailControl A-08-50-13 (www.mailcontrol.com) on 10.71.0.137
X-Virus-Scanned: ClamAV 0.92.1/8137/Tue Sep  2 04:07:16 2008 on bifrost
X-Virus-Status: Clean

On Tue, 02 Sep 2008 08:36:45 +0900
"d.henman" <dhenman@gmail.com> wrote:
> zsh-developers:
>   I would be willing to write a new or modify the existing expansion flag
>   code for (C) capitalize,  so that it would use an array or list of word
>   separators, which a user could set, or allow the users to supply a word
>   seperator list list s:separator-list: for example, for filenames I
>   usually always, s/ /_/ , get rid of spaces in names, which apparently
>   the existing C flags treats write as a space.
> 
> I have never looked at the source code.  But, there's always a first
> time.  If someone would lead to where the 'c' parameter expansion flag
> processing done, I'd look at it.  If it has too many interactions with
> other code, I'd leave it be as it might not be worth the effort.  Any ideas?

It's in casemodify() in hist.c.  You could add, say, K as a flag with
delimiters like s and a string of additional word characters to do this; that
would be in paramsubst() in subst.c (which is very complicated).  You'd
need to pass the string down to casemodify() to be used if it wasn't NULL.

The big complication is with multibyte characters; you'd need to convert
the delimiters into an array of wide characters, remembering the string is
metafied (there are functions to handle this sort of conversion which are
already used for the string to be capitalized itself).

None of this is that different from things the shell does anyway, but a lot
of it probably isn't obvious at first sight.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

