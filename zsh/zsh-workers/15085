From zsh-workers-return-15085-mason-zsh=primenet.com.au@sunsite.dk Tue Jun 26 06:26:30 2001
Return-Path: <zsh-workers-return-15085-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7726 invoked from network); 26 Jun 2001 06:26:30 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 26 Jun 2001 06:26:30 -0000
Received: (qmail 9065 invoked by alias); 26 Jun 2001 06:25:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15085
Received: (qmail 9047 invoked from network); 26 Jun 2001 06:25:38 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010626062416.ZM143@candle.brasslantern.com>
Date: Tue, 26 Jun 2001 06:24:16 +0000
In-Reply-To: <4a8d442eb8vincent@vinc17.org>
Comments: In reply to Vincent Lefevre <vincent@vinc17.org>
        "New behaviour for HIST_IGNORE_SPACE option" (Jun 19, 11:52pm)
References: <4a8d442eb8vincent@vinc17.org>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.dk, Vincent Lefevre <vincent@vinc17.org>
Subject: Re: New behaviour for HIST_IGNORE_SPACE option
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

[Moved to -workers]

On Jun 19, 11:52pm, Vincent Lefevre wrote:
} Subject: New behaviour for HIST_IGNORE_SPACE option
}
} It seems that the behaviour of HIST_IGNORE_SPACE has changed in
} zsh 4.0.1, and I don't like the new one.

Sorry to have let this languish so long without a reply.  We did think
about putting an option in for the old behavior and it's mostly my fault
that there isn't one.

In the course of considering possible workarounds, I discovered that the
new behavior has in fact introduced a few bugs.  If you use `print -s'
between commands -- e.g., from precmd, or from completion as happens
with _complete_debug -- while there is a history entry pending space-
deletion, the history becomes garbled:  The entry that was added with
`print -s' appears twice, once on either side of the one that should
have been deleted, and the deletion never happens.

It seems to me that `print -s' should simply perform the deletion at
once, replacing the pending entry with the new one.

On a prossibly-unrelated note, `print -s' with no arguments results in
"BUG: attempt to free storage at invalid address" when the next command
is executed:

schaefer[514] print -s
schaefer[517] echo foo
BUG: attempt to free storage at invalid address
foo
schaefer[519] allopt hist
appendhistory         on
banghist              on
cshjunkiehistory      off
extendedhistory       off
histallowclobber      off
histbeep              on
histexpiredupsfirst   on
histfindnodups        on
histignorealldups     off
histignoredups        on
histignorespace       off
histnofunctions       off
histnostore           off
histreduceblanks      on
histsavenodups        off
histverify            off
incappendhistory      off
sharehistory          off


Wayne, are you out there?

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

