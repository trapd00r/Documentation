From zsh-workers-return-26408-mason-zsh=primenet.com.au@sunsite.dk Fri Jan 23 00:51:13 2009
Return-Path: <zsh-workers-return-26408-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18436 invoked from network); 23 Jan 2009 00:51:10 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 Jan 2009 00:51:10 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 26768 invoked from network); 23 Jan 2009 00:51:04 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 Jan 2009 00:51:04 -0000
Received: (qmail 13311 invoked by alias); 23 Jan 2009 00:51:00 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26408
Received: (qmail 13292 invoked from network); 23 Jan 2009 00:51:00 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 23 Jan 2009 00:51:00 -0000
Received: from QMTA06.westchester.pa.mail.comcast.net (qmta06.westchester.pa.mail.comcast.net [76.96.62.56])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 8F60580271F0
	for <zsh-workers@sunsite.dk>; Fri, 23 Jan 2009 01:50:53 +0100 (CET)
Received: from OMTA02.westchester.pa.mail.comcast.net ([76.96.62.19])
	by QMTA06.westchester.pa.mail.comcast.net with comcast
	id 6bTB1b0070QuhwU56oqt95; Fri, 23 Jan 2009 00:50:53 +0000
Received: from smtp.klanderman.net ([98.217.254.247])
	by OMTA02.westchester.pa.mail.comcast.net with comcast
	id 6oqt1b0015M2Np63NoqtQb; Fri, 23 Jan 2009 00:50:53 +0000
Received: from lwm.klanderman.net (unknown [192.168.100.50])
	by smtp.klanderman.net (Postfix) with ESMTP id C9E64B30148
	for <zsh-workers@sunsite.dk>; Thu, 22 Jan 2009 19:50:51 -0500 (EST)
Received: by lwm.klanderman.net (Postfix, from userid 500)
	id ACB579FC5EF; Thu, 22 Jan 2009 19:50:51 -0500 (EST)
From: Greg Klanderman <gak@klanderman.net>
To: zsh-workers@sunsite.dk
Subject: Re: PATCH: add zle-line-finish special widget
Reply-To: gak@klanderman.net
Date: Thu, 22 Jan 2009 19:50:51 -0500
In-Reply-To: <090117100812.ZM23494@torch.brasslantern.com> (Bart Schaefer's message of "Sat, 17 Jan 2009 10:08:12 -0800")
Message-ID: <m37i4m3kwk.fsf@klanderman.net>
User-Agent: Gnus/5.1007 (Gnus v5.10.7) XEmacs/21.4.17 (linux)
References: <18789.30656.261463.382208@gargle.gargle.HOWL>
	<20090110095231.GA61601@redoubt.spodhuis.org>
	<m33afq97gg.fsf@klanderman.net>
	<20090111025418.GA7272@redoubt.spodhuis.org>
	<m3tz857mkm.fsf@klanderman.net>
	<090111110748.ZM12349@torch.brasslantern.com>
	<m3r63975pd.fsf@klanderman.net> <m3ocyd70aj.fsf@klanderman.net>
	<090111193317.ZM12655@torch.brasslantern.com>
	<m3k5916unp.fsf@klanderman.net> <m33afix0x0.fsf_-_@klanderman.net>
	<090117100812.ZM23494@torch.brasslantern.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Scanned: ClamAV 0.92.1/8893/Thu Jan 22 21:18:43 2009 on bifrost
X-Virus-Status: Clean

>>>>> Bart Schaefer <schaefer@brasslantern.com> writes:

> Refreshing my memory of the code a bit, I'm coming
> to the conclusion that the test should be:

>     if (done && !exit_pending && !errflag &&
>     	(initthingy = rthingy_nocreate("zle-line-finish"))) {

> At the very least it should check (done && !exit_pending), even if
> it ignores the state of errflag.

Either of those should be OK by me.. would you like me to
test one or the other a bit and re-submit the patch?

>>>>> Peter Stephenson <p.w.stephenson@ntlworld.com> writes:

> I don't know if this is correct or not---it really depends what
> zle-line-finish is designed to do.  If it's a catch-all tidy up, it
> probably *should* run and then you probably should set errflag to 0
> after saving the surrounding value.

Right.. for my current use case it doesn't really matter whether it
runs in the error case or not.  I'm not sure which semantics is best
in general.  If one wanted to use it for some cleanup, or messing with
font colors or whatever, you might want it to run always.

thanks,
Greg

