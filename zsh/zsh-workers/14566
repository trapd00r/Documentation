From zsh-workers-return-14566-mason-zsh=primenet.com.au@sunsite.dk Wed May 30 10:37:20 2001
Return-Path: <zsh-workers-return-14566-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9730 invoked from network); 30 May 2001 10:37:19 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 30 May 2001 10:37:19 -0000
Received: (qmail 29989 invoked by alias); 30 May 2001 10:37:13 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14566
Received: (qmail 29972 invoked from network); 30 May 2001 10:37:12 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer david.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "ZSH Workers Mailing List" <zsh-workers@sunsite.dk>
Subject: More C02cond tweaking
Date: Wed, 30 May 2001 14:37:09 +0400
Message-ID: <000e01c0e8f4$7abe9af0$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----=_NextPart_000_000F_01C0E916.01D03AF0"
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
Importance: Normal
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4522.1200

This is a multi-part message in MIME format.

------=_NextPart_000_000F_01C0E916.01D03AF0
Content-Type: text/plain;
	charset="koi8-r"
Content-Transfer-Encoding: 7bit

This adds more tests for unsuported features.

-x test in current form fails (under some conditions); the change works
almost - currently it fails if test directory is on SAMBA (or, probably, any
network) drive.

-N does not work on Cygwin. I mailed cygwin list as it looks like a bug
(AFAIK both FAT/NTFS support notion of different access and modification
times).

/dev/fd is not supported on Cygwin so -e and -O obviously failed. Manual
says, that it is emulated - but I am not sure, in which context it can be
used.

-andrej

------=_NextPart_000_000F_01C0E916.01D03AF0
Content-Type: application/octet-stream;
	name="zsh-c02cond.diff"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename="zsh-c02cond.diff"

Index: Test/C02cond.ztst=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /cvsroot/zsh/zsh/Test/C02cond.ztst,v=0A=
retrieving revision 1.6=0A=
diff -u -r1.6 C02cond.ztst=0A=
--- Test/C02cond.ztst	2001/05/28 16:33:54	1.6=0A=
+++ Test/C02cond.ztst	2001/05/30 10:27:28=0A=
@@ -21,6 +21,9 @@=0A=
 =0A=
   touch unmodish=0A=
   chmod 000 unmodish=0A=
+=0A=
+  print 'MZ' > cmd.exe=0A=
+  chmod +x cmd.exe=0A=
 %test=0A=
 =0A=
   [[ -a zerolength && ! -a nonexistent ]]=0A=
@@ -92,7 +95,7 @@=0A=
   [[ -u modish && ! -u zerolength ]]=0A=
 0:-u cond=0A=
 =0A=
-  [[ -x $ZTST_srcdir/ztst.zsh && ! -x zerolength ]]=0A=
+  [[ -x cmd.exe && ! -x zerolength ]]=0A=
 0:-x cond=0A=
 =0A=
   [[ -z $bar && -z '' && ! -z $foo ]]=0A=
@@ -113,7 +116,12 @@=0A=
   sleep 1=0A=
   cat unmodified=0A=
   touch newnewnew=0A=
-  [[ -N newnewnew && ! -N unmodified ]]=0A=
+  if [[ $OSTYPE =3D=3D "cygwin" ]]; then=0A=
+    print -u8 "Warning: not testing [[ -N file ]] (not supported on =
Cygwin)"=0A=
+    true=0A=
+  else=0A=
+    [[ -N newnewnew && ! -N unmodified ]]=0A=
+  fi=0A=
 0:-N cond=0A=
 =0A=
   [[ newnewnew -nt zerolength && ! (unmodified -nt zerolength) ]]=0A=
@@ -146,11 +154,21 @@=0A=
   [[ 1 -lt 2 || 2 -lt 2 && 3 -gt 4 ]]=0A=
 0:|| and && in conds=0A=
 =0A=
-  [[ -e /dev/fd/0 ]]=0A=
-0:/dev/fd support in conds handled by access=0A=
+  if ! grep '#define PATH_DEV_FD' $ZTST_testdir/../config.h; then=0A=
+    print -u8 "Warning: not testing [[ -e /dev/fd/0 ]] (/dev/fd not =
supported)"=0A=
+    true=0A=
+  else=0A=
+    [[ -e /dev/fd/0 ]]=0A=
+  fi=0A=
+0dD:/dev/fd support in conds handled by access=0A=
 =0A=
-  [[ -O /dev/fd/0 ]]=0A=
-0:/dev/fd support in conds handled by stat=0A=
+  if ! grep '#define PATH_DEV_FD' $ZTST_testdir/../config.h; then=0A=
+    print -u8 "Warning: not testing [[ -O /dev/fd/0 ]] (/dev/fd not =
supported)"=0A=
+    true=0A=
+  else=0A=
+    [[ -O /dev/fd/0 ]]=0A=
+  fi=0A=
+0dD:/dev/fd support in conds handled by stat=0A=
 =0A=
   [[ ( -z foo && -z foo ) || -z foo ]]=0A=
 1:complex conds with skipping=0A=

------=_NextPart_000_000F_01C0E916.01D03AF0--

