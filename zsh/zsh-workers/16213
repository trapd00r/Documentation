From zsh-workers-return-16213-mason-zsh=primenet.com.au@sunsite.dk Sat Nov 03 01:19:56 2001
Return-Path: <zsh-workers-return-16213-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29309 invoked from network); 3 Nov 2001 01:19:56 -0000
Received: from ns2.primenet.com.au (HELO primenet.com.au) (?ILpUgpKsFCcB1k22rw6WO0bNsOnANSM5?@203.24.36.3)
  by ns1.primenet.com.au with SMTP; 3 Nov 2001 01:19:56 -0000
Received: (qmail 15925 invoked from network); 3 Nov 2001 01:19:55 -0000
Received: from sunsite.dk (130.225.247.90)
  by proxy.melb.primenet.com.au with SMTP; 3 Nov 2001 01:19:55 -0000
Received: (qmail 22640 invoked by alias); 3 Nov 2001 01:19:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16213
Received: (qmail 22629 invoked from network); 3 Nov 2001 01:19:48 -0000
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <011102171936.ZM4732@candle.brasslantern.com>
Date: Fri, 2 Nov 2001 17:19:36 -0800
In-Reply-To: <11955.1004723898@csr.com>
Comments: In reply to Peter Stephenson <pws@csr.com>
        "Sort of PATCH: local completions" (Nov  2,  5:58pm)
References: <11955.1004723898@csr.com>
X-Mailer: Z-Mail Lite (5.0.0 30July97)
To: Peter Stephenson <pws@csr.com>, zsh-workers@sunsite.dk (Zsh hackers list)
Subject: Re: Sort of PATCH: local completions
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Nov 2,  5:58pm, Peter Stephenson wrote:
> Subject: Sort of PATCH: local completions
> I'm sure this can be done much better.  This modifies the normal way of
> choosing a context-sensitive completion to allow you to have a special form
> in a particular directory. [...]
> 
> There is no way of making styles local.  This would take a certain amount
> of internal hacking.  [...]

Hrm.  I think the way I'd approach this whole "local completions" issue is
to alter the context used by the styles in the first place.

E.g., suppose the file .zcompcontext contains the string "zsh-source":

    chpwd() {
	[[ -f .zcompcontext ]] && curcontext="$(<.zcompcontext)":::
    }
    zstyle+ ':completion:zsh-source:*:make:*:targets' call-command yes
          + '' command _make_for_zsh_source

This is overloading the `function' field of the context, but what the hell.

You could still read the file with `source' instead, I suppose, and thus put
all the zstyle commands right there in the file, but the code would have to
get a whole lot more paranoid to avoid trojan horses.
-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

