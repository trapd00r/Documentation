From zsh-workers-return-24555-mason-zsh=primenet.com.au@sunsite.dk Fri Feb 15 22:29:39 2008
Return-Path: <zsh-workers-return-24555-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23926 invoked from network); 15 Feb 2008 22:29:27 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 15 Feb 2008 22:29:27 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 6572 invoked from network); 15 Feb 2008 22:29:23 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 15 Feb 2008 22:29:23 -0000
Received: (qmail 13775 invoked by alias); 15 Feb 2008 22:29:20 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24555
Received: (qmail 9946 invoked from network); 15 Feb 2008 20:11:18 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 15 Feb 2008 20:11:18 -0000
Received: from mal35-2-82-225-70-234.fbx.proxad.net (mal35-2-82-225-70-234.fbx.proxad.net [82.225.70.234])
	by bifrost.dotsrc.org (Postfix) with ESMTP id F250680482A1
	for <zsh-workers@sunsite.dk>; Fri, 15 Feb 2008 21:11:14 +0100 (CET)
Received: from localhost (server.nasreddine.info [127.0.0.1])
	by mal35-2-82-225-70-234.fbx.proxad.net (Postfix) with ESMTP id 94BBC23C86
	for <zsh-workers@sunsite.dk>; Fri, 15 Feb 2008 21:11:15 +0100 (CET)
X-Virus-Scanned: amavisd-new at nasreddine.com
Received: from mal35-2-82-225-70-234.fbx.proxad.net ([127.0.0.1])
	by localhost (server.nasreddine.info [127.0.0.1]) (amavisd-new, port 10024)
	with LMTP id 0FEZQVZbWmSX for <zsh-workers@sunsite.dk>;
	Fri, 15 Feb 2008 21:11:05 +0100 (CET)
Received: from phoenix.nasreddine.info (phoenix.nasreddine.info [192.168.1.3])
	by mal35-2-82-225-70-234.fbx.proxad.net (Postfix) with ESMTP id 2F09B22BCA
	for <zsh-workers@sunsite.dk>; Fri, 15 Feb 2008 21:11:05 +0100 (CET)
Date: Fri, 15 Feb 2008 21:10:46 +0100
From: Wael Nasreddine <mla@nasreddine.com>
To: zsh-workers@sunsite.dk
Subject: Re: Phil's prompt is not working when LANG is set to UTF-8
Message-ID: <20080215201046.GB5802@phoenix.nasreddine.info>
References: <20080211033116.GD19613@phoenix.nasreddine.info> <20080214123757.GA2943@phoenix.nasreddine.info> <200802141300.m1ED0qOo017425@news01.csr.com> <200802152249.00467.arvidjaar@newmail.ru>
MIME-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="tjCHc7DPkfUGtrlw"
Content-Disposition: inline
In-Reply-To: <200802152249.00467.arvidjaar@newmail.ru>
X-OS: Linux 2.6.24-tuxonice-r2 i686
X-Editor: VIM - Vi IMproved 7.1 (2007 May 12, compiled Feb  4 2008 15:13:47)
X-PGP-Key: http://wael.nasreddine.com/files/Wael_Nasreddine.asc
User-Agent: Mutt/1.5.16 (2007-06-09)
X-Virus-Scanned: ClamAV 0.91.2/5832/Fri Feb 15 17:26:21 2008 on bifrost
X-Virus-Status: Clean


--tjCHc7DPkfUGtrlw
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

This One Time, at Band Camp, Andrey Borzenkov <arvidjaar@newmail.ru> said, =
On Fri, Feb 15, 2008 at 10:48:55PM +0300:
> On Thursday 14 February 2008, Peter Stephenson wrote:

> > Wael Nasreddine wrote:
> > > Peter I couldn't install Fedora because it doesn't work with LVM over
> > > DM-Crypt, have you tried my environment ??

> > No, it seems unlikely I'm going to have time for that sort of
> > time-consuming procedure which is any case speculative.  It seems like
> > the next step is understanding the implications of Andrei's findings
> > since he's already narrowed it down.  I don't currently know anything
> > about the system he's talking about.



> I took liberty to move this to workers.

> In case it rings the bell for anyone. Here are prompt lengths computed by
> zsh for phil's prompt in ru_RU.UTF-8 locale (where there were the same
> results for en_US.UTF-8 as well, so at least proper UTF-8 part is correct=
ly
> computed :) )

> (gdb) p rpromptw
> $1 =3D 12
> (gdb) p lpromptw
> $2 =3D 9
> (gdb) p lprompth
> $3 =3D 2
> (gdb) p rprompth
> $4 =3D 1

> that's absolutely wrong. The actual prompt lengths are (see screenshot)

> lpromptw =3D 13
> rptomptw =3D 16 (it has one space in it)

> this perfectly correspnds to something (zsh?) ignoring invalid characters
> with high bit set. In both left and right prompts there are exactly 4 of
> ACS chars.

> I attach both left and ritgh prompts as well.

> =1B[1m=1B[36m=1B[11m?=1B[1m=1B[34m?=1B[10m(=1B[1m=1B[36mbor=1B[1m=1B[33m@=
=1B[1m=1B[32mcooker=1B[1m=1B[33m:=1B[1m=1B[34m1=1B[1m=1B[34m)=1B[11m?=1B[1m=
=1B[36m?                                                                   =
                                    =1B[1m=1B[34m?=1B[10m(=1B[1m=1B[35m~=1B=
[1m=1B[34m)=1B[11m?=1B[1m=1B[36m?=1B[10m
> =1B[1m=1B[36m=1B[11m?=1B[1m=1B[34m?=1B[10m(=1B[1m=1B[33m22:51=1B[34m:=1B[=
1m=1B[37m%=1B[1m=1B[34m)=1B[11m?=1B[10m=1B[1m=1B[36m=1B[11m?=1B[10m=1B[0;10=
m=20
>  =1B[1m=1B[36m=1B[11m?=1B[1m=1B[34m?=1B[10m(=1B[1m=1B[33m??????,??????14=
=1B[1m=1B[34m)=1B[11m?=1B[1m=1B[36m?=1B[10m=1B[0;10m

So it does seem a zsh problem after all, file a bug perhaps?

--=20
Wael Nasreddine
http://wael.nasreddine.com
PGP: 1024D/C8DD18A2 06F6 1622 4BC8 4CEB D724  DE12 5565 3945 C8DD 18A2

=2E: An infinite number of monkeys typing into GNU emacs,
   would never make a good program. (L. Torvalds 1995) :.

--tjCHc7DPkfUGtrlw
Content-Type: application/pgp-signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.7 (GNU/Linux)

iD8DBQFHtfHGVWU5RcjdGKIRAntcAKC1bkywc9pQZs6AwD5Sh+34z6T5FwCg4SIS
kjUClkUKQR87fxNwPAMhVjc=
=GYHH
-----END PGP SIGNATURE-----

--tjCHc7DPkfUGtrlw--

