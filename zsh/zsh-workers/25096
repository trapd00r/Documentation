From zsh-workers-return-25096-mason-zsh=primenet.com.au@sunsite.dk Sat May 24 17:41:51 2008
Return-Path: <zsh-workers-return-25096-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16612 invoked from network); 24 May 2008 17:41:49 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 24 May 2008 17:41:49 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 55336 invoked from network); 24 May 2008 17:41:44 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 24 May 2008 17:41:43 -0000
Received: (qmail 9373 invoked by alias); 24 May 2008 17:41:41 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25096
Received: (qmail 9358 invoked from network); 24 May 2008 17:41:40 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 24 May 2008 17:41:40 -0000
Received: from vms044pub.verizon.net (vms044pub.verizon.net [206.46.252.44])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 530E98059114
	for <zsh-workers@sunsite.dk>; Sat, 24 May 2008 19:41:31 +0200 (CEST)
Received: from torch.brasslantern.com ([71.121.11.8])
 by vms044.mailsrvcs.net (Sun Java System Messaging Server 6.2-6.01 (built Apr
 3 2006)) with ESMTPA id <0K1D00KDJVSNUKU0@vms044.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Sat, 24 May 2008 12:41:13 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id m4OHf8gn015177; Sat,
 24 May 2008 10:41:09 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id m4OHf72i015176; Sat, 24 May 2008 10:41:07 -0700
Date: Sat, 24 May 2008 10:41:07 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: Bug#482346: zsh doesn't always wait for its children (-> zombie)
In-reply-to: <20080524152704.GA5673@sc.homeunix.net>
To: zsh-workers@sunsite.dk
Cc: 482346@bugs.debian.org
Message-id: <080524104107.ZM15175@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <20080521235008.GA5600@ay.vinc17.org>
	<20080521235930.GW7056@prunille.vinc17.org>	<20080522233327.GA24953@scru.org>
	<080523073940.ZM13804@torch.brasslantern.com>
	<20080523145722.GA12096@scru.org>	<20080523224305.GN7056@prunille.vinc17.org>
	<20080524025556.GA30511@scru.org>	<20080524124445.GQ7056@prunille.vinc17.org>
	<20080524152504.759b27ad@pws-pc>	<20080524152704.GA5673@sc.homeunix.net>
Comments: In reply to Stephane Chazelas <Stephane_Chazelas@yahoo.fr>
 "Re: Bug#482346: zsh doesn't always wait for its children (-> zombie)" (May
 24,  4:27pm)
X-Virus-Scanned: ClamAV 0.91.2/7226/Sat May 24 17:14:58 2008 on bifrost
X-Virus-Status: Clean

On May 24,  4:27pm, Stephane Chazelas wrote:
}
} From the straces, we see that zsh is not receiving any SIGCHLD.

If that were the only problem, then opening another shell window and
performing "kill -CHLD ..." on the original shell should clear it all
up.  But as PWS pointed out, the spiking load indicates that either
vlc or zsh is actively doing something, which may have to do with the
way zsh progates signals, or how it sets the signal masks before
forking vlc in the first place.

If it's zsh that's looping, then Vincent's stack trace indicates it
must be here in zwaitjob:

	while (!errflag && jn->stat &&
	       !(jn->stat & STAT_DONE) &&
	       !(interact && (jn->stat & STAT_STOPPED))) {
	    signal_suspend(SIGCHLD);
	    /* job handling stuff elided */
	    child_block();
	}

But if *that* were a tight loop, it would mean that signal_suspend()
isn't working.  It'd be nice to know what process or processes send
the load so high; 100% CPU usage is one thing, but 26+ processes in
runnable state sounds like another thing entirely.

