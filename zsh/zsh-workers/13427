From zsh-workers-return-13427-mason-zsh=primenet.com.au@sunsite.dk Thu Feb 01 17:57:53 2001
Return-Path: <zsh-workers-return-13427-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13182 invoked from network); 1 Feb 2001 17:57:52 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 1 Feb 2001 17:57:52 -0000
Received: (qmail 24564 invoked by alias); 1 Feb 2001 17:57:47 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13427
Received: (qmail 24553 invoked from network); 1 Feb 2001 17:57:47 -0000
Message-ID: <Tc0a8890c5177930f27@mailsweeper01.cambridgesiliconradio.com>
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: Re: Space-expansion problem in dev-8 
In-Reply-To: Your message of "Thu, 01 Feb 2001 09:41:14 PST."
             <Pine.LNX.4.21.0102010930180.8191-100000@phong.blorf.net> 
Date: Thu, 01 Feb 2001 17:57:19 +0000
From: Peter Stephenson <pws@csr.com>

> If a filename contains spaces (or other escapable characters) and you
> expand it via wild-carding, the spaces are not escaped.

The fix is probably something like the following, but Sven may have better
ideas.  This is leaving my cursor at the end of the word for some reason.
Probably _expand was written before ${(q)...} existed.

Index: Completion/Core/_expand
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Core/_expand,v
retrieving revision 1.33
diff -u -r1.33 _expand
--- Completion/Core/_expand	2000/10/11 12:19:24	1.33
+++ Completion/Core/_expand	2001/02/01 17:46:47
@@ -68,7 +68,7 @@
 # Now try globbing.
 
 [[ "$force" = *g* ]] || zstyle -T ":completion:${curcontext}:" glob &&
-    eval 'exp=( ${~exp} ); exp=( ${exp//(#b)([][()|*?^#~<>\\=])/\\${match[1]}} )' 2>/dev/null
+    eval 'exp=( ${~exp} ); exp=( ${(q)exp} )' 2>/dev/null
 
 # If we don't have any expansions or only one and that is the same
 # as the original string, we let other completers run.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
Cambridge Silicon Radio, Unit 300, Science Park, Milton Road,
Cambridge, CB4 0XL, UK                          Tel: +44 (0)1223 392070

