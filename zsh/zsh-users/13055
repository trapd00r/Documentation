From zsh-users-return-13055-mason-zsh=primenet.com.au@sunsite.dk Thu Jul 24 12:06:07 2008
Return-Path: <zsh-users-return-13055-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27179 invoked from network); 24 Jul 2008 12:05:53 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 24 Jul 2008 12:05:53 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 56389 invoked from network); 24 Jul 2008 12:05:40 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 24 Jul 2008 12:05:40 -0000
Received: (qmail 18055 invoked by alias); 24 Jul 2008 12:05:33 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13055
Received: (qmail 18040 invoked from network); 24 Jul 2008 12:05:32 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 24 Jul 2008 12:05:32 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [208.87.233.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id F420380561C3
	for <zsh-users@sunsite.dk>; Thu, 24 Jul 2008 14:05:23 +0200 (CEST)
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly10g.srv.mailcontrol.com (MailControl) with ESMTP id m6OC5FYD027869
	for <zsh-users@sunsite.dk>; Thu, 24 Jul 2008 13:05:16 +0100
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 24 Jul 2008 13:05:14 +0100
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.2/8.13.4) with ESMTP id m6OC5EsV014433
	for <zsh-users@sunsite.dk>; Thu, 24 Jul 2008 13:05:14 +0100
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.2/8.14.2/Submit) with ESMTP id m6OC5ExC014430
	for <zsh-users@sunsite.dk>; Thu, 24 Jul 2008 13:05:14 +0100
Message-Id: <200807241205.m6OC5ExC014430@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: "Zsh users list" <zsh-users@sunsite.dk>
Subject: Re: A scheme to manage several ZSH config file collections?
In-reply-to: <2d460de70807240448v2d77b44dr5b25580e7a39f51b@mail.gmail.com>
References: <2d460de70807240448v2d77b44dr5b25580e7a39f51b@mail.gmail.com>
Comments: In-reply-to "Richard Hartmann" <richih.mailinglist@gmail.com>
   message dated "Thu, 24 Jul 2008 13:48:43 +0200."
Date: Thu, 24 Jul 2008 13:05:14 +0100
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 24 Jul 2008 12:05:14.0538 (UTC) FILETIME=[87D510A0:01C8ED85]
X-Scanned-By: MailControl A-08-50-03 (www.mailcontrol.com) on 10.71.0.120
X-Virus-Scanned: ClamAV 0.92.1/7810/Thu Jul 24 12:54:32 2008 on bifrost
X-Virus-Status: Clean

"Richard Hartmann" wrote:
> Hi all,
> 
> some of you might be aware of grml, a live boot CD which uses ZSH as its
> default shell. I suggested integrating several different zshrc files
> along with whatever other files they need and offer the user a selection
> of said configuration files.
> 
> Now, we are wondering if there is a clean and maintainable way to do
> this.

I don't know enough about this set-up to be able to answer this properly.
I presume the system is strictly booting and configuring from CD only,
so every time you boot you get to pick choices from scratch (i.e. every
time it looks like the user has been freshly created), however I don't
know how things are stored once the system is running.

You later refer to "for the first time"... I presume you mean that
although the stuff needs doing each time you boot from the CD, later
instances of the shell will pick up the same settings?  Do you have a
writeable home area for the user in which .zshrc files can be copied for
this?  In that case, the zsh/newuser module added to the main line (and
in recent 4.3 releases) should be something like what you want, since it
runs if there are no existing user startup files.  You may well want to
adapt the zsh-newuser-install function to your own ends: you can simply
write a drop-in replacement for this without altering the core of the
system---it's been designed with this in mind.  You can simply get
zsh-newuser-install to write a .zshrc that sources the appropriate
selected set of files, or copy in as much or as little code and
comments as you want.  Then the user can just edit the .zshrc.

Presumably there's somewhere to save this stuff, in that case you should
be able to use this system just by setting ZDOTDIR appropriately, since
zsh/newuser will respect this.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

