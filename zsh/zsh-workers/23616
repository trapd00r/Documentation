From zsh-workers-return-23616-mason-zsh=primenet.com.au@sunsite.dk Thu Jun 28 17:16:13 2007
Return-Path: <zsh-workers-return-23616-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12490 invoked from network); 28 Jun 2007 17:16:05 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.1 (2007-05-02) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 28 Jun 2007 17:16:05 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 28239 invoked from network); 28 Jun 2007 17:16:00 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Jun 2007 17:16:00 -0000
Received: (qmail 790 invoked by alias); 28 Jun 2007 17:15:53 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23616
Received: (qmail 781 invoked from network); 28 Jun 2007 17:15:53 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 28 Jun 2007 17:15:53 -0000
Received: (qmail 27507 invoked from network); 28 Jun 2007 17:15:53 -0000
Received: from cluster-d.mailcontrol.com (217.69.20.190)
  by a.mx.sunsite.dk with SMTP; 28 Jun 2007 17:15:46 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly13d.srv.mailcontrol.com (MailControl) with ESMTP id l5SHFbcI014909
	for <zsh-workers@sunsite.dk>; Thu, 28 Jun 2007 18:15:43 +0100
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Thu, 28 Jun 2007 18:15:38 +0100
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.8/8.13.4) with ESMTP id l5SHFcB4016216
	for <zsh-workers@sunsite.dk>; Thu, 28 Jun 2007 18:15:38 +0100
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.8/8.13.8/Submit) with ESMTP id l5SHFbOA016213
	for <zsh-workers@sunsite.dk>; Thu, 28 Jun 2007 18:15:38 +0100
Message-Id: <200706281715.l5SHFbOA016213@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: Zsh workers <zsh-workers@sunsite.dk>
Subject: Re: PATCH: ldd and LD_DEBUG completions 
In-reply-to: <20070628170745.GE17355@lorien.comfychair.org> 
References: <15204.1183047166@thecus> <20070628170745.GE17355@lorien.comfychair.org>
Comments: In-reply-to Danek Duvall <duvall@comfychair.org>
   message dated "Thu, 28 Jun 2007 10:07:45 -0700."
Date: Thu, 28 Jun 2007 18:15:37 +0100
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 28 Jun 2007 17:15:38.0398 (UTC) FILETIME=[F29693E0:01C7B9A7]
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A-07-07-10 (www.mailcontrol.com) on 10.68.0.123

Danek Duvall wrote:
> On Thu, Jun 28, 2007 at 05:12:46PM +0100, Oliver Kiddle wrote:
> 
> > The zsh libraries are not especially cleanly linked by the way. Run ldd
> > -ur (preferably on Solaris) on them to see what I mean.
> 
> One thing I plan to do next time I have time to poke at zsh is to build it
> with "-z ignore" in LD_OPTIONS, which I believe ought to eliminate the
> extraneous libraries in each ELF object.  If you build your own zsh on
> Solaris, give this a shot, and see if it actually makes a difference.

Yes, that does seem to work... omitting symbols from the main zsh binary
not found in Modules/socket.so, I now get

18:10% ldd -ur zsh 
        libdl.so.1 =>    /usr/lib/libdl.so.1
        libnsl.so.1 =>   /usr/lib/libnsl.so.1
        libcurses.so.1 =>        /usr/lib/libcurses.so.1
        libm.so.1 =>     /usr/lib/libm.so.1
        libc.so.1 =>     /usr/lib/libc.so.1
        libmp.so.2 =>    /usr/lib/libmp.so.2
        /usr/platform/SUNW,Sun-Fire-280R/lib/libc_psr.so.1
18:10% ldd -ur Modules/socket.so
        libsocket.so.1 =>        /usr/lib/libsocket.so.1
        libc.so.1 =>     /usr/lib/libc.so.1
        libnsl.so.1 =>   /usr/lib/libnsl.so.1
        libdl.so.1 =>    /usr/lib/libdl.so.1
        libmp.so.2 =>    /usr/lib/libmp.so.2
        /usr/platform/SUNW,Sun-Fire-280R/lib/libc_psr.so.1

so libsocket has correctly only linked against the module that needs it,
and libcurses is missing from the socket library.  The shell runs and
the module loads OK.

This looks like it's worth hacking into configure somehow.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


To access the latest news from CSR copy this link into a web browser:  http://www.csr.com/email_sig.php

To get further information regarding CSR, please visit our Investor Relations page at http://ir.csr.com/csr/about/overview

