From zsh-workers-return-21203-mason-zsh=primenet.com.au@sunsite.dk Thu Apr 28 08:17:51 2005
Return-Path: <zsh-workers-return-21203-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26772 invoked from network); 28 Apr 2005 08:17:51 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 28 Apr 2005 08:17:51 -0000
Received: (qmail 39896 invoked from network); 28 Apr 2005 08:17:45 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Apr 2005 08:17:45 -0000
Received: (qmail 5895 invoked by alias); 28 Apr 2005 08:17:42 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21203
Received: (qmail 5881 invoked from network); 28 Apr 2005 08:17:41 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 28 Apr 2005 08:17:41 -0000
Received: (qmail 39567 invoked from network); 28 Apr 2005 08:17:41 -0000
Received: from vms040pub.verizon.net (206.46.252.40)
  by a.mx.sunsite.dk with SMTP; 28 Apr 2005 08:17:36 -0000
Received: from candle.brasslantern.com ([4.11.1.68])
 by vms040.mailsrvcs.net (Sun Java System Messaging Server 6.2 HotFix 0.04
 (built Dec 24 2004)) with ESMTPA id <0IFN003CDDP8AWF9@vms040.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Thu, 28 Apr 2005 03:17:33 -0500 (CDT)
Received: from candle.brasslantern.com (IDENT:schaefer@localhost [127.0.0.1])
	by candle.brasslantern.com (8.12.11/8.12.11) with ESMTP id j3S8HUUf031163	for
 <zsh-workers@sunsite.dk>; Thu, 28 Apr 2005 01:17:31 -0700
Received: (from schaefer@localhost)	by candle.brasslantern.com
 (8.12.11/8.12.11/Submit) id j3S8HUNO031162	for zsh-workers@sunsite.dk; Thu,
 28 Apr 2005 01:17:30 -0700
Date: Thu, 28 Apr 2005 08:17:30 +0000
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: zle separability
In-reply-to: <20050428055954.GB6338@a5.repetae.net>
To: zsh-workers@sunsite.dk
Message-id: <1050428081730.ZM31161@candle.brasslantern.com>
MIME-version: 1.0
X-Mailer: Z-Mail (5.0.0 30July97)
Content-type: text/plain; charset=us-ascii
References: <20050424193737.GA27777@a5.repetae.net>
	<20050424230816.GA78@DervishD>	<20050425075146.GC28168@a5.repetae.net>
	<20050425104950.GA4108@DervishD>	<20050425110410.GD28168@a5.repetae.net>
	<20050425113925.GA4578@DervishD>	<20050425115849.GA17635@a5.repetae.net>
	<1050425160927.ZM24988@candle.brasslantern.com>
	<20050428055954.GB6338@a5.repetae.net>
Comments: In reply to Frederik Eaton <frederik@a5.repetae.net>
 "Re: zle separability" (Apr 27, 10:59pm)
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On Apr 27, 10:59pm, Frederik Eaton wrote:
} Subject: Re: zle separability
}
} On Mon, Apr 25, 2005 at 04:09:27PM +0000, Bart Schaefer wrote:
} > 
} > The Functions/Misc/nslookup script in the zsh distribution is the
} > classic example of doing this.
[...]
} >  
} > zsh -c 'while line=""; vared -e -p "$0: " line; do $0 $=line; done' dig
} > 
} Can you describe how history support might be added?

Did you try out and/or look at the Functions/Misc/nslookup script?
It is an example of adding both history and completion by using a
wrapper that calls vared in a loop.  It also happens to use zpty to
interpret the interactive prompts of the underlying program, but as
I said you can crop that out if you don't need it.

} > Interactive shells are for interacting with the shell.  You don't need
} > an interactive shell to interact with some other command.
} 
} Well on a computer you don't *need* anything to do anything.

Ahem.  The point is that the shell is just there to execute other
commands.  When you know neither what commands you'll need to execute
nor in what order, then the shell has to be interactive so you can
make a new decision before each command, including choosing things
like changing directory that actually alter the state of the shell.

Conversely, when you know that all you're going to do is repeatedly
run the same command or sequence of commands -- even if possibly with
different inputs or arguments -- then the shell doesn't need to be
interactive.  Nothing you type is going to change the state *of the
shell*.

Note that I'm specifically addressing your request to trap everything
that is typed at a prompt and do something with it other than treat
it as a command.  (Which is possible in ZLE by redefining the various
accept-* widgets, or at least their keybindings, but not supported in
the "raw" shell.)  That has nothing to do with this:

} But it's come up for me before that this would be a very convnient
} way of doing certain things. If you want a command which will start a
} normal zsh but with a certain environment, you can set the variables
} and hope the user's .zshrc doesn't overwrite them.

You don't have to "hope" that at all.  "zsh -f" won't read anything
but the /etc/zshrc file (and you can compile away support for the
/etc files if that's an issue).

} But this isn't ideal, and it doesn't allow you to configure aliases or
} functions.

You seem to be asking for the ENV feature of ksh (which zsh does in
fact support, when emulating ksh), but that isn't something you need
if you're already writing/running a shell script in the first place.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

