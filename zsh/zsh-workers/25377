From zsh-workers-return-25377-mason-zsh=primenet.com.au@sunsite.dk Sun Aug 03 10:42:52 2008
Return-Path: <zsh-workers-return-25377-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8529 invoked from network); 3 Aug 2008 10:42:49 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 3 Aug 2008 10:42:49 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 39984 invoked from network); 3 Aug 2008 10:42:34 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 3 Aug 2008 10:42:34 -0000
Received: (qmail 11314 invoked by alias); 3 Aug 2008 10:42:26 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25377
Received: (qmail 11296 invoked from network); 3 Aug 2008 10:42:25 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 3 Aug 2008 10:42:25 -0000
Received: from mtaout02-winn.ispmail.ntl.com (mtaout02-winn.ispmail.ntl.com [81.103.221.48])
	by bifrost.dotsrc.org (Postfix) with ESMTP id A5FA080590E6
	for <zsh-workers@sunsite.dk>; Sun,  3 Aug 2008 12:42:22 +0200 (CEST)
Received: from aamtaout02-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout02-winn.ispmail.ntl.com with ESMTP
          id <20080803104221.XNOX21103.mtaout02-winn.ispmail.ntl.com@aamtaout02-winn.ispmail.ntl.com>
          for <zsh-workers@sunsite.dk>; Sun, 3 Aug 2008 11:42:21 +0100
Received: from pws-pc ([81.107.40.67]) by aamtaout02-winn.ispmail.ntl.com
          with ESMTP
          id <20080803104221.DXMN19289.aamtaout02-winn.ispmail.ntl.com@pws-pc>
          for <zsh-workers@sunsite.dk>; Sun, 3 Aug 2008 11:42:21 +0100
Date: Sun, 3 Aug 2008 11:42:15 +0100
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-workers@sunsite.dk
Subject: Re: Weird exit caused in a trap DEBUG which sources a file.
Message-ID: <20080803114215.219b616a@pws-pc>
In-Reply-To: <6cd6de210808020421k78d716a0mc995862eb761ea2@mail.gmail.com>
References: <6cd6de210807301938m28e05c84vf6296aa5b1bc0d44@mail.gmail.com>
	<200807310901.m6V91g8T002478@news01.csr.com>
	<6cd6de210807310305q5954b65ax405f51e54d6754ee@mail.gmail.com>
	<6cd6de210808010529h11898619kba301fddf8b72f00@mail.gmail.com>
	<20080801143747.19b65086@news01>
	<6cd6de210808010821g3117fe62y82bd580811dbba8a@mail.gmail.com>
	<200808011531.m71FVIFl028545@news01.csr.com>
	<6cd6de210808020421k78d716a0mc995862eb761ea2@mail.gmail.com>
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.11; x86_64-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: ClamAV 0.92.1/7920/Sun Aug  3 10:44:32 2008 on bifrost
X-Virus-Status: Clean

On Sat, 2 Aug 2008 07:21:43 -0400
"Rocky Bernstein" <rocky.bernstein@gmail.com> wrote:
> 
> It may be useful to have some "trap DEBUG" exit codes alter program
> flow. For example in bash if "trap DEBUG" returns 2, then if you are
> inside a function that does an immediate return from the function
> (implementing a gdb "return" command).

This happens on any explicit "return" from a non-function trap.

> It might also be nice to have a "trap DEBUG" exit value which
> indicates that the next command is skipped rather than executed.

That's a little more tricky:  it's not very clear what the next command
actually is if it's a complicated expression.  Looking at the code, it's
not hard to do something here, but making it properly consistent is
another matter.  I think it would probably work if done at the level of
commands separated by semicolons, newlines or ampersands (described
internally as sublists).

> And since I brought up "trap DEBUG" execution order again, at the risk
> of beating a dead horse...

I don't really understand what the issue is.  Is there something about
the DEBUG_BEFORE_CMD option that makes it hard to ensure it is set at
the right point (this is not a trick question, that's perfectly
possible)?

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

