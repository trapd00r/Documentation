From zsh-users-return-10224-mason-zsh=primenet.com.au@sunsite.dk Sat May 06 12:52:22 2006
Return-Path: <zsh-users-return-10224-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5263 invoked from network); 6 May 2006 12:52:20 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.1 (2006-03-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 6 May 2006 12:52:20 -0000
Received: (qmail 86173 invoked from network); 6 May 2006 12:52:13 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 6 May 2006 12:52:13 -0000
Received: (qmail 13239 invoked by alias); 6 May 2006 12:52:05 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10224
Received: (qmail 13228 invoked from network); 6 May 2006 12:52:04 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 6 May 2006 12:52:04 -0000
Received: (qmail 85137 invoked from network); 6 May 2006 12:52:04 -0000
Received: from mta07-winn.ispmail.ntl.com (HELO mtaout01-winn.ispmail.ntl.com) (81.103.221.47)
  by a.mx.sunsite.dk with SMTP; 6 May 2006 12:52:03 -0000
Received: from aamtaout03-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout01-winn.ispmail.ntl.com with ESMTP
          id <20060506125202.CDLW29343.mtaout01-winn.ispmail.ntl.com@aamtaout03-winn.ispmail.ntl.com>
          for <zsh-users@sunsite.dk>; Sat, 6 May 2006 13:52:02 +0100
Received: from pwslaptop.csr.com ([81.107.46.246])
          by aamtaout03-winn.ispmail.ntl.com with ESMTP
          id <20060506125202.XTAZ16286.aamtaout03-winn.ispmail.ntl.com@pwslaptop.csr.com>
          for <zsh-users@sunsite.dk>; Sat, 6 May 2006 13:52:02 +0100
Received: from pwslaptop.csr.com (pwslaptop.csr.com [127.0.0.1])
	by pwslaptop.csr.com (8.13.6/8.13.4) with ESMTP id k46Cptgr004236
	for <zsh-users@sunsite.dk>; Sat, 6 May 2006 13:51:56 +0100
Message-Id: <200605061251.k46Cptgr004236@pwslaptop.csr.com>
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: Zsh users list <zsh-users@sunsite.dk>
Subject: Re: Large COLUMNS crashes zsh 
In-Reply-To: Message from Miek Gieben <miek@miek.nl> 
   of "Fri, 05 May 2006 17:33:22 +0200." <20060505153322.GE8197@miek.nl> 
Date: Sat, 06 May 2006 13:51:55 +0100

Miek Gieben wrote:
> bash seems handle this just fine. And it resets the value to something
> more sane (don't know if that is a bug or feature):
> 
> $ export COLUMNS=10000000000000000
> $ echo $COLUMNS
> 10000000000000000
> $ ls
> ...bunch of files...
> $ echo $COLUMNS
> 100
> $
> 
> This is with bash3. Zsh on the other hand is trying to trash my
> machine :)

zsh actually needs to know the number of columns internally for zle,
which stores all the lines it's printing out; this is needed to get
multiline buffers to work.  So if you get it wrong it's not going to
work properly anyway, even if we invent some kludge (and there are
plenty of possibilities).  I can't really think of a better answer than
"don't do that", offhand, but I'm open to specific suggestions.
(The question is not "is it bad for the shell to crash?"  The question
is "what do we do about it?")

By the way, if you simply don't want the shell to see a value you're
using in a function or script, there's a workaround:

fn() {
  local -hx COLUMNS=10000000000000000
}

The -h makes the parameter cover the special value; it's set in the
environment for the duration of the function but isn't coupled to the
shell's internall column setting.

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

