From zsh-workers-return-7693-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Sep 07 14:48:57 1999
Return-Path: <zsh-workers-return-7693-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17026 invoked from network); 7 Sep 1999 14:48:56 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 7 Sep 1999 14:48:56 -0000
Received: (qmail 2083 invoked by alias); 7 Sep 1999 14:48:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7693
Received: (qmail 2076 invoked from network); 7 Sep 1999 14:48:47 -0000
Message-Id: <199909071448.QAA07131@paris.ifh.de>
X-Authentication-Warning: paris.ifh.de: pws owned process doing -bs
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: PATCH: 3.1.6-pws-3: _precommand
Date: Tue, 07 Sep 1999 16:48:32 +0200
From: Peter Stephenson <pws@ifh.de>

_normal sets _compskip to `pattern' before starting a completion; when
_precommand shifts the input array to start a new normal completion,
that means that pattern completions defined for the new command word
aren't recognised.  I haven't understood all the logic for _compskip
by a long way, but it seems as if it is wrong in this case, at least,
since completing after `noglob' etc. should be exactly the same as if
the precommand word wasn't there.

--- Completion/Base/_precommand~	Tue Apr 13 09:37:36 1999
+++ Completion/Base/_precommand	Tue Sep  7 14:46:04 1999
@@ -3,4 +3,7 @@
 shift words
 (( CURRENT-- ))
 
+# We now want to go back to doing ordinary completion on the new word,
+# so restore the default _compskip.
+_compskip=''
 _normal

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56100 Pisa, Italy

