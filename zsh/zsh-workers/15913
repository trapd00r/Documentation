From zsh-workers-return-15913-mason-zsh=primenet.com.au@sunsite.dk Sun Sep 30 16:22:25 2001
Return-Path: <zsh-workers-return-15913-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22178 invoked from network); 30 Sep 2001 16:22:25 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 30 Sep 2001 16:22:24 -0000
Received: (qmail 18197 invoked by alias); 30 Sep 2001 16:22:17 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15913
Received: (qmail 18175 invoked from network); 30 Sep 2001 16:22:15 -0000
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <1010930162212.ZM21385@candle.brasslantern.com>
Date: Sun, 30 Sep 2001 16:22:12 +0000
In-Reply-To: <20010930133842.C2654@fysh.org>
Comments: In reply to Zefram <zefram@fysh.org>
        "Re: error on TTY read: no such file or directory" (Sep 30,  1:38pm)
References: <3BB63D16.5040709@mow.siemens.ru> 
	<20010929173848.H16561@hithaeglir.net> 
	<3BB64378.8060505@mow.siemens.ru> 
	<20010929181100.I16561@hithaeglir.net> 
	<1010929223918.ZM20169@candle.brasslantern.com> 
	<20010929202423.K16561@hithaeglir.net> 
	<1010930012412.ZM20346@candle.brasslantern.com> 
	<20010929213405.L16561@hithaeglir.net> 
	<3BB6BAD4.5080201@mow.siemens.ru> 
	<20010930074816.N16561@hithaeglir.net> 
	<20010930133842.C2654@fysh.org>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.dk
Subject: Re: error on TTY read: no such file or directory
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Sep 30,  1:38pm, Zefram wrote:
} Subject: Re: error on TTY read: no such file or directory
}
} lordzork@lordzork.com wrote:
} >i made a new strace, this time without zsh reading any of its start up
} >files. my idea was that this would make it easier to read, but the new
} >strace looks completely different from the old one, at least to me.
} 
} It's still doing the same impossible thing.

I never saw the previous trace.   Looking at this one, I note that it's
doing this impossible thing a lot, but only on fd 10, and sometimes zsh
just ignores the problem and loops.  (That would happen when errno == 0,
or if the impossible occurred somewhere other than in getkey().)

Ignoring the problem would mean that zsh discarded at least one char of
input if there really were any, but there's no evidence of input being
lost.  That in turn makes me think that reads from the tty are behaving
as if they're non-blocking, but for some reason are returning 1025 when
they should be returning -1 with EWOULDBLOCK.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

