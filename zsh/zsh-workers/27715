From zsh-workers-return-27715-mason-zsh=primenet.com.au@zsh.org Tue Feb 16 15:03:54 2010
Return-Path: <zsh-workers-return-27715-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16653 invoked by alias); 16 Feb 2010 15:03:54 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 27715
Received: (qmail 14008 invoked from network); 16 Feb 2010 15:03:42 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VERIFIED autolearn=ham version=3.2.5
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.218.225 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:from:to:subject:date
         :user-agent:mime-version:content-type:content-transfer-encoding
         :message-id;
        bh=0Qq5qrxU5kUZTY0ylxR/jCDfZCwLpdLNIoksHz9Avg4=;
        b=dNn/MmBVthHVV+K0XsJ9oph+roN4R4eI4YwflEHnxbtayUGWOoJyBy2C2hOkwlt7+W
         hzR4dlghHv288T14NNXYQ7Pauup3dL0Ri82z7CipsdLgHOoNwMAqy7HIouIx7n6fZLFc
         eKQhhhksg9MXakPkCYk7SJjMWJL15GHgqmUQE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=from:to:subject:date:user-agent:mime-version:content-type
         :content-transfer-encoding:message-id;
        b=f/X2FAEzLF//+tM+x53FbQxQkqMBPkBbNsn8ijTW+0QhgD65u6CYBTfpspJ5LuXnmg
         Xb6xfpR7nxLYFqj3zphRxnsC93hQcMRMMAb0LeUk19nZQ/WT2W0fVPzEietxfJ3ZoxBX
         rEofKNTZ1A1L1UvWhuNW9ZJjW+7cQEacYbtbA=
From: Andrey Borzenkov <arvidjaar@gmail.com>
To: zsh-workers@zsh.org
Subject: [PATCH] update _stgit for current StGIT version
Date: Tue, 16 Feb 2010 17:57:11 +0300
User-Agent: KMail/1.13.0 (Linux/2.6.33-desktop-0.rc8.1mnb; KDE/4.4.0; x86_64; ; )
MIME-Version: 1.0
Content-Type: multipart/signed;
  boundary="nextPart6366369.TiqQJfO8tO";
  protocol="application/pgp-signature";
  micalg=pgp-sha1
Content-Transfer-Encoding: 7bit
Message-Id: <201002161757.11967.arvidjaar@gmail.com>

--nextPart6366369.TiqQJfO8tO
Content-Type: multipart/mixed;
  boundary="Boundary-01=_HJreLW7bQG1HSdF"
Content-Transfer-Encoding: 7bit


--Boundary-01=_HJreLW7bQG1HSdF
Content-Type: Text/Plain;
  charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline

Current StGIT removed quite some commands including (un)-applied to list=20
patches. Use "stg series" to generate the same list. Also generate list=20
of available commands dynamically.

StGIT includes facility to create bash completion from command sources.=20
May be it could be reused for _stgit.

Attached as kmail always mangles them (or, better, I cannot find=20
combination of settings that both do what I want and do not line-wrap=20
files)

--Boundary-01=_HJreLW7bQG1HSdF
Content-Type: text/x-patch;
  charset="us-ascii";
  name="stgit.diff"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline;
	filename="stgit.diff"

Index: Completion/Unix/Command/_stgit
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_stgit,v
retrieving revision 1.2
diff -u -p -r1.2 _stgit
=2D-- Completion/Unix/Command/_stgit	22 May 2009 20:13:24 -0000	1.2
+++ Completion/Unix/Command/_stgit	16 Feb 2010 14:44:54 -0000
@@ -2,53 +2,7 @@
=20
 typeset -a subcmds
=20
=2Dsubcmds=3D(
=2D  'help:print the detailed command usage'
=2D  'version:display version information'
=2D  'copyright:display copyright information'
=2D  'clone:make a local clone of a remote repository'
=2D  'id:print the GIT hash value of a StGIT reference'
=2D  'applied:print the applied patches'
=2D  'branch:manage patch stacks'
=2D  'clean:delete the empty patches in the series'
=2D  'commit:permanently store the applied patches into stack base'
=2D  'float:push patches to the top, even if applied'
=2D  'goto:push or pop patches to the given one'
=2D  'hide:hide a patch in the series'
=2D  'init:initialise the current branch for use with StGIT'
=2D  'patches:show the applied patches modifying a file'
=2D  'pop:pop one or more patches from the stack'
=2D  'pull:pull the changes from the remote repository'
=2D  'push:push one or more patches onto of the stack'
=2D  'rebase:move the stack base to another point in history'
=2D  'repair:Fix StGit metadata if branch was modified with git commands'
=2D  'series:print the patch series'
=2D  'sink:send patches deeper down the stack'
=2D  'top:print the name of the top patch'
=2D  'unapplied:print the unapplied patches'
=2D  'uncommit:turn regular GIT commits into StGIT patches'
=2D  'unhide:unhide a hidden patch in the series'
=2D  'delete:delete patches'
=2D  'edit:edit a patch description or diff'
=2D  'export:exports patches to a directory'
=2D  'files:show the files modified by a patch (or the current patch)'
=2D  'fold:integrate a GNU diff patch into the current patch'
=2D  'import:import a GNU diff file as a new patch'
=2D  'log:display the patch changelog'
=2D  'mail:send a patch or series of patches by e-mail'
=2D  'new:create a new patch and make it the topmost one'
=2D  'pick:import a patch from a different branch or a commit object'
=2D  'refresh:generate a new commit for the current patch'
=2D  'rename:rename a patch in the series'
=2D  'show:show the commit corresponding to a patch (or the current patch)'
=2D  'sync:synchronise patches with a branch or a series'
=2D  'add:add files or directories to the repository'
=2D  'cp:copy files inside the repository'
=2D  'diff:show the tree diff'
=2D  'resolved:mark a file conflict as solved'
=2D  'rm:remove files from the repository'
=2D  'status:show the tree status'
=2D)
+subcmds=3D( ${${${(M)${(f)"$(stg help 2> /dev/null)"}## *}#  }/#(#b)([^[:s=
pace:]]##)[[:space:]]##(*)/$match[1]:$match[2]} )
=20
 local curcontext=3D"$curcontext"
 local subcmd
@@ -64,14 +18,19 @@ else
=20
   case $subcmd in
     (push)
=2D      _wanted -V "unapplied patches" expl "patch" compadd $(stg unapplie=
d) \
+      _wanted -V "unapplied patches" expl "patch" \
+       	compadd ${${(M)${(f)"$(stg series 2> /dev/null)"}##- *}#- } \
 		&& ret=3D0
     ;;
     (pop)
=2D      _wanted -V "applied patches" expl "patch" compadd $(stg applied) &=
& ret=3D0
+      _wanted -V "applied patches" expl "patch" \
+	compadd ${${(M)${(f)"$(stg series 2> /dev/null)"}##[+>] *}#[+>] } \
+		&& ret=3D0
     ;;
     (edit|files|goto|rename|log|float|delete|sink|mail|sync|show|pick|hide)
=2D      _wanted -V "patches" expl "patch" compadd $(stg series --noprefix)=
 && ret=3D0
+      _wanted -V "patches" expl "patch" \
+	compadd $(stg series --noprefix > /dev/null) \
+		&& ret=3D0
     ;;
     (*)
       _files

--Boundary-01=_HJreLW7bQG1HSdF--

--nextPart6366369.TiqQJfO8tO
Content-Type: application/pgp-signature; name=signature.asc 
Content-Description: This is a digitally signed message part.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iEYEABECAAYFAkt6skcACgkQR6LMutpd94xHBwCfRPcgaWW+BpOmcyr2Jz3qQPsU
lEcAn3Z//NUo3EldjqIBJMPupSuOMqU6
=bBU8
-----END PGP SIGNATURE-----

--nextPart6366369.TiqQJfO8tO--

