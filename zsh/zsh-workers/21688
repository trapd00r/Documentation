From zsh-workers-return-21688-mason-zsh=primenet.com.au@sunsite.dk Sat Aug 27 00:42:51 2005
Return-Path: <zsh-workers-return-21688-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10676 invoked from network); 27 Aug 2005 00:42:47 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 27 Aug 2005 00:42:47 -0000
Received: (qmail 24012 invoked from network); 27 Aug 2005 00:42:39 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 27 Aug 2005 00:42:39 -0000
Received: (qmail 24224 invoked by alias); 27 Aug 2005 00:42:37 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21688
Received: (qmail 24215 invoked from network); 27 Aug 2005 00:42:36 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 27 Aug 2005 00:42:36 -0000
Received: (qmail 23765 invoked from network); 27 Aug 2005 00:42:36 -0000
Received: from roar.cs.berkeley.edu (HELO roar.quarl.org) (128.32.35.215)
  by a.mx.sunsite.dk with SMTP; 27 Aug 2005 00:42:32 -0000
Received: by roar.quarl.org (Postfix, from userid 18378)
	id CAEAD5C0A7; Fri, 26 Aug 2005 17:42:29 -0700 (PDT)
From: Karl Chen <quarl@cs.berkeley.edu>
To: Zsh Devel List <zsh-workers@sunsite.dk>
Subject: contrib: auto-correct, cd-expand
X-Quack-Archive: 1
Date: Fri, 26 Aug 2005 17:42:29 -0700
Message-ID: <quack.20050826T1742.lth4q9cb47e@roar.cs.berkeley.edu>
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="QUACK-QUACK-QUACK-QUACK"
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham 
	version=3.0.4

--QUACK-QUACK-QUACK-QUACK


Here are some interactive functions I've been happily using for a
while.

quarl-auto-correct: automatically correct common typos.
- E.g. "c d" => "cd ", "cxat " => "cat "
- This is much more powerful than aliases; evolved out of separate
  functions I had for fixing "cv sup", "sv nup", "find.", etc.

quarl-cd-expand: auto-expand "cd foo" to "cd <pwd>/foo"
- Useful if you often reuse "cd" history.

Since I have multiple scripts that want to modify behavior of the
same widgets, I have:

quarl-add-hook: allow multiple "hooks" to widgets (in the style of
Emacs hooks).

To use, put files in fpath and run:

    autoload -U quarl-auto-correct-on && quarl-auto-correct-on
    autoload -U quarl-cd-expand-on && quarl-cd-expand-on


--QUACK-QUACK-QUACK-QUACK
Content-Type: application/octet-stream
Content-Disposition: attachment; filename=quarl-auto-correct-on

# -*- sh -*-
# $Id: quarl-auto-correct-on 7757 2005-02-20 00:45:33Z quarl $

# quarl's command-line auto-correction facility

# quarl 2005-01-01 initial version

autoload quarl-add-hook

quarl-auto-correct-on() {
    quarl-add-hook after self-insert q-auto-correct
}

typeset -g -A q_auto_corrections
q-add-auto-correction() {
    q_auto_corrections[$1]=$2
}

q-init-auto-correct() {
    q-add-auto-correction 'autolaod ' 'autoload '
    q-add-auto-correction 'c d' 'cd '
    q-add-auto-correction 'csv ' 'cvs '
    q-add-auto-correction 'cv s' 'cvs '
    q-add-auto-correction 'cxat ' 'cat '
    q-add-auto-correction 'dc ' 'cd '
    q-add-auto-correction 'ech o' 'echo '
    q-add-auto-correction 'ech0 ' 'echo '
    q-add-auto-correction 'find. ' 'find . '
    q-add-auto-correction 'kilall ' 'killall '
    q-add-auto-correction 'pign ' 'ping '
    q-add-auto-correction 'quota-v' 'quota -v'
    q-add-auto-correction 'sl ' 'ls '
    q-add-auto-correction 'snv ' 'svn '
    q-add-auto-correction 'sv n' 'svn '
    q-add-auto-correction 'cd.' 'cd .'
    q-add-auto-correction 'cd/' 'cd /'
    q-add-auto-correction 'lss ' 'less '
    q-add-auto-correction 'lses ' 'less '
    q-add-auto-correction 'elss ' 'less '
    q-add-auto-correction 'ess ' 'less '
}

q-auto-correct() {
    [[ -z $RBUFFER ]] || return;

    repl=$q_auto_corrections[$LBUFFER]
    if [[ -n $repl ]]; then
        zle -M "auto-correct: '$LBUFFER' => '$repl'"
        LBUFFER=$repl
    fi
}

q-init-auto-correct

[[ -o kshautoload ]] || quarl-auto-correct-on

--QUACK-QUACK-QUACK-QUACK
Content-Type: application/octet-stream
Content-Disposition: attachment; filename=quarl-cd-expand-on

# -*- sh -*-
# $Id: quarl-cd-expand-on 8361 2005-07-27 23:29:57Z quarl $

# Expand "cd foo" to "cd $PWD/foo".  Useful for making history more usable
# later.

# quarl 2005-01-01 initial version
# quarl 2005-07-27 bugfix for spaces in directories

autoload quarl-add-self-insert-hook

quarl-cd-expand-on() {
    quarl-add-hook after self-insert q-cd-expand
}

q-cd-expand() {
    [[ -z $RBUFFER ]] || return;

    local mpwd=${(q)PWD%/}

    if [[ $LBUFFER == cd\ [^/~=\$\|\`\ \'] ]]; then
        LBUFFER="cd $mpwd/$LBUFFER[-1]"
    elif [[ $LBUFFER == cd\ $PWD/cd\  ]]; then
        LBUFFER="cd "
    fi
}

[[ -o kshautoload ]] || quarl-cd-expand-on

--QUACK-QUACK-QUACK-QUACK
Content-Type: application/octet-stream
Content-Disposition: attachment; filename=quarl-add-hook
Content-Transfer-Encoding: base64

IyAtKi0gc2ggLSotCiMgJElkOiBxdWFybC1hZGQtaG9vayA3NTUwIDIwMDUtMDEtMjEgMDE6Mzc6
NDVaIHF1YXJsICQKCiMgQWxsb3cgbXVsdGlwbGUgaG9va3MgdG8gYSBzcGVjaWZpZWQgd2lkZ2V0
LgoKIyBTeW5vcHNpczoKIyAgIHF1YXJsLWFkZC1ob29rIGFmdGVyIHNlbGYtaW5zZXJ0IGZvbwoj
ICAgcXVhcmwtcmVtb3ZlLWhvb2sgYWZ0ZXIgc2VsZi1pbnNlcnQgZm9vCgojIEJlZm9yZS1ob29r
cyBzaG91bGQgcmV0dXJuIDEgaWYgdGhleSBkb24ndCB3YW50IHRoZSByZWFsIHdpZGdldCBleGVj
dXRlZC4KCiMgcXVhcmwgMjAwNS0wMS0wMSBpbml0aWFsIHZlcnNpb24KCnF1YXJsLWFkZC1ob29r
KCkgewogICAgaWYgW1sgJCMgIT0gMyB8fCAhICgkMSA9PSBiZWZvcmUgfHwgJDEgPT0gYWZ0ZXIp
IF1dOyB0aGVuCiAgICAgICAgcHJpbnQgLXUyICJzeW50YXg6IHF1YXJsLWFkZC1ob29rIFtiZWZv
cmV8YWZ0ZXJdIHdpZGdldC1uYW1lIGZ1bmNuYW1lIgogICAgICAgIHJldHVybiAxCiAgICBmaQoK
ICAgIHR5cGVzZXQgLWcgLWEgJChxLW1ha2UtaG9vay1uYW1lIGJlZm9yZSAkMikKICAgIHR5cGVz
ZXQgLWcgLWEgJChxLW1ha2UtaG9vay1uYW1lIGFmdGVyICQyKQogICAgemxlIC1OICQyIHEtcnVu
LXdpdGgtaG9va3MKCiAgICBxLWFkZC10by1saXN0ICQocS1tYWtlLWhvb2stbmFtZSAkMSAkMikg
JDMKfQoKcXVhcmwtcmVtb3ZlLWhvb2soKSB7CiAgICBpZiBbWyAkIyAhPSAzIHx8ICEgKCQxID09
IGJlZm9yZSB8fCAkMSA9PSBhZnRlcikgXV07IHRoZW4KICAgICAgICBwcmludCAtdTIgInN5bnRh
eDogcXVhcmwtcmVtb3ZlLWhvb2sgW2JlZm9yZXxhZnRlcl0gd2lkZ2V0LW5hbWUgZnVuY25hbWUi
CiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgcS1yZW1vdmUtZnJvbS1saXN0ICQocS1tYWtl
LWhvb2stbmFtZSAkMSAkMikgJDMKfQoKcS1tYWtlLWhvb2stbmFtZSgpIHsKICAgIGVjaG8gcV8k
ezI6Z3MvLS9fL31fJDFfaG9va3MKfQoKcS1hZGQtdG8tbGlzdCgpIHsKICAgICMgZXZhbCAkMSs9
JDIKICAgIGV2YWwgIiQxPShcJCQxICQyKSIKfQoKcS1yZW1vdmUtZnJvbS1saXN0KCkgewogICAg
bG9jYWwgLUEgcmVzdWx0CiAgICBmb3IgaG9vayBpbiAkeyhQKTF9OyBkbwogICAgICAgIGlmIFtb
ICRob29rICE9ICQyIF1dOyB0aGVuCiAgICAgICAgICAgICNyZXN1bHQrPSRob29rCiAgICAgICAg
ICAgIHJlc3VsdD0oJHJlc3VsdCAkaG9vaykKICAgICAgICBmaQogICAgZG9uZQogICAgZXZhbCAk
MT0oJHJlc3VsdCkKfQoKcS1ydW4taG9va3MoKSB7CiAgICAjIHJldHVybnMgMCBpZiBhbGwgb2Yg
dGhlIGhvb2tzIHJldHVybmVkIDAKICAgIGhvb2tuYW1lPSQocS1tYWtlLWhvb2stbmFtZSAkMSAk
MikKICAgIHJldHZhbD0wCiAgICBmb3IgaG9vayBpbiAkeyhQKWhvb2tuYW1lfSA7IGRvCiAgICAg
ICAgJGhvb2sgfHwgcmV0dmFsPTEKICAgIGRvbmUKICAgIHJldHVybiAkcmV0dmFsCn0KCnEtcnVu
LXdpdGgtaG9va3MoKQp7CiAgICBxLXJ1bi1ob29rcyBiZWZvcmUgJFdJREdFVCAmJiB6bGUgLiRX
SURHRVQKICAgIHEtcnVuLWhvb2tzIGFmdGVyICRXSURHRVQKfQoKW1sgLW8ga3NoYXV0b2xvYWQg
XV0gfHwgcXVhcmwtYWRkLWhvb2sgJEAK
--QUACK-QUACK-QUACK-QUACK



-- 
Karl 2005-08-26 17:31

--QUACK-QUACK-QUACK-QUACK--

