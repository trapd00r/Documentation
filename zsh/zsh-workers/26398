From zsh-workers-return-26398-mason-zsh=primenet.com.au@sunsite.dk Wed Jan 21 17:22:53 2009
Return-Path: <zsh-workers-return-26398-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13235 invoked from network); 21 Jan 2009 17:22:50 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.3 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 21 Jan 2009 17:22:50 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 13537 invoked from network); 21 Jan 2009 17:22:41 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 21 Jan 2009 17:22:41 -0000
Received: (qmail 8379 invoked by alias); 21 Jan 2009 17:22:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26398
Received: (qmail 8370 invoked from network); 21 Jan 2009 17:22:35 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 21 Jan 2009 17:22:35 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [208.87.233.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id A6056802720F
	for <zsh-workers@sunsite.dk>; Wed, 21 Jan 2009 18:22:31 +0100 (CET)
Received: from rly28g.srv.mailcontrol.com (localhost.localdomain [127.0.0.1])
	by rly28g.srv.mailcontrol.com (MailControl) with ESMTP id n0LHLamd012974
	for <zsh-workers@sunsite.dk>; Wed, 21 Jan 2009 17:22:28 GMT
Received: from submission.mailcontrol.com (submission.mailcontrol.com [86.111.216.190])
	by rly28g.srv.mailcontrol.com (MailControl) id n0LHKmRF004039
	for zsh-workers@sunsite.dk; Wed, 21 Jan 2009 17:20:48 GMT
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly28g-eth0.srv.mailcontrol.com (envelope-sender Peter.Stephenson@csr.com) (MIMEDefang) with ESMTP id n0LHKbDd002733; Wed, 21 Jan 2009 17:20:48 +0000 (GMT)
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Wed, 21 Jan 2009 17:18:50 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.2/8.13.4) with ESMTP id n0LHIjD2010730;
	Wed, 21 Jan 2009 17:18:45 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.2/8.14.2/Submit) with ESMTP id n0LHIj0S010726;
	Wed, 21 Jan 2009 17:18:45 GMT
Message-Id: <200901211718.n0LHIj0S010726@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: Richard Hartmann <richih.mailinglist@gmail.com>
cc: Zsh Workers <zsh-workers@sunsite.dk>
Subject: Re: Security hole in history handling for root
In-reply-to: <2d460de70901210854w1c68e79lbf0847b700822eff@mail.gmail.com>
References: <2d460de70901010632q3f2c1156x36a8d1e8a4445dd4@mail.gmail.com> <2d460de70901210854w1c68e79lbf0847b700822eff@mail.gmail.com>
Comments: In-reply-to Richard Hartmann <richih.mailinglist@gmail.com>
   message dated "Wed, 21 Jan 2009 17:54:08 +0100."
Date: Wed, 21 Jan 2009 17:18:45 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 21 Jan 2009 17:18:50.0585 (UTC) FILETIME=[53D6BC90:01C97BEC]
X-Scanned-By: MailControl A_08_51_00 (www.mailcontrol.com) on 10.71.1.138
X-Virus-Scanned: ClamAV 0.92.1/8884/Wed Jan 21 14:15:32 2009 on bifrost
X-Virus-Status: Clean

Richard Hartmann wrote:
> Bump.
> 
> This is a potential security issue.
>
>> zsh does not complain when loading from or writing
>> to a history file which is not owned by root or 600.

Is it?  zsh doesn't look at initialisation files, either.  That's surely
much more significant because they will be executed without any
indication.  In the case of history, you get to see it unless you use !.
If you can overwrite someone's history, you can overwrite their .zshrc.
Are you worried about an imported HISTFILE variable?  There are lots of
potentially dangerous environment variables we don't sanitize (PATH,
ZDOTDIR, ...).

Or is this only a problem with shared history?  I think Wayne added some
arrangements to make history from elsewhere appear different which could
presumably be extended.

If I can be convinced there is something specific in this case, as
opposed to a general security hole that needs much more thinking about,
it can be dealt with, but I haven't seen why yet.

(By the way, I realise Bart suggested you repost things, but the net
effect is likely to be that I increase my threshold below which I ignore
things even further.  If all these sorts of things are to be tackled we
NEED repeat NEED repeat NEED more people to work on bug fixes.)

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

