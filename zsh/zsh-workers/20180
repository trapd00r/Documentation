From zsh-workers-return-20180-mason-zsh=primenet.com.au@sunsite.dk Fri Jul 23 14:11:59 2004
Return-Path: <zsh-workers-return-20180-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5427 invoked from network); 23 Jul 2004 14:11:58 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 Jul 2004 14:11:58 -0000
Received: (qmail 63843 invoked from network); 23 Jul 2004 14:11:52 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 Jul 2004 14:11:52 -0000
Received: (qmail 13056 invoked by alias); 23 Jul 2004 14:11:41 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20180
Received: (qmail 13028 invoked from network); 23 Jul 2004 14:11:41 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by 130.225.247.90 with SMTP; 23 Jul 2004 14:11:41 -0000
Received: (qmail 60549 invoked from network); 23 Jul 2004 14:09:43 -0000
Received: from mail36.messagelabs.com (193.109.254.211)
  by a.mx.sunsite.dk with SMTP; 23 Jul 2004 14:09:20 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-19.tower-36.messagelabs.com!1090591759!7913368
X-StarScan-Version: 5.2.10; banners=-,-,-
X-Originating-IP: [158.234.9.163]
Received: (qmail 22016 invoked from network); 23 Jul 2004 14:09:19 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-19.tower-36.messagelabs.com with SMTP; 23 Jul 2004 14:09:19 -0000
Received: from trentino.logica.co.uk ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id i6NE9JUI014346;
	Fri, 23 Jul 2004 15:09:19 +0100
Received: from trentino.logica.co.uk (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP
	id F0D827AB6CBB; Fri, 23 Jul 2004 16:08:34 +0200 (CEST)
Cc: zsh-workers@sunsite.dk
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <20040721211529.GA2406@watt.intra.caraldi.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <20040721211529.GA2406@watt.intra.caraldi.com>
To: Jean-Baptiste Quenot <jb.quenot@caraldi.com>
Subject: Re: [PATCH] killall completion for FreeBSD 
Date: Fri, 23 Jul 2004 16:08:34 +0200
Message-ID: <25025.1090591714@trentino.logica.co.uk>
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

Jean-Baptiste Quenot wrote:
> I noticed that killall completion does  not work on FreeBSD.  This patch
> addresses the issue, as the  completion was originally only intended for
> GNU/Linux.   Indeed,  FreeBSD  uses  a  slightly  different  syntax  for
> expressing ps output options.

Thanks.

That doesn't seem to work on the sourceforge FreeBSD 4.8 machine. As
you say, it comes down to the syntax for ps output options. `ps ho cmd'
seems to be Linux only. `ps ho comm' is more suitable because it
doesn't print arguments but it doesn't seem to work everywhere. `ps ho
command' seems to work on all the BSDs I tried. So I'll try this patch
instead.

Oliver

Index: Completion/Unix/Command/_killall
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_killall,v
retrieving revision 1.2
diff -u -r1.2 _killall
--- Completion/Unix/Command/_killall	19 Aug 2002 15:00:10 -0000	1.2
+++ Completion/Unix/Command/_killall	23 Jul 2004 13:51:37 -0000
@@ -1,9 +1,9 @@
 #compdef killall killall5
 
-if [[ $service = killall && "$OSTYPE" = linux* ]]; then
+if [[ $service = killall && "$OSTYPE" = (linux*|*bsd*|darwin*) ]]; then
   _alternative \
-      'signals:: _signals -p' \
-      'processes:process:{ compadd "$expl[@]" ${${${${(f)"$(_call_program processes-names ps ${${EUID/(#s)0(#e)/xa}//[0-9]#/} ho cmd 2> /dev/null)"//[][\(\)]/}:#(ps|COMMAND|-*)}%%\ *}:t} }'
+    'signals:: _signals -p' \
+    'processes-names:process:{ compadd "$expl[@]" ${${${${(f)"$(_call_program processes-names ps ${${EUID/(#s)0(#e)/xa}//[0-9]#/}ho command 2> /dev/null)"//[][\(\)]/}:#(ps|COMMAND|-*)}%%\ *}:t} }'
 else
   _signals -p
 fi

