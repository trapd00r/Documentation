From zsh-workers-return-9189-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Jan 04 08:10:38 2000
Return-Path: <zsh-workers-return-9189-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5934 invoked from network); 4 Jan 2000 08:10:36 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 4 Jan 2000 08:10:36 -0000
Received: (qmail 10888 invoked by alias); 4 Jan 2000 08:10:30 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9189
Received: (qmail 10881 invoked from network); 4 Jan 2000 08:10:30 -0000
Date: Tue, 4 Jan 2000 09:10:29 +0100 (MET)
Message-Id: <200001040810.JAA22081@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Peter Stephenson's message of Tue, 21 Dec 1999 22:34:56 +0000
Subject: PATCH: Re: Approximate completion


Peter Stephenson wrote:

> Approximate completion seems to be be broken in some non-obvious way.  If I
> try to complete 50dc.z to 50cd.ztst, the right completion appears as an
> argument to compadd, but nothing is inserted.  Correction with ^Xc seems to
> work.  Indeed, completing 50dc.zts works, too: since I have max errors set
> to 2, this suggest that for some reason it isn't matching with a * at the
> end of the test string at some point.

No. I had to make globbing flags be treated specially lately for
functions like _path_files that use hidden prefixes. The code now
takes the flags (if they are at the beginning of $PREFIX) and moves
them after the matched prefix. But I forgot to update the cached
prefix-length after extracting the flags.

Bye
 Sven

diff -u -r oldsrc/Zle/compcore.c Src/Zle/compcore.c
--- oldsrc/Zle/compcore.c	Wed Dec 29 22:26:15 1999
+++ Src/Zle/compcore.c	Mon Jan  3 19:58:57 2000
@@ -1680,6 +1680,7 @@
 			p[1] = sav;
 
 			lpre = p + 1;
+			llpl -= gfl;
 		    }
 		}
 		s = dat->ppre ? dat->ppre : "";

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

