From zsh-users-return-8380-mason-zsh=primenet.com.au@sunsite.dk Sun Jan 16 16:08:58 2005
Return-Path: <zsh-users-return-8380-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8461 invoked from network); 16 Jan 2005 16:08:57 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Jan 2005 16:08:57 -0000
Received: (qmail 52111 invoked from network); 16 Jan 2005 16:08:47 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Jan 2005 16:08:47 -0000
Received: (qmail 3361 invoked by alias); 16 Jan 2005 16:08:38 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8380
Received: (qmail 3351 invoked from network); 16 Jan 2005 16:08:38 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 16 Jan 2005 16:08:38 -0000
Received: (qmail 51017 invoked from network); 16 Jan 2005 16:08:38 -0000
Received: from mail3.ecc.u-tokyo.ac.jp (133.11.171.218)
  by a.mx.sunsite.dk with SMTP; 16 Jan 2005 16:08:33 -0000
Received: from spam002.ecc.u-tokyo.ac.jp (spam002.ecc.u-tokyo.ac.jp [133.11.50.195])
	by mail3.ecc.u-tokyo.ac.jp (Postfix) with ESMTP id C09027032C
	for <zsh-users@sunsite.dk>; Mon, 17 Jan 2005 01:08:30 +0900 (JST)
Received: from [192.168.1.12] ( [222.13.222.114])
	by spam002.ecc.u-tokyo.ac.jp (SpamBlock.pst 3.4.25)
	with ESMTP id <D72A535D-67D8-11D9-AF71-000D93502E64@h8.dion.ne.jp>
	for <zsh-users@sunsite.dk>; Mon, 17 Jan 2005 01:08:29 +0900
In-Reply-To: <D010BCC1-6716-11D9-9019-000A95D2C79E@kalama.no-ip.org>
References: <ED23CF10-DBCD-11D8-BFB6-000D93502E64@h8.dion.ne.jp> <5F375244-DBDD-11D8-8A54-000D93502E64@h8.dion.ne.jp> <D010BCC1-6716-11D9-9019-000A95D2C79E@kalama.no-ip.org>
Mime-Version: 1.0 (Apple Message framework v619)
Content-Type: text/plain; charset=US-ASCII; format=flowed
Message-Id: <D72A535D-67D8-11D9-AF71-000D93502E64@h8.dion.ne.jp>
Content-Transfer-Encoding: 7bit
Cc: lists <lists@kalama.no-ip.org>
From: Motoi Washida <a66@h8.dion.ne.jp>
Subject: Re: Completion functions for Mac OS X
Date: Mon, 17 Jan 2005 01:08:20 +0900
To: zsh-users@sunsite.dk
X-Mailer: Apple Mail (2.619)
X-IP: 222.13.222.114
X-FROM-DOMAIN: h8.dion.ne.jp
X-FROM-EMAIL: a66@h8.dion.ne.jp
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

Hi Ryan,

On 2005/01/16, at 1:59, lists wrote:

> defaults read /Applications/TextEdit.app/Contents/Info
>
> will normally display the contents of 
> /Applications/TextEdit.app/Contents/Info.plist
Heh. I didn't know that. Is this a hidden feature? I can't find any 
documents about that.

> If I use the _defaults completion, this doesn't work (and neither does 
> TAB completion: 'defaults read /App<TAB>').  Could _defaults be 
> modified to allow for viewing of xml files which aren't registered as 
> a defaults domain?  I'd love to help but haven't been able to get the 
> hang of writing completions yet.
Here is a patch to complete plist files.

--
Motoi Washida

Index: Completion/Darwin/Command/_defaults
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Darwin/Command/_defaults,v
retrieving revision 1.1
diff -d -u -r1.1 _defaults
--- Completion/Darwin/Command/_defaults	23 Jul 2004 13:38:12 -0000	1.1
+++ Completion/Darwin/Command/_defaults	16 Jan 2005 15:43:35 -0000
@@ -1,12 +1,16 @@
  #compdef defaults

  _defaults_domains(){
-  local str="$(_call_program domains defaults domains 2>/dev/null)"
-  local expl
-  local -a list
-  list=( ${(s/, /)str} -g -globalDomain )
-  _wanted domains expl 'defaults database domain' \
-      compadd -M 'r:|.=* r:|=*' -a list
+  if [[ "`eval echo $PREFIX`" != [/~]* ]]; then
+    local str="$(_call_program domains defaults domains 2>/dev/null)"
+    local expl
+    local -a list
+    list=( ${(s/, /)str} -g -globalDomain )
+    _wanted domains expl 'defaults database domain' \
+        compadd -M 'r:|.=* r:|=*' -a list
+  else
+    _files -g '*.plist(e:"reply=\${REPLY%.plist}":)'
+  fi
  }

  _defaults_keys(){

