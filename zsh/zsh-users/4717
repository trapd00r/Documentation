From zsh-users-return-4717-mason-zsh=primenet.com.au@sunsite.dk Thu Feb 28 16:47:04 2002
Return-Path: <zsh-users-return-4717-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12455 invoked from network); 28 Feb 2002 16:47:03 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 28 Feb 2002 16:47:03 -0000
Received: (qmail 13844 invoked by alias); 28 Feb 2002 16:45:19 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4717
Received: (qmail 13774 invoked from network); 28 Feb 2002 16:45:16 -0000
Date: Thu, 28 Feb 2002 08:45:03 -0800 (PST)
From: Bart Schaefer <schaefer@brasslantern.com>
Sender: schaefer@ns1.sodaware.com
To: Ian Lynagh <igloo@earth.li>
cc: zsh-users@sunsite.dk
Subject: Re: Length of %? in prompt
In-Reply-To: <20020228153400.GA31674@stu163.keble.ox.ac.uk>
Message-ID: <Pine.LNX.4.44.0202280827160.31050-100000@ns1.sodaware.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 28 Feb 2002, Ian Lynagh wrote:

> I have just a couple more problems. Firstly I can't find a way to have
> ANSI escape sequences actually executed when they are passed through
> psvar - is this possible?

No, it's not possible.  The contents of psvar are always passed through
zsh's internal "nice display" filter, which works sort of like "cat -v".

> And secondly with
>     "%\$((\$COLUMNS-2))>%{%}k>"
> the %{%} appear in the prompt

In %N>STRING> the STRING is not re-interpreted for prompt escapes, but it
is not "nice-filtered" either.  Which also explains this:

> and both
>     "%\$((\$COLUMNS-2))>${(%%):-%{$fg_bold[cyan]%\}}k>"
> and "%\$((\$COLUMNS-2))>\${(%%):-%{$fg_bold[cyan]%\}}k>"
> seem to be counting the length of the ANSI escape sequence in the length
> calculation - am I missing something?

However, it's not making any sense to me that you want to insert a color
change only when the string is truncated.  I think you're probably seeking
something like this:

PS1='%$((COLUMNS/2))> >blah blah blah %<<%{$fg_bold[cyan]%}'

where "blah blah blah" is the variable-width stuff you want truncated.

