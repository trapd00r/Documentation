From zsh-users-return-8880-mason-zsh=primenet.com.au@sunsite.dk Sat May 21 10:18:04 2005
Return-Path: <zsh-users-return-8880-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7033 invoked from network); 21 May 2005 10:18:03 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 21 May 2005 10:18:03 -0000
Received: (qmail 2612 invoked from network); 21 May 2005 10:17:54 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 21 May 2005 10:17:54 -0000
Received: (qmail 29048 invoked by alias); 21 May 2005 10:17:48 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8880
Received: (qmail 29033 invoked from network); 21 May 2005 10:17:47 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 21 May 2005 10:17:47 -0000
Received: (qmail 1748 invoked from network); 21 May 2005 10:17:47 -0000
Received: from zproxy.gmail.com (64.233.162.192)
  by a.mx.sunsite.dk with SMTP; 21 May 2005 10:17:42 -0000
Received: by zproxy.gmail.com with SMTP id 13so1171464nzp
        for <zsh-users@sunsite.dk>; Sat, 21 May 2005 03:17:41 -0700 (PDT)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:reply-to:to:subject:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references;
        b=LK0QtbTHFqX32LPtslWTMv7SKBycUK0XYdUz06MDR5OxTT4I8vkMCFy3IPJ6IcRGmjbtDpo38IN0Dtiw9W7wVMwt0mMaWjsJiGzsnlgp7PQRYgiKGSB8Fz8uPEjIyYCAPwyznuOrQVJmdvSzyl2kNqP72dJ29e3PpKKmyyKK4iU=
Received: by 10.36.68.2 with SMTP id q2mr1125947nza;
        Sat, 21 May 2005 03:17:41 -0700 (PDT)
Received: by 10.36.20.7 with HTTP; Sat, 21 May 2005 03:17:41 -0700 (PDT)
Message-ID: <237967ef0505210317524db963@mail.gmail.com>
Date: Sat, 21 May 2005 12:17:41 +0200
From: Mikael Magnusson <mikachu@gmail.com>
Reply-To: Mikael Magnusson <mikachu@gmail.com>
To: Zsh users list <zsh-users@sunsite.dk>
Subject: Re: retrieving the results of last command?
In-Reply-To: <200505201355.j4KDtxMm031147@news01.csr.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline
References: <20050520121834.GA32499@let.rug.nl> <1049.1116593698@csr.com>
	 <237967ef05052006445c7578e9@mail.gmail.com>
	 <200505201355.j4KDtxMm031147@news01.csr.com>
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=6.0 tests=AWL,BAYES_00,RCVD_BY_IP 
	autolearn=ham version=3.0.2
X-Spam-Hits: -2.4

On 5/20/05, Peter Stephenson <pws@csr.com> wrote:
> Mikael Magnusson wrote:
> > On 5/20/05, Peter Stephenson <pws@csr.com> wrote:
> > > insert-last-command-output() {
> > >   LBUFFER+=3D3D"$(eval $history[$((HISTCMD-1))])"
> > > }
>=20
> > Hello,
> > Is there a way to ask for confirmation here? It's not always history
> > contains what you expect, for example if you share history and just
> > ran rm -rf . in another terminal, and press this bind you might not be
> > so happy with the outcome. Ie something like
> > zsh: are you sure you want to run $history[$((HISTCMD-1))] again? [yn]
> > Is the read builtin what i want? I never quite got the hang of that one=
.
>=20
> With 4.2, the best way of prompting from within a command line is to use
> the supplied function read-from-minibuffer.  Something like this:
>=20
> insert-last-command-output() {
>   local hist=3D$history[$((HISTCMD-1))] REPLY
>=20
>   autoload -U read-from-minibuffer
>   read-from-minibuffer -k1 "Do you want to execute
>   $hist
> again y/[n]? " || [[ $REPLY =3D [yY]* ]] || return 1
>=20
>   LBUFFER+=3D"$(eval $hist)"
> }

Thanks, that works fine (i assume the first || should be a && though).

(ps, sorry about the ccing on the last mail, gmail still does the
wrong thing when replying to a mailing lists and i didn't quite fix it
right.)
--=20
Mikael Magnusson

