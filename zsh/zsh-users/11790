From zsh-users-return-11790-mason-zsh=primenet.com.au@sunsite.dk Tue Aug 21 17:33:16 2007
Return-Path: <zsh-users-return-11790-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24224 invoked from network); 21 Aug 2007 17:33:14 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.1 (2007-05-02) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 21 Aug 2007 17:33:14 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 61209 invoked from network); 21 Aug 2007 17:33:08 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 21 Aug 2007 17:33:08 -0000
Received: (qmail 9907 invoked by alias); 21 Aug 2007 17:32:59 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11790
Received: (qmail 9895 invoked from network); 21 Aug 2007 17:32:58 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 21 Aug 2007 17:32:58 -0000
Received: (qmail 59865 invoked from network); 21 Aug 2007 17:32:58 -0000
Received: from cluster-d.mailcontrol.com (217.69.20.190)
  by a.mx.sunsite.dk with SMTP; 21 Aug 2007 17:32:55 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly32d.srv.mailcontrol.com (MailControl) with ESMTP id l7LHWfNR027035
	for <zsh-users@sunsite.dk>; Tue, 21 Aug 2007 18:32:50 +0100
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Tue, 21 Aug 2007 18:32:41 +0100
Date: Tue, 21 Aug 2007 18:32:40 +0100
From: Peter Stephenson <pws@csr.com>
To: zsh-users@sunsite.dk
Subject: Re: Problem with zsh up-line-or-beginning-search and
 down-line-or-beginning-search functions
Message-ID: <20070821183240.1ceca49c@news01.csr.com>
In-Reply-To: <ab0b893f0708211018y535a0da9h9a6f0d0aa447d7@mail.gmail.com>
References: <ab0b893f0708211018y535a0da9h9a6f0d0aa447d7@mail.gmail.com>
Organization: CSR
X-Mailer: Claws Mail 2.9.1 (GTK+ 2.10.13; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 21 Aug 2007 17:32:41.0204 (UTC) FILETIME=[4688E340:01C7E419]
X-Scanned-By: MailControl A-07-08-00 (www.mailcontrol.com) on 10.68.0.142

On Tue, 21 Aug 2007 13:18:12 -0400
"Bryan Jacobs" <braujac@braujac.org> wrote:
> When the "unset" option is off, causing zsh to prompt whenever an unknown
> parameter would be expanded, trying to trigger these functions causes an
> error message stating that "__searching" is unset.  Which it is.
> 
> Adding "emulate -L zsh; setopt unset" to the top of these two functions
> resolves the issue.

unset is in any case the default in zsh emulation, but otherwise that seems
a reasonable fix.

Index: Functions/Zle/down-line-or-beginning-search
===================================================================
RCS file: /cvsroot/zsh/zsh/Functions/Zle/down-line-or-beginning-search,v
retrieving revision 1.2
diff -u -r1.2 down-line-or-beginning-search
--- Functions/Zle/down-line-or-beginning-search	4 Apr 2002 11:59:10 -0000	1.2
+++ Functions/Zle/down-line-or-beginning-search	21 Aug 2007 17:27:35 -0000
@@ -1,6 +1,8 @@
 # Like down-line-or-search, but uses the whole line prefix up to the
 # cursor position for searching forwards.
 
+emulate -L zsh
+
 if [[ ${+NUMERIC} -eq 0 &&
     ( $LASTWIDGET = $__searching || $RBUFFER != *$'\n'* ) ]]
 then
Index: Functions/Zle/up-line-or-beginning-search
===================================================================
RCS file: /cvsroot/zsh/zsh/Functions/Zle/up-line-or-beginning-search,v
retrieving revision 1.2
diff -u -r1.2 up-line-or-beginning-search
--- Functions/Zle/up-line-or-beginning-search	4 Apr 2002 11:59:10 -0000	1.2
+++ Functions/Zle/up-line-or-beginning-search	21 Aug 2007 17:27:35 -0000
@@ -1,6 +1,8 @@
 # Like up-line-or-search, but uses the whole line prefix up to the
 # cursor position for searching backwards.
 
+emulate -L zsh
+
 if [[ $LBUFFER == *$'\n'* ]]; then
   zle .up-line-or-history
   __searching=''


-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


.

