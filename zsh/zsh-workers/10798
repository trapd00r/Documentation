From zsh-workers-return-10798-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Apr 18 07:06:36 2000
Return-Path: <zsh-workers-return-10798-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4614 invoked from network); 18 Apr 2000 07:06:34 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 18 Apr 2000 07:06:34 -0000
Received: (qmail 17239 invoked by alias); 18 Apr 2000 07:06:18 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10798
Received: (qmail 17230 invoked from network); 18 Apr 2000 07:06:17 -0000
Date: Tue, 18 Apr 2000 09:06:12 +0200 (MET DST)
Message-Id: <200004180706.JAA18756@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Felix Rosencrantz's message of Mon, 17 Apr 2000 18:20:06 -0700
	(PDT)
Subject: Re: PATCH: partial word completion


Felix Rosencrantz wrote:

> Zsh seems to crash now with this patch.  The third parameter to sub_join()
> is NULL, which causes the crash.  Here's the stack trace:
> 
> ...
> 
> Sorry not to provide a simple test case.  If you need that I can investigate
> a little more.  The error happened in a directory with many files, and
> some simple pruning didn't uncover the error.

Ouch. That was something between a typo and a thinko.

Better check the variable that will be used...

Bye
 Sven

Index: Src/Zle/compmatch.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compmatch.c,v
retrieving revision 1.5
diff -u -r1.5 compmatch.c
--- Src/Zle/compmatch.c	2000/04/17 07:56:25	1.5
+++ Src/Zle/compmatch.c	2000/04/18 07:04:09
@@ -1893,10 +1893,10 @@
 			    for (tt = o;
 				 (to = tt->next) &&
 				     !cmp_anchors(tn, to, 1); tt = to);
-			    if (tt)
+			    if (to)
 				break;
 			}
-			if (tt) {
+			if (to) {
 			    diff = sub_join(n, o, to, 1);
 
 			    if (po)

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

