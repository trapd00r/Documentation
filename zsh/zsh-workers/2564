From zsh-workers-request@euclid.skiles.gatech.edu Thu Dec 12 14:42:43 1996
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 662 invoked from network); 12 Dec 1996 14:42:41 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 12 Dec 1996 14:42:41 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id JAA04268; Thu, 12 Dec 1996 09:36:18 -0500 (EST)
Resent-Date: Thu, 12 Dec 1996 09:36:18 -0500 (EST)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199612121436.PAA10835@bolyai.cs.elte.hu>
Subject: Re: zsh-3.0.1-test2 compilation problem
In-Reply-To: <ttp3exbhqfh.fsf@stsun46.sea.ericsson.se> from Thomas Winder at "Dec 12, 96 01:56:18 pm"
To: thomas.winder@sea.ericsson.se (Thomas Winder)
Date: Thu, 12 Dec 1996 15:36:49 +0100 (MET)
Cc: zsh-workers@math.gatech.edu
Organization: Dept. of Comp. Sci., Eotvos University, Budapest, Hungary
Phone: (36 1)2669833 ext: 2667, home phone: (36 1) 2752368
X-Mailer: ELM [version 2.4ME+ PL27 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"Vso__3.0.a21.XX1io"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2564
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Thomas Winder wrote:
> Trying to compile zsh-3.0.1-test2 on sparclinux-961210 shows the
> following: 
[...]
> builtin.c:3686: #error there are some unknown limits.  Fix me!

I compiled zsh on plain RedHad-4.0-sparc which has an old resources.h
that's why I did not notice it.  The patch below should fix it.  I'm in the
process of replacing SunOS 4 to SparcLinux here and as a test I installed
it on a SUN ELC but that's a lot slower than a 386 DX/40 so I do not have
time to compile the kernel on it, I only use binary kernel images, and I
forgot to upgrage the includes.

That compiles on SparcLinux fine, but it may break something else, so
please test it (especially those using UP-UX-10.20, Digital Unix 4.x or
AIX-4.x).

I know this preprocessor trickery is ugly but the alternatives are not much
better either.  We can generate limits with an awk script but it took more
than a year to make the awk script generating signames.h portable.  And for
that we have to find out where are the RLIMIT_ macros defined (that seems
to be always in /usr/include/sys/resource.h but on Linux it is under asm).

Zoltan


*** Src/builtin.c	1996/12/11 02:27:28	3.1.0.10
--- Src/builtin.c	1996/12/12 14:08:25
***************
*** 2556,2566 ****
  #  define NEXT_RLIM (RLIMIT_MEMLOCK + 1)
      "memorylocked",
  # endif /* RLIMIT_MEMLOCK */
- # if defined RLIMIT_AS && RLIMIT_AS == NEXT_RLIM
- #  undef NEXT_RLIM
- #  define NEXT_RLIM (RLIMIT_AS + 1)
-     "addressspace",
- # endif /* RLIMIT_AS */
  # if defined RLIMIT_NPROC && RLIMIT_NPROC == NEXT_RLIM
  #  undef NEXT_RLIM
  #  define NEXT_RLIM (RLIMIT_NPROC + 1)
--- 2556,2561 ----
***************
*** 2571,2576 ****
--- 2566,2576 ----
  #  define NEXT_RLIM (RLIMIT_MEMLOCK + 1)
      "memorylocked",
  # endif /* RLIMIT_MEMLOCK */
+ # if defined RLIMIT_AS && RLIMIT_AS == NEXT_RLIM
+ #  undef NEXT_RLIM
+ #  define NEXT_RLIM (RLIMIT_AS + 1)
+     "addressspace",
+ # endif /* RLIMIT_AS */
  # if defined RLIMIT_NOFILE && RLIMIT_NOFILE == NEXT_RLIM
  #  undef NEXT_RLIM
  #  define NEXT_RLIM (RLIMIT_NOFILE + 1)

