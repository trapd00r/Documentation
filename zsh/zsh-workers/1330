From pws@ifh.de Tue Jun 11 21:46:10 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3/2) with ESMTP id VAA16629 for <mason@werple.mira.net.au>; Tue, 11 Jun 1996 21:46:07 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id HAA10804; Tue, 11 Jun 1996 07:17:14 -0400 (EDT)
Resent-Date: Tue, 11 Jun 1996 07:17:14 -0400 (EDT)
Message-Id: <199606111116.NAA21006@hydra.ifh.de>
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: Re: bugs 
In-reply-to: "hzoli@cs.elte.hu"'s message of "Tue, 11 Jun 1996 11:46:39 MET."
             <199606110946.LAA10279@bolyai.cs.elte.hu> 
Date: Tue, 11 Jun 1996 13:16:41 +0200
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"h9r9L2.0.ke2.vMLln"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1330
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 1270
Status: OR

hzoli@cs.elte.hu wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> 
> > Now here's another bug:
> > 
> > I type:
> > echo $ZSH_
> > then I type TAB 3 times. Here's what I get:
> > 
> > Allo? echo $ZSH_
> > ZSH_NAME     ZSH_VERSION
> > Allo? echo $ZSH_NAMEBUG: permanent allocation in parsestr
> > BUG: permanent allocation in prefork                                       
>  VERSION
> 
> Here is the fix.

There's another one in reversemenucomplete() which needs just the same
treatment.  I'd just made a patch for both, I can't be bothered to
extract the second one.

I was going to make the comment that all these permalloc()'s and so on
buried deep inside the code give me the screaming heebeejeebees (or
whatever it is you're supposed to get).  We really need to upgrade
permalloc(), heapalloc() and lastalloc() to use a stack, so we can
have matching heapalloc()/lastalloc() pairs at any depth in the code,
and these functions get called only when they're actually needed.
Then you have to manage the allocation of this stack, of course.

-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77330
Deutches Electronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.


