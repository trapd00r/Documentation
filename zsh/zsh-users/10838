From zsh-users-return-10838-mason-zsh=primenet.com.au@sunsite.dk Thu Oct 12 10:05:04 2006
Return-Path: <zsh-users-return-10838-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24380 invoked from network); 12 Oct 2006 10:05:01 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.6 (2006-10-03) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.6
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 12 Oct 2006 10:05:01 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 23380 invoked from network); 12 Oct 2006 10:04:52 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 12 Oct 2006 10:04:52 -0000
Received: (qmail 19567 invoked by alias); 12 Oct 2006 10:04:42 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10838
Received: (qmail 19554 invoked from network); 12 Oct 2006 10:04:41 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 12 Oct 2006 10:04:41 -0000
Received: (qmail 22062 invoked from network); 12 Oct 2006 10:04:41 -0000
Received: from vinc17.net8.nerim.net (HELO prunille.vinc17.org) (62.212.121.106)
  by a.mx.sunsite.dk with SMTP; 12 Oct 2006 10:04:39 -0000
Received: by prunille.vinc17.org (Postfix, from userid 501)
	id 811EFD5358C; Thu, 12 Oct 2006 12:04:36 +0200 (CEST)
Date: Thu, 12 Oct 2006 12:04:36 +0200
From: Vincent Lefevre <vincent@vinc17.org>
To: "Com MN PG P E B Consultant 3" <mn-pg-p-e-b-consultant-3.com@siemens.com>
Cc: bug-bash@gnu.org, "zsh-users Mailinglist" <zsh-users@sunsite.dk>
Subject: Re: logout from interactive subshell
Message-ID: <20061012100436.GC28997@prunille.vinc17.org>
Mail-Followup-To: "Com MN PG P E B Consultant 3" <mn-pg-p-e-b-consultant-3.com@siemens.com>,
	bug-bash@gnu.org, "zsh-users Mailinglist" <zsh-users@sunsite.dk>
References: <F7507090F1A72B43A51444325DFBE43101391DF2@MCHP7R6A.ww002.siemens.net>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <F7507090F1A72B43A51444325DFBE43101391DF2@MCHP7R6A.ww002.siemens.net>
X-Mailer-Info: http://www.vinc17.org/mutt/
User-Agent: Mutt/1.5.13-vl-r13495 (2006-10-09)

On 2006-10-12 10:47:38 +0200, Com MN PG P E B Consultant 3 wrote:
> Does someone know how to deal with the following situation?
> 
> Very often I do the following pattern:
> 
>    (1) rlogin to a foreign host
>    (2) Invoke a subshell (for example because I'm setting a Clearcase
> View)

Is it a subshell or a second-level shell? (In the first case, $$ and
$PPID remain the same.)

>    (3) Logout from the host
> 
> Step (3) needs two steps: First I have to type 'exit' to leave the
> subshell, and then either 'exit' or 'logout' to leave the login
> shell.
> 
> Is it possible to automate this in such a way that I have to type
> only one command, to leave all subshells (in this case, only 1, but
> in general, I might be several subshells deep) AND then logout?
> 
> One idea would be to use ps, locate the process to the current
> subshell, crawling upwards via the PPIDs to find the PID of the
> login shell, and kill it. But this seems to be such an awkward
> solution, that I thought maybe there is an easier way to do it.

You don't need ps. Just get the ppid with $PPID if possible (see
above) or by some other mean (see thread "Subshells and parameters"
in the zsh-users archives). Each subshell can use a trap to be able
to kill its parent. But bash and zsh behave differently concerning
traps.

Alternatively, the command that invokes the subshell could call
'exit' after it has finished (you can write a wrapper, e.g. as a
shell function).

-- 
Vincent Lefèvre <vincent@vinc17.org> - Web: <http://www.vinc17.org/>
100% accessible validated (X)HTML - Blog: <http://www.vinc17.org/blog/>
Work: CR INRIA - computer arithmetic / Arenaire project (LIP, ENS-Lyon)

