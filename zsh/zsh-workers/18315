From zsh-workers-return-18315-mason-zsh=primenet.com.au@sunsite.dk Fri Feb 28 00:46:20 2003
Return-Path: <zsh-workers-return-18315-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11831 invoked from network); 28 Feb 2003 00:46:19 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 28 Feb 2003 00:46:19 -0000
Received: (qmail 11608 invoked by alias); 28 Feb 2003 00:46:13 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18315
Received: (qmail 11600 invoked from network); 28 Feb 2003 00:46:12 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 28 Feb 2003 00:46:12 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [207.172.4.61] by sunsite.dk (MessageWall 1.0.8) with SMTP; 28 Feb 2003 0:46:12 -0000
Received: from 209-122-247-161.c3-0.nwt-ubr2.sbo-nwt.ma.cable.rcn.com ([209.122.247.161] helo=zion.rcn.com)
	by smtp02.mrf.mail.rcn.net with esmtp (Exim 3.35 #4)
	id 18oYfE-0000eh-00; Thu, 27 Feb 2003 19:46:12 -0500
Received: by zion.rcn.com (Postfix, from userid 501)
	id 366C479CF; Thu, 27 Feb 2003 19:44:58 -0500 (EST)
To: Peter Stephenson <pws@csr.com>
Cc: zsh-workers@sunsite.dk
Subject: Re: Yank-pop Dumps Core
From: Vin Shelton <acs@alumni.princeton.edu>
Organization: EtherSoft, Inc
Date: Thu, 27 Feb 2003 19:44:58 -0500
In-Reply-To: <29108.1046345075@csr.com> (Peter Stephenson's message of "Thu,
 27 Feb 2003 11:24:35 +0000")
Message-ID: <m2vfz5mdx1.fsf@zion.rcn.com>
Lines: 50
References: <29108.1046345075@csr.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

Peter Stephenson <pws@csr.com> writes:
> Vin Shelton wrote:
>> In the latest CVS sources, the following recipe dumps core:
>> 
>> zsh -f
>> bindkey -e
>> asdf^A^K^Y<esc>y
>
> Thanks for spotting this.  Here's cant_yankpop_if_no_kring.dif.
>
> You should find the bug only happened if you'd done exactly one kill.
>
> Index: Src/Zle/zle_misc.c
> ===================================================================
> RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_misc.c,v
> retrieving revision 1.7
> diff -u -r1.7 zle_misc.c
> --- Src/Zle/zle_misc.c	27 Jan 2003 14:55:00 -0000	1.7
> +++ Src/Zle/zle_misc.c	27 Feb 2003 11:22:49 -0000
> @@ -372,7 +372,7 @@
>      int cc, kctstart = kct;
>      Cutbuffer buf;
>  
> -    if (!(lastcmd & ZLE_YANK))
> +    if (!(lastcmd & ZLE_YANK) || !kring)
>  	return 1;
>      do {
>  	/*
>
> -- 
> Peter Stephenson <pws@csr.com>                  Software Engineer
> CSR Ltd., Science Park, Milton Road,
> Cambridge, CB4 0WH, UK                          Tel: +44 (0)1223 692070
>
>
> **********************************************************************
> The information transmitted is intended only for the person or
> entity to which it is addressed and may contain confidential 
> and/or privileged material. 
> Any review, retransmission, dissemination or other use of, or
> taking of any action in reliance upon, this information by 
> persons or entities other than the intended recipient is 
> prohibited.  
> If you received this in error, please contact the sender and 
> delete the material from any computer.
> **********************************************************************

Peter, yes that worked.  Thanks!

  - Vin

