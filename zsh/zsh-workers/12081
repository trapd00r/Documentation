From zsh-workers-return-12081-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Jun 27 07:21:03 2000
Return-Path: <zsh-workers-return-12081-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3971 invoked from network); 27 Jun 2000 07:21:01 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 27 Jun 2000 07:21:01 -0000
Received: (qmail 16944 invoked by alias); 27 Jun 2000 07:20:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12081
Received: (qmail 16932 invoked from network); 27 Jun 2000 07:20:31 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer david.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>,
   "ZSH workers mailing list" <zsh-workers@sunsite.auc.dk>
Subject: PATCH: zpty for Cygwin 
Date: Tue, 27 Jun 2000 11:20:27 +0400
Message-ID: <000101bfe008$2b3bc200$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----=_NextPart_000_0002_01BFE029.B24D6200"
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2919.6700
Importance: Normal
In-Reply-To: <000001bfe006$bc2cc720$21c9ca95@mow.siemens.ru>

This is a multi-part message in MIME format.

------=_NextPart_000_0002_01BFE029.B24D6200
Content-Type: text/plain;
	charset="koi8-r"
Content-Transfer-Encoding: 7bit

> 
> Cygwin is using SVR4-style ptys without STREAMS support. The attached
> patch makes it possible to compile zpty.c under Cygwin.

Sorry, I forgot to attach.

-andrej
------=_NextPart_000_0002_01BFE029.B24D6200
Content-Type: application/octet-stream;
	name="zpty.diff"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename="zpty.diff"

--- Src/Modules/zpty.c.org	Wed May 17 07:42:44 2000=0A=
+++ Src/Modules/zpty.c	Fri Jun 23 17:38:08 2000=0A=
@@ -155,9 +155,11 @@=0A=
 /**** maybe we should use configure here */=0A=
 /**** and we certainly need more/better #if tests */=0A=
 =0A=
-#if defined(__SVR4) || defined(sinix)=0A=
+#if defined(__SVR4) || defined(sinix) || defined(__CYGWIN__)=0A=
 =0A=
+#if !defined(__CYGWIN__)=0A=
 #include <sys/stropts.h>=0A=
+#endif=0A=
 =0A=
 static int=0A=
 get_pty(int master, int *retfd)=0A=
@@ -183,6 +185,7 @@=0A=
 	close(mfd);=0A=
 	return 1;=0A=
     }=0A=
+#if !defined(__CYGWIN__)=0A=
     if ((ret =3D ioctl(sfd, I_FIND, "ptem")) !=3D 1)=0A=
        if (ret =3D=3D -1 || ioctl(sfd, I_PUSH, "ptem") =3D=3D -1) {=0A=
 	   close(mfd);=0A=
@@ -201,13 +204,14 @@=0A=
 	   close(sfd);=0A=
 	   return 1;=0A=
        }=0A=
+#endif /* !defined(__CYGWIN__) */=0A=
 =0A=
     *retfd =3D sfd;=0A=
 =0A=
     return 0;=0A=
 }=0A=
 =0A=
-#else /* ! (defined(__SVR4) || defined(sinix)) */=0A=
+#else /* ! (defined(__SVR4) || defined(sinix) || defined(__CYGWIN__)) */=0A=
 =0A=
 static int=0A=
 get_pty(int master, int *retfd)=0A=

------=_NextPart_000_0002_01BFE029.B24D6200--

