From zsh-users-return-13613-mason-zsh=primenet.com.au@sunsite.dk Fri Dec 26 00:01:17 2008
Return-Path: <zsh-users-return-13613-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1070 invoked from network); 26 Dec 2008 00:01:04 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 26 Dec 2008 00:01:04 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 40920 invoked from network); 26 Dec 2008 00:00:48 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 26 Dec 2008 00:00:48 -0000
Received: (qmail 23769 invoked by alias); 26 Dec 2008 00:00:27 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13613
Received: (qmail 23752 invoked from network); 26 Dec 2008 00:00:25 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 26 Dec 2008 00:00:25 -0000
Received: from randymail-a8.g.dreamhost.com (sd-green-bigip-74.dreamhost.com [208.97.132.74])
	by bifrost.dotsrc.org (Postfix) with ESMTP id AB06880525C7
	for <zsh-users@sunsite.dk>; Fri, 26 Dec 2008 01:00:22 +0100 (CET)
Received: from blorf.net (dsl-74-220-65-6.cruzio.com [74.220.65.6])
	by randymail-a8.g.dreamhost.com (Postfix) with ESMTP id E151EAEA0F;
	Thu, 25 Dec 2008 16:00:19 -0800 (PST)
Date: Thu, 25 Dec 2008 16:00:17 -0800
From: Wayne Davison <wayned@users.sourceforge.net>
To: Sebastian Stark <seb-zsh@biskalar.de>
Cc: zsh-users@sunsite.dk
Subject: Re: precommand modifiers and alias sudo="sudo "
Message-ID: <20081226000017.GB877@blorf.net>
References: <5FE916F5-AC66-4D8C-B86F-BB7A5A41F245@biskalar.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <5FE916F5-AC66-4D8C-B86F-BB7A5A41F245@biskalar.de>
User-Agent: Mutt/1.5.15+20070412 (2007-04-11)
X-Virus-Scanned: ClamAV 0.92.1/8800/Thu Dec 25 17:08:10 2008 on bifrost
X-Virus-Status: Clean

On Wed, Dec 10, 2008 at 01:08:15PM +0100, Sebastian Stark wrote:
> I have set up an alias sudo="sudo " that enables use of aliases with sudo.
> But now precommand modifiers like "nocorrect" or "env"* stopped working.

I have a function that allows me to use aliases with sudo.  It handles
things like noglob and command, but just ignores nocorrect.  I don't use
env, so that's not currently handled.

alias sudo='noglob do_sudo '
function do_sudo
{
    integer glob=1
    local -a run
    run=( command sudo )
    if [[ $# -gt 1 && $1 = -u ]]; then
        run+=($1 $2)
        shift ; shift
    fi
    (($# == 0)) && 1=/bin/zsh
    while (($#)); do
        case "$1" in
        command|exec|-) shift; break ;;
        nocorrect) shift ;;
        noglob) glob=0; shift ;;
        *) break ;;
        esac
    done
    if ((glob)); then
        PATH="/sbin:/usr/sbin:/usr/local/sbin:$PATH" $run $~==*
    else
        PATH="/sbin:/usr/sbin:/usr/local/sbin:$PATH" $run $==*
    fi
}

..wayne..

