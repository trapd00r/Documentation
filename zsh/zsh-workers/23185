From zsh-workers-return-23185-mason-zsh=primenet.com.au@sunsite.dk Sun Feb 25 04:46:57 2007
Return-Path: <zsh-workers-return-23185-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17103 invoked from network); 25 Feb 2007 04:46:52 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.8 (2007-02-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO
	autolearn=ham version=3.1.8
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 Feb 2007 04:46:52 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 22224 invoked from network); 24 Feb 2007 12:46:46 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 24 Feb 2007 12:46:46 -0000
Received: (qmail 464 invoked by alias); 24 Feb 2007 12:46:43 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23185
Received: (qmail 454 invoked from network); 24 Feb 2007 12:46:42 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 24 Feb 2007 12:46:42 -0000
Received: (qmail 21935 invoked from network); 24 Feb 2007 12:46:42 -0000
Received: from zoidberg.org (HELO cthulhu.zoidberg.org) (213.133.99.5)
  by a.mx.sunsite.dk with SMTP; 24 Feb 2007 12:46:36 -0000
Received: from localhost (xdsl-87-78-64-184.netcologne.de [::ffff:87.78.64.184])
  (IDENT: tobias, AUTH: PLAIN tobias, TLS: TLSv1/SSLv3,128bits,AES128-SHA)
  by cthulhu.zoidberg.org with esmtp; Sat, 24 Feb 2007 13:46:35 +0100
  id 01837818.45E033AB.000079A2
Date: Sat, 24 Feb 2007 13:46:34 +0100
From: Tobias Gruetzmacher <tobias@portfolio16.de>
To: zsh-workers@sunsite.dk
Subject: Re: PATCH: _qemu
Message-ID: <20070224124633.GA6157@portfolio16.de>
Mail-Followup-To: zsh-workers@sunsite.dk
References: <20070224020427.GA3466@scowler.net>
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature"; boundary="=_cthulhu.zoidberg.org-31138-1172321196-0001-2"
Content-Disposition: inline
In-Reply-To: <20070224020427.GA3466@scowler.net>
User-Agent: Mutt/1.5.13 (2006-08-11)

This is a MIME-formatted message.  If you see this text it means that your
E-mail software does not support MIME-formatted messages.

--=_cthulhu.zoidberg.org-31138-1172321196-0001-2
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

Hi,

On Fri, Feb 23, 2007 at 09:04:27PM -0500, Clint Adams wrote:
> -soundhw, -net, -serial, -parallel, -monitor, and probably others
> could use some work.

I had an old completion for qemu that I wrote at some time... Here is a
patch adding the useful bits from my file:

Index: Completion/Unix/Command/_qemu
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_qemu,v
retrieving revision 1.1
diff -u -r1.1 _qemu
--- Completion/Unix/Command/_qemu       24 Feb 2007 02:06:26 -0000      1.1
+++ Completion/Unix/Command/_qemu       24 Feb 2007 12:39:46 -0000
@@ -1,5 +1,14 @@
 #compdef qemu

+_qemu_log_items () {
+  local -a opts hline
+  qemu -d \? | while read -A hline; do
+    [[ $hline[1] =3D Log ]] && continue
+    opts=3D($opts "${hline[1]}[${hline[2,-1]}]")
+  done
+  _values -s , 'log items' $opts
+}
+
 local _qemu_machines

 _qemu_machines=3D(${${${(f)"$(qemu -M \?)"}[2,-1]}%% *})
@@ -7,11 +16,11 @@
 _arguments \
   '-'{fda,fdb,hda,hdb,hdc,hdd,cdrom}':disk image:_files' \
   '-M[target machine]:machine:('"${_qemu_machines:-none}"')' \
-  '-boot:boot device:(a c d)' \
+  '-boot[specify which image to boot from]:boot device:((a\:floppy\ image\=
 a c\:hard\ disk d\:cdrom))' \
   '-snapshot[write to temporary files instead of disk image files]' \
   '-no-fd-bootchk[disable boot sig checking for floppies in Bochs BIOS]' \
-  '-m[virtual RAM size]:megs:' \
-  '-m[simulate SMP system]:number of CPUs:' \
+  '-m[virtual RAM size (default=3D128)]:megs:' \
+  '-smp[set the number of CPUs (default=3D1)]:number of CPUs:' \
   '-nographic[disable graphical output]' \
   '-vnc[listen on VNC display]:display:' \
   '-k[use keyboard layout]:keyboard layout language:(ar de-ch es fo fr-ca =
hu ja mk no pt-br sv da en-gb et fr fr-ch is lt nl pl ru th de en-us fi fr-=
be hr it lv nl-be pt sl tr)' \
@@ -24,20 +33,20 @@
   '-usb[enable USB driver]' \
   '-usbdevice:usb device:' \
   '-net:net config:(none)' \
-  '-tftp:prefix:' \
-  '-smb:dir:_files -/' \
-  '-redir:port redir config:' \
-  '-kernel:kernel image:_files' \
-  '-append:kernel cmd line:' \
-  '-initrd:initrd:_files' \
+  '-tftp[allow tftp access to files starting with prefix]:tftp prefix:_fil=
es' \
+  '-smb[allow SMB access to files in specified directory]:samba directory:=
_path_files -/' \
+  '-redir[redirect TCP or UDP connections from host to guest]:redirection:=
 ' \
+  '-kernel[boot specified linux kernel]:kernel image:_files' \
+  '-append[use specified kernel command line]:command line: ' \
+  '-initrd[use specified initial ram disk]:ram disk:_files' \
   '-serial:dev:(vc stdio pty null /dev/ttyS0 /dev/partport0)' \
   '-parallel:dev:(vc stdio pty null /dev/ttyS0 /dev/partport0)' \
   '-monitor:dev:(vc stdio pty null /dev/ttyS0 /dev/partport0)' \
   '-s[wait gdb connection to port 1234]' \
   '-p[change gdb connection port]:port:_ports' \
   '-S[do not start CPU at startup]' \
-  '-d[output log in /tmp/qemu.log]' \
-  '-hdachs:hd0 geometry:' \
+  '-d[output log in /tmp/qemu.log]:log items:_qemu_log_items' \
+  '-hdachs[force hard disk 0 geometry (usually qemu can guess it)]:hd0 geo=
metry c,h,s:' \
   '-std-vga[simulate standard VGA]' \
   '-no-acpi[disable ACPI]' \
   '-loadvm[start right away with a saved state]:file:_files' \

Greetings, Tobi

--=20
GPG-Key 0xE2BEA341 - signed/encrypted mail preferred
My, oh so small, homepage: http://portfolio16.de/
http://www.fli4l.de/ - ISDN- & DSL-Router on one disk!
Registered FLI4L-User #00000003

--=_cthulhu.zoidberg.org-31138-1172321196-0001-2
Content-Type: application/pgp-signature; name="signature.asc"
Content-Transfer-Encoding: 7bit
Content-Description: Digital signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFF4DOpGf7YPOK+o0ERAuOlAKDt+c9G1Of0quGarvpoBOtloTCA/ACgkRoh
P0TznI/pNEFVJAl44qPuy+4=
=LeQk
-----END PGP SIGNATURE-----

--=_cthulhu.zoidberg.org-31138-1172321196-0001-2--

