From zsh-users-return-7914-mason-zsh=primenet.com.au@sunsite.dk Mon Aug 23 21:49:56 2004
Return-Path: <zsh-users-return-7914-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18526 invoked from network); 23 Aug 2004 21:49:56 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 Aug 2004 21:49:56 -0000
Received: (qmail 70195 invoked from network); 23 Aug 2004 21:49:48 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 Aug 2004 21:49:48 -0000
Received: (qmail 15104 invoked by alias); 23 Aug 2004 21:49:03 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 7914
Received: (qmail 15094 invoked from network); 23 Aug 2004 21:49:02 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by 130.225.247.90 with SMTP; 23 Aug 2004 21:49:02 -0000
Received: (qmail 68919 invoked from network); 23 Aug 2004 21:47:18 -0000
Received: from unknown (HELO moonbase.zanshin.com) (167.160.213.139)
  by a.mx.sunsite.dk with SMTP; 23 Aug 2004 21:47:17 -0000
Received: from toltec.zanshin.com (toltec.zanshin.com [64.84.47.166])
	by moonbase.zanshin.com (8.12.11/8.12.11) with ESMTP id i7NLlAW3017051
	for <zsh-users@sunsite.dk>; Mon, 23 Aug 2004 14:47:10 -0700
Date: Mon, 23 Aug 2004 14:47:10 -0700 (PDT)
From: Bart Schaefer <schaefer@brasslantern.com>
Reply-To: zsh-users@sunsite.dk
To: zsh-users@sunsite.dk
Subject: Re: Using zle outside zsh
In-Reply-To: <20040823194613.GA25072@DervishD>
Message-ID: <Pine.LNX.4.61.0408231436340.3917@toltec.zanshin.com>
References: <20040823155951.GA24279@DervishD> <Pine.LNX.4.61.0408231018430.5997@toltec.zanshin.com>
 <20040823194613.GA25072@DervishD>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-1.4 required=6.0 tests=BAYES_20 autolearn=no 
	version=2.63
X-Spam-Hits: -1.4

On Mon, 23 Aug 2004, DervishD wrote:

>     The problem here is that if the command prints its own prompt, a
> code like this:
[...]
> zpty -r telnet response 'telnet>'
> print -nr $response
[...]
>     doesn't work, because the prompt doesn't have a carriage return.

That's not why it doesn't work.  Read the doc for "zpty -r" again:

     If a PATTERN is given as well, output is read until the whole
     string read matches the PATTERN, even in the non-blocking case.

Note "the whole string".  This is why nslookup always has a "*" as the
first thing in the pattern when it calls "zpty -r".  So ...

  zpty -r telnet response $'(|*\n)telnet>'

... is probably more along the lines of what you want.

>     But the worst problem is in the inner loop. I want zpty to read
> all that 'telnet' spits until it finds 'telnet>', but blocks forever.

Same problem, I think.

