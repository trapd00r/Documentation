From zsh-workers-return-20399-mason-zsh=primenet.com.au@sunsite.dk Wed Sep 22 15:06:02 2004
Return-Path: <zsh-workers-return-20399-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28659 invoked from network); 22 Sep 2004 15:06:01 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 22 Sep 2004 15:06:01 -0000
Received: (qmail 9956 invoked from network); 22 Sep 2004 15:05:55 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 22 Sep 2004 15:05:55 -0000
Received: (qmail 6261 invoked by alias); 22 Sep 2004 15:05:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20399
Received: (qmail 4745 invoked from network); 22 Sep 2004 15:04:07 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 22 Sep 2004 15:04:07 -0000
Received: (qmail 7799 invoked from network); 22 Sep 2004 15:04:07 -0000
Received: from farley.org (HELO mail.farley.org) (67.64.95.201)
  by a.mx.sunsite.dk with SMTP; 22 Sep 2004 15:04:06 -0000
Received: from thor.farley.org (h2teiryqod4dbwa5@thor.farley.org [IPv6:2002:4340:5fcd:1::5])
	by mail.farley.org (8.12.11/8.12.11) with ESMTP id i8MF43gR036156
	for <zsh-workers@sunsite.dk>; Wed, 22 Sep 2004 10:04:03 -0500 (CDT)
	(envelope-from sean@farley.org)
Received: from thor.farley.org (localhost [127.0.0.1])
	by thor.farley.org (8.13.1/8.13.1) with ESMTP id i8MF43w3060835
	for <zsh-workers@sunsite.dk>; Wed, 22 Sep 2004 10:04:03 -0500 (CDT)
	(envelope-from sean@farley.org)
Received: from localhost (sean@localhost)
	by thor.farley.org (8.13.1/8.13.1/Submit) with ESMTP id i8MF43kI060832
	for <zsh-workers@sunsite.dk>; Wed, 22 Sep 2004 10:04:03 -0500 (CDT)
	(envelope-from sean@farley.org)
X-Authentication-Warning: thor.farley.org: sean owned process doing -bs
Date: Wed, 22 Sep 2004 10:04:03 -0500 (CDT)
From: "Sean C. Farley" <sean@farley.org>
To: zsh-workers@sunsite.dk
Subject: PATCH: zsh-4.2.1: unset does not follow spec
Message-ID: <20040922091323.V45751@thor.farley.org>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="0-51444878-1095865411=:60126"
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--0-51444878-1095865411=:60126
Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed

Recently, I read that FreeBSD's /bin/sh fails:
http://www.freebsd.org/cgi/query-pr.cgi?pr=standards/45738
the IEEE Std 1003.1-2001:
http://www.opengroup.org/onlinepubs/007904975/utilities/unset.html
when it comes to the builtin unset.  tcsh and bash do follow it.

I then checked zsh.  It also fails this specification (if it desired to
follow it for unset?).  I have attached a patch that returns zero for
unset.  It also affects unhash for functions to handle unset -f.

Sean

P.S. I am not on the list; please cc.

P.P.S.  http://www.zsh.org/mla/patches.shtml has not been updated past
March 2004.
---------------
sean@farley.org
--0-51444878-1095865411=:60126
Content-Type: TEXT/PLAIN; charset=US-ASCII; name="zsh.patch"
Content-Transfer-Encoding: BASE64
Content-ID: <20040922100331.K60126@thor.farley.org>
Content-Description: 
Content-Disposition: attachment; filename="zsh.patch"

LS0tIFNyYy9idWlsdGluLmMub3JpZwlGcmkgQXVnIDEzIDA1OjIyOjQyIDIw
MDQNCisrKyBTcmMvYnVpbHRpbi5jCVdlZCBTZXAgMjIgMDk6NDQ6MDQgMjAw
NA0KQEAgLTI2MzgsOSArMjYzOCw5IEBADQogCQlyZXR1cm52YWwgPSAxOw0K
IAkgICAgfQ0KIAl9DQotCS8qIElmIHdlIGRpZG4ndCBtYXRjaCBhbnl0aGlu
Zywgd2UgcmV0dXJuIDEuICovDQorCS8qIElmIHdlIGRpZG4ndCBtYXRjaCBh
bnl0aGluZywgd2UgcmV0dXJuIDAuICovDQogCWlmICghbWF0Y2gpDQotCSAg
ICByZXR1cm52YWwgPSAxOw0KKwkgICAgcmV0dXJudmFsID0gMDsNCiAJcmV0
dXJuIHJldHVybnZhbDsNCiAgICAgfQ0KIA0KQEAgLTI2NjEsNyArMjY2MSw3
IEBADQogCQkgICAgICBnZXRoYXNobm9kZTIocGFyYW10YWIsIHMpIDoNCiAJ
CSAgICAgIHBhcmFtdGFiLT5nZXRub2RlKHBhcmFtdGFiLCBzKSk7DQogCWlm
ICghcG0pDQotCSAgICByZXR1cm52YWwgPSAxOw0KKwkgICAgcmV0dXJudmFs
ID0gMDsNCiAJZWxzZSBpZiAoKHBtLT5mbGFncyAmIFBNX1JFU1RSSUNURUQp
ICYmIGlzc2V0KFJFU1RSSUNURUQpKSB7DQogCSAgICB6ZXJybmFtKG5hbWUs
ICIlczogcmVzdHJpY3RlZCIsIHBtLT5uYW0sIDApOw0KIAkgICAgcmV0dXJu
dmFsID0gMTsNCkBAIC0zMDU2LDkgKzMwNTYsMTcgQEANCiAJCXJldHVybnZh
bCA9IDE7DQogCSAgICB9DQogCX0NCi0JLyogSWYgd2UgZGlkbid0IG1hdGNo
IGFueXRoaW5nLCB3ZSByZXR1cm4gMS4gKi8NCi0JaWYgKCFtYXRjaCkNCi0J
ICAgIHJldHVybnZhbCA9IDE7DQorCS8qDQorCSAqIElmIHdlIGRpZG4ndCBt
YXRjaCBhbnl0aGluZywgd2UgcmV0dXJuIDAgZm9yIGZ1bmN0aW9ucyBhbmQg
MSBmb3INCisJICogYWxsIG90aGVyIGhhc2ggdHlwZXMuDQorCSAqLw0KKwlp
ZiAoIW1hdGNoKSB7DQorCSAgICBpZiAoT1BUX0lTU0VUKG9wcywnZicpKSB7
DQorCQlyZXR1cm52YWwgPSAwOw0KKwkgICAgfSBlbHNlIHsNCisJCXJldHVy
bnZhbCA9IDE7DQorCSAgICB9DQorCX0NCiAJcmV0dXJuIHJldHVybnZhbDsN
CiAgICAgfQ0KIA0KQEAgLTMwNjksNyArMzA3NywxMSBAQA0KIAkgICAgaHQt
PmZyZWVub2RlKGhuKTsNCiAJfSBlbHNlIHsNCiAJICAgIHp3YXJubmFtKG5h
bWUsICJubyBzdWNoIGhhc2ggdGFibGUgZWxlbWVudDogJXMiLCAqYXJndiwg
MCk7DQotCSAgICByZXR1cm52YWwgPSAxOw0KKwkgICAgaWYgKE9QVF9JU1NF
VChvcHMsJ2YnKSkgew0KKwkJcmV0dXJudmFsID0gMDsNCisJICAgIH0gZWxz
ZSB7DQorCQlyZXR1cm52YWwgPSAxOw0KKwkgICAgfQ0KIAl9DQogICAgIH0N
CiAgICAgdW5xdWV1ZV9zaWduYWxzKCk7DQo=

--0-51444878-1095865411=:60126--

