From zsh-workers-return-21840-mason-zsh=primenet.com.au@sunsite.dk Tue Oct 04 19:24:45 2005
Return-Path: <zsh-workers-return-21840-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3111 invoked from network); 4 Oct 2005 19:24:42 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 4 Oct 2005 19:24:42 -0000
Received: (qmail 56681 invoked from network); 4 Oct 2005 19:24:35 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Oct 2005 19:24:35 -0000
Received: (qmail 4291 invoked by alias); 4 Oct 2005 19:24:32 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21840
Received: (qmail 4280 invoked from network); 4 Oct 2005 19:24:32 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 4 Oct 2005 19:24:32 -0000
Received: (qmail 56463 invoked from network); 4 Oct 2005 19:24:31 -0000
Received: from flock1.newmail.ru (212.48.140.157)
  by a.mx.sunsite.dk with SMTP; 4 Oct 2005 19:24:30 -0000
Received: (qmail 6262 invoked from network); 4 Oct 2005 19:12:36 -0000
Received: from unknown (HELO cooker.home.net) (arvidjaar@newmail.ru@83.237.61.21)
  by smtpd.newmail.ru with SMTP; 4 Oct 2005 19:12:36 -0000
From: Andrey Borzenkov <arvidjaar@newmail.ru>
To: Bart Schaefer <schaefer@brasslantern.com>,
 Zsh Workers <zsh-workers@sunsite.dk>
Subject: Re: Bug? in complist when filenames are longer than the screen
Date: Tue, 4 Oct 2005 23:24:22 +0400
User-Agent: KMail/1.8.2
References: <20051003144536.GA3179@DervishD> <1051004161114.ZM32268@candle.brasslantern.com> <20051004171351.GB20791@DervishD>
In-Reply-To: <20051004171351.GB20791@DervishD>
MIME-Version: 1.0
Content-Type: multipart/signed;
  boundary="nextPart1169941.FlTtzahZuY";
  protocol="application/pgp-signature";
  micalg=pgp-sha1
Content-Transfer-Encoding: 7bit
Message-Id: <200510042324.26840.arvidjaar@newmail.ru>
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.4

--nextPart1169941.FlTtzahZuY
Content-Type: text/plain;
  charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline

On Tuesday 04 October 2005 21:13, DervishD wrote:
[...]

We seem to have two bugs here.

>
>     I'm going to make another test, using a clean environment. OK,
> here are the results with the UNPATCHED version of zsh: if I use very
> long names (much longer than COLUMNS), the bug doesn't happen!. It
> only happens with a list of files in one directory :??? Mmm,
> interesting, it looks like a corner case: the bug only happens when
> in the file listing is there a file whose name length is *exactly*
> $COLUMNS. Longer or shorter files doesn't cause the bug to happen.

Yes, this was claimed to have been fixed at least twice. It has something t=
o=20
do with terminals (not) going to next line when getting NL in the last=20
position.


>
>     I've found the bug to be repeatable with this sequence (try this
> in a clean zsh environment, no /etc/zshenv, no any other rcfile, and
> it must be a login shell, just to make sure):
>
>     $ rm -rf test
>     $ mkdir test ; cd test
>     $ PS1=3D
>     $ touch ${(l:$COLUMNS::a:):-} a b c
>     $ zmodload zsh/complist
>     $ MENUSELECT=3D0
>
>     It's very important to create the other three files (a, b and c)
> in the directory (otherwise you won't get a list ;)).
>
>     This causes a crash, always, without looping, even with your
> patches.
>

Does it happen only in current CVS or in older versions too?

#0  0xffffe410 in __kernel_vsyscall ()
#1  0xb7d52ef1 in raise () from /lib/tls/libc.so.6
#2  0xb7d5483b in abort () from /lib/tls/libc.so.6
#3  0xb7d88ff5 in __fsetlocking () from /lib/tls/libc.so.6
#4  0xb7d8f587 in malloc_usable_size () from /lib/tls/libc.so.6
#5  0xb7d8fa02 in free () from /lib/tls/libc.so.6
#6  0xb7bdc272 in unmetafy_line ()
    at /home/bor/src/zsh/Src/Zle/zle_tricky.c:964
#7  0xb7bd4958 in zrefresh () at /home/bor/src/zsh/Src/Zle/zle_refresh.c:366
#8  0xb7bd69c2 in zrefresh () at /home/bor/src/zsh/Src/Zle/zle_refresh.c:769
#9  0xb7b81267 in domenuselect (dummy=3D0xb7bb8a74, dat=3D0xbfe015e0)
    at /home/bor/src/zsh/Src/Zle/complist.c:2230
#10 0x08096c37 in runhookdef (h=3D0xb7bb8a74, d=3D0xbfe015e0)
    at /home/bor/src/zsh/Src/module.c:1883
#11 0xb7ba0b52 in after_complete (dummy=3D0xb7bef39c, dat=3D0xbfe0166c)
    at /home/bor/src/zsh/Src/Zle/compcore.c:513
#12 0x08096c9c in runhookdef (h=3D0xb7bef39c, d=3D0xbfe0166c)
    at /home/bor/src/zsh/Src/module.c:1889
#13 0xb7bdbd71 in docomplete (lst=3D0)
    at /home/bor/src/zsh/Src/Zle/zle_tricky.c:851
#14 0xb7bda7b5 in expandorcomplete (args=3D0xb7bef5dc)
    at /home/bor/src/zsh/Src/Zle/zle_tricky.c:315
#15 0xb7bcd0e2 in execzlefunc (func=3D0xb7bed748, args=3D0xb7bef5dc)
    at /home/bor/src/zsh/Src/Zle/zle_main.c:1094
#16 0xb7bcc602 in zlecore () at /home/bor/src/zsh/Src/Zle/zle_main.c:862
#17 0xb7bcccf2 in zleread (lp=3D0x80e7940, rp=3D0x0, flags=3D3, context=3D0)
    at /home/bor/src/zsh/Src/Zle/zle_main.c:1016
#18 0x08081527 in inputline () at /home/bor/src/zsh/Src/input.c:278
#19 0x080813dc in ingetc () at /home/bor/src/zsh/Src/input.c:214
#20 0x0807810f in ihgetc () at /home/bor/src/zsh/Src/hist.c:240
#21 0x08088b98 in gettok () at /home/bor/src/zsh/Src/lex.c:628
#22 0x080883d0 in yylex () at /home/bor/src/zsh/Src/lex.c:344
#23 0x080a1d8d in parse_event () at /home/bor/src/zsh/Src/parse.c:451
#24 0x0807e31e in loop (toplevel=3D1, justonce=3D0)
    at /home/bor/src/zsh/Src/init.c:128
#25 0x0808101e in zsh_main (argc=3D2, argv=3D0xbfe01bf4)
    at /home/bor/src/zsh/Src/init.c:1312
#26 0x08052972 in main (argc=3D2, argv=3D0xbfe01bf4)
    at /home/bor/src/zsh/Src/main.c:93

--nextPart1169941.FlTtzahZuY
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.2 (GNU/Linux)

iD8DBQBDQtbqR6LMutpd94wRAms7AJwItpbVlUmk44RhgDN0plkSd88LZQCgoIOj
7KICGfZa/zsPSKjSOyrsSjc=
=u928
-----END PGP SIGNATURE-----

--nextPart1169941.FlTtzahZuY--

