From zsh-workers-return-19715-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 31 17:56:11 2004
Return-Path: <zsh-workers-return-19715-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24213 invoked from network); 31 Mar 2004 17:56:10 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 31 Mar 2004 17:56:10 -0000
Received: (qmail 6 invoked by alias); 31 Mar 2004 17:55:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19715
Received: (qmail 29934 invoked from network); 31 Mar 2004 17:55:59 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 31 Mar 2004 17:55:59 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [130.225.247.86] by sunsite.dk (MessageWall 1.0.8) with SMTP; 31 Mar 2004 17:55:58 -0000
Received: (qmail 5585 invoked from network); 31 Mar 2004 17:55:58 -0000
Received: from ip-66-80-62-153.dsl.sca.megapath.net (HELO ripple.fruitbat.org) (66.80.62.153)
  by a.mx.sunsite.dk with SMTP; 31 Mar 2004 17:55:56 -0000
Received: (from daemon@localhost)
	by ripple.fruitbat.org (8.10.2/8.8.8/PAC-1.3) id i2VHrrA28310;
	Wed, 31 Mar 2004 09:53:53 -0800
Received: from ming.fruitbat.org(192.168.1.2) by ripple.fruitbat.org via smap (V2.1/2.1+anti-relay+anti-spam)
	id xma028305; Wed, 31 Mar 04 09:53:17 -0800
Received: from gremlin.fruitbat.org (IDENT:202@gremlin.fruitbat.org [192.168.1.4])
	by ming.fruitbat.org (8.10.2/8.10.2/PAC-1.6) with ESMTP id i2VIrHi16364;
	Wed, 31 Mar 2004 10:53:17 -0800
Date: Wed, 31 Mar 2004 09:53:22 -0800 (PST)
From: "Peter A. Castro" <doctor@fruitbat.org>
To: Oliver Kiddle <okiddle@yahoo.co.uk>
cc: zzapper <david@tvis.co.uk>, zsh-workers@sunsite.dk, cygwin@cygwin.com
Subject: Re: zsh and line breaks
In-Reply-To: <2603.1080737128@trentino.logica.co.uk>
Message-ID: <Pine.LNX.4.53.0403310935450.9892@gremlin.fruitbat.org>
References: <s38u10erwrz.fsf@ackusativ.ling.uu.se> <1vvf60l9i7n4nlobcroik2le5ofe6v2rn4@4ax.com>
 <Pine.LNX.4.53.0403291441160.5939@gremlin.fruitbat.org>
 <3372.1080639122@trentino.logica.co.uk> <Pine.LNX.4.53.0403301047250.5939@gremlin.fruitbat.org>
 <2603.1080737128@trentino.logica.co.uk>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

On Wed, 31 Mar 2004, Oliver Kiddle wrote:

> "Peter A. Castro" wrote:
> > > Are those corrections likely to be limited to the Cygwin package for
> > > zsh?
> >
> > Yes.  Currently, my changes are Cygwin specific and really don't apply to
> > the other platforms.
>
> It is easy for us to add `#ifdef __CYGWIN__' around changes or #define
> O_TEXT to zero on other systems so if you do correct the problem,
> please send the changes back to us.

There are about 43 open() calls which I've updated with the O_TEXT
option.  Having all those ifdef's seemed rather ugly (makes the code hard
to look at, expectially when they are within a few lines of each other)
so I took a more "elegent" approach, though you may want to revise it if
it doesn't meet your style requirements :)

> > I'm aware of O_TEXT and I thought I'd changed all of the places where
> > files are opened already, but I just checked my patches and those changes
> > are gone!  AARRGGHH!!  Ok, I'll re-edit and get that back in.  Going
> > through stdin or via piped fds may be an issue still.  Anyway, thanks for
> > the thought!
>
> It seems there is a setmode() function declared in io.h which will
> allow the mode to be changed on any already open file descriptors.

Yep, I'm experimenting with this right now.  As it stands, tests which
print out to a file and then cat it back in (currently A04redirect and
E01options) produce a diff, but don't otherwise seem to have any
problems.

> Oliver

-- 
Peter A. Castro <doctor@fruitbat.org> or <Peter.Castro@oracle.com>
	"Cats are just autistic Dogs" -- Dr. Tony Attwood

