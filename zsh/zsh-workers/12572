From zsh-workers-return-12572-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Aug 08 20:42:20 2000
Return-Path: <zsh-workers-return-12572-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5281 invoked from network); 8 Aug 2000 20:42:19 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 8 Aug 2000 20:42:19 -0000
Received: (qmail 364 invoked by alias); 8 Aug 2000 20:42:02 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12572
Received: (qmail 355 invoked from network); 8 Aug 2000 20:42:00 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <000808134152.ZM7046@candle.brasslantern.com>
Date: Tue, 8 Aug 2000 13:41:52 -0700
In-Reply-To: <20000808172553.A26023@thelonious.new.ox.ac.uk>
Comments: In reply to Adam Spiers <adam@spiers.net>
        "feature request: special completion of glob patterns" (Aug  8,  5:25pm)
References: <20000808172553.A26023@thelonious.new.ox.ac.uk>
X-Mailer: Z-Mail Lite (5.0.0 30July97)
To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Subject: Re: feature request: special completion of glob patterns
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Aug 8,  5:25pm, Adam Spiers wrote:
> 
> Ideally, I would like the following completion behaviour (assuming
> baz.txt is the only file in foo1/bar):
> 
>   $ diff -u foo[12]/bar/b<TAB>
>   $ diff -u foo[12]/bar/baz.txt

This is very similar to the keep-prefix style, and I believe there was
some discussion in that thread of handling something like this.  You may
even be able to figure out a way to do it by looking for keep-prefix in
the _expand completer.

Trying out a couple of things has led me to find the following oddities:

zsh% x='foo[12]'
zsh% diff -u ${~x}/b<TAB>
zsh% diff -u ${~x}/foo/bar
                      ^
                      cursor here

It's behaving as if $~x expanded to ".".  This is with the _expand completer
and the keep-prefix style set to true.

The other is that the _expand completer seems to trigger menu-completion
even when I have explicitly turned it off.  I removed all references to
"menu" or "select" from my styles, I'm using the complete-word widget, and
I have automenu turned off, yet after `zsh/S*<TAB>' I still end up with a
menu completion cycling through zsh/Src, zsh/StartupFiles, and zsh/S*
(because I have the original style set).  I expected it just to list the
completions and feep.

I realize, looking back through the history of _expand, that it has always
been this way, and I simply never noticed because I usually have automenu
set.  Nevertheless it seems to me that there ought to be some way to turn
it off.

