From zsh-workers-return-28245-mason-zsh=primenet.com.au@zsh.org Thu Sep 09 14:56:54 2010
Return-Path: <zsh-workers-return-28245-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12196 invoked by alias); 9 Sep 2010 14:56:54 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28245
Received: (qmail 18153 invoked from network); 9 Sep 2010 14:56:52 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at plenz.com does not designate permitted sender hosts)
Date: Thu, 9 Sep 2010 16:50:15 +0200
From: Julius Plenz <julius@plenz.com>
To: zsh-workers@zsh.org
Subject: Issue with insert-sections style
Message-ID: <20100909145014.GL2506@plenz.com>
Mail-Followup-To: zsh-workers@zsh.org
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
X-Editor: vim 7.1
User-Agent: Mutt/1.5.18 (2008-05-17)

Hi there,

I discovered an issue with the insert-sections style for manual
pages (which, by the way, is not documented anywhere).

If you use the _oldlist completer together with the no_list_ambiguous
option the following bug occurs: When you have entered a man page name
with a prefix that can only be expanded to man pages from one section,
that section number gets inserted when drawing the listing, and then
*again* when the user enters menu completion.

Provided below is a minimal zshrc to reproduce the bug. An example
which will work on most systems might be "man pam_li<Tab><Tab>":

  # minimal setup
  autoload -U compinit && compinit
  zmodload -i zsh/complist
  bindkey '^i' complete-word
  zstyle ':completion:*' menu select # if you like
  zstyle ':completion:*' group-name ''
  zstyle ':completion:*:descriptions' format 'completing %B%d%b'
  zstyle ':completion:*:manuals' separate-sections true

  # make insertion possible
  setopt extendedglob
  zstyle ':completion:*:manuals.(^1*)' insert-sections true

  # cause double-insertion
  zstyle ':completion:*' completer _oldlist _complete
  setopt nolistambiguous

Cheers,
Julius

