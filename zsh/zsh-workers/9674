From zsh-workers-return-9674-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Feb 10 21:24:41 2000
Return-Path: <zsh-workers-return-9674-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2997 invoked from network); 10 Feb 2000 21:24:40 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 10 Feb 2000 21:24:40 -0000
Received: (qmail 15766 invoked by alias); 10 Feb 2000 21:24:32 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9674
Received: (qmail 15757 invoked from network); 10 Feb 2000 21:24:31 -0000
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: 10prompt.ztst
MIME-Version: 1.0 (generated by AKEMI 1.13.2 - =?ISO-2022-JP?B?Ig==?=
 =?ISO-2022-JP?B?GyRCQTA0Y0s8GyhCIg==?=)
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@jaist.ac.jp>
Date: 11 Feb 2000 06:24:26 +0900
Message-ID: <rsqpuu4oinp.fsf@crane.jaist.ac.jp>
Lines: 74
User-Agent: Chao-gnus/6.12.5 AKEMI/1.13.2 (=?ISO-2022-JP?B?GyRCQTAbKEI=?=
 =?ISO-2022-JP?B?GyRCNGNLPBsoQg==?=) FLAM-DOODLE/1.12.6
 (=?ISO-2022-JP?B?GyRCM3cbKEI=?= 10R4.0/5.0) Emacs/20.4
 (sparc-sun-solaris2.6) MULE/4.0 (HANANOEN)

`make check' was failed since Feb 10.  This problem was not appeared
before, because $date3[8,9] was arithmetically correct even though its
upper digit was forgotten.

| Z:akr@crane% make check
| cd Test ; gmake check
| gmake[1]: Entering directory `/ldl3/akr/zsh/tst/work/zsh-workers_9518/zsh/Test'
| for f in ./*.ztst; do \
|   ../Src/zsh -f ./ztst.zsh $f; \
| done
| ./01grammar.ztst: all tests successful.
| ./02alias.ztst: all tests successful.
| ./03quoting.ztst: all tests successful.
| ./04redirect.ztst: all tests successful.
| ./05command.ztst: all tests successful.
| ./06arith.ztst: all tests successful.
| ./07cond.ztst: all tests successful.
| This test takes at least three seconds...
| This test, too, takes at least three seconds...
| ./08traps.ztst: all tests successful.
| ./09funcdef.ztst: all tests successful.
| *** /tmp/zsh.ztst.out.22529     Fri Feb 11 05:59:27 2000
| --- /tmp/zsh.ztst.tout.22529    Fri Feb 11 05:59:27 2000
| ***************
| *** 0 ****
| --- 1 ----
| + Days of month do not agree in Fri 11, 02/11/00, 00-02-11
| Test ./10prompt.ztst failed: output differs from expected as shown above for:
|   LC_ALL=C
|   date1=$(print -P %w)
|   date2=$(print -P %W)
|   date3=$(print -P %D)
|   if [[ $date1 != [A-Z][a-z][a-z][[:blank:]]##[0-9]## ]]; then
|     print "Date \`$date1' is not in the form \`Day DD' (e.g. \`Mon 1'"
|   fi
|   if [[ $date2 != [0-9][0-9]/[0-9][0-9]/[0-9][0-9] ]]; then
|     print "Date \`$date2' is not in the form \`DD/MM/YYYY'"
|   fi
|   if [[ $date3 != [0-9][0-9]-[0-9][0-9]-[0-9][0-9] ]]; then
|     print "Date \`$date3' is not in the form \`YY-MM-DD'"
|   fi
|   if (( $date1[5,-1] != $date2[4,5] )) || (( $date2[4,5] != $date3[8,9] ))
|   then
|     print "Days of month do not agree in $date1, $date2, $date3"
|   fi
|   if (( $date2[1,2] != $date3[4,5] )); then
|     print "Months do not agree in $date2, $date3"
|   fi
|   if (( $date2[7,8] != $date3[1,2] )); then
|     print "Years do not agree in $date2, $date3"
|   fi
| Was testing: Dates produced by prompt escapes
| ./10prompt.ztst: test failed.
| ./50cd.ztst: all tests successful.
| gmake[1]: Leaving directory `/ldl3/akr/zsh/tst/work/zsh-workers_9518/zsh/Test'

Index: Test/10prompt.ztst
===================================================================
RCS file: /projects/zsh/zsh/Test/10prompt.ztst,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 10prompt.ztst
--- Test/10prompt.ztst	2000/02/02 01:26:24	1.1.1.1
+++ Test/10prompt.ztst	2000/02/10 21:17:29
@@ -93,7 +93,7 @@
   if [[ $date3 != [0-9][0-9]-[0-9][0-9]-[0-9][0-9] ]]; then
     print "Date \`$date3' is not in the form \`YY-MM-DD'"
   fi
-  if (( $date1[5,-1] != $date2[4,5] )) || (( $date2[4,5] != $date3[8,9] ))
+  if (( $date1[5,-1] != $date2[4,5] )) || (( $date2[4,5] != $date3[7,8] ))
   then
     print "Days of month do not agree in $date1, $date2, $date3"
   fi
-- 
Tanaka Akira

