From zsh-workers-request@euclid.skiles.gatech.edu Tue Aug 12 16:30:15 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 18213 invoked from network); 12 Aug 1997 16:30:14 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 12 Aug 1997 16:30:14 -0000
Received: (from list@localhost)
	by euclid.skiles.gatech.edu (8.8.5/8.8.5) id MAA27316;
	Tue, 12 Aug 1997 12:26:03 -0400 (EDT)
Resent-Date: Tue, 12 Aug 1997 12:26:03 -0400 (EDT)
X-URL: http://ghidora.uwyo.edu/~harres
Date: Tue, 12 Aug 1997 10:15:01 -0600
From: "John M. Harres" <harres@UWYO.EDU>
Subject: Re: weird zsh startup behavior
In-reply-to: "Your message of Sun, 10 Aug 1997 00:30:09 PDT."
 <19970810003009.13551@molehill.org>
To: zsh-workers@math.gatech.edu
Message-id: <199708121615.KAA06836@ghidora.uwyo.edu>
MIME-version: 1.0
X-Mailer: exmh version 2.0zeta 7/24/97
Content-type: multipart/signed; boundary="==_Exmh_-458791479P"; micalg=pgp-md5;
 protocol="application/pgp-signature"
Content-transfer-encoding: 7bit
Resent-Message-ID: <"jTcyN3.0.lg6.Rw8yp"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3441
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

--==_Exmh_-458791479P
Content-Type: text/plain; charset=us-ascii

Well, this rather trivial patch seems to work.  Please let me know if there's
anything I've done wrong.

I'm beginning to think the second loop is intended to handle the current 
directory being a symlink.  For that reason, I'm checking the lstat's results' 
inode rather than the directory entry's, although again, I'm not completely 
sure under what circumstances these will differ.

John

*** compat.c.old        Tue Dec 17 13:14:11 1996
--- compat.c    Tue Aug 12 09:56:21 1997
***************
*** 176,182 ****
                 (fn[1] == '.' && fn[2] == '\0')))
                continue;
            lstat(fn, &sbuf);
!           if (sbuf.st_dev == dev)
                goto match;
        }
        noholdintr();
--- 176,182 ----
                 (fn[1] == '.' && fn[2] == '\0')))
                continue;
            lstat(fn, &sbuf);
!           if (sbuf.st_dev == dev && sbuf.st_ino == ino)
                goto match;
        }
        noholdintr();



--==_Exmh_-458791479P
Content-Type: application/pgp-signature

-----BEGIN PGP MESSAGE-----
Version: 2.6.2

iQB1AwUBM/CMBAxlFYvtP/ENAQEm5wL/TTMvHeeYqi1Hx5Vt9bqGJH87WA987o7a
7I4DmW6mEdmzlLlvISGYY1i0SD1JBkPb8Si2jqLjPRGyO2Z1Y+H+mhzAqAkHVPIV
7fIZMMQocpexowgQwdzGW7874UW6P6Y8
=7UZQ
-----END PGP MESSAGE-----

--==_Exmh_-458791479P--

