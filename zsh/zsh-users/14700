From zsh-users-return-14700-mason-zsh=primenet.com.au@zsh.org Sun Jan 03 10:04:05 2010
Return-Path: <zsh-users-return-14700-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11956 invoked by alias); 3 Jan 2010 10:04:05 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14700
Received: (qmail 29598 invoked from network); 3 Jan 2010 10:03:55 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.0 required=5.0 tests=AWL,BAYES_00,
	FH_DATE_PAST_20XX,SPF_HELO_PASS autolearn=no version=3.2.5
Received-SPF: none (ns2.melb.primenet.com.au: domain at bewatermyfriend.org does not designate permitted sender hosts)
Date: Sun, 3 Jan 2010 11:02:41 +0100
From: Frank Terbeck <ft@bewatermyfriend.org>
To: zsh-users@zsh.org
Subject: Re: Git info in right prompt
Message-ID: <20100103100241.GC23790@fsst.voodoo.lan>
Mail-Followup-To: zsh-users@zsh.org
References: <20100102094112.GA7659@mail.b79.net> <87iqbk1448.wl%djcb@djcbsoftware.nl> <20100103090946.GA12624@mail.b79.net>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
In-Reply-To: <20100103090946.GA12624@mail.b79.net>
User-Agent: Mutt/1.5.18 (2008-05-17)
X-Df-Sender: 430444

John Magolske <listmail@b79.net>:
> * Dirk-Jan C. Binnema <djcb.bulk@gmail.com> [100102 15:52]:
> > >>>>> "John" == John Magolske <listmail@b79.net> writes:
> > John> I'd like to display the current git branch in the right prompt,
> > John> ...
> > John> ... and I can't seem to make any "display git branch" thing work
> > 
> > Below is my setup for my prompts; it's a bit *more* than what you ask
> > for, but it is hopefully helpful.
> 
> Thanks, 'tis more than what I need at the moment, but it'll be handy
> to refer to over time for sure. Here's what I've settled on for now:
> 
>   autoload -Uz vcs_info
>   precmd () {
>       psvar=()
>       vcs_info
>       [[ -n $vcs_info_msg_0_ ]] && psvar[1]="$vcs_info_msg_0_"
>   }
>   
>   export PROMPT="%B%F{green} %~%(1v.%b%F{yellow}%1v%f.) %B%F{yellow}%# %b%F{white}"

Don't export $PROMPT. Child processes do not need to know about it and
it causes more harm than it does good.

> However, for some reason the git info will appear in my prompt only
> if I do something like `mv /etc/zsh/zshrc /etc/zsh/zshrc-1`
> Seems something in the zshrc that came with the Grml distro I'm
> using is preventing the display of git info (or maybe I'm just doing
> something wrong). I tried reading through and commenting out various
> sections of that zshrc to figure out what might be causing this
> interaction to no avail. Any ideas?

Well, grml's zshrc does a lot of stuff already. And it uses vcs_info,
too. It also has a precmd() function of its own.

There is potentially more than one way to achieve what you want.

The easiest is probably to change the precmd() function and the PS1=
definition in grml's zsh setup to your liking. That would make
upgrading later a little hairier, though. You could also overwrite
precmd() and PS1= in your user specific file. But note, that grml's
precmd() may already do things you want to keep so copy code for that
stuff over into your file.

If your questions are really about grml's *specific* setup, then
there's a user mailing list for the project and an IRC channel named
#grml on freenode. Those places may be more suited.

Regards, Frank

-- 
In protocol design, perfection has been reached not when there is
nothing left to add, but when there is nothing left to take away.
                                                  -- RFC 1925

