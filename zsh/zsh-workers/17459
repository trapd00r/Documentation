From zsh-workers-return-17459-mason-zsh=primenet.com.au@sunsite.dk Tue Jul 16 04:40:14 2002
Return-Path: <zsh-workers-return-17459-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24540 invoked from network); 16 Jul 2002 04:40:13 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 16 Jul 2002 04:40:13 -0000
Received: (qmail 17460 invoked by alias); 16 Jul 2002 04:40:03 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 17459
Received: (qmail 17444 invoked from network); 16 Jul 2002 04:40:02 -0000
To: Clint Adams <clint@zsh.org>
Cc: zsh-workers@sunsite.dk, 152795-forwarded@bugs.debian.org
Subject: Re: _cvs malfunction
References: <20020715205720.GA11288@dman.com>
MIME-Version: 1.0 (generated by SEMI 1.14.0 - "Iburihashi")
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@m17n.org>
Date: 16 Jul 2002 13:39:21 +0900
In-Reply-To: <20020715205720.GA11288@dman.com>
 (Clint Adams's message of "Mon, 15 Jul 2002 16:57:20 -0400")
Message-ID: <hvofzykqoau.fsf@coulee.a02.aist.go.jp>
Lines: 35
User-Agent: T-gnus/6.14.5 (based on Gnus v5.8.7) (revision 08) SEMI/1.14.0 (Iburihashi) Deisui/1.14.0 (Kikuhime) APEL/10.3 Emacs/21.0.104 (i386-unknown-freebsd4.2) MULE/5.0 (SAKAKI)

In article <20020715205720.GA11288@dman.com>,
  Clint Adams <clint@zsh.org> writes:

> Files with RCS kflags in CVS/Entries will not be excluded from
> completion for 'cvs add'.

It's my fault.

> This seems to fix it, but since it seems to have been purposeful, I am
> not committing.  Can someone explain what's supposed to be going on
> here?

Since `cvs add' accepts a file which is removed by `cvs rm' but not
committing yet.  It has `-' just before a revision in CVS/Entries.

So my fix is follows:

Index: Completion/Unix/Command/_cvs
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_cvs,v
retrieving revision 1.15
diff -u -r1.15 _cvs
--- Completion/Unix/Command/_cvs	26 May 2002 19:22:43 -0000	1.15
+++ Completion/Unix/Command/_cvs	16 Jul 2002 04:33:46 -0000
@@ -963,7 +963,7 @@
   realdir=${(e)~linedir}
   [[ -f "$realdir"CVS/Entries ]] && {
     omitpats=(
-      ${${${${(M)${${(f)"$(<"$realdir"CVS/Entries)"}:#/*/-*}:#(D|)/*}#(D|)/}%%/*}//(#m)[][*?()<|^~#\\]/\\$MATCH}
+      ${${${${(M)${${(f)"$(<"$realdir"CVS/Entries)"}:#/*/-*/*/*/*}:#(D|)/*}#(D|)/}%%/*}//(#m)[][*?()<|^~#\\]/\\$MATCH}
       $_cvs_ignore_default
       ${=cvsignore}
     )
-- 
Tanaka Akira

