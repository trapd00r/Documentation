From jdl@clinicom.com Sat Jun  8 07:51:45 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3/2) with ESMTP id HAA20545 for <mason@werple.mira.net.au>; Sat, 8 Jun 1996 07:51:42 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id RAA26982; Fri, 7 Jun 1996 17:41:30 -0400 (EDT)
Resent-Date: Fri, 7 Jun 1996 17:41:30 -0400 (EDT)
From: "J.D. Laub" <jdl@clinicom.com>
Message-Id: <199606072140.PAA207548@clinicom.com>
Subject: minor awk script problem
To: zsh-workers@math.gatech.edu
Date: Fri, 7 Jun 1996 15:40:44 -0600 (MDT)
Organization: The Psychiatric Ward of Terrors
X-Mailer: ELM [version 2.4 PL24 PGP3 *ALPHA*]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"GdB9s2.0.Tb6.98Akn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1292
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 1892
Status: OR

In two places Src/signames.awk tries to printf a hash using a %c.  It
ends up printing nothing for the hash on AIX 3.2 (3.2.5?).  (I.e.,
"#else" ends up coming out as "else", which causes compiler problems
in builtin.c.)  Changing the %c to %s seems to work on all platforms.
The following diff was run on beta19.

*** signames.awk.old	Fri Jun  7 12:34:50 1996
--- signames.awk	Fri Jun  7 12:34:50 1996
***************
*** 54,60 ****
  END {
      hash = "#"
      ps = "%s"
!     ifdstr = sprintf("#ifdef USE_SUSPENDED\n\t%csuspended%s%c,\n%celse\n\t%cstopped%s%c,\n#endif\n", 034, ps, 034, hash, 034, ps, 034)
  
      printf("%s\n%s\n\n%s\t%d\n\n%s\n\n%s\n\t%c%s%c,\n", "/** signals.h                                 **/", "/** architecture-customized signals.h for zsh **/", "#define SIGCOUNT", max, "#ifdef GLOBALS", "char *sigmsg[SIGCOUNT+2] = {", 034, "done", 034)
  
--- 54,60 ----
  END {
      hash = "#"
      ps = "%s"
!     ifdstr = sprintf("#ifdef USE_SUSPENDED\n\t%csuspended%s%c,\n%selse\n\t%cstopped%s%c,\n#endif\n", 034, ps, 034, hash, 034, ps, 034)
  
      printf("%s\n%s\n\n%s\t%d\n\n%s\n\n%s\n\t%c%s%c,\n", "/** signals.h                                 **/", "/** architecture-customized signals.h for zsh **/", "#define SIGCOUNT", max, "#ifdef GLOBALS", "char *sigmsg[SIGCOUNT+2] = {", 034, "done", 034)
  
***************
*** 89,95 ****
      print "\tNULL"
      print "};"
      print ""
!     printf("%celse\n", hash)
      print "extern char *sigs[SIGCOUNT+4],*sigmsg[SIGCOUNT+2];"
      print "#endif"
  }
--- 89,95 ----
      print "\tNULL"
      print "};"
      print ""
!     printf("%selse\n", hash)
      print "extern char *sigs[SIGCOUNT+4],*sigmsg[SIGCOUNT+2];"
      print "#endif"
  }
-- 
J.D. Laub (Laubster) HBOC/CliniCom|"I think you're very, very, very, very, very,
jdl@clinicom.com     Boulder,CO   |very, very, very, very, ..." - Flying Lizards


