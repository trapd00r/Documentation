From zsh-workers-return-19593-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 10 16:06:21 2004
Return-Path: <zsh-workers-return-19593-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12739 invoked from network); 10 Mar 2004 16:06:20 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 10 Mar 2004 16:06:20 -0000
Received: (qmail 11238 invoked by alias); 10 Mar 2004 16:06:03 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19593
Received: (qmail 11218 invoked from network); 10 Mar 2004 16:06:02 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 10 Mar 2004 16:06:02 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [193.109.254.211] by sunsite.dk (MessageWall 1.0.8) with SMTP; 10 Mar 2004 16:6:1 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-19.tower-36.messagelabs.com!1078934760!4538992
X-StarScan-Version: 5.2.5; banners=-,-,-
X-Originating-IP: [158.234.9.163]
Received: (qmail 2092 invoked from network); 10 Mar 2004 16:06:00 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-19.tower-36.messagelabs.com with SMTP; 10 Mar 2004 16:06:00 -0000
Received: from trentino.logica.co.uk ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id i2AG60Ck004751
	for <zsh-workers@sunsite.dk>; Wed, 10 Mar 2004 16:06:00 GMT
Received: from trentino.logica.co.uk (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP id BD63179721BB
	for <zsh-workers@sunsite.dk>; Wed, 10 Mar 2004 17:05:15 +0100 (CET)
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <20040309161155.GA29990@scowler.net> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <22337.1078834678@csr.com> <1040309152508.ZM14625@candle.brasslantern.com> <20040309160037.GA29678@scowler.net> <1040309160620.ZM14725@candle.brasslantern.com> <20040309161155.GA29990@scowler.net>
To: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: 4.2.0-pre-3; HP-UX 
Date: Wed, 10 Mar 2004 17:05:15 +0100
Message-ID: <3175.1078934715@trentino.logica.co.uk>

Clint Adams wrote:
> 
> Hmm.  I'd log into one of the HP Test Drive HP-UX systems, except that I
> seem to have forgotten my password.

I think they expire your account if you don't use it for a while. My old
one from when it was still Compaq has gone. Anyway, I signed up again.

On HP/UX, dlopen etc are there. This is HP/UX 11.23. The old shl_*
routines are also there. Of particular note is this passage at the end
of shl_load(3X):

      Future HP-UX environments may not support these routines and
      flags or may only support a subset of them.  Instead, they will
      use the SVR4 dynamic loading API.  Users are encouraged to
      migrate to the dl* family of dynamic linking routines.  See
      dlclose(3C), ...

HPUXDYNAMIC does not get defined so we are following that.

It builds okay but can't load all the modules - some such as zle and
files load, others like complete and math won't. There are also plenty
of warnings:

Warning 942: "module.c", line 429 # Types 'void *' and 'int' are not
    assignment-compatible.
            ret = dlopen(unmeta(buf), RTLD_LAZY | RTLD_GLOBAL);
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Warning 361: "init.c", line 1204 # Value-returning function might end without
    executing a return statement.
    zsh_main(int argc, char **argv)
    ^^^^^^^^

A few of these:
Warning 1042: "jobs.c", line 421 # Subscript out of range.
        if (sigtrapped[SIGCHLD] && job != thisjob)
                       ^^^^^^^
That also occurs for SIGWINCH, SIGPIPE and SIGALRM.

Then there are many many warnings like this:

This warning comes up a lot for many times in different places:
Warning 952: "compctl.c", line 608 # Conversion of 'const char *' to 'char *'
    loses 'const'.
                        *argv = "" - 1;
                        ^^^^^^

What is that code trying to do? Isn't that taking the address of a
constant string. Seems dodgy to me.

Then, this warning:
Warning 942: "zle_refresh.c", line 527 # Types 'unsigned char *' and 'char *'
    are not assignment-compatible.
            s = nbuf[tosln - 1];
            ^^^^^^^^^^^^^^
And, the same for zle_refresh.c:536,542,551 and zle_thingy.c:656

I also tried compiling on the Tru64 5.1 machine. It warns about many
unresolved things after linking each shared library. These look like the
things which will be resolved when they are loaded at runtime. We could
turn off the warnings with the option `-expect_unresolved *'

It stops at an error though:

cc -c -I.  -DHAVE_CONFIG_H -DMODULE -O  -o terminfo..o terminfo.c
cc: Error: /usr/include/curses.h, line 125: In this declaration, "DO" has no linkage and has a prior declaration in this scope at line number 212 in file ../../Src/zsh.h. (nolinkage)
                *DM, *DO, *ED, *EI, *K0, *K1, *K2, *K3, *K4, *K5, *K6,
---------------------^

This is an extern char declaration in curses.h.

Does anyone know of any similar places to HP's testdrive where I could
get a log on for IRIX 6 or AIX and where they include compilers and a
way to get the source code uploaded.

I don't have so much time at the moment either but if we're not in a
rush for 4.2, we should be able to get zsh working on the different
operating systems. Would it perhaps be worth putting out a 4.1.2 now to
get the code a bit more testing and allow it to get into Linux
distributions?

Oliver

