From zsh-workers-return-22491-mason-zsh=primenet.com.au@sunsite.dk Wed Jun 14 03:23:16 2006
Return-Path: <zsh-workers-return-22491-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6458 invoked from network); 14 Jun 2006 03:23:14 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.3 (2006-06-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 14 Jun 2006 03:23:14 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 67513 invoked from network); 14 Jun 2006 03:23:09 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 14 Jun 2006 03:23:09 -0000
Received: (qmail 10055 invoked by alias); 14 Jun 2006 03:23:06 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22491
Received: (qmail 10046 invoked from network); 14 Jun 2006 03:23:06 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 14 Jun 2006 03:23:06 -0000
Received: (qmail 67225 invoked from network); 14 Jun 2006 03:23:05 -0000
Received: from py-out-1112.google.com (64.233.166.180)
  by a.mx.sunsite.dk with SMTP; 14 Jun 2006 03:23:04 -0000
Received: by py-out-1112.google.com with SMTP id i49so5259869pyi
        for <zsh-workers@sunsite.dk>; Tue, 13 Jun 2006 20:23:02 -0700 (PDT)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:sender:to:subject:cc:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references:x-google-sender-auth;
        b=PHcC3Vgp89lwWJQVy1cUfZ1rmPfLXSUHvkXjm0phHZWZ8DBf+x2A3P7vaVAWiTMVVH4CWl5e8o6MmEuk6PZV2wCHlAodoae4N906VfKSg4rfTtKb51GXcdQ+S9CExLNKRhBPqv8L7A06HKNupXswCnhU8HdQ6NyaDkD5GGKx5uw=
Received: by 10.35.126.7 with SMTP id d7mr281316pyn;
        Tue, 13 Jun 2006 20:23:01 -0700 (PDT)
Received: by 10.35.122.12 with HTTP; Tue, 13 Jun 2006 20:23:01 -0700 (PDT)
Message-ID: <20a807210606132023n5978b246ycbbba1786d5a9535@mail.gmail.com>
Date: Tue, 13 Jun 2006 23:23:01 -0400
From: "Vin Shelton" <acs@alumni.princeton.edu>
Sender: ethersoft@gmail.com
To: "Peter Stephenson" <pws@csr.com>
Subject: Re: Hang on latest kubuntu linux when built with icc
Cc: "Zsh hackers list" <zsh-workers@sunsite.dk>
In-Reply-To: <200606121307.k5CD7JvS018060@news01.csr.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
References: <20a807210606101831w3170d4aandf94ce83ac5ec8a8@mail.gmail.com>
	 <200606121307.k5CD7JvS018060@news01.csr.com>
X-Google-Sender-Auth: e958fa7c26e1754e

On 6/12/06, Peter Stephenson <pws@csr.com> wrote:
> "Vin Shelton" wrote:
> > when I build the latest CVS sources with icc, the Intel C compiler,
> > the shell eventually hangs after running a command but before
> > returning to the prompt.  It usually takes only 1-5 commands before
> > this happens.
> >
> > Here's an strace of zsh -f:
> >...
> > wait4(-1, 0xbfd3ac30, WNOHANG|WSTOPPED, 0xbfd3abd4) = -1 ECHILD (No
> > child processes)
> > sigreturn()                             = ? (mask now ~[HUP KILL CHLD
> > STOP RTMIN])
> > pause()                                 = ? ERESTARTNOHAND (To be restarted)
> > --- SIGHUP (Hangup) @ 0 (0) ---
> >...
> > The SIGHUP is where I killed the shell from another window.
>
> Unfortunately I'm not a signal expert and it really needs someone who
> does this sort of thing regularly.
>
> The pause() looks a bit fishy.  There are two explicit occurrences in
> the code:  I'll assume it's one of these for now.  What strace
> reports might be only distantly related to the source code; still, my
> Fedora Core 4 with 2.6.14 says it's calling rt_sigsuspend(), which
> sounds much more plausible.
>
> One call is here:
>
> #ifdef BROKEN_POSIX_SIGSUSPEND
>     sigprocmask(SIG_SETMASK, &set, &oset);
>     pause();
>     sigprocmask(SIG_SETMASK, &oset, NULL);
> #else /* not BROKEN_POSIX_SIGSUSPEND */
>     ret = sigsuspend(&set);
> #endif /* BROKEN_POSIX_SIGSUSPEND */
>
> and the other is right down at the tail end where we're virtually
> implementing signal suspension from scratch.
>
> I don't think you should be getting either of those... certainly not the
> second, but probably not BROKEN_POSIX_SIGSUSPEND either.  Could you
> check if that's defined?  If it is, try undefining it; the test may need
> tweaking.

Peter,

Thanks for your help.  I'm slightly embarrassed to admit that the
problem was that my system was misconfigured - because I had not added
/opt/intel/compiler/9.0/lib to /etc/ld.so.conf, a dynamic lib could
not be found.  I fixed this in the executable by setting
LD_LIBRARY_PATH before running Src/zsh, by I didn't think that this
would affect the configure tests, too.  Once I added
/opt/intel/compiler/9.0/lib to /etc/ld.so.conf and re-ran ldconfig,
everything worked fine. Previously, BROKEN POSIX_SIGSUSPEND was set,
and no it is not. Zsh is now working fine.

Thanks,
  Vin


-- 
Whoever you are, no matter how lonely,
the world offers itself to your imagination,
calls to you like the wild geese, harsh and exciting--
over and over announcing your place
in the family of things.			Mary Oliver

