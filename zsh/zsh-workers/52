From zsh-workers-request@math.gatech.edu  Tue May 30 04:43:20 1995
Received: from gatech.edu (gatech.edu [130.207.244.244]) by werple.mira.net.au (8.6.12/8.6.9) with SMTP id EAA21726 for <mason@werple.mira.net.au>; Tue, 30 May 1995 04:43:11 +1000
Received: from math (math.skiles.gatech.edu) by gatech.edu with SMTP id AA14093
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Mon, 29 May 1995 14:43:46 -0400
Received: by math (5.x/SMI-SVR4)
	id AA03574; Mon, 29 May 1995 14:42:01 -0400
Resent-Date: Mon, 29 May 1995 20:41:33 +0100 (MET DST)
Old-Return-Path: <hzoli@cs.elte.hu>
From: hzoli@cs.elte.hu (Zoltan Hidvegi)
Message-Id: <9505291841.AA04444@turan.elte.hu>
Subject: eval bugfix when IFS[1] != ' '
To: zsh-workers@math.gatech.edu (zsh-workers)
Date: Mon, 29 May 1995 20:41:33 +0100 (MET DST)
X-Mailer: ELM [version 2.4 PL21]
Content-Type: text
Resent-Message-Id: <"yZA2A1.0.it.uLXol"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/52
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

The bug:
turan% foo=a/b/c 
turan% setopt shwordsplit 
turan% (IFS=/ ; eval echo $foo)
zsh: no such file or directory: echo/a/b/c

Similar problem can occur with sched.

The fix also removes an unnecessary ztrdup/zsfree pair, and corrects a
comment.

Zoltan

*** Src/builtin.c.orig	Mon May 29 20:37:13 1995
--- Src/builtin.c	Mon May 29 20:36:33 1995
***************
*** 4908,4924 ****
      return ret ? ret : lastval;
  }
  
! /* eval: simple mathematical evaluation */
  
  /**/
  int
  bin_eval(char *nam, char **argv, char *ops, int func)
  {
-     char *s = ztrdup(spacejoin(argv));
      List list;
  
!     hungets(s);
!     zsfree(s);
      strinbeg();
      if (!(list = parse_list())) {
  	hflush();
--- 4908,4922 ----
      return ret ? ret : lastval;
  }
  
! /* eval: simple evaluation */
  
  /**/
  int
  bin_eval(char *nam, char **argv, char *ops, int func)
  {
      List list;
  
!     hungets(join(argv, ' '));
      strinbeg();
      if (!(list = parse_list())) {
  	hflush();
***************
*** 5492,5498 ****
      of scheduled commands. */
      sch = (struct schedcmd *)zcalloc(sizeof *sch);
      sch->time = t;
!     sch->cmd = ztrdup(spacejoin(argv));
      sch->next = NULL;
      for (sch2 = (struct schedcmd *)&schedcmds; sch2->next; sch2 = sch2->next);
      sch2->next = sch;
--- 5490,5496 ----
      of scheduled commands. */
      sch = (struct schedcmd *)zcalloc(sizeof *sch);
      sch->time = t;
!     sch->cmd = ztrdup(join(argv, ' '));
      sch->next = NULL;
      for (sch2 = (struct schedcmd *)&schedcmds; sch2->next; sch2 = sch2->next);
      sch2->next = sch;

