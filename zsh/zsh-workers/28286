From zsh-workers-return-28286-mason-zsh=primenet.com.au@zsh.org Fri Sep 24 04:37:18 2010
Return-Path: <zsh-workers-return-28286-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23858 invoked by alias); 24 Sep 2010 04:37:18 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28286
Received: (qmail 27004 invoked from network); 24 Sep 2010 04:37:16 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at benizi.com designates 64.130.10.15 as permitted sender)
Date: Fri, 24 Sep 2010 00:36:47 -0400 (EDT)
From: "Benjamin R. Haskell" <zsh@benizi.com>
To: Zsh Workers <zsh-workers@zsh.org>
Subject: !!$ unitialized at first prompt
Message-ID: <alpine.LNX.2.01.1009232317460.4754@hp>
User-Agent: Alpine 2.01 (LNX 1266 2009-07-14)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; format=flowed; charset=US-ASCII

Experiencing bizarre behavior when the first thing I do in the shell is 
to call expand-or-complete on !$.

If the value of !$ contains something from $IFS, it expands improperly 
during the first command to just the last word.

# get something into history that has a space-y last arg
first-shell$ echo 'a b'
a b
first-shell$ <ctrl-d> to logout

# first noticed the weird tab-completion
second-shell$ echo !$<tab>
zsh: do you want to see all 294 possibilities (49 lines)?

# but it also doesn't expand to the correct value:
# (without an intervening command)
second-shell$ echo x!{$}y
quote><ctrl-c>
echo xb'y

I first thought it was related to having just added csh_junkie_history 
to my preferred options, but it's not.  Reproducible with 
HISTFILE=/tmp/testhist ZDOTDIR=/nonexistent zsh -f.  Seems like 
something's not being initialized in the correct order.

-- 
Best,
Ben

