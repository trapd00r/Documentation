From zsh-users-return-9808-mason-zsh=primenet.com.au@sunsite.dk Thu Jan 05 10:34:03 2006
Return-Path: <zsh-users-return-9808-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26726 invoked from network); 5 Jan 2006 10:33:59 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO,
	HTML_MESSAGE autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 Jan 2006 10:33:59 -0000
Received: (qmail 45412 invoked from network); 5 Jan 2006 10:33:52 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 Jan 2006 10:33:52 -0000
Received: (qmail 10164 invoked by alias); 5 Jan 2006 10:33:40 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 9808
Received: (qmail 10151 invoked from network); 5 Jan 2006 10:33:38 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 5 Jan 2006 10:33:38 -0000
Received: (qmail 43739 invoked from network); 5 Jan 2006 10:33:38 -0000
Received: from anchor-post-35.mail.demon.net (194.217.242.85)
  by a.mx.sunsite.dk with SMTP; 5 Jan 2006 10:33:37 -0000
Received: from aberdour.demon.co.uk ([80.176.90.131] helo=VMGENERAL)
	by anchor-post-35.mail.demon.net with esmtp (Exim 4.42)
	id 1EuSJz-0002iZ-HI
	for zsh-users@sunsite.dk; Thu, 05 Jan 2006 10:26:15 +0000
From: "Tony Hasler" <tony@aberdour.demon.co.uk>
To: <zsh-users@sunsite.dk>
Subject: Full path with ksh emulation
Date: Thu, 5 Jan 2006 10:33:35 -0000
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----=_NextPart_000_0013_01C611E3.7BE23AF0"
X-Mailer: Microsoft Office Outlook, Build 11.0.6353
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.2180
thread-index: AcYR43Z2//848YeGSZO3wnup8TNmtA==

This is a multi-part message in MIME format.

------=_NextPart_000_0013_01C611E3.7BE23AF0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit

Hi,

 

A large client of mine is migrating a bunch of ksh scripts to Linux that
have previously run on HP-UX and Solaris and has discovered that many of
them break because the standard Linux version of ksh (pdksh) creates the
child on right side of a pipe rather than the left - a well documented
incompatibility of the Linux ksh that shows no prospect of ever being
considered a "bug" and hence no prospect of ever being "fixed".

 

Accordingly, they have hit upon the idea of using zsh to emulate ksh.  That
certainly solves the original problem, but introduces a new one.  In ksh the
'whence' command always gives you the absolute path of its argument.  So
'whence $0' always gives a full path even if the command was executed by
typing './myscript'.  I can find no straightforward way to do this in zsh.
Bear in mind that the scripts will run with ksh on HP-UX and Solaris - as
they have for years - but will be modified to run with zsh on Linux with a
command such as:

 

If [[ -z $ZSH_VERSION ]]

then

if [[ -x /usr/local/bin/zsh ]]

then

/usr/local/bin/zsh $@

exit $?

            fi

else

            emulate ksh

fi 

 

Any ideas?

 

 

--Tony

 


------=_NextPart_000_0013_01C611E3.7BE23AF0
Content-Type: text/html;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

<html xmlns:o=3D"urn:schemas-microsoft-com:office:office" =
xmlns:w=3D"urn:schemas-microsoft-com:office:word" =
xmlns=3D"http://www.w3.org/TR/REC-html40">

<head>
<META HTTP-EQUIV=3D"Content-Type" CONTENT=3D"text/html; =
charset=3Dus-ascii">
<meta name=3DGenerator content=3D"Microsoft Word 11 (filtered medium)">
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman";}
p.MsoEnvelopeAddress, li.MsoEnvelopeAddress, div.MsoEnvelopeAddress
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:144.0pt;
	margin-bottom:.0001pt;
	mso-element:frame;
	font-size:12.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
p.MsoEnvelopeReturn, li.MsoEnvelopeReturn, div.MsoEnvelopeReturn
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
span.EmailStyle19
	{mso-style-type:personal-compose;
	font-family:Arial;
	color:windowtext;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;}
div.Section1
	{page:Section1;}
-->
</style>

</head>

<body lang=3DEN-GB link=3Dblue vlink=3Dpurple>

<div class=3DSection1>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'>Hi,<o:p></o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'>A large client of mine is migrating a bunch of ksh =
scripts
to Linux that have previously run on HP-UX and Solaris and has =
discovered that
many of them break because the standard Linux version of ksh (pdksh) =
creates
the child on right side of a pipe rather than the left &#8211; a well
documented incompatibility of the Linux ksh that shows no prospect of =
ever
being considered a &#8220;bug&#8221; and hence no prospect of ever being
&#8220;fixed&#8221;.<o:p></o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'>Accordingly, they have hit upon the idea of using zsh =
to
emulate ksh.&nbsp; That certainly solves the original problem, but =
introduces a
new one.&nbsp; In ksh the &#8216;whence&#8217; command always gives you =
the
absolute path of its argument.&nbsp; So &#8216;whence $0&#8217; always =
gives a
full path even if the command was executed by typing
&#8216;./myscript&#8217;.&nbsp; I can find no straightforward way to do =
this in
zsh.&nbsp; Bear in mind that the scripts will run with ksh on HP-UX and =
Solaris
&#8211; as they have for years &#8211; but will be modified to run with =
zsh on
Linux with a command such as:<o:p></o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'>If [[ -z $ZSH_VERSION ]]<o:p></o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'>then<o:p></o:p></span></font></p>

<p class=3DMsoNormal style=3D'text-indent:36.0pt'><font size=3D2 =
face=3DArial><span
style=3D'font-size:10.0pt;font-family:Arial'>if [[ -x /usr/local/bin/zsh =
]]<o:p></o:p></span></font></p>

<p class=3DMsoNormal style=3D'text-indent:36.0pt'><font size=3D2 =
face=3DArial><span
style=3D'font-size:10.0pt;font-family:Arial'>then<o:p></o:p></span></font=
></p>

<p class=3DMsoNormal =
style=3D'margin-left:36.0pt;text-indent:36.0pt'><font size=3D2
face=3DArial><span =
style=3D'font-size:10.0pt;font-family:Arial'>/usr/local/bin/zsh
$@<o:p></o:p></span></font></p>

<p class=3DMsoNormal =
style=3D'margin-left:36.0pt;text-indent:36.0pt'><font size=3D2
face=3DArial><span style=3D'font-size:10.0pt;font-family:Arial'>exit =
$?<o:p></o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp; fi<o:p></o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'>else<o:p></o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp; emulate ksh<o:p></o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'>fi <o:p></o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'>Any ideas?</span></font><o:p></o:p></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=3DMsoNormal><font size=3D2 face=3DArial><span =
style=3D'font-size:10.0pt;
font-family:Arial'>--Tony</span></font><o:p></o:p></p>

<p class=3DMsoNormal><font size=3D3 face=3D"Times New Roman"><span =
style=3D'font-size:
12.0pt'><o:p>&nbsp;</o:p></span></font></p>

</div>

</body>

</html>

------=_NextPart_000_0013_01C611E3.7BE23AF0--


