From zsh-workers-request@math.gatech.edu Tue Jan 27 18:00:10 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 29233 invoked from network); 27 Jan 1998 18:00:08 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 27 Jan 1998 18:00:08 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id MAA24806;
	Tue, 27 Jan 1998 12:42:22 -0500 (EST)
Resent-Date: Tue, 27 Jan 1998 12:42:22 -0500 (EST)
Date: Tue, 27 Jan 1998 20:44:37 +0300 (MSK)
From: Andrej Borsenkow <borsenkow.msk@sni.de>
X-Sender: bor@itsrm1
Reply-To: borsenkow.msk@sni.de
To: Zsh hackers list <zsh-workers@math.gatech.edu>
Subject: PATCH: zsh-3.1.2-zefram3: CLOBBERS_TYPEAHEAD for SINIX  
In-Reply-To: <199801271616.RAA19759@hydra.ifh.de>
Message-ID: <Pine.SV4.3.95.980127203844.11165C-100000@itsrm1>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Resent-Message-ID: <"ODPPi3.0.X36.znXpq"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3737
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On Tue, 27 Jan 1998, Peter Stephenson wrote:

> Andrej Borsenkow wrote:
> > It is not a big deal, but I just discovered, that typeahead is lost. ZSH
> > sees only the first line; all others are just vanished.
> > 
> 
> It may be system dependent; there used to be a problem with Ultrix that
> you had to read the data already present before changing the terminal
> settings, else suchlike weird things would happen.
> 

Yep. Here is patch to configure which detects it for SINIX (and
RelianUNIX). I cannot test it for all versions, but it is needed for two
of them I currently have.

-------------------------------------------------------------------------
Andrej Borsenkow 		Fax:   +7 (095) 252 01 05
SNI ITS Moscow			Tel:   +7 (095) 252 13 88

NERV:  borsenkow.msk		E-Mail: borsenkow.msk@sni.de
-------------------------------------------------------------------------
--- configure.in.org	Fri Jan 16 16:19:12 1998
+++ configure.in	Tue Jan 27 20:30:20 1998
@@ -741,8 +741,8 @@
 dnl system names directly.
 dnl The doubled square brackets are necessary because autoconf uses m4.
 AC_CACHE_CHECK(if typeahead needs FIONREAD, zsh_cv_sys_clobbers_typeahead,
-[case x-$host_os in
-    x-ultrix* | x-dgux*)
+[case x-$host_vendor-$host_os in
+    x-*-ultrix* | x-*-dgux* | x-sni-sysv4*)
 	zsh_cv_sys_clobbers_typeahead=yes;;
     *)
 	zsh_cv_sys_clobbers_typeahead=no;;
--- configure.org	Fri Jan 16 16:52:35 1998
+++ configure	Tue Jan 27 20:30:20 1998
@@ -3696,8 +3696,8 @@
 if eval "test \"`echo '$''{'zsh_cv_sys_clobbers_typeahead'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  case x-$host_os in
-    x-ultrix* | x-dgux*)
+  case x-$host_vendor-$host_os in
+    x-*-ultrix* | x-*-dgux* | x-sni-sysv4*)
 	zsh_cv_sys_clobbers_typeahead=yes;;
     *)
 	zsh_cv_sys_clobbers_typeahead=no;;


