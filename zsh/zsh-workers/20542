From zsh-workers-return-20542-mason-zsh=primenet.com.au@sunsite.dk Thu Nov 04 17:55:57 2004
Return-Path: <zsh-workers-return-20542-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29764 invoked from network); 4 Nov 2004 17:55:56 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 4 Nov 2004 17:55:56 -0000
Received: (qmail 47073 invoked from network); 4 Nov 2004 17:55:50 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Nov 2004 17:55:50 -0000
Received: (qmail 9336 invoked by alias); 4 Nov 2004 17:55:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20542
Received: (qmail 9321 invoked from network); 4 Nov 2004 17:55:35 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 4 Nov 2004 17:55:35 -0000
Received: (qmail 46584 invoked from network); 4 Nov 2004 17:55:35 -0000
Received: from moonbase.zanshin.com (64.84.47.139)
  by a.mx.sunsite.dk with SMTP; 4 Nov 2004 17:55:33 -0000
Received: from toltec.zanshin.com (toltec.zanshin.com [64.84.47.166])
	by moonbase.zanshin.com (8.13.1/8.13.1) with ESMTP id iA4H1KQU010366
	for <zsh-workers@sunsite.dk>; Thu, 4 Nov 2004 09:01:20 -0800
Date: Thu, 4 Nov 2004 09:01:20 -0800 (PST)
From: Bart Schaefer <schaefer@brasslantern.com>
Reply-To: zsh-workers@sunsite.dk
To: Zsh Workers <zsh-workers@sunsite.dk>
Subject: Re: Is this a bug or I'm completely lost?
In-Reply-To: <20041104115359.GA23778@DervishD>
Message-ID: <Pine.LNX.4.61.0411040841090.5131@toltec.zanshin.com>
References: <20041104115359.GA23778@DervishD>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_44 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0

On Thu, 4 Nov 2004, DervishD wrote:

>     compadd -k nameddirs userdirs
> 
>     Then when I hit <TAB> I'm presented with the list of named
> directories and user directories, in that order. That's correct. But
> if I specify a starting letter (or any starting prefix) and I hit
> <TAB>, only the first array is considered as a list of possible
> matches.

It certainly appears that this is the intentional behavior of compadd -k, 
based on a look at the code.  If you specify multiple arrays in a single 
compadd, they're assumed to indicate a preference ordering (e.g. nameddirs 
xor userdirs) whereas if you use separate compadds they're cumulative.  
The code very explicitly stops searching as soon as a partial match has 
been found; the only reason you get all of them in your first example is 
that there are no partial matches.

Unless of course I'm misreading the code, which is entirely possible given 
that Sven W. is really the only person who has ever had all of this inside 
his brain at one time.

I'm reluctant to try to change it given that there may be some obscure 
dependence on this ... just because I can't think of a case where the 
existing completion fuctions pass more than one array name to compadd, 
doesn't mean there isn't one.

On the other hand I don't want to change the docs if it really is a bug. 
Can someone else (Oliver?  PWS?) take a look at compcore.c:addmatches() 
and give a second opinion?  (Search with /arrays/i).

