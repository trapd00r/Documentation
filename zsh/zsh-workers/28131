From zsh-workers-return-28131-mason-zsh=primenet.com.au@zsh.org Thu Aug 05 12:46:25 2010
Return-Path: <zsh-workers-return-28131-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6948 invoked by alias); 5 Aug 2010 12:46:25 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28131
Received: (qmail 24487 invoked from network); 5 Aug 2010 12:46:22 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_LOW,
	SPF_HELO_PASS autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at csr.com does not designate permitted sender hosts)
Date: Thu, 5 Aug 2010 13:44:49 +0100
From: Peter Stephenson <Peter.Stephenson@csr.com>
To: zsh-workers@zsh.org
Cc: "Peter A. Castro" <doctor@fruitbat.org>
Subject: Re: I cannot run zsh: child state waiting for longjmp
Message-ID: <20100805134449.3bd78573@csr.com>
In-Reply-To: <alpine.LNX.2.00.1008041418300.3463@gremlin.fruitbat.org>
References: <4C56C944.3020406@gmail.com>
	<20100802144319.063b9c90@csr.com>
	<alpine.LNX.2.00.1008041418300.3463@gremlin.fruitbat.org>
Organization: Cambridge Silicon Radio
X-Mailer: Claws Mail 3.7.6 (GTK+ 2.18.9; i686-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 05 Aug 2010 12:44:50.0053 (UTC) FILETIME=[FE426350:01CB349B]
X-Scanned-By: MailControl A_09_40_00 (www.mailcontrol.com) on 10.71.1.123

(Moved to zsh-workers.)

On Wed, 4 Aug 2010 15:12:12 -0700 (PDT)
"Peter A. Castro" <doctor@fruitbat.org> wrote:
> On Mon, 2 Aug 2010, Peter Stephenson wrote:
> >> I built zsh-4.3.10 on MSYS on Win XP.
> >> It's working fine but Whenever I set path to whatever value, let's
> >> say: path=(. /usr/local/bin /mingw/bin /bin)
> >>
> >> and run whatever command, let's say ls, I get:
> >>
> >> --------------------
> >> $ path=(. /usr/local/bin /mingw/bin /bin)
> >> $ ls
> >>        0 [main] zsh 1556 sync_with_child: child 444(0x6AC) died
> >> before initialization with status code 0xC0000135
> >>    17380 [main] zsh 1556 sync_with_child: *** child state waiting
> >> for longjmp
> >> zsh: fork failed: resource temporarily unavailable
> >> --------------------
> 
> Unfortunately, I'm seeing this same kind of symptom under Cygwin
> (1.7.5) when I run 'make check'.  Several of the tests generate
> something similar to the above while others just plain hang and I
> have to kill the subshells in order for it to continue.  I'm not sure
> how much of this is Cygwin and how much of it is zsh.  I'll attempt
> to debug it but I don't have the time right now.

I'm not seeing any problems this basic with the latest zsh code on my setup
with Windows XP and a Cygwin from April (setup.exe claims it's 1.7.5-1).  I
am seeing failing tests with process substitutions hanging; we've had this
issue before and been back and forth between the two possible
implementations to try to fix it.  Apart from that, I don't think we're
going to get further within zsh without more detail of the failures:
relevant Cygwin changes / Windows versions / zsh configurations.

Here's a change for the MACHINES file.  I think the paragraph I've removed
is well out of date.

Index: MACHINES
===================================================================
RCS file: /cvsroot/zsh/zsh/MACHINES,v
retrieving revision 1.8
diff -p -u -r1.8 MACHINES
--- MACHINES	16 May 2009 12:13:00 -0000	1.8
+++ MACHINES	5 Aug 2010 12:02:31 -0000
@@ -46,10 +46,13 @@ Red Hat Inc.: Cygwin
 	`binmode'). There are various issues with Cygwin versions before
 	1.3.2 - you are adviced to update to the latest release.
 
-	Dynamic loading works as of cygwin-1.1.3 and binutils-20000722-1.
-	It was not tested for earlier versions. This does not imply
-	that every module will work. New completion and in
-	particular zsh/zftp and zsh/mathfunc are known to work.
+	Process substitution using <(...), >(...), =(...) may be
+	problematic.  Different versions of zsh and Cygwin have
+	a different mix of issues.
+
+	Problems handling subprocesses have been reported with Cygwin
+	1.7.5.  It is not currently known how the problems split between
+	Cygwin and zsh.
 
 	Some of the tests in the Test subdirectory are known to fail:
 	this is because the UNIX environment is not completely implemented.

-- 
Peter Stephenson <pws@csr.com>            Software Engineer
Tel: +44 (0)1223 692070                   Cambridge Silicon Radio Limited
Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, UK


Member of the CSR plc group of companies. CSR plc registered in England and Wales, registered number 4187346, registered office Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, United Kingdom

