From zsh-workers-return-7896-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Sep 17 07:45:44 1999
Return-Path: <zsh-workers-return-7896-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15583 invoked from network); 17 Sep 1999 07:45:42 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Sep 1999 07:45:42 -0000
Received: (qmail 4824 invoked by alias); 17 Sep 1999 07:45:37 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7896
Received: (qmail 4817 invoked from network); 17 Sep 1999 07:45:37 -0000
Date: Fri, 17 Sep 1999 09:45:29 +0200 (MET DST)
Message-Id: <199909170745.JAA00034@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 17 Sep 1999 04:11:11 +0900
Subject: Re: cursor positioning with compleiton


Tanaka Akira wrote:

> I found a problem with cursor positioning with compleiton.
> 
> Z(2):akr@is27e1u11% Src/zsh -f
> is27e1u11% bindkey -e; fpath=($PWD/Completion/*(/)); autoload -U compinit; compinit -D; compdef _tst tst
> is27e1u11% compconf group_matches=yes message_format='%d' description_format='%d' describe_options=yes
> is27e1u11% _tst () { _arguments -s '-a[aaa]' '-b[bbb]' }
> is27e1u11% tst -<TAB>
> option
> -a -- aaa
> -b -- bbb
> 
> After this, the cursor are positioned in the line to define `_tst'.

So you don't use `complist'?

Bye
 Sven

diff -u os/Zle/zle_tricky.c Src/Zle/zle_tricky.c
--- os/Zle/zle_tricky.c	Thu Sep 16 14:21:20 1999
+++ Src/Zle/zle_tricky.c	Fri Sep 17 09:43:51 1999
@@ -8333,7 +8333,7 @@
     longest += 2 + of;
     if ((ncols = columns / longest)) {
 	for (g = amatches; g; g = g->next)
-	    nlines += (g->lcount + ncols - 1) / ncols;
+	    nlines += (g->lcount - g->llcount + ncols - 1) / ncols;
     } else {
 	ncols = 1;
 	opl = 1;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

