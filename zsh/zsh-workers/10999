From zsh-workers-return-10999-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Apr 28 09:24:17 2000
Return-Path: <zsh-workers-return-10999-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26638 invoked from network); 28 Apr 2000 09:24:15 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 28 Apr 2000 09:24:15 -0000
Received: (qmail 6551 invoked by alias); 28 Apr 2000 09:23:37 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10999
Received: (qmail 6503 invoked from network); 28 Apr 2000 09:23:32 -0000
Date: Fri, 28 Apr 2000 10:21:55 +0100
From: Peter Stephenson <pws@cambridgesiliconradio.com>
Subject: Re: compinstall and non-default file
In-reply-to: "Your message of Fri, 28 Apr 2000 12:26:16 +0400."
 <000201bfb0eb$6c3b9330$21c9ca95@mow.siemens.ru>
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Message-id: <0FTP00F9WZCJ5M@la-la.cambridgesiliconradio.com>
Content-transfer-encoding: 7BIT

> With the following file generated by compinstall it cannot find it's
> definition. I'd expected it to parse the file.

Yes, this was just plain stupidity.  Even if it had registered that you'd
edited it, it would have tried to search the name before you edited it.
I've put in a test that the file you give does have definitions in it.

Index: Completion/Core/compinstall
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Core/compinstall,v
retrieving revision 1.8
diff -u -r1.8 compinstall
--- Completion/Core/compinstall	2000/04/27 20:44:48	1.8
+++ Completion/Core/compinstall	2000/04/28 09:20:03
@@ -69,9 +69,19 @@
 file where these can be found.  Note that this will only work if they
 are exactly the form in which compinstall inserted them.  If you leave
 the line as it is, or empty, I won't search."
-  vared -ch -p 'file> ' newifile
-  [[ -z $newifile || $ifile = $newifile ]] && foundold=false
+  while true;  do
+    vared -ch -p 'file> ' newifile
+    if [[ -n $newifile && $ifile != $newifile ]]; then
+      if __ci_test_ifile $newifile; then
+        foundold=true
+	break
+      fi
+      print "I couldn't find any definitions there.  Edit a new filename, or
+leave the line blank to ignore it."
+    fi
+  done
 fi
+ifile=$newifile
 
 if [[ $foundold = true ]]; then
   sed -n "/^[   ]*$startline/,/^[       ]*$endline/p" $ifile |


-- 
Peter Stephenson <pws@cambridgesiliconradio.com>
Cambridge Silicon Radio, Unit 300, Science Park, Milton Road,
Cambridge, CB4 0XL, UK                          Tel: +44 (0)1223 392070

