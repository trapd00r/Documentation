From zsh-users-return-3008-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Apr 07 11:52:52 2000
Return-Path: <zsh-users-return-3008-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16785 invoked from network); 7 Apr 2000 11:52:51 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 7 Apr 2000 11:52:51 -0000
Received: (qmail 12800 invoked by alias); 7 Apr 2000 11:51:25 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 3008
Received: (qmail 12788 invoked from network); 7 Apr 2000 11:51:24 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer goliath.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "Francis GALIEGUE" <francis@mandrakesoft.com>, <zsh-users@sunsite.auc.dk>
Subject: RE: RPM completion in dev19 and a suggested change to make completion
Date: Fri, 7 Apr 2000 15:51:15 +0400
Message-ID: <000b01bfa087$93ff6280$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="koi8-r"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
In-Reply-To: <m3pus2p38s.fsf@toy.mandrakesoft.com>
Importance: Normal
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2919.6700

>
>   [[ -n "$file" ]] && _wanted targets expl 'make target' &&
>       compadd "$expl[@]" - \
> 		$(make -f $file -p aaaaa 2>&1 | awk -F:
> '/^[a-zA-Z0-9][^\/ \t]+:/ {print $1}' | grep -v aaaaa) && ret=0
>
> # This is the old code
> #          $(awk '/^[a-zA-Z0-9][^\/ \t]+:/ {print $1}
> # 	      /^\.include  *<bsd\.port\.(subdir\.|pre\.)?mk>/
> || /^\.include  *".*mk\/bsd\.pkg\.(subdir\.)?mk"/ {
> # 	        print "fetch fetch-list extract patch configure
> build install reinstall deinstall package describe checkpatch
> checksum makesum" }' \
> # 	     FS=: $file) && ret=0
>   (( ret )) && { compset -P 1 '*='; _files }
> fi
> --------
>
> With this, for example, make <TAB> in the kernel sources "sees" target
> bzImage while it doesn't see it in the original version. Comments?
>


At least, check if it is GNU make or not. In my case:

bor@itsrm2% make -p dkfksjkfl |& grep modules
uninstall.modules:
uninstall: uninstall.bin  uninstall.modules  uninstall.man
uninstall.fns
.SUFFIXES:install.modules:
install: install.bin  install.modules  install.man  install.fns
bor@itsrm2% gmake -p dkfksjkfl |& grep modules
uninstall.modules:
install.modules:
uninstall: uninstall.bin uninstall.modules uninstall.man uninstall.fns
install: install.bin install.modules install.man install.fns

As you see, GNU make lists install.modules as target but native make
does not.

And what happens, if it does have "aaaaa" target? :-)

-andrej

