From zsh-workers-return-10825-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Apr 19 09:27:00 2000
Return-Path: <zsh-workers-return-10825-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1143 invoked from network); 19 Apr 2000 09:26:58 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 19 Apr 2000 09:26:58 -0000
Received: (qmail 1373 invoked by alias); 19 Apr 2000 09:26:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10825
Received: (qmail 1362 invoked from network); 19 Apr 2000 09:26:36 -0000
Date: Wed, 19 Apr 2000 11:26:30 +0200 (MET DST)
Message-Id: <200004190926.LAA21931@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Peter Stephenson's message of Wed, 19 Apr 2000 10:19:59 +0100
Subject: Re: bindkey bug with zsh-3.1.6-dev-21?


Peter Stephenson wrote:

> > Ick. The problem is that in autoload_zleread() we do:
> > 
> >     if (load_module("zsh/zle"))
> > 	load_module("zsh/compctl");
> > 
> > i.e., we attempt to load compctl only if loading zle succeeds. For
> > people who have a call to `bindkey' in their .z*, the zle module will
> > already be loaded, re-loading fails and compctl is not loaded. Bummer.
> > 
> > Can anyone think of a solution for this? I can't (apart from trying to 
> > load compctl unconditionally, which I don't like).
> 
> Couldn't we also check whether ((trashzleptr == noop_function))?  If it is,
> zle isn't loaded, and if it isn't, zle must be loaded or something very
> weird has happened.  zlereadptr is even declared in both branches of the
> #ifdef just above.

Right, but what I would like to avoid is to load compctl whenever zle
is loaded. Otherwise anyone using the new completion system (which
loads zle indirectly) will have ol' compctl hanging around. And
_default will then try compctl's etc.

Hm, maybe a test of the form

  if (load(zle) || !loaded(complete)) load(compctl);

There's find_module() for that kind of test.

Does that sound sensible?

Bye
 Sven


--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

