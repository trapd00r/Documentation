From zsh-workers-return-12157-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Jul 04 08:29:28 2000
Return-Path: <zsh-workers-return-12157-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9362 invoked from network); 4 Jul 2000 08:29:27 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 4 Jul 2000 08:29:27 -0000
Received: (qmail 7907 invoked by alias); 4 Jul 2000 08:29:20 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12157
Received: (qmail 7900 invoked from network); 4 Jul 2000 08:29:20 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer david.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "Bart Schaefer" <schaefer@candle.brasslantern.com>,
   <zsh-workers@sunsite.auc.dk>
Subject: Test hanger disappeared, but ... RE: PATCH: Fix ZDOTDIR during "make check" for static builds
Date: Tue, 4 Jul 2000 12:29:15 +0400
Message-ID: <000401bfe591$f057fca0$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
In-Reply-To: <1000703183402.ZM2822@candle.brasslantern.com>
Importance: Normal
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2919.6700


>
> When I made my earlier patch for this (12039), I forgot that
> Test/Modules
> doesn't get created when the build is static.
>
> This points ZDOTDIR into the Test directory itself (in the
> build tree, if
> that's separate from the source), and therefore also has to
> make sure that
> the .zcompdump file is removed at the end.
>

May be, it is something different - but now completion tests do not hang
anymore. I run them on Unix without any problems; but on Cygwin I get
misterious errors:

mw1g017@MW1G17C:/usr/build/zsh/Test% /usr/build/zsh/Src/zsh -f
/usr/src/zsh/Test
/ztst.zsh /usr/src/zsh/Test/53completion.ztst
*** /tmp/zsh.ztst.out.1007      Tue Jul  4 12:24:39 2000
--- /tmp/zsh.ztst.tout.1007     Tue Jul  4 12:24:49 2000
***************
*** 1,12 ****
- line: {: }{}
  DESCRIPTION:{file}
  DI:{dir1}
  DI:{dir2}
  FI:{file1}
  FI:{file2}
- line: {: dir1/}{}
- line: {: dir2/}{}
- line: {: file1}{}
- line: {: file2}{}
- line: {: dir1/}{}
- line: {: dir2/}{}
--- 1,5 ----
Test /usr/src/zsh/Test/53completion.ztst failed: output differs from
expected as
 shown above for:
  comptest $': \t\t\t\t\t\t\t'
Was testing: directories and files
/usr/src/zsh/Test/53completion.ztst: test failed.
rm: /usr/build/zsh/Test/comp.tmp: Permission denied
mw1g017@MW1G17C:/usr/build/zsh/Test% print $CYGWIN
title strip_title tty

I thought, it may have something to do with CYGWIN setting (tty/notty) -
but the error happens with both settings.

The "permission denied" message most probably comes, because some child
has comp.tmp open at the time comptest tries to delete it.

It all smells much like some tty emulation problem. Sigh.

-andrej

