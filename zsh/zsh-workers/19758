From zsh-workers-return-19758-mason-zsh=primenet.com.au@sunsite.dk Mon Apr 12 13:47:10 2004
Return-Path: <zsh-workers-return-19758-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13848 invoked from network); 12 Apr 2004 13:47:09 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 12 Apr 2004 13:47:09 -0000
Received: (qmail 24602 invoked by alias); 12 Apr 2004 13:46:58 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19758
Received: (qmail 24456 invoked from network); 12 Apr 2004 13:46:57 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 12 Apr 2004 13:46:56 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [130.225.247.86] by sunsite.dk (MessageWall 1.0.8) with SMTP; 12 Apr 2004 13:46:56 -0000
Received: (qmail 4714 invoked from network); 12 Apr 2004 13:46:56 -0000
Received: from d2d7a.d.pppool.de (HELO athlon) (80.184.45.122)
  by a.mx.sunsite.dk with SMTP; 12 Apr 2004 13:46:53 -0000
Received: from opk by athlon with esmtp (masqmail 0.2.20) id
 1BD1yu-0It-00 for <zsh-workers@sunsite.dk>; Mon, 12 Apr 2004 16:00:12
 +0200
In-reply-to: <1040410174430.ZM10891@candle.brasslantern.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <1040410174430.ZM10891@candle.brasslantern.com>
To: zsh-workers@sunsite.dk
Subject: Re: Compsys and KSH_AUTOLOAD 
Date: Mon, 12 Apr 2004 16:00:12 +0200
Message-ID: <1170.1081778412@athlon>
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: ****
X-Spam-Status: No, hits=4.0 required=6.0 tests=RCVD_IN_DYNABLOCK,
	RCVD_IN_SORBS autolearn=no version=2.63
X-Spam-Hits: 4.0

Bart wrote:
> I've been having an off-list discussion with Matthias Kopfermann about
> trouble he's had using the completion system with KSH_AUTOLOAD set.  He
> tried the "zcompile -z" stuff (actually the zrecompile loop) suggested
> in the manual, but it didn't work for him (I haven't investigated that

It is only for compinit itself that I can get problems with that to
occur. It seems to be a little sensitive about the contents of $fpath
but the following works for me: 

  zcompile -z -U comp /usr/local/share/zsh/4.2.0/functions/Completion/**/*(.)
  zsh -f
  fpath=( ~/comp.zwc $fpath )
  setopt kshautoload
  autoload compinit
  compinit

compinit ought to be able to look inside the .zwc file so you don't
even need the functions to be there.

> So I tried this:
> 
> #--- 8< --- snip ---
> autoload +X -z compinit _main_complete _complete_help _complete_debug \
> 	_expand_alias _bash_completions _history_complete_word _next_tags
> compinit				# Append your usual options
> _comp_options+=(NO_kshautoload)		# Need 4.2.x for += to work
> #--- 8< --- snip ---

> (1) Does this deserve a FAQ entry, or perhaps even a change to the
> compsys documentation?  I guess ksh_autoload isn't a very "frequently"

It'd be better if we can get it to just work.

> (2) Should we change _comp_options to always include NO_kshautoload?

I'd prefer if we can avoid adding to _comp_options.

> (3) Should we change compinit to run the autoload +X -z of the entry
> points iff kshautoload is set?

This is one option and if we took it, we'd want to go with (4) so
user's can add their own entry point functions. It is just adding more
complexity though. Also, looking at the list of entry points, there are
functions I never use, making autoload +X a waste of time and memory.

Is there any reason why the -z and -k options to autoload can only be
used with +X. It would seem to me that the best would be if compinit
could use `autoload -U -z' with functions being setup to look like this:

  _autoload () {
          # undefined
          builtin autoload -XUz
  }

Would that be a possibilty?

Oliver

