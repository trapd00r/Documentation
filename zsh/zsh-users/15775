From zsh-users-return-15775-mason-zsh=primenet.com.au@zsh.org Sun Feb 06 01:38:19 2011
Return-Path: <zsh-users-return-15775-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26516 invoked by alias); 6 Feb 2011 01:38:19 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15775
Received: (qmail 18982 invoked from network); 6 Feb 2011 01:38:17 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_NONE
	autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at closedmail.com does not designate permitted sender hosts)
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <110205173806.ZM26740@torch.brasslantern.com>
Date: Sat, 05 Feb 2011 17:38:05 -0800
In-reply-to: <87fws29gvs.fsf@old-tantale.fifi.org>
Comments: In reply to Philippe Troin <phil@fifi.org>
 "Re: Printing ^C, ^D key presses at end of prompt when pressed" (Feb  5,
 3:54pm)
References: <AANLkTike3e1M6NUSA=YoFOsyRhmumkgDvo=H+pdc64FC@mail.gmail.com>
	<110203202058.ZM22332@torch.brasslantern.com>
	<87r5bo9kws.fsf@old-tantale.fifi.org>
	<110204072515.ZM23328@torch.brasslantern.com>
	<87fws29gvs.fsf@old-tantale.fifi.org>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: zsh-users@zsh.org
Subject: Re: Printing ^C, ^D key presses at end of prompt when pressed
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii

On Feb 5,  3:54pm, Philippe Troin wrote:
} Subject: Re: Printing ^C, ^D key presses at end of prompt when pressed
}
} > Maybe there's yet another stty option getting involved here?  Even with
} > bash3 I don't see the ^C when I interrupt cat.
} 
} It could be.  These are my full stty settings:

Mine are identical except -
- my stty does not support "swtch" or "iutf8" (CentOS4)
- I have -hupcl -brkint -imaxbel, the reverse of yours.

However, changing any of those has no different effect.

} I assume you do NOT have ttyctl is frozen mode:
 
I do have it frozen, but that only affects what happens to the settings
after the shell gets control back from an external command.

}  1. Ctrl-C is pressed on the terminal
} 
}  2. Kernel tty layer sees it is the stty intr character, emits the ^C
}     string to the tty, and send SIGINT to the foreground process group
}     which would be zsh.
} 
}  3. Zsh catches SIGINT, then clears the line (that's where ^C would
}     disappear), and redisplays the prompt.

I don't think that can be it, because you can easily see that zsh does
not clear the line.  Type some characters, back up into the middle of
them, and then hit ^C; the stuff to the right of the cursor remains.

} (I was not aware of the STTY special environment variable).
} I think CentOS5's handling of tostop seems is broken or missing.

Do you mean tostop or ctlecho?

schaefer<511> stty tostop
schaefer<512> (echo foo) &
[1] 26738
[1]  + suspended (tty output)  ( echo foo; )

