From zsh-workers-return-25270-mason-zsh=primenet.com.au@sunsite.dk Mon Jul 07 08:36:43 2008
Return-Path: <zsh-workers-return-25270-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4445 invoked from network); 7 Jul 2008 08:36:40 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 7 Jul 2008 08:36:40 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 26261 invoked from network); 7 Jul 2008 08:36:32 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 Jul 2008 08:36:32 -0000
Received: (qmail 17449 invoked by alias); 7 Jul 2008 08:36:28 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25270
Received: (qmail 17435 invoked from network); 7 Jul 2008 08:36:27 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 7 Jul 2008 08:36:27 -0000
Received: from wf-out-1314.google.com (wf-out-1314.google.com [209.85.200.174])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 9088380524FA
	for <zsh-workers@sunsite.dk>; Mon,  7 Jul 2008 10:36:15 +0200 (CEST)
Received: by wf-out-1314.google.com with SMTP id 23so2303286wfg.3
        for <zsh-workers@sunsite.dk>; Mon, 07 Jul 2008 01:36:14 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from:to
         :subject:mime-version:content-type:content-transfer-encoding
         :content-disposition;
        bh=teqi+bem1yMdMgc+dJQ+bh/uVV0lGZZVXxYI1PGPjAk=;
        b=s4sZdutLblexF+/tWnboDZW4KwhMYTdfGZvFM9n0WqCTL9rr5kvvP6PnLn5GVb1D4j
         7rQa2KywCkzMvaTkrFSz5ek1LdKPnTw/vOMb4feE//qWv6kV9Pk8WgpFkcKfQC7LSvEE
         Sp7M+fGsWLA9ROgSUjz6WNLNnnnKCKIBOAJ4o=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:to:subject:mime-version:content-type
         :content-transfer-encoding:content-disposition;
        b=ucY+vnzXCna5ENaoTP233jE9D3cAXuhWSOI2xbzwYjl8YECELIJH+tUXg92Y79XN62
         VI5L/+LJwEA4EiOgP5kk3K0zRECM0L8UY7/qAZml3unNEBSaKNpOGi3ko/lYRWENPV1i
         hUoyp4JInMVa3+w+ox1cjYsTOCNFjDFZBmf8Y=
Received: by 10.142.154.20 with SMTP id b20mr1193102wfe.99.1215419774026;
        Mon, 07 Jul 2008 01:36:14 -0700 (PDT)
Received: by 10.142.148.1 with HTTP; Mon, 7 Jul 2008 01:36:14 -0700 (PDT)
Message-ID: <17393e3e0807070136t701b2b62u94001c211697697c@mail.gmail.com>
Date: Mon, 7 Jul 2008 04:36:14 -0400
From: "Matt Wozniski" <godlygeek@gmail.com>
To: zsh-workers@sunsite.dk
Subject: Debian _deb_packages_update_uninstalled() doesn't use cache?
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
X-Virus-Scanned: ClamAV 0.92.1/7649/Mon Jul  7 06:27:10 2008 on bifrost
X-Virus-Status: Clean

As the subject indicates, this is a problem I have with a Debian
specific completer, but, since it's in CVS, I figured this is the
right place to ask... Let me know if I'm wrong.

Anyway, if I'm reading these functions right, then
_deb_packages_update_avail() and _deb_packages_update_installed() use
the cache, but _deb_packages_update_uninstalled() doesn't - even
though depends upon the cached data of _update_avail() and
_update_installed().  _update_uninstalled() seems to just be filtering
out the available packages (as found by _update_avail()) that are also
installed (as found by _update_installed()) so that they aren't
suggested as possible packages to install.  It seems to me that we're
not caching the operation that's most time consuming, even though it's
outcome is based entirely upon two operations whose outcomes are
cached.  As a result, completion for "aptitude install" (which uses
"_deb_packages uninstalled") is much slower than for "apt-get install"
(which uses "_deb_packages available") on my machine, at least for the
first completion in a newly opened shell.

Anyone have any insight to why _deb_packages_update_uninstalled()
might be doing this, or is this a bug?

~Matt

