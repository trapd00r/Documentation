From zsh-users-return-4329-mason-zsh=primenet.com.au@sunsite.dk Wed Oct 03 16:48:50 2001
Return-Path: <zsh-users-return-4329-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13732 invoked from network); 3 Oct 2001 16:48:49 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 3 Oct 2001 16:48:49 -0000
Received: (qmail 2897 invoked by alias); 3 Oct 2001 16:48:30 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4329
Received: (qmail 2883 invoked from network); 3 Oct 2001 16:48:29 -0000
X-Authentication-Warning: greux.loria.fr: lefevre set sender to vincent@vinc17.org using -f
Date: Wed, 3 Oct 2001 18:47:55 +0200
From: Vincent Lefevre <vincent@vinc17.org>
To: zsh-users@sunsite.dk
Subject: Re: get the number of active jobs to show in the prompt?
Message-ID: <20011003184755.A1397@greux.loria.fr>
Mail-Followup-To: zsh-users@sunsite.dk
References: <20011002181324.A29201@greux.loria.fr> <200110022325.JAA07306@bruce.csse.monash.edu.au> <4ac3633923vincent@vinc17.org> <1011003054350.ZM25561@candle.brasslantern.com> <20011003162246.C32766@greux.loria.fr> <1011003151104.ZM26311@candle.brasslantern.com> <20011003173500.A1255@greux.loria.fr> <1011003155807.ZM26499@candle.brasslantern.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <1011003155807.ZM26499@candle.brasslantern.com>
User-Agent: Mutt/1.3.22.1i
X-Mailer-Info: http://www.vinc17.org/mutt_eng.html

On Wed, Oct 03, 2001 at 15:58:06 +0000, Bart Schaefer wrote:
> If notify isn't involved, precmd is already sufficient.

Well, I've always had notify and I do want it.

> If notify is involved, then the fact that the prompt could change
> length and that the current "prompt level" could need to change from
> PS2 or deeper back to PS1, leads to all the objections that have
> been raised.

In my case, the length isn't changed. So, this is not my problem.

> } How can I do that (to rebuild the prompt when clear-screen is called)?
> 
> Basically the same way I did it in push-line-at-random:
> 
>     function redraw-prompt {
> 	local nested=${(%):-%_}
> 	# zle .clear-screen	# You may or may not want this

I want this, so I uncommented it.

> 	if [[ -n $nested ]]
> 	then
> 	    zle .push-line-or-edit
> 	else
> 	    zle .push-input
> 	    zle .send-break	# Force new prompt; sorry about beeping
> 	fi
>     }
>     # Pick one:
>     # zle -N clear-screen redraw-prompt
>     # zle -N redraw-prompt; bindkey '^L' redraw-prompt

This doesn't work: the screen is cleared, but then, the prompt is
printed twice. Replacing "zle .clear-screen" by "clear" almost works.
The problem is that push-line seems to send a \n.

-- 
Vincent Lefèvre <vincent@vinc17.org> - Web: <http://www.vinc17.org/> - 100%
validated HTML - Acorn Risc PC, Yellow Pig 17, Championnat International des
Jeux Mathématiques et Logiques, TETRHEX, etc.
Work: CR INRIA - computer arithmetic / SPACES project at LORIA

