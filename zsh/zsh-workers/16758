From zsh-workers-return-16758-mason-zsh=primenet.com.au@sunsite.dk Mon Mar 04 15:19:30 2002
Return-Path: <zsh-workers-return-16758-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23012 invoked from network); 4 Mar 2002 15:19:29 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 4 Mar 2002 15:19:29 -0000
Received: (qmail 1573 invoked by alias); 4 Mar 2002 15:19:24 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16758
Received: (qmail 1558 invoked from network); 4 Mar 2002 15:19:23 -0000
From: Borsenkow Andrej <Andrej.Borsenkow@mow.siemens.ru>
To: "'Eric Norum'" <eric.norum@usask.ca>, zsh-workers@sunsite.dk
Subject: RE: zsh breaks configure scripts
Date: Mon, 4 Mar 2002 18:19:31 +0300
Message-ID: <007e01c1c38f$fc0c9ff0$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook, Build 10.0.3416
x-mimeole: Produced By Microsoft MimeOLE V6.00.2600.0000
In-Reply-To: <5CD7CBD8-2F7F-11D6-9666-00039366A118@usask.ca>
Importance: Normal

> 
> Apple uses zsh as /bin/sh on Mac OS X.  Unfortunately zsh has a
> `feature' that breaks many autoconf configure scripts.  The scripts
> contain lines like:
> if test "`CDPATH=:; cd $srcdir && pwd`" != "`pwd`" && .......
> 
> The problem is that the zsh cd command insists on printing the
directory!
> 
> The offending code is in cd_new_pwd() in Src/builtins.c around line
1047:
>     if (unset(PUSHDSILENT) && func != BIN_CD && isset(INTERACTIVE))
>          printdirstack();
>      else if (doprintdir) {
>          fprintdir(pwd, stdout);
>          putchar('\n');
>      }
> 
> I suggest that the fprintdir/putchar be called only in interactive
> shells:
>     if (unset(PUSHDSILENT) && func != BIN_CD && isset(INTERACTIVE))
>          printdirstack();
>      else if (doprintdir && isset(INTERACTIVE)) {
>          fprintdir(pwd, stdout);
>          putchar('\n');
>      }
> 

Looking at different shells here:

sh does not print anything at all

ksh and bash do not print anything is we cd relative to empty CDPATH
element (the best I can explain it):

bor@itsrm2% ksh 
$ cd
$ CDPATH=:; cd tmp
$ cd
$ CDPATH=.:/tmp; cd tmp
/home/bor/tmp
$ cd
$ CDPATH=:/tmp;cd tmp
$ cd
$ CDPATH=/tmp:; cd tmp
$ exit

May be we should just follow the suite?

-andrej

