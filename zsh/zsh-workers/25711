From zsh-workers-return-25711-mason-zsh=primenet.com.au@sunsite.dk Mon Sep 22 14:26:52 2008
Return-Path: <zsh-workers-return-25711-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20004 invoked from network); 22 Sep 2008 14:26:49 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 22 Sep 2008 14:26:49 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 91207 invoked from network); 22 Sep 2008 14:26:42 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 22 Sep 2008 14:26:42 -0000
Received: (qmail 5999 invoked by alias); 22 Sep 2008 14:26:37 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25711
Received: (qmail 5989 invoked from network); 22 Sep 2008 14:26:36 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 22 Sep 2008 14:26:36 -0000
Received: from cluster-d.mailcontrol.com (cluster-d.mailcontrol.com [217.69.20.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 853678058BD5
	for <zsh-workers@sunsite.dk>; Mon, 22 Sep 2008 16:26:25 +0200 (CEST)
Received: from rly14d.srv.mailcontrol.com (localhost.localdomain [127.0.0.1])
	by rly14d.srv.mailcontrol.com (MailControl) with ESMTP id m8MEQNfc002745
	for <zsh-workers@sunsite.dk>; Mon, 22 Sep 2008 15:26:23 +0100
Received: from submission.mailcontrol.com (submission.mailcontrol.com [86.111.216.190])
	by rly14d.srv.mailcontrol.com (MailControl) id m8MEPqPU032306
	for zsh-workers@sunsite.dk; Mon, 22 Sep 2008 15:25:52 +0100
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly14d-eth0.srv.mailcontrol.com (envelope-sender Peter.Stephenson@csr.com) (MIMEDefang) with ESMTP id m8MEPo5e032053; Mon, 22 Sep 2008 15:25:51 +0100 (BST)
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Mon, 22 Sep 2008 15:25:43 +0100
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.2/8.13.4) with ESMTP id m8MEPcbq015196;
	Mon, 22 Sep 2008 15:25:38 +0100
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.2/8.14.2/Submit) with ESMTP id m8MEPcWg015191;
	Mon, 22 Sep 2008 15:25:38 +0100
Message-Id: <200809221425.m8MEPcWg015191@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: "Rocky Bernstein" <rocky.bernstein@gmail.com>
cc: "Zsh hackers list" <zsh-workers@sunsite.dk>
Subject: Re: fc (history) requires zsh is interactive? Why can't interactive toggled?
In-reply-to: <6cd6de210809220658x26698b78ga08f95eaa42644c@mail.gmail.com>
References: <6cd6de210809211737o564e47a4jf7f92ada4cd970dc@mail.gmail.com> <20080922130602.4746e4d1@news01> <6cd6de210809220658x26698b78ga08f95eaa42644c@mail.gmail.com>
Comments: In-reply-to "Rocky Bernstein" <rocky.bernstein@gmail.com>
   message dated "Mon, 22 Sep 2008 09:58:51 -0400."
Date: Mon, 22 Sep 2008 15:25:38 +0100
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 22 Sep 2008 14:25:43.0711 (UTC) FILETIME=[18CBCAF0:01C91CBF]
X-Scanned-By: MailControl A-08-50-14 (www.mailcontrol.com) on 10.68.1.124
X-Virus-Scanned: ClamAV 0.92.1/8307/Mon Sep 22 07:05:57 2008 on bifrost
X-Virus-Status: Clean

"Rocky Bernstein" wrote:
> > So "fc -l"
> > hasn't been very useful and the error message tends to be more helpful than
> > simply doing nothing because you're in a non-interactive shell with, the
> > vast majority of the time, no history.
> 
> The problem is that an error message which prevents functioning of a
> command should only be given when there *is* an error, not in
> anticipation of a situation which sometimes is an error.

Granted that's a perfectly good general rule, but it's not, in this
case, the "real" problem, which, as I've said many times, is that we
simply don't have anything remotely like the effort to implement all
these entirely reasonable things, never did, and probably never shall.
Many errors are simply there because the general case was much more
difficult than making it work the vast majority of the time.

>> There's no basic reason why it
>> shouldn't work if history works elsewhere.
>
>> Could this be changed please?

As you appear to have some test cases, could you please try removing the
lines in builtin.c:bin_fc() that say

    /* fc is only permitted in interactive shells */
    if (!interact) {
	zwarnnam(nam, "not interactive shell");
	return 1;
    }

and seeing what happens?  I suspect some options really don't work in
this case, but without trying it's hard to tell what they are.  If we're
lucky, it may just be we need to catch a few extra test case lower down
like the one you picked up in up_histent().  Otherwise, it'll have to go
on the queue of things I might get around to one day.

Thanks.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

