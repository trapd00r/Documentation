From zsh-workers-return-8022-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Sep 23 09:47:39 1999
Return-Path: <zsh-workers-return-8022-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 805 invoked from network); 23 Sep 1999 09:47:38 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 23 Sep 1999 09:47:38 -0000
Received: (qmail 13259 invoked by alias); 23 Sep 1999 09:47:32 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8022
Received: (qmail 13252 invoked from network); 23 Sep 1999 09:47:28 -0000
Message-Id: <9909230911.AA28501@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk
Subject: Re: delete-to-char 
In-Reply-To: "Peter Stephenson"'s message of "Thu, 23 Sep 1999 11:00:33 DFT."
             <9909230900.AA26426@ibmth.df.unipi.it> 
Date: Thu, 23 Sep 1999 11:11:48 +0200
From: Peter Stephenson <pws@ibmth.df.unipi.it>

Peter Stephenson wrote:
> Vin Shelton wrote:
> > In the
> > course of testing this, I found that M-digit did not work for me with
> > bindkey -me, even though bindkey thinks they are bound to
> > digit-argument.  M-anydigit just beeps.  "od -x" tells me that M-0
> > sends 0xb0, M-1 sends 0xb1, etc.  Do I have my xterm/stty settings
> > wrong, or is this a bug in zsh.
> 
> The other meta things, like M-x, work, right?  I'm having the same problem.
> I thought it was just my terminal, but maybe it's zsh.  If I type M-1 it
> just beeps, but if I type `bindkey "', then a quoted M-1, then `"<RETURN>',
> it says
> "\M-1" digit-argument
> so something a little weird is happening.

Guess who generated this bug?  Bart complained that non-digits were doing
weird things when attached to digit-argument, so I `fixed' it.  This
restores handling of metafied as well as normal digits.

--- Src/Zle/zle_misc.c.dig	Wed Jul  7 09:32:06 1999
+++ Src/Zle/zle_misc.c	Thu Sep 23 11:08:46 1999
@@ -458,7 +458,8 @@
 {
     int sign = (zmult < 0) ? -1 : 1;
 
-    if (c < '0' || c > '9')
+    /* allow metafied as well as ordinary digits */
+    if ((c & 0x7f) < '0' || (c & 0x7f) > '9')
 	return 1;
 
     if (!(zmod.flags & MOD_TMULT))

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

