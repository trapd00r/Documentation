From zsh-workers-return-20535-mason-zsh=primenet.com.au@sunsite.dk Sun Oct 31 04:01:52 2004
Return-Path: <zsh-workers-return-20535-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19268 invoked from network); 31 Oct 2004 04:01:51 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 31 Oct 2004 04:01:51 -0000
Received: (qmail 93638 invoked from network); 31 Oct 2004 04:01:45 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 31 Oct 2004 04:01:45 -0000
Received: (qmail 26237 invoked by alias); 31 Oct 2004 04:01:31 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20535
Received: (qmail 26223 invoked from network); 31 Oct 2004 04:01:30 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 31 Oct 2004 04:01:30 -0000
Received: (qmail 93288 invoked from network); 31 Oct 2004 04:01:30 -0000
Received: from moonbase.zanshin.com (64.84.47.139)
  by a.mx.sunsite.dk with SMTP; 31 Oct 2004 04:01:28 -0000
Received: from toltec.zanshin.com (toltec.zanshin.com [64.84.47.166])
	by moonbase.zanshin.com (8.13.1/8.13.1) with ESMTP id i9V41QqW011328
	for <zsh-workers@sunsite.dk>; Sat, 30 Oct 2004 21:01:26 -0700
Date: Sat, 30 Oct 2004 21:01:26 -0700 (PDT)
From: Bart Schaefer <schaefer@brasslantern.com>
Reply-To: zsh-workers@sunsite.dk
To: zsh-workers@sunsite.dk
Subject: A parsing bug that has been around for ... years? decades?
Message-ID: <Pine.LNX.4.61.0410302017050.21138@toltec.zanshin.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

Consider:

zagzig% a=( 1 2 3 4 5 )
zagzig% noglob print x=( $^a )
x=( 1 ) x=( 2 ) x=( 3 ) x=( 4 ) x=( 5 )

There are spaces around $^a, so one (or perhaps both) of the following 
should have happened:

1. 'x=(' and ')' should have been separate words, and RC_EXPAND_PARAM 
   should have had no effect at all, yielding "x=( 1 2 3 4 5 )".

2. a parse error should have occurred on the closing paren.

What apparently did happen, but IMO should not have, is that everything
in the parens was swallowed up as glob qualifiers, but then the glob was
not performed.

Consider further:

zagzig% setopt correct
zagzig% fOo() { : }
zagzig% foo
zsh: correct 'foo' to 'fOo' [nyae]? a
zagzig% noglob foo
zsh: command not found: foo

Surely noglob is not supposed to subsume the function of nocorrect?  Not
even "setopt correctall" is effective there.

The fix for both of these would appear to be that parse.c:par_simple() has 
to actually recognize noglob as a token, the way it does nocorrect, so 
that the "command position" context can be preserved for the following
word, and so that parsing of glob qualifiers can be disabled for the rest
of the command.

However, I imagine the latter would break something somewhere, so perhaps
that part should merely be better addressed in the documentation.

