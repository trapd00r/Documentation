From zsh-workers-request@math.gatech.edu Mon Jun 22 06:54:36 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20597 invoked from network); 22 Jun 1998 06:54:34 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 22 Jun 1998 06:54:34 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id CAA04710;
	Mon, 22 Jun 1998 02:44:20 -0400 (EDT)
Resent-Date: Mon, 22 Jun 1998 02:44:20 -0400 (EDT)
Date: Mon, 22 Jun 1998 08:45:04 +0200 (MET DST)
Message-Id: <199806220645.IAA08265@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@math.gatech.edu
In-reply-to: "Bart Schaefer"'s message of Fri, 19 Jun 1998 11:14:59 -0700
Subject: PATCH: for Re:  REC_EXACT and AUTO_MENU, and compctl -U too
Resent-Message-ID: <"lfJwX3.0.X91.3rVZr"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4140
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu


Bart Schaefer wrote:

>
> ...
> 
> While I'm on the subject of mildly stupid completion behavior, automenu
> in conjunction with compctl -U could do with a bit of work.  It'd be a
> lot more useful if menu completion kicked in immediately when compctl -U
> returns multiple matches and automenu is set.  Otherwise you lose both
> the set of completions and the nonunique suffix as soon as the first TAB
> is pressed.
> 

Sounds very reasonable. And if we want to do it in the drastic way you
described, the patch is pretty simple.

Bye
 Sven

*** Src/Zle/zle_tricky.c.old	Mon Jun 22 08:23:18 1998
--- Src/Zle/zle_tricky.c	Mon Jun 22 08:26:36 1998
***************
*** 2246,2252 ****
  {
      Compctl cc = NULL;
      int oloffs = offs, owe = we, owb = wb, ocs = cs, oll = ll, isf = 1;
!     int t, sf1, sf2, ooffs;
      char *p, *sd = NULL, *tt, *s1, *s2, *os = NULL;
      unsigned char *ol = NULL;
  
--- 2246,2252 ----
  {
      Compctl cc = NULL;
      int oloffs = offs, owe = we, owb = wb, ocs = cs, oll = ll, isf = 1;
!     int t, sf1, sf2, ooffs, um = usemenu;
      char *p, *sd = NULL, *tt, *s1, *s2, *os = NULL;
      unsigned char *ol = NULL;
  
***************
*** 2266,2271 ****
--- 2266,2272 ----
      if (unset(COMPLETEINWORD) && cs != we)
  	cs = we, offs = strlen(s);
  
+     usemenu = um;
      ispattern = haswhat = lastambig = 0;
      patcomp = filecomp = NULL;
      menucur = NULL;
***************
*** 2413,2418 ****
--- 2414,2420 ----
  	*delit = 1;
  	*s = '\0';
  	offs = 0;
+ 	if (isset(AUTOMENU)) usemenu = 1;
      } else
  	*delit = 0;
*** Doc/Zsh/compctl.yo.old	Mon Jun 22 08:36:59 1998
--- Doc/Zsh/compctl.yo	Mon Jun 22 08:42:43 1998
***************
*** 353,359 ****
  tt(-K) option) which can examine the word components passed to it
  (or via the tt(read) builtin's tt(-c) and tt(-l) flags) and
  use its own criteria to decide what matches.  If there is no
! completion, the original word is retained.
  )
  item(tt(-y) var(func-or-var))(
  The list provided by var(func-or-var) is displayed instead of the list
--- 353,362 ----
  tt(-K) option) which can examine the word components passed to it
  (or via the tt(read) builtin's tt(-c) and tt(-l) flags) and
  use its own criteria to decide what matches.  If there is no
! completion, the original word is retained.  Since the produced 
! possible completions seldom seldom have interesting common prefixes
! and suffixes, menucompletion is started immediatly if tt(AUTO_MENU) is
! set and this flag is used.
  )
  item(tt(-y) var(func-or-var))(
  The list provided by var(func-or-var) is displayed instead of the list
  


--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

