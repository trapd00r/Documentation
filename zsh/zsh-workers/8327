From zsh-workers-return-8327-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Oct 19 05:18:18 1999
Return-Path: <zsh-workers-return-8327-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5454 invoked from network); 19 Oct 1999 05:18:13 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 19 Oct 1999 05:18:13 -0000
Received: (qmail 16079 invoked by alias); 19 Oct 1999 05:17:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8327
Received: (qmail 16072 invoked from network); 19 Oct 1999 05:17:49 -0000
From: Albert Chin-A-Young <china@thewrittenword.com>
Date: Tue, 19 Oct 1999 00:15:45 -0500
To: zsh-workers@math.gatech.edu
Subject: (3.0.7) compilation under IRIX 6.5, cached_uid multiply defined
Message-ID: <19991019001544.A117092@sunday.thewrittenword.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 0.95.6i

Below needed for IRIX 6.5. I would update Doc/zsh/builtins.yo
but it doesn't seem to be shipped with the distribution. From
setrlimit(2):

     RLIMIT_PTHREAD   The maximum number of threads (pthreads(5)) that a
                      process may create.  Functions that attempt to create
                      new threads beyond this limit will fail with the error
                      EAGAIN.

Also, cached_uid is defined in Src/utils.c AND in Src/globals.h. This
is bad because utils.pro, generated from Src/utils.c, contains the
definition and the IRIX linker gives multiply defined symbol errors
for cached_uid. The second patch fixes this.

-- 
albert chin (china@thewrittenword.com)

-- snip snip
--- Src/rlimits.awk.orig	Mon Oct 18 23:19:19 1999
+++ Src/rlimits.awk	Mon Oct 18 23:19:32 1999
@@ -38,6 +38,7 @@
 	    if (limnam == "AIO_OPS") { msg[limnum] = "aiooperations" }
 	    if (limnam == "AIO_MEM") { msg[limnum] = "aiomemorylocked" }
 	    if (limnam == "SBSIZE")  { msg[limnum] = "sockbufsize" }
+	    if (limnam == "PTHREAD") { msg[limnum] = "pthreads" }
         }
     }
 }
--- Src/utils.c.orig	Mon Oct 18 23:56:10 1999
+++ Src/utils.c	Tue Oct 19 00:08:56 1999
@@ -392,15 +392,6 @@
     }
 }
 
-/* Returns the current username.  It caches the username *
- * and uid to try to avoid requerying the password files *
- * or NIS/NIS+ database.                                 */
-
-/**/
-uid_t cached_uid;
-/**/
-char *cached_username;
-
 /**/
 char *
 get_username(void)

