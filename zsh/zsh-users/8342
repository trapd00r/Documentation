From zsh-users-return-8342-mason-zsh=primenet.com.au@sunsite.dk Sat Jan 08 16:24:55 2005
Return-Path: <zsh-users-return-8342-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9445 invoked from network); 8 Jan 2005 16:24:54 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 8 Jan 2005 16:24:54 -0000
Received: (qmail 27974 invoked from network); 8 Jan 2005 16:24:47 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 8 Jan 2005 16:24:47 -0000
Received: (qmail 5992 invoked by alias); 8 Jan 2005 16:23:59 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8342
Received: (qmail 5974 invoked from network); 8 Jan 2005 16:23:58 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 8 Jan 2005 16:23:58 -0000
Received: (qmail 26419 invoked from network); 8 Jan 2005 16:22:59 -0000
Received: from cmailg1.svr.pol.co.uk (195.92.195.171)
  by a.mx.sunsite.dk with SMTP; 8 Jan 2005 16:22:55 -0000
Received: from modem-78.panther-grouper.dialup.pol.co.uk ([62.137.46.78] helo=pwstephenson.fsnet.co.uk)
	by cmailg1.svr.pol.co.uk with esmtp (Exim 4.14)
	id 1CnJMc-0002vZ-Hj
	for zsh-users@sunsite.dk; Sat, 08 Jan 2005 16:22:55 +0000
Received: by pwstephenson.fsnet.co.uk (Postfix, from userid 501)
	id 1924985AF; Sat,  8 Jan 2005 11:24:05 -0500 (EST)
Received: from pwstephenson.fsnet.co.uk (localhost [127.0.0.1])
	by pwstephenson.fsnet.co.uk (Postfix) with ESMTP id E426C8551
	for <zsh-users@sunsite.dk>; Sat,  8 Jan 2005 16:24:05 +0000 (GMT)
To: zsh users <zsh-users@sunsite.dk>
Subject: Re: zsh as ksh for login shell -- a bug with PS1? 
In-reply-to: <B4498176-6134-11D9-AB6E-000393768D2C@mcgillsociety.org> 
References: <6037.1069091427@csr.com> <2B1BAD39-19FA-11D8-BE95-000393768D2C@mcgillsociety.org> <20031119170220.GB6550@atoom.net> <B4498176-6134-11D9-AB6E-000393768D2C@mcgillsociety.org>
Date: Sat, 08 Jan 2005 16:24:04 +0000
From: Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Message-Id: <20050108162405.1924985AF@pwstephenson.fsnet.co.uk>
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: *
X-Spam-Status: No, hits=1.5 required=6.0 tests=RCVD_IN_SORBS autolearn=no 
	version=2.63
X-Spam-Hits: 1.5

"William H. Magill" wrote:
> I have a two-line prompt string
> 
> PS1='[$PWD] $me
>   $HOST> '
> 
> I have been using this for many years. It works fine under ksh on Tru64 
> Unix 5.1 and when zsh 4.2.1 itself is evoked as the login shell.
> 
> However, if I change the /etc/password entry to evoke ksh instead of 
> zsh, the newline is lost, resulting in a prompt consisting of "$HOST> "

I think you're saying that ksh is really a link to zsh.  In that case
zsh will start up with a different set of options.  Probably the
critical one in this case is single_line_zle.  Try "unsetopt
single_line_zle" and see if that works.  (If my experiment is correct
this is exactly the problem.)

The option isn't there for the prompt, in fact, it's there because ksh
doesn't handle multiple line editing buffers.  It so happens that in zsh
this is associated with a multi-line prompt.  However, it's not at all
clear we really need to enforce this restriction of ksh when emulating
it anyway.  It's hard to think of a case where it's an advantage.

-- 
Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Work: pws@csr.com
Web: http://www.pwstephenson.fsnet.co.uk

