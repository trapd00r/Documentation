From zsh-workers-return-9938-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Feb 29 16:09:45 2000
Return-Path: <zsh-workers-return-9938-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11011 invoked from network); 29 Feb 2000 16:09:43 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 29 Feb 2000 16:09:43 -0000
Received: (qmail 20522 invoked by alias); 29 Feb 2000 16:09:37 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9938
Received: (qmail 20497 invoked from network); 29 Feb 2000 16:09:34 -0000
Date: Tue, 29 Feb 2000 17:09:17 +0100 (MET)
Message-Id: <200002291609.RAA21842@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 01 Mar 2000 00:10:02 +0900
Subject: Re: dirstack=(/) dumps core


Tanaka Akira wrote:

> I heard that assignment to dirstack may cause core dump.  I can get
> core on linux.
> 
> Z:akr@thorax% unlimit coredumpsize 
> Z:akr@thorax% zsh -f
> thorax% dirstack=(/)
> zsh: segmentation fault (core dumped)  zsh -f
> Z:akr@thorax% 

Oops.

Bye
 Sven

--- ../z.old/Src/Modules/parameter.c	Tue Feb 29 13:11:10 2000
+++ Src/Modules/parameter.c	Tue Feb 29 17:05:59 2000
@@ -967,14 +967,16 @@
 static void
 dirssetfn(Param pm, char **x)
 {
+    char **ox = x;
+
     if (!incleanup) {
 	freelinklist(dirstack, freestr);
 	dirstack = znewlinklist();
 	while (x && *x)
 	    zaddlinknode(dirstack, ztrdup(*x++));
     }
-    if (x)
-	freearray(x);
+    if (ox)
+	freearray(ox);
 }
 
 /**/

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

