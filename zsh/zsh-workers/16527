From zsh-workers-return-16527-mason-zsh=primenet.com.au@sunsite.dk Thu Jan 31 10:49:59 2002
Return-Path: <zsh-workers-return-16527-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26883 invoked from network); 31 Jan 2002 10:49:58 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 31 Jan 2002 10:49:58 -0000
Received: (qmail 15762 invoked by alias); 31 Jan 2002 10:49:51 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16527
Received: (qmail 15748 invoked from network); 31 Jan 2002 10:49:50 -0000
Date: Thu, 31 Jan 2002 10:49:49 +0000
To: zsh-workers@sunsite.dk
Cc: Derek Peschel <dpeschel@eskimo.com>
Subject: Re: BUG? - 4.0.2, current 4.1 - blank left prompt & blank line erases right prompt
Message-ID: <20020131104949.GB13581@fysh.org>
References: <20020131004406.A5021@eskimo.eskimo.com> <20020131104224.GA13581@fysh.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20020131104224.GA13581@fysh.org>
User-Agent: Mutt/1.3.25i
From: Zefram <zefram@fysh.org>

Zefram wrote:
>I think this patch fixes the problem.

Actually that was a little more conservative than necessary.  Here's a
better patch:

Index: zle_refresh.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_refresh.c,v
retrieving revision 1.4
diff -c -r1.4 zle_refresh.c
*** zle_refresh.c	2001/10/24 07:00:49	1.4
--- zle_refresh.c	2002/01/31 10:48:59
***************
*** 698,704 ****
        which need to be written. do this now to allow some pre-processing */
  
      if (cleareol 		/* request to clear to end of line */
! 	|| !nllen 		/* no line buffer given */
  	|| (ln == 0 && (put_rpmpt != oput_rpmpt))) {	/* prompt changed */
  	p1 = zhalloc(winw + 2);
  	if (nllen)
--- 698,704 ----
        which need to be written. do this now to allow some pre-processing */
  
      if (cleareol 		/* request to clear to end of line */
! 	|| (!nllen && (ln != 0 || !put_rpmpt))	/* no line buffer given */
  	|| (ln == 0 && (put_rpmpt != oput_rpmpt))) {	/* prompt changed */
  	p1 = zhalloc(winw + 2);
  	if (nllen)

-zefram

