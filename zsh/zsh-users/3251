From zsh-users-return-3251-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Jul 05 10:56:34 2000
Return-Path: <zsh-users-return-3251-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4270 invoked from network); 5 Jul 2000 10:56:33 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 5 Jul 2000 10:56:33 -0000
Received: (qmail 1374 invoked by alias); 5 Jul 2000 10:56:14 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 3251
Received: (qmail 1366 invoked from network); 5 Jul 2000 10:56:13 -0000
Date: Wed, 05 Jul 2000 11:55:46 +0100
From: Peter Stephenson <pws@cambridgesiliconradio.com>
Subject: Re: .nfsXXX files
In-reply-to: "Your message of Wed, 05 Jul 2000 11:30:30 BST."
 <20000705113030.A31803@thelonious.new.ox.ac.uk>
To: zsh-users@sunsite.auc.dk (Zsh users list)
Message-id: <0FX8004JR10YJY@la-la.cambridgesiliconradio.com>
Content-transfer-encoding: 7BIT

> What is the point of .nfsXXX files?  My boss just noticed lots of them
> in his NFS-mounted home directory.

Nothing much to do with zsh, except...  If you unlink a file, UNIX and its
relatives will usually leave the file contents on the disk until all files
open to it have been closed --- zsh uses this for temporary workspace,
opening the file and immediately unlinking it before it has ever been used.

However, this isn't a practical proposition under NFS, which tries to
remember as little as possible about the underlying file, to guard against
problems connecting to the server.  So instead, if the file is still being
accessed, it moves the file to a name beginning .nfs.  Since it can't be
sure when it has to be removed, because (I'm at the limits of my knowledge,
but I think this is correct) all the information about file descriptors is
on the client --- all it knows is it has received a request to read from or
write to a certain file --- they just get left around for cron to tidy up.
Usually there's a job that deletes all such files more than a few days old.

Now, although zsh does use unlinked files, it should only use them as
temporary storage in temporary directories.  So unless you have redefined
$TMPPREFIX this is probably not a shell-specific issue; it will happen any
time you use an NFS-mounted directory in this way.

-- 
Peter Stephenson <pws@cambridgesiliconradio.com>
Cambridge Silicon Radio, Unit 300, Science Park, Milton Road,
Cambridge, CB4 0XL, UK                          Tel: +44 (0)1223 392070

