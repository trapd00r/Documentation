From zsh-users-return-8664-mason-zsh=primenet.com.au@sunsite.dk Mon Apr 11 06:33:59 2005
Return-Path: <zsh-users-return-8664-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20187 invoked from network); 11 Apr 2005 06:33:58 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 11 Apr 2005 06:33:58 -0000
Received: (qmail 26078 invoked from network); 11 Apr 2005 06:33:52 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 11 Apr 2005 06:33:52 -0000
Received: (qmail 3064 invoked by alias); 11 Apr 2005 06:33:45 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8664
Received: (qmail 3050 invoked from network); 11 Apr 2005 06:33:45 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 11 Apr 2005 06:33:45 -0000
Received: (qmail 24982 invoked from network); 11 Apr 2005 06:33:45 -0000
Received: from omr2.netsolmail.com (216.168.230.163)
  by a.mx.sunsite.dk with SMTP; 11 Apr 2005 06:33:41 -0000
Received: from ms11.netsolmail.com (IDENT:mirapoint@[216.168.230.173])
	by omr2.netsolmail.com (8.12.10/8.12.10) with ESMTP id j3B6XdWj025225
	for <zsh-users@sunsite.dk>; Mon, 11 Apr 2005 02:33:39 -0400 (EDT)
Received: from ckhb.org (cpe-24-221-169-78.ca.sprintbbd.net [24.221.169.78])
	by ms11.netsolmail.com (Mirapoint Messaging Server MOS 3.2.2-GA)
	with ESMTP id ASR00705;
	Mon, 11 Apr 2005 02:33:38 -0400 (EDT)
From: "S. Cowles" <scowles@earthlink.net>
Reply-To: scowles@earthlink.net
Organization: personal
To: zsh-users@sunsite.dk
Subject: problem testing file descriptor 3
Date: Sun, 10 Apr 2005 23:33:32 -0700
User-Agent: KMail/1.5.1
MIME-Version: 1.0
Content-Type: Text/Plain;
  charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Content-Description: clearsigned data
Content-Disposition: inline
Message-Id: <200504102333.36134.scowles@earthlink.net>
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6


I am having trouble testing if file descriptor 3 is already opened in the
calling environment.  If the file descriptor is not open, I would like to
open it and redirect it to stderr.  The test script I am using is:

	#!/bin/zsh
	[[ -t 3 ]] &&
		{ echo "fd3 is open."; } ||
		{ echo "fd3 is not open."; }
	echo no1 >&1
	echo no2 >&2
	echo no3 >&3
	exit 0

If the script is invoked in this manner:
	cp /dev/null fd3.out
	exec 3>&-
	./test 3> fd3.out
the script reports that fd3 is not open even though fd3 output does correct=
ly
redirect to the file fd3.out.

If the script is invoked like so:
	exec 3>&-
	exec 3> /dev/tty
	./test
the script reports that fd3 is open and all output correctly appears on the
terminal session.

If I use a test like this:
	echo -n "" >&3 1> /dev/null 2> /dev/null || {
		echo "fd3 is not open."
		exec 3>&2
	}
error messages are not hidden.

So, as a recap, if fd3 is already opened when the script is called, I want
output to redirect as coded in the calling environment.  If fd3 is not
already opened, I want to redirect fd3 output to an existing, open fd and
I want any error messages hidden.

What is a good test to determine if file descriptor 3 is open in the callin=
g=20
environment?  Thanks.

=46ull test example:

$ cat ./test;
echo;
cp /dev/null fd3.out; exec 3>&-; ./test 3> fd3.out; head fd3.out /dev/null;
echo;
exec 3>&-; exec 3> /dev/tty; ./test;
#!/bin/zsh
[[ -t 3 ]] &&
	{ echo "fd3 is open."; } ||
	{ echo "fd3 is not open."; }
echo no1 >&1
echo no2 >&2
echo no3 >&3
exit 0

fd3 is not open.
no1
no2
=3D=3D> fd3.out <=3D=3D
no3

=3D=3D> /dev/null <=3D=3D

fd3 is open.
no1
no2
no3
$


