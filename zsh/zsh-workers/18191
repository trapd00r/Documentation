From zsh-workers-return-18191-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 05 00:41:48 2003
Return-Path: <zsh-workers-return-18191-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24714 invoked from network); 5 Feb 2003 00:41:48 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 5 Feb 2003 00:41:48 -0000
Received: (qmail 28535 invoked by alias); 5 Feb 2003 00:41:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18191
Received: (qmail 28528 invoked from network); 5 Feb 2003 00:41:38 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 5 Feb 2003 00:41:38 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [63.107.91.101] by sunsite.dk (MessageWall 1.0.8) with SMTP; 5 Feb 2003 0:41:37 -0000
Received: from itasoftware.com (phl.internal.itasoftware.com [192.168.1.115])
	by mta.internal.itasoftware.com (8.12.6/8.12.6) with ESMTP id h150fbxY025499;
	Tue, 4 Feb 2003 19:41:37 -0500
Received: (from greg@localhost)
	by itasoftware.com (8.9.3/8.8.7) id TAA28591;
	Tue, 4 Feb 2003 19:41:37 -0500
Message-ID: <15936.24000.946529.760602@phl.itasoftware.com>
Date: Tue, 4 Feb 2003 19:41:36 -0500 (EST)
From: gak@klanderman.net (Greg Klanderman)
To: zsh-workers@sunsite.dk (Zsh list)
Subject: PATCH: fix compctl "-y" to obey LISTPACKED, LISTROWSFIRST
Reply-To: gak@klanderman.net
X-Mailer: VM 6.62 under 21.1 (patch 9) "Canyonlands" XEmacs Lucid
Mime-Version: 1.0 (generated by tm-edit 7.108)
Content-Type: text/plain; charset=US-ASCII


Hi,

In the development CVS tree (4.1.0-dev), displayed completions derived
from compctl "-y" always display in the LISTPACKED and LISTROWSFIRST
style, no matter how these options are set (the options are not even
set by default).

The bug also exists in 4.0.6, and this patch should apply cleanly if
you first apply the patch I am about to submit to get compctl "-y" to
work at all in that version.

thanks
Greg


Index: compresult.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compresult.c,v
retrieving revision 1.47
diff -u -r1.47 compresult.c
--- compresult.c	13 Jan 2003 10:32:03 -0000	1.47
+++ compresult.c	5 Feb 2003 00:18:56 -0000
@@ -1408,6 +1408,13 @@
 	g->flags |= CGF_PACKED | CGF_ROWS;
 
 	if (!onlyexpl && pp) {
+            if (*pp) {
+                if (!isset(LISTPACKED))
+                    g->flags &= ~CGF_PACKED;
+                if (!isset(LISTROWSFIRST))
+                    g->flags &= ~CGF_ROWS;
+            }
+
 	    /* We have an ylist, lets see, if it contains newlines. */
 	    hidden = 1;
 	    while (!nl && *pp) {

