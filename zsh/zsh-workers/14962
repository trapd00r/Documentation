From zsh-workers-return-14962-mason-zsh=primenet.com.au@sunsite.dk Mon Jun 18 09:50:02 2001
Return-Path: <zsh-workers-return-14962-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4536 invoked from network); 18 Jun 2001 09:50:02 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 18 Jun 2001 09:50:02 -0000
Received: (qmail 2023 invoked by alias); 18 Jun 2001 09:45:57 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14962
Received: (qmail 2000 invoked from network); 18 Jun 2001 09:45:56 -0000
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
Date: Mon, 18 Jun 2001 11:44:50 +0200 (MET DST)
Message-Id: <200106180944.LAA11555@beta.informatik.hu-berlin.de>
To: zsh-workers@sunsite.dk
Subject: Re: .. completion
In-Reply-To: <1010618091849.ZM27654@candle.brasslantern.com>

Bart Schaefer wrote:

> On Jun 18,  9:46am, Sven Wischnowsky wrote:
> } Subject: Re: .. completion
> }
> } [moved to -workers]
> } 
> } Bart Schaefer wrote:
> } 
> } > ...
> } > 
> } > In _path_files, the special-dirs style is looked up only as a string, but
> } > the documentation says it may be either a string or a boolean.
> 
> So the handling of special-dirs is really done in the C code for compfiles?

Yes.

> } > However, in _files, _path_files is always called with -g option, so the
> } > special-dirs style doesn't work at all for _files.
> } 
> } Eh?  Works for me.  And _files can call _path_files without the -g
> } option, in line 80.
> 
> I'm sorry, I must be mis-reading the difference between
>     _path_files -g "$pat" "$opts[@]" "$expl[@]" && ret=0
> and
>     _path_files "$expl[@]" -g "$pat" "$opts[@]" && ret=0

Ouch, yes.  Err... monday morning, sleep deprived.  Ahem.

> In any case, special-dirs doesn't work for me.  I finally narrowed it
> down to this:
> 
>     zstyle ':completion:*' file-sort modification
> 
> Why should the file-sort style have any effect at all on special-dirs?

Because the added `(om)' (or whatever) makes the test in line 142 fail,
so the `/' doesn't get added to $sopt and that makes it go to line 327
instead of 325 (not passing $sdirs to compfiles).

The patch makes it ignore qualifier lists there.


Bye
  Sven

Index: Completion/Unix/Type/_path_files
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Type/_path_files,v
retrieving revision 1.5
diff -u -r1.5 _path_files
--- Completion/Unix/Type/_path_files	2001/05/29 17:54:37	1.5
+++ Completion/Unix/Type/_path_files	2001/06/18 09:45:39
@@ -140,7 +140,7 @@
 zstyle -t ":completion:${curcontext}:paths" list-suffixes &&
     listsfx=yes
 
-[[ "$pats" = ((|*[[:blank:]])\*(|[[:blank:]]*)|*\([^[:blank:]]#/[^[:blank:]]#\)*) ]] &&
+[[ "$pats" = ((|*[[:blank:]])\*(|[[:blank:]]*|\([^[:blank:]]##\))|*\([^[:blank:]]#/[^[:blank:]]#\)*) ]] &&
     sopt=$sopt/
 
 zstyle -a ":completion:${curcontext}:paths" accept-exact accex

-- 
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

