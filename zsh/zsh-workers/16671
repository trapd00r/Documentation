From zsh-workers-return-16671-mason-zsh=primenet.com.au@sunsite.dk Mon Feb 18 18:15:14 2002
Return-Path: <zsh-workers-return-16671-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9108 invoked from network); 18 Feb 2002 18:15:14 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 18 Feb 2002 18:15:14 -0000
Received: (qmail 20924 invoked by alias); 18 Feb 2002 18:15:07 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16671
Received: (qmail 20908 invoked from network); 18 Feb 2002 18:15:07 -0000
Date: Mon, 18 Feb 2002 18:15:05 +0000
From: Adam Spiers <adam@spiers.net>
To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Subject: Re: vanishing history
Message-ID: <20020218181505.A28159@corelli.new.ox.ac.uk>
Reply-To: Adam Spiers <adam@spiers.net>
Mail-Followup-To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
References: <20011128161905.A9726@corelli.new.ox.ac.uk> <Pine.LNX.4.33L2.0202160123440.1473-100000@phong.blorf.net> <20020218181021.A27877@corelli.new.ox.ac.uk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <20020218181021.A27877@corelli.new.ox.ac.uk>; from adam@spiers.net on Mon, Feb 18, 2002 at 06:10:21PM +0000
X-URL: http://tigerpig.org/
X-OS: RedHat Linux
Sender: "Adam Spiers,,07775562717,020 88 30 30 35" <adam@corelli.new.ox.ac.uk>

Adam Spiers (adam@spiers.net) wrote:
> Thanks for that.  I've found a way to reproduce the bug, and this
> patch (or at least, the combination of all cvs commits over the last
> few weeks) makes zsh core dump when I try that way, which is to simply
> type ^X?, which is bound to _complete_debug.  This somehow manages to
> reset the history file to almost empty.  I've tracked it as far as the
> inc_append_history option, which disabling stops the core dump.
> Beyond that I'm out of my depth.

Apologies, I forgot to include a stack trace.

#0  0x0807931f in savehistfile (fn=0x80ef1c0 "/nfs-home/adams/.zshhistory",
    err=0, writeflags=32771) at hist.c:2050
2050                for (; *t; t++) {
(gdb) bt
#0  0x0807931f in savehistfile (fn=0x80ef1c0 "/nfs-home/adams/.zshhistory",
    err=0, writeflags=32771) at hist.c:2050
#1  0x08076f52 in hend (prog=0x0) at hist.c:1154
#2  0x08079ff8 in loop (toplevel=1, justonce=0) at init.c:129
#3  0x0807c849 in zsh_main (argc=1, argv=0xbffff374) at init.c:1214
#4  0x080518f0 in main (argc=1, argv=0xbffff374) at ./main.c:37
#5  0x4008f6f7 in __libc_start_main (main=0x80518e0 <main>, argc=1,
    ubp_av=0xbffff374, init=0x8050e08 <_init>, fini=0x80bd89c <_fini>,
    rtld_fini=0x4000dcd4 <_dl_fini>, stack_end=0xbffff36c)
    at ../sysdeps/generic/libc-start.c:129

