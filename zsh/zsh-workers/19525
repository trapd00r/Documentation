From zsh-workers-return-19525-mason-zsh=primenet.com.au@sunsite.dk Tue Mar 02 18:18:16 2004
Return-Path: <zsh-workers-return-19525-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11004 invoked from network); 2 Mar 2004 18:18:15 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 2 Mar 2004 18:18:15 -0000
Received: (qmail 8851 invoked by alias); 2 Mar 2004 18:18:08 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19525
Received: (qmail 8806 invoked from network); 2 Mar 2004 18:18:07 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 2 Mar 2004 18:18:07 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [193.109.254.211] by sunsite.dk (MessageWall 1.0.8) with SMTP; 2 Mar 2004 18:18:7 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-7.tower-36.messagelabs.com!1078251486!4298077
X-StarScan-Version: 5.2.5; banners=-,-,-
X-Originating-IP: [158.234.9.163]
Received: (qmail 4455 invoked from network); 2 Mar 2004 18:18:06 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-7.tower-36.messagelabs.com with SMTP; 2 Mar 2004 18:18:06 -0000
Received: from trentino.logica.co.uk ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id i22II6Ck024157
	for <zsh-workers@sunsite.dk>; Tue, 2 Mar 2004 18:18:06 GMT
Received: from trentino.logica.co.uk (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP id B77397969E6B
	for <zsh-workers@sunsite.dk>; Tue,  2 Mar 2004 19:17:21 +0100 (CET)
X-VirusChecked: Checked
X-StarScan-Version: 5.1.13; banners=.,-,-
From: Oliver Kiddle <okiddle@yahoo.co.uk>
To: Zsh workers <zsh-workers@sunsite.dk>
Subject: building latest sources
Date: Tue, 02 Mar 2004 19:17:21 +0100
Message-ID: <27115.1078251441@trentino.logica.co.uk>

I tried compiling the latest sources on a few of the SourceForge
compile farm machines.

On Mac OS X, it built fine. make test has one problem I couldn't work
out and I'm not sure why it failed to load zpty because I could load it
manually. The patch below suppresses a couple of compiler warnings and
adjusts _groups to use the netinfo database.

On Solaris 9, there were no problems except those caused by their
installation of GNU libiconv being found at linktime but not runtime.

NetBSD built and tested fine. I got warnings there and MacOS X for
implicit declaration of function 'ioctl'. Should we be including
sys/ioctl.h more widely?

Oliver

Index: Completion/Unix/Type/_groups
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Type/_groups,v
retrieving revision 1.3
diff -u -r1.3 _groups
--- Completion/Unix/Type/_groups	18 Feb 2004 12:45:36 -0000	1.3
+++ Completion/Unix/Type/_groups	2 Mar 2004 18:04:35 -0000
@@ -6,7 +6,9 @@
 
 if ! zstyle -a ":completion:${curcontext}:" groups groups; then
   (( $+_cache_groups )) ||
-      if (( ${+commands[getent]} )); then
+      if [[ $OSTYPE = darwin* ]]; then
+        : ${(A)_cache_groups:=${${(M)${(f)"$(_call_program groups lookupd -q group)"}:#name*}##*: }}
+      elif (( ${+commands[getent]} )); then
         : ${(A)_cache_groups:=${${(s: :)$(_call_program groups getent group 2>/dev/null)}%%:*}}
       else
         : ${(A)_cache_groups:=${${${(s: :)$(</etc/group)}%%:*}:#+}}
Index: Src/Modules/socket.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/socket.c,v
retrieving revision 1.4
diff -u -r1.4 socket.c
--- Src/Modules/socket.c	22 May 2003 09:48:29 -0000	1.4
+++ Src/Modules/socket.c	2 Mar 2004 18:04:36 -0000
@@ -171,7 +171,7 @@
 	    tv.tv_sec = 0;
 	    tv.tv_usec = 0;
 	    
-	    if (ret = select(lfd+1, &rfds, NULL, NULL, &tv)) return 1;
+	    if ((ret = select(lfd+1, &rfds, NULL, NULL, &tv))) return 1;
 	    else if (ret == -1)
 	    {
 		zwarnnam(nam, "select error: %e", NULL, errno);
Index: Src/Modules/tcp.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/tcp.c,v
retrieving revision 1.37
diff -u -r1.37 tcp.c
--- Src/Modules/tcp.c	29 Oct 2003 19:17:48 -0000	1.37
+++ Src/Modules/tcp.c	2 Mar 2004 18:04:36 -0000
@@ -515,7 +515,7 @@
 	    tv.tv_sec = 0;
 	    tv.tv_usec = 0;
 	    
-	    if (ret = select(lfd+1, &rfds, NULL, NULL, &tv)) return 1;
+	    if ((ret = select(lfd+1, &rfds, NULL, NULL, &tv))) return 1;
 	    else if (ret == -1)
 	    {
 		zwarnnam(nam, "select error: %e", NULL, errno);
Index: Src/Zle/zle_params.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_params.c,v
retrieving revision 1.12
diff -u -r1.12 zle_params.c
--- Src/Zle/zle_params.c	15 Dec 2003 22:45:29 -0000	1.12
+++ Src/Zle/zle_params.c	2 Mar 2004 18:04:36 -0000
@@ -365,7 +365,7 @@
 	free(cutbuf.buf);
     cutbuf.flags = 0;
     if (x) {
-	unmetafy(x, &cutbuf.len);
+	unmetafy(x, (int *)&cutbuf.len);
 	cutbuf.buf = zalloc(cutbuf.len);
 	memcpy((char *)cutbuf.buf, x, cutbuf.len);
 	free(x);
@@ -420,7 +420,7 @@
 	for (p = x; *p; p++) {
 	    int len = strlen(*p);
 	    kptr = kring + kpos;
-	    unmetafy(*p, &kptr->len);
+	    unmetafy(*p, (int *)&kptr->len);
 	    kptr->buf = (char *)zalloc(kptr->len);
 	    memcpy(kptr->buf, *p, kptr->len);
 	    zfree(*p, len+1);

