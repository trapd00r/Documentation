From zsh-users-return-13795-mason-zsh=primenet.com.au@sunsite.dk Sat Jan 31 21:22:41 2009
Return-Path: <zsh-users-return-13795-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18711 invoked from network); 31 Jan 2009 21:22:28 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 31 Jan 2009 21:22:28 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 62432 invoked from network); 31 Jan 2009 21:22:16 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 31 Jan 2009 21:22:16 -0000
Received: (qmail 17891 invoked by alias); 31 Jan 2009 21:21:58 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13795
Received: (qmail 17876 invoked from network); 31 Jan 2009 21:21:57 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 31 Jan 2009 21:21:57 -0000
Received: from vms173005pub.verizon.net (vms173005pub.verizon.net [206.46.173.5])
	by bifrost.dotsrc.org (Postfix) with ESMTP id B956E80271F0
	for <zsh-users@sunsite.dk>; Sat, 31 Jan 2009 22:21:54 +0100 (CET)
Received: from torch.brasslantern.com ([96.238.220.215])
 by vms173005.mailsrvcs.net
 (Sun Java(tm) System Messaging Server 6.3-2.01 (built Jun 13 2007; 32bit))
 with ESMTPA id <0KEC009E2TZU7US5@vms173005.mailsrvcs.net> for
 zsh-users@sunsite.dk; Sat, 31 Jan 2009 15:21:31 -0600 (CST)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id n0VLLTJM007875	for
 <zsh-users@sunsite.dk>; Sat, 31 Jan 2009 13:21:29 -0800
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id n0VLLScV007874	for zsh-users@sunsite.dk; Sat,
 31 Jan 2009 13:21:28 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <090131132128.ZM7873@torch.brasslantern.com>
Date: Sat, 31 Jan 2009 13:21:28 -0800
In-reply-to: <9f18d39e0901300157n3f01cd39p266a30232a31b073@mail.gmail.com>
Comments: In reply to Sylvain Meunier <sylvain.meunier@gmail.com>
 "MIME and completion ?" (Jan 30, 10:57am)
References: <9f18d39e0901300157n3f01cd39p266a30232a31b073@mail.gmail.com>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: zsh-users@sunsite.dk
Subject: Re: MIME and completion ?
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii
X-Virus-Scanned: ClamAV 0.92.1/8931/Sat Jan 31 19:25:59 2009 on bifrost
X-Virus-Status: Clean

On Jan 30, 10:57am, Sylvain Meunier wrote:
}
} I would use MIME types with the zsh completion system when i use
} wildcards like * or ? for ignoring "uneditable" files.

First you need to describe the syntax of the file from which you
are obtaining your MIME type data.  ~/.mailcap and ~/.mime.types
have radically different formats, and there are probably some XML
files that describe MIME floating around as well.  For example, to
get all the file extensions for text files out of /etc/mime.types
you can use this parameter expansion:

${=${(M)${(f)"$(</etc/mime.types)"}:#text/*[[:space:]]*}#*[[:space:]]}

To break that down ...

mime_types=( ${(f)"$(</etc/mime.types)"} )
text_types=( ${(M)mime_types:#text/*[[:space:]]*} )
text_exts=( ${=text_types#*[[:space:]]} )

You probably want to add some things to that for which there are not
entries in /etc/mime.types, such as:

text_exts+=(c h sh)

Then you need to create zstyle entries for the commands to which
each MIME type applies.  Probably you want the ignored-patterns
style, which means you need to list the files you DO NOT want to
match.  Since extendedglob is on during completion, you can do
that by making a negated pattern (a leading caret, with the rest
of the pattern in parens).  Example:

zstyle ':completion::complete:(vi|vim):*' ignored-patterns \
	"^(*.(${(j:|:)text_exts}))"

Rinse and repeat for other types and commands.

