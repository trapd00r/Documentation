From zsh-workers-return-22882-mason-zsh=primenet.com.au@sunsite.dk Wed Oct 18 12:01:23 2006
Return-Path: <zsh-workers-return-22882-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13694 invoked from network); 18 Oct 2006 12:01:20 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.6 (2006-10-03) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.6
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 18 Oct 2006 12:01:20 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 8746 invoked from network); 18 Oct 2006 12:01:05 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 18 Oct 2006 12:01:05 -0000
Received: (qmail 5769 invoked by alias); 18 Oct 2006 12:00:51 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22882
Received: (qmail 5759 invoked from network); 18 Oct 2006 12:00:50 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 18 Oct 2006 12:00:50 -0000
Received: (qmail 8553 invoked from network); 18 Oct 2006 12:00:50 -0000
Received: from master.altlinux.org (62.118.250.235)
  by a.mx.sunsite.dk with SMTP; 18 Oct 2006 12:00:49 -0000
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by master.altlinux.org (Postfix) with ESMTP id D9469E37BB
	for <zsh-workers@sunsite.dk>; Wed, 18 Oct 2006 16:00:17 +0400 (MSD)
Received: by localhost.localdomain (Postfix, from userid 500)
	id 747F435A826; Wed, 18 Oct 2006 16:00:19 +0400 (MSD)
Date: Wed, 18 Oct 2006 16:00:19 +0400
From: Alexey Tourbin <at@altlinux.ru>
To: zsh-workers@sunsite.dk
Subject: Re: compaudit problem
Message-ID: <20061018120019.GK11317@localhost.localdomain>
Mail-Followup-To: zsh-workers@sunsite.dk
References: <20060819115030.GE25959@localhost.localdomain> <060819103035.ZM28413@torch.brasslantern.com> <20061017190546.GB11317@localhost.localdomain> <061017204150.ZM8127@torch.brasslantern.com>
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="I4VOKWutKNZEOIPu"
Content-Disposition: inline
In-Reply-To: <061017204150.ZM8127@torch.brasslantern.com>


--I4VOKWutKNZEOIPu
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

On Tue, Oct 17, 2006 at 08:41:50PM -0700, Bart Schaefer wrote:
> On Oct 17, 11:05pm, Alexey Tourbin wrote: > }
> } On Sat, Aug 19, 2006 at 10:30:33AM -0700, Bart Schaefer wrote:
> } >=20
> } >         * 22557: Doc/Zsh/options.yo, Misc/globtests, Src/options.c,
> } >         Src/pattern.c, Test/D02glob.ztst, Test/D07multibyte.ztst:
> } >         Turn on multibyte option by default for MULTIBYTE_SUPPORT and=
 fix
> } >         tests and patterns.
> }=20
> } git-bisect says the problem started with change #22557.
>=20
> Given that, according to your build script, you compiled both the before-
> and after-22557 sources with --enable-multibyte, the only change in 22557
> that could possibly be related is this one:
>=20
> --- Src/pattern.c	25 Jul 2006 09:25:27 -0000	1.37
> +++ Src/pattern.c	25 Jul 2006 18:06:48 -0000
> @@ -343,7 +343,7 @@
>      /* Error.  Treat as single byte. */
>      /* Reset the shift state for next time. */
>      memset(&shiftstate, 0, sizeof(shiftstate));
> -    return (wchar_t) *(*x)++;
> +    return (wchar_t) STOUC(*(*x)++);
>  }
> =20
>  #else
>=20
> Does backing out that STOUC fix the problem?  What underlying integer
> type is wchar_t on the machine where you're building zsh?

Nope.  But reverting Src/options.c part fixes the problem.
I'm kind of puzzled.

--I4VOKWutKNZEOIPu
Content-Type: application/pgp-signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.5 (GNU/Linux)

iD8DBQFFNhdTfBKgtDjnu0YRAtQEAJ9v9ffAXhfDgNHvCnq2DNbeZOxVcQCgpX/p
r2xOOyY9fLRzLt8GTbqm0X4=
=f05O
-----END PGP SIGNATURE-----

--I4VOKWutKNZEOIPu--

