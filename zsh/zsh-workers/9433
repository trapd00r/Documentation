From zsh-workers-return-9433-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Jan 26 10:10:08 2000
Return-Path: <zsh-workers-return-9433-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12641 invoked from network); 26 Jan 2000 10:10:06 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 26 Jan 2000 10:10:06 -0000
Received: (qmail 14672 invoked by alias); 26 Jan 2000 10:09:47 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9433
Received: (qmail 14665 invoked from network); 26 Jan 2000 10:09:47 -0000
Date: Wed, 26 Jan 2000 11:09:45 +0100 (MET)
Message-Id: <200001261009.LAA16179@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 26 Jan 2000 16:45:15 +0900
Subject: Re: core dump with completion


Tanaka Akira wrote:

> zsh patched upto 9421 dumps core on Solaris 7 as follows:
> 
> Z:akr@is27e1u11% cvs co -r zsh-workers_9421 -d zsh9421 zsh
> Z:akr@is27e1u11% cd zsh9421
> Z:akr@is27e1u11% Util/preconfig
> Z:akr@is27e1u11%  ./configure --prefix=/space/akr/zsh/tmp --enable-zsh-debug --enable-zsh-mem-debug && make && make install
> Z:akr@is27e1u11% Src/zsh -f
> is27e1u11% bindkey -e; autoload -U compinit; compinit -D
> is27e1u11% ls c<TAB>
> is27e1u11% ls config<TAB>
> zsh: segmentation fault (core dumped)  Src/zsh -f
> Z:akr@is27e1u11% 

Damn. I hate memory bugs.

> (gdb) where
> #0  0xff145c8c in realfree ()
> #1  0xff146460 in cleanfree ()
> #2  0xff145628 in _malloc_unlocked ()
> #3  0xff145544 in malloc ()
> #4  0x681d0 in zalloc (size=45) at mem.c:491

Urgh. It shouldn't be using zalloc'ed memory here. I can easily send a 
patch for this, but...

All this seems to show some other allocation bug (I guess some
function writes into memory it hasn't allocated) which might be hidden 
if I send the patch to make it use heap memory now, so...

But I can't repeat the bug. Tanaka, can you try it using --enable-zsh-mem,
--enable-secure-free and --enable-mem-warining? That may (or may not)
give us more information where it is actually failing. Also: does it
use mmap for heaps on Solaris 7?


Bye
 Sven


--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

