From zsh-workers-return-28792-mason-zsh=primenet.com.au@zsh.org Wed Feb 23 01:08:29 2011
Return-Path: <zsh-workers-return-28792-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24925 invoked by alias); 23 Feb 2011 01:08:29 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28792
Received: (qmail 18054 invoked from network); 23 Feb 2011 01:08:26 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at hightek.org does not designate permitted sender hosts)
Date: Tue, 22 Feb 2011 19:08:17 -0600
From: Vincent Stemen <vince.lists@hightek.org>
To: zsh-workers@zsh.org
Subject: Re: sh compatibility issue
Message-ID: <20110223010817.GA36733@quark.hightek.org>
References: <20110218103012.27fd1869@pwslap01u.europe.root.pri> <20110219230540.GA81416@stack.nl> <20110220191159.12627718@pws-pc.ntlworld.com> <4D618A11.3050406@case.edu> <20110222200259.2aab2dcc@pws-pc.ntlworld.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20110222200259.2aab2dcc@pws-pc.ntlworld.com>
User-Agent: Mutt/1.5.18 (2008-05-17)
Sender: Vincent Stemen <vince@hightek.org>

On Tue, Feb 22, 2011 at 08:02:59PM +0000, Peter Stephenson wrote:
> On Sun, 20 Feb 2011 16:39:29 -0500
> Chet Ramey <chet.ramey@case.edu> wrote:
> > On 2/20/11 2:11 PM, Peter Stephenson wrote:
> > >> On a related note, here is another quite insidious sh compatibility
> > >> issue:
> > >>   sh -c 'exec </nonexistent/a; echo wrong'
> > >> This should not print "wrong" because exec is a special builtin and
> > >> redirection errors on special builtins are fatal. Most shells get this
> > >> right nowadays (bash only in POSIX mode) but zsh gets it wrong. Even
> > >>   set -o posixbuiltins
> > >> does not help.
> > > 
> > > I think it does need to be fatal, but not because it's a special builtin
> > > --- it looks like that's only a "may" rather than a "shall" --- but
> > > because there is a rule for exec:
> > 
> > No, that's actually a `shall'.  Section 2.8.1, special builtin, redirection
> > error.
> 
> Thanks, didn't follow the link... it looks like the "may" here means
> "may be required to".  The table shows essentially all errors for
> special builtins are fatal.
> 
> I didn't actually test for a special builtin in the previous patch,
> either.  Here's a revised patch with more careful tests.

I don't think it worked.  With this patch added, the bahaviour did not
change from the previous patch.  Fatal error in sh mode not not in zsh
mode.

    $ /usr/bin/zsh -c 'exec </nonexistent/a; echo wrong'
    zsh:1: no such file or directory: /nonexistent/a
    wrong
    
    $ /usr/bin/zsh -c 'emulate sh; exec </nonexistent/a; echo wrong'
    zsh:1: no such file or directory: /nonexistent/a

