From zsh-workers-return-11599-mason-zsh=primenet.com.au@sunsite.auc.dk Fri May 26 14:04:20 2000
Return-Path: <zsh-workers-return-11599-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1602 invoked from network); 26 May 2000 14:04:15 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 26 May 2000 14:04:15 -0000
Received: (qmail 5761 invoked by alias); 26 May 2000 14:04:04 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11599
Received: (qmail 5752 invoked from network); 26 May 2000 14:03:59 -0000
Date: Fri, 26 May 2000 10:03:45 -0400
From: Clint Adams <schizo@debian.org>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: _perl_modules caution
Message-ID: <20000526100345.A26709@scowler.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
User-Agent: Mutt/1.0.1i

If @INC contains nonexistent directories, the cd below will fail,
which, in turn, leads to results that are ugly at best.

Index: Completion/User/_perl_modules
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/User/_perl_modules,v
retrieving revision 1.4
diff -u -r1.4 _perl_modules
--- Completion/User/_perl_modules	2000/05/23 18:06:32	1.4
+++ Completion/User/_perl_modules	2000/05/26 14:00:10
@@ -46,9 +46,11 @@
       if [[ $libdir == '.' ]]; then break; fi
 
       # Find all modules
+      if [[ -d $libdir && -x $libdir ]]; then
       cd $libdir
       new_pms=( {[A-Z]*/***/,}*.pm~*blib*(N) )
       cd $OLDPWD
+      fi
 
       # Convert to Perl nomenclature
       new_pms=( ${new_pms:r:fs#/#::#} )

