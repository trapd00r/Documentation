From zsh-workers-return-14922-mason-zsh=primenet.com.au@sunsite.dk Thu Jun 14 20:48:18 2001
Return-Path: <zsh-workers-return-14922-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9308 invoked from network); 14 Jun 2001 20:48:17 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 14 Jun 2001 20:48:17 -0000
Received: (qmail 22949 invoked by alias); 14 Jun 2001 20:47:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14922
Received: (qmail 22931 invoked from network); 14 Jun 2001 20:47:47 -0000
Message-Id: <200106142048.QAA30512@aragorn.cortexmachina.com>
To: zsh-workers@sunsite.dk
Subject: Latest cvs hangs in completion tests
Date: Thu, 14 Jun 2001 16:48:06 -0400
From: Peter Whaite <peta@cortexmachina.com>


I noticed this after the readonly patch (#14915) went in.   Pretty sure it was
ok before that. System is:
  
  % cat /etc/issue

  Red Hat Linux release 6.2 (mixed)
  Kernel 2.4.3 on an i686

  % uname -a
  Linux aragorn 2.4.3 #8 Mon Apr 30 19:05:32 EDT 2001 i686 unknown

Verbose test output:

  % ZTST_verbose=2 make test TESTNUM=Y 
  if test -n "gcc"; then \
    cd .. && \
    make MODDIR=`pwd`/Test/Modules install.modules > /dev/null; \
  fi
  for f in ./Y*.ztst; do \
    ../Src/zsh +Z -f ./ztst.zsh $f; \
  done
  ./Y01completion.ztst: starting.
  ZTST_getsect: read section name: prep
  ZTST_getchunk: read code chunk:
    . $ZTST_srcdir/comptest
  ZTST_execchunk: status 0
  ZTST_getchunk: read code chunk:
    mkdir comp.tmp
    cd comp.tmp
  ZTST_execchunk: status 0
  ZTST_getchunk: read code chunk:
    comptestinit -z $ZTST_testdir/../Src/zsh
  ZTST_execchunk: status 0
  ZTST_getchunk: read code chunk:
    mkdir dir1
    mkdir dir2
    touch file1
    touch file2
  ZTST_execchunk: status 0
  ZTST_getchunk: read code chunk:

  ZTST_getsect: read section name: test
  ZTST_test: looking for new test
  ZTST_test: examining line:

  ZTST_test: examining line:
    comptest $': \t\t\t\t\t\t\t'
  ZTST_getchunk: read code chunk:
    comptest $': \t\t\t\t\t\t\t'
  ZTST_test: examining line:
  >line: {: }{}
  ZTST_getredir: read redir for '>':
  line: {: }{}
  DESCRIPTION:{file}
  DI:{dir1}
  DI:{dir2}
  FI:{file1}
  FI:{file2}
  line: {: dir1/}{}
  line: {: dir2/}{}
  line: {: file1}{}
  line: {: file2}{}
  line: {: dir1/}{}
  line: {: dir2/}{}
  ZTST_test: examining line:

  Running test: directories and files
  ZTST_test: expecting status: 0

Then hangs.  Note directory group is sticky which may be a bit unusual...

  % ls -ld comp.tmp
  drwxrwsr-x    4 peta     maint        1024 Jun 14 16:36 comp.tmp/
  % ls -lR comp.tmp 
  comp.tmp:
  total 2
  drwxrwsr-x    2 peta     maint        1024 Jun 14 16:36 dir1/
  drwxrwsr-x    2 peta     maint        1024 Jun 14 16:36 dir2/
  -rw-rw-r--    1 peta     maint           0 Jun 14 16:36 file1
  -rw-rw-r--    1 peta     maint           0 Jun 14 16:36 file2

  comp.tmp/dir1:
  total 0

  comp.tmp/dir2:
  total 0

Let me know if other info is needed.

--
peta

