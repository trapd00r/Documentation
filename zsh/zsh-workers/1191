From pws@ifh.de Tue May 28 03:14:54 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3) with ESMTP id DAA23681 for <mason@werple.mira.net.au>; Tue, 28 May 1996 03:14:48 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id NAA28420; Mon, 27 May 1996 13:02:30 -0400 (EDT)
Resent-Date: Mon, 27 May 1996 13:02:30 -0400 (EDT)
Message-Id: <199605271702.TAA01865@hydra.ifh.de>
To: zsh-workers@math.gatech.edu
Subject: Re: seg fault on $(dgqhghdqwdhqwjq) : beta19 
In-reply-to: "hzoli@cs.elte.hu"'s message of "Mon, 27 May 1996 03:13:45 MET."
             <199605270113.DAA01134@hzoli.ppp.cs.elte.hu> 
Date: Mon, 27 May 1996 19:02:19 +0200
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"sw9Xa1.0.rx6.b0Ugn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1191
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 1440
Status: O

hzoli@cs.elte.hu wrote:
> > res1% $(wekdwqw)
> > zsh: command not found: wekdwqw
> > zsh: 21441 segmentation fault  $(wekdwqw)
> 
> It always happens when prefork() in execcmd() removes all arguments.

It's not quite that simple: prefork turns the first argument into an
empty string, so the argument list isn't quite null and negotiates all
the tests for nonempty(args).  However, fixcline() then comes along
and unhooks the empty argument, leaving an empty list.  This is when
the trouble starts.  Maybe the substitution code needs to be smarter
and unhook its own null arguments, then we can handle empty lines
more consistently in execcmd().  I suppose this goes in prefork().

By the way, it's handled OK with double quotes present:

% zsh -fc '"$(doallmyworkforme)"'
zsh: command not found: doallmyworkforme
zsh: permission denied: 

since there's no command matching the null string.  If that's
acceptable when the quotes are missing (behaviour of other shells
suggests it isn't), a simpler solution is to adapt fixcline() to leave
an empty string if its the only thing left on the line.

Could we simply call fixcline() after or even in prefork(), leaving the
way open for sensible tests in execcmd()?

-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77330
Deutches Electronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.


