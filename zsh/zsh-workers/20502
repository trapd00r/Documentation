From zsh-workers-return-20502-mason-zsh=primenet.com.au@sunsite.dk Tue Oct 19 02:49:43 2004
Return-Path: <zsh-workers-return-20502-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12245 invoked from network); 19 Oct 2004 02:49:42 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 19 Oct 2004 02:49:42 -0000
Received: (qmail 36034 invoked from network); 19 Oct 2004 02:49:36 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 19 Oct 2004 02:49:36 -0000
Received: (qmail 11553 invoked by alias); 19 Oct 2004 02:49:22 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20502
Received: (qmail 11539 invoked from network); 19 Oct 2004 02:49:21 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 19 Oct 2004 02:49:21 -0000
Received: (qmail 35711 invoked from network); 19 Oct 2004 02:49:21 -0000
Received: from master.altlinux.ru (62.118.250.235)
  by a.mx.sunsite.dk with SMTP; 19 Oct 2004 02:49:19 -0000
Received: from solemn.turbinal.org (localhost.localdomain [127.0.0.1])
	by master.altlinux.ru (Postfix) with ESMTP id EB28DE4970
	for <zsh-workers@sunsite.dk>; Tue, 19 Oct 2004 06:49:17 +0400 (MSD)
Received: by solemn.turbinal.org (Postfix, from userid 500)
	id 235C651B51; Tue, 19 Oct 2004 06:48:28 +0400 (MSD)
Date: Tue, 19 Oct 2004 06:48:27 +0400
From: Alexey Tourbin <at@altlinux.ru>
To: zsh-workers@sunsite.dk
Subject: bug: _store_cache and ksh arrays
Message-ID: <20041019024827.GI2017@solemn.turbinal.org>
Mail-Followup-To: zsh-workers@sunsite.dk
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="xQR6quUbZ63TTuTU"
Content-Disposition: inline
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: *
X-Spam-Status: No, hits=1.5 required=6.0 tests=BAYES_44,RCVD_IN_SORBS 
	autolearn=no version=2.63
X-Spam-Hits: 1.5


--xQR6quUbZ63TTuTU
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

Hello,

I think I found a bug.  _store_cache produces wrong output when
both KSH_TYPESET and MAGIC_EQUAL_SUBST are set.

Here's a piece of code:

  for var; do
    case ${(Pt)var} in
    (*readonly*) ;;
    (*(association|array)*) print -r "$var=3D( ${(kv@Pqq)^^var} )";;
    (*)                     print -r "$var=3D${(Pqq)^^var}";;
    esac
  done >! "$_cache_dir/$_cache_ident"

And here is how to reproduce a bug:

$ var=3Dperl_modules
$ perl_modules=3D(AutoLoader DynaLoader SelfLoader)
$ emulate -R zsh
$ print -r "$var=3D( ${(kv@Pqq)^^var} )"
perl_modules=3D( 'AutoLoader' 'DynaLoader' 'SelfLoader' )
$ setopt KSH_TYPESET MAGIC_EQUAL_SUBST
$ print -r "$var=3D( ${(kv@Pqq)^^var} )"
perl_modules=3D( 'AutoLoader DynaLoader SelfLoader' )
$

So the cache data are unusable in the second case.
Actually this bug is not specific to _store_cache.

Any ideas?


--=20
Alexey Tourbin
ALT Linux Team

--xQR6quUbZ63TTuTU
Content-Type: application/pgp-signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFBdIB7fBKgtDjnu0YRAjbyAJ43M8K+f9JYFbL/gYfcXSoqLOzhiQCg0uXv
IwlgeLeOFu4ClxQIKaw+FWQ=
=fDaH
-----END PGP SIGNATURE-----

--xQR6quUbZ63TTuTU--

