From zsh-workers-return-10679-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Apr 11 22:58:05 2000
Return-Path: <zsh-workers-return-10679-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10605 invoked from network); 11 Apr 2000 22:58:05 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 11 Apr 2000 22:58:05 -0000
Received: (qmail 18828 invoked by alias); 11 Apr 2000 22:57:54 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10679
Received: (qmail 18818 invoked from network); 11 Apr 2000 22:57:53 -0000
Date: Tue, 11 Apr 2000 23:57:52 +0100
From: Adam Spiers <adam@spiers.net>
To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Subject: _complete_help troubles
Message-ID: <20000411235752.A2739@thelonious.new.ox.ac.uk>
Reply-To: Adam Spiers <adam@spiers.net>
Mail-Followup-To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
References: <20000411212619.A1605@thelonious.new.ox.ac.uk> <000411145025.ZM8942@candle.brasslantern.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 1.0.1i
In-Reply-To: <000411145025.ZM8942@candle.brasslantern.com>; from schaefer@candle.brasslantern.com on Tue, Apr 11, 2000 at 02:50:25PM -0700
X-Home-Page: http://www.new.ox.ac.uk/~adam/
X-OS: RedHat Linux

Bart Schaefer (schaefer@candle.brasslantern.com) wrote:
> Are you sure you're getting the most recent _perl_modules?  _wanted is
> called at the end and now takes a command to execute as an argument, so
> it looks to me as though you've got an updated _wanted but an older
> _perl_modules.

*sigh* Thanks, you're quite right.  My CVS working copy was perfectly
up to date, but I'd forgotten to remove some old _perl_modules from
elsewhere in my $fpath from when I was hacking on them.

> > Also, _complete_help hasn't worked for me for a while now, e.g.
> > 
> > $ ls <TAB>
> > _complete_help:39: bad pattern: \n    all-files  (_files _default)
> 
> I've no idea what would be happening there, but if _perl_modules is out
> of date then so may other things be ...

I'm pretty damn sure that everything's up to date now.  No .zwc files
around, no old functions elsewhere in $fpath ...

The relevant bit of trouble-making code is:

  for i in "${(@ok)help_funcs}"; do
    text="${text}
tags in context :completion:${i}:"
    tmp=()
    for j in "${(@s.:.)help_funcs[$i][2,-1]}"; do
      tmp=( "$tmp[@]" "${(@s.,.)help_tags[${i}${j}][2,-1]}" )
    done
    zformat -a tmp '  (' "$tmp[@]"
    tmp=( '
    '${^tmp}')' )             <<<<<< this line gives the error
    text="${text}${tmp}"
  done

tmp has the value `all-files  (_files _default' when the error occurs,
which doesn't look right.  Beyond that I'm lost, as I don't know what
_complete_help's output is supposed to be.  Sven?  Anybody?  Bueller?

