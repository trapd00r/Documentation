From zsh-workers-return-21406-mason-zsh=primenet.com.au@sunsite.dk Thu Jul 07 23:04:25 2005
Return-Path: <zsh-workers-return-21406-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16046 invoked from network); 7 Jul 2005 23:04:24 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 7 Jul 2005 23:04:24 -0000
Received: (qmail 43911 invoked from network); 7 Jul 2005 23:04:17 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 Jul 2005 23:04:17 -0000
Received: (qmail 24546 invoked by alias); 7 Jul 2005 23:04:15 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21406
Received: (qmail 24536 invoked from network); 7 Jul 2005 23:04:14 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 7 Jul 2005 23:04:14 -0000
Received: (qmail 43617 invoked from network); 7 Jul 2005 23:04:14 -0000
Received: from wproxy.gmail.com (64.233.184.198)
  by a.mx.sunsite.dk with SMTP; 7 Jul 2005 23:04:10 -0000
Received: by wproxy.gmail.com with SMTP id i34so308349wra
        for <zsh-workers@sunsite.dk>; Thu, 07 Jul 2005 16:04:09 -0700 (PDT)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:date:from:to:subject:message-id:organization:x-mailer:mime-version:content-type:content-transfer-encoding;
        b=hHOPKrFNcDqQRp316A3uvAuHAaUHpYoIR2Ye1LXCpuni55/TYtNAzIY9T/oqgcpkTT6ZWr3mSmgMCgp7JfN/ZRaOPYyxTuKf0Tw/RqcaHYzow3koUC9mFK4yzxnCgIiWFwOdhRblBmh+aBK30IIWKhzZylBQE6mIL7QtGDaLzu8=
Received: by 10.54.36.75 with SMTP id j75mr1142174wrj;
        Thu, 07 Jul 2005 16:04:07 -0700 (PDT)
Received: from baron.pp.ru ([85.95.173.6])
        by mx.gmail.com with ESMTP id 9sm1786094wrl.2005.07.07.16.04.04;
        Thu, 07 Jul 2005 16:04:07 -0700 (PDT)
Date: Fri, 8 Jul 2005 03:04:00 +0400
From: "Ruslan N. Balkin" <ruslanbalkin@gmail.com>
To: zsh-workers@sunsite.dk
Subject: zsh (CVS) and unicode
Message-ID: <20050708030400.321ec1f3@baron.pp.ru>
Organization: Wirebyte Research Lab
X-Mailer: Sylpheed-Claws 1.9.9 (GTK+ 2.6.7; i686-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-1.3 required=6.0 tests=AWL,BAYES_00,RCVD_BY_IP,
	RCVD_IN_BL_SPAMCOP_NET autolearn=no version=3.0.2
X-Spam-Hits: -1.3

Hi

First of all, I'm new to this list and first thing i want to do is to thank
developers for perfect shell and for first UTF-8 steps were already done at
the moment. After switching to UTF-8, I understood how bad is that i can't
use my zsh 4.2.5 with utf-8 locale.

I tried cvs version to see whether i can help with testing and/or development
of utf-8 support, but i'm not that familiar with development for linux, nor
with C, nor with zsh sources, the only thing i know by searching zsh maillists,
is that utf-8 support is not fully ready within zle module.

I haven't find any guidelines to compiling CVS version other than few lines in
FAQ, so i uncommented in ./Src/system.h:#define ZLE_UNICODE_SUPPORT      1
and since then, i was able to write cyrillic letters with zsh.

Even better, they seem to work, so for example i can use
mplayer <cyrillic_here>. But current CVS of zsh, after i enable
ZLE_UNICODE_SUPPORT, crashes on tab-completion of these names. I can post a
backtrace from gdb on your request, but to my eyes it isn't very useful.
(yes my binary was compiled with debug flags on and unstripped, but backtrace
is reportet to be several screens long, and bt full terminates on frame 1).
Maybe these errors are even usable for you -
BUG: substring ends in the middle of a metachar in ztrsub()
BUG: 0 <= wb <= zlecs <= we is not true!
Segmentation fault (core dumped)

If I did something wrong, please excuse me, but i haven't found much information
about zsh and utf-8, and mail list search is not very usable. If i can help
somehow, please let me know if you need my backtraces or help in testing
something. 
P.S. The crash is reproducible here always, when i enable ZLE_UNICODE_SUPPORT.
P.P.S. Thanks for your work, the greatest shell ever existed.
P.P.P.S. I'm running gentoo, 2.3.4glibc, ru_RU.UTF-8 locale, gcc version is 3.3.5
and running on 32 bit AMD processor.

-- 
Ruslan

