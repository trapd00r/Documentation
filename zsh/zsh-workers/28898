From zsh-workers-return-28898-mason-zsh=primenet.com.au@zsh.org Thu Mar 17 04:04:36 2011
Return-Path: <zsh-workers-return-28898-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16969 invoked by alias); 17 Mar 2011 04:04:36 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28898
Received: (qmail 18583 invoked from network); 17 Mar 2011 04:04:26 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_NONE
	autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at closedmail.com does not designate permitted sender hosts)
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <110316210401.ZM25580@torch.brasslantern.com>
Date: Wed, 16 Mar 2011 21:04:01 -0700
In-reply-to: <1300306570-24592-1-git-send-email-ft@bewatermyfriend.org>
Comments: In reply to Frank Terbeck <ft@bewatermyfriend.org>
 "PATCH: edit-command-line: disable `monitor' option locally" (Mar 16,  9:16pm)
References: <1300306570-24592-1-git-send-email-ft@bewatermyfriend.org>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: zsh-workers@zsh.org
Subject: Re: PATCH: edit-command-line: disable `monitor' option locally
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii

On Mar 16,  9:16pm, Frank Terbeck wrote:
} Subject: PATCH: edit-command-line: disable `monitor' option locally
}
} I was just told, that suspending an editor while using
} `edit-command-line' will cause the command line to be lost, yielding
} this:
} 
} edit-command-line:zle:17: widgets can only be called when ZLE is active
} 
} Which makes sense.

Hmm.  I don't have this problem.  If I suspend from edit-command-line I
get brought back to the prompt and the previous input is all still there.
I can resume the editor with "fg" (at which point vim gives me an error
about the file no longer existing); if I write, exit, and then repeat
the edit-command-line keystroke, I'm back in the editor looking at the
stuff I wrote out a minute before, and if I now exit again that stuff
is loaded onto the command line.
 
} So, in order to shield users from accidential dataloss, this patch
} unsets the `monitor' option temporarily. That does the trick for me and
} I don't think there is anything this would break.

On the other hand if I put in this patch, then when I try to resume the
backgrounded editor I end up in a *very* strange state where the shell
is not responding to anything, and I have to go off to another window
and kill -CONT the editor before I can proceed.  In that case vim dies
almost immediately with "Vim: Error reading input, exiting..."
 
} If I'm missing something, yell.

I think perhaps this behaves very differently in different contexts.
Restartable system calls may be the difference, I don't know which
platform has the trouble that you described.

