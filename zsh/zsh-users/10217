From zsh-users-return-10217-mason-zsh=primenet.com.au@sunsite.dk Fri May 05 08:56:05 2006
Return-Path: <zsh-users-return-10217-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18122 invoked from network); 5 May 2006 08:56:03 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.1 (2006-03-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 May 2006 08:56:03 -0000
Received: (qmail 94153 invoked from network); 5 May 2006 08:55:55 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 May 2006 08:55:55 -0000
Received: (qmail 21204 invoked by alias); 5 May 2006 08:55:47 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10217
Received: (qmail 21195 invoked from network); 5 May 2006 08:55:47 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 5 May 2006 08:55:47 -0000
Received: (qmail 93041 invoked from network); 5 May 2006 08:55:47 -0000
Received: from cluster-d.mailcontrol.com (217.69.20.190)
  by a.mx.sunsite.dk with SMTP; 5 May 2006 08:55:46 -0000
Received: from exchange03.csr.com (uuk202166.uk.customer.alter.net [62.189.241.194] (may be forged))
	by rly25d.srv.mailcontrol.com (MailControl) with ESMTP id k458tgw8017314
	for <zsh-users@sunsite.dk>; Fri, 5 May 2006 09:55:42 +0100
Received: from csr.com ([10.103.143.38]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Fri, 5 May 2006 09:55:42 +0100
To: zsh-users@sunsite.dk
Subject: Re: print -s and History Expansion 
In-reply-to: <20060504190631.GA29447@namib.cs.utk.edu> 
References: <20060502191022.GA30399@namib.cs.utk.edu> <200605022147.k42LlWC9003204@pwslaptop.csr.com> <20060504190631.GA29447@namib.cs.utk.edu>
Comments: In-reply-to Chris Johnson <cjohnson@cs.utk.edu>
   message dated "Thu, 04 May 2006 15:06:31 -0400."
Date: Fri, 05 May 2006 09:55:42 +0100
From: Peter Stephenson <pws@csr.com>
Message-ID: <EXCHANGE03IEAOeIiGX00000e9c@exchange03.csr.com>
X-OriginalArrivalTime: 05 May 2006 08:55:42.0247 (UTC) FILETIME=[B067EB70:01C67021]
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A-06-00-05 (www.mailcontrol.com) on 10.68.0.135

Chris Johnson wrote:
>    commit-to-history() {
>       # zsplit current command, expand result to all its quoted fields
>       # ("f1" "f2" "f3"), prepend it with a command to make it written
>       # to history, and then execute it.
>       BUFFER=" print -s ${${(z)BUFFER}[@]}"
>       zle accept-line
>    }
>    zle -N commit-to-history
>    bindkey "^X^H" commit-to-history
> 
> I tried using ${(qq){$(z)BUFFER}} but that didn't work.

To avoid the extra command line execution I would use:

commit-to-history() {
  print -s ${(z)BUFFER}
  BUFFER=
  zle accept-line
}

then there are no quoting problems.  You still need the accept-line if
you plan on using what you've just added to the history immediately,
since otherwise the history isn't reread.  However, it's now on an empty
buffer.

> Perhaps I could have stuck with the simpler bind, but it seems that
> somehow I need to get the command into a parameter before I can split
> it.  Is there any way to expand literals?

There's no way to avoid using a parameter without doing worse things.  Zle
widgets are anyway more readable and predictable than bindkey -s tricks.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


To access the latest news from CSR copy this link into a web browser:  http://www.csr.com/email_sig.php

