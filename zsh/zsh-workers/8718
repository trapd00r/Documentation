From zsh-workers-return-8718-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Nov 22 09:49:30 1999
Return-Path: <zsh-workers-return-8718-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21271 invoked from network); 22 Nov 1999 09:49:29 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 22 Nov 1999 09:49:29 -0000
Received: (qmail 2854 invoked by alias); 22 Nov 1999 09:49:24 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8718
Received: (qmail 2847 invoked from network); 22 Nov 1999 09:49:24 -0000
Date: Mon, 22 Nov 1999 10:49:15 +0100 (MET)
Message-Id: <199911220949.KAA05105@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: mason@primenet.com.au's message of 22 Nov 1999 02:48:53 GMT
Subject: Re: BUG: 3.1.6-pws-9: problems with fignore


Geoff Wing wrote:

> Heyla,
>       "fignore <S> <Z> (FIGNORE <S>)
>               An array (colon separated list) containing the suf-
>               fixes of files to be ignored during  filename  com-
>               pletion.  However, if the completion generates only
>               files which would match if this variable  would  be
>               ignored, than these files are completed anyway."
> 
> 1) fignore is for file completion, not directory completion.

Err. I always thought directories were files. And if I have a
directory named `foo~' I don't think I'd want to see it.

How about turning fignore into a style? Oops... sounds like a good
idea, doesn't it?

> 2) No completions with fignore used, but completions without it therefore
>    complete without it.
> 
> % mkdir /tmp/foo
> % cd /tmp/foo
> % touch BLAH.org
> % ls BLA<TAB>

Yep, thinko in addmatches(): fignore should only be used when really
adding matches otherwise the possible matches get sorted out before we 
know that there are no matches when fignore is used.

Bye
 Sven

diff -u oldsrc/Zle/compcore.c Src/Zle/compcore.c
--- oldsrc/Zle/compcore.c	Tue Nov 16 10:07:51 1999
+++ Src/Zle/compcore.c	Mon Nov 22 10:46:57 1999
@@ -1735,7 +1735,7 @@
 		}
 		sl = strlen(s);
 		isalt = oisalt;
-		if ((!dat->psuf || !*(dat->psuf)) && aign) {
+		if (doadd && (!dat->psuf || !*(dat->psuf)) && aign) {
 		    /* Do the suffix-test. If the match has one of the
 		     * suffixes from ign, we put it in the alternate set. */
 		    char **pt = aign;
@@ -1745,12 +1745,6 @@
 			if ((filell = strlen(*pt)) < sl
 			    && !strcmp(*pt, s + sl - filell))
 			    isalt = 1;
-
-		    if (isalt && !doadd) {
-			if (dparr && !*++dparr)
-			    dparr = NULL;
-			continue;
-		    }
 		}
 		if (!(dat->aflags & CAF_MATCH)) {
 		    if (dat->aflags & CAF_QUOTE)

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

