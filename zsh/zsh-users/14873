From zsh-users-return-14873-mason-zsh=primenet.com.au@zsh.org Tue Feb 23 23:03:03 2010
Return-Path: <zsh-users-return-14873-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1776 invoked by alias); 23 Feb 2010 23:03:03 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14873
Received: (qmail 1215 invoked from network); 23 Feb 2010 23:03:02 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=0.1 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received-SPF: softfail (ns1.primenet.com.au: transitioning SPF record at alum.mit.edu does not designate 18.9.62.90 as permitted sender)
Date: Tue, 23 Feb 2010 18:02:59 -0500 (EST)
From: Darryl Zurn <darryl.zurn@alum.mit.edu>
To: zsh-users@zsh.org
Message-ID: <952282.3121.1266966179597.JavaMail.cyyang@brunch.mit.edu>
Subject: Bad substitution in Parameter Expansion
MIME-Version: 1.0
Content-Type: multipart/mixed; 
	boundary="----=_Part_3120_3310180.1266966179596"

------=_Part_3120_3310180.1266966179596
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

I=E2=80=99m using zsh 4.3.6 (i386-apple-darwin8.11.1) on Mac OS X 10.5.8

I am trying to write a little function to transmogrify a copied filepath in=
to something I can cd to, quickly. I have the path which looks something li=
ke this:

  Document Control:Volume2:530XX:53043:B1&B2:53043B1&2_4.dwg

And I want it to look like this for a proper cd command:

  cd /Volumes/Document\ Control/Volume2/530XX/53043/B1&B2/

Note that I need to add =E2=80=9C/Volumes/=E2=80=9D to the front, I need to=
 replace all colons with forward-slashes, then I need to escape all spaces =
with =E2=80=9C\ =E2=80=9D. Then I take just the directory path without file=
name.

I can get the pieces to work on Terminal.app using this sequence:

(13:41:%)  mytext=3D'Document Control:Volume2:530XX:53043:B1&B2:53043B1&2_4=
.dwg'

(13:42:%)  nocolons=3D${mytext//:/\/}

(13:43:%)  echo $nocolons
Document Control/Volume2/530XX/53043/B1&B2/53043B1&2_4.dwg
(13:44:%)  nospaces=3D${nocolons// /\\ }

(13:44:%)  echo $nospaces
Document\ Control/Volume2/530XX/53043/B1&B2/53043B1&2_4.dwg
(13:44:%)  echo $nospaces:h
Document\ Control/Volume2/530XX/53043/B1&B2

Here=E2=80=99s what happens when I put it into a simple function:
(16:51:%)  dt () {
(function)    if [[ -z $1 ]]
(function if)         then
(function then)               print Need arguments
(function then)       else
(function else)               mytext=3D$1
(function else)               convertcolons=3D${$mytext//:/\/}
(function else)               convertspaces=3D${$convertcolons// /\\ }=20
(function else)               basename=3D${$convertspaces:h}=20
(function else)               cd '/Volumes/'$basename
(function else)       fi
(function)   }
(16:51:%)   dt 'Document Control:Volume2:530XX:53043:B1&B2:53043B1&2_4.dwg'
dt:6: bad substitution


I don=E2=80=99t have much experience with this type of parameter expansion,=
 I got these from the 4.3.6 zsh manual but I=E2=80=99m stumped why it won=
=E2=80=99t work in a function. I had it all smashed into one long =E2=80=98=
cd=E2=80=99 command, but that didn=E2=80=99t work any better so I refactore=
d it to see where the bad substitution is coming from.

Any help is appreciated! Thanks
Darryl


------=_Part_3120_3310180.1266966179596--

