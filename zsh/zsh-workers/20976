From zsh-workers-return-20976-mason-zsh=primenet.com.au@sunsite.dk Mon Mar 14 07:55:05 2005
Return-Path: <zsh-workers-return-20976-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15553 invoked from network); 14 Mar 2005 07:55:04 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 14 Mar 2005 07:55:04 -0000
Received: (qmail 59639 invoked from network); 14 Mar 2005 07:54:58 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 14 Mar 2005 07:54:58 -0000
Received: (qmail 19597 invoked by alias); 14 Mar 2005 07:54:55 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20976
Received: (qmail 19586 invoked from network); 14 Mar 2005 07:54:55 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 14 Mar 2005 07:54:55 -0000
Received: (qmail 59348 invoked from network); 14 Mar 2005 07:54:55 -0000
Received: from tantale.fifi.org (64.81.251.130)
  by a.mx.sunsite.dk with SMTP; 14 Mar 2005 07:54:50 -0000
Received: from ceramic.fifi.org (Debian-exim@ceramic.fifi.org [64.81.251.131])
	by tantale.fifi.org (8.9.3p2/8.9.3/Debian 8.9.3-21) with ESMTP id XAA25447;
	Sun, 13 Mar 2005 23:54:47 -0800
Received: from phil by ceramic.fifi.org with local (Exim 4.34)
	id 1DAkPX-0006oB-Kx; Sun, 13 Mar 2005 23:54:47 -0800
Cc: Bart Schaefer <schaefer@brasslantern.com>
To: <zsh-workers@sunsite.dk>
Subject: Re: Re[2]: SIGTTOU old problem
References: <20050228142904.21251.qmail@flock1.newmail.ru>
	<87mztobtdj.fsf@ceramic.fifi.org>
Mail-Copies-To: nobody
From: Philippe Troin <phil@fifi.org>
Date: 13 Mar 2005 23:54:47 -0800
In-Reply-To: <87mztobtdj.fsf@ceramic.fifi.org>
Message-ID: <87sm2yslvc.fsf@ceramic.fifi.org>
Lines: 41
User-Agent: Gnus/5.09 (Gnus v5.9.0) Emacs/21.2
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="=-=-="
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.4

--=-=-=
Content-Type: text/plain; charset=iso-8859-5
Content-Transfer-Encoding: quoted-printable

Will someone (Bart?) apply this patch?

Phil.

Philippe Troin <phil@fifi.org> writes:

> Borzenkov Andrey <arvidjaar@newmail.ru> writes:
>=20
> > Hello Philippe Troin=20
> >=20
> > =BF=DD, 28.02.2005 18:29:43 you wrote:
> > PT> > -    trap "" SIGTTOU > /dev/null 2>&1 || :
> > PT> > +    ( trap "" SIGTTOU > /dev/null 2>&1 ) && trap "" SIGTTOU > /d=
ev/null 2>&1=20
> > PT> Why?  What does it buy?
> > PT>=20
> >=20
> > SUS specifies that trap is special builtin so error in "trap" should
> > terminate non-interactive shell. On my system (and as Peter hinted
> > probably everywhere else) trap SIGTTOU is invalid (trap TTOU is
> > valid) so configure exits without any chance to see || :.
>=20
> Got to love these "special" builtins.  Yet another kind of weird
> dehavior.
>=20
> > To the author of original check - please test if my patch works for
> > you as intended and I commit it. Alternative is to change it into
> > "trap "" TTOU" that is likely to be more portable.
>=20
> This will work as intended.  I'd rather use TTOU since it's more
> portable.
>=20
> Patch enclosed.
>=20
> Phil.
>=20
> 2005-02-28  Philippe Troin  <phil@fifi.org>
>=20
> 	* 20886: configure.ac: Use TTOU with trap rather than SIGTTOU.


--=-=-=
Content-Type: text/x-patch
Content-Disposition: attachment; filename=zsh-ttou.patch

Index: configure.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.ac,v
retrieving revision 1.29
diff -b -u -r1.29 configure.ac
--- configure.ac	24 Feb 2005 16:53:09 -0000	1.29
+++ configure.ac	28 Feb 2005 15:22:59 -0000
@@ -1863,7 +1863,7 @@
 if test "x$ac_cv_func_tcsetpgrp" = xyes; then
 case "x$zsh_working_tcsetpgrp" in
   xcheck)
-    trap "" SIGTTOU > /dev/null 2>&1 || :
+    trap "" TTOU > /dev/null 2>&1 || :
     AC_CACHE_CHECK(if tcsetpgrp() actually works,
     zsh_cv_sys_tcsetpgrp,
     [AC_TRY_RUN([
@@ -1894,7 +1894,7 @@
 Try running configure with --with-tcsetpgrp or --without-tcsetpgrp]);;
       *)      AC_MSG_ERROR([unexpected return status]);;
     esac
-    trap - SIGTTOU > /dev/null 2>&1 || :
+    trap - TTOU > /dev/null 2>&1 || :
     ;;
   xyes) :;;
   xno)  AC_DEFINE(BROKEN_TCSETPGRP);;

--=-=-=--

