From zsh-workers-return-22988-mason-zsh=primenet.com.au@sunsite.dk Wed Nov 08 19:43:21 2006
Return-Path: <zsh-workers-return-22988-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27475 invoked from network); 8 Nov 2006 19:43:10 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 8 Nov 2006 19:43:10 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 85217 invoked from network); 8 Nov 2006 19:42:59 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 8 Nov 2006 19:42:59 -0000
Received: (qmail 10903 invoked by alias); 8 Nov 2006 19:42:57 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22988
Received: (qmail 10894 invoked from network); 8 Nov 2006 19:42:56 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 8 Nov 2006 19:42:56 -0000
Received: (qmail 85013 invoked from network); 8 Nov 2006 19:42:56 -0000
Received: from mailfe10.tele2.fr (HELO swip.net) (212.247.155.44)
  by a.mx.sunsite.dk with SMTP; 8 Nov 2006 19:42:51 -0000
X-T2-Posting-ID: mBXjJ9CYMpI3HGlT2s4LT8j3JzBVs7ioB0ePn7y7rgg=
X-Cloudmark-Score: 0.000000 []
Received: from [213.103.122.53] (HELO localhost)
  by mailfe10.swip.net (CommuniGate Pro SMTP 5.0.12)
  with ESMTPS id 152344358 for zsh-workers@sunsite.dk; Wed, 08 Nov 2006 20:42:49 +0100
Date: Wed, 8 Nov 2006 20:42:49 +0100
From: "arno." <arno.@no-log.org>
To: zsh-workers@sunsite.dk
Subject: bug : _make and special parameters
Message-ID: <20061108194249.GA8389@localhost.localdomain>
MIME-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="wac7ysb48OaltWcw"
Content-Disposition: inline
User-Agent: Mutt/1.5.13 (2006-08-11)


--wac7ysb48OaltWcw
Content-Type: text/plain; charset=iso-8859-15
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

Hi,
I downloaded qiv sources, went in the right directory, typed "make" and=20
<TAB>

I got the error :  (eval):1: read-only variable: CURSOR

This is because in _make, Makefile lines are parsed to find for=20
variables declarations, and then assigned with :=20
eval $var=3D\$val

But in qiv Makefile, there is the line :
CURSOR =3D 84
and CURSOR is a parameter special in zsh.

That problem could happen with any special parameters.

I found a solution by adding the line=20
typeset -h $var=20
just before eval

I don't known if there could be drawbacks with my fix, but I still send=20
it.

arno.


? _make.patch
Index: Completion/Unix/Command/_make
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_make,v
retrieving revision 1.17
diff -u -r1.17 _make
--- Completion/Unix/Command/_make	9 Feb 2006 14:51:32 -0000	1.17
+++ Completion/Unix/Command/_make	8 Nov 2006 19:31:11 -0000
@@ -60,6 +60,7 @@
 	    var=3D${input%%[ $TAB]#=3D*}
 	    val=3D${input#*=3D}
 	    val=3D${val##[ $TAB]#}
+       local -h $var
 	    eval $var=3D\$val
 	    ;;
 	([[:alnum:]][[:alnum:]_]#[ $TAB]#:=3D*)
@@ -67,6 +68,7 @@
 	    val=3D${input#*=3D}
 	    val=3D${val##[ $TAB]#}
 	    val=3D$(expandVars 10 $val)
+       local -h $var
 	    eval $var=3D\$val
 	    ;;
 	([[:alnum:]][^$TAB:=3D]#:[^=3D]*)

--wac7ysb48OaltWcw
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Digital signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.5 (GNU/Linux)

iD8DBQFFUjM5iH9aBScBsrMRArx0AJ9O76iWl/QkMO77DrUGY2MeWKnFJQCgk/MK
UoVNMdMm/jqqskMr4QpsJb8=
=p10n
-----END PGP SIGNATURE-----

--wac7ysb48OaltWcw--

