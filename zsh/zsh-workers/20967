From zsh-workers-return-20967-mason-zsh=primenet.com.au@sunsite.dk Fri Mar 11 10:40:42 2005
Return-Path: <zsh-workers-return-20967-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8386 invoked from network); 11 Mar 2005 10:40:41 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 11 Mar 2005 10:40:41 -0000
Received: (qmail 88886 invoked from network); 11 Mar 2005 10:40:34 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 11 Mar 2005 10:40:34 -0000
Received: (qmail 10440 invoked by alias); 11 Mar 2005 10:40:26 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20967
Received: (qmail 10314 invoked from network); 11 Mar 2005 10:40:24 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 11 Mar 2005 10:40:24 -0000
Received: (qmail 86799 invoked from network); 11 Mar 2005 10:40:21 -0000
Received: from master.altlinux.ru (62.118.250.235)
  by a.mx.sunsite.dk with SMTP; 11 Mar 2005 10:40:17 -0000
Received: from solemn.turbinal.org (localhost.localdomain [127.0.0.1])
	by master.altlinux.ru (Postfix) with ESMTP id 5393FE6231
	for <zsh-workers@sunsite.dk>; Fri, 11 Mar 2005 13:40:16 +0300 (MSK)
Received: by solemn.turbinal.org (Postfix, from userid 500)
	id BF59A54051; Fri, 11 Mar 2005 13:36:29 +0300 (MSK)
Date: Fri, 11 Mar 2005 13:36:29 +0300
From: Alexey Tourbin <at@altlinux.ru>
To: zsh-workers@sunsite.dk
Subject: apt4rpm completion: _apt
Message-ID: <20050311103629.GG27647@solemn.turbinal.org>
Mail-Followup-To: zsh-workers@sunsite.dk
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="AqCDj3hiknadvR6t"
Content-Disposition: inline
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6


--AqCDj3hiknadvR6t
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

The next step is to modify _apt completion so that it can check host
system type and use _rpm_packages whenever applicable:

--- zsh-4.2.4/Completion/Debian/Command/_apt-	2004-08-01 14:48:24 +0000
+++ zsh-4.2.4/Completion/Debian/Command/_apt	2005-03-11 10:33:49 +0000
@@ -1,6 +1,8 @@
 #compdef apt-get apt-cache apt-cdrom apt-config
=20
 _apt () {
+  local deb=3Ddeb
+  [ -f /etc/debian_version ] || deb=3Drpm
   case "$service" in
     apt-get) _apt-get "$@";;
     apt-cache) _apt-cache "$@";;
@@ -423,16 +425,16 @@ _apt-get () {
     /$'update\0'/ \| \
     /$'upgrade\0'/ \| \
     \( \
-    /$'install\0'/ /$'[^\0]#\0'/ ':packages::_deb_packages "$expl_packages=
[@]" avail' \# \
+    /$'install\0'/ /$'[^\0]#\0'/ :packages::_${deb}_packages' "$expl_packa=
ges[@]" avail' \# \
     /$'[^\0/]#/'/ /$'[^\0/]#\0'/ ':release name::_apt_releases' \) \| \
-    /$'remove\0'/ /$'[^\0]#\0'/ ':packages::_deb_packages "$expl_packages[=
@]" installed' \# \| \
+    /$'remove\0'/ /$'[^\0]#\0'/ :packages::_${deb}_packages' "$expl_packag=
es[@]" installed' \# \| \
     /$'dist-upgrade\0'/ \| \
     /$'dselect-upgrade\0'/ \| \
     /$'clean\0'/ \| \
     /$'autoclean\0'/ \| \
     /$'check\0'/ \| \
-    /$'source\0'/ /$'[^\0]#\0'/ ':packages::_deb_packages "$expl_packages[=
@]" avail' \# \| \
-    /$'build-dep\0'/ /$'[^\0]#\0'/ ':packages::_deb_packages "$expl_packag=
es[@]" avail' \# \| \
+    /$'source\0'/ /$'[^\0]#\0'/ :packages::_${deb}_packages' "$expl_packag=
es[@]" avail' \# \| \
+    /$'build-dep\0'/ /$'[^\0]#\0'/ :packages::_${deb}_packages' "$expl_pac=
kages[@]" avail' \# \| \
     /$'help\0/' \| \
     /"[]"/	':argument-1::compadd "$expl_action[@]" update upgrade install =
remove dist-upgrade dselect-upgrade clean autoclean check source build-dep =
help'
=20
@@ -467,20 +469,20 @@ _apt-cache () {
     /$'help\0'/ \| \
     /$'add\0'/ /$'[^\0]#\0'/ ':files:index files:_files "$expl[@]"' \# \| \
     /$'gencaches\0'/ \| \
-    /$'showpkg\0'/ /$'[^\0]#\0'/ ':packages::_deb_packages "$expl_packages=
[@]" avail' \# \| \
-    /$'showsrc\0'/ /$'[^\0]#\0'/ ':packages::_deb_packages "$expl_packages=
[@]" avail' \# \| \
+    /$'showpkg\0'/ /$'[^\0]#\0'/ :packages::_${deb}_packages' "$expl_packa=
ges[@]" avail' \# \| \
+    /$'showsrc\0'/ /$'[^\0]#\0'/ :packages::_${deb}_packages' "$expl_packa=
ges[@]" avail' \# \| \
     /$'stats\0'/ \| \
     /$'dump\0'/ \| \
     /$'dumpavail\0'/ \| \
     /$'unmet\0'/ \| \
     /$'search\0'/ /$'[^\0]#\0'/ ':strings:pattern:' \| \
-    /$'show\0'/ /$'[^\0]#\0'/ ':packages::_deb_packages "$expl_packages[@]=
" avail' \# \| \
-    /$'depends\0'/ /$'[^\0]#\0'/ ':packages::_deb_packages "$expl_packages=
[@]" avail' \# \| \
-    /$'rdepends\0'/ /$'[^\0]#\0'/ ':packages::_deb_packages "$expl_package=
s[@]" avail' \# \| \
+    /$'show\0'/ /$'[^\0]#\0'/ :packages::_${deb}_packages' "$expl_packages=
[@]" avail' \# \| \
+    /$'depends\0'/ /$'[^\0]#\0'/ :packages::_${deb}_packages' "$expl_packa=
ges[@]" avail' \# \| \
+    /$'rdepends\0'/ /$'[^\0]#\0'/ :packages::_${deb}_packages' "$expl_pack=
ages[@]" avail' \# \| \
     /$'pkgnames\0'/ /$'[^\0]#\0'/ ':strings:prefix:' \| \
-    /$'dotty\0'/ /$'[^\0]#\0'/ ':packages::_deb_packages "$expl_packages[@=
]" avail' \# \| \
-    /$'xvcg\0'/ /$'[^\0]#\0'/ ':packages::_deb_packages "$expl_packages[@]=
" avail' \# \| \
-    /$'policy\0'/ /$'[^\0]#\0'/ ':packages::_deb_packages "$expl_packages[=
@]" avail' \# \| \
+    /$'dotty\0'/ /$'[^\0]#\0'/ :packages::_${deb}_packages' "$expl_package=
s[@]" avail' \# \| \
+    /$'xvcg\0'/ /$'[^\0]#\0'/ :packages::_${deb}_packages' "$expl_packages=
[@]" avail' \# \| \
+    /$'policy\0'/ /$'[^\0]#\0'/ :packages::_${deb}_packages' "$expl_packag=
es[@]" avail' \# \| \
     /"[]"/ ':argument-1::compadd "$expl_action[@]" help add gencaches show=
pkg showsrc stats dump dumpavail unmet search show depends rdepends pkgname=
s dotty policy xvcg'
=20
   _apt-cache () {
End of patch

--AqCDj3hiknadvR6t
Content-Type: application/pgp-signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.5 (GNU/Linux)

iD8DBQFCMXStfBKgtDjnu0YRAkP2AJ9OaANMihytGEV2GKoYbajpZxHK4ACg1ss5
ueGhe7oSu/x89WNPP0hNa28=
=qX1x
-----END PGP SIGNATURE-----

--AqCDj3hiknadvR6t--

