From zsh-workers-return-20603-mason-zsh=primenet.com.au@sunsite.dk Mon Dec 06 10:42:35 2004
Return-Path: <zsh-workers-return-20603-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13527 invoked from network); 6 Dec 2004 10:42:34 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 6 Dec 2004 10:42:34 -0000
Received: (qmail 88347 invoked from network); 6 Dec 2004 10:42:28 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 6 Dec 2004 10:42:28 -0000
Received: (qmail 10710 invoked by alias); 6 Dec 2004 10:42:13 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20603
Received: (qmail 10697 invoked from network); 6 Dec 2004 10:42:12 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 6 Dec 2004 10:42:11 -0000
Received: (qmail 87634 invoked from network); 6 Dec 2004 10:41:14 -0000
Received: from caraldi.com (HELO oxyd.caraldi.com) (195.137.249.52)
  by a.mx.sunsite.dk with SMTP; 6 Dec 2004 10:41:13 -0000
Received: from vision.anyware (unknown [84.96.21.10])
	by oxyd.caraldi.com (Postfix) with ESMTP id 1CEEF2121
	for <zsh-workers@sunsite.dk>; Mon,  6 Dec 2004 11:41:12 +0100 (CET)
Received: by vision.anyware (Postfix, from userid 615)
	id 174586283; Mon,  6 Dec 2004 11:41:20 +0100 (CET)
Date: Mon, 6 Dec 2004 11:41:19 +0100
From: Jean-Baptiste Quenot <jb.quenot@caraldi.com>
To: zsh-workers@sunsite.dk
Subject: [PATCH] Ant completion improvement
Message-ID: <20041206104117.GB1617@vision.anyware>
Mail-Followup-To: Jean-Baptiste Quenot <jb.quenot@caraldi.com>,
	zsh-workers@sunsite.dk
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="OgqxwSJOaUobr8KG"
Content-Disposition: inline
User-Agent: Mutt/1.5.6i
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0


--OgqxwSJOaUobr8KG
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hello!

Thanks for zsh: it's great.

The example below does not return completion for the "build" target
without the patch (replace ^Is with tabs):

^I^I<target name="build" depends="init">

The example below does not return completion for the "build" target
without the patch:

<target depends="init" name="build">

Please find attached a patch against 4.2.1 to allow ant completion to:

1) match leading tabs before the <target/> elements
2) match the target's "name" attribute not just on the first position

Thanks in advance,
-- 
Jean-Baptiste Quenot
http://caraldi.com/jbq/

--OgqxwSJOaUobr8KG
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename=patch-zsh-ant-completion

--- _ant.orig	Mon Dec  6 11:22:13 2004
+++ _ant	Mon Dec  6 11:40:46 2004
@@ -86,7 +86,7 @@
 	buildfile=${(v)opt_args[(I)(-f|-file|-buildfile)]:-build.xml}
       fi
       if [[ -f $buildfile ]]; then
-        targets=( $(sed -n "s/ *<target name=[\"']\([^\"']*\)[\"'].*/\1/p" < $buildfile) )
+        targets=( $(sed -n "s/[ 	]*<target *[^>]* name=[\"']\([^\"']*\)[\"'].*/\1/p" < $buildfile) )
 	_wanted targets expl target compadd -a targets && ret=0
       else
 	_message -e targets target

--OgqxwSJOaUobr8KG--

