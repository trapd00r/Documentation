From zsh-workers-return-17011-mason-zsh=primenet.com.au@sunsite.dk Thu Apr 18 10:53:01 2002
Return-Path: <zsh-workers-return-17011-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12797 invoked from network); 18 Apr 2002 10:53:00 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 18 Apr 2002 10:53:00 -0000
Received: (qmail 4586 invoked by alias); 18 Apr 2002 10:52:53 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 17011
Received: (qmail 4574 invoked from network); 18 Apr 2002 10:52:52 -0000
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: PATCH: freehostent
Date: Thu, 18 Apr 2002 11:52:23 +0100
Message-ID: <5411.1019127143@csr.com>
From: Peter Stephenson <pws@csr.com>

A while ago I was having problems with freehostent, and seeing a
definition in tcp.c, assumed it was clashing with a library function.
However, that was there to replace the library function in case it
wasn't available, so it should have been calling the lbrary function
after all.

The problem I was having seems to have gone, maybe as part of the other
tcp tidy-ups around the same time, so this puts it back the way it
should be.

Index: Src/Modules/tcp.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/tcp.c,v
retrieving revision 1.21
diff -u -r1.21 tcp.c
--- Src/Modules/tcp.c	26 Oct 2001 17:15:21 -0000	1.21
+++ Src/Modules/tcp.c	18 Apr 2002 10:49:49 -0000
@@ -194,7 +194,7 @@
 
 /**/
 mod_export void
-zfreehostent(struct hostent *ptr)
+freehostent(struct hostent *ptr)
 {
 }
 
Index: Src/Modules/zftp.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/zftp.c,v
retrieving revision 1.24
diff -u -r1.24 zftp.c
--- Src/Modules/zftp.c	26 Oct 2001 17:15:21 -0000	1.24
+++ Src/Modules/zftp.c	18 Apr 2002 10:49:49 -0000
@@ -1793,7 +1793,7 @@
 		tcp_close(zfsess->control);
 		zfsess->control = NULL;
 	    }
-	    zfreehostent(zhostp);
+	    freehostent(zhostp);
 	    zfunsetparam("ZFTP_HOST");
 	    FAILED();
 	    zwarnnam(name, "socket failed: %e", NULL, errno);
@@ -1821,7 +1821,7 @@
 	}
 
 	if (err) {
-	    zfreehostent(zhostp);
+	    freehostent(zhostp);
 	    zfclose(0);
 	    FAILED();
 	    zwarnnam(name, "connect failed: %e", NULL, errno);
@@ -1842,7 +1842,7 @@
 	zsh_inet_ntop(af, *addrp, pbuf, sizeof(pbuf));
 	zfsetparam("ZFTP_IP", ztrdup(pbuf), ZFPM_READONLY);
     }
-    zfreehostent(zhostp);
+    freehostent(zhostp);
     /* now we can talk to the control connection */
     zcfinish = 0;
 
-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR Ltd., Science Park, Milton Road,
Cambridge, CB4 0WH, UK                          Tel: +44 (0)1223 392070


**********************************************************************
The information transmitted is intended only for the person or
entity to which it is addressed and may contain confidential 
and/or privileged material. 
Any review, retransmission, dissemination or other use of, or
taking of any action in reliance upon, this information by 
persons or entities other than the intended recipient is 
prohibited.  
If you received this in error, please contact the sender and 
delete the material from any computer.
**********************************************************************

