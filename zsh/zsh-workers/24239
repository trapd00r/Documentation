From zsh-workers-return-24239-mason-zsh=primenet.com.au@sunsite.dk Thu Dec 13 21:26:02 2007
Return-Path: <zsh-workers-return-24239-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17499 invoked from network); 13 Dec 2007 21:25:54 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 13 Dec 2007 21:25:54 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 88246 invoked from network); 13 Dec 2007 21:25:46 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 13 Dec 2007 21:25:46 -0000
Received: (qmail 20377 invoked by alias); 13 Dec 2007 21:25:43 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24239
Received: (qmail 20355 invoked from network); 13 Dec 2007 21:25:42 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 13 Dec 2007 21:25:42 -0000
Received: from virusfilter.dotsrc.org (bifrost [127.0.0.1])
	by spamfilter.dotsrc.org (Postfix) with ESMTP id 6EEB58058F54
	for <zsh-workers@sunsite.dk>; Thu, 13 Dec 2007 22:22:52 +0100 (CET)
Received: from mtaout02-winn.ispmail.ntl.com (mtaout02-winn.ispmail.ntl.com [81.103.221.48])
	by bifrost.dotsrc.org (Postfix) with ESMTP
	for <zsh-workers@sunsite.dk>; Thu, 13 Dec 2007 22:22:52 +0100 (CET)
Received: from aamtaout04-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout02-winn.ispmail.ntl.com with ESMTP
          id <20071213212607.ZZBC25022.mtaout02-winn.ispmail.ntl.com@aamtaout04-winn.ispmail.ntl.com>
          for <zsh-workers@sunsite.dk>; Thu, 13 Dec 2007 21:26:07 +0000
Received: from pws-pc ([82.6.96.116]) by aamtaout04-winn.ispmail.ntl.com
          with SMTP
          id <20071213212533.VPQA29112.aamtaout04-winn.ispmail.ntl.com@pws-pc>
          for <zsh-workers@sunsite.dk>; Thu, 13 Dec 2007 21:25:33 +0000
Date: Thu, 13 Dec 2007 21:23:48 +0000
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: vared 'functions[xx]'
Message-Id: <20071213212348.80912b31.p.w.stephenson@ntlworld.com>
In-Reply-To: <chaz20071213172705.GB24933@artesyncp.com>
References: <chaz20071213172705.GB24933@artesyncp.com>
X-Mailer: Sylpheed 2.4.7 (GTK+ 2.12.1; x86_64-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: ClamAV using ClamSMTP

On Thu, 13 Dec 2007 17:27:07 +0000
Stephane Chazelas <stephane_chazelas@yahoo.fr> wrote:
> I had an odd behavior here.
> 
> ~$ a() echo foo
> ~$ vared functions\[a\]\
> 
> Above, the trailing "\ " was added by the completion system.

This stops that happening.  I think it's fine in that we certainly need
one level less of quoting to the space than to the square brackets.
However, if there are multiple levels of quoting involved it gets
hairier.  That's probably not a problem in practice.

I'll see if there's something funny in vared separately.

Index: Completion/Zsh/Context/_subscript
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Zsh/Context/_subscript,v
retrieving revision 1.11
diff -u -r1.11 _subscript
--- Completion/Zsh/Context/_subscript	16 Apr 2002 07:48:46 -0000	1.11
+++ Completion/Zsh/Context/_subscript	13 Dec 2007 21:22:23 -0000
@@ -3,8 +3,8 @@
 local expl ind osuf=']' flags sep
 
 if [[ "$1" = -q ]]; then
-  osuf='] '
   compquote osuf
+  osuf+=' '
   shift
 fi
 

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

