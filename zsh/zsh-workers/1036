From suzuki@oz.fantasy.otsl.oki.co.jp Thu May  9 20:55:19 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3) with ESMTP id UAA06660 for <mason@werple.mira.net.au>; Thu, 9 May 1996 20:55:12 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id GAA28131; Thu, 9 May 1996 06:43:01 -0400 (EDT)
Resent-Date: Thu, 9 May 1996 06:43:01 -0400 (EDT)
X-Authentication-Warning: dorothy.fantasy.otsl.oki.co.jp: mail set sender to <suzuki@oz.fantasy.otsl.oki.co.jp> using -f
Date: Thu, 9 May 96 17:38:47 JST
From: suzuki@oz.fantasy.otsl.oki.co.jp (SUZUKI Hisao)
Message-Id: <9605090838.AA09254@oz.fantasy.otsl.oki.co.jp>
To: zsh-workers@math.gatech.edu
Subject: zsh-2.6-beta16: an incompatibility with ksh in typeset command
Resent-Message-ID: <"8a4Io3.0.Tt6.qmSan"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1036
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 1808
Status: O

     I found a slight incompatibility between zsh-2.6-beta16 and
AT&T ksh (on Solaris2, for example).

     In ksh, the optional numeric argument of `typeset' command,
which is typically used to specify the output arithmetic base,
is placed just after the option(s) of the command.  For example,

	$ typeset -i2 a
	$ a=10
	$ echo $a
	2#1010
	$ 

In zsh-2.6-beta16, however, you must put a space between the
option and numeric argument, like this:

	% typeset -i 2 a

     This is an annoying difference and the following is a
sample fix; it preserves the backward compatibility by extending
only the erroneous case, though it is very quick and dirty...

*** builtin.c~	Wed May  1 17:18:34 1996
--- builtin.c	Thu May  9 17:33:16 1996
***************
*** 123,131 ****
  		    break;
  	    /* the above loop may have exited on an invalid option */
  	    if (*arg) {
! 		zerr("bad option: %c", NULL, *arg);
! 		zsfree(xarg);
! 		return 1;
  	    }
  	    /* handle the special "set" options */
  	    arg = (char *) ugetnode(args);
--- 123,143 ----
  		    break;
  	    /* the above loop may have exited on an invalid option */
  	    if (*arg) {
! 		/* for "typeset", -L, -R, -Z and -i may take a numeric
! 		   argument at the tail of the options */
! 		if (idigit(*arg) &&
! 		    (flags & BINF_TYPEOPT) &&
! 		    (ops['L'] == 1 || ops['R'] == 1 || ops['Z'] == 1 ||
! 		     ops['i'] == 1)) {
! 		    char* endPtr;
! 		    auxlen = (int)strtol(arg, &endPtr, 10);
! 		    arg = endPtr;
! 		}
! 		if (*arg) {
! 		    zerr("bad option: %c", NULL, *arg);
! 		    zsfree(xarg);
! 		    return 1;
! 		}
  	    }
  	    /* handle the special "set" options */
  	    arg = (char *) ugetnode(args);

SUZUKI Hisao		# `Begin at the beginning and go on till
suzuki@otsl.oki.co.jp	# you come to the end:  then stop.'


