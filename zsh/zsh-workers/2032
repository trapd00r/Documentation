From zsh-workers-request@euclid.skiles.gatech.edu  Tue Aug 20 15:45:26 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by coral.primenet.com.au (8.7.5/8.7.3) with ESMTP id PAA00374 for <mason@primenet.com.au>; Tue, 20 Aug 1996 15:45:23 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id BAA10549; Tue, 20 Aug 1996 01:43:06 -0400 (EDT)
Resent-Date: Tue, 20 Aug 1996 01:43:06 -0400 (EDT)
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <960819224346.ZM20595@candle.brasslantern.com>
Date: Mon, 19 Aug 1996 22:43:46 -0700
Reply-To: schaefer@nbn.com
X-Mailer: Z-Mail (4.0b.729 29jul96)
To: zsh-workers@math.gatech.edu
Subject: 3.0.0 configure failure (bug in autoconf 2.10?)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"cK3B92.0.ia2.f1L6o"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2032
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Linux 1.3.15, gcc 2.7.0, ELF.

....
checking for tcsetpgrp... yes
checking for tcgetattr... yes
checking for strstr... yes
checking for lstat... no
checking for getlogin... yes
checking for setpgid... yes
....

The message from config.log is:
/tmp/cca194791.o(.text+0x14): undefined reference to `lstat'

The problem seems to be in the AC_CHECK_FUNCS macro.  Zsh's configure,
which says it is from autoconf 2.10, produces a conftest.c containing
the equivalent of:

char lstat();
int t() {
 lstat();
 return 0;
}

If I look at a different software package whose configure was generated by
autoconf 1.11, the code is:

int t() {
 extern char lstat(); lstat();
 return 0;
}

This latter compiles successfully and thus defines HAVE_LSTAT.

So just exactly who is wrong here?  autoconf?  gcc 2.7.0?

In any case, I suggest the following change to glob.c, just to prevent the
(@) glob modifier from producing wildly inaccurate results when configure
makes this kind of error.

--- Src/glob.c.0	Sat Jul 27 13:24:36 1996
+++ Src/glob.c	Mon Aug 19 22:39:47 1996
@@ -212,7 +212,7 @@
 			/* Toggle matching of symbolic links */
 			sense ^= 2;
 			break;
-#ifdef S_IFLNK
+#if defined(S_IFLNK) && defined(HAVE_LSTAT)
 		    case '@':
 			/* Match symbolic links */
 			func = qualmode;

-- 
Bart Schaefer                             Brass Lantern Enterprises
http://www.well.com/user/barts            http://www.nbn.com/people/lantern

New male in /home/schaefer:
>N  2 Justin William Schaefer  Sat May 11 03:43  53/4040  "Happy Birthday"

