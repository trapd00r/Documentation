From zsh-users-return-3128-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Jun 07 21:16:31 2000
Return-Path: <zsh-users-return-3128-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19154 invoked from network); 7 Jun 2000 21:16:30 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 7 Jun 2000 21:16:30 -0000
Received: (qmail 29999 invoked by alias); 7 Jun 2000 21:16:15 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 3128
Received: (qmail 29988 invoked from network); 7 Jun 2000 21:16:11 -0000
Date: Wed, 7 Jun 2000 23:16:10 +0200
From: Jan Fedak <J.Fedak@sh.cvut.cz>
To: zsh-users@sunsite.auc.dk
Subject: zsh changing cp1250 letters beyond recognition
Message-ID: <20000607231610.A6504@tornado.sh.cvut.cz>
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="PNTmBPCT7hxwcZjr"
Content-Transfer-Encoding: 8bit
User-Agent: Mutt/1.1.2i


--PNTmBPCT7hxwcZjr
Content-Type: text/plain; charset=iso-8859-2
Content-Transfer-Encoding: 8bit

Hi.

I have written simple script (attached) that gets filenames (in $*).
The filenames possibly contain letters in cp1250 (windows encoding for
middle and eastern Europe) or iso-8859-2.

It should change the letters with accents to plain ascii and if
there's a difference between the original and new name, it renames the
file.

Now, if I use bash to run the script, everything works just fine. But
when I replace #!/bin/bash with #!/bin/zsh, all those strange cp1250
characters (\232\235\236\212\215\216) get replaced with other (and
equally strange) ones. Renaming and tr don't work correctly then.

As an example, I attach a small file you can try to run (to see the
behavior) -- runme.sh and outputs:

with bash:

mv 03 - Tøi sudièky.mp3 03 - Tri sudicky.mp3
mv 04 - Maškarní plesy.mp3 04 - Maskarni plesy.mp3
mv 05 - Setkání s Puškinem.mp3 05 - Setkani s Puskinem.mp3
mv 06 - Svlíkni si košilku.mp3 06 - Svlikni si kosilku.mp3
mv 07 - Píseò psaná na vodu.mp3 07 - Pisen psana na vodu.mp3
mv 08 - Když mì brali za vojáka.mp3 08 - Kdyz me brali za vojaka.mp3
mv 10 - Dìvenka Štìstí a mládenec Žal.mp3 10 - Devenka Stesti a mladenec Zal.mp3
mv 11 - Básníci chlípníci.mp3 11 - Basnici chlipnici.mp3
mv 12 - Zestárli jsme lásko.mp3 12 - Zestarli jsme lasko.mp3
mv 13 - Tøiatøicet.mp3 13 - Triatricet.mp3
mv 14 - Vlaštovky.mp3 14 - Vlastovky.mp3
mv 15 - Píseò pro Lenku.mp3 15 - Pisen pro Lenku.mp3
mv 19 - Pøelezl jsem plot.mp3 19 - Prelezl jsem plot.mp3

and with zsh (differences in 04, 05, 06, 10...):

mv 03 - Tøi sudièky.mp3 03 - Tri sudicky.mp3
mv 04 - Makarní plesy.mp3 04 - Makarni plesy.mp3
mv 05 - Setkání s Pukinem.mp3 05 - Setkani s Pukinem.mp3
mv 06 - Svlíkni si koilku.mp3 06 - Svlikni si koilku.mp3
mv 07 - Píseò psaná na vodu.mp3 07 - Pisen psana na vodu.mp3
mv 08 - Když mì brali za vojáka.mp3 08 - Kdyz me brali za vojaka.mp3
mv 10 - Dìvenka $tìstí a mládenec }al.mp3 10 - Devenka $testi a mladenec }al.mp3
mv 11 - Básníci chlípníci.mp3 11 - Basnici chlipnici.mp3
mv 12 - Zestárli jsme lásko.mp3 12 - Zestarli jsme lasko.mp3
mv 13 - Tøiatøicet.mp3 13 - Triatricet.mp3
mv 15 - Píseò pro Lenku.mp3 15 - Pisen pro Lenku.mp3
mv 19 - Pøelezl jsem plot.mp3 19 - Prelezl jsem plot.mp3


Jan

-- 
  Jan Fedak                            talk:jack@tornado.sh.cvut.cz
  mailto:J.Fedak@sh.cvut.cz                    mailto:jack@mobil.cz
                Linux - the ultimate NT Service Pack.  

--PNTmBPCT7hxwcZjr
Content-Type: text/plain; charset=iso-8859-2
Content-Disposition: attachment; filename=removecz
Content-Transfer-Encoding: 8bit

#!/bin/bash
# ^ must have bash here. possibly a bug in zsh renders this script useless

trfrom='áèïìéíòóø\232\235ùúý\236ÁÈÏÉÌÍÒÓØ\212\215ÙÚÝ\216'
trto='acdeeinorstuuyzACDEEINORSTUUYZ'
if [ "x$1" = x-iso ]; then
    trfrom='áèïìéíòóø¹»ùúý¾ÁÈÏÉÌÍÒÓØ©«ÙÚÝ®'
    shift
fi

while [ $# -gt 0 ]; do
    name="$1"
    shift
    nonczname=`echo "$name" | tr $trfrom $trto`
    if [ "$name" != "$nonczname" ]; then
	echo mv "$name" "$nonczname"
	mv "$name" "$nonczname"
    fi
done

--PNTmBPCT7hxwcZjr
Content-Type: application/x-sh
Content-Disposition: attachment; filename="runme.sh"
Content-Transfer-Encoding: quoted-printable

#!/bin/zsh=0A=0A./removecz 01\ -\ Tenis.mp3 \=0A	   02\ -\ Povijan.mp3 \=0A=
	   03\ -\ T=F8i\ sudi=E8ky.mp3 \=0A	   04\ -\ Ma=9Akarn=ED\ plesy.mp3 \=0A=
	   05\ -\ Setk=E1n=ED\ s\ Pu=9Akinem.mp3 \=0A	   06\ -\ Svl=EDkni\ si\ ko=
=9Ailku.mp3 \=0A	   07\ -\ P=EDse=F2\ psan=E1\ na\ vodu.mp3 \=0A	   08\ -\ =
Kdy=9E\ m=EC\ brali\ za\ voj=E1ka.mp3 \=0A	   09\ -\ Cha\ cha.mp3 \=0A	   1=
0\ -\ D=ECvenka\ =8At=ECst=ED\ a\ ml=E1denec\ =8Eal.mp3 \=0A	   11\ -\ B=E1=
sn=EDci\ chl=EDpn=EDci.mp3 \=0A	   12\ -\ Zest=E1rli\ jsme\ l=E1sko.mp3 \=
=0A	   13\ -\ T=F8iat=F8icet.mp3 \=0A	   14\ -\ Vla=9Atovky.mp3 \=0A	   15\=
 -\ P=EDse=F2\ pro\ Lenku.mp3 \=0A	   16\ -\ Pjerestrojka.mp3 \=0A	   17\ -=
\ Encyklopedie\ folku.mp3 \=0A	   18\ -\ Cyklistika.mp3 \=0A	   19\ -\ P=F8=
elezl\ jsem\ plot.mp3=0A
--PNTmBPCT7hxwcZjr--

