From zsh-workers-return-22043-mason-zsh=primenet.com.au@sunsite.dk Sun Nov 27 20:40:36 2005
Return-Path: <zsh-workers-return-22043-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28915 invoked from network); 27 Nov 2005 20:40:32 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 27 Nov 2005 20:40:32 -0000
Received: (qmail 74992 invoked from network); 27 Nov 2005 20:40:22 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 27 Nov 2005 20:40:22 -0000
Received: (qmail 4660 invoked by alias); 27 Nov 2005 20:40:15 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22043
Received: (qmail 4603 invoked from network); 27 Nov 2005 20:40:14 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 27 Nov 2005 20:40:14 -0000
Received: (qmail 73245 invoked from network); 27 Nov 2005 20:40:13 -0000
Received: from mta08-winn.ispmail.ntl.com (81.103.221.48)
  by a.mx.sunsite.dk with SMTP; 27 Nov 2005 20:40:10 -0000
Received: from aamta10-winn.ispmail.ntl.com ([81.103.221.35])
          by mta08-winn.ispmail.ntl.com with ESMTP
          id <20051127204004.ZKAU17804.mta08-winn.ispmail.ntl.com@aamta10-winn.ispmail.ntl.com>
          for <zsh-workers@sunsite.dk>; Sun, 27 Nov 2005 20:40:04 +0000
Received: from pwslaptop.csr.com ([81.105.238.64])
          by aamta10-winn.ispmail.ntl.com with ESMTP
          id <20051127204003.QDYB11396.aamta10-winn.ispmail.ntl.com@pwslaptop.csr.com>
          for <zsh-workers@sunsite.dk>; Sun, 27 Nov 2005 20:40:03 +0000
Received: from pwslaptop.csr.com (pwslaptop.csr.com [127.0.0.1])
	by pwslaptop.csr.com (8.13.4/8.13.4) with ESMTP id jARKdsZv003872
	for <zsh-workers@sunsite.dk>; Sun, 27 Nov 2005 20:39:54 GMT
Received: from pwslaptop.csr.com (pws@localhost)
	by pwslaptop.csr.com (8.13.4/8.13.4/Submit) with ESMTP id jARKdohO003868
	for <zsh-workers@sunsite.dk>; Sun, 27 Nov 2005 20:39:54 GMT
Message-Id: <200511272039.jARKdohO003868@pwslaptop.csr.com>
X-Authentication-Warning: pwslaptop.csr.com: pws owned process doing -bs
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-workers@sunsite.dk
Subject: Re: path and += troubles 
In-Reply-To: Your message of "Sun, 27 Nov 2005 18:40:48 GMT."
             <1051127184048.ZM7959@candle.brasslantern.com> 
Date: Sun, 27 Nov 2005 20:39:50 +0000

Bart Schaefer wrote:
> Starting from "zsh -f":
> 
> zagzig% setopt cshnullglob
> zagzig% echo $1+=($2)
> zsh: no match
> zagzig% $1+=($2)
> zagzig% 
> 
> The problem of course is that cshnullglob is supposed to be like nomatch
> if *nothing* matches -- it's only supposed to be like nullglob if at
> least one of several patterns matches.

The first argument is globbed separately in order to check whether its
arguments require special expansion, via a direct call to zglob() rather
than globlist() which is where cshnullglob is handled.  Even if the flag
had been set, if globlist() were later called for other arguments the
flag would be reset.

Does applying cshnullglob to the command word and its argument list
together make sense?  It would mean you were happy for any of the
expansions to give you the command to run.  I suppose that's just
conceivable.  This would need fixing up around execcmd() by separating
out the cshnullglob handling from globlist(), though we still need the
current form of handling in globlist() for other uses like array
assignments... not very pretty.

> I originally [in the -users thread] mentioned that the error message
> vanishes with either nullglob or cshnullglob.  After I figured out that
> it happens because the test string I was using was somehow a valid glob
> qualifier -- that is, "(2)" is a valid qualifier, though I have no idea
> what meaning it can possibly have -- then I said [on -workers] that it
> was limited to cshnullglob.

Looks like it means an octal mode: try *(644).  I have no idea where
this came from; it doesn't appear to be documented.

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page still at http://www.pwstephenson.fsnet.co.uk/

