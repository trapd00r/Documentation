From zsh-workers-return-7515-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Aug 27 09:54:46 1999
Return-Path: <zsh-workers-return-7515-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11989 invoked from network); 27 Aug 1999 09:54:44 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 27 Aug 1999 09:54:44 -0000
Received: (qmail 10457 invoked by alias); 27 Aug 1999 09:54:26 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7515
Received: (qmail 10450 invoked from network); 27 Aug 1999 09:54:25 -0000
Date: Fri, 27 Aug 1999 11:54:23 +0200 (MET DST)
Message-Id: <199908270954.LAA17659@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: small new bit for _arguments


This allows to give something like `((a\:bar b\:baz))' as the
action. The strings in the list should all have a colon in them and
the stuff before it will be completed. The strings after the colons
are used as descriptions and shown in the list.

Currently this is only used in `_find' and some of the pbmplus
functions.

Maybe we should make the format configurable?

Bye
 Sven

P.S.: Note that I didn't change `_long_options' to accept the same --
      I still hope to find the time to merge it with `_arguments'.
      Maybe at the weekend.

diff -u od/Zsh/compsys.yo Doc/Zsh/compsys.yo
--- od/Zsh/compsys.yo	Fri Aug 27 10:14:08 1999
+++ Doc/Zsh/compsys.yo	Fri Aug 27 11:37:24 1999
@@ -949,7 +949,11 @@
 In each of the cases above, the var(action) says how the possible
 completions should be generated. In cases where only one of a fixed
 set of strings can be completed, these string can directly be given as 
-a list in parentheses, as in `tt(:foo:(foo bar baz))'. A string in
+a list in parentheses, as in `tt(:foo:(foo bar baz))'. Such a list in
+doubled parentheses, as in `tt(:foo:((a\:bar b\:baz)))' should contain 
+strings consisting of the string to complete followed by a colon
+(which needs to be preceded by a backslash) and a description. The
+matches will be listed together with their descriptions. A string in
 braces will be evaluated to generate the matches and if the
 var(action) does not begin with an opening parentheses or brace, it
 will be split into separate words and executed. If the var(action)
diff -u -r oc/Base/_arguments Completion/Base/_arguments
--- oc/Base/_arguments	Fri Aug 27 09:03:35 1999
+++ Completion/Base/_arguments	Fri Aug 27 11:44:15 1999
@@ -533,8 +533,34 @@
     if [[ -z "$action" ]]; then
 
       # An empty action means that we should just display a message.
+
       _message "$descr"
       return ret
+
+    elif [[ "$action" = \(\(*\)\) ]]; then
+
+      # ((...)) contains literal strings with descriptions.
+
+      eval ws\=\( "${action[3,-3]}" \)
+
+      compadd -D ws - "${(@)ws%%:*}"
+
+      if (( $#ws )); then
+        beg=1
+        for nth in "$ws[@]"; do
+          tmp="${#nth%%:*}"
+	  [[ tmp -gt beg ]] && beg="$tmp"
+        done
+        tmp=''
+        for nth in "$ws[@]"; do
+          tmp="$tmp
+${(r:beg:: :)nth%%:*} -- ${nth#*:}"
+        done
+        tmp="$tmp[2,-1]"
+        compadd "$expl[@]" -y tmp - "${(@)ws%%:*}"
+      else
+        _message "$descr"
+      fi
     elif [[ "$action" = \(*\) ]]; then
 
       # Anything inside `(...)' is added directly.
diff -u -r oc/Pbmplus/_pnmtotiff Completion/Pbmplus/_pnmtotiff
--- oc/Pbmplus/_pnmtotiff	Thu Aug 26 15:55:06 1999
+++ Completion/Pbmplus/_pnmtotiff	Fri Aug 27 11:30:01 1999
@@ -1,5 +1,5 @@
 #compdef pnmtotiff
 
 _arguments '-none' '-packbits' '-lzw' '-g3' '-g4' '-2d' '-fill' \
-           '-predictor:LZW predictor:(1 2)' '-msb2lsb' '-lsb2msb' \
+           '-predictor:LZW predictor:((1\:without\ differencing 2\:with\ differencing))' '-msb2lsb' '-lsb2msb' \
 	   '-rowsperstrip:number of rows per strip:' ':file: _pbm_file'
diff -u -r oc/Pbmplus/_ppmtomitsu Completion/Pbmplus/_ppmtomitsu
--- oc/Pbmplus/_ppmtomitsu	Thu Aug 26 15:55:04 1999
+++ Completion/Pbmplus/_ppmtomitsu	Fri Aug 27 11:30:55 1999
@@ -2,6 +2,6 @@
 
 _arguments '-sharpness:sharpness:(1 2 3 4)' \
            '-enlarge:enlargement factor:(1 2 3)' \
-	   '-media:output media:(A A4 AS A4S)' \
+	   '-media:output media (default\: 1184x1350):((A\:1216x1350 A4\:1184x1452 AS\:1216x1650 A4S\:1184x1754))' \
 	   '-copy:number of copies:(1 2 3 4 5 6 7 8 9)' \
 	   '-dpi300' '-tiny' ':file: _pbm_file'
diff -u -r oc/User/_find Completion/User/_find
--- oc/User/_find	Thu Aug 26 15:54:59 1999
+++ Completion/User/_find	Fri Aug 27 11:21:43 1999
@@ -43,8 +43,8 @@
   '*-perm:file permission bits:' \
   '*-size:file size:' \
   '*-true' \
-  '*-type:file type:(b c d p f l s)' \
-  '*-xtype:file type:(b c d p f l s)' \
+  '*-type:file type:((b\:block\ special\ file c\:character\ special\ file d\:directory p\:named\ pipe f\:normal\ file l\:symbolic\ link s\:socket))' \
+  '*-xtype:file type:((b\:block\ special\ file c\:character\ special\ file d\:directory p\:named\ pipe f\:normal\ file l\:symbolic\ link s\:socket))' \
   '*-exec:program: _command_names -e:*\;::program arguments: _normal' \
   '*-ok:program: _command_names -e:*\;::program arguments: _normal' \
   '*-fls:output file:_files' \

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

