From mdb@cdc.noaa.gov Wed May 22 09:59:14 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3) with ESMTP id JAA03395 for <mason@werple.mira.net.au>; Wed, 22 May 1996 09:59:10 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id TAA11567; Tue, 21 May 1996 19:36:31 -0400 (EDT)
Resent-Date: Tue, 21 May 1996 19:36:31 -0400 (EDT)
Sender: mdb@cdc.noaa.gov
To: Irving Wolfe <irving@WOLFE.net>
Cc: zsh-workers@math.gatech.edu
Subject: Re: Beta 18 Compilation Problem Under Nextstep 3.3
References: <Pine.NXT.3.93.960521144604.28147A-100000@racoon>
From: Mark Borges <mdb@cdc.noaa.gov>
Date: 21 May 1996 17:36:12 -0600
In-Reply-To: Irving Wolfe's message of Tue, 21 May 1996 14:47:13 -0700 (PDT)
Message-Id: <vkrasdwqdv.fsf@cdc.noaa.gov>
Lines: 81
X-Mailer: September Gnus v0.89/XEmacs 19.14
Resent-Message-ID: <"FOFUH2.0.fq2.-Dben"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1113
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 2733
Status: O

>> On Tue, 21 May 1996 14:47:13 -0700 (PDT),
>> Irving Wolfe(IW) wrote:
IW> cc -c -I.. -I. -I.  -DHAVE_CONFIG_H -Wall -Wno-implicit -Wmissing-prototypes -O -pipe builtin.c
IW> builtin.c: In function `bin_kill':
IW> builtin.c:662: `sigs' undeclared (first use this function)

I had the same problem under Solaris-2.5 (but it's not an OS bug).

I tracked it down to the change made to signames.awk, which on my
system is interpreted by mawk,

  $ mawk -Wv
  mawk 1.2.2 Jan 1996, Copyright (C) Michael D. Brennan

which generated a bogus signames.h file.

Anyway, I backed out the change (why is it necessary to escape the
`#else'?) and it worked fine.

The only thing SUNWspro's cc complains about now is stuff like:

----------------------------------------
"hashtable.c", line 233: warning: argument #1 is incompatible with prototype:
	prototype: pointer to const uchar : "./utils.pro", line 85
	argument : pointer to char
----------------------------------------

Good luck.

*** signames.awk	Mon May 20 06:40:00 1996
--- ../../zsh-2.6-beta17/Src/signames.awk	Mon May  6 08:08:58 1996
***************
*** 1,5 ****
  # 
! # $Id: signames.awk,v 2.1 1996/05/20 01:24:24 hzoli Exp $
  #
  # {g,n}awk script to generate signals.h
  # provided by Geoff Wing <mason@werple.apana.org.au>
--- 1,5 ----
  # 
! # $Id: signames.awk,v 2.0 1996/05/02 22:57:04 hzoli Exp $
  #
  # {g,n}awk script to generate signals.h
  # provided by Geoff Wing <mason@werple.apana.org.au>
***************
*** 52,58 ****
  
  END {
      ps = "%s"
!     ifdstr = sprintf("#ifdef USE_SUSPENDED\n\t%csuspended%s%c,\n\#else\n\t%cstopped%s%c,\n#endif\n", 034, ps, 034, 034, ps, 034)
  
      printf("%s\n%s\n\n%s\t%d\n\n%s\n\n%s\n\t%c%s%c,\n", "/** signals.h                                 **/", "/** architecture-customized signals.h for zsh **/", "#define SIGCOUNT", max, "#ifdef GLOBALS", "char *sigmsg[SIGCOUNT+2] = {", 034, "done", 034)
  
--- 52,58 ----
  
  END {
      ps = "%s"
!     ifdstr = sprintf("#ifdef USE_SUSPENDED\n\t%csuspended%s%c,\n#else\n\t%cstopped%s%c,\n#endif\n", 034, ps, 034, 034, ps, 034)
  
      printf("%s\n%s\n\n%s\t%d\n\n%s\n\n%s\n\t%c%s%c,\n", "/** signals.h                                 **/", "/** architecture-customized signals.h for zsh **/", "#define SIGCOUNT", max, "#ifdef GLOBALS", "char *sigmsg[SIGCOUNT+2] = {", 034, "done", 034)
  
***************
*** 87,93 ****
      print "\tNULL"
      print "};"
      print ""
!     print "\#else"
      print "extern char *sigs[SIGCOUNT+4],*sigmsg[SIGCOUNT+2];"
      print "#endif"
  }
--- 87,93 ----
      print "\tNULL"
      print "};"
      print ""
!     print "#else"
      print "extern char *sigs[SIGCOUNT+4],*sigmsg[SIGCOUNT+2];"
      print "#endif"
  }

-- 
  -mb-


