From zsh-workers-return-14579-mason-zsh=primenet.com.au@sunsite.dk Wed May 30 20:44:36 2001
Return-Path: <zsh-workers-return-14579-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26253 invoked from network); 30 May 2001 20:44:35 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 30 May 2001 20:44:35 -0000
Received: (qmail 29035 invoked by alias); 30 May 2001 20:44:29 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14579
Received: (qmail 29024 invoked from network); 30 May 2001 20:44:28 -0000
Date: Wed, 30 May 2001 22:44:27 +0200 (DFT)
From: Jens Schleusener <Jens.Schleusener@debis-sfr.de>
To: zsh-workers@sunsite.dk
Subject: zsh-4.0.1-pre-[45] compile problems under AIX
Message-ID: <Pine.A41.3.96.1010530221546.250794A-100000@n05.sp.go.dlr.de>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

Hi,

I have problems to compile zsh-4.0.1-pre-4 and zsh-4.0.1-pre-5
under AIX 4.1.4 and 4.3.x.

I assume the problem is a local one (local gcc installation etc.) and
probably I have overseen something.

Under AIX 4.1.4 (gcc 2.95.3) I got the following error:

...
gcc -c -I.  -DHAVE_CONFIG_H -I/usr/local/contrib/include  -o termcap.o
termcap.c
In file included from termcap.c:61:
/usr/include/term.h:1315: parse error before `SGTTY'
/usr/include/term.h:1315: warning: no semicolon at end of struct or union
/usr/include/term.h:1332: parse error before `sgr_mode'
/usr/include/term.h:1332: warning: data definition has no type or storage
class
/usr/include/term.h:1333: parse error before `sgr_faked'
/usr/include/term.h:1333: warning: data definition has no type or storage
class
/usr/include/term.h:1344: parse error before `funckeystarter'
/usr/include/term.h:1344: warning: data definition has no type or storage
class
/usr/include/term.h:1345: parse error before `_fl_rawmode'
(... and so on, more lines deleted)D

In /usr/include/term.h the lines 1314-1349 are (sorry some lines are too
long and wrapped):

 +1314          short Filedes;     /* file descriptor being written to */
 +1315          SGTTY Ottyb,      /* original state of the terminal */
 +1316                Nttyb;      /* current state of the terminal */
 +1317  #ifdef DIOCSETT
 +1318          struct termcb new, old; /* CB/UNIX virtual terminals */
 +1319  #endif
 +1320  #ifdef LTILDE
 +1321          int newlmode, oldlmode; /* BSD tty driver */
 +1322  #endif
 +1323          /* end of Vr2 structure */
 +1324          struct _bool_struct *_bools;
 +1325          struct _num_struct *_nums;
 +1326          struct _str_struct *_strs;
 +1327          char *_strtab;
 +1328  #ifdef FIONREAD
 +1329          long timeout;           /* for BSD halfdelay mode */
 +1330  #endif
 +1331          /* end of Vr3 structure */
 +1332          chtype sgr_mode;    /* current phys. graphic rendition */
 +1333          chtype sgr_faked;      
 +1334          int    _delay;                  /* timeout for inputs */
 +1335          int    _inputfd;                /* input file descriptor
*/
 +1336          int    _check_fd;               /* typeahead file
descriptor */
 +1337          _KEY_MAP        **_keys,        /* key map */
 +1338                          *internal_keys; /* pointer to free key 
                                                   structures */
 +1339          short           _ksz,           /* size of keymap */
 +1340                          _lastkey_ordered,/* where the last ordered
                                                    key is */
 +1341                          _lastmacro_ordered,/* where the last
                                                      ordered macro is */
 +1342                          _first_macro;
 +1343          bool                            /* map of which chars
                                                   start fn keys */
 +1344                          funckeystarter[0400];
 +1345          bool            _fl_rawmode,    /* in cbreak(=1) or
                                                   raw(=2) mode */
 +1346                          fl_typeahdok,   /* ok to use typeahead */
 +1347                          _cursorstate,   /* cursor: 0=invis,
                                                   1=norm, 2=vvis */
 +1348                          _iwait;         /* true if input-pending 
                                                   */
 +1349          short           _regs[26];      /* tparm static registers
                                                   */

Similar for AIX 4.3.x (with additional linker warning " Entry point not
found"):

...
ld   -G -bexpall -lc -o stat.so   stat..o    -ldl -lcurses -lm  -lc 
ld: 0711-327 WARNING: Entry point not found: __start
gcc -c -I.  -DHAVE_CONFIG_H -DMODULE -I/usr/local/contrib/include -fpic -o
termcap..o termcap.c
cc1: warning: -fpic ignored for AIX (all code is position independent)
In file included from termcap.c:61:
/usr/include/term.h:1209: parse error before `bool'
/usr/include/term.h:1209: warning: no semicolon at end of struct or union
/usr/include/term.h:1210: warning: data definition has no type or storage
class
/usr/include/term.h:1239: parse error before `SGTTY'
/usr/include/term.h:1239: warning: no semicolon at end of struct or union
/usr/include/term.h:1256: parse error before `sgr_mode'
/usr/include/term.h:1256: warning: data definition has no type or storage
class
/usr/include/term.h:1257: parse error before `sgr_faked'
/usr/include/term.h:1257: warning: data definition has no type or storage
class
/usr/include/term.h:1268: parse error before `funckeystarter'
/usr/include/term.h:1268: warning: data definition has no type or storage
class
/usr/include/term.h:1269: parse error before `_fl_rawmode'


In /usr/include/term.h the lines 1206-1240 are:

 +1206  typedef struct {
 +1207          short  foreground;   /* foreground color */
 +1208          short  background;   /* background color */
 +1209          bool   init;         /* TRUE if pair was initialized */
 +1210  } _Color_pair;
 +1211
 +1212
 +1213  typedef struct {
 +1214          short   r, g, b;
 +1215  } _Color;
 +1216  
 +1217  /*
 +1218   * This definition for the term struct allows the boolean, number
 +1219   * and string information to grow in the future and still allow .o
 +1220   * compatibility.
 +1221   */
 +1222  
 +1223  #ifndef __Mbstate_t_
 +1224          #define __Mbstate_t_
 +1225          typedef short   Mbstate_t;  /* local mbstate_t as defined
                                               in wchar.h */
 +1226  #endif
 +1227  
 +1228  struct term {
 +1229  #ifdef _VR2_COMPAT_CODE
 +1230      char
 +1231          _b1,  _b2,  _b3,  _b4,  _b5,  _b6,  _b7,  _b8,  _b9,
_b10,
 +1232          _b11, _b12, _b13, _b14, _b15, _b16, _b17, _b18, _b19,
                _b20, _b21;
 +1233      short
 +1234          _c1, _c2, _c3, _c4, _c5, _c6, _c7, _c8;
 +1235          struct _Vr2_Astrs _Vr2_Astrs;
 +1236          struct _Vr2_Bstrs _Vr2_Bstrs;
 +1237  #endif /* _VR2_COMPAT_CODE */
 +1238          short Filedes;          /* file descriptor being written
                                           to */
 +1239          SGTTY Ottyb,            /* original state of the terminal
                                           */
 +1240                Nttyb;            /* current state of the terminal
                                           */

Til (including) zsh 4.0.1-pre-3 I had no such problems. Has anybody built
successfully the newer versions under AIX? Any ideas? 

Greetings

Jens

-- 
Dr. Jens Schleusener                T-Systems debis Systemhaus
phone: +49 (551) 709-2493           Solutions for Research
fax:   +49 (551) 709-2169           Bunsenstr.10
mail: Jens.Schleusener@debis-sfr.de D-37073 Goettingen

