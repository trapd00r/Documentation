From zsh-workers-request@euclid.skiles.gatech.edu Tue Apr 29 07:39:50 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 13649 invoked from network); 29 Apr 1997 07:39:47 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 29 Apr 1997 07:39:47 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id DAA17115; Tue, 29 Apr 1997 03:29:52 -0400 (EDT)
Resent-Date: Tue, 29 Apr 1997 03:29:52 -0400 (EDT)
Message-Id: <199704290733.JAA13263@hydra.ifh.de>
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: Re: trapping WINCH fails in 3.0.3-test4 
In-reply-to: "Roderick Schertler"'s message of "Mon, 28 Apr 1997 20:25:32 MET."
             <24742.862273532@eeyore.ibcinc.com> 
Date: Tue, 29 Apr 1997 09:33:07 +0200
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"Y4o1L3.0.MB4.lDQPp"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3093
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Roderick Schertler wrote:
> I can't get a trap on SIGWINCH to work in 3.0.3-test4:
> 
>     e:1% zsh-3.0.3-test4 -f
>     eeyore% TRAPWINCH() { echo here }
>     eeyore% kill -WINCH $$
>     eeyore% _

I don't see why it shouldn't be made to work; it's probably just an
oversight (except that the whole trap mechanism needs altering to run
the traps somewhere else, but that doesn't alter the present problem).
The proper place for the trap is probably after adjustwinsize(), so
that the function gets the new values for $LINES and $COLUMNS.

*** Src/signals.c.win	Tue Feb 18 17:29:59 1997
--- Src/signals.c	Tue Apr 29 09:26:17 1997
***************
*** 489,494 ****
--- 489,496 ----
  
      case SIGWINCH:
          adjustwinsize();  /* check window size and adjust */
+ 	if (sigtrapped[SIGWINCH])
+ 	    dotrap(SIGWINCH);
          break;
  
      case SIGALRM:

-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77413
Deutsches Elektronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.

