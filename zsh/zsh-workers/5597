From zsh-workers-return-5597-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Mar 02 09:09:36 1999
Return-Path: <zsh-workers-return-5597-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16598 invoked from network); 2 Mar 1999 09:09:35 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 2 Mar 1999 09:09:35 -0000
Received: (qmail 15067 invoked by alias); 2 Mar 1999 09:09:13 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5597
Received: (qmail 15059 invoked from network); 2 Mar 1999 09:09:11 -0000
Message-Id: <9903020853.AA30487@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk
Subject: Re: PATCH 3.1.5-pws-10: Fix 
In-Reply-To: ""Matt Armstrong""'s message of "Mon, 01 Mar 1999 22:59:21 NFT."
             <19990302065922.24539.qmail@hotmail.com> 
Date: Tue, 02 Mar 1999 09:53:20 +0100
From: Peter Stephenson <pws@ibmth.df.unipi.it>

"Matt Armstrong" wrote:
> 1) I made modules-bltin depend on Makefile.  This forces it to get 
> re-made after a re-configure (this would have saved me a chunk of time 
> the other night...)
>
>...
> 3) I moved the deletion of modules.index and modules-bltin out of 
> distclean and into clean.  I saw no compelling reason for it to be in 
> distclean.  I think removing reasons for 'make distclean' is good.

The point may have been that in principle you get to pick what modules are
builtin, e.g. you decide you'd prefer to have zle linked in so stick it in
modules-bltin by hand --- see INSTALL.  But it's (in retrospect, at least)
asking for trouble to have a file both generated by hand and automatically.
We could have a separate file that is used unconditionally if it exists ---
no make dependencies, so no rebuilding/deleting horror --- but gets removed
by a distclean, which is appropriate in this case since it's now
configuration information.  How does that sound?  I could even probably be
persuaded it shouldn't be removed automatically at all.  (This is a
post-Matt patch.)

--- INSTALL.matt2	Tue Mar  2 09:39:40 1999
+++ INSTALL	Tue Mar  2 09:42:37 1999
@@ -56,10 +56,11 @@
 
 By default the comp1, compctl, zle, sched and rlimits modules are compiled
 into non-dynamic zsh and no modules are compiled into the main binary if
-dynamic loading is available.  This can be overridden by creating the
-Src/modules-bltin file with the list of modules which are to be compiled
-into the main binary.  See the zshmodules manual page for the list of
-available modules.
+dynamic loading is available.  This can be overridden by creating the file
+mymods.conf in the compilation directory (Src, unless you have told
+configure to use another directory) with the list of modules which are to
+be compiled into the main binary.  See the zshmodules manual page for the
+list of available modules.
 
 Compiler Options or Using a Different Compiler
 ----------------------------------------------
--- Src/Makefile.in.matt2	Tue Mar  2 09:39:32 1999
+++ Src/Makefile.in	Tue Mar  2 09:40:38 1999
@@ -113,7 +113,9 @@
 # ========== LINKING IN MODULES ==========
 
 modules-bltin: Makefile
-	if test @D@ = N; then \
+	if test -f mymods.conf; then \
+	    cat mymods.conf > $@; \
+	elif test @D@ = N; then \
 	    cat $(sdir)/xmods.conf > $@; \
 	elif test @RTLD_GLOBAL_OK@ != yes; then \
 	    echo comp1 > $@; \
@@ -189,7 +191,7 @@
 
 distclean-here:
 	rm -f TAGS tags
-	rm -f Makefile
+	rm -f Makefile mymods.conf
 
 mostlyclean: mostlyclean-modules
 clean: clean-modules

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

