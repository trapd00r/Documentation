From zsh-workers-request@math.gatech.edu Sun Jan 25 15:28:05 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 576 invoked from network); 25 Jan 1998 15:25:32 -0000
Received: from ns2.primenet.com.au (7795@203.24.36.3)
  by ns1.primenet.com.au with SMTP; 25 Jan 1998 15:25:32 -0000
Received: (qmail 1302 invoked from network); 24 Jan 1998 23:13:41 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns2.primenet.com.au with SMTP; 24 Jan 1998 23:13:41 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id RAA00441;
	Sat, 24 Jan 1998 17:51:35 -0500 (EST)
Resent-Date: Sat, 24 Jan 1998 17:51:19 -0500 (EST)
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <980124145241.ZM23613@candle.brasslantern.com>
Date: Sat, 24 Jan 1998 14:52:41 -0800
In-Reply-To: <199801242229.RAA27851@luomat.peak.org>
Comments: In reply to Timothy J Luoma <luomat+zsh+users@luomat.peak.org>
        "Re: zsh script wipes out my PROMPT and RPROMPT" (Jan 24,  5:29pm)
References: <199801242023.PAA25336@luomat.peak.org> 
	<980124141339.ZM23464@candle.brasslantern.com> 
	<199801242229.RAA27851@luomat.peak.org>
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: Timothy J Luoma <luomat+zsh+users@luomat.peak.org>
Subject: Re: zsh script wipes out my PROMPT and RPROMPT
Cc: zsh-users@math.gatech.edu
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"hrFom.0.N6.d1doq"@math>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/1279
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On Jan 24,  5:29pm, Timothy J Luoma wrote:
} Subject: Re: zsh script wipes out my PROMPT and RPROMPT
}
} > LINES=`wc -l $FILE | awk '{print $1}'`
} 
} AH... I used another variable instead.
} 
} The behavior seems to have stopped.... I'm not sure why.... but since it  
} shouldn't have happened anyway....

Could be that the zsh executing the script was improperly resetting the
tty driver's idea of the terminal dimensions when it saw the assignment
to LINES.  The parent zsh would then see the new tty configuration when
the script exited, and reset its own LINES.  If LINES became sufficiently
small, zle might decide that it couldn't draw a prompt, or some such.

There were a number of changes to zsh's tty-size handling in 3.0.5 that
I still think were bad ideas; in the face of too little information, I'd
rather that the shell did nothing, rather than reconfigure the tty based
on partial data that might be wrong.  However, I can't definitely point
to any particular bug (not even this one) that is directly attributable
to the new code.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

