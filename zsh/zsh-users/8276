From zsh-users-return-8276-mason-zsh=primenet.com.au@sunsite.dk Thu Dec 09 10:43:52 2004
Return-Path: <zsh-users-return-8276-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11377 invoked from network); 9 Dec 2004 10:43:51 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 9 Dec 2004 10:43:51 -0000
Received: (qmail 207 invoked from network); 9 Dec 2004 10:43:44 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 Dec 2004 10:43:44 -0000
Received: (qmail 2537 invoked by alias); 9 Dec 2004 10:42:51 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8276
Received: (qmail 2506 invoked from network); 9 Dec 2004 10:42:46 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 9 Dec 2004 10:42:46 -0000
Received: (qmail 98564 invoked from network); 9 Dec 2004 10:42:45 -0000
Received: from mailhost1.csr.com (HELO MAILSWEEPER01.csr.com) (81.105.217.43)
  by a.mx.sunsite.dk with SMTP; 9 Dec 2004 10:42:44 -0000
Received: from exchange03.csr.com (unverified [10.100.137.60]) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.12) with ESMTP id <T6dc3d40cf00a6c8d016c4@MAILSWEEPER01.csr.com> for <zsh-users@sunsite.dk>;
 Thu, 9 Dec 2004 10:41:29 +0000
Received: from news01.csr.com ([10.103.143.38]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Thu, 9 Dec 2004 10:43:29 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.1/8.12.11) with ESMTP id iB9Agf3Y006645
	for <zsh-users@sunsite.dk>; Thu, 9 Dec 2004 10:42:41 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.1/8.13.1/Submit) with ESMTP id iB9AgeAk006642
	for <zsh-users@sunsite.dk>; Thu, 9 Dec 2004 10:42:41 GMT
Message-Id: <200412091042.iB9AgeAk006642@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-users@sunsite.dk
Subject: Re: How to turn off NIS hosts completion? 
In-reply-to: <41B75DC7.4020502@Dseven.ORG> 
References: <41B75DC7.4020502@Dseven.ORG>
Date: Thu, 09 Dec 2004 10:42:39 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 09 Dec 2004 10:43:29.0091 (UTC) FILETIME=[EB720130:01C4DDDB]
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

Iain MacDonnell wrote:
> Is there a way to turn off this NIS lookup for users and hosts?

There's a nasty but simple hack to turn off user name lookup.  The shell
does the lookup via the special variable userdirs in the zsh/parameter
module.  This declares itself in such a way that it can be overridden by
a local user definition.  You can persuade the completion system to
override it with an empty array by adding the following code to your own
initialisation.  It goes at some point after the completion system has
been loaded by "compinit":

  zmodload -i zsh/parameter
  _comp_setup+=$'\ntypeset -a userdirs'

assuming zsh 4.2, else you need to spell out the second line

  _comp_setup=$_comp_setup$'\ntypeset -a userdirs'

There's no such variable for hosts.  As far as I could see from the
code, hosts are never looked up from NIS if the hosts style is set, as
you have.  However, you can make sure by redefining _hosts, stripping
out the hairy middle chunk:


#compdef ftp ping rwho rup xping traceroute host aaaa zone mx ns soa txt

local expl tmp
local -a hosts

zstyle -a ":completion:${curcontext}:hosts" hosts hosts

_wanted hosts expl host \
    compadd -M 'm:{a-zA-Z}={A-Za-z} r:|.=* r:|=*' "$@" -a hosts


You can then put this in your $fpath earlier than the standard
completion directories.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

This footnote also confirms that this email message has been swept by
MIMEsweeper for the presence of computer viruses.

www.mimesweeper.com
**********************************************************************

