From zsh-workers-return-15064-mason-zsh=primenet.com.au@sunsite.dk Mon Jun 25 09:15:41 2001
Return-Path: <zsh-workers-return-15064-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9631 invoked from network); 25 Jun 2001 09:15:39 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 25 Jun 2001 09:15:39 -0000
Received: (qmail 20954 invoked by alias); 25 Jun 2001 09:14:51 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15064
Received: (qmail 20943 invoked from network); 25 Jun 2001 09:14:50 -0000
Date: Mon, 25 Jun 2001 11:12:22 +0200
From: Thomas =?iso-8859-1?Q?K=F6hler?= <jean-luc@picard.franken.de>
To: zsh-workers@sunsite.dk
Subject: Re: disowning stopped jobs
Message-ID: <20010625111222.A24094@picard.franken.de>
Mail-Followup-To: zsh-workers@sunsite.dk
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="5vNYLRcllDrimb99"
Content-Disposition: inline
In-Reply-To: <200106250900.LAA09460@beta.informatik.hu-berlin.de>
User-Agent: Mutt/1.3.18i
X-Operating-System: Linux picard 2.2.17
X-Editor: VIM - Vi IMproved 6.0al ALPHA http://www.vim.org/
X-IRC: tirc; Nick: jeanluc
X-URL: http://jeanluc-picard.de/


--5vNYLRcllDrimb99
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

On Mon, Jun 25, 2001 at 11:00:56AM +0200,
Sven Wischnowsky <wischnow@informatik.hu-berlin.de> wrote:
> If one tries bash-2.04:
>=20
>   % sleep 80
>   ^Z
>   [1]+  Stopped                    sleep 80
>   % disown %1
>   bash: warning: deleting stopped job 1 with process group 988
>=20
> I.e., it prints what Bart suggested we should print.  I answered that by
> saying that this is slightly more complicated for us because there may
> also be a sub-job to be continued in such cases.
>=20
> Maybe we can `solve' (or, rather, circumvent) this problem by being more
> verbose, saying `warning: job is stopped, use `kill -CONT ...' to resume'.
> That way, users can even use cut&paste to make the job running.

Good idea, IMHO.

> Below is a patch for this, which I won't commit until I get positive
> replies.

Well, I just have a minor quetion, see at end.

[...]
> diff -ur -r ../oz/Src/jobs.c ./Src/jobs.c
> --- ../oz/Src/jobs.c	Sat Jun 23 22:12:56 2001
> +++ ./Src/jobs.c	Sat Jun 23 22:42:33 2001
> @@ -1392,14 +1392,36 @@
>  	    printjob(job + jobtab, lng, 2);
>  	    break;
>  	case BIN_DISOWN:
> -	    if (jobtab[job].stat & STAT_STOPPED)
> +	    if (jobtab[job].stat & STAT_STOPPED) {
> +		char buf[20], *pids =3D "";
> +
> +		if (jobtab[job].stat & STAT_SUPERJOB) {
> +		    Process pn;
> +
> +		    for (pn =3D jobtab[jobtab[job].other].procs; pn; pn =3D pn->next) {
> +			sprintf(buf, " -%d", pn->pid);
> +			pids =3D dyncat(pids, buf);
> +		    }
> +		    for (pn =3D jobtab[job].procs; pn->next; pn =3D pn->next) {
> +			sprintf(buf, " %d", pn->pid);
> +			pids =3D dyncat(pids, buf);
> +		    }
> +		    if (!jobtab[jobtab[job].other].procs && pn) {
> +			sprintf(buf, " %d", pn->pid);
> +			pids =3D dyncat(pids, buf);
> +		    }
> +		} else {
> +		    sprintf(buf, " -%d", jobtab[job].gleader);
> +		    pids =3D buf;
> +		}
>                  zwarnnam(name,
>  #ifdef USE_SUSPENDED
> -                         "warning: job is suspended",
> +                         "warning: job is suspended, use `kill -CONT%s' =
to resume",
                                                                      ^^
>  #else
> -                         "warning: job is stopped",
> +                         "warning: job is stopped, use `kill -CONT%s' to=
 resume",
                                                                    ^^
>  #endif
> -                         NULL, 0);
> +                         pids, 0);
> +	    }
>  	    deletejob(jobtab + job);
>  	    break;
>  	}

Shouldn't there be a space between 'T' and '%' in the marked places?
Or does "pids" contain a space at the beginning?
(Just thrown in because it looks strange, I don't really know anything
about that "pids" variable, what does dyncat() do to it?)

Ciao,
Thomas

--=20
 Thomas K=F6hler Email:   jean-luc@picard.franken.de     | LCARS - Linux
     <><        WWW:     http://jeanluc-picard.de      | for Computers
                IRC:             jeanluc               | on All Real
               PGP public key available from Homepage! | Starships

--5vNYLRcllDrimb99
Content-Type: application/pgp-signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.6 (GNU/Linux)
Comment: For info see http://www.gnupg.org

iD8DBQE7NwB2TEYXWMJlHuYRAl4oAJ49ucqajVaOgtdbS5/fGpSVL7vIfQCeO1jp
olU+WBqNcK6B3PsJtDvnQhg=
=7mmG
-----END PGP SIGNATURE-----

--5vNYLRcllDrimb99--

