From zsh-users-return-3535-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Nov 29 20:18:03 2000
Return-Path: <zsh-users-return-3535-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8677 invoked from network); 29 Nov 2000 20:18:02 -0000
Received: from sunsite.dk (HELO sunsite.auc.dk) (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 29 Nov 2000 20:18:02 -0000
Received: (qmail 23794 invoked by alias); 29 Nov 2000 20:17:10 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 3535
Received: (qmail 23771 invoked from network); 29 Nov 2000 20:17:09 -0000
Date: Wed, 29 Nov 2000 12:16:14 -0800
From: Matt Armstrong <matt.armstrong@openwave.com>
To: Mircea Damian <dmircea@linux.kappa.ro>
Cc: Bart Schaefer <schaefer@candle.brasslantern.com>,
	zsh-users@sunsite.auc.dk
Subject: Re: [zsh 3.1.9] history bug?
Message-ID: <20001129121614.B18158@corp.phone.com>
References: <20001129141451.A24159@lepois.loria.fr> <1001129155002.ZM26865@candle.brasslantern.com> <20001129220134.D4770@linux.kappa.ro>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <20001129220134.D4770@linux.kappa.ro>; from dmircea@linux.kappa.ro on Wed, Nov 29, 2000 at 10:01:34PM +0200

On Wed, Nov 29, 2000 at 10:01:34PM +0200, Mircea Damian wrote:
> I'm seeing a problem with history too. Ok. It saves history but if for any
> reason (like kill -9 when it's saving history) the file .history.LOCK
> remains and a process with the pid of zsh is running I will not be able to
> login (/bin/zsh is my default shell).
> 
> For example I do a shutdown, the system is very busy and zsh receives
> SIGHUP from shutdown, it starts to write the history (creates to lock) but
> the shutdown sends (after a while) SIGKILL and it doesn't finish (the .LOCK
> remains) the system reboots.. and voila I'm not able to login because
> sendmail is running with the same PID that zsh had.
> 
> Is that ok?
> 
> (I have here Linux with glibc-2.1.3 and zsh-3.1.9)
> 
> PS: Should I try 3.1.9-dev-7?

It looks like 3.1.9-dev6 will kill the lockfile if it isn't available
for 10 seconds.  So 3.1.9-dev-7 probably fixes your problem.

