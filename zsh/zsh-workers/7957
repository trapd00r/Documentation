From zsh-workers-return-7957-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Sep 20 13:39:39 1999
Return-Path: <zsh-workers-return-7957-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17331 invoked from network); 20 Sep 1999 13:16:05 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 20 Sep 1999 13:16:05 -0000
Received: (qmail 17145 invoked by alias); 20 Sep 1999 13:15:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7957
Received: (qmail 17124 invoked from network); 20 Sep 1999 13:15:49 -0000
Message-Id: <9909201240.AA24461@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: PATCH: 3.1.6-pws-5: zmodload -e in statically linked shell
Date: Mon, 20 Sep 1999 14:40:20 +0200
From: Peter Stephenson <pws@ibmth.df.unipi.it>

I tried --enable-zsh-mem --disable-lfs on a 32-bit machine and there didn't
seem to be any obvious alignment problems.

Meanwhile I found that `zmodload -e module' isn't working properly in
shells without dynamic loading.

--- Src/module.c.zme	Mon Aug 30 13:38:48 1999
+++ Src/module.c	Mon Sep 20 14:35:45 1999
@@ -1181,13 +1181,13 @@
 		nicezputs((char *) getdata(node), stdout);
 		putchar('\n');
 	    }
+	    return 0;
 	} else {
 	    for (; *args; args++)
 		for (node = firstnode(bltinmodules); node; incnode(node))
-		    if (strcmp(*args, (char *) getdata(node)))
-			return 1;
+		    if (!strcmp(*args, (char *) getdata(node)))
+			return 0;
 	}
-	return 0;
     }
     /* Otherwise we return 1 -- different from the dynamic version. */
     return 1;

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

