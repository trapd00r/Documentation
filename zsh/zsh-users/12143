From zsh-users-return-12143-mason-zsh=primenet.com.au@sunsite.dk Tue Oct 30 10:45:34 2007
Return-Path: <zsh-users-return-12143-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5698 invoked from network); 30 Oct 2007 10:45:24 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 30 Oct 2007 10:45:24 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 32755 invoked from network); 30 Oct 2007 10:45:17 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 30 Oct 2007 10:45:17 -0000
Received: (qmail 2902 invoked by alias); 30 Oct 2007 10:45:09 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12143
Received: (qmail 2884 invoked from network); 30 Oct 2007 10:45:08 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 30 Oct 2007 10:45:08 -0000
Received: (qmail 31643 invoked from network); 30 Oct 2007 10:45:08 -0000
Received: from cluster-d.mailcontrol.com (217.69.20.190)
  by a.mx.sunsite.dk with SMTP; 30 Oct 2007 10:45:02 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly40d.srv.mailcontrol.com (MailControl) with ESMTP id l9UAj0Gu016839
	for <zsh-users@sunsite.dk>; Tue, 30 Oct 2007 10:45:00 GMT
Received: from news01 ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Tue, 30 Oct 2007 10:45:00 +0000
Date: Tue, 30 Oct 2007 10:44:59 +0000
From: Peter Stephenson <pws@csr.com>
To: zsh-users@sunsite.dk
Subject: Re: field splitting with empty fields
Message-ID: <20071030104459.562a77b1@news01>
In-Reply-To: <20071030042048.GA32506@scowler.net>
References: <20071029235835.GA29356@scowler.net>
	<071029171355.ZM28438@torch.brasslantern.com>
	<20071030042048.GA32506@scowler.net>
Organization: CSR
X-Mailer: Claws Mail 3.0.2 (GTK+ 2.10.14; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 30 Oct 2007 10:45:00.0121 (UTC) FILETIME=[EB825490:01C81AE1]
X-Scanned-By: MailControl A-07-08-10 (www.mailcontrol.com) on 10.68.0.150

On Tue, 30 Oct 2007 00:20:48 -0400
Clint Adams <clint@zsh.org> wrote:
> On Mon, Oct 29, 2007 at 05:13:55PM -0700, Bart Schaefer wrote:
> > print ${list//:/$'\n'}
> > 
> > ??
> 
> Okay, I asked a stupid question.
> 
> I want the line split into words according to fields which may be
> blank.  Right now I'm substituting :x: for :: and then removing 
> the x's to ensure that the array value match up to the proper
> indices.  This seems suboptimal.

It's odd it removes the space even if quoted:

% foo="one:two::four:five"
% print -l "${(@s.:.)foo}"
one
two
four
five

(the "@" doesn't make a difference, it's just to make the point.)  This
seems to be deliberate in paramsubst() in subst.c: isarr is set to 2 in
this case, and there's a special test:

		if (qt && !*y && isarr != 2)
		    y  = dupstring(nulstring);
		else {
		    y = dupstring(x);
		    if (globsubst)
			shtokenize(y);
		}

i.e. add a special empty string if it's quoted (which it is) and the string
is empty (which it is) and isarr is not 2 (but it is).  That first branch
means the argument won't be removed due to being empty; since we don't
take it, it will be removed.

The only comment on isarr is by me at the top of the function speculating
on what it actually means (unfortunately most of the comments in the
function were added much later by me along the lines of "I don't really
know what this does or why it's so obscure or why the author couldn't be
bothered to explain it") and I think I got it wrong.  I think it's to do
with this case and its relatives, i.e. splitting into an array.  However,
why we want to ignore the effect of the double quotes here is not clear to
me.  I can't see anything in the manual which would explain it, either.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

