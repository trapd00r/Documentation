From zsh-workers-return-9572-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Feb 04 16:12:43 2000
Return-Path: <zsh-workers-return-9572-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4562 invoked from network); 4 Feb 2000 16:12:42 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 4 Feb 2000 16:12:42 -0000
Received: (qmail 26681 invoked by alias); 4 Feb 2000 16:12:37 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9572
Received: (qmail 26674 invoked from network); 4 Feb 2000 16:12:36 -0000
To: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
Cc: zsh-workers@sunsite.auc.dk, Clint Olsen <olsenc@ichips.intel.com>
Subject: Re: Zsh 3.1.6 still hangs on for loops utilizing lots of stdout
References: <200002041230.NAA24341@beta.informatik.hu-berlin.de>
X-Attribution: adl
From: Alexandre Duret-Lutz <duret_g@epita.fr>
Date: 04 Feb 2000 17:11:07 +0100
In-Reply-To: Sven Wischnowsky's message of "Fri, 4 Feb 2000 13:30:53 +0100 (MET)"
Message-ID: <mvbematq76s.fsf@phobos.lrde.epita.fr>
Lines: 53
User-Agent: Gnus/5.0803 (Gnus v5.8.3) Emacs/20.5
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

>>> "Sven" == Sven Wischnowsky <wischnow@informatik.hu-berlin.de> writes:

 Sven> Alexandre Duret-Lutz wrote:

[...]

 >> for i in *.wav
 >> do
 >> 8hz-mp3 $i $i:r.mp3
 >> done

[...]

 Sven> Well, we had some problems with IO and AIX but this stack trace looks
 Sven> completely fine -- saying only that it's waiting for the 8hz-mp3.

Indeed.  In fact zsh was still running and the loop finished: 8hz's work
was done on each file. 

 Sven> In both cases: does it happen with other shells, too?

Yes!  Maybe there is something wrong,  

In the two cases below, I run the loop in the launched rxvt.  
And that rxvt which is segfaulting.

/goinfre/swiss-1 % gdbterm zsh                                        11:27 #14
/home/prolob/pollux/mbin/gdbterm: line 2:  6751 Segmentation fault      rxvt +ls +sb -title GDBterm -e sh -c 'exec rxvt +ls +sb -e gdb --tty=`tty` '"$*"

/goinfre/swiss-1 % rxvt -e bash                                     Err 139 #15
zsh: segmentation fault  rxvt -e bash

with another terminal emulator (xterm), this behave differently: 
after a few iterations in the for loop, it's like something is going mad
and print newlines in loop.  I tried to run the whole loop
through `od' to see if these where realy newlines or something else :

/goinfre/swiss-2 % for i in *.wav                                    Err 139 #6
do
  8hz-mp3 $i $i:r.mp3
done | od

[...lot's of output...]

zsh: exit 141            for i in *.wav; do; 8hz-mp3 $i $i:r.mp3; done | od | 
zsh: segmentation fault  od                                               

How fun! now, that's od which is segfaulting. BTW where does this last pipe
(after `od' on the exit report line) come from?.

I will try to see if I can reproduce this without 8hz.
-- 
Alexandre Duret-Lutz

