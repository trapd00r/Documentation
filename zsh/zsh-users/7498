From zsh-users-return-7498-mason-zsh=primenet.com.au@sunsite.dk Tue Jun 08 23:28:29 2004
Return-Path: <zsh-users-return-7498-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18269 invoked from network); 8 Jun 2004 23:28:29 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.86)
  by ns1.primenet.com.au with SMTP; 8 Jun 2004 23:28:29 -0000
Received: (qmail 13101 invoked from network); 8 Jun 2004 23:27:38 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 8 Jun 2004 23:27:38 -0000
Received: (qmail 1709 invoked by alias); 8 Jun 2004 23:27:27 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 7498
Received: (qmail 1699 invoked from network); 8 Jun 2004 23:27:27 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (qmailr@130.225.247.86)
  by sunsite.dk with SMTP; 8 Jun 2004 23:27:24 -0000
Received: (qmail 12213 invoked from network); 8 Jun 2004 23:27:24 -0000
Received: from vinc17.net1.nerim.net (HELO ay.vinc17.org) (62.4.18.82)
  by a.mx.sunsite.dk with SMTP; 8 Jun 2004 23:27:21 -0000
Received: from lefevre by ay.vinc17.org with local (Exim 4.32)
	id 1BXpzZ-0003CP-N7; Wed, 09 Jun 2004 01:26:53 +0200
Date: Wed, 9 Jun 2004 01:26:53 +0200
From: Vincent Lefevre <vincent@vinc17.org>
To: zsh-users@sunsite.dk
Subject: Error "job table full"
Message-ID: <20040608232653.GG2757@ay.vinc17.org>
Mail-Followup-To: zsh-users@sunsite.dk
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
X-Mailer-Info: http://www.vinc17.org/mutt/
User-Agent: Mutt/1.5.6i
Sender: Vincent Lefevre <vincent@vinc17.org>
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

In one of my shells, I get the error

precmd:3: job table full

before each prompt. This suddenly appeared (after typing the command
"svn ci"). Here's my precmd function:

precmd () {
	local njobs
	if [[ $domain = local.ay && "$(pmu_battery)" = "Battery" ]]
	then
		psvar[1]="[$(pmu_percent)%]" 
	else
		psvar[1]="" 
	fi
	njobs=$#jobstates 
	case $njobs in
		(0) psvar[2]=()  ;;
		(1) psvar[2]="1 job"  ;;
		(*) psvar[2]="$njobs jobs"  ;;
	esac
	[[ -n $TTY && $TERM = (xterm*|dtterm|rxvt|screen*) ]] && {
		print -nP "\e]1;%m:%.\x07"
		print -nP "\e]2;%(2v. %2v |.)${WINTITLE:+ $WINTITLE |} %n@%m - %~ | %y"
		[[ $TERM = screen* ]] && print -n .
		print -n "\x07"
	} > $TTY
}

There are no current jobs.

The error comes from the "$(pmu_battery)" = "Battery" test, as this
can be seen:

ay:~> [[ "$(true)" = blah ]]
zsh: job table full
precmd:3: job table full
ay:~[1]>

But no problem with:

ay:~> [ "$(true)" = blah ]
zsh: exit 1
precmd:3: job table full
ay:~[1]>

Also,

ay:~> [[ "$(echo blah)" = blah ]]
zsh: job table full
precmd:3: job table full
ay:~[1]>

but

ay:~> [[ blah = blah ]]
precmd:3: job table full
ay:~>

zsh version is 4.2.0 (Debian package zsh 4.2.0-11).

-- 
Vincent Lefèvre <vincent@vinc17.org> - Web: <http://www.vinc17.org/>
100% validated (X)HTML - Acorn / RISC OS / ARM, free software, YP17,
Championnat International des Jeux Mathématiques et Logiques, etc.
Work: CR INRIA - computer arithmetic / SPACES project at LORIA

