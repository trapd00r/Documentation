From zsh-users-return-13946-mason-zsh=primenet.com.au@sunsite.dk Fri Mar 20 07:16:47 2009
Return-Path: <zsh-users-return-13946-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7499 invoked from network); 20 Mar 2009 07:16:44 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 20 Mar 2009 07:16:44 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 43472 invoked from network); 20 Mar 2009 07:16:30 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 20 Mar 2009 07:16:30 -0000
Received: (qmail 20357 invoked by alias); 20 Mar 2009 07:16:12 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13946
Received: (qmail 20345 invoked from network); 20 Mar 2009 07:16:11 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 20 Mar 2009 07:16:11 -0000
Received: from mx.spodhuis.org (redoubt-new.spodhuis.org [94.142.241.89])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 828E282CF027
	for <zsh-users@sunsite.dk>; Fri, 20 Mar 2009 08:15:59 +0100 (CET)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws; s=d200902; d=spodhuis.org;
	h=Received:Date:From:To:Cc:Subject:Message-ID:Mail-Followup-To:References:MIME-Version:Content-Type:Content-Disposition:Content-Transfer-Encoding:In-Reply-To;
	b=TQTOMx4sVF+2Ct/SKfTnQC+uF4wO3QpJN0juRYuVKwhaByZjc4HTB/FdRQ+K7xQtPf08lXQ3SQE8Yhtp13fSuphCEtP8/JPyLLgoO1FTWwaZ3VQTYovnT9dcUYSRgePMI9scgImBVNMz8aT/jA/LZbbVta6d+ShrSbRKsksVpno=;
Received: by smtp.spodhuis.org with local 
	id 1LkYxR-000GcV-4t; Fri, 20 Mar 2009 07:15:57 +0000
Date: Fri, 20 Mar 2009 00:15:57 -0700
From: Phil Pennock <zsh-workers+phil.pennock@spodhuis.org>
To: TjL <luomat@gmail.com>
Cc: Zsh Users List <zsh-users@sunsite.dk>
Subject: Re: up-arrow no longer works right
Message-ID: <20090320071556.GA63370@redoubt.spodhuis.org>
Mail-Followup-To: TjL <luomat@gmail.com>,
	Zsh Users List <zsh-users@sunsite.dk>
References: <d2ecb10b0903191838y68e1dfbbsa80289a52256eb2a@mail.gmail.com> <20090320024835.GA64103@redoubt.spodhuis.org> <d2ecb10b0903192303h1f9b0487g335cd5335f708ff@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <d2ecb10b0903192303h1f9b0487g335cd5335f708ff@mail.gmail.com>
X-Virus-Scanned: ClamAV 0.92.1/9143/Fri Mar 20 04:40:02 2009 on bifrost
X-Virus-Status: Clean

On 2009-03-20 at 02:03 -0400, TjL wrote:
> On Thu, Mar 19, 2009 at 10:48 PM, Phil Pennock
> <zsh-workers+phil.pennock@spodhuis.org> wrote:
> > Perhaps the cursor keys have been put into application mode and your
> > terminal type isn't supporting them in that mode?
> 
> I don't know what that means :-/

Any terminal emulator with a heritage that stretches back to emulating
VT100 terminals will implement a certain set of features, with
"standard" escape sequences for them.  This includes xterm and all the
knock-offs.

One of these features is the ability to have the numeric keypad keys
send different characters to the normal digits, etc.  That's
"application mode".  The cursor keys can be put into a mode where they
send escape sequences which are similar to the application mode escape
sequences.  That seems to be more common.  I don't know enough about
such things to know why any application bothers to do this.

Normally, any program which changes the terminal mode will change it
back against afterwards, but if the program did not shut down cleanly,
or didn't get a chance to, then this won't happen.

So, if you want the up-key to always invoke a particular widgit, then
you need to bind *two* different escape sequences: both the normal \e[A
and also \eOA (where the escape sequence ESC is in more modern
environments written \e but in older setups is written ^[ instead).

> > If you run "bindkey", you'll see two batches for the two sets of cursor
> > keys; for me:
> > "^[OA" up-line-or-history
> > "^[OB" down-line-or-history
> > "^[OC" forward-char
> > "^[OD" backward-char
> > [...]
> > "^[[A" up-line-or-history
> > "^[[B" down-line-or-history
> > "^[[C" forward-char
> > "^[[D" backward-char
> >
> > If those two sets ^[O<foo> and ^[[<foo> differ then this might explain
> > it.  So, (1) bind both sets the same and (2) see if "stty sane" helps.

> > And:  print -n '\e[?1l'
> 
> that fixes it

So, bind ^[OA as well as ^[[A and the keys will still work even in
application mode.

