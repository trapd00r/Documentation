From zsh-workers-request@math.gatech.edu Fri Jun 12 03:09:13 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19496 invoked from network); 12 Jun 1998 03:09:11 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 12 Jun 1998 03:09:11 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id WAA15822;
	Thu, 11 Jun 1998 22:57:20 -0400 (EDT)
Resent-Date: Thu, 11 Jun 1998 22:57:20 -0400 (EDT)
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <980611195818.ZM18687@candle.brasslantern.com>
Date: Thu, 11 Jun 1998 19:58:18 -0700
In-Reply-To: <9806111526.AA19795@ibmth.df.unipi.it>
Comments: In reply to Peter Stephenson <pws@ibmth.df.unipi.it>
        "Re: Bugreport zsh 3.1.2: Shell exits prematurely after aborting history-incremental-search-backward" (Jun 11,  5:26pm)
References: <9806111526.AA19795@ibmth.df.unipi.it>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@math.gatech.edu
Subject: Re: Bugreport zsh 3.1.2: Shell exits prematurely after aborting history-incremental-search-backward
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"Rub1l3.0.9t3.Fa9Wr"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4096
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On Jun 11,  5:26pm, Peter Stephenson wrote:
} Subject: Re: Bugreport zsh 3.1.2: Shell exits prematurely after aborting h
}
} I had a look at this again, and I believe my previous analysis, that
} the lastc variable wasn't getting set properly, was the correct
} one.  This time I followed the problem at bit further back.
} In my case, /etc/zshenv was being sourced immediately before the
} command loop started.  At EOF, inputline() returned false; this caused
} ingetc() to set lastc to ' ', the behaviour which I found suspect.

This patch certainly does seem to stop the shell from exiting.  I still
think there's an EOF being incorrectly propagated when the bck-i-search:
prompt is interrupted with C-c, but perhaps that doesn't matter if this
masks it.  Thanks for checking again, Peter.

Side note:  What's the point of leaving out the 'a' in "bck"?  Just to
make it the same number of characters as "fwd"?

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

