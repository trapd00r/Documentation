From zsh-workers-return-13071-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Oct 24 07:48:43 2000
Return-Path: <zsh-workers-return-13071-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17762 invoked from network); 24 Oct 2000 07:48:41 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 24 Oct 2000 07:48:41 -0000
Received: (qmail 29397 invoked by alias); 24 Oct 2000 07:48:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 13071
Received: (qmail 29390 invoked from network); 24 Oct 2000 07:48:35 -0000
Date: Tue, 24 Oct 2000 09:47:19 +0200 (MET DST)
Message-Id: <200010240747.JAA22988@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: file type characters after slash


In the mail I just sent I promised to commit this patch. It keeps the
completion code from printing the file type characters for names
ending in a slash.

Bye
 Sven

Index: Src/Zle/complist.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/complist.c,v
retrieving revision 1.34
diff -u -r1.34 complist.c
--- Src/Zle/complist.c	2000/10/11 12:19:25	1.34
+++ Src/Zle/complist.c	2000/10/24 07:46:45
@@ -1241,7 +1241,8 @@
 			    goto end;
 			break;
 		    }
-		    if (!m->disp && (m->flags & CMF_FILE)) {
+		    if (!m->disp && (m->flags & CMF_FILE) &&
+			m->str[0] && m->str[strlen(m->str) - 1] != '/') {
 			struct stat buf;
 			char *pb;
 
Index: Src/Zle/compresult.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compresult.c,v
retrieving revision 1.25
diff -u -r1.25 compresult.c
--- Src/Zle/compresult.c	2000/10/11 12:19:25	1.25
+++ Src/Zle/compresult.c	2000/10/24 07:46:45
@@ -1886,7 +1886,8 @@
 			printm(g, NULL, mc, ml, (!i), wid, NULL, NULL);
 			break;
 		    }
-		    if (!m->disp && (m->flags & CMF_FILE)) {
+		    if (!m->disp && (m->flags & CMF_FILE) &&
+			m->str[0] && m->str[strlen(m->str) - 1] != '/') {
 			struct stat buf;
 			char *pb;
 

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

