From zsh-workers-return-16407-mason-zsh=primenet.com.au@sunsite.dk Mon Jan 07 14:38:56 2002
Return-Path: <zsh-workers-return-16407-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6907 invoked from network); 7 Jan 2002 14:38:56 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 7 Jan 2002 14:38:56 -0000
Received: (qmail 24483 invoked by alias); 7 Jan 2002 14:38:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16407
Received: (qmail 24470 invoked from network); 7 Jan 2002 14:38:48 -0000
From: Sven Wischnowsky <wischnow@berkom.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <15417.45719.865154.105308@wischnow.berkom.de>
Date: Mon, 7 Jan 2002 15:37:11 +0100
To: zsh-workers@sunsite.dk
Subject: Re: _urls -f
In-Reply-To: <3C173E6B.251ACAD4@yahoo.co.uk>
References: <3C163FA6.BC9C1A66@yahoo.co.uk>
	<hvo7krtkqdv.fsf@coulee.a02.aist.go.jp>
	<3C173E6B.251ACAD4@yahoo.co.uk>
X-Mailer: VM 6.95 under 21.5 (patch 3) "asparagus" XEmacs Lucid


Oliver Kiddle wrote:

> ...
> 
> For netscape, a tag-order of urls before files doesn't seem to work
> entirely so I think I'm still misunderstanding the tags stuff there
> somewhere.

The problem is that one can't use nested _tags-loops in the same
function because the C-code behind it has to keep some internal state
which would get messed up otherwise.

One solution is to re-initialise the outer _tags in the right place.
Another solution would be to move the code into its own little helper
function. The patch below does the former.

Bye
  Sven

Index: Completion/X/Command/_netscape
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/X/Command/_netscape,v
retrieving revision 1.3
diff -u -r1.3 _netscape
--- Completion/X/Command/_netscape	2002/01/02 14:45:22	1.3
+++ Completion/X/Command/_netscape	2002/01/07 14:38:33
@@ -1,6 +1,6 @@
 #compdef netscape
 
-local curcontext="$curcontext" state line ret=1 suf
+local curcontext="$curcontext" state line ret=1 suf files
 typeset -A opt_args
 
 _x_arguments -C \
@@ -68,7 +68,7 @@
 if [[ "$state" = "urls" ]]; then
   _tags files urls
   while _tags; do
-    _requested files expl 'file' _files "$@" && ret=0
+    _requested files expl 'file' _files "$@" && files=yes ret=0
     if _requested urls; then
       # Complete netscape urls
       if compset -P about: ; then
@@ -87,6 +87,7 @@
 	  done
 	  (( ret )) || return 0
 	done
+        [[ -z "$files" ]] && _tags files
       fi
     fi
     (( ret )) || return 0

-- 
Sven Wischnowsky                           wischnow@berkom.de

