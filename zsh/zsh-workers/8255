From zsh-workers-return-8255-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Oct 14 14:28:49 1999
Return-Path: <zsh-workers-return-8255-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3354 invoked from network); 14 Oct 1999 14:28:44 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 14 Oct 1999 14:28:44 -0000
Received: (qmail 20288 invoked by alias); 14 Oct 1999 14:28:32 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8255
Received: (qmail 20280 invoked from network); 14 Oct 1999 14:28:31 -0000
To: zsh-workers@sunsite.auc.dk
Subject: Re: PATCH: Re: _urls, _netscape, a seg fault and new completion thoughts
References: <199910141141.NAA13535@beta.informatik.hu-berlin.de>
MIME-Version: 1.0 (generated by AKEMI 1.13.2 - =?ISO-2022-JP?B?Ig==?=
 =?ISO-2022-JP?B?GyRCQTA0Y0s8GyhCIg==?=)
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@jaist.ac.jp>
Date: 14 Oct 1999 23:28:28 +0900
In-Reply-To: Sven Wischnowsky's message of "Thu, 14 Oct 1999 13:41:10 +0200 (MET DST)"
Message-ID: <rsqk8oq3tkj.fsf@crane.jaist.ac.jp>
Lines: 69
User-Agent: Chao-gnus/6.12.5 AKEMI/1.13.2 (=?ISO-2022-JP?B?GyRCQTAbKEI=?=
 =?ISO-2022-JP?B?GyRCNGNLPBsoQg==?=) FLAM-DOODLE/1.12.6
 (=?ISO-2022-JP?B?GyRCM3cbKEI=?= 10R4.0/5.0) Emacs/20.4
 (sparc-sun-solaris2.6) MULE/4.0 (HANANOEN)

In article <199910141141.NAA13535@beta.informatik.hu-berlin.de>,
  Sven Wischnowsky <wischnow@informatik.hu-berlin.de> writes:

> diff -u -r oldcompletion/Core/_main_complete Completion/Core/_main_complete
> --- oldcompletion/Core/_main_complete	Wed Oct 13 16:18:19 1999
> +++ Completion/Core/_main_complete	Thu Oct 14 13:38:04 1999

> @@ -55,6 +57,24 @@
>    "$post"
>  done
>  comppostfuncs=()
> +
> +_lastdescr=( "\`${(@)^_lastdescr:#}'" )
> +if [[ compstate[nmatches] -eq 0 &&
> +      -n "$compconfig[warning_format]" && $#_lastdescr -ne 0 ]]; then
> +  local str
> +
> +  compstate[list]=list
> +  compstate[force_list]=yes
> +  compstate[insert]=''
> +
> +  case $#_lastdescr in
> +  1) str="$_lastdescr[1]";;
> +  2) str="$_lastdescr[1] or $_lastdescr[2]";;
> +  *) str="${(j:, :)_lastdescr[1,-2]}, or $_lastdescr[-1]";;
> +  esac
> +
> +  compadd -UX "${compconfig[warning_format]//\\%d/$str}" -n ''
> +fi
>  
>  [[ "$compconfig[last_prompt]" = always ]] && compstate[last_prompt]=yes
>  

I couldn't apply this hunk. 

Z:akr@rascal% patch --dry-run -p0 < ../patchsrc/zsh-workers/8249
patching file Src/Zle/compctl.c
patching file Src/Zle/compctl.mdd
patching file Doc/Zsh/compctl.yo
patching file Doc/Zsh/compsys.yo
patching file Completion/Builtins/_nothing
patching file Completion/Core/_description
patching file Completion/Core/_files
patching file Completion/Core/_main_complete
Hunk #1 succeeded at 24 with fuzz 2.
Hunk #2 FAILED at 57.
1 out of 2 hunks FAILED -- saving rejects to file Completion/Core/_main_complete.rej
patching file Completion/Core/_message
patching file Completion/Core/_multi_parts
patching file Completion/Core/_path_files
patching file Completion/Core/_sep_parts
zsh: exit 1     patch --dry-run -p0 < ../patchsrc/zsh-workers/8249

I searched `comppostfuncs' in my zsh-workers archive, but a patch for
_main_complete which contains `comppostfuncs' was not found.

Z:akr@rascal% grep comppostfuncs ../patchsrc/zsh-workers/8???
../patchsrc/zsh-workers/8227:widgets. So I added the `comppostfuncs' array which is normally
../patchsrc/zsh-workers/8227:About this `comppostfuncs' business: some time ago we discussed ways
../patchsrc/zsh-workers/8227:what-we-have, the `comppostfuncs' array may look more useful.
../patchsrc/zsh-workers/8227:+functions whose names are given in the tt(comppostfuncs) array and
../patchsrc/zsh-workers/8227:+  comppostfuncs=( "$post[@]" )
../patchsrc/zsh-workers/8227:+    [[ "$twid" = "$wid" ]] && comppostfuncs=( "$post[@]" )
../patchsrc/zsh-workers/8249: comppostfuncs=()
Z:akr@rascal% 

Maybe, a patch for _main_complete was forgotten in 8227.
-- 
Tanaka Akira

