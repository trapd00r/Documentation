From zsh-workers-request@math.gatech.edu  Wed Nov  8 19:54:09 1995
Received: from math.gatech.edu (euclid.skiles.gatech.edu [130.207.146.50]) by werple.net.au (8.7/8.7.1) with SMTP id TAA26165 for <mason@werple.mira.net.au>; Wed, 8 Nov 1995 19:54:03 +1100 (EST)
Received: by math.gatech.edu (5.x/SMI-SVR4)
	id AA18239; Wed, 8 Nov 1995 03:37:44 -0500
Resent-Date: Wed, 08 Nov 95 08:39:39 +0000
Old-Return-Path: <P.Stephenson@swan.ac.uk>
Message-Id: <25373.9511080839@pygmy.swan.ac.uk>
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: Re: Startup Time 
In-Reply-To: "awick@barney.purple.org"'s message of "Tue, 07 Nov 95 13:10:58 EST."             <9511071810.AA16690@purple.org> 
Date: Wed, 08 Nov 95 08:39:39 +0000
From: P.Stephenson@swansea.ac.uk
X-Mts: smtp
Resent-Message-Id: <"GaA5M1.0.vS4.Nn6em"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/560
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

awick@barney.purple.org wrote:
> 1)  ^ by itself crashes zsh.  (present since at least beta6)

This seems to be the minmal fix.  Although I'm not sure this is
documented, what ^ on it's own does is attempt to replace the last
pattern substituted with nothing in the previous history line.  This
was failing if there was no previous substitution.  This bug crept in
when I tidied up the history code: before, the code hacked the input
and the history code status so that it thought a real substitution
like !!^ was coming up, which handles this case.  If your dead set on
the message "no previous subsitution with &" here too, I can add that.

*** Src/hist.c~	Tue Nov  7 09:48:34 1995
--- Src/hist.c	Wed Nov  8 09:25:47 1995
***************
*** 152,158 ****
  	inungetc(hatchar);
  	if (!(ehist = gethist(defev))
  	    || !(sline = getargs(ehist, 0, ehist->nwords-1))
! 	    || getsubsargs(sline))
  	    return -1;
  	subst(&sline, hsubl, hsubr, 0);
      } else {
--- 152,158 ----
  	inungetc(hatchar);
  	if (!(ehist = gethist(defev))
  	    || !(sline = getargs(ehist, 0, ehist->nwords-1))
! 	    || getsubsargs(sline) || !hsubl)
  	    return -1;
  	subst(&sline, hsubl, hsubr, 0);
      } else {


-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77330
Deutches Electronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.

