From zsh-workers-return-21571-mason-zsh=primenet.com.au@sunsite.dk Mon Aug 08 09:06:56 2005
Return-Path: <zsh-workers-return-21571-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29306 invoked from network); 8 Aug 2005 09:06:52 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 8 Aug 2005 09:06:52 -0000
Received: (qmail 19512 invoked from network); 8 Aug 2005 09:06:45 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 8 Aug 2005 09:06:45 -0000
Received: (qmail 17721 invoked by alias); 8 Aug 2005 09:06:42 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21571
Received: (qmail 17712 invoked from network); 8 Aug 2005 09:06:42 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 8 Aug 2005 09:06:42 -0000
Received: (qmail 19217 invoked from network); 8 Aug 2005 09:06:42 -0000
Received: from cluster-a.mailcontrol.com (HELO rly25a.srv.mailcontrol.com) (80.69.8.190)
  by a.mx.sunsite.dk with SMTP; 8 Aug 2005 09:06:35 -0000
Received: from iris.logica.co.uk (iris.logica.co.uk [158.234.9.163])
	by rly25a.srv.mailcontrol.com (MailControl) with ESMTP id j7896QNS004130;
	Mon, 8 Aug 2005 10:06:26 +0100
Received: from trentino.logica.co.uk ([158.234.142.59])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id j7896KTp011511;
	Mon, 8 Aug 2005 10:06:20 +0100
Received: from trentino.groupinfra.com (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP id A02E87E571;
	Mon,  8 Aug 2005 11:06:20 +0200 (CEST)
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <20050805193652.GA6842@spiegl.de> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <20050802180158.GA10402@spiegl.de> <19401.1123058911@trentino.groupinfra.com> <20050803101007.GA9755@spiegl.de> <2356.1123064346@trentino.groupinfra.com> <20050805154030.GA16800@spiegl.de> <32449.1123262228@trentino.groupinfra.com> <20050805193652.GA6842@spiegl.de>
To: zsh-workers@sunsite.dk
Cc: Andy Spiegl <zsh.Andy@spiegl.de>
Subject: Re: simple completion example? (aptitude completion doesn't work) 
Date: Mon, 08 Aug 2005 11:06:20 +0200
Message-ID: <30056.1123491980@trentino.groupinfra.com>
X-Scanned-By: MailControl A-05-01-05 (www.mailcontrol.com)
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.4

On 5 Aug, Andy Spiegl wrote:

> > If aptitude -h is giving you a German (or other) translation, try adding
> > LC_MESSAGES=C in but I don't think that translation would actually break
> > it in this particular case.
> YES, that was it!  Of course, why didn't I think of that!?

We seem to be getting a lot of these translation related problems. Could
do with someone finding the time to look through for any further
instances.

> But there isn't such a big difference...Hm, maybe Verwendung instead of usage?
> Can you think of a workaround for international users like me?

In general, the patch below adding LC_MESSAGES=C does the job.

It's very tempting to try to make the parsing work with the German
output so that people get translated descriptions. However, if the
formats aren't consistent it's probably only asking for trouble. And the
completion code probably wouldn't handle the umlauts too well either.

Oliver

Index: Completion/Debian/Command/_aptitude
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Debian/Command/_aptitude,v
retrieving revision 1.3
diff -u -r1.3 _aptitude
--- Completion/Debian/Command/_aptitude	31 Mar 2005 13:39:18 -0000	1.3
+++ Completion/Debian/Command/_aptitude	8 Aug 2005 08:59:44 -0000
@@ -26,7 +26,7 @@
 
 case $state in
   cmds)
-    cmds=( ${${(M)${(f)"$(aptitude -h 2>/dev/null)"}:#* - *}/(#b) (*[^ ]) #- (*)/$match[1]:$match[2]:l})
+    cmds=( ${${(M)${(f)"$(LC_MESSAGES=C _call_program commands aptitude -h 2>/dev/null)"}:#* - *}/(#b) (*[^ ]) #- (*)/$match[1]:$match[2]:l})
 
     _describe -t commands 'aptitude command' cmds && ret=0
   ;;


This e-mail and any attachment is for authorised use by the intended recipient(s) only. It may contain proprietary material, confidential information and/or be subject to legal privilege. It should not be copied, disclosed to, retained or used by, any other party. If you are not an intended recipient then please promptly delete this e-mail and any attachment and all copies and inform the sender. Thank you.

