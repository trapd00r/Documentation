From zsh-users-return-8984-mason-zsh=primenet.com.au@sunsite.dk Wed Jun 08 20:21:40 2005
Return-Path: <zsh-users-return-8984-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23948 invoked from network); 8 Jun 2005 20:21:39 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 8 Jun 2005 20:21:39 -0000
Received: (qmail 6899 invoked from network); 8 Jun 2005 20:21:33 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 8 Jun 2005 20:21:33 -0000
Received: (qmail 1655 invoked by alias); 8 Jun 2005 20:21:23 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8984
Received: (qmail 1644 invoked from network); 8 Jun 2005 20:21:22 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 8 Jun 2005 20:21:22 -0000
Received: (qmail 5790 invoked from network); 8 Jun 2005 20:21:22 -0000
Received: from smtp2.poczta.interia.pl (HELO smtp.poczta.interia.pl) (213.25.80.232)
  by a.mx.sunsite.dk with SMTP; 8 Jun 2005 20:21:18 -0000
Received: by smtp.poczta.interia.pl (INTERIA.PL, from userid 502)
	id AA8EBD0CC0; Wed,  8 Jun 2005 22:21:17 +0200 (CEST)
Received: from poczta.interia.pl (mi01.poczta.interia.pl [10.217.12.1])
	by smtp.poczta.interia.pl (INTERIA.PL) with ESMTP id C48FCD2255
	for <zsh-users@sunsite.dk>; Wed,  8 Jun 2005 22:21:08 +0200 (CEST)
Received: by poczta.interia.pl (INTERIA.PL, from userid 502)
	id A0BB726F82C; Wed,  8 Jun 2005 22:21:02 +0200 (CEST)
Received: from localhost.localdomain (ajm186.internetdsl.tpnet.pl [83.16.246.186])
	by poczta.interia.pl (INTERIA.PL) with ESMTP id 3CF6D26F7E9
	for <zsh-users@sunsite.dk>; Wed,  8 Jun 2005 22:21:02 +0200 (CEST)
Received: from Mutt by mutt-smtp-wrapper.pl 1.2  (www.zdo.com/articles/mutt-smtp-wrapper.shtml)
Date: Wed, 8 Jun 2005 22:21:02 +0200
From: Mariusz Gniazdowski <cellsan@interia.pl>
To: zsh-users@sunsite.dk
Subject: Re: Using libmysqlclient from module
Message-ID: <20050608202102.GA5724@mordor.lan>
Reply-To: Mariusz Gniazdowski <cellsan@interia.pl>
Mail-Followup-To: zsh-users@sunsite.dk
References: <20050607230322.GA2419@mordor.lan>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-2
Content-Disposition: inline
In-Reply-To: <20050607230322.GA2419@mordor.lan>
User-Agent: Mutt/1.5.8i
X-EMID: 44c566cc
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00,UPPERCASE_25_50 
	autolearn=no version=3.0.2
X-Spam-Hits: -2.6

Funny thing happened: i straced normal application, and zsh running
sql_connect builtin. Following lines differ:

zsh_module:
open("/usr/share/mysql/charsetsIndex", O_RDONLY|O_LARGEFILE) = -1 ENOENT (No such file or directory)

normal app:
open("/usr/share/mysql/charsets/Index", O_RDONLY|O_LARGEFILE) = 4


Weird why slash before 'Index' is ommited?

Full straces:

zsh:

rt_sigaction(SIGPIPE, {SIG_IGN}, {SIG_DFL}, 8) = 0
socket(PF_FILE, SOCK_STREAM, 0)         = 3
fcntl64(3, F_GETFL)                     = 0x2 (flags O_RDWR)
connect(3, {sa_family=AF_FILE, path="/var/run/mysqld/mysqld.sock"}, 110) = 0
setsockopt(3, SOL_IP, IP_TOS, [8], 4)   = -1 EOPNOTSUPP (Operation not supported)
setsockopt(3, SOL_SOCKET, SO_KEEPALIVE, [1], 4) = 0
read(3, "\'\0\0\0", 4)                  = 4
read(3, "\n4.0.22\0\244\3\0\0003?$4w~5(\0, \10\2\0\0\0\0\0\0\0"..., 39) = 39
open("/usr/share/mysql/charsetsIndex", O_RDONLY|O_LARGEFILE) = -1 ENOENT (No such file or directory)
open("/usr/share/mysql/charsets?.conf", O_RDONLY|O_LARGEFILE) = -1 ENOENT (No such file or directory)
write(3, "\t\0\0\1\205 \0\0\0root", 13) = 13
read(3, "", 4)                          = 0
read(3, "", 4)                          = 0
shutdown(3, 2 /* send and receive */)   = 0
close(3)                                = 0
write(1, "Connection failed: Lost connecti"..., 64Connection failed: Lost connection to MySQL server during query) = 64

normal app:

rt_sigaction(SIGPIPE, {SIG_IGN}, {SIG_DFL}, 8) = 0
socket(PF_FILE, SOCK_STREAM, 0)         = 3
fcntl64(3, F_GETFL)                     = 0x2 (flags O_RDWR)
connect(3, {sa_family=AF_FILE, path="/var/run/mysqld/mysqld.sock"}, 110) = 0
setsockopt(3, SOL_IP, IP_TOS, [8], 4)   = -1 EOPNOTSUPP (Operation not supported)
setsockopt(3, SOL_SOCKET, SO_KEEPALIVE, [1], 4) = 0
read(3, "\'\0\0\0", 4)                  = 4
read(3, "\n4.0.22\0\243\3\0\0}j{LIj[g\0, \10\2\0\0\0\0\0\0\0"..., 39) = 39
open("/usr/share/mysql/charsets/Index", O_RDONLY|O_LARGEFILE) = 4
fstat64(4, {st_mode=S_IFREG|0644, st_size=621, ...}) = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7fea000
read(4, "# sql/share/charsets/Index\n#\n# T"..., 4096) = 621
read(4, "", 4096)                       = 0
close(4)                                = 0
munmap(0xb7fea000, 4096)                = 0
write(3, "\22\0\0\1\205 \0\0\0root\0SMPVSSBW", 22) = 22
read(3, "\5\0\0\2", 4)                  = 4
read(3, "\0\0\0\2\0", 5)                = 5
exit_group(0)                           = ?

-- 
Regards
Mariusz Gniazdowski

----------------------------------------------------------------------
Startuj z INTERIA.PL! >>> http://link.interia.pl/f186c 

