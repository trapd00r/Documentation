From zsh-users-return-12244-mason-zsh=primenet.com.au@sunsite.dk Tue Nov 20 18:23:46 2007
Return-Path: <zsh-users-return-12244-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17926 invoked from network); 20 Nov 2007 18:23:38 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 20 Nov 2007 18:23:38 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 65513 invoked from network); 20 Nov 2007 18:23:33 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 20 Nov 2007 18:23:33 -0000
Received: (qmail 20781 invoked by alias); 20 Nov 2007 18:23:20 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12244
Received: (qmail 20763 invoked from network); 20 Nov 2007 18:23:20 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 20 Nov 2007 18:23:20 -0000
Received: (qmail 64176 invoked from network); 20 Nov 2007 18:23:20 -0000
Received: from cluster-g.mailcontrol.com (85.115.41.190)
  by a.mx.sunsite.dk with SMTP; 20 Nov 2007 18:23:14 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly02g.srv.mailcontrol.com (MailControl) with ESMTP id lAKIN6RB025440
	for <zsh-users@sunsite.dk>; Tue, 20 Nov 2007 18:23:07 GMT
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Tue, 20 Nov 2007 18:23:06 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.1/8.13.4) with ESMTP id lAKIN5YM011820
	for <zsh-users@sunsite.dk>; Tue, 20 Nov 2007 18:23:05 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.1/8.14.1/Submit) with ESMTP id lAKIN5oM011816
	for <zsh-users@sunsite.dk>; Tue, 20 Nov 2007 18:23:05 GMT
Message-Id: <200711201823.lAKIN5oM011816@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-users@sunsite.dk
Subject: Re: Random numbers in functions 
In-reply-to: <Pine.GSO.4.61.0711201241340.5718@cse.nd.edu>
References: <Pine.GSO.4.61.0711201241340.5718@cse.nd.edu>
Comments: In-reply-to Justin M Wozniak <jwozniak@cse.nd.edu>
   message dated "Tue, 20 Nov 2007 12:46:35 -0500."
Date: Tue, 20 Nov 2007 18:23:05 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 20 Nov 2007 18:23:06.0147 (UTC) FILETIME=[6521CF30:01C82BA2]
X-Scanned-By: MailControl A-06-00-00 (www.mailcontrol.com) on 10.71.0.112

Justin M Wozniak wrote:
> Hello
>  	I'm trying to obtain random numbers from my own distribution and 
> I'd like to wrap all the arithmetic in ZSH functions which query $RANDOM 
> or rand48().  However, I keep getting the same numbers over and over 
> again.

rand48() is written specifically to be able avoid this; see also
the documentation for zsh/mathfunc.

  zmodload -i zsh/mathfunc

  local param1 param2

  print $(( rand48(param1) ))
  print $(( rand48(param1) ))
  print

  param2=$param1

  print $(( rand48(param1) ))
  print $(( rand48(param1) ))
  print

  print $(( rand48(param2) ))
  print $(( rand48(param2) ))

gives

  0.16013394447730178
  0.84537721340609906

  0.65599208737134518
  0.3807377705316064

  0.65599208737134518
  0.3807377705316064

Note the values of the second and third pairs are the same because they
used the same seed stored in the parameter.  The values in the parameter
are plain text (six bytes as an ASCII hex string).  So the thing to do
is to save the value of the parameter in a file and restore it when you
want to continue from where you left off.

  zmodload -i zsh/mathfunc

  local param

  if [[ -f ~/.zsh_rand48 ]]; then
     param="$(<~/.zsh_rand48)"
  fi

  print $(( rand48(param) ))

  print $param >~/.zsh_rand48

rand48() should give much better random numbers than $RANDOM anyway.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

