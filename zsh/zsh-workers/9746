From zsh-workers-return-9746-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Feb 15 12:22:23 2000
Return-Path: <zsh-workers-return-9746-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18687 invoked from network); 15 Feb 2000 12:22:21 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 Feb 2000 12:22:21 -0000
Received: (qmail 8822 invoked by alias); 15 Feb 2000 12:22:12 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9746
Received: (qmail 8805 invoked from network); 15 Feb 2000 12:22:12 -0000
Date: Tue, 15 Feb 2000 13:22:08 +0100 (MET)
Message-Id: <200002151222.NAA13064@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Sven Wischnowsky's message of Tue, 15 Feb 2000 13:20:49 +0100
	(MET)
Subject: Re: PATCH: Re: Completion for mutt


I wrote:

> I just tried, too, and after the fix in the patch below, it works for
> me. What does `doesn't work' mean? Does it nothing?

Uh oh...

Bye
 Sven

diff -ru ../z.old/Src/Zle/compctl.c Src/Zle/compctl.c
--- ../z.old/Src/Zle/compctl.c	Tue Feb 15 11:32:51 2000
+++ Src/Zle/compctl.c	Tue Feb 15 13:15:03 2000
@@ -1837,7 +1837,7 @@
 		for (n = firstnode(ccused); n; incnode(n))
 		    addlinknode(lastccused, getdata(n));
 	    } LASTALLOC;
-	} else
+	} else if (ccused)
 	    for (n = firstnode(ccused); n; incnode(n))
 		if (((Compctl) getdata(n)) != &cc_dummy)
 		    freecompctl((Compctl) getdata(n));
@@ -2497,6 +2497,8 @@
 makecomplistcc(Compctl cc, char *s, int incmd)
 {
     cc->refc++;
+    if (!ccused)
+	ccused = newlinklist();
     addlinknode(ccused, cc);
 
     ccont = 0;
@@ -2955,11 +2957,13 @@
 
     ccont |= (cc->mask2 & (CC_CCCONT | CC_DEFCONT | CC_PATCONT));
 
-    if (incompfunc != 1 && findnode(ccstack, cc))
+    if (incompfunc != 1 && ccstack && findnode(ccstack, cc))
 	return;
 
     MUSTUSEHEAP("complistflags");
 
+    if (!ccstack)
+	ccstack = newlinklist();
     addlinknode(ccstack, cc);
 
     if (incompfunc != 1 && allccs) {

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

