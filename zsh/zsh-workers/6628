From zsh-workers-return-6628-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Jun 14 17:12:58 1999
Return-Path: <zsh-workers-return-6628-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5302 invoked from network); 14 Jun 1999 17:12:56 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 14 Jun 1999 17:12:56 -0000
Received: (qmail 6683 invoked by alias); 14 Jun 1999 17:12:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6628
Received: (qmail 6676 invoked from network); 14 Jun 1999 17:12:48 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <990614171244.ZM20430@candle.brasslantern.com>
Date: Mon, 14 Jun 1999 17:12:44 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: pws-21: Creating array slices by assignment
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

Assignments like x[2,5]=() where x was not yet set, caused a crash.

Index: Src/params.c
===================================================================
RCS file: /extra/cvsroot/zsh/zsh-3.1/Src/params.c,v
retrieving revision 1.43
diff -u -r1.43 params.c
--- params.c	1999/06/10 16:27:40	1.43
+++ params.c	1999/06/14 17:10:21
@@ -1628,7 +1628,7 @@
 	if (!(v = getvalue(&s, 1)))
 	    createparam(t, PM_ARRAY);
 	*ss = '[';
-	if (PM_TYPE(v->pm->flags) == PM_HASHED) {
+	if (v && PM_TYPE(v->pm->flags) == PM_HASHED) {
 	    zerr("attempt to set slice of associative array", NULL, 0);
 	    freearray(val);
 	    errflag = 1;

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

