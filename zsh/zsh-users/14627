From zsh-users-return-14627-mason-zsh=primenet.com.au@zsh.org Wed Dec 02 05:24:23 2009
Return-Path: <zsh-users-return-14627-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24377 invoked by alias); 2 Dec 2009 05:24:23 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14627
Received: (qmail 12894 invoked from network); 2 Dec 2009 05:24:11 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at closedmail.com does not designate permitted sender hosts)
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <091201202341.ZM9955@torch.brasslantern.com>
Date: Tue, 01 Dec 2009 20:23:41 -0800
In-reply-to: <4B15BE9F.7020808@sergio.spb.ru>
Comments: In reply to sergio <mailbox@sergio.spb.ru>
 "Re: killall completion" (Dec  2,  4:10am)
References: <4B14AAA3.3090609@sergio.spb.ru>  <20091201194117.3dc2993b@pws-pc>
	<4B15BE9F.7020808@sergio.spb.ru>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: Zsh list <zsh-users@zsh.org>
Subject: Re: killall completion
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii

On Dec 2,  4:10am, sergio wrote:
}
} Peter Stephenson wrote:
} 
} > The trick is to treat the signal as the first argument.
} But "killall -i -KILL process" also allowed.

The trick is to understand the terminology. :-)

In "killall -i -KILL process" the "-i" is an option and the "-KILL" is
an argument.  Even though "-KILL" resembles an option because it begins
with a "-", it's really an argument.

So you should be able to modify your function as follows:

_sig_or_proc()
{
  _alternative -C set1 \
	"signals:signals:_signals -p -s" \
	"processes-names:processes-names:_processes_names"
}

_arguments -C\
     - set1 \
         ': :_sig_or_proc' \
	 '*:processes-names:_processes_names' \
         ...

(where I've left out the stuff that doesn't need changing).

However, it seems that _arguments gets confused when faced with an
argument that resembles an option, because although the above does
the right thing when asked to complete several process names, and
also does the right thing when completing after "killall -s KILL",
it fails to complete after "killall -KILL".

This looks to be yet another obscure problem with the "comparguments"
builtin.

