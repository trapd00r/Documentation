From zsh-workers-request@math.gatech.edu  Thu Sep  7 02:51:04 1995
Received: from gatech.edu (gatech.edu [130.207.244.244]) by werple.mira.net.au (8.6.12/8.6.9) with SMTP id CAA20307 for <mason@werple.mira.net.au>; Thu, 7 Sep 1995 02:51:02 +1000
Received: from math (math.skiles.gatech.edu) by gatech.edu with SMTP id AA00853
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Wed, 6 Sep 1995 12:53:40 -0400
Received: by math (5.x/SMI-SVR4)
	id AA06895; Wed, 6 Sep 1995 12:48:11 -0400
Resent-Date: Wed, 6 Sep 1995 18:48:56 +0200 (MET DST)
Old-Return-Path: <hzoli@cs.elte.hu>
From: Zoltan Hidvegi  <hzoli@cs.elte.hu>
Message-Id: <199509061648.SAA02463@bolyai.cs.elte.hu>
Subject: Re: accessing full command line
To: zsh-workers@math.gatech.edu (zsh-workers)
Date: Wed, 6 Sep 1995 18:48:56 +0200 (MET DST)
In-Reply-To: <199509061622.SAA02416@bolyai.cs.elte.hu> from "Zoltan Hidvegi" at Sep 6, 95 06:22:22 pm
X-Mailer: ELM [version 2.4 PL24]
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-Id: <"k_Iu21.0.fh1.A3TJm"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/366
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

> In my release I disabled up-history from vared.  This is the desired behaviour
> if you use vared to edit a file or a function definition, but I understand
> that is may be useful in cases you mention.  It would be very easy to
> implement an option controlling this behaviour, and it is much simpler and
> cleaner than disabling quote removal.  Presently all I do is setting the
> in_vared global variable in builtin.c in function bin_vared() before calling
> zleread() and reset it to zero after the call.  If a new option is
> introdudced, the only necessary change is to replace the in_vared = 1; line to
> in_vared = unset(VARED_HISTORY);.
> 
> Below is a trivial patch to hzoli10.3 which implements this option (not tested
> too much).
> 
> Zoltan

I've just noticed that I sent a hunk from a patch from Peter with my patch.  I
forgot to check this in befor I modified the file.  Here is the patch again
with this hunk removed.  Sorry for the inconvinience.

Zoltan


*** 1.28	1995/09/06 16:09:05
--- Src/builtin.c	1995/09/06 16:14:55
***************
*** 3244,3250 ****
      permalloc();
      pushnode(bufstack, ztrdup(s));
      heapalloc();
!     in_vared = 1;
      t = (char *)zleread(p1, p2);
      in_vared = 0;
      if (!t || errflag)
--- 3244,3250 ----
      permalloc();
      pushnode(bufstack, ztrdup(s));
      heapalloc();
!     in_vared = unset(VAREDHISTORY);
      t = (char *)zleread(p1, p2);
      in_vared = 0;
      if (!t || errflag)
*** 1.9	1995/07/24 17:12:46
--- Src/zsh.h	1995/07/07 14:29:00
***************
*** 922,927 ****
--- 923,929 ----
  #define CSHJUNKIEHISTORY    '\037'
  #define MAGICEQUALSUBST     '\040'
  #define GLOBSUBST           '\041'
+ #define VAREDHISTORY        '\042'
  #define PROMPTSUBST         '\043'
  #define ALWAYSLASTPROMPT    '\044'
  #define COMPLETEALIASES     '\045'
*** 1.10	1995/07/24 17:12:46
--- Src/globals.h	1995/07/07 14:29:00
***************
*** 703,708 ****
--- 703,709 ----
      {"shwordsplit", SHWORDSPLIT},
      {"singlelinezle", SINGLELINEZLE},
      {"sunkeyboardhack", SUNKEYBOARDHACK},
+     {"varedhistory", VAREDHISTORY},
      {"verbose", VERBOSE},
      {"xtrace", XTRACE},
      {"zle", USEZLE},

