From zsh-users-return-3940-mason-zsh=primenet.com.au@sunsite.dk Mon Jun 25 09:30:21 2001
Return-Path: <zsh-users-return-3940-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9749 invoked from network); 25 Jun 2001 09:30:19 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 25 Jun 2001 09:30:19 -0000
Received: (qmail 24588 invoked by alias); 25 Jun 2001 09:29:22 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 3940
Received: (qmail 24567 invoked from network); 25 Jun 2001 09:29:21 -0000
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
Date: Mon, 25 Jun 2001 11:28:11 +0200 (MET DST)
Message-Id: <200106250928.LAA23199@beta.informatik.hu-berlin.de>
To: zsh-users@sunsite.dk
Subject: Re: zle-overwrite with 4.1.0-dev-0
In-Reply-To: <200106250807.KAA68315@numa1.igpm.rwth-aachen.de>

Helmut Jarausch wrote:

> Hi,
> 
> (I believe that) on my Linux system switching to 4.1.0-dev-0 (cvs one
> week ago) I get overwrite mode (for zle) per default and switching back
> to insert mode doesn't last for long.
> Is there a new option?

No.  Hm, I've got no idea where the problem might be, I've never seen
something like that myself.

> Furthermore (I've just noticed it on my IRIX box at my office)
> I cannot use   ^X* anymore to expand things like  ~-
> This is with 4.0.1-pre-5 but I don't remember when it slipped in.
> Any ideas?

Oops.  That was caused by your humble code-messer-upper. Ahem.

We have to copy that string for normal expansion, too, otherwise the
test on line 790 will succeed and the command line will be restored.


Apologies for posting a patch to -users.  This will go into the
development branch and 4.0.2.


Bye
  Sven

Index: Src/Zle/zle_tricky.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_tricky.c,v
retrieving revision 1.29
diff -u -r1.29 zle_tricky.c
--- Src/Zle/zle_tricky.c	2001/06/24 03:42:09	1.29
+++ Src/Zle/zle_tricky.c	2001/06/25 09:25:36
@@ -752,7 +752,8 @@
 	    inststr(x);
 	} else if (COMP_ISEXPAND(lst)) {
 	    /* Do expansion. */
-	    char *ol = (olst == COMP_EXPAND_COMPLETE) ?
+	    char *ol = (olst == COMP_EXPAND ||
+                        olst == COMP_EXPAND_COMPLETE) ?
 		dupstring((char *)line) : (char *)line;
 	    int ocs = cs, ne = noerrs;
 

-- 
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

