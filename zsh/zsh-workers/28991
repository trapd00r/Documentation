From zsh-workers-return-28991-mason-zsh=primenet.com.au@zsh.org Wed Apr 13 02:38:39 2011
Return-Path: <zsh-workers-return-28991-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15 invoked by alias); 13 Apr 2011 02:38:39 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28991
Received: (qmail 18196 invoked from network); 13 Apr 2011 02:38:28 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-3.3 required=5.0 tests=BAYES_00,DKIM_ADSP_CUSTOM_MED,
	FREEMAIL_FROM,NML_ADSP_CUSTOM_MED,RCVD_IN_DNSWL_MED,T_TO_NO_BRKTS_FREEMAIL
	autolearn=ham version=3.3.1
Received-SPF: neutral (ns1.primenet.com.au: 128.2.11.61 is neither permitted nor denied by SPF record at _spf.google.com)
Date: Tue, 12 Apr 2011 22:19:01 -0400
From: gi1242+zsh@gmail.com
To: zsh-workers@zsh.org
Subject: Updated svn completion file
Message-ID: <20110413021848.GB27064@andrew.cmu.edu>
Mail-Followup-To: gi1242+zsh@gmail.com, zsh-workers@zsh.org
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="gatW/ieO32f1wygP"
Content-Disposition: inline
User-Agent: Mutt/1.5.18 (2008-05-17)
X-PMX-Version: 5.5.9.388399, Antispam-Engine: 2.7.2.376379, Antispam-Data: 2011.3.18.170322
X-SMTP-Spam-Clean: 34% (
 RDNS_SUSP_FORGED_FROM 3.5, FORGED_FROM_GMAIL 0.1, MIME_TEXT_ONLY_MP_MIXED 0.05, SUPERLONG_LINE 0.05, BODYTEXTP_SIZE_3000_LESS 0, BODY_SIZE_2000_2999 0, BODY_SIZE_5000_LESS 0, BODY_SIZE_7000_LESS 0, NO_REAL_NAME 0, RDNS_BROADBAND 0, RDNS_GENERIC_POOLED 0, RDNS_POOLED 0, RDNS_SUSP 0, RDNS_SUSP_GENERIC 0, RDNS_SUSP_SPECIFIC 0, __CD 0, __CT 0, __CTYPE_HAS_BOUNDARY 0, __CTYPE_MULTIPART 0, __CTYPE_MULTIPART_MIXED 0, __FRAUD_WEBMAIL 0, __FRAUD_WEBMAIL_FROM 0, __FROM_GMAIL 0, __HAS_MSGID 0, __MIME_TEXT_ONLY 0, __MIME_VERSION 0, __PHISH_SPEAR_STRUCTURE_1 0, __RDNS_BROADBAND_5 0, __RDNS_POOLED_11 0, __SANE_MSGID 0, __STOCK_PHRASE_7 0, __TO_MALFORMED_2 0, __TO_NO_NAME 0, __USER_AGENT 0)
X-SMTP-Spam-Score: 34%
X-Scanned-By: MIMEDefang 2.60 on 128.2.11.61

--gatW/ieO32f1wygP
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hi Guys,

I made the svn caching policy a little smarter. (I think there was a bug
with the old caching policy anyway.)

GI

-- 
'Wisdom' -- Having a lot to say and not saying it.

--gatW/ieO32f1wygP
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="svn-caching-policy.patch"

diff --git a/Completion/Unix/Command/_subversion b/Completion/Unix/Command/_subversion
index 44d83b7..88142d8 100644
--- a/Completion/Unix/Command/_subversion
+++ b/Completion/Unix/Command/_subversion
@@ -18,11 +18,11 @@ _svn () {
 
   if [[ -n $state ]] && (( ! $+_svn_cmds )); then
     typeset -gHA _svn_cmds
-    if ! _cache_invalid svn_cmds && ! _retrieve_cache svn_cmds; then 
+    if _cache_invalid svn-cmds || ! _retrieve_cache svn-cmds; then 
       _svn_cmds=(
 	${=${(f)${${"$(LC_ALL=C _call_program commands svn help)"#l#*Available subcommands:}%%Subversion is a tool*}}/(#s)[[:space:]]#(#b)([a-z]##)[[:space:]]#(\([a-z, ?]##\))#/$match[1] :$match[1]${match[2]:+:${${match[2]//[(),]}// /:}}:}
       )
-      _store_cache svn_cmds _svn_cmds
+      _store_cache svn-cmds _svn_cmds
     fi
   fi
 
@@ -38,13 +38,13 @@ _svn () {
       if (( $#cmd )); then
         curcontext="${curcontext%:*:*}:svn-${cmd}:"
 
-	if ! _cache_invalid svn-${cmd}-usage && \
+	if _cache_invalid svn-${cmd}-usage || \
 	    ! _retrieve_cache svn-${cmd}-usage;
 	then
 	  usage=${${(M)${(f)"$(LC_ALL=C _call_program options svn help $cmd)"}:#usage:*}#usage:*$cmd] }
 	  _store_cache svn-${cmd}-usage usage
 	fi
-	if ! _cache_invalid svn-${cmd}-usage && \
+	if _cache_invalid svn-${cmd}-usage || \
 	    ! _retrieve_cache svn-${cmd}-args;
 	then
 	  args=(
@@ -317,12 +317,7 @@ _subversion () {
 }
 
 _svn_caching_policy() {
-  # Rebuild every week
-  local -a oldp
-
-  oldp=( "$1"(Nmw+1) )
-  (( $#oldp ))
+  [[ =$service -nt $1 ]]
 }
 
-
 _subversion "$@"

--gatW/ieO32f1wygP--

