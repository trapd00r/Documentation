From zsh-users-return-15606-mason-zsh=primenet.com.au@zsh.org Sun Dec 05 11:39:36 2010
Return-Path: <zsh-users-return-15606-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20908 invoked by alias); 5 Dec 2010 11:39:35 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15606
Received: (qmail 10120 invoked from network); 5 Dec 2010 11:39:23 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.7 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FROM,RCVD_IN_DNSWL_LOW autolearn=ham
	version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 74.125.82.43 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:from:to:cc:subject:references
         :date:message-id:user-agent:mime-version:content-type;
        bh=BgQJit2fjb1c19DYqJkNPCgppo0OCIwJW+Ws1776rc4=;
        b=ZySY4d4/tgKMifqDzeOX90a6nPgpwzPFNo9RiSLZBpEgbXOl/PLq0ZYj5ml4RHiT/a
         /XAwCEQeshSQMEQmAWyIB0kZ/aXbIAvv2eEFjZi/Guy4glDKCvqetLrIcyEPg8uEjPc+
         LX9dCP9VBNEoTDCpjgQIdnKdudMOyWJtmyudw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=from:to:cc:subject:references:date:message-id:user-agent
         :mime-version:content-type;
        b=WCHxpJhwYmHxp6UV/Ar27h3JicDcViWOLdetX1La+BqWXznIKyg0wLxZfUVjeFHsh5
         jK8oFtkvsQYj1L0SkhSIoh8iD1AgGkR6N8KOixdw6D3YGj6ogdV6xfG5Vdw94Z34rAhI
         JmOVnRas9/PibTW1ycpL3E7ZdKhnhP8bXpT0s=
From: Anonymous <swell.k@gmail.com>
To: Bart Schaefer <schaefer@brasslantern.com>
Cc: zsh-users@zsh.org
Subject: Re: time builtin vs. time(1): difference in memory numbers
References: <868w06l3cq.fsf@gmail.com>
	<101204102844.ZM5983@torch.brasslantern.com>
Date: Sun, 05 Dec 2010 14:38:47 +0300
Message-ID: <86tyisv48o.fsf@gmail.com>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/24.0.50 (berkeley-unix)
MIME-Version: 1.0
Content-Type: text/plain

Bart Schaefer <schaefer@brasslantern.com> writes:

> On Dec 4,  4:43am, Anonymous wrote:
> } Subject: time builtin vs. time(1): difference in memory numbers
> }
> } zsh-4.3.10_4, FreeBSD 9.0-CURRENT r216095M amd64
> } 
> } I'm a bit puzzled by...
> } 
> } - numbers for shared/unshared space don't match those from `time -l'
>
> Zsh's %X and %D compute the average amount of shared/unshared space by
> using the ru_ixrss and (ru_idrss + ru_isrss) values from rusage,
> respectively, as the numerator, and (ru_utime + ru_stime) as the
> denominator.  I don't know what the BSD time command uses for the
> denominator.

According to getrusage(2) on BSDs ixrss/idrss/isrss are "expressed in
units of kilobytes * ticks-of-execution". So, I've made a quick hack

  http://www.freebsd.org/cgi/query-pr.cgi?pr=ports/152820

a bit different from time(1) that uses stathz from kern.clockrate sysctl.

> Zsh also rounds down microseconds to perform all of its
> computations in seconds, which may lead to differences.
>
> } - zsh manual page claims that %M stands for memory in Kbytes while it
> }   displays them in Mbytes
>
> Hm.  %M stands for ru_maxrss / 1024.  Zsh would only be displaying
> that in Mbytes if ru_maxrss is expressed in Gbytes internally.  Has
> FreeBSD changed the base units of maxrss in rusage?

maxrss like ixrss/idrss/isrss is expressed "in kilobytes"

  http://man.freebsd.org/getrusage/2

