From zsh-workers-request@euclid.skiles.gatech.edu  Mon Nov 11 02:49:15 1996
Return-Path: zsh-workers-request@euclid.skiles.gatech.edu
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by coral.primenet.com.au (8.7.5/8.7.3) with ESMTP id CAA06172 for <mason@primenet.com.au>; Mon, 11 Nov 1996 02:49:05 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id KAA28240; Sun, 10 Nov 1996 10:43:29 -0500 (EST)
Resent-Date: Sun, 10 Nov 1996 10:43:29 -0500 (EST)
Date: Sun, 10 Nov 1996 21:41:12 +0300 (MSK)
From: Ilya Ovchinnikov <ilya@taspd13a.npi.msu.su>
Reply-To: Ilya Ovchinnikov <oi@taspd.npi.msu.su>
To: zsh-workers@math.gatech.edu
Subject: zsh 3.0.1 bug report (zle)
Message-ID: <Pine.LNX.3.93.961110213836.189A-100000@taspd13a.npi.msu.su>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=koi8-r
Resent-Message-ID: <"9WHii.0.7v6.WWVXo"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2364
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

I found that ZLE doesn't work correct with my PROPMT:

1) type some text:
~% some stupid command
                      ^
2) move cursor to beginning of line:
~% some stupid command
   ^
3) type a space:
~%   ome stupid command
     ^
4) again type a space:
~%    ome stupid command
     ^
                       Ilya Ovchinnikov

Results of . reporter:

# START zsh saveset
# uname:  Linux taspd13a 2.0.18 #1 Fri Sep 13 17:53:08 MSD 1996 i486

# Aliases.

alias d=dir
alias dir='ls $LS_OPTIONS --format=vertical'
alias j=jobs
alias l=less
alias ls='ls $LS_OPTIONS'
alias rm='rm --interactive'
alias v=vdir
alias vdir='/bin/ls $LS_OPTIONS --format=long'
alias version='echo "${ZSH_NAME} version ${ZSH_VERSION}"'
alias which-command=whence

# Key bindings.

bindkey -r "^@"
bindkey -r "^A"
bindkey -r "^B"
bindkey -r "^C"
bindkey -r "^D"
bindkey -r "^E"
bindkey -r "^F"
bindkey -r "^G"
bindkey -r "^H"
bindkey -r "^I"
bindkey -r "^J"
bindkey -r "^K"
bindkey -r "^L"
bindkey -r "^M"
bindkey -r "^N"
bindkey -r "^O"
bindkey -r "^P"
bindkey -r "^Q"
bindkey -r "^R"
bindkey -r "^S"
bindkey -r "^T"
bindkey -r "^U"
bindkey -r "^V"
bindkey -r "^W"
bindkey -r "^X"
bindkey -r "^Y"
bindkey -r "^Z"
bindkey -r "\e"
bindkey -r "^_"
bindkey -r "^?"
bindkey -r "^X^B"
bindkey -r "^X^F"
bindkey -r "^X^J"
bindkey -r "^X^K"
bindkey -r "^X^N"
bindkey -r "^X^O"
bindkey -r "^X^U"
bindkey -r "^X^V"
bindkey -r "^X^X"
bindkey -r "^X*"
bindkey -r "^XG"
bindkey -r "^Xg"
bindkey -r "^Xr"
bindkey -r "^Xs"
bindkey -r "^Xu"
bindkey -r "\e^D"
bindkey -r "\e^G"
bindkey -r "\e^H"
bindkey -r "\e^I"
bindkey -r "\e^J"
bindkey -r "\e^L"
bindkey -r "\e^M"
bindkey -r "\e^_"
bindkey -r "\e "
bindkey -r "\e!"
bindkey -r "\e\\""
bindkey -r "\e$"
bindkey -r "\e'"
bindkey -r "\e-"
bindkey -r "\e."
bindkey -r "\e0"
bindkey -r "\e1"
bindkey -r "\e2"
bindkey -r "\e3"
bindkey -r "\e4"
bindkey -r "\e5"
bindkey -r "\e6"
bindkey -r "\e7"
bindkey -r "\e8"
bindkey -r "\e9"
bindkey -r "\e<"
bindkey -r "\e>"
bindkey -r "\e?"
bindkey -r "\eA"
bindkey -r "\eB"
bindkey -r "\eC"
bindkey -r "\eD"
bindkey -r "\eF"
bindkey -r "\eG"
bindkey -r "\eH"
bindkey -r "\eL"
bindkey -r "\eN"
bindkey -r "\eP"
bindkey -r "\eQ"
bindkey -r "\eS"
bindkey -r "\eT"
bindkey -r "\eU"
bindkey -r "\eW"
bindkey -r "\e[11~"
bindkey -r "\e[1~"
bindkey -r "\e[2~"
bindkey -r "\e[3~"
bindkey -r "\e[4~"
bindkey -r "\e[5~"
bindkey -r "\e[6~"
bindkey -r "\e[A"
bindkey -r "\e[B"
bindkey -r "\e[C"
bindkey -r "\e[D"
bindkey -r "\e_"
bindkey -r "\ea"
bindkey -r "\eb"
bindkey -r "\ec"
bindkey -r "\ed"
bindkey -r "\ef"
bindkey -r "\eg"
bindkey -r "\eh"
bindkey -r "\el"
bindkey -r "\en"
bindkey -r "\ep"
bindkey -r "\eq"
bindkey -r "\es"
bindkey -r "\et"
bindkey -r "\eu"
bindkey -r "\ew"
bindkey -r "\ex"
bindkey -r "\ey"
bindkey -r "\ez"
bindkey -r "\e|"
bindkey -r "\e^?"

bindkey "^@"	set-mark-command
bindkey "^A"	beginning-of-line
bindkey "^B"	backward-char
bindkey "^C"	undefined-key
bindkey "^D"	delete-char-or-list
bindkey "^E"	end-of-line
bindkey "^F"	forward-char
bindkey "^G"	send-break
bindkey "^H"	backward-delete-char
bindkey "^I"	expand-or-complete
bindkey "^J"	accept-line
bindkey "^K"	kill-line
bindkey "^L"	clear-screen
bindkey "^M"	accept-line
bindkey "^N"	down-line-or-history
bindkey "^O"	accept-line-and-down-history
bindkey "^P"	up-line-or-history
bindkey "^Q"	push-line
bindkey "^R"	history-incremental-search-backward
bindkey "^S"	history-incremental-search-forward
bindkey "^T"	transpose-chars
bindkey "^U"	kill-whole-line
bindkey "^V"	quoted-insert
bindkey "^W"	backward-kill-word
bindkey "^X"	prefix
bindkey "^Y"	yank
bindkey "^Z"	undefined-key
bindkey "\e"	prefix
bindkey "^_"	undo
bindkey "^?"	backward-delete-char
bindkey "^X^B"	vi-match-bracket
bindkey "^X^F"	vi-find-next-char
bindkey "^X^J"	vi-join
bindkey "^X^K"	kill-buffer
bindkey "^X^N"	infer-next-history
bindkey "^X^O"	overwrite-mode
bindkey "^X^U"	undo
bindkey "^X^V"	vi-cmd-mode
bindkey "^X^X"	exchange-point-and-mark
bindkey "^X*"	expand-word
bindkey "^XG"	list-expand
bindkey "^Xg"	list-expand
bindkey "^Xr"	history-incremental-search-backward
bindkey "^Xs"	history-incremental-search-forward
bindkey "^Xu"	undo
bindkey "\e^D"	list-choices
bindkey "\e^G"	send-break
bindkey "\e^H"	backward-kill-word
bindkey "\e^I"	self-insert-unmeta
bindkey "\e^J"	self-insert-unmeta
bindkey "\e^L"	clear-screen
bindkey "\e^M"	self-insert-unmeta
bindkey "\e^_"	copy-prev-word
bindkey "\e "	expand-history
bindkey "\e!"	expand-history
bindkey "\e\\""	quote-region
bindkey "\e$"	spell-word
bindkey "\e'"	quote-line
bindkey "\e-"	neg-argument
bindkey "\e."	insert-last-word
bindkey "\e0"	digit-argument
bindkey "\e1"	digit-argument
bindkey "\e2"	digit-argument
bindkey "\e3"	digit-argument
bindkey "\e4"	digit-argument
bindkey "\e5"	digit-argument
bindkey "\e6"	digit-argument
bindkey "\e7"	digit-argument
bindkey "\e8"	digit-argument
bindkey "\e9"	digit-argument
bindkey "\e<"	beginning-of-buffer-or-history
bindkey "\e>"	end-of-buffer-or-history
bindkey "\e?"	which-command
bindkey "\eA"	accept-and-hold
bindkey "\eB"	backward-word
bindkey "\eC"	capitalize-word
bindkey "\eD"	kill-word
bindkey "\eF"	forward-word
bindkey "\eG"	get-line
bindkey "\eH"	run-help
bindkey "\eL"	down-case-word
bindkey "\eN"	history-search-forward
bindkey "\eP"	history-search-backward
bindkey "\eQ"	push-line
bindkey "\eS"	spell-word
bindkey "\eT"	transpose-words
bindkey "\eU"	up-case-word
bindkey "\eW"	copy-region-as-kill
bindkey "\e[11~"	run-help
bindkey "\e[1~"	beginning-of-line
bindkey "\e[2~"	overwrite-mode
bindkey "\e[3~"	delete-char
bindkey "\e[4~"	end-of-line
bindkey "\e[5~"	beginning-of-history
bindkey "\e[6~"	end-of-history
bindkey "\e[A"	up-line-or-history
bindkey "\e[B"	down-line-or-history
bindkey "\e[C"	forward-char
bindkey "\e[D"	backward-char
bindkey "\e_"	insert-last-word
bindkey "\ea"	accept-and-hold
bindkey "\eb"	backward-word
bindkey "\ec"	capitalize-word
bindkey "\ed"	kill-word
bindkey "\ef"	forward-word
bindkey "\eg"	get-line
bindkey "\eh"	run-help
bindkey "\el"	down-case-word
bindkey "\en"	history-search-forward
bindkey "\ep"	history-search-backward
bindkey "\eq"	push-line
bindkey "\es"	spell-word
bindkey "\et"	transpose-words
bindkey "\eu"	up-case-word
bindkey "\ew"	copy-region-as-kill
bindkey "\ex"	execute-named-cmd
bindkey "\ey"	yank-pop
bindkey "\ez"	execute-last-named-cmd
bindkey "\e|"	vi-goto-column
bindkey "\e^?"	backward-kill-word

# Completions.

compctl -j -P % bg
compctl -b bindkey
compctl -c builtin
compctl -g '*(-/)' cd
compctl -v declare
compctl -g '*(/)' dircmp
compctl disable
compctl -j -P % disown
compctl -d enable
compctl -v export
compctl -j -P % fg
compctl -v integer
compctl -j -P % jobs
compctl -j -P % -x 's[-] p[1,1]' -k signals -- kill
compctl -g '*(-/)' pushd
compctl -v readonly
compctl -g '*(/)' rmdir
compctl -o setopt
compctl -A shift
compctl -acF type
compctl -v typeset
compctl -a unalias
compctl -F unfunction
compctl -v unset
compctl -o unsetopt
compctl -v vared
compctl -j -P % wait
compctl -acF whence
compctl -acF which
compctl -C -c
compctl -D -f
compctl -T

# Undefined functions.


# Defined functions.

run-help () {
	typeset zhelp=/usr/doc/zsh/Help
	[[ $1 = . ]] && 1=dot 
	[[ $1 = : ]] && 1=colon 
	if [[ -f $zhelp/$1 ]]
	then
		${=PAGER:-more} $zhelp/$1
	else
		man $1
	fi
}
setenv () {
	export $1=$2
}

# Limits.

limit stacksize       8MB
limit coredumpsize    0kB
limit maxproc         256
limit descriptors     256

# Non-array variables.

TERMCAP=''
TERM='linux'
\'#\'="1"
\'$\'="453"
\'?\'="1"
ARGC="1"
AWK="awk"
BAUD="38400"
BIBINPUTS="/home/ilya/texts/bib"
CDPATH="\'\'"
COLUMNS="80"
CPP="/lib/cpp"
EDITOR="jed"
EGID="100"
ERRNO="0"
EUID="501"
FCEDIT="vi"
FIGNORE="\'\'"
FPATH="/home/ilya/.zfunc"
GID="100"
HISTCHARS="\'!^#\'"
HISTSIZE="30"
HOME="/home/ilya"
HOST="taspd13a"
HOSTNAME="taspd13a.npi.msu.su"
INFOPATH="/usr/info:/usr/local/info"
KEYTIMEOUT="40"
LESS="-MM"
LESSCHARSET="koi8-r"
LESSOPEN="\'|lesspipe.sh %s\'"
LINENO="329"
LINES="34"
LISTMAX="100"
LOGCHECK="60"
LOGNAME="ilya"
LS_COLORS="\'no=00:fi=00:di=01;34:ln=01;36:or=36:mi=30;01:pi=33:so=01;35:bd=33;01:cd=33;01:ex=01;32:*.cmd=00;32:*.exe=00;32:*.com=00;32:*.btm=00;32:*.bat=00;32:*.sh=00;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.zip=01;31:*.z=01;31:*.
Z=01;31:*.gz=01;31:*.rar=01;31:*.r0?=01;31:*.jpg=01;35:*.gif=01;35:*.bmp=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.pcx=01;35:\'"
MACHTYPE="i586"
MAIL="/var/spool/mail/ilya"
MAILCHECK="60"
MAILPATH="\'\'"
MANPATH="/usr/local/man:/usr/man:/usr/X11/man:/usr/man/tk-tcl:/usr/openwin/man:/usr/local/teTeX/man:/usr/lib/perl5/man"
MINICOM="\'-c on\'"
NULLCMD="cat"
OLDPWD="/home/ilya"
OPENWINHOME="/usr/openwin"
OPTARG="\'\'"
OPTIND="1"
OSTYPE="linux"
PAGER="less"
PATH="/usr/local/bin:/bin:/usr/bin:/usr/X11/bin:/usr/openwin/bin:/usr/local/teTeX/bin/i586-linux:/usr/local/scilab/bin:/home/ilya/bin"
POSTEDIT="\'\'"
PPID="1"
PROMPT="\'%{[32m%}%20<...<%~%{[33;1m%}%#%{[0m%} \'"
PROMPT2="\'%{[31;1m%}%_%{[33;1m%}>%{[0m%} \'"
PROMPT3="\'%{[33;1m%}?%{[0m%} \'"
PROMPT4="\'%{[31;1m%}+%{[0m%} \'"
PS1="\'%{[32m%}%20<...<%~%{[33;1m%}%#%{[0m%} \'"
PS2="\'%{[31;1m%}%_%{[33;1m%}>%{[0m%} \'"
PS3="\'%{[33;1m%}?%{[0m%} \'"
PS4="\'%{[31;1m%}+%{[0m%} \'"
PSVAR="\'\'"
PWD="/home/ilya/zsh-bug"
RANDOM="5809"
READNULLCMD="more"
RPROMPT="\'\'"
RPS1="\'\'"
SECONDS="24"
SHELL="/bin/zsh"
SHLVL="1"
SPROMPT="\'zsh: correct \'\\'\'%R\'\\'\' to \'\\'\'%r\'\\'\' [nyae]? \'"
TIMEFMT="\'%J  %U user %S system %P cpu %*E total\'"
TMPPREFIX="/tmp/zsh"
TTY="/dev/tty3"
TTYIDLE="-1"
UID="501"
USERNAME="ilya"
VENDOR="\'\'"
WATCH="\'\'"
WATCHFMT="\'%n has %a %l from %m.\'"
WORDCHARS="\'*?_-.[]~=/&;!#$%^(){}<>\'"
ZSH_NAME="zsh"
ZSH_VERSION="3.0.1"
dirname="/home/ilya/.zfunc"
each="\'__LINE__"
histchars="\'!^#\'"
reporter_OSVersion="Linux_2.0.18"
reporter_junkiequotes="no"
status="1"
str="\'Linux taspd13a 2.0.18 #1 Fri Sep 13 17:53:08 MSD 1996 i486\'"
prompt='test%'

# Array variables.

argv=()
'*'=(all)
LS_OPTIONS=(--7bit '--color=tty' -F -T 0)
cdpath=()
fignore=()
fpath=(/home/ilya/.zfunc)
mailpath=()
manpath=(/usr/local/man /usr/man /usr/X11/man /usr/man/tk-tcl /usr/openwin/man /usr/local/teTeX/man /usr/lib/perl5/man)
path=(/usr/local/bin /bin /usr/bin /usr/X11/bin /usr/openwin/bin /usr/local/teTeX/bin/i586-linux /usr/local/scilab/bin /home/ilya/bin)
psvar=()
signals=(EXIT HUP INT QUIT ILL TRAP ABRT BUS FPE KILL USR1 SEGV USR2 PIPE ALRM TERM STKFLT CHLD CONT STOP TSTP TTIN TTOU URG XCPU XFSZ VTALRM PROF WINCH IO PWR UNUSED ZERR DEBUG)
watch=()

# Exported variables.

export TERMCAP
export TERM
export BIBINPUTS=/home/ilya/texts/bib
export EDITOR=jed
export HOME=/home/ilya
export HOSTNAME=taspd13a.npi.msu.su
export INFOPATH=/usr/info:/usr/local/info
export LESS=-MM
export LESSCHARSET=koi8-r
export LESSOPEN='|lesspipe.sh %s'
export LOGNAME=ilya
export LS_COLORS='no=00:fi=00:di=01;34:ln=01;36:or=36:mi=30;01:pi=33:so=01;35:bd=33;01:cd=33;01:ex=01;32:*.cmd=00;32:*.exe=00;32:*.com=00;32:*.btm=00;32:*.bat=00;32:*.sh=00;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.zip=01;31:*.z=01;
31:*.Z=01;31:*.gz=01;31:*.rar=01;31:*.r0?=01;31:*.jpg=01;35:*.gif=01;35:*.bmp=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.pcx=01;35:'
export LS_OPTIONS=(--7bit '--color=tty' -F -T 0)
export MAIL=/var/spool/mail/ilya
export MANPATH=/usr/local/man:/usr/man:/usr/X11/man:/usr/man/tk-tcl:/usr/openwin/man:/usr/local/teTeX/man:/usr/lib/perl5/man
export MINICOM='-c on'
export OPENWINHOME=/usr/openwin
export PAGER=less
export PATH=/usr/local/bin:/bin:/usr/bin:/usr/X11/bin:/usr/openwin/bin:/usr/local/teTeX/bin/i586-linux:/usr/local/scilab/bin:/home/ilya/bin
export PWD=/home/ilya/zsh-bug
export SHELL=/bin/zsh
export SHLVL=1
export TERM=linux

# Setopt.

setopt automenu
setopt autoremoveslash
setopt extendedglob
setopt login
setopt nobeep

# END zsh saveset

