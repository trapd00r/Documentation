From zsh-users-return-10292-mason-zsh=primenet.com.au@sunsite.dk Tue May 23 07:42:47 2006
Return-Path: <zsh-users-return-10292-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1754 invoked from network); 23 May 2006 07:42:44 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.1 (2006-03-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.8 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 May 2006 07:42:44 -0000
Received: (qmail 99813 invoked from network); 23 May 2006 07:42:37 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 May 2006 07:42:37 -0000
Received: (qmail 3197 invoked by alias); 23 May 2006 07:42:29 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10292
Received: (qmail 3188 invoked from network); 23 May 2006 07:42:29 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 23 May 2006 07:42:29 -0000
Received: (qmail 98601 invoked from network); 23 May 2006 07:42:28 -0000
Received: from g.primenet.com.au (203.24.36.10)
  by a.mx.sunsite.dk with SMTP; 23 May 2006 07:42:27 -0000
Received: (qmail 4592 invoked by uid 100); 23 May 2006 07:42:23 -0000
Date: Tue, 23 May 2006 17:42:23 +1000
From: Geoff Wing <gcw@zsh.org>
To: Zsh Users <zsh-users@sunsite.dk>
Subject: Re: Autocorrection destroys my prompt.
Message-ID: <20060523074223.GA6322@primenet.com.au>
References: <200605211233.43045.alexander.surma@gmx.de>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <200605211233.43045.alexander.surma@gmx.de>
Organization: PrimeNet Computer Consultancy
User-Agent: Mutt/1.5.11

On Sunday 2006-05-21 20:32 +1000, Alexander Surma output:
: I did a eye-candy (also eye-cancer) prompt.
: Works fine.

Not for me.

: But when I use the autocorrection, my command I already typed overwrites some 
: characters of the prompt?
: Why and what to do?
: The prompt is:
: PS1=$'%{\e[1;36m\e(0lq\e(B%}[%(!.%{\e[0;31m%}.%{\e[1;32m%})%n%{\e[1;33m%}@%m:
                      ^^
Surround non printing characters with %{ and %} .  On the first line
the "lq" which form graphic characters are printed characters and should
not be enclosed.  So, the first line would start off with
  PS1=$'%{\e[1;36m\e(0%}lq%{\e(B%}

Fix up the rest of the prompt the same way.  A quick check to see if
it's obviously(*) wrong is to set an RPROMPT,  e.g. RPROMPT="a" should
put the letter ``a'' in the second last column of the screen (on the
cursor row).  Obviously, unset RPROMPT if you don't want it in normal
use.

(*) if you mark the wrong characters as printing/non-printing characters
it may seem to align correctly . . . initially, but do wrong things later.

Regards,
Geoff

