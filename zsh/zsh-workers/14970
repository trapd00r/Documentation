From zsh-workers-return-14970-mason-zsh=primenet.com.au@sunsite.dk Mon Jun 18 19:04:43 2001
Return-Path: <zsh-workers-return-14970-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22853 invoked from network); 18 Jun 2001 19:04:41 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 18 Jun 2001 19:04:41 -0000
Received: (qmail 28926 invoked by alias); 18 Jun 2001 19:04:07 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14970
Received: (qmail 28914 invoked from network); 18 Jun 2001 19:04:06 -0000
X-Authentication-Warning: candle.brasslantern.com: schaefer set sender to lantern@shell10.ba.best.com using -f
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010618190240.ZM16502@candle.brasslantern.com>
Date: Mon, 18 Jun 2001 19:02:39 +0000
In-Reply-To: <Pine.SV4.4.33.0106182241440.17539-100000@itsrm2.mow.siemens.ru>
Comments: In reply to Andrej Borsenkow <Andrej.Borsenkow@mow.siemens.ru>
        "Re: PATCH: "unimplemented" for test suite" (Jun 18, 10:44pm)
References: <Pine.SV4.4.33.0106182241440.17539-100000@itsrm2.mow.siemens.ru>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Andrej Borsenkow <Andrej.Borsenkow@mow.siemens.ru>,
        ZSH Workers Mailing List <zsh-workers@sunsite.dk>
Subject: Re: PATCH: "unimplemented" for test suite
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Jun 18, 10:44pm, Andrej Borsenkow wrote:
} 
} I was unsure about added value of this patch and there was no comments.

Certainly it would be nice to at least *explain* the test failures for
the Y* tests when --disable-dynamic ... either that, or we should add
zpty to the list of modules that are always linked by default.

Probably comptestinit should not proceed if zmodload zpty fails, and
the %prep section should fail in that case, so that we don't report
failures on individual tests.

If Andrej's patch -- or some combination of it with the below -- isn't
considered better, how about this?

diff -u zsh-forge/current/Test/Y01completion.ztst zsh-4.0/Test/Y01completion.ztst
--- zsh-forge/current/Test/Y01completion.ztst	Mon Apr  2 05:35:14 2001
+++ zsh-4.0/Test/Y01completion.ztst	Mon Jun 18 11:58:20 2001
@@ -6,12 +6,14 @@
   mkdir comp.tmp
   cd comp.tmp
 
-  comptestinit -z $ZTST_testdir/../Src/zsh
+  comptestinit -z $ZTST_testdir/../Src/zsh && {
 
   mkdir dir1
   mkdir dir2
   touch file1
   touch file2
+
+  }
 
 %test
 
diff -u zsh-forge/current/Test/Y02compmatch.ztst zsh-4.0/Test/Y02compmatch.ztst
--- zsh-forge/current/Test/Y02compmatch.ztst	Mon Apr  2 05:35:31 2001
+++ zsh-4.0/Test/Y02compmatch.ztst	Mon Jun 18 11:58:43 2001
@@ -16,7 +16,7 @@
   mkdir match.tmp
   cd match.tmp
 
-  comptestinit -z $ZTST_testdir/../Src/zsh
+  comptestinit -z $ZTST_testdir/../Src/zsh && {
 
   list1=(IndianRed IndianRed2 IndianRed3 IndianRed4)
   test_code () {
@@ -33,7 +33,7 @@
 	comptesteval "$code"
   }
 
-
+  }
 
 	 
 
diff -u zsh-forge/current/Test/Y03arguments.ztst zsh-4.0/Test/Y03arguments.ztst
--- zsh-forge/current/Test/Y03arguments.ztst	Mon Apr  2 05:35:48 2001
+++ zsh-4.0/Test/Y03arguments.ztst	Mon Jun 18 11:58:59 2001
@@ -6,9 +6,10 @@
   mkdir comp.tmp
   cd comp.tmp
 
-  comptestinit -z $ZTST_testdir/../Src/zsh
+  comptestinit -z $ZTST_testdir/../Src/zsh && {
   comptesteval 'compdef _tst tst'
   tst_arguments () { comptesteval "_tst () { _arguments ${${(@qq)*}} }" }
+  }
 
 %test
  tst_arguments ':desc1:(arg1)'
diff -u zsh-forge/current/Test/comptest zsh-4.0/Test/comptest
--- zsh-forge/current/Test/comptest	Sat Jun  9 10:24:31 2001
+++ zsh-4.0/Test/comptest	Mon Jun 18 11:57:55 2001
@@ -5,7 +5,7 @@
           $ZTST_srcdir/../Completion
           $ZTST_srcdir/../Completion/*/*~*/CVS(/) )
 
-  zmodload -i zsh/zpty
+  zmodload -i zsh/zpty || return $?
 
   comptest_zsh=${ZSH:-zsh}
 

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

