From zsh-workers-return-7412-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Aug 09 17:36:39 1999
Return-Path: <zsh-workers-return-7412-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24813 invoked from network); 9 Aug 1999 17:36:38 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 9 Aug 1999 17:36:38 -0000
Received: (qmail 5251 invoked by alias); 9 Aug 1999 17:36:29 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7412
Received: (qmail 5244 invoked from network); 9 Aug 1999 17:36:28 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <990809173624.ZM30183@candle.brasslantern.com>
Date: Mon, 9 Aug 1999 17:36:24 +0000
In-Reply-To: <19990809163434.H14467@hal.mpn.cp.philips.com>
Comments: In reply to Jos Backus <Jos.Backus@nl.origin-it.com>
        "Re: zsh-3.0.6 on BSD/OS" (Aug  9,  4:34pm)
References: <19990809122557.B14467@hal.mpn.cp.philips.com> 
	<19990809163434.H14467@hal.mpn.cp.philips.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: Re: zsh-3.0.6 on BSD/OS
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Aug 9,  4:34pm, Jos Backus wrote:
} Subject: Re: zsh-3.0.6 on BSD/OS
}
} On Mon, Aug 09, 1999 at 12:25:57PM +0200, Jos Backus wrote:
} > 1) On both BSD/OS 3.1 and 4.0.1, configure erroneously #defines
} >    TGETENT_ACCEPTS_NULL, leading to a coredump later on in tgetstr() in
} >    init.c:489:
} 
} 3.1.6 works out of the box.
} Maybe 3.0.6 should be changed?

Thanks, I've copied the configure.in test from 3.1.6 to 3.0.6.  Here's
the patch:

Index: configure.in
===================================================================
@@ -416,9 +416,22 @@
 fi
 
 dnl  Check if tgetent accepts NULL (and will allocate its own termcap buffer)
+dnl  Some termcaps reportedly accept a zero buffer, but then dump core
+dnl  in tgetstr().
 AC_CACHE_CHECK(if tgetent accepts NULL,
 zsh_cv_func_tgetent_accepts_null,
-[AC_TRY_RUN([main(){int i = tgetent((char*)0,"vt100");exit(!i || i == -1);}],
+[AC_TRY_RUN([
+main()
+{
+    int i = tgetent((char*)0,"vt100");
+    if (i > 0) {
+	char tbuf[1024], *u;
+    	u = tbuf;
+    	tgetstr("cl", &u);
+    }
+    exit(!i || i == -1);
+}
+],
   zsh_cv_func_tgetent_accepts_null=yes,
   zsh_cv_func_tgetent_accepts_null=no,
   zsh_cv_func_tgetent_accepts_null=no)])

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

