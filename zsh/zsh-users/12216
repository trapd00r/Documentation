From zsh-users-return-12216-mason-zsh=primenet.com.au@sunsite.dk Sun Nov 18 20:37:43 2007
Return-Path: <zsh-users-return-12216-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26139 invoked from network); 18 Nov 2007 20:37:34 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.8 required=5.0 tests=AWL,BAYES_00,URIBL_SBL
	autolearn=no version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 18 Nov 2007 20:37:34 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 95823 invoked from network); 18 Nov 2007 20:37:27 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 18 Nov 2007 20:37:27 -0000
Received: (qmail 14753 invoked by alias); 18 Nov 2007 20:37:09 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12216
Received: (qmail 14734 invoked from network); 18 Nov 2007 20:37:08 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 18 Nov 2007 20:37:08 -0000
Received: (qmail 94472 invoked from network); 18 Nov 2007 20:37:08 -0000
Received: from smtp02.cdmon.com (212.36.74.229)
  by a.mx.sunsite.dk with SMTP; 18 Nov 2007 20:37:02 -0000
Received: from localhost (212.Red-80-35-44.staticIP.rima-tde.net [80.35.44.212])
	by smtp02.cdmon.com (Postfix) with ESMTP id E2DB545156
	for <zsh-users@sunsite.dk>; Sun, 18 Nov 2007 21:37:03 +0100 (CET)
Date: Sun, 18 Nov 2007 21:37:57 +0100
From: DervishD <zsh@dervishd.net>
To: Zsh Users <zsh-users@sunsite.dk>
Subject: Multibyte characters and menu completion
Message-ID: <20071118203757.GA1816@DervishD>
Mail-Followup-To: Zsh Users <zsh-users@sunsite.dk>
Mime-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
User-Agent: Mutt/1.4.2.3i
Organization: DervishD

	Hi all :)

I'm using compsys, and when I'm doing menu completion I usually use
"accept-and-hold" to insert some of the listed matches. This works like
a charm for me, except for one thing...

My terminal supports utf8 and I have multibyte support in my zsh-4.3.4,
but if some of the characters have a code point greater than U+00FF, the
character is correctly printed but after having inserted the matches I
want with "accept-and-hold", some spaces are written at the end, one for
every extra columnt that zsh thinks the chars occupy. For example, "ñ"
is U+00F1, and it's 0xc3 0xb1 in utf8. It is written as ONE glyph and
zsh thinks that it is one column worth of space while writing. That's
OK.

But if the character code point is greater than U+00FF, weird things
happen. For example, I have a file named U+8336 (kanji for "tea")
followed by U+306e (hiragana "no") followed by U+5473 (kanji for
odor/smell) and zsh prints the name correctly (well, since I'm in a text
mode terminal, it uses three instances of my "unknown character" glyph,
but thinks that each letter is three glyphs wide, putting the cursor six
spaces after the file name once it is completed:

    I expected this, where "X" is my unknown character glyph and the
underscore is the cursor:

	XXX _

	But I get this instead:

	XXX       _

Since this happens in Vim too and it works on a terminal emulator under
X, I don't think that zsh is the culprit, of course, but I'm asking here
just to know if this is a known issue and if the problem relies on my
curses OR in the Linux virtual console. Or maybe it's a zsh problem (I
doubt it, but...) that happens to be present in vim, too, since I
haven't tested many other programs with this.

Any idea? Thanks a lot in advance :))))

    Raúl Núñez de Arenas Coronado

-- 
Linux Registered User 88736 | http://www.dervishd.net
It's my PC and I'll cry if I want to... RAmen!
We are waiting for 13 Feb 2009 23:31:30 +0000 ...

