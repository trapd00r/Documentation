From zsh-users-return-7000-mason-zsh=primenet.com.au@sunsite.dk Sun Jan 18 18:39:22 2004
Return-Path: <zsh-users-return-7000-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12645 invoked from network); 18 Jan 2004 18:39:21 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 18 Jan 2004 18:39:21 -0000
Received: (qmail 2114 invoked by alias); 18 Jan 2004 18:39:04 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 7000
Received: (qmail 2084 invoked from network); 18 Jan 2004 18:39:04 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 18 Jan 2004 18:39:04 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [4.11.8.53] by sunsite.dk (MessageWall 1.0.8) with SMTP; 18 Jan 2004 18:39:3 -0000
Received: (from schaefer@localhost)
	by candle.brasslantern.com (8.11.6/8.11.6) id i0IId1X10060
	for zsh-users@sunsite.dk; Sun, 18 Jan 2004 10:39:01 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Message-Id: <040118103901.ZM10059@candle.brasslantern.com>
Date: Sun, 18 Jan 2004 10:39:01 -0800
In-Reply-To: <20040118121441.GA29157@quark.localdomain>
Comments: In reply to Vincent <zsh@hightek.org>
        "loading dynamic modules in a static shell" (Jan 18,  6:14am)
References: <20040118121441.GA29157@quark.localdomain>
X-Mailer: Z-Mail Lite (5.0.0 30July97)
To: zsh-users@sunsite.dk
Subject: Re: loading dynamic modules in a static shell
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Jan 18,  6:14am, Vincent wrote:
> 
> Is it supposed to be possible to compile a static shell with part of
> the modules built in and to be able to load the remaining modules with
> zmodload?

Yes; in fact the default is for zsh/main to be static-linked and all the
other modules to be dynamic.

> not been able to get it to work.  I don't know if there is another way
> I am supposed to do it but If I tried setting some with link=dynamic
> and some with link=static in config.modules it would not work.

That's the way you're supposed to do it.  However, I think you may be a
little confused about the procedure:

> It only compiled either static or dynamic based on how the ldflags
> were set when it was configured with configure. I compiled zsh-4.0.9
> configured with "configure --enable-ldflags=-static"

That's the first mistake.  You want one of

	configure --enable-dynamic			(the default)
or
	configure --disable-dynamic

Do not specify the -static or -shared ldflags yourself directly; they are
independent of whether individual modules are static-linked.

For a mix of static and dynamic modules, you must start by configuring a
dynamic shell, then edit config.modules to select the modules that you
want linked static.

> installed it, then reconfigured it as shared, did a "make modules" and
> installed the dynamic modules. However, when I try loading one of the
> dynamic modules that are not statically linked in, such as zftp, it
> just says "zsh: failed to load module: zsh/zftp".

Did you ever actually edit config.modules to set "link=static" for zftp?
If so, did you also set "auto=no" so that re-running configure would not
clobber your changes?

> I have searched the FAQ, mailing lists, and documentation, but have
> not found any information that helps me.

The INSTALL file should tell you just about everything you need to know.

