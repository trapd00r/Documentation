From zsh-users-return-8063-mason-zsh=primenet.com.au@sunsite.dk Sun Oct 17 16:28:57 2004
Return-Path: <zsh-users-return-8063-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6852 invoked from network); 17 Oct 2004 16:28:56 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 17 Oct 2004 16:28:56 -0000
Received: (qmail 44056 invoked from network); 17 Oct 2004 16:28:49 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Oct 2004 16:28:49 -0000
Received: (qmail 16418 invoked by alias); 17 Oct 2004 16:28:02 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8063
Received: (qmail 16404 invoked from network); 17 Oct 2004 16:28:01 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 17 Oct 2004 16:28:01 -0000
Received: (qmail 42587 invoked from network); 17 Oct 2004 16:27:02 -0000
Received: from moonbase.zanshin.com (64.84.47.139)
  by a.mx.sunsite.dk with SMTP; 17 Oct 2004 16:27:00 -0000
Received: from toltec.zanshin.com (toltec.zanshin.com [64.84.47.166])
	by moonbase.zanshin.com (8.13.1/8.13.1) with ESMTP id i9HGQr5B026692;
	Sun, 17 Oct 2004 09:26:53 -0700
Date: Sun, 17 Oct 2004 09:26:53 -0700 (PDT)
From: Bart Schaefer <schaefer@brasslantern.com>
Reply-To: zsh-users@sunsite.dk
To: Michael Prokop <zsh@michael-prokop.at>
cc: zsh-users@sunsite.dk
Subject: Re: Change directory on invocation of zsh
In-Reply-To: <2004-10-17T16-22-44@devnull.michael-prokop.at>
Message-ID: <Pine.LNX.4.61.0410170908590.8058@toltec.zanshin.com>
References: <2004-10-16T23-18-26@devnull.michael-prokop.at>
 <Pine.LNX.4.61.0410161942220.8058@toltec.zanshin.com>
 <2004-10-17T16-22-44@devnull.michael-prokop.at>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_44 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0

On Sun, 17 Oct 2004, Michael Prokop wrote:

> * Bart Schaefer <schaefer@brasslantern.com> [20041017 10:13]:
> >   if (( EUID == 0 )); then
> >      export HOME=/root
> >   else
> >      export HOME=/home/$LOGNAME
> >   fi
> 
> /etc/zsh/zshrc:cd:22: no such file or directory: /home/LOGIN
> $ echo $LOGNAME
> LOGIN

Hm.  This means that one of the following occurred:

- getlogin() returned "LOGIN"

- getlogin() returned empty or null, and getpwuid() returned an entry for
  the user named "LOGIN"

I'd have to guess this is a side-effect of autologin?  Does it run as the
user "LOGIN"?

> I can't find the reason for this behaviour (inittab entries are the
> same and behaviour seems to change when booting system serveral
> times), but using `id -un` instead of $LOGNAME seems to fix it.

If you can't figure out how to get it to be consistent, I'd suggest adding
to /etc/zsh/zshenv this snippet:

  [[ $LOGNAME == LOGIN ]] && LOGNAME=$(id -un)

Do that before the EUID/HOME snippet.  Other things may be depending on 
LOGNAME being set correctly, too.

