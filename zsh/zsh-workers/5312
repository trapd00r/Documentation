Delivered-To: mason-zsh@primenet.com.au
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
Message-ID: <19990208064949.11460.qmail@hotmail.com>
X-Originating-IP: [209.157.52.3]
From: "Matt Armstrong" <mattarmst@hotmail.com>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH zsh-3.1.5-pws-7: cygwin make fixes
Date: Sun, 07 Feb 1999 22:49:49 PST
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="----=_NextPart_000_6a0a2fb4_363b82e2$374bcf22"
X-Mailing-List: <zsh-workers@sunsite.auc.dk> 5312

------=_NextPart_000_6a0a2fb4_363b82e2$374bcf22
Content-Type: text/plain

There are two problems with the make system in zsh-3.1.5-pws-7 (and 
surely previous versions) when running under cygwin.

1) The makefiles assume they are creating "zsh" and not "zsh.exe."  Not 
a problem unless you do a "make install" under cygwin.

2) The Src/signames.awk gets confused by cygwin's sys/signals.h since it 
defines signal names for multiple platforms (many of which #define all 
the signal names to 1).

I fixed #1 by adding AC_EXEEXT to configure.in and using the 
corresponding $(EXEEXT) variable where needed in the other makefiles.  
WARNING: I imagine you need a fairly recent autoconf to get the 
AC_EXEEXT (I tested with version 2.13).  You can get it at 
http://sourceware.cygnus.com/autoconf/.

I fixed #2 by re-doing the way signames.c is created.  Instead of a AWK 
script that gets run on a signal.h file, a C program is compiled and 
run.  This gets it right even if the signal.h file is hard to parse.

My fix for #1 may be controversial because it may break for people who 
need to keep using an older autoconf.  Is upgrading a problem?

My fix for #2, I think, is a good thing.  ;-)  I'd do the same thing for 
the RLIMIT stuff if cygwin had RLIMIT stuff.

The patch for both is attached (they intertwine).

Please let me know if sending patches as MIME attachments is an 
inconvenience (though, pasting a patch file into this little hotmail 
edit window may ruin it).

The patch file is generated with cvs rdiff.  If you apply it with 
'patch', do it as "patch -p1 -E < zsh-patch.txt" in the root of your zsh 
tree.  "-p1" (p-one, not "el") will strip off the leading "zsh" path 
component that cvs rdiff likes to add.  "-E" will delete 
Src/signames.awk instead of leaving it as a zero length file.

REMEMBER: Src/mksignames.c is a new file, Src/signames.awk gets deleted.

Testing: You might check that "kill -l" prints the same thing before and 
after this patch.

______________________________________________________
Get Your Private, Free Email at http://www.hotmail.com
------=_NextPart_000_6a0a2fb4_363b82e2$374bcf22
Content-Type: text/plain; name="zsh-patch.txt"
Content-Transfer-Encoding: 8bit
Content-Disposition: attachment; filename="zsh-patch.txt"

------=_NextPart_000_6a0a2fb4_363b82e2$374bcf22--


