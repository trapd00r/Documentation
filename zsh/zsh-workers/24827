From zsh-workers-return-24827-mason-zsh=primenet.com.au@sunsite.dk Thu Apr 17 12:45:31 2008
Return-Path: <zsh-workers-return-24827-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18905 invoked from network); 17 Apr 2008 12:45:30 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 17 Apr 2008 12:45:30 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 68253 invoked from network); 17 Apr 2008 12:45:20 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Apr 2008 12:45:20 -0000
Received: (qmail 9375 invoked by alias); 17 Apr 2008 12:45:18 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24827
Received: (qmail 9363 invoked from network); 17 Apr 2008 12:45:17 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 17 Apr 2008 12:45:17 -0000
Received: from rv-out-0506.google.com (rv-out-0506.google.com [209.85.198.226])
	by bifrost.dotsrc.org (Postfix) with ESMTP id E7AA2808A379
	for <zsh-workers@sunsite.dk>; Thu, 17 Apr 2008 14:45:09 +0200 (CEST)
Received: by rv-out-0506.google.com with SMTP id g37so26295rvb.21
        for <zsh-workers@sunsite.dk>; Thu, 17 Apr 2008 05:45:12 -0700 (PDT)
Received: by 10.141.132.1 with SMTP id j1mr418315rvn.64.1208394512482;
        Wed, 16 Apr 2008 18:08:32 -0700 (PDT)
Received: by 10.141.202.18 with HTTP; Wed, 16 Apr 2008 18:08:32 -0700 (PDT)
Message-ID: <237967ef0804161808m11b7d63fnf3523439268d3de2@mail.gmail.com>
Date: Thu, 17 Apr 2008 03:08:32 +0200
From: "Mikael Magnusson" <mikachu@gmail.com>
To: zsh-workers <zsh-workers@sunsite.dk>
Subject: list-prompt not aligned right
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
X-Virus-Scanned: ClamAV 0.91.2/6810/Thu Apr 17 13:25:25 2008 on bifrost
X-Virus-Status: Clean

I'm not sure which parts of this are needed to reproduce, so I'll be
as exact as I can, but it does happen under less specific
circumstances.

zsh -f
autoload compinit;compinit
zstyle ':completion:*' list-prompt %SAt %p: Hit TAB for more, or the
character to insert%s
zstyle ':completion:*:descriptions' format foo
touch aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa{1..40}
# i think the point is they need to be wider than the terminal
ls <tab><tab><tab>

After a couple presses, possible some specific height is also needed,
the shorter the better i think (my terminal right now is 98x24), one
of the "a"s will leak over to the line that has the "Hit TAB for more"
message:
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
aAt 58%: Hit TAB for more, or the character to insert

Normally i have this too
zstyle ':completion:*' list-colors ${(s.:.)${LS_COLORS}#ec=}
and when the leak happens in this case, the TAB message gets the color
of whatever file spilled over.
zstyle ':completion:*:descriptions' format ''
seems to make the problem go away.

I don't think this is a new problem, but I think in the past i've
ascribed it to wonkiness with multibyte/doublewidth characters, but it
happened now with only ascii so obviously that wasn't it.

-- 
Mikael Magnusson

