From zsh-workers-return-23787-mason-zsh=primenet.com.au@sunsite.dk Tue Aug 21 22:53:23 2007
Return-Path: <zsh-workers-return-23787-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14063 invoked from network); 21 Aug 2007 22:53:18 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.1 (2007-05-02) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 21 Aug 2007 22:53:18 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 32840 invoked from network); 21 Aug 2007 22:53:11 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 21 Aug 2007 22:53:11 -0000
Received: (qmail 8063 invoked by alias); 21 Aug 2007 22:53:09 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23787
Received: (qmail 8053 invoked from network); 21 Aug 2007 22:53:08 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 21 Aug 2007 22:53:08 -0000
Received: (qmail 32513 invoked from network); 21 Aug 2007 22:53:08 -0000
Received: from acolyte.scowler.net (216.254.112.45)
  by a.mx.sunsite.dk with SMTP; 21 Aug 2007 22:53:03 -0000
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id 7B3A65CEDC; Tue, 21 Aug 2007 18:53:01 -0400 (EDT)
Date: Tue, 21 Aug 2007 18:53:01 -0400
From: Clint Adams <schizo@debian.org>
To: zsh-workers@sunsite.dk, Niko Tyni <ntyni@iki.fi>,
	266031-forwarded@bugs.debian.org
Subject: Re: Bug#266031: zsh: still segfaults occasionally on sid
Message-ID: <20070821225301.GB31741@scowler.net>
Mail-Followup-To: zsh-workers@sunsite.dk, Niko Tyni <ntyni@iki.fi>,
	266031-forwarded@bugs.debian.org
References: <20070821191245.GA29403@rispa.it.helsinki.fi>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20070821191245.GA29403@rispa.it.helsinki.fi>
User-Agent: Mutt/1.5.16 (2007-06-11)

On Tue, Aug 21, 2007 at 10:12:45PM +0300, Niko Tyni wrote:
> I'm seeing this bug maybe once or twice a day on amd64/sid (and
> on etch too.)  I'm also using the vi bindings, and the bug always
> hits me when browsing or searching history, usually when I press 'k'
> (up-line-or-history) in the vicmd mode. I think the history has to grow
> long enough first or something, it never seems to happen early in the
> terminal session.  I have tried to find a way to reproduce the crash
> reliably, but no luck yet.
> 
> Here's the gdb backtrace and the message displayed on the terminal after
> the latest crash.  Please let me know if I can provide more information.

Which history-related options are you setopt-ing?  What are the values
of $HISTSIZE and $SAVEHIST ?  What kind of filesystem is your history
file stored on/over?

> Core was generated by `-zsh'.
> Program terminated with signal 6, Aborted.
> #0  0x00002b361909c635 in raise () from /lib/libc.so.6
> (gdb) bt
> #0  0x00002b361909c635 in raise () from /lib/libc.so.6
> #1  0x00002b361909e090 in abort () from /lib/libc.so.6
> #2  0x00002b36190d549b in ?? () from /lib/libc.so.6
> #3  0x00002b36190dc99a in ?? () from /lib/libc.so.6
> #4  0x00002b36190e058c in free () from /lib/libc.so.6
> #5  0x000000000043254f in freehistdata ()
> #6  0x000000000043556c in prepnexthistent ()
> #7  0x000000000043688f in hend ()
> #8  0x000000000043babc in loop ()
> #9  0x000000000043c80c in zsh_main ()
> #10 0x00002b3619088b44 in __libc_start_main () from /lib/libc.so.6
> #11 0x000000000040f5b9 in _start ()
> 
> Message from the terminal, copy-pasted here:
> 
> *** glibc detected *** -zsh: free(): invalid pointer: 0x00000000006e6560 ***
> ======= Backtrace: =========
> /lib/libc.so.6[0x2b36190dc99a]
> /lib/libc.so.6(cfree+0x8c)[0x2b36190e058c]
> -zsh(freehistdata+0x1f)[0x43254f]
> -zsh(prepnexthistent+0x9c)[0x43556c]
> -zsh(hend+0x55f)[0x43688f]
> -zsh(loop+0x6c)[0x43babc]
> -zsh(zsh_main+0x1dc)[0x43c80c]
> /lib/libc.so.6(__libc_start_main+0xf4)[0x2b3619088b44]
> -zsh[0x40f5b9]
> ======= Memory map: ========
> 00400000-00492000 r-xp 00000000 08:01 32832                              /bin/zsh4
> 00691000-00697000 rw-p 00091000 08:01 32832                              /bin/zsh4
> 00697000-00771000 rw-p 00697000 00:00 0                                  [heap]
> 2b3618562000-2b361857f000 r-xp 00000000 08:01 65556                      /lib/ld-2.6.1.so
> 2b361857f000-2b3618582000 rw-p 2b361857f000 00:00 0 
> 2b361877e000-2b3618780000 rw-p 0001c000 08:01 65556                      /lib/ld-2.6.1.so
> 2b3618780000-2b3618782000 r-xp 00000000 08:01 65565                      /lib/libdl-2.6.1.so
> 2b3618782000-2b3618982000 ---p 00002000 08:01 65565                      /lib/libdl-2.6.1.so
> 2b3618982000-2b3618984000 rw-p 00002000 08:01 65565                      /lib/libdl-2.6.1.so
> 2b3618984000-2b3618999000 r-xp 00000000 08:01 65557                      /lib/libnsl-2.6.1.so
> 2b3618999000-2b3618b99000 ---p 00015000 08:01 65557                      /lib/libnsl-2.6.1.so
> 2b3618b99000-2b3618b9b000 rw-p 00015000 08:01 65557                      /lib/libnsl-2.6.1.so
> 2b3618b9b000-2b3618b9d000 rw-p 2b3618b9b000 00:00 0 
> 2b3618b9d000-2b3618be5000 r-xp 00000000 08:01 65601                      /lib/libncurses.so.5.6
> 2b3618be5000-2b3618de4000 ---p 00048000 08:01 65601                      /lib/libncurses.so.5.6
> 2b3618de4000-2b3618de9000 rw-p 00047000 08:01 65601                      /lib/libncurses.so.5.6
> 2b3618de9000-2b3618e69000 r-xp 00000000 08:01 65569                      /lib/libm-2.6.1.so
> 2b3618e69000-2b3619068000 ---p 00080000 08:01 65569                      /lib/libm-2.6.1.so
> 2b3619068000-2b361906a000 rw-p 0007f000 08:01 65569                      /lib/libm-2.6.1.so
> 2b361906a000-2b361906b000 rw-p 2b361906a000 00:00 0 
> 2b361906b000-2b36191b8000 r-xp 00000000 08:01 65561                      /lib/libc-2.6.1.so
> 2b36191b8000-2b36193b8000 ---p 0014d000 08:01 65561                      /lib/libc-2.6.1.so
> 2b36193b8000-2b36193bb000 r--p 0014d000 08:01 65561                      /lib/libc-2.6.1.so
> 2b36193bb000-2b36193bd000 rw-p 00150000 08:01 65561                      /lib/libc-2.6.1.so
> 2b36193bd000-2b36193c3000 rw-p 2b36193bd000 00:00 0 
> 2b36193c3000-2b36195dc000 r--p 00000000 08:01 296126                     /usr/lib/locale/locale-archive
> 2b36195dc000-2b36195e0000 rw-p 2b36195dc000 00:00 0 
> 2b36195e0000-2b36195e7000 r-xp 00000000 08:01 65562                      /lib/libnss_compat-2.6.1.so
> 2b36195e7000-2b36197e7000 ---p 00007000 08:01 65562                      /lib/libnss_compat-2.6.1.so
> 2b36197e7000-2b36197e9000 rw-p 00007000 08:01 65562                      /lib/libnss_compat-2.6.1.so
> 2b36197e9000-2b36197f3000 r-xp 00000000 08:01 65552                      /lib/libnss_nis-2.6.1.so
> 2b36197f3000-2b36199f2000 ---p 0000a000 08:01 65552                      /lib/libnss_nis-2.6.1.so
> 2b36199f2000-2b36199f4000 rw-p 00009000 08:01 65552                      /lib/libnss_nis-2.6.1.so
> 2b36199f4000-2b36199fe000 r-xp 00000000 08:01 65570                      /lib/libnss_files-2.6.1.so
> 2b36199fe000-2b3619bfd000 ---p 0000a000 08:01 65570                      /lib/libnss_files-2.6.1.so
> 2b3619bfd000-2b3619bff000 rw-p 00009000 08:01 65570                      /lib/libnss_files-2.6.1.so
> 2b3619c00000-2b3619c02000 r-xp 00000000 08:01 280025                     /usr/lib/zsh/4.3.4/zsh/terminfo.so
> 2b3619c02000-2b3619e01000 ---p 00002000 08:01 280025                     /usr/lib/zsh/4.3.4/zsh/terminfo.so
> 2b3619e01000-2b3619e02000 rw-p 00001000 08:01 280025                     /usr/lib/zsh/4.3.4/zsh/terminfo.so
> 2b3619e02000-2b3619e3b000 r-xp 00000000 08:01 280036                     /usr/lib/zsh/4.3.4/zsh/zle.so
> 2b3619e3b000-2b361a03a000 ---p 00039000 08:01 280036                     /usr/lib/zsh/4.3.4/zsh/zle.so
> 2b361a03a000-2b361a042000 rw-p 00038000 08:01 280036                     /usr/lib/zsh/4.3.4/zsh/zle.so
> 2b361a042000-2b361a062000 r-xp 00000000 08:01 280032                     /usr/lib/zsh/4.3.4/zsh/complete.so
> 2b361a062000-2b361a262000 ---p 00020000 08:01 280032                     /usr/lib/zsh/4.3.4/zsh/complete.so
> 2b361a262000-2b361a264000 rw-p 00020000 08:01 280032                     /usr/lib/zsh/4.3.4/zsh/complete.so
> 2b361a264000-2b361a26a000 r-xp 00000000 08:01 280030                     /usr/lib/zsh/4.3.4/zsh/zutil.so
> 2b361a26a000-2b361a46a000 ---p 00006000 08:01 280030                     /usr/lib/zsh/4.3.4/zsh/zutil.so
> 2b361a46a000-2b361a46b000 rw-p 00006000 08:01 280030                     /usr/lib/zsh/4.3.4/zsh/zutil.so
> 2b361a46b000-2b361a472000 r--s 00000000 08:01 262166                     /usr/lib/gconv/gconv-modules.cache
> 2b361a472000-2b361a47a000 r-xp 00000000 08:01 280018                     /usr/lib/zsh/4.3.4/zsh/parameter.so
> 2b361a47a000-2b361a67a000 ---p 00008000 08:01 280018                     /usr/lib/zsh/4.3.4/zsh/parameter.so
> 2b361a67a000-2b361a67b000 rw-p 00008000 08:01 280018                     /usr/lib/zsh/4.3.4/zsh/parameter.so
> 2b361a67b000-2b361a67e000 r-xp 00000000 08:01 278531                     /usr/lib/zsh/4.3.4/zsh/rlimits.so
> 2b361a67e000-2b361a87d000 ---p 00003000 08:01 278531                     /usr/lib/zsh/4.3.4/zsh/rlimits.so
> 2b361a87d000-2b361a87e000 rw-p 00002000 08:01 278531                     /usr/lib/zsh/4.3.4/zsh/rlimits.so
> 2b361a87f000-2b361a882000 rw-p 2b361a87f000 00:00 0 
> 2b361a882000-2b361a891000 r-xp 00000000 08:01 280034                     /usr/lib/zsh/4.3.4/zsh/computil.so
> 2b361a891000-2b361aa90000 ---p 0000f000 08:01 280034                     /usr/lib/zsh/4.3.4/zsh/computil.so
> 2b361aa90000-2b361aa91000 rw-p 0000e000 08:01 280034                     /usr/lib/zsh/4.3.4/zsh/computil.so
> 2b361aa91000-2b361aa92000 rw-p 2b361aa91000 00:00 0 
> 2b361aa93000-2b361aa96000 rw-p 2b361aa93000 00:00 0 
> 2b361aa97000-2b361aa9a000 rw-p 2b361aa97000 00:00 0 
> 2b361aa9b000-2b361aa9e000 rw-p 2b361aa9b000 00:00 0 
> 2b361aa9f000-2b361aaa2000 rw-p 2b361aa9f000 00:00 0 
> 2b361aaa3000-2b361aaa6000 rw-p 2b361aaa3000 00:00 0 
> 2b361aaa7000-2b361aaaa000 rw-p 2b361aaa7000 00:00 0 
> 2b361aaab000-2b361aaae000 rw-p 2b361aaab000 00:00 0 
> 2b361aaaf000-2b361aab2000 rw-p 2b361aaaf000 00:00 0 
> 2b361aab3000-2b361aab6000 rw-p 2b361aab3000 00:00 0 
> 2b361aab7000-2b361aaba000 rw-p 2b361aab7000 00:00 0 
> 2b361aabb000-2b361aabe000 rw-p 2b361aabb000 00:00 0 
> 2b361aabf000-2b361aac2000 rw-p 2b361aabf000 00:00 0 
> 2b361aac3000-2b361aac6000 rw-p 2b361aac3000 00:00 0 
> 2b361aac7000-2b361aaca000 rw-p 2b361aac7000 00:00 0 
> 2b361aacb000-2b361aace000 rw-p 2b361aacb000 00:00 0 
> 2b361aacf000-2b361aad2000 rw-p 2b361aacf000 00:00 0 
> 2b361aad3000-2b361aad6000 rw-p 2b361aad3000 00:00 0 
> 2b361aad7000-2b361aada000 rw-p 2b361aad7000 00:00 0 
> 2b361aadb000-2b361aade000 rw-p 2b361aadb000 00:00 0 
> 2b361aadf000-2b361aae2000 rw-p 2b361aadf000 00:00 0 
> 2b361aae3000-2b361aae6000 rw-p 2b361aae3000 00:00 0 
> 2b361aae7000-2b361aaea000 rw-p 2b361aae7000 00:00 0 
> 2b361aaeb000-2b361aaee000 rw-p 2b361aaeb000 00:00 0 
> 2b361aaef000-2b361aaf2000 rw-p 2b361aaef000 00:00 0 
> 2b361aaf3000-2b361aaf6000 rw-p 2b361aaf3000 00:00 0 
> 2b361aaf7000-2b361aafa000 rw-p 2b361aaf7000 00:00 0 
> 2b361aafb000-2b361aafe000 rw-p 2b361aafb000 00:00 0 
> 2b361aaff000-2b361ab02000 rw-p 2b361aaff000 00:00 0 
> 2b361ab03000-2b361ab06000 rw-p 2b361ab03000 00:00 0 
> 2b361ab07000-2b361ab0a000 rw-p 2b361ab07000 00:00 0 
> 2b361ab0b000-2b361ab0e000 rw-p 2b361ab0b000 00:00 0 
> 2b361ab0f000-2b361ab12000 rw-p 2b361ab0f000 00:00 0 
> 2b361ab13000-2b361ab16000 rw-p 2b361ab13000 00:00 0 
> 2b361ab17000-2b361ab1a000 rw-p 2b361ab17000 00:00 0 
> 2b361ab1b000-2b361ab1e000 rw-p 2b361ab1b000 00:00 0 
> 2b361ab1f000-2b361ab22000 rw-p 2b361ab1f000 00:00 0 
> 2b361ab23000-2b361ab26000 rw-p 2b361ab23000 00:00 0 
> 2b361ab27000-2b361ab2a000 rw-p 2b361ab27000 00:00 0 
> 2b361ab2b000-2b361ab2e000 rw-p 2b361ab2b000 00:00 0 
> 2b361ab2f000-2b361ab32000 rw-p 2b361ab2f000 00:00 0 
> 2b361ab36000-2b361ab43000 r-xp 00000000 08:01 65600                      /lib/libgcc_s.so.1
> 2b361ab43000-2b361ad43000 ---p 0000d000 08:01 65600                      /lib/libgcc_s.so.1
> 2b361ad43000-2b361ad44000 rw-p 0000d000 08:01 65600                      /lib/libgcc_s.so.1
> 2b361c000000-2b361c021000 rw-p 2b361c000000 00:00 0 
> 2b361c021000-2b3620000000 ---p 2b361c021000 00:00 0 
> 7fff924f6000-7fff92548000 rw-p 7fff924f6000 00:00 0                      [stack]
> ffffffffff600000-ffffffffffe00000 ---p 00000000 00:00 0                  [vdso]

