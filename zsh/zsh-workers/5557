From zsh-workers-return-5557-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Feb 28 21:39:31 1999
Return-Path: <zsh-workers-return-5557-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10083 invoked from network); 28 Feb 1999 21:39:30 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 28 Feb 1999 21:39:30 -0000
Received: (qmail 28738 invoked by alias); 28 Feb 1999 21:32:45 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5557
Received: (qmail 14033 invoked from network); 28 Feb 1999 17:10:32 -0000
Message-Id: <9902241501.AA23279@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: Re: signames problem 
In-Reply-To: "Bernd Eggink"'s message of "Wed, 24 Feb 1999 15:41:44 NFT."
             <36D40FA8.8679495C@uni-hamburg.de> 
Date: Wed, 24 Feb 1999 16:01:23 +0100
From: Peter Stephenson <pws@ibmth.df.unipi.it>

Bernd Eggink wrote:
> The test in configure:4024 is too weak. I guess it would be better to
> test for a minimum number (e.g., 7) of "#define SIG..."s in each file.

Thanks.  Here's what I came up with based on your suggestion.  Maybe it's
even safer to check for signals we know should be defined, i.e. look for
SIGHUP or SIGKILL, but goodness knows what's out there these days.

--- configure.in.sig	Wed Feb 24 13:46:04 1999
+++ configure.in	Wed Feb 24 15:52:13 1999
@@ -682,6 +682,7 @@
   dnl In case we don't get the stuff from the preprocesor, use the old
   dnl list of standard places.
   sigfile_list="/usr/include/bsd/sys/signal.h
+/usr/include/signum.h
 /usr/include/asm/signum.h
 /usr/include/asm/signal.h
 /usr/include/linux/signal.h
@@ -690,9 +691,13 @@
 fi
 for SIGNAL_H in $sigfile_list
 do
-  test -f $SIGNAL_H && \
-  grep '#[ 	]*define[ 	][ 	]*SIG[0-9A-Z]*[ 	]*[0-9][0-9]*' $SIGNAL_H > /dev/null && \
-  break
+  dnl Try to make sure it doesn't get confused by files that don't
+  dnl have real signal definitions in, but do #define SIG* by counting
+  dnl the number of signals.  Maybe we could even check for e.g. SIGHUP?
+  nsigs=`test -f $SIGNAL_H && \
+  grep '#[ 	]*define[ 	][ 	]*SIG[0-9A-Z]*[ 	]*[0-9][0-9]*' $SIGNAL_H | \
+  wc -l | sed 's/[ 	]//g'`
+  test "x$nsigs" != x && test "$nsigs" -ge 7 && break
 done
 zsh_cv_path_signal_h=$SIGNAL_H
 ])

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

