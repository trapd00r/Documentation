From zsh-workers-return-22783-mason-zsh=primenet.com.au@sunsite.dk Wed Sep 27 20:36:37 2006
Return-Path: <zsh-workers-return-22783-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1995 invoked from network); 27 Sep 2006 20:36:33 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.5 (2006-08-29) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 27 Sep 2006 20:36:33 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 48489 invoked from network); 27 Sep 2006 20:36:27 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 27 Sep 2006 20:36:27 -0000
Received: (qmail 9744 invoked by alias); 27 Sep 2006 20:36:23 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22783
Received: (qmail 9734 invoked from network); 27 Sep 2006 20:36:22 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 27 Sep 2006 20:36:22 -0000
Received: (qmail 48146 invoked from network); 27 Sep 2006 20:36:22 -0000
Received: from ms-1.rz.rwth-aachen.de (HELO ms-dienst.rz.rwth-aachen.de) (134.130.3.130)
  by a.mx.sunsite.dk with SMTP; 27 Sep 2006 20:36:21 -0000
Received: from r220-1 (r220-1.rz.RWTH-Aachen.DE [134.130.3.31])
 by ms-dienst.rz.rwth-aachen.de
 (iPlanet Messaging Server 5.2 Patch 2 (built Jul 14 2004))
 with ESMTP id <0J69007GCQH07F@ms-dienst.rz.rwth-aachen.de> for
 zsh-workers@sunsite.dk; Wed, 27 Sep 2006 22:34:12 +0200 (MEST)
Received: from relay.rwth-aachen.de ([134.130.3.1])
	by r220-1 (MailMonitor for SMTP v1.2.2 ) ; Wed,
 27 Sep 2006 22:34:11 +0200 (MEST)
Received: from fsst.voodoo.lan ([212.117.85.153])
	by relay.rwth-aachen.de (8.13.7/8.13.3/1) with ESMTP id k8RKYBoD017895	for
 <zsh-workers@sunsite.dk>; Wed, 27 Sep 2006 22:34:11 +0200 (MEST)
Received: from hawk by fsst.voodoo.lan with local (Exim 4.63)
	(envelope-from <ft@bewatermyfriend.de>)
	id 1GSg64-0006l9-35	for zsh-workers@sunsite.dk; Wed, 27 Sep 2006 22:33:36 +0200
Date: Wed, 27 Sep 2006 22:33:35 +0200
From: Frank Terbeck <ft@bewatermyfriend.de>
Subject: newuser loaded for scripts
To: zsh workers <zsh-workers@sunsite.dk>
Mail-followup-to: zsh workers <zsh-workers@sunsite.dk>
Message-id: <20060927203335.GC22780@fsst.voodoo.lan>
MIME-version: 1.0
Content-type: text/plain; charset=iso-8859-1
Content-transfer-encoding: 7BIT
Content-disposition: inline
Operating-System: Linux 2.6.16.16 i686
User-Agent: Mutt/1.5.13 (2006-08-11)

Hi workers!

Somebody who doesn't use zsh wondered, why the shell wants to
configure itself, just because he wants to run a script that is
written in zsh.

Only loading the newuser module if the shell is interactive (which
should be enough) would fix this. I'm not too familiar with the zsh
code, but the change should be trivial.

Regards, Frank

--- Src/init.c.orig	2006-09-27 21:57:15.000000000 +0200
+++ Src/init.c	2006-09-27 21:57:39.000000000 +0200
@@ -958,7 +958,7 @@
 	source(GLOBAL_ZSHENV);
 #endif
 
-	if (isset(RCS) && unset(PRIVILEGED))
+	if (isset(RCS) && isset(INTERACTIVE) && unset(PRIVILEGED))
 	{
 	    /*
 	     * Always attempt to load the newuser module to perform

