From zsh-workers-return-23789-mason-zsh=primenet.com.au@sunsite.dk Wed Aug 22 04:39:40 2007
Return-Path: <zsh-workers-return-23789-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15624 invoked from network); 22 Aug 2007 04:39:38 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.1 (2007-05-02) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 22 Aug 2007 04:39:38 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 24051 invoked from network); 22 Aug 2007 04:39:31 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 22 Aug 2007 04:39:31 -0000
Received: (qmail 12894 invoked by alias); 22 Aug 2007 04:39:29 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 23789
Received: (qmail 12884 invoked from network); 22 Aug 2007 04:39:28 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 22 Aug 2007 04:39:28 -0000
Received: (qmail 23754 invoked from network); 22 Aug 2007 04:39:28 -0000
Received: from mchenry.wikimedia.org (66.230.200.240)
  by a.mx.sunsite.dk with SMTP; 22 Aug 2007 04:39:25 -0000
Received: from sanger.wikimedia.org ([66.230.200.241]:45539)
	by mchenry.wikimedia.org with esmtp (Exim 4.63)
	(envelope-from <river@wikimedia.org>)
	id 1INi04-0005xx-C6
	for zsh-workers@sunsite.dk; Wed, 22 Aug 2007 04:39:24 +0000
Received: from cpc3-oxfd10-0-0-cust436.oxfd.cable.ntl.com ([81.110.41.181]:46817)
	by sanger.wikimedia.org with esmtpsa (TLS-1.0:DHE_RSA_AES_256_CBC_SHA1:32)
	(Exim 4.63)
	(envelope-from <river@wikimedia.org>)
	id 1INi04-0003Ae-6Q
	for zsh-workers@sunsite.dk; Wed, 22 Aug 2007 04:39:24 +0000
From: River Tarnell <river@wikimedia.org>
Organization: Wikimedia Foundation, Inc.
To: zsh-workers@sunsite.dk
Subject: 4.3.4 build fails on UnixWare 7
Date: Wed, 22 Aug 2007 05:38:59 +0100
User-Agent: KMail/1.9.6
MIME-Version: 1.0
Content-Type: multipart/signed;
  boundary="nextPart2281352.PzFj3uyfQD";
  protocol="application/pgp-signature";
  micalg=pgp-sha1
Content-Transfer-Encoding: 7bit
Message-Id: <200708220539.03136.river@wikimedia.org>

--nextPart2281352.PzFj3uyfQD
Content-Type: text/plain;
  charset="utf-8"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline

hello,

i am unable to build zsh 4.3.4 on UnixWare 7.1.3.  the following error occu=
rs:

        cc -c -I.  -DHAVE_CONFIG_H -O  -o zle_refresh.o zle_refresh.c
UX:acomp: ERROR: "zle_refresh.c", line 182: integral constant expression=20
expected
*** Error code 1 (bu21)
UX:make: ERROR: fatal error.

UnixWare defines MB_CUR_MAX as:

#define MB_CUR_MAX        ((int)__ctype[520])

i was able to fix this with the following diff:

*** zle_refresh.c.old   Wed Aug 22 05:25:37 2007
=2D-- zle_refresh.c       Wed Aug 22 05:27:58 2007
***************
*** 179,187 ****
  zwcputc(ZLE_INT_T c)
  {
  #ifdef MULTIBYTE_SUPPORT
!     char mbtmp[MB_CUR_MAX + 1];
      mbstate_t mbstate;
      int i;

      if (c =3D=3D WEOF)
        return;
=2D-- 179,189 ----
  zwcputc(ZLE_INT_T c)
  {
  #ifdef MULTIBYTE_SUPPORT
!     char *mbtmp;
      mbstate_t mbstate;
      int i;
+
+     mbtmp =3D alloca(MB_CUR_MAX + 1);

      if (c =3D=3D WEOF)
        return;

however, use of alloca seems suboptimal (perhaps malloc could be used=20
instead).

	- river.

--nextPart2281352.PzFj3uyfQD
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQBGy73nIXd7fCuc5vIRAlNEAJsEImArE7BZF0EnPBwASujwc+VUVwCff0Bn
pvjvjtzxCog8c+k9rOHau2U=
=dVWm
-----END PGP SIGNATURE-----

--nextPart2281352.PzFj3uyfQD--

