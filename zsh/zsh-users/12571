From zsh-users-return-12571-mason-zsh=primenet.com.au@sunsite.dk Thu Feb 14 16:26:30 2008
Return-Path: <zsh-users-return-12571-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12710 invoked from network); 14 Feb 2008 16:26:28 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 14 Feb 2008 16:26:28 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 73100 invoked from network); 14 Feb 2008 16:26:11 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 14 Feb 2008 16:26:11 -0000
Received: (qmail 2625 invoked by alias); 14 Feb 2008 16:26:02 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12571
Received: (qmail 2603 invoked from network); 14 Feb 2008 16:26:01 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 14 Feb 2008 16:26:01 -0000
Received: from smtp2f.orange.fr (smtp2f.orange.fr [80.12.242.151])
	by bifrost.dotsrc.org (Postfix) with ESMTP id C3E6180482A1
	for <zsh-users@sunsite.dk>; Thu, 14 Feb 2008 17:25:55 +0100 (CET)
Received: from me-wanadoo.net (localhost [127.0.0.1])
	by mwinf2f14.orange.fr (SMTP Server) with ESMTP id 35520700009D
	for <zsh-users@sunsite.dk>; Thu, 14 Feb 2008 17:25:55 +0100 (CET)
Received: from localhost (AClermont-Ferrand-157-1-119-139.w86-216.abo.wanadoo.fr [86.216.14.139])
	by mwinf2f14.orange.fr (SMTP Server) with ESMTP id 01E177000099
	for <zsh-users@sunsite.dk>; Thu, 14 Feb 2008 17:25:55 +0100 (CET)
X-ME-UUID: 20080214162555776.01E177000099@mwinf2f14.orange.fr
Received: from stephane by localhost with local (Exim 4.69)
	(envelope-from <stephane@ukacgedilsacha2.artesyncp.com>)
	id 1JPguI-0001wu-Ex
	for zsh-users@sunsite.dk; Thu, 14 Feb 2008 16:25:54 +0000
Date: Thu, 14 Feb 2008 16:25:54 +0000
From: Stephane CHAZELAS <Stephane_Chazelas@yahoo.fr>
To: ZSH User List <zsh-users@sunsite.dk>
Subject: Re: timeout problem in ssh sessions - I found the culprit:
	mouse.zsh
Message-ID: <chaz20080214162554.GB6772@ukacgedilsacha2.artesyncp.com>
Mail-Followup-To: ZSH User List <zsh-users@sunsite.dk>
References: <20080211233404.GA13398@spiegl.de> <080212083755.ZM20121@torch.brasslantern.com> <20080212232947.GA13793@spiegl.de> <080212200708.ZM20711@torch.brasslantern.com> <20080213134200.GB31852@spiegl.de> <200802131349.m1DDnXRF004831@news01.csr.com> <20080214132417.GD31852@spiegl.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20080214132417.GD31852@spiegl.de>
User-Agent: Mutt/1.5.16 (2007-09-19)
X-Virus-Scanned: ClamAV 0.91.2/5809/Thu Feb 14 11:52:07 2008 on bifrost
X-Virus-Status: Clean

On Thu, Feb 14, 2008 at 02:24:17PM +0100, Andy Spiegl wrote:
[...]
> This is a _very_ nice addon by Stephane Chazelas
>  http://stchaz.free.fr/mouse.zsh
> to be able to use the mouse together with the "Super" key.
> It makes heavy use of the X selection so probably that's what is
> making the problems, maybe in combination with a bug ssh or X.
[...]

I hadn't followed that discussion even though I'm subscribed to
zsh-users. I had a look at your initial message on the ML
archive.

That probably explains then.

xclip or xsel fork a background process in order to own the
CLIPBOARD selection. Having something else owning the selection
(by having another app copying some text) should terminate that
xclip/xsel and release your ssh session.

Even if you redirect their stdin/out/err to /dev/null,
that xclip/xsel command will have a connection with sshd's X
server wrapper open and will hold your ssh session.

I don't think there's much you can do except killing those
xsel/xclip.

ssh man page:

The session terminates when the command or shell on the remote
machine exits and all X11 and TCP connections have been closed.

What you could do is run xclipboard on the X server. That tool
polls the CLIPBOARD selection to always be its owner, so that
the xclip/xsel never hang around for very long.

Cheers,
Stephane

