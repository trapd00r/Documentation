From zsh-workers-return-9958-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Mar 01 16:01:28 2000
Return-Path: <zsh-workers-return-9958-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5380 invoked from network); 1 Mar 2000 16:01:26 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 1 Mar 2000 16:01:26 -0000
Received: (qmail 9561 invoked by alias); 1 Mar 2000 16:00:55 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9958
Received: (qmail 9547 invoked from network); 1 Mar 2000 16:00:54 -0000
Date: Wed, 1 Mar 2000 17:00:52 +0100 (MET)
Message-Id: <200003011600.RAA03804@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 02 Mar 2000 00:24:22 +0900
Subject: Re: PATCH: wordcode files


Tanaka Akira wrote:

> In article <200003011006.LAA24751@beta.informatik.hu-berlin.de>,
>   Sven Wischnowsky <wischnow@informatik.hu-berlin.de> writes:
> 
> > Ok, here is the patch.
> 
> Since 9947, make check fails as follows.

Ouch. Still too much string sharing.

I had tested something similar, but with shorter strings, short enough
to be kept inline. Damn.

Bye
 Sven

diff -ru ../z.old/Src/parse.c Src/parse.c
--- ../z.old/Src/parse.c	Wed Mar  1 15:01:59 2000
+++ Src/parse.c	Wed Mar  1 16:52:42 2000
@@ -1335,6 +1335,7 @@
     lineno += oldlineno;
     ecnpats = onp;
     ecssub = oecssub;
+    ecnfunc++;
 
     ecbuf[p] = WCB_FUNCDEF(ecused - 1 - p);
 }
@@ -1504,6 +1505,7 @@
 	    lineno += oldlineno;
 	    ecnpats = onp;
 	    ecssub = oecssub;
+	    ecnfunc++;
 
 	    ecbuf[p] = WCB_FUNCDEF(ecused - 1 - p);
 

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

