From zsh-users-return-10869-mason-zsh=primenet.com.au@sunsite.dk Sat Oct 14 01:49:24 2006
Return-Path: <zsh-users-return-10869-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22861 invoked from network); 14 Oct 2006 01:49:23 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.6 (2006-10-03) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.6
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 14 Oct 2006 01:49:23 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 79586 invoked from network); 14 Oct 2006 01:49:17 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 14 Oct 2006 01:49:17 -0000
Received: (qmail 21986 invoked by alias); 14 Oct 2006 01:49:11 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10869
Received: (qmail 21977 invoked from network); 14 Oct 2006 01:49:11 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 14 Oct 2006 01:49:11 -0000
Received: (qmail 78463 invoked from network); 14 Oct 2006 01:49:10 -0000
Received: from parhelion.firedrake.org (193.201.200.77)
  by a.mx.sunsite.dk with SMTP; 14 Oct 2006 01:49:10 -0000
Received: from phil by parhelion.firedrake.org with local (Exim 4.50 #1 (Debian))
	id 1GYYeD-0006Mm-Qs; Sat, 14 Oct 2006 02:49:09 +0100
Date: Sat, 14 Oct 2006 03:49:09 +0200
From: Phil Pennock <phil.pennock@globnix.org>
To: William Scott <wgscott@chemistry.ucsc.edu>
Cc: zsh-users@sunsite.dk
Subject: Re: can't write zsh_history
Message-ID: <20061014014909.GB22643@parhelion.globnix.org>
Mail-Followup-To: William Scott <wgscott@chemistry.ucsc.edu>,
	zsh-users@sunsite.dk
References: <76C42610-83A0-4174-ADBF-5CD4D75891D5@gmail.com> <200610121802.k9CI2A8i025805@news01.csr.com> <Pine.OSX.4.61.0610130720390.16279@vanunu.ucsc.edu>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <Pine.OSX.4.61.0610130720390.16279@vanunu.ucsc.edu>
Sender: Phil Pennock <phil@firedrake.org>

On 2006-10-13 at 07:27 -0700, William Scott wrote:
> luser-%  sudo zsh
> root-#   (various nefarious evildoing)
> root-#   exit
> zsh: can't write history file /Users/luser/.zsh_history
> 
> (I call it .zsh_history, BTW).
> 
> Even "sudo zsh -l" doesn't help.  $HISTFILE never changes.

I strongly suspect that somewhere in your zsh startup files, you're
exporting HISTFILE to the environment.  The variable is used by tcsh
too, so tcsh will then be seeing the value and writing data in its own
format.  zsh later does sanity checks when writing its history, so
complains.

HISTFILE should be set, but not exported, being an internal control
variable.

In zsh:
% env | grep '^HISTFILE='

Regards,
-Phil

