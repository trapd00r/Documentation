From zsh-workers-return-28058-mason-zsh=primenet.com.au@zsh.org Tue Jun 29 19:24:15 2010
Return-Path: <zsh-workers-return-28058-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21034 invoked by alias); 29 Jun 2010 19:24:15 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28058
Received: (qmail 590 invoked from network); 29 Jun 2010 19:24:02 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at extremis.net does not designate permitted sender hosts)
Date: Tue, 29 Jun 2010 20:18:35 +0100
From: George Cox <gjvc@gjvc.com>
To: zsh-workers@zsh.org
Subject: zsh 4.3.10 segfaults, bindkey -d related
Message-ID: <20100629191835.GA11829@beaujolais.extremis.net>
Reply-To: George Cox <gjvc@gjvc.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
X-Operating-System: FreeBSD
User-Agent: Mutt/1.5.20 (2009-06-14)

Hi,

I have recently been able to reliably crash zsh 4.3.10 (built via
FreeBSD ports on FreeBSD 8.0-STABLE)  Below is a stack dump I've been
able to collect from the core files.  I've been able to replicate the
first one quite easily.  I first enter an incorrect path, and press
<TAB> for completion, then press any key to continue with input and
boom.

[gjvc@beaujolais] > cd etc/zhs_
<TAB>

[gjvc@beaujolais] > cd etc/zhs/_
corrections (errors: 1)
zsh/      zsh.old/
original:
etc/zhs
<ANY KEY> 

and it crashes

#0  0x283ec44a in keybind () from /usr/local/lib/zsh/4.3.10/zsh/zle.so
#1  0x283ec55a in getkeymapcmd () from /usr/local/lib/zsh/4.3.10/zsh/zle.so
#2  0x283ec7c3 in getkeycmd () from /usr/local/lib/zsh/4.3.10/zsh/zle.so
#3  0x2844588b in cleanup_ () from /usr/local/lib/zsh/4.3.10/zsh/complist.so
#4  0x0808dabe in runhookdef ()
#5  0x28421e20 in after_complete () from /usr/local/lib/zsh/4.3.10/zsh/complete.so
#6  0x28403d49 in listlist () from /usr/local/lib/zsh/4.3.10/zsh/zle.so
#7  0x2840563c in expandorcompleteprefix () from /usr/local/lib/zsh/4.3.10/zsh/zle.so
#8  0x283ff710 in completecall () from /usr/local/lib/zsh/4.3.10/zsh/zle.so
#9  0x283f03ba in execzlefunc () from /usr/local/lib/zsh/4.3.10/zsh/zle.so
#10 0x283f063a in zlecore () from /usr/local/lib/zsh/4.3.10/zsh/zle.so
#11 0x283f0c77 in zleread () from /usr/local/lib/zsh/4.3.10/zsh/zle.so
#12 0x283f297b in getbyte () from /usr/local/lib/zsh/4.3.10/zsh/zle.so
#13 0x0807b7e8 in zleentry ()
#14 0x0807edd1 in ingetc ()
#15 0x0807a407 in casemodify ()
#16 0x08085ba6 in zshlex ()
#17 0x080a2339 in parse_event ()
#18 0x0807d569 in loop ()
#19 0x0807e33e in zsh_main ()
#20 0x08052f62 in main ()

I've tracked this down to the presence of 

    bindkey -d  # delete all existing keymaps and reset to the default state

in my zsh startup files -- if I comment out 'bindkey -d', zsh doesn't
crash.  Hope this helps someone!

best;


gjvc

-- 
George Cox
gjvc@gjvc.com

