From zsh-users-return-13382-mason-zsh=primenet.com.au@sunsite.dk Thu Oct 23 02:37:33 2008
Return-Path: <zsh-users-return-13382-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21029 invoked from network); 23 Oct 2008 02:37:29 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 23 Oct 2008 02:37:29 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 23120 invoked from network); 23 Oct 2008 02:37:19 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 23 Oct 2008 02:37:19 -0000
Received: (qmail 15975 invoked by alias); 23 Oct 2008 02:36:57 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13382
Received: (qmail 19740 invoked from network); 23 Oct 2008 01:36:56 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 23 Oct 2008 01:36:56 -0000
Received: from mpv3.TIS.cwru.edu (mpv3.tis.CWRU.Edu [129.22.105.35])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 027D180524C0
	for <zsh-users@sunsite.dk>; Thu, 23 Oct 2008 03:36:36 +0200 (CEST)
Received: from mpv8.TIS.CWRU.edu (mpv8.tis.CWRU.Edu [129.22.105.116])
	by mpv3.TIS.cwru.edu (MOS 3.10.2-GA)
	with ESMTP id CJQ57293;
	Wed, 22 Oct 2008 21:36:33 -0400 (EDT)
Received: from z4.local (h229.149.31.71.dynamic.ip.windstream.net [71.31.149.229])
	by mpv8.TIS.CWRU.edu (MOS 4.0.4-FCS)
	with ESMTP id CYP94320 (AUTH cpr);
	Wed, 22 Oct 2008 21:36:32 -0400
Message-ID: <48FFD517.80205@case.edu>
Date: Wed, 22 Oct 2008 21:36:23 -0400
From: Chet Ramey <chet.ramey@case.edu>
Reply-To: chet.ramey@case.edu
Organization: ITS, Case Western Reserve University
User-Agent: Thunderbird 2.0.0.17 (Macintosh/20080914)
MIME-Version: 1.0
To: Stephane Chazelas <Stephane_Chazelas@yahoo.fr>
CC: Chet Ramey <chet.ramey@case.edu>, dqarras@yahoo.com,
        zsh-workers+phil.pennock@spodhuis.org,
        ZSH Users <zsh-users@sunsite.dk>, pws@pws-pc.ntlworld.com
Subject: Re: SHELL not always correct
References: <903527.44182.qm@web36808.mail.mud.yahoo.com> <200810212058.m9LKwXQe009278@pws-pc.ntlworld.com> <20081021231323.GA89901@redoubt.spodhuis.org> <48FE9074.5020103@case.edu> <20081022142732.GB4959@sc.homeunix.net>
In-Reply-To: <20081022142732.GB4959@sc.homeunix.net>
X-Enigmail-Version: 0.95.7
Content-Type: text/plain; charset=ISO-8859-15
Content-Transfer-Encoding: 7bit
X-Junkmail-Status: score=10/49, host=mpv3.cwru.edu
X-Junkmail-SD-Raw: score=unknown,
	refid=str=0001.0A09020A.48FFD522.01C0,ss=1,fgs=0,
	ip=71.31.149.229,
	so=2008-08-01 02:07:42,
	dmn=5.7.1/2008-09-02,
	mode=single engine
X-Junkmail-IWF: false
X-Virus-Scanned: ClamAV 0.92.1/8470/Wed Oct 22 17:13:42 2008 on bifrost
X-Virus-Status: Clean

Stephane Chazelas wrote:
> On Tue, Oct 21, 2008 at 10:31:16PM -0400, Chet Ramey wrote:
> [...]
>> Bash used to auto-export SHELL because programs like tset and make
>> still depend on its value.  If the current version sets the value,
>> however, it doesn't export it.
> [...]
> 
> Hi Chet,
> 
> What implementation/version of make uses $SHELL? I thought SHELL
> was meant to be *the* environment variable that make was meant
> *not* to read as it conflicts with its own SHELL variable.

Certainly no modern version of make does, especially since Posix
forbids inheriting SHELL from the environment.

I'm pretty sure that old System V versions of make used SHELL in this
way -- 7th edition didn't need to as it had only one shell, and BSD
inherited this behavior -- but I may be mistaken.  I don't have any
System V makes lying around, but the documentation implies that the
environment is used unless a variable is explicitly assigned a value
in a makefile, and SHELL is not called out as an exception.


> What's the point of setting $SHELL and not exporting it, btw?
> does bash use $SHELL internally or is it just for the benefit of
> .profile/.bashrc?

Bash doesn't use SHELL internally.  It originally used to export SHELL
for the benefit of commands (like tset) that changed their output
depending on the value of $SHELL, but even those programs ended up
checking *sh vs. *csh, and bash quit exporting it with bash-2.05a.

Though Bash never messed with an inherited value for SHELL, if it didn't
find one, we interpreted the Posix standard as allowing setting and
exporting its value -- we set SHELL to the full pathname to a shell
implementing the Posix standard.  I changed it to the user's login
shell for bash-1.13, figuring that was closer to the intended use,
but kept exporting it.

Back in the day, and I'm sure zsh was in the same situation, there
were a lot of bash users whose default shell was csh, because that was
the "system's standard," but preferred to use bash.  In those days, it
was useful to set SHELL to the full pathname of the running version of
bash, but even then bash never overrode an environment variable, and,
as I said above, that stopped after bash-1.12.

I finally decided that auto-exporting SHELL wasn't that great an idea,
and bash-2.05a quit doing that, but it's set to this day.  It's
guaranteed to exist, and users can rely on its presence.

> Do you know of which systems where the SHELL environment
> variable is not set by login/cron/rshd...? On this debian
> system, cron sets it to /bin/sh, rshd/login/kdm to my login
> shell

Maybe not any more, but earlier systems were not quite so predictable.

> Looking around, I see AT&T ksh is the only other shell that sets
> $SHELL.

OK.  Bash does what it does, though, and there's enough backwards
compatibility to leave the current behavior alone.

Chet
-- 
``The lyf so short, the craft so long to lerne.'' - Chaucer

Chet Ramey, ITS, CWRU    chet@case.edu    http://cnswww.cns.cwru.edu/~chet/

