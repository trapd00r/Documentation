From zsh-workers-request@math.gatech.edu  Tue Jul 25 04:05:49 1995
Received: from gatech.edu (gatech.edu [130.207.244.244]) by werple.mira.net.au (8.6.12/8.6.9) with SMTP id EAA28413 for <mason@werple.mira.net.au>; Tue, 25 Jul 1995 04:05:46 +1000
Received: from math (math.skiles.gatech.edu) by gatech.edu with SMTP id AA18002
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Mon, 24 Jul 1995 14:07:15 -0400
Received: by math (5.x/SMI-SVR4)
	id AA08705; Mon, 24 Jul 1995 14:03:39 -0400
Resent-Date: Mon, 24 Jul 1995 13:09:25 +0100 (MET DST)
Old-Return-Path: <hzoli@cs.elte.hu>
From: hzoli@cs.elte.hu (Zoltan Hidvegi)
Message-Id: <9507241802.AA13811@turan.elte.hu>
Subject: Re: Multi-line update problem in zholi10.1
To: wayne@tenor.clarinet.com (Wayne Davison)
Date: Mon, 24 Jul 1995 13:09:25 +0100 (MET DST)
In-Reply-To:  <9507211202.aa02305@tenor.clarinet.com> from "Wayne Davison" at Jul 21, 95 12:02:33 pm
X-Mailer: ELM [version 2.4 PL21]
Content-Type: text
Sender: hzoli@cs.elte.hu
Resent-Message-Id: <"a09GE3.0.t72.w1-4m"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/272
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Wayne Davison wrote:
> 
> There's a problem in zholi10.1 where it will not update the screen
> correctly when inserting characters into the first line of a multi-
> line command.  You have to be using an auto-margin terminal with
> character insert (in my case I'm using an xterm), to see the problem.
> 
> The code that is failing is in refreshline() where it checks if there
> is some space at the end of the line that needs to be cleared.
> Because it is checking the wrong variable (vcs instead of ccs) it
> uses right-cursor to try to move to column 80 (one past the right
> edge) which is not possible -- you can only get to column 80 in a
> terminal like a vt100 by outputing a character in column 79.  This
> causes the moveto() code to fail to advance to the next line, and
> then the screen becomes really messed up.
> 
> I've appended a patch that fixes this problem.  It is possible that
> with this fix the following check for i == 0 isn't needed:
> 
>     /* we've written out the new but yet to clear rubbish due to inserts */
>         if (!*nl) {
>             if ((i = (winw - ccs < char_ins ? winnw - ccs : char_ins)) == 0)
>                 return;
> 
> but I don't know the code well enough to know for sure.

I also noticed this bug but I had no time to debug it. This bug was introduced
by the patch from Geoff Wing (art. 164).  So this patch together with Geoff's
patches shoud go into the baseline as well. Thank you for fixing that.  Geoff
could probably answer your question here.

Zoltan

