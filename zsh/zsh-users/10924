From zsh-users-return-10924-mason-zsh=primenet.com.au@sunsite.dk Fri Nov 03 10:03:11 2006
Return-Path: <zsh-users-return-10924-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14224 invoked from network); 3 Nov 2006 10:03:06 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 3 Nov 2006 10:03:06 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 17390 invoked from network); 3 Nov 2006 10:02:50 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 3 Nov 2006 10:02:50 -0000
Received: (qmail 5937 invoked by alias); 3 Nov 2006 10:02:41 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10924
Received: (qmail 5925 invoked from network); 3 Nov 2006 10:02:40 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 3 Nov 2006 10:02:40 -0000
Received: (qmail 16217 invoked from network); 3 Nov 2006 10:02:40 -0000
Received: from fw.sigpipe.cz (HELO isis.sigpipe.cz) (62.245.70.224)
  by a.mx.sunsite.dk with SMTP; 3 Nov 2006 10:02:37 -0000
Received: from dagan.sigpipe.cz (dagan.sigpipe.cz [10.9.8.90])
	by isis.sigpipe.cz (Postfix) with ESMTP id EA1831F87BF4
	for <zsh-users@sunsite.dk>; Fri,  3 Nov 2006 11:02:35 +0100 (CET)
Received: by dagan.sigpipe.cz (Postfix, from userid 1001)
	id 07D2D2C92A0; Fri,  3 Nov 2006 12:04:50 +0000 (UTC)
Date: Fri, 3 Nov 2006 12:04:50 +0000
From: Roman Neuhauser <neuhauser@sigpipe.cz>
To: zsh-users@sunsite.dk
Subject: Re: "Bookmarked" cvs repositories
Message-ID: <20061103120450.GB44957@dagan.sigpipe.cz>
Mail-Followup-To: zsh-users@sunsite.dk
References: <20061103055730.GB9160@princo>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20061103055730.GB9160@princo>
User-Agent: Mutt/1.5.13 (2006-08-11)

# jrdavid@magma.ca / 2006-11-03 00:57:30 -0500:
> I would like to modify the completion of cvs'
> '-d' option. I created an array like so:
> 
> repositories=( :ext:user@host:/path/to/cvs
>                :ext:user@anotherhost:/path/to/cvs )
> 
> When I type:
> cvs -d<TAB>
> 
> I would like zsh to offer those repositories for
> completion.
> 
> I tried a few things but nothing I did seemed to
> override the _cvs function that comes with the
> distribution.
> 
> Sorry if this is trivial... 

    Well, looking at my 4.2.5/functions/Completion/Unix/_cvs
    I see that _arguments dispatches to _cvs_roots for the -d argument.
    The only obvious customization mechanisms I see there are the
    $CVS_PASSFILE variable or complete redefinition.

    (( $+functions[_cvs_root] )) ||
    _cvs_root() {
      local cvspassfile id slash
      
      typeset -gU _cvs_roots
      
      if [[ -f "${cvspassfile::=${CVS_PASSFILE:-$HOME/.cvspass}}" ]]; then
        if _cvs_loadstat; then
          id="$(LC_ALL=C builtin stat -g +mtime -F '%Y/%m/%d-%T' "$cvspassfile")"
        else
          id="$(LC_ALL=C ls -l "$cvspassfile")"
        fi
        if [[ "$id" != "$_cvs_pass_id" ]]; then
          slash=/
          _cvs_roots=($_cvs_roots ${${${${(f)"$(<$cvspassfile)"}#/1 }%% *}/:2401${slash}/:/})
          _cvs_pass_id="$id"
        fi
      fi
      
      _tags files && {
        compadd -M 'r:|[:@./]=** r:|=**' "$@" -a _cvs_roots || {
          compset -P ':(local|fork):'; _files "$@" -W / -/
        }
      }
    }


-- 
How many Vietnam vets does it take to screw in a light bulb?
You don't know, man.  You don't KNOW.
Cause you weren't THERE.             http://bash.org/?255991

