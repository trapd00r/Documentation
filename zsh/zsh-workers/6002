From zsh-workers-return-6002-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Apr 02 11:15:05 1999
Return-Path: <zsh-workers-return-6002-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27576 invoked from network); 2 Apr 1999 11:15:04 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 2 Apr 1999 11:15:04 -0000
Received: (qmail 14881 invoked by alias); 2 Apr 1999 11:14:54 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6002
Received: (qmail 14872 invoked from network); 2 Apr 1999 11:14:47 -0000
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <990402031321.ZM1039@candle.brasslantern.com>
Date: Fri, 2 Apr 1999 03:13:21 -0800
In-Reply-To: <990402023951.ZM769@candle.brasslantern.com>
Comments: In reply to "Bart Schaefer" <schaefer@candle.brasslantern.com>
        "Re: bar='#pat'; ${foo/$bar/...} problem" (Apr  2,  2:39am)
References: <002e01be7c48$968d8860$21c9ca95@mowp.siemens.ru> 
	<990402023951.ZM769@candle.brasslantern.com>
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: "ZSH workers mailing list" <zsh-workers@sunsite.auc.dk>
Subject: PATCH: 3.1.5-pws-14: Re: bar='#pat'; ${foo/$bar/...} problem
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Apr 2,  2:39am, Bart Schaefer wrote:
} Subject: Re: bar='#pat'; ${foo/$bar/...} problem
}
} Now, you might argue that the implementation of /# and /% should be as
} if # and % are extensions of the glob syntax

Index: Src/subst.c
===================================================================
--- subst.c	1999/03/29 21:45:50	1.22
+++ subst.c	1999/04/02 11:06:21
@@ -1361,7 +1361,19 @@
 			 NULL, s[-1]);
 		    return NULL;
 		}
-	    singsub(&s);
+	    {
+		char t = s[-1];
+
+		singsub(&s);
+		if (t == '/' && (flags & SUB_SUBSTR)) {
+		    if (*s == '#' || *s == '%') {
+			flags &= ~SUB_SUBSTR;
+			if (*s == '%')
+			    flags |= SUB_END;
+			s++;
+		    }
+		}
+	    }
 
 	    if (!vunset && isarr) {
 		char **ap = aval;

} (Did I get to be article 6000? :-)

(Hopefully, I did a better job of patching than I did of noticing which
message's headers I was reading the X-Seq: from.  Hard to be 6000 when
that's the one you're replying to.)

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

