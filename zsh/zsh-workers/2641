From zsh-workers-request@euclid.skiles.gatech.edu Thu Dec 26 23:24:57 1996
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 16481 invoked from network); 26 Dec 1996 23:24:55 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 26 Dec 1996 23:24:55 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id SAA20621; Thu, 26 Dec 1996 18:25:21 -0500 (EST)
Resent-Date: Thu, 26 Dec 1996 18:25:21 -0500 (EST)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199612262321.AAA07077@hzoli.ppp.cs.elte.hu>
Subject: More Makefile improvements
To: zsh-workers@math.gatech.edu (Zsh hacking and development)
Date: Fri, 27 Dec 1996 00:21:37 +0100 (MET)
X-Mailer: ELM [version 2.4ME+ PL17 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"rxLgj1.0.825.Wbmmo"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2641
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

This patch removes some unnecessary recursive make calls.

It depends probably on all Makefile.in patches that Zefram and myself
posted to the list before.

Zoltan


*** Src/Makefile.in	1996/12/26 21:46:52	3.1.1.7
--- Src/Makefile.in	1996/12/26 22:16:47
***************
*** 166,178 ****
  # default target
  all: bin modules
  
! modules: proto $(HDRS) $(ANSI@U@KNR)
! 	@test -z '$(MO@D@ULE_DIRS)' || $(MAKE) $(MAKEDEFS) $(MODULE_DIRS)
  
! bin: proto $(ANSI@U@KNR)
  	@$(MAKE) $(MAKEDEFS) zsh
  
! zsh: $(@L@IBZSH) $(@L@OBJS) $(@L@STMP)
  	$(LINK) $(@L@OBJS) $(@L@LIST) $(LIBS)
  
  $(LIBZSH): $(LIBOBJS) $(NSTMP)
--- 166,177 ----
  # default target
  all: bin modules
  
! modules: $(MO@D@ULE_DIRS)
  
! bin: proto $(HDRS) $(ANSI@U@KNR)
  	@$(MAKE) $(MAKEDEFS) zsh
  
! zsh: $(PROTO) $(@L@IBZSH) $(@L@OBJS) $(@L@STMP)
  	$(LINK) $(@L@OBJS) $(@L@LIST) $(LIBS)
  
  $(LIBZSH): $(LIBOBJS) $(NSTMP)
***************
*** 197,204 ****
  
  init.o: bltinmods.list zshpaths.h zshxmods.h
  
! $(MODULE_DIRS): FORCE
! 	@cd $@ && $(MAKE) $(MAKEDEFS) modules
  
  zshpaths.h: FORCE
  	@echo '#define MODULE_DIR "'$(MODDIR)'"' > zshpaths.h.tmp
--- 196,203 ----
  
  init.o: bltinmods.list zshpaths.h zshxmods.h
  
! $(MODULE_DIRS): proto $(HDRS) $(ANSI@U@KNR) FORCE
! 	@cd $@ && $(MAKE) $(MAKEDEFS) shobjs
  
  zshpaths.h: FORCE
  	@echo '#define MODULE_DIR "'$(MODDIR)'"' > zshpaths.h.tmp
*** Src/Modules/Makefile.in	1996/12/26 21:46:52	3.1.1.5
--- Src/Modules/Makefile.in	1996/12/26 21:48:46
***************
*** 107,113 ****
  all: modules
  
  modules: proto
! 	@$(MAKE) $(MAKEDEFS) $(MODULES)
  
  proto: $(PROTO)
  
--- 107,115 ----
  all: modules
  
  modules: proto
! 	@$(MAKE) $(MAKEDEFS) shobjs
! 
! shobjs: $(MODULES)
  
  proto: $(PROTO)
  
*** Src/Zle/Makefile.in	1996/12/26 21:46:52	3.1.1.5
--- Src/Zle/Makefile.in	1996/12/26 21:48:46
***************
*** 120,126 ****
  all: modules
  
  modules: proto
! 	@$(MAKE) $(MAKEDEFS) $(MODULES)
  
  zle.so: $(ZLEDOBJS)
  	$(DLLINK) $(ZLEDOBJS)
--- 120,128 ----
  all: modules
  
  modules: proto
! 	@$(MAKE) $(MAKEDEFS) shobjs
! 
! shobjs: $(MODULES)
  
  zle.so: $(ZLEDOBJS)
  	$(DLLINK) $(ZLEDOBJS)

