From zsh-workers-request@euclid.skiles.gatech.edu Thu Feb 27 15:14:01 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 13244 invoked from network); 27 Feb 1997 15:14:00 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 27 Feb 1997 15:14:00 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id KAA10071; Thu, 27 Feb 1997 10:02:56 -0500 (EST)
Resent-Date: Thu, 27 Feb 1997 10:02:24 -0500 (EST)
Message-Id: <199702271502.KAA09977@euclid.skiles.gatech.edu>
Date: 27 Feb 1997 09:37 EST
Sender: "Alain Caron" <alainc@nortel.ca>
To: schaefer@nbn.com
Cc: jrj@chsft.com, zsh-users@math.gatech.edu
From: "Alain Caron" <alainc@nortel.ca>
Subject: Re: problem with GNU Emacs shell mode
MIME-version: 1.0
Content-type: text/plain; charset="ISO-8859-1"
Content-transfer-encoding: quoted-printable
Resent-Message-ID: <"PXr7u2.0.5S2._7Q5p"@euclid>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/723
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

In message "Re: problem with GNU Emacs shell mode",
'schaefer@nbn.com' writes:

>On Feb 26,  2:00pm, Jerry Jackson wrote:
>> Subject: problem with GNU Emacs shell mode
>>
>> I've been using zsh for a long time but when GNU Emacs changed
>> comint mode around version 19.2x - 19.3x I started getting a lot
>> of spurious ^M's in my buffer.  I couldn't figure out how to fix
>> it and I reverted to Emacs version 19.21 for years.
>
>Ouch!  Why didn't you ask sooner?
>
>> Has anyone figured out how to fix this problem?
>
>Emacs 19.29 or thereabouts stopped using a terminal type of "emacs"
>in shell buffers, and instead sets it to "dumb".  Zsh only kicks in
>its special I'm-inside-emacs initialization when the terminal type
>is "emacs".

Emacs sets the EMACS environment variable to "t" in shell buffers.

Maybe ZSH should also kick its "I'm-inside-emacs" initialization when
the EMACS variable is set to "t".

>
>Placing a
>
>(setenv "TERM" "emacs")
>
>in your ~/.emacs file seems to fix this.  If that confuses other programs
>that are run from within emacs, you can instead use
>
>(setenv "ESHELL" "~/bin/eshell")
>
>and then put "TERM=3Demacs exec zsh" in the file ~/bin/eshell.
>

Another solution, is to put sthe following in your .zshrc


if [[ "$TERM" =3D=3D "xterm"]]; then

   # initialization for an xterm
   ...


elif [[ "$EMACS" =3D=3D "t" ]]; then

  # initialization for an emacs shell-buffer

  unsetopt zle
  ...

elsif [[ "${TERM%%-em[0-9]#}" =3D=3D "emacs" ]]; then
   # running zsh under the emacs terminal-emulator...
   ...
else
   # default initialization: probably a vt100 emulator when dialing
   # from home.
   ...
fi

I prefer this solution to the ones you proposed but this probably is a
matter of taste.


Alain Caron
Nortel Technology, Montr=E9al, Qu=E9bec, Canada
email: alainc@nortel.ca
phone: 514-765-7718

