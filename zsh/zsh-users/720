From zsh-workers-request@euclid.skiles.gatech.edu Thu Feb 27 06:12:00 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 10761 invoked from network); 27 Feb 1997 06:11:59 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 27 Feb 1997 06:11:59 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id BAA01845; Thu, 27 Feb 1997 01:00:07 -0500 (EST)
Resent-Date: Thu, 27 Feb 1997 00:56:38 -0500 (EST)
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <970226172226.ZM17479@candle.brasslantern.com>
Date: Wed, 26 Feb 1997 17:22:26 -0800
In-Reply-To: Jerry Jackson <jrj@chsft.com>
        "problem with GNU Emacs shell mode" (Feb 26,  2:00pm)
References: <3314A483.315A215C@chsft.com>
Reply-To: schaefer@nbn.com
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: Jerry Jackson <jrj@chsft.com>, zsh-users@math.gatech.edu
Subject: Re: problem with GNU Emacs shell mode
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"93N0I3.0.HO.M8I5p"@euclid>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/720
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On Feb 26,  2:00pm, Jerry Jackson wrote:
> Subject: problem with GNU Emacs shell mode
> 
> I've been using zsh for a long time but when GNU Emacs changed 
> comint mode around version 19.2x - 19.3x I started getting a lot
> of spurious ^M's in my buffer.  I couldn't figure out how to fix
> it and I reverted to Emacs version 19.21 for years.

Ouch!  Why didn't you ask sooner?

> Has anyone figured out how to fix this problem?

Emacs 19.29 or thereabouts stopped using a terminal type of "emacs"
in shell buffers, and instead sets it to "dumb".  Zsh only kicks in
its special I'm-inside-emacs initialization when the terminal type
is "emacs".

Placing a

(setenv "TERM" "emacs")

in your ~/.emacs file seems to fix this.  If that confuses other programs
that are run from within emacs, you can instead use

(setenv "ESHELL" "~/bin/eshell")

and then put "TERM=emacs exec zsh" in the file ~/bin/eshell.

