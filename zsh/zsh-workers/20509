From zsh-workers-return-20509-mason-zsh=primenet.com.au@sunsite.dk Fri Oct 22 12:26:21 2004
Return-Path: <zsh-workers-return-20509-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8870 invoked from network); 22 Oct 2004 12:26:19 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 22 Oct 2004 12:26:19 -0000
Received: (qmail 2773 invoked from network); 22 Oct 2004 12:26:09 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 22 Oct 2004 12:26:09 -0000
Received: (qmail 26836 invoked by alias); 22 Oct 2004 12:25:53 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20509
Received: (qmail 21540 invoked from network); 22 Oct 2004 12:09:50 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 22 Oct 2004 12:09:50 -0000
Received: (qmail 96012 invoked from network); 22 Oct 2004 12:09:47 -0000
Received: from david.siemens.de (192.35.17.14)
  by a.mx.sunsite.dk with SMTP; 22 Oct 2004 12:09:44 -0000
Received: from mail3.siemens.de (mail3.siemens.de [139.25.208.14])
	by david.siemens.de (8.12.6/8.12.6) with ESMTP id i9MC9hBO030143
	for <zsh-workers@sunsite.dk>; Fri, 22 Oct 2004 14:09:44 +0200
Received: from mowp006a.ww600.siemens.net (mowp006a.ww600.siemens.net [163.242.192.6])
	by mail3.siemens.de (8.12.6/8.12.6) with ESMTP id i9MC9hBO021817
	for <zsh-workers@sunsite.dk>; Fri, 22 Oct 2004 14:09:43 +0200
Received: by mowp006a.ww600.siemens.net with Internet Mail Service (5.5.2657.72)
	id <VF14AGDT>; Fri, 22 Oct 2004 16:09:43 +0400
Message-ID: <66F451E8923A3D42B22434287141E2E301E0F2C8@mowp006a.ww600.siemens.net>
From: Borzenkov Andrey <Andrey.Borzenkov@siemens.com>
To: zsh-workers@sunsite.dk
Subject: [PATCH] fix portability bug in 
Date: Fri, 22 Oct 2004 16:09:41 +0400
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2657.72)
Content-Type: multipart/mixed;
	boundary="----_=_NextPart_000_01C4B830.02A86B64"
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_44 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0

This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_000_01C4B830.02A86B64
Content-Type: text/plain

Hi, long time have not been here :)

The patch from 20025 does not allow configure to run here because

- here /bin/sh (or /bin/ksh, does not matter) do not have SIGTTOU but just
TTOU so 'trap "" SIGTTOU' is an error

- according to SUS (Shell Command Language, 2.8.1) trap is special builtin
so non-zero exit code makes scripting shell immediately exit; the "trap ||
:" does not help.

The patch attempts to "fix" while still leaving trap in place. I do not know
why it is needed so I did not add "trap TTOU" (for my system :) In general
this looks rather inherently non-portable so the best way would be to get
rid of this trap at all (default for SIGTTOU is ignore anyway).

Please check if it still works for original problem.

Regards

-andrey



------_=_NextPart_000_01C4B830.02A86B64
Content-Type: application/octet-stream;
	name="configure.ac.diff"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename="configure.ac.diff"

Index: configure.ac=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /cvsroot/zsh/zsh/configure.ac,v=0A=
retrieving revision 1.21=0A=
diff -u -r1.21 configure.ac=0A=
--- configure.ac	8 Oct 2004 14:36:54 -0000	1.21=0A=
+++ configure.ac	22 Oct 2004 11:40:54 -0000=0A=
@@ -1804,7 +1804,7 @@=0A=
 if test "x$ac_cv_func_tcsetpgrp" =3D xyes; then=0A=
 case "x$zsh_working_tcsetpgrp" in=0A=
   xcheck)=0A=
-    trap "" SIGTTOU > /dev/null 2>&1 || :=0A=
+    ( trap "" SIGTTOU > /dev/null 2>&1 ) && trap "" SIGTTOU > =
/dev/null 2>&1 =0A=
     AC_CACHE_CHECK(if tcsetpgrp() actually works,=0A=
     zsh_cv_sys_tcsetpgrp,=0A=
     [AC_TRY_RUN([=0A=
@@ -1835,7 +1835,7 @@=0A=
 Try running configure with --with-tcsetpgrp or =
--without-tcsetpgrp]);;=0A=
       *)      AC_MSG_ERROR([unexpected return status]);;=0A=
     esac=0A=
-    trap - SIGTTOU > /dev/null 2>&1 || :=0A=
+    ( trap - SIGTTOU > /dev/null 2>&1 ) && trap - SIGTTOU > /dev/null =
2>&1 =0A=
     ;;=0A=
   xyes) :;;=0A=
   xno)  AC_DEFINE(BROKEN_TCSETPGRP);;=0A=

------_=_NextPart_000_01C4B830.02A86B64--

