From zsh-workers-request@euclid.skiles.gatech.edu Fri Jan 31 09:02:22 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 1566 invoked from network); 31 Jan 1997 09:02:20 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 31 Jan 1997 09:02:20 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id DAA07379; Fri, 31 Jan 1997 03:51:31 -0500 (EST)
Resent-Date: Fri, 31 Jan 1997 03:51:31 -0500 (EST)
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <970131005748.ZM17602@candle.brasslantern.com>
Date: Fri, 31 Jan 1997 00:57:48 -0800
In-Reply-To: Yoshiaki Kasahara <kasahara@nc.kyushu-u.ac.jp>
        "zsh stty control for background processes" (Jan 31,  2:54pm)
References: <19970131145414W/kasahara@nc.kyushu-u.ac.jp>
Reply-To: schaefer@nbn.com
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: Yoshiaki Kasahara <kasahara@nc.kyushu-u.ac.jp>,
        zsh-workers@math.gatech.edu
Subject: Re: zsh stty control for background processes
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"M98Qi2.0.Ep1.IARyo"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2850
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On Jan 31,  2:54pm, Yoshiaki Kasahara wrote:
} Subject: zsh stty control for background processes
}
} When I invoked 'xterm &', new shell in the xterm forget some of stty
} control characters.

This isn't exactly a shell bug; it's partly an xterm bug.  It results
when xterm copies stty information from the system console, which may
not have been set up correctly before X11 (OpenWindows) started up on it
when you first logged in.  (Or it may be that you're on a remote display,
and the xterm is getting whatever settings some other process applied to
the system console.)

} It is ok if xterm is invoked on foreground.

It's OK then because the foreground xterm can still open a controlling
tty (that of the parent shell) from which to copy the settings.

} This problem never occurs on tcsh, csh, or sh.

I've seen it happen with shells other than zsh, usually when running some
non-shell program with `xterm -e ...'.  There may be something about the
way zsh spawns background jobs that makes it more likely.

There are several possible workarounds:

If you have a modern version of xterm, there is a resource XTerm*ttyModes
that you can use to specify stty settings for all xterms that start up.
That resource was created for this problem; it is the best solution.

In your shell initialization files, force the console to have sane stty
values before you start openwin.  This may not work if openwin itself
is what's messing up the console settings, or if you're logging in via
a remote display.

Start all xterms as login shells (XTerm*loginShell: true, I believe),
so .zlogin gets read (I presume you have stty commands there for your
initial login terminal settings).  This may be undesirable, and won't
help for `xterm -e ...' where the xterm is not running a zsh.

Put a test `[[ -t 0 ]] && stty ...' in your .zshenv, to force the settings
be sane for any zsh that starts with a terminal as standard input.  This
won't work for `xterm -e ...' either.

-- 
Bart Schaefer                             Brass Lantern Enterprises
http://www.well.com/user/barts            http://www.nbn.com/people/lantern

