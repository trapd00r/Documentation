From zsh-workers-return-9283-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Jan 10 09:15:04 2000
Return-Path: <zsh-workers-return-9283-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24033 invoked from network); 10 Jan 2000 09:15:03 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 10 Jan 2000 09:15:03 -0000
Received: (qmail 20221 invoked by alias); 10 Jan 2000 09:14:56 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9283
Received: (qmail 20214 invoked from network); 10 Jan 2000 09:14:56 -0000
Date: Mon, 10 Jan 2000 10:14:55 +0100 (MET)
Message-Id: <200001100914.KAA25275@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Peter Stephenson's message of Sun, 09 Jan 2000 18:44:37 +0000
Subject: Re: core dump with autoloading failure.


Peter Stephenson wrote:

> Tanaka Akira wrote:
> > zsh dumps core as follows:
> > 
> > Z:akr@thorax% Src/zsh -f
> > thorax% bindkey -e; autoload -U compinit; compinit -D 
> > thorax% compdef _xxx xxx; autoload -U _xxx
> > thorax% xxx 
> > _xxx: _xxx: function definition file not found
> > zsh: segmentation fault (core dumped)  Src/zsh -f
> 
> My guess is this.  Sven, are there are any more like this?

Dunno how I overlooked that one.

I found another problem in hrealloc() at the weekend.

As far as I can see by looking through the code this should be ok now.

Bye
 Sven

diff -ru ../z.old/Src/mem.c Src/mem.c
--- ../z.old/Src/mem.c	Mon Jan 10 10:07:45 2000
+++ Src/mem.c	Mon Jan 10 10:08:39 2000
@@ -441,6 +441,7 @@
 #endif
 	    return NULL;
 	}
+#ifndef USE_MMAP
 	if (old > HEAP_ARENA_SIZE || new > HEAP_ARENA_SIZE) {
 	    size_t n = HEAP_ARENA_SIZE > new ? HEAPSIZE : new + sizeof(*h);
 
@@ -451,6 +452,7 @@
 	}
 	h->used = new;
 	return arena(h);
+#endif
     }
     DPUTS(h->used > HEAP_ARENA_SIZE, "BUG: hrealloc at invalid address");
     if (h->used + (new - old) <= HEAP_ARENA_SIZE) {

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

