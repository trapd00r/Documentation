From zsh-users-return-11201-mason-zsh=primenet.com.au@sunsite.dk Fri Feb 16 03:30:19 2007
Return-Path: <zsh-users-return-11201-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10062 invoked from network); 16 Feb 2007 03:30:17 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.8 (2007-02-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO
	autolearn=ham version=3.1.8
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Feb 2007 03:30:17 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 92694 invoked from network); 16 Feb 2007 03:30:09 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Feb 2007 03:30:09 -0000
Received: (qmail 14585 invoked by alias); 16 Feb 2007 03:29:59 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11201
Received: (qmail 14576 invoked from network); 16 Feb 2007 03:29:59 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 16 Feb 2007 03:29:59 -0000
Received: (qmail 91257 invoked from network); 16 Feb 2007 03:29:59 -0000
Received: from vms048pub.verizon.net (206.46.252.48)
  by a.mx.sunsite.dk with SMTP; 16 Feb 2007 03:29:52 -0000
Received: from torch.brasslantern.com ([71.116.79.148])
 by vms048.mailsrvcs.net (Sun Java System Messaging Server 6.2-6.01 (built Apr
 3 2006)) with ESMTPA id <0JDJ00NI2DPE2RV6@vms048.mailsrvcs.net> for
 zsh-users@sunsite.dk; Thu, 15 Feb 2007 21:29:39 -0600 (CST)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id l1G3TbTK028678	for
 <zsh-users@sunsite.dk>; Thu, 15 Feb 2007 19:29:38 -0800
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id l1G3TbY0028677	for zsh-users@sunsite.dk; Thu,
 15 Feb 2007 19:29:37 -0800
Date: Thu, 15 Feb 2007 19:29:37 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: All functions are equal...or ?
In-reply-to: <20070215.043854.25918985.Meino.Cramer@gmx.de>
To: zsh-users@sunsite.dk
Message-id: <070215192937.ZM28676@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <20070215.043854.25918985.Meino.Cramer@gmx.de>
Comments: In reply to Meino Christian Cramer <Meino.Cramer@gmx.de>
 "All functions are equal...or ?" (Feb 15,  4:38am)

On Feb 15,  4:38am, Meino Christian Cramer wrote:
>
> lww () {
[...]
>                 cmdarray=("${(f)$(whence -pa $1)}")

At this point you have assigned to the global array $cmdarray.

>                 echo ${#cmdarray}                     ## 1
>                 echo ${(F)cmdarray}
>                 typeset -U cmdarray

"typeset" is equivalent to "local" when it appears within the body
of a function, so now you have created a new local scalar (not array)
which hides the global array.  That scalar has the "unique" property,
but that's meaningless for scalars.

If you wanted to apply the "unique" property to the existing global
array, you'd need to do

                  typeset -g -U cmdarray

>                 echo ${#cmdarray}                     ## 2
>                 echo ${(F)cmdarray}
>                 cmdarray=(${(o)cmdarray})

Now you've changed the type of the local scalar to array.  This would
cause the "unique" property to take effect, except that it's an empty
array (because the existing scalar referenced by ${(o)cmdarray} has
never been assigned a value).

[...]
> }

Does this clear things up?  You're always better off declaring your
variables, even though the shell language doesn't require it.

