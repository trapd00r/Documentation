From zsh-workers-return-10974-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Apr 27 12:04:58 2000
Return-Path: <zsh-workers-return-10974-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16116 invoked from network); 27 Apr 2000 12:04:46 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 27 Apr 2000 12:04:46 -0000
Received: (qmail 18687 invoked by alias); 27 Apr 2000 12:04:35 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10974
Received: (qmail 18676 invoked from network); 27 Apr 2000 12:04:34 -0000
Date: Thu, 27 Apr 2000 14:04:17 +0200 (MET DST)
Message-Id: <200004271204.OAA14543@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Thu, 27 Apr 2000 15:48:14 +0400
Subject: PATCH: Re: _configure cacheing


Andrej Borsenkow wrote:

> I've done ./configure --wTAB in zsh top level directory, got "completing
> no argument" - nice - changed to samba directory - and found, that
> ./configure --wTAB is still using cached arguments from  zsh's
> configure.

How weird. A very old bug, we shouldn't only test if we have to
prepend $PWD, we should also do it, in the right parameter.

Can't think of a better test for when we have to prepend $PWD.

> May be, it is related to the fact, that the first time nothing was
> completed?

Eh? Our configure has no options starting with `--w' or, more
precisely, they are all listed as `--enable-...'.

Bye
 Sven

Index: Completion/Base/_arguments
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Base/_arguments,v
retrieving revision 1.6
diff -u -r1.6 _arguments
--- Completion/Base/_arguments	2000/04/27 09:36:51	1.6
+++ Completion/Base/_arguments	2000/04/27 12:01:52
@@ -17,7 +17,7 @@
   fi
 
   name=${~words[1]}
-  [[ "$name" != /* ]] && tmp="$PWD/$name"
+  [[ "$name" = [^/]*/* ]] && name="$PWD/$name"
 
   name="_args_cache_${name}"
   name="${name//[^a-zA-Z0-9_]/_}"

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

