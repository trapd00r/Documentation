From zsh-workers-return-8220-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Oct 12 09:31:51 1999
Return-Path: <zsh-workers-return-8220-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5204 invoked from network); 12 Oct 1999 09:31:50 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 12 Oct 1999 09:31:50 -0000
Received: (qmail 27766 invoked by alias); 12 Oct 1999 09:31:37 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8220
Received: (qmail 27759 invoked from network); 12 Oct 1999 09:31:36 -0000
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Date: Tue, 12 Oct 1999 05:31:19 -0400 (EDT)
From: Kevin Sullivan <kevins@mediaone.net>
To: wischnow@informatik.hu-berlin.de
Cc: zsh-workers@sunsite.auc.dk
Subject: Re: _rpm crashes zsh
In-Reply-To: <199910120855.KAA05195@beta.informatik.hu-berlin.de>
References: <199910120855.KAA05195@beta.informatik.hu-berlin.de>
X-Mailer: VM 6.43 under 20.4 "Emerald" XEmacs  Lucid
Message-ID: <14338.64821.158127.536658@kevins>

Sven Wischnowsky writes:
> 
> Kevin Sullivan wrote:
> 
> > I was very happy when I saw the _rpm completion widget show up in the
> > recent distributions. However, I am having a problem with it. One of
> > the ways that I use rpm is to get information about a specific rpm I
> > have in the current directory with:
> > 
> > rpm -qip <rpm name> 
> > 
> > But instead of looking for local packages it simply crashes. I have
> > included a gdb traceback of the problem. 
> >
> > ...
> > 
> > I am using Mandrake 6.0 Linux and a straight non-patched version of
> > zsh-3.1.6-pws-6. If there is any more information I can provide let
> > me know. 
> 
> Either I accidentally deleted a mail or there wasn't a reply to
> this...
> 
> I tried but couldn't reproduce this with my pws-6 plus the 40+ patches 
> that appeared in the last weeks. Maybe this is fixed by Bart's 8151?
> (At least it looks like a memory problem...)
> 

Having not gotten an answer to the query I set off to figure it out
myself. I have a plain pws-6 version. Perhaps I should try Bart's 8151 
but in any event let me tell you what I found out. 

During the config process I enabled: --enable-zsh-mem
--enable-zsh-secure-free --enable-zsh-mem-warning --enable-zsh-debug
and --enable-zsh-mem-debug. 

When I fired up zsh and attempted:

my_prompt_here> rpm -q My<TAB> 

I got this error/warning message: 'BUG: attempt to free already free
storage'

So I fired up gdb put a break at mem.c:977 and mem.c:1054 but for some 
reason I was unable to get it to repeat under gdb.. Well I ran out of
time and was happy with simply enabling --enable-zsh-mem and
--enable-zsh-secure-free. I wanted to get a stack trace when I got 
to the DPUTS warning message, but... 

I believe the error message I was seeing was coming from 977 but I
have not verified this. 

Thanks, in any event I will try the 8151 patch... 

-Kevin Sullavin

