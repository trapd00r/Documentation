From zsh-workers-return-11642-mason-zsh=primenet.com.au@sunsite.auc.dk Mon May 29 22:47:44 2000
Return-Path: <zsh-workers-return-11642-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14878 invoked from network); 29 May 2000 22:47:43 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 29 May 2000 22:47:43 -0000
Received: (qmail 7675 invoked by alias); 29 May 2000 22:47:33 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11642
Received: (qmail 7668 invoked from network); 29 May 2000 22:47:31 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000529224721.ZM10474@candle.brasslantern.com>
Date: Mon, 29 May 2000 22:47:21 +0000
In-Reply-To: <Pine.GSO.4.21.0005291411310.22792-100000@house.clari.net>
Comments: In reply to Wayne Davison <wayne@clari.net>
        "Re: History still coredumping after "print -s" during completion" (May 29,  2:30pm)
References: <Pine.GSO.4.21.0005291411310.22792-100000@house.clari.net>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Wayne Davison <wayne@clari.net>
Subject: Re: History still coredumping after "print -s" during completion
Cc: zsh-workers@sunsite.auc.dk
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On May 29,  2:30pm, Wayne Davison wrote:
} Subject: Re: History still coredumping after "print -s" during completion
}
}  + It tweaks execzlefunc() so that, when it calls a completion
}    widget, it ensures that if we were at curline, we're still at
}    curline.  This change assumes that completion never causes us to
}    change to a different history line.  If this is not true, we'll
}    need a different fix.

Completion shouldn't ever cause us to change to a different history line,
but an ordinary ZLE widget might.

    foo() {
      zle up-line-or-history
      print -s "Hi there"
      zle down-line-or-history
    }
    zle -N foo
    bindkey ^Xj foo

} With these changes, your example now works right:
} 
} % ls <C-x?><C-n>
} 
} This will now fail to move downward (since there's nowhere to go),
} and a <C-p> will show you the newly-added history line.

Yay!  Thanks, Wayne.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

