From zsh-workers-return-20477-mason-zsh=primenet.com.au@sunsite.dk Wed Oct 13 06:42:17 2004
Return-Path: <zsh-workers-return-20477-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13823 invoked from network); 13 Oct 2004 06:42:16 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 13 Oct 2004 06:42:16 -0000
Received: (qmail 3037 invoked from network); 13 Oct 2004 06:42:08 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 13 Oct 2004 06:42:08 -0000
Received: (qmail 13481 invoked by alias); 13 Oct 2004 06:41:56 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20477
Received: (qmail 13467 invoked from network); 13 Oct 2004 06:41:55 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 13 Oct 2004 06:41:55 -0000
Received: (qmail 2754 invoked from network); 13 Oct 2004 06:41:55 -0000
Received: from moonbase.zanshin.com (64.84.47.139)
  by a.mx.sunsite.dk with SMTP; 13 Oct 2004 06:41:54 -0000
Received: from toltec.zanshin.com (toltec.zanshin.com [64.84.47.166])
	by moonbase.zanshin.com (8.13.1/8.13.1) with ESMTP id i9D6fqqS002778
	for <zsh-workers@sunsite.dk>; Tue, 12 Oct 2004 23:41:52 -0700
Date: Tue, 12 Oct 2004 23:41:52 -0700 (PDT)
From: Bart Schaefer <schaefer@brasslantern.com>
Reply-To: zsh-workers@sunsite.dk
To: zsh-workers@sunsite.dk
Subject: Re: characters not added in _rsync completion
In-Reply-To: <20041013054015.GA824@blorf.net>
Message-ID: <Pine.LNX.4.61.0410122330050.17741@toltec.zanshin.com>
References: <20041013054015.GA824@blorf.net>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

On Tue, 12 Oct 2004, Wayne Davison wrote:

> zsh sometimes fails to add all the common characters that it should
> when completing an ambiguous option.
[...]
> (Note that two of those require a very recent rsync that has the
> --checksum-seed and --partial-dir options, otherwise there would
> be only one option to complete.)

I'm puzzled why the version of rsync itself makes any difference, because 
_rsync specifies everything explicitly, so unless you've edited _rsync it 
won't ever complete those options.  Does Debian come with an updated 
_rsync for which a patch has not been posted back to zsh-workers?

Similarly, I have only --links and nothing else that matches --link.
However, I can reproduce this for several of the others that you list:

> rsync --com<TAB>   # should add "p"
> rsync --par<TAB>   # should add "tial"
> rsync --ti<TAB>    # should add "me"

Yet this one works for me:

> rsync --no<TAB>    # should add "-"

(That is, I do get "-" added when completing there.)

> Would anyone care to look into this?

Without plunging into the why of it, a cursory inspection seems to 
indicate that when an option has an argument (e.g., --compa completes to 
--compare-dest= with the trailing equal sign) then zsh fails to find the 
longest common prefix among that option and any other options that do NOT 
have arguments (as --compress does not).  All the cases that fail appear 
to have at least one option with, and at least one without, an argument.

