From zsh-users-return-14771-mason-zsh=primenet.com.au@zsh.org Tue Feb 02 17:06:38 2010
Return-Path: <zsh-users-return-14771-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7344 invoked by alias); 2 Feb 2010 17:06:37 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14771
Received: (qmail 910 invoked from network); 2 Feb 2010 17:06:36 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at seiken.de does not designate permitted sender hosts)
From: Joke de Buhr <joke@seiken.de>
Organization: http://www.seiken.de/
To: zsh-users@zsh.org
Subject: Re: Want to replace bash w zsh as system shell on Ubuntu
Date: Tue, 2 Feb 2010 18:06:18 +0100
User-Agent: KMail/1.12.2 (Linux/2.6.31-17-generic; KDE/4.3.2; x86_64; ; )
References: <20100202081546.GA5930@panix.com> <201002021250.17528.joke@seiken.de> <87r5p3ke48.fsf@ft.bewatermyfriend.org>
In-Reply-To: <87r5p3ke48.fsf@ft.bewatermyfriend.org>
MIME-Version: 1.0
Content-Type: multipart/signed;
  boundary="nextPart1339495.1lkbNVzia2";
  protocol="application/pgp-signature";
  micalg=pgp-sha1
Content-Transfer-Encoding: 7bit
Message-Id: <201002021806.25016.joke@seiken.de>

--nextPart1339495.1lkbNVzia2
Content-Type: Text/Plain;
  charset="utf-8"
Content-Transfer-Encoding: quoted-printable

On Tuesday 02 February 2010 13:37:27 Frank Terbeck wrote:
> But $(...) is perfectly correct syntax in POSIX shells. You may be
> confused here, because older bourne shells don't support this. Shells
> that adhere the standard, however, do.

You're right. I thing the $(<file) cat-replacement was not transfered to po=
six=20
shells.

> Yeah, it's also funny to suddenly end up with a number of your files
> being owned by root (shouldn't happen with zsh's history file, since zsh
> keeps track of the file's permissions even with the HIST_SAVE_BY_COPY
> option enabled - which is the default; but not everything is as cautious
> as zsh is).

You're right. That's pretty inconvenient using sudo but sudo is the only wa=
y=20
to work with multiple administrators while each admin keeps it's own set of=
=20
configuration files. On a single person system this doesn't matter.

You can always use an exit hook to clean your home directory after using su=
do.=20
Add something like this to your ~/.zshrc file. Upon exiting a sudo root=20
sessions zsh changes the permissions of all files underneath $HOME which no=
w=20
don't have the UID or GID before running sudo and now have a UID or GID of =
the=20
user you switched to (sudo -u postgres):


correct_permissions() {
  emulate -R zsh
  setopt extendedglob
  trap '' HUP INT QUIT TERM

  if [[ -n $SUDO_UID && -n $SUDO_GID ]] {
    print 'Correcting file permissions. This may take a while.'

    matches=3D("$HOME"/((.*|*)/)#*(#q^u${SUDO_UID}u${UID},^g${SUDO_GID}g${G=
ID}))
    [[ -n ${matches} ]] && chown $SUDO_UID:$SUDO_GID "${matches[@]}"
  }
}

zshexit_functions+=3D(correct_permissions)

--nextPart1339495.1lkbNVzia2
Content-Type: application/pgp-signature; name=signature.asc 
Content-Description: This is a digitally signed message part.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)

iQIcBAABCgAGBQJLaFuKAAoJEMcNQWzYfbLsgMwP/jUzJcKvcgFJpbzXk0gDSQSY
kd7uq6FXYQuCYAg7SG0OVgzfDkyRy6ibFXINxwqawVcEsjZUlITqtiEmDPZMRReV
keGNdPngbpZaHexwEeeU8aF+oDDXCHVl10rBe1Tce12KZiASpwhITobp64NJaVFA
JvWr8HNkh5Wc4+nqYpw1TDr2O93kbgX9DADOgQ1G0n9qGxJdOjy71c+PG/uVrkB0
ZsFF7emy2NrhRYgTC3CQoxJ/t+yaRazVBiKQu8rKO9eCPIMTlXglxACvL6BkWRPs
j2NvYfdsxGI8uiL8i3xgQ4qQFxytIWKEU1PROjp78fAzTzvlOUjMxYT8B0dBYD7+
WkwRMOd5cBatPLmLHO37mRCdtFeqhnTQ0MgjSkoRoz1V7YEPRB3pJ04xehlQevsW
Zigi+IUt6vgCsxsuyeRruA/9tvEkIxogYCLGXY5LqW3prjWci/pj6ZZveWIwrgIR
JfnfatWZwM2T7YAp1xTu6EobULRlLL8jO0jsernLFbgapwczgzbwpES3aTijiTGL
1HB4zVvilR2qbsZi1oCQ8TLjrzzZ5neVrzenWSrxXCzUU661in9az51IT2mMDkog
b2wf/8jpDUZR8I5NOfZuH9iP+DUTFz6uwUxt+U5sT6oeIJVs1D/HOi1IlzqUuw3Y
zznb6bBWhu/XGsYfnmEY
=GvNZ
-----END PGP SIGNATURE-----

--nextPart1339495.1lkbNVzia2--

