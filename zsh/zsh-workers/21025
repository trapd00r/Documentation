From zsh-workers-return-21025-mason-zsh=primenet.com.au@sunsite.dk Sun Mar 20 19:41:49 2005
Return-Path: <zsh-workers-return-21025-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8956 invoked from network); 20 Mar 2005 19:41:48 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 20 Mar 2005 19:41:48 -0000
Received: (qmail 96832 invoked from network); 20 Mar 2005 19:41:42 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 20 Mar 2005 19:41:42 -0000
Received: (qmail 29831 invoked by alias); 20 Mar 2005 19:41:40 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21025
Received: (qmail 29822 invoked from network); 20 Mar 2005 19:41:39 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 20 Mar 2005 19:41:39 -0000
Received: (qmail 96442 invoked from network); 20 Mar 2005 19:41:39 -0000
Received: from vms046pub.verizon.net (206.46.252.46)
  by a.mx.sunsite.dk with SMTP; 20 Mar 2005 19:41:34 -0000
Received: from candle.brasslantern.com ([4.11.1.68])
 by vms046.mailsrvcs.net (Sun Java System Messaging Server 6.2 HotFix 0.04
 (built Dec 24 2004)) with ESMTPA id <0IDO00D2I1D82BX1@vms046.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Sun, 20 Mar 2005 13:41:33 -0600 (CST)
Received: from candle.brasslantern.com (IDENT:schaefer@localhost [127.0.0.1])
	by candle.brasslantern.com (8.12.11/8.12.11) with ESMTP id j2KJfVRE009596;
 Sun, 20 Mar 2005 11:41:31 -0800
Received: (from schaefer@localhost)	by candle.brasslantern.com
 (8.12.11/8.12.11/Submit) id j2KJfVqZ009595; Sun, 20 Mar 2005 11:41:31 -0800
Date: Sun, 20 Mar 2005 11:41:31 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: [vincent@vinc17.org: Bug#300470: zsh: trap mechanism on
 command-line length limitation with zargs-based fallback]
In-reply-to: <20050320044803.GB26363@scowler.net>
To: zsh-workers@sunsite.dk
Cc: 300470-forwarded@bugs.debian.org
Message-id: <050320114131.ZM9594@candle.brasslantern.com>
MIME-version: 1.0
X-Mailer: Z-Mail Lite (5.0.0 30July97)
Content-type: text/plain; charset=us-ascii
References: <20050320044803.GB26363@scowler.net>
Comments: In reply to Clint Adams <schizo@debian.org>
 "[vincent@vinc17.org: Bug#300470: zsh: trap mechanism on command-line length
 limitation with zargs-based fallback]" (Mar 19, 11:48pm)
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On Mar 19, 11:48pm, Clint Adams wrote:
> 
> Any thoughts on this idea?

I think it's unnecessary.  For interactive use, you can get most of the
same effect by using a "preexec" function (see e.g. zsh-users/4140, or
zsh-users/6463 which extends it) or other function wrappers.  The only
hard part is finding out what the argument length limit *is*, because
it's not available from e.g. the rlimits module.

Also, we've had discussions of exec "traps" in the past, and avoided
them because they're dangerous -- it becomes too easy to put the shell
in a state where it can't do anything at all.

Other comments:

> ----- Forwarded message from Vincent Lefevre <vincent@vinc17.org> -----
> 
> Here's an example: I type "rm **/*.foo". If the command line is not too
> long, the rm command is executed as expected. Otherwise, an alternate
> rm command (something like a builtin) is executed, using zargs. This
> alternate command should be able to cope with the various rm options,
> special filenames (e.g. starting with a '-') and error handling to hide
> the unwanted side effects of the rm wrapper.
> 
> Ditto for the other common commands (mv, cp, etc.).

"An alternate rm command" -- and mv, ln, etc. -- is already available in
the zsh/files module.  It "copes with all the various rm options" and is
not bound by the argument length limitations.  It actually is a builtin,
rather than just "something like" one, and it's distributed with the zsh
package.  ("cp" is currently missing, IIRC because it was decided that
a builtin couldn't do it any more efficiently than was already possible
with redirections, but it could be added.)

