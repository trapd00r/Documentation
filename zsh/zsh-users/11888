From zsh-users-return-11888-mason-zsh=primenet.com.au@sunsite.dk Sat Sep 29 01:19:30 2007
Return-Path: <zsh-users-return-11888-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1993 invoked from network); 29 Sep 2007 01:18:57 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,SPF_HELO_PASS
	autolearn=ham version=3.2.3
Received: from ns2.primenet.com.au (HELO primenet.com.au) (@203.24.36.3)
  by ns1.primenet.com.au with (DHE-RSA-AES256-SHA encrypted) SMTP; 29 Sep 2007 01:18:57 -0000
Received: (qmail 20440 invoked from network); 28 Sep 2007 20:57:49 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by proxy.melb.primenet.com.au with SMTP; 28 Sep 2007 20:57:49 -0000
Received-SPF: none (proxy.melb.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 95310 invoked from network); 28 Sep 2007 20:57:43 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Sep 2007 20:57:43 -0000
Received: (qmail 574 invoked by alias); 28 Sep 2007 20:57:35 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11888
Received: (qmail 558 invoked from network); 28 Sep 2007 20:57:35 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 28 Sep 2007 20:57:35 -0000
Received: (qmail 94143 invoked from network); 28 Sep 2007 20:57:35 -0000
Received: from mtaout03-winn.ispmail.ntl.com (81.103.221.49)
  by a.mx.sunsite.dk with SMTP; 28 Sep 2007 20:57:27 -0000
Received: from aamtaout01-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout03-winn.ispmail.ntl.com with ESMTP
          id <20070928205726.JJVF13.mtaout03-winn.ispmail.ntl.com@aamtaout01-winn.ispmail.ntl.com>
          for <zsh-users@sunsite.dk>; Fri, 28 Sep 2007 21:57:26 +0100
Received: from pws-pc.ntlworld.com ([81.107.45.67])
          by aamtaout01-winn.ispmail.ntl.com with ESMTP
          id <20070928205726.HOIM219.aamtaout01-winn.ispmail.ntl.com@pws-pc.ntlworld.com>
          for <zsh-users@sunsite.dk>; Fri, 28 Sep 2007 21:57:26 +0100
Received: from pws-pc.ntlworld.com (pws-pc.ntlworld.com [127.0.0.1])
	by pws-pc.ntlworld.com (8.14.1/8.13.8) with ESMTP id l8SKugEA000576
	for <zsh-users@sunsite.dk>; Fri, 28 Sep 2007 21:56:42 +0100
Message-Id: <200709282056.l8SKugEA000576@pws-pc.ntlworld.com>
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-users@sunsite.dk
Subject: Re: nohup dies
In-Reply-To: Message from "Pau Amaro-Seoane" <vim.unix@googlemail.com>
   of "Fri, 28 Sep 2007 22:38:48 +0200." <30c383e70709281338x1f2609dcsdc4dd7283d387c1c@mail.gmail.com>
Date: Fri, 28 Sep 2007 21:56:42 +0100

"Pau Amaro-Seoane" wrote:
> I have been using zsh for a while and I like it a lot. Yet, today I
> ran into a snag...

There are various issues here...

> The problem? nohup dies in zsh 4.3.2

nohup is not a shell builtin; it's simply an executable programme that's
run by the shell and that in turn runs the command line passed as
arguments.

> Today I closed the ssh session with exit and then exit again after the
> message and got this:
> 
> zsh: you have running jobs.
> tuffi1| exit
> zsh: warning: 1 jobs SIGHUPed
> [1]  + 18591 done       nohup cat ./input |
>        18592 hangup     ~pau/executables/NB4_NoPN > diagnostic

The pipeline is forked before the nohup is executed.  In more detail.

  zsh creates a pipeline
  zsh forks:
     In the subshell, "nohup cat ./input" is run
  zsh forks again
     In the new subshell, ~pau/executables/... is run

So the "nohup" doesn't cover the second executable.

> When I used the cluster in my former institute everything went fine,
> and there they have zsh 4.2.4

Is it possible the option "setopt nohup" was in effect there?  This has
the same effect as "nohup" for all background commands.  (It's not
*quite* the same; the command nohup protects the following command line
from the signal, while the option stops the shell sending the signal
when it exits.)

> I changed the shell to ksh and the simulations (i.e. nohup) are not
> killed when I quit the session...

A lot of other shells, I presume (but I haven't actually checked)
including ksh, don't send SIGHUP to processes when the shell exits.

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

