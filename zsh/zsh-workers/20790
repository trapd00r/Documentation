From zsh-workers-return-20790-mason-zsh=primenet.com.au@sunsite.dk Fri Feb 04 21:16:52 2005
Return-Path: <zsh-workers-return-20790-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7481 invoked from network); 4 Feb 2005 21:16:51 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 4 Feb 2005 21:16:51 -0000
Received: (qmail 58793 invoked from network); 4 Feb 2005 21:14:23 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Feb 2005 21:14:23 -0000
Received: (qmail 11797 invoked by alias); 4 Feb 2005 19:36:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20790
Received: (qmail 11787 invoked from network); 4 Feb 2005 19:36:47 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 4 Feb 2005 19:36:47 -0000
Received: (qmail 99101 invoked from network); 4 Feb 2005 19:36:11 -0000
Received: from ip-66-80-62-153.dsl.sca.megapath.net (HELO ripple.fruitbat.org) (66.80.62.153)
  by a.mx.sunsite.dk with SMTP; 4 Feb 2005 19:36:08 -0000
Received: (from daemon@localhost)
	by ripple.fruitbat.org (8.10.2/8.8.8/PAC-1.3) id j14JZm913522;
	Fri, 4 Feb 2005 11:35:48 -0800
Received: from ming.fruitbat.org(192.168.1.2) by ripple.fruitbat.org via smap (V2.1/2.1+anti-relay+anti-spam)
	id xma013513; Fri, 4 Feb 05 11:35:22 -0800
Received: from ming.fruitbat.org (IDENT:202@ming.fruitbat.org [192.168.1.2])
	by ming.fruitbat.org (8.12.10/8.10.2/PAC-1.6) with ESMTP id j14JAf8p011786;
	Fri, 4 Feb 2005 11:10:43 -0800
Date: Fri, 4 Feb 2005 11:10:41 -0800 (PST)
From: "Peter A. Castro" <doctor@fruitbat.org>
To: Motoi Washida <a66@h8.dion.ne.jp>
cc: Peter Stephenson <pws@csr.com>, Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: 4.2.4 failure on MacOS X
In-Reply-To: <a2cd090851702fd1519fbabaa1e3ab4f@h8.dion.ne.jp>
Message-ID: <Pine.LNX.4.58.0502041103400.17079@ming.fruitbat.org>
References: <200502031615.j13GFnuc005915@news01.csr.com>
 <a2cd090851702fd1519fbabaa1e3ab4f@h8.dion.ne.jp>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On Fri, 4 Feb 2005, Motoi Washida wrote:

> I also failed to build zsh on Mac OS X 10.3.7.
>
> I think this is because configure can't find iconv(), because iconv()
> is defined as libiconv() in /usr/include/iconv.h and the configure
> script checks iconv() without using the header file.
>
> I modified configure.ac a bit and seems to work. Here is the patch.

Excellent!  It seems Darwin and Cygwin share a similar implementation.
Maybe it can simply be made generic? :

AC_CHECK_LIB(iconv, iconv)
AC_CHECK_LIB(iconv, libiconv)

Presumably it's unlikely that both iconv() and libiconv() would exist?

FWIW, I did hack an iconv test which #include the header, if detected,
but this started to get more complicated than it was worth and opt'ed for
simply looking for the real symbol name.

> --
> Motoi Washida
>
>
>
> Index: configure.ac
> ===================================================================
> RCS file: /cvsroot/zsh/zsh/configure.ac,v
> retrieving revision 1.25
> diff -d -u -r1.25 configure.ac
> --- configure.ac	1 Feb 2005 10:53:10 -0000	1.25
> +++ configure.ac	3 Feb 2005 18:42:05 -0000
> @@ -729,10 +729,11 @@
>
>   AC_CHECK_LIB(iconv, iconv)
>
> -if test "$host_os" = cygwin; then
> -dnl cygwin iconv() is really libiconv()
> -AC_CHECK_LIB(iconv, libiconv)
> -fi
> +case "$host_os" in
> +  cygwin | darwin*)
> +    dnl cygwin iconv() is really libiconv()
> +    AC_CHECK_LIB(iconv, libiconv) ;;
> +esac
>
>   if test x$enable_pcre = xyes; then
>   dnl pcre-config should probably be employed here

-- 
Peter A. Castro <doctor@fruitbat.org> or <Peter.Castro@oracle.com>
	"Cats are just autistic Dogs" -- Dr. Tony Attwood

