From zsh-workers-return-7122-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Jul 14 06:56:22 1999
Return-Path: <zsh-workers-return-7122-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28212 invoked from network); 14 Jul 1999 06:56:19 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 14 Jul 1999 06:56:19 -0000
Received: (qmail 11830 invoked by alias); 14 Jul 1999 06:56:08 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7122
Received: (qmail 11823 invoked from network); 14 Jul 1999 06:56:07 -0000
Date: Wed, 14 Jul 1999 08:56:07 +0200 (MET DST)
Message-Id: <199907140656.IAA10258@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Tue, 13 Jul 1999 19:29:02 +0400
Subject: Re: 3.1.6-test-1: strange cd behaviour


Andrej Borsenkow wrote:

> (/tools/src  is in cdpath)
> 
> bor@itsrm2:/tools/src/zsh-3.1.6-test-1%> builtin cd zsh-3.1.6-test-1/..
> bor@itsrm2:/tools/src/zsh-3.1.6-test-1%> echo $?
> 0
> bor@itsrm2:/tools/src/zsh-3.1.6-test-1%> /bin/pwd
> /tools/src/zsh-3.1.6-test-1
> 
> That is, cd does not change directory and returns success. I have some scripts
> that do "cd /some/dir && rm -r ..." ahem ...

That's a bit tricky... you have either no `.' in your `cdpath', or it is 
before /tools/src, right?

The problem is that cd_do_chdir() calls cd_try_chdir() with all
elements from `cdpath' -- if cdpath contains no `.', it first calls
cd_try_chdir() for the current directory (always plus the argument
given to `cd'). Well, cd_try_chdir() builds the full path (directory
from `cdpath' or current directory and the argument) and then calls
fixdir() -- which reduces /foo/bar/baz/.. to /foo/bar. So if `.' is
tested first and you try to `cd' to `dir/..', `cd' will always decide to
go to the current directory -- i.e. do nothing.

So the workaround for now is to put a `.' at the end of `cdpath'.

Hm, should we just document this or change it -- and how?

Bye
 Sven


--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

