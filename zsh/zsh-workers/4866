From zsh-workers-request@math.gatech.edu Thu Dec 24 11:13:39 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13514 invoked from network); 24 Dec 1998 11:13:37 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 24 Dec 1998 11:13:37 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id GAA17829;
	Thu, 24 Dec 1998 06:11:15 -0500 (EST)
Resent-Date: Thu, 24 Dec 1998 06:11:15 -0500 (EST)
From: "Andrej Borsenkow" <borsenkow.msk@sni.de>
To: "ZSH workers mailing list" <zsh-workers@math.gatech.edu>
Subject: RE: zftp problem (OS dependent)
Date: Thu, 24 Dec 1998 14:10:17 +0300
Message-ID: <001f01be2f2d$fd08aab0$21c9ca95@mowp.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="Windows-1252"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook 8.5, Build 4.71.2377.0
Importance: Normal
In-Reply-To: <001501be2eaa$13c41c50$21c9ca95@mowp.siemens.ru>
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.0810.800
Resent-Message-ID: <"gKZO51.0.WM4.I5YWs"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4866
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu



> -----Original Message-----
> From:
> Sent: Wednesday, December 23, 1998 10:26 PM
> To: ZSH workers mailing list
> Subject: zftp problem (OS dependent)
>
>
> I just found a very nice problem here ...
>
> Obviously, my system has a bug, that does not allow zftp open to be called
> second time :-) The problem is related to fcntl(x, F_DUPFD, ...)
> If I remove
> zfmoved(), it works nicely. If zmovefd() is used, the first time I can
> connect; but after that, all connects fail with
>
> "address family is not supported by protocol family"
>
> I admit, that it is OS bug, but it is probably won't be fixed soon ... Is
> there any possible workaround?
>
>


Sorry for followup ...

It looks, that we can duplicate connected socket. It means, that zfmovefd()
should be called after connect succeeds. It seems to be safe, as if connect
fails, we close fd anyway.

Merry Christmas to everybody

/andrej

