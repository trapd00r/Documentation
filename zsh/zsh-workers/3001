From zsh-workers-request@euclid.skiles.gatech.edu Tue Mar 18 16:38:56 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 11907 invoked from network); 18 Mar 1997 16:38:54 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 18 Mar 1997 16:38:54 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id LAA23268; Tue, 18 Mar 1997 11:09:41 -0500 (EST)
Resent-Date: Tue, 18 Mar 1997 11:09:41 -0500 (EST)
Date: Tue, 18 Mar 1997 09:12:18 -0700 (MST)
From: Keith Bostic <bostic@BSDI.COM>
Message-Id: <199703181612.JAA08476@forge.BSDI.COM>
To: zsh-workers@math.gatech.edu
Subject: zsh 3.0.0 and gcc 1.42 bug
Resent-Message-ID: <"7WX0u1.0.Vh5.4vhBp"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3001
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

FYI, the following code in zsh-3.0.0/Src/subst.c:

	ifdef HAVE_STRCOLL
	# ifdef __GNUC__
	    char c[strlen(*(char **) a) + 1];
	    char d[strlen(*(char **) b) + 1];
	# else  
	    char *c = halloc(strlen(*(char **) a) + 1);
	    char *d = halloc(strlen(*(char **) b) + 1);
	# endif     

doesn't work under gcc 1.42.  I've attached a test program.  If
you flip the #if value, and compile with gcc 1.42, it will fail
or succeed.

We're switching to gcc 2 for everything RSN, but figured I'd
mention it in case you guys care.

--keith

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
int
cstrpcmp(const void *a, const void *b)
{
#if 1
    char c[strlen(*(char **) a) + 1];
    char d[strlen(*(char **) b) + 1];
#else
    char c[20];
    char d[20];
#endif
    char *s, *t;
    
    for (s = *(char **) a, t = c; (*t++ = tolower(*s++)););
    for (s = *(char **) b, t = d; (*t++ = tolower(*s++)););

    return (strcmp(c, d));
}

main()
{
	char *a, *b;

	a = "HUP";
	b = "HUP";
	printf("%d\n", cstrpcmp(&a, &b));
}

