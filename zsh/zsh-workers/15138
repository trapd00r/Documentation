From zsh-workers-return-15138-mason-zsh=primenet.com.au@sunsite.dk Wed Jun 27 14:37:48 2001
Return-Path: <zsh-workers-return-15138-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2913 invoked from network); 27 Jun 2001 14:37:47 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 27 Jun 2001 14:37:47 -0000
Received: (qmail 7317 invoked by alias); 27 Jun 2001 14:36:58 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15138
Received: (qmail 7302 invoked from network); 27 Jun 2001 14:36:56 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer goliath.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "Timo Aaltonen" <tjaalton@cc.hut.fi>, <zsh-workers@sunsite.dk>
Subject: RE: AIX abd GCC
Date: Wed, 27 Jun 2001 18:37:36 +0400
Message-ID: <004b01c0ff16$b5a0c6b0$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
In-Reply-To: <Pine.OSF.4.10.10106271710360.12353-100000@tiku.hut.fi>
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2479.0006
Importance: Normal

>
> >
> > Did you use DLLDFLAGS=-shared or it worked OOTB?
> >
> > Could you give exact configure invocation you used?
>
> Yes, that was the only trick I used..
>
> ..but it works also without it, OOTB.
>

You mean, it even correctly finds boolcodes & friends?

Anyway, after reading AIX ld docs I am not happy with how we are doing it.
We do not actually build shared libraries (meaning shareable code) so every
zsh instance gets own copy of every loaded module.

Timo, could you do me a favour, update CVS and try the following patch. Just
go into zsh dir and do

cvs up -dP

then apply the patch. This should produce better code ... I hope.

Or should we just leave it as is?

-andrej

Index: zshconfig.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/zshconfig.ac,v
retrieving revision 1.8
diff -u -r1.8 zshconfig.ac
--- zshconfig.ac        2001/06/19 06:59:24     1.8
+++ zshconfig.ac        2001/06/27 14:32:38
@@ -1535,6 +1535,11 @@
   DL_EXT="${DL_EXT=so}"
   DLLD="${DLLD=$CC}"
   zsh_cv_func_dlsym_needs_underscore=no
+  if test -n "$GCC"; then
+    DLLDFLAGS=${DLLDFLAGS=-shared}
+  else
+    DLLDFLAGS=${DLLDFLAGS=-bM:SRE}
+  fi
   DLLDFLAGS=${DLLDFLAGS=}
   EXTRA_LDFLAGS=${EXTRA_LDFLAGS=}
   EXPOPT=${LDARG}-bE:

