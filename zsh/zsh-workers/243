From zsh-workers-request@math.gatech.edu  Thu Jul 20 03:40:14 1995
Received: from gatech.edu (gatech.edu [130.207.244.244]) by werple.mira.net.au (8.6.12/8.6.9) with SMTP id DAA20926 for <mason@werple.mira.net.au>; Thu, 20 Jul 1995 03:40:10 +1000
Received: from math (math.skiles.gatech.edu) by gatech.edu with SMTP id AA11427
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Wed, 19 Jul 1995 13:36:27 -0400
Received: by math (5.x/SMI-SVR4)
	id AA17791; Wed, 19 Jul 1995 13:33:01 -0400
Resent-Date: Wed, 19 Jul 1995 19:32:22 +0100 (MET DST)
Old-Return-Path: <hzoli@cs.elte.hu>
From: hzoli@cs.elte.hu (Zoltan Hidvegi)
Message-Id: <9507191732.AA09066@turan.elte.hu>
Subject: Re: Completion on =
To: zsh-workers@math.gatech.edu (zsh-workers)
Date: Wed, 19 Jul 1995 19:32:22 +0100 (MET DST)
In-Reply-To: <959.199507190735@stone.dcs.warwick.ac.uk> from "Zefram" at Jul 19, 95 08:35:30 am
X-Mailer: ELM [version 2.4 PL21]
Content-Type: text
Resent-Message-Id: <"hLGZJ.0.vL4.C7K3m"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/243
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Zefram wrote:

> The patch below fixes a couple of problems with filename completion on
> ~ and =.  Previously these characters were treated specially for
> completion even if quoted.

I did not test your changes yet, but I'm almost sure that they are not
correct.  Look at the first occurrance of docompletion() in zle_tricky.c.  The
current word is untokenized just before this call except those thing which are
within ${...} parameter expansion.  For some reason I do not remember clearly,
this is necessary (I think filename completion doesn't work well without it).
I'm sure that Sven could explain the problem more clearly.  The most confusing
thing is that docompletion() sometimes called with the tokenized string.  If
you examine makecomplist() (used to be docompletion()) more carefuly, you'll
see, that tokens and simple characters are handled similarily. E.g.

            if (*b != '^' && *b != Hat &&
                *b != '=' && *b != Equals &&
                *b != '~' && *b != Tilde)

I'm working now to fix several problems related to quoted characters in
completion strings.  I fixed most of the bugs here, and I think this bug can
also be fixed. A quoted tilde or = is always preceeded by a backslash, so in
this case line[wb] == '\\'.  We can use that to decide wether the tilde or =
is quoted or not.  But I guess it may be problematic when completing things
like \~foo$bar<TAB> since in this case (if I remember right) wb points after
the $.

Bye,
  Zoltan

