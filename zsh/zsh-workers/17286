From zsh-workers-return-17286-mason-zsh=primenet.com.au@sunsite.dk Wed Jun 05 07:40:44 2002
Return-Path: <zsh-workers-return-17286-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6881 invoked from network); 5 Jun 2002 07:40:43 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 5 Jun 2002 07:40:43 -0000
Received: (qmail 26322 invoked by alias); 5 Jun 2002 07:40:34 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 17286
Received: (qmail 26310 invoked from network); 5 Jun 2002 07:40:33 -0000
From: Sven Wischnowsky <wischnow@berkom.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <15613.49282.829896.357652@wischnow.berkom.de>
Date: Wed, 5 Jun 2002 09:40:50 +0200
To: zsh-workers@sunsite.dk
Subject: Re: Glitch in optimized menu-selection display
In-Reply-To: <1020604142853.ZM2297@candle.brasslantern.com>
References: <1020602164355.ZM10254@candle.brasslantern.com>
	<15612.30140.846841.485740@wischnow.berkom.de>
	<1020604142853.ZM2297@candle.brasslantern.com>
X-Mailer: VM 7.03 under 21.5 (patch 5) "beets" XEmacs Lucid


Hi!

Thanks, now I could see it. The fix below should make this most secure
by disallowing the optimisation when we're not in menu selection. I
probably should have thought of that...


Bye
  Sven

Index: Src/Zle/complist.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/complist.c,v
retrieving revision 1.49
diff -u -r1.49 complist.c
--- Src/Zle/complist.c	27 May 2002 07:41:10 -0000	1.49
+++ Src/Zle/complist.c	5 Jun 2002 07:39:04 -0000
@@ -1652,7 +1652,7 @@
     last_cap = (char *) zhalloc(max_caplen + 1);
     *last_cap = '\0';
 
-    if (!mnew && onlnct == nlnct && mlbeg >= 0 && mlbeg == molbeg)
+    if (!mnew && inselect && onlnct == nlnct && mlbeg >= 0 && mlbeg == molbeg)
         singledraw();
     else if (!compprintlist(mselect >= 0) || !clearflag)
 	noselect = 1;

-- 
Sven Wischnowsky                          wischnow@berkom.de

