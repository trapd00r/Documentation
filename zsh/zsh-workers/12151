From zsh-workers-return-12151-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Jul 03 18:34:43 2000
Return-Path: <zsh-workers-return-12151-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 231 invoked from network); 3 Jul 2000 18:34:41 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 3 Jul 2000 18:34:41 -0000
Received: (qmail 21497 invoked by alias); 3 Jul 2000 18:34:18 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12151
Received: (qmail 21384 invoked from network); 3 Jul 2000 18:34:16 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000703183402.ZM2822@candle.brasslantern.com>
Date: Mon, 3 Jul 2000 18:34:01 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: Fix ZDOTDIR during "make check" for static builds
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

When I made my earlier patch for this (12039), I forgot that Test/Modules
doesn't get created when the build is static.

This points ZDOTDIR into the Test directory itself (in the build tree, if
that's separate from the source), and therefore also has to make sure that
the .zcompdump file is removed at the end.

Index: Test/Makefile.in
===================================================================
@@ -48,7 +48,7 @@
 	for f in $(sdir)/$(TESTNUM)*.ztst; do \
 	  $(dir_top)/Src/zsh -f $(sdir)/ztst.zsh $$f; \
 	done
-	rm -rf Modules
+	rm -rf Modules .zcompdump
 
 # ========== DEPENDENCIES FOR CLEANUP ==========
 
Index: Test/comptest
===================================================================
@@ -25,7 +25,7 @@
   }
 
   comptesteval \
-"export ZDOTDIR=$ZTST_testdir/Modules" \
+"export ZDOTDIR=$ZTST_testdir" \
 "module_path=( $module_path )" \
 "fpath=( $fpath )" \
 'LISTMAX=10000000

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

