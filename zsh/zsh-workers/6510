From zsh-workers-return-6510-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Jun 07 16:42:00 1999
Return-Path: <zsh-workers-return-6510-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1767 invoked from network); 7 Jun 1999 16:41:59 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 7 Jun 1999 16:41:59 -0000
Received: (qmail 26143 invoked by alias); 7 Jun 1999 16:41:54 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6510
Received: (qmail 26136 invoked from network); 7 Jun 1999 16:41:53 -0000
Date: Mon, 7 Jun 1999 09:41:38 -0700 (PDT)
From: Wayne Davison <wayne@clari.net>
To: Peter Stephenson <pws@ibmth.df.unipi.it>
cc: Zsh hackers list <zsh-workers@sunsite.auc.dk>
Subject: Re: Function installation 
In-Reply-To: <9906070858.AA23516@ibmth.df.unipi.it>
Message-ID: <Pine.GSO.4.10.9906070930030.19914-100000@house.clari.net>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Mon, 7 Jun 1999, Peter Stephenson wrote:
> --- Completion/Core/compinit.unset	Fri Jun  4 15:19:08 1999
> +++ Completion/Core/compinit	Mon Jun  7 10:54:15 1999

That fixes the main loop, but not a trailing -d option:

Index: Completion/Core/compinit
--- zsh-3.1.5-pws-20/Completion/Core/compinit	Mon Jun  7 09:29:09 1999
+++ ./Completion/Core/compinit	Mon Jun  7 09:28:40 1999
@@ -54,7 +54,7 @@
   if [[ "$1" = -d ]]; then
     _i_autodump=1
     shift
-    if [[ -n "$1" && "$1" != -[df] ]]; then
+    if [[ $# -gt 0 && "$1" != -[df] ]]; then
       _i_dumpfile="$1"
       shift
     fi

I think a better fix would be to make "no_unset" only apply to typed
commands, not scripts (that's the only place I'm interested in it).
Hmm, I wonder if it would be possible to kludge that up using preexec
and precmd?

Another potential fix would be to have an easy way to set a local,
per-script option (not per-function).  If that's possible, I didn't
see it.

..wayne..

