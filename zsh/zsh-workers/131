From zsh-workers-request@math.gatech.edu  Sat Jul  1 03:11:39 1995
Received: from gatech.edu (gatech.edu [130.207.244.244]) by werple.mira.net.au (8.6.12/8.6.9) with SMTP id DAA13464 for <mason@werple.mira.net.au>; Sat, 1 Jul 1995 03:11:32 +1000
Received: from math (math.skiles.gatech.edu) by gatech.edu with SMTP id AA09769
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Fri, 30 Jun 1995 13:12:17 -0400
Received: by math (5.x/SMI-SVR4)
	id AA02289; Fri, 30 Jun 1995 13:09:33 -0400
Resent-Date: Fri, 30 Jun 1995 12:10:01 -0500
Old-Return-Path: <pckizer@gonzo.tamu.edu>
From: pckizer@tamu.edu (Philip Kizer)
To: schaefer@z-code.com
Cc: becker@Atria.com, zsh-workers@math.gatech.edu
Subject: Re: USERNAME bug zsh-2.6-beta9 
Reply-To: pckizer@tamu.edu
X-Office: 013A Teague
X-Office-Phone: 409.862.4120
X-Organization: TAMU CIS Operating Systems Group, Unix
X-Pgp-Key: Get key 0x11989061 by sending message with subject: "get pgp key"
X-Url: http://gonzo.tamu.edu/
X-Face: _B<mzj1U/]zP}h)]5#BSta@y22b`"<mJtYKCPN{4BF^@S<[rOZL*pyXkh3jeqjeJHJrb%ld
	f'dU)hBy9
In-Reply-To: Your message of "Fri, 30 Jun 1995 09:41:28 PDT."
             <9506300941.ZM2145@zipx1.z-code.com> 
Date: Fri, 30 Jun 1995 12:10:01 -0500
Message-Id: <970.804532201@gonzo.tamu.edu>
Sender: pckizer@gonzo.tamu.edu
Resent-Message-Id: <"jLM2a1.0.hZ.C_2zl"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/131
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu


"Bart Schaefer" <schaefer@z-code.com> wrote:
>On Jun 30, 10:20am, Philip Kizer wrote:
>} Subject: Re: USERNAME bug zsh-2.6-beta9
>}
>} becker@phobos.atria.com (Paul H. Becker) wrote:
>} >One (tiny) problem I have found with zsh-2.6-beta9 (as well as
>} >zsh-2.6-beta9-hzoli9) is that when I "su" to a new user, $USERNAME stays
>} >the same as the person I initially logged in as ($LOGNAME). Previous
>} >version of zsh (zsh-2.6-beta8) correctly change $USERNAME when I "su".

>Er, sorry, but that's the correct behavior.  USERNAME and USER and
>LOGNAME and HOME and so on should only get changed when you use "su -"
>(to run the new shell as a login shell).  Otherwise the environment
>is supposed to remain that of the original user.

Well, I actually don't care about the environment variables, I only care
about the %n printed from the PROMPT or 'print -P', and anyway ... even
when I 'su -', _my_ username was getting printed instead of 'root'.
Granted, I use %# so the final character is a "#" instead of "%", but
that's why I use "%n", especially when su-ing, just as an on-screen
reminder.

"%n" should show the username of the uid running the shell in my opinion as
that's what current privileges are in effect.  I guess this qualifies as a
minor change from the way it's documented, and it was just "wrong" for so
long I got used to it showing name of current uid.  Which beta release did
that actually get "fixed"...about b7?

Getting it from the utmp will always break _all_ su's, even 'su -'.  That's
why I chose the "fix" I did; logname will stay set from utmp as it is now,
but username will be set to the username of the uid running the process so
that "%n" shows the "correct" (IMO) information.

Suggestions for a cleaner way while keeping "%n" able to show "root" when
you do a "su -"?


-philip

____________________________________________________________ Philip Kizer ___
Texas A&M CIS Operating Systems Group, Unix ( 409.862.4120 ) pckizer@tamu.edu

"Relying on the government to protect your privacy is like asking a peeping
tom to install your window blinds." -John Perry Barlow, EFF co-founder

