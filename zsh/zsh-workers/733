From zsh-workers-request@euclid.skiles.gatech.edu  Wed Jan 10 22:20:59 1996
Received: from euclid.skiles.gatech.edu (euclid.skiles.gatech.edu [130.207.146.50]) by werple.net.au (8.7/8.7.1) with ESMTP id WAA19302 for <mason@werple.mira.net.au>; Wed, 10 Jan 1996 22:20:45 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id FAA10008; Wed, 10 Jan 1996 05:47:36 -0500 (EST)
Resent-Date: Wed, 10 Jan 1996 05:47:36 -0500 (EST)
From: Zefram <A.Main@dcs.warwick.ac.uk>
Message-Id: <18716.199601101047@stone.dcs.warwick.ac.uk>
Subject: Re: Two bugs
To: hzoli@cs.elte.hu (Zoltan Hidvegi)
Date: Wed, 10 Jan 1996 10:46:57 +0000 (GMT)
Cc: zsh-workers@math.gatech.edu
In-Reply-To: <199601022126.WAA04141@bolyai.cs.elte.hu> from "Zoltan Hidvegi" at Jan 2, 96 10:26:02 pm
X-Loop: zefram@dcs.warwick.ac.uk
X-Stardate: [-31]6877.24
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"xEXel3.0.IS2.8bvym"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/733
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

>% Src/zsh -f
>bolyai% bindkey '^j' self-insert
>bolyai%
>
>Now press ^J twice type anything and press ^J again.  The first character you
>typed will disappear from the screen.  If there are more lines the first
>character after each blank lines will disappear.  It is very bad in zed.

Actually, the symtom, more precisely, is that the last line preceded by
a blank line gets as its first character the first character on the
last line, and the first character of every other line preceded by a
blank line disappears.  I'm 99% certain that this is related to
am_char, as the characters that disappear are the ones that are output
by the code that outputs am_char.  (Change it to output, say, 'X'
instead of am_char, and you'll see what I mean.)

>This appeared between beta11 and beta13 (I did not even compile beta12 since I
>was too busy).

beta12 doesn't do it, so I'd say it's most likely the new refresh code
that changes closely related code to this.

Actually, I find that the recent refresh changes, outputting spaces to
the end of lines instead of merely moving onto the next line, results
in an unacceptable performance penalty.  I'm working at 19200 baud
here, and multi-line command editing is now painfully slow.  Would it
work to merely clear with spaces the *first* time a line needs it, and
go back to the old behaviour thereafter?  If not, can we please either
revert the changes or make them optional?  (setopt CORRECT_CUT_N_PASTE
to get the new behaviour.)  I'm willing to write the necessary code to
do this, provided it will be integrated into the baseline.

>% Src/zsh -f
>bolyai% setopt autolist listambiguous 
>bolyai% compctl -U -s 'fo1 fo2 fo3' foo
>bolyai% foo fo<TAB>
>
>This tab does not show the list of available completions but ^D still works
>for that.

This is a philosophical bug.  The -U is the culprit here; it
effectively causes the word to be deleted on the line and completion
started as if the word were empty.  This means that if your completion
options don't show a list immediately (which requires AUTO_LIST on and
LIST_AMBIGUOUS off) then you won't see one.  Similarly, unless you use
MENU_COMPLETE you won't get a full completion.  AUTO_MENU won't start
menu completion immediately.  I think this basically shows that -U is
mostly useless when it isn't used with -K.  This situation needs
improvement, and I've got some ideas about what to do to programmable
completion, but there's nothing that can be done, really, before the
3.0 release.

-zefram

