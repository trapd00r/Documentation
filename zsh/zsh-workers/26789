From zsh-workers-return-26789-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 25 16:34:21 2009
Return-Path: <zsh-workers-return-26789-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29235 invoked from network); 25 Mar 2009 16:34:18 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 Mar 2009 16:34:18 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 81288 invoked from network); 25 Mar 2009 16:34:09 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 25 Mar 2009 16:34:09 -0000
Received: (qmail 7735 invoked by alias); 25 Mar 2009 16:33:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26789
Received: (qmail 7592 invoked from network); 25 Mar 2009 16:33:56 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 25 Mar 2009 16:33:56 -0000
Received: from cluster-d.mailcontrol.com (cluster-d.mailcontrol.com [85.115.60.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 0697780EA0C1
	for <zsh-workers@sunsite.dk>; Wed, 25 Mar 2009 17:33:52 +0100 (CET)
Received: from rly19d.srv.mailcontrol.com (localhost.localdomain [127.0.0.1])
	by rly19d.srv.mailcontrol.com (MailControl) with ESMTP id n2PGXo1R005743
	for <zsh-workers@sunsite.dk>; Wed, 25 Mar 2009 16:33:52 GMT
Received: from submission.mailcontrol.com (submission.mailcontrol.com [86.111.216.190])
	by rly19d.srv.mailcontrol.com (MailControl) id n2PGWrBa030293
	for zsh-workers@sunsite.dk; Wed, 25 Mar 2009 16:32:53 GMT
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly19d-eth0.srv.mailcontrol.com (envelope-sender Peter.Stephenson@csr.com) (MIMEDefang) with ESMTP id n2PGWp1v030115; Wed, 25 Mar 2009 16:32:53 +0000 (GMT)
Received: from news01.csr.com ([10.99.50.25]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Wed, 25 Mar 2009 16:30:08 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.2/8.13.4) with ESMTP id n2PGU8Zv013453;
	Wed, 25 Mar 2009 16:30:08 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.2/8.14.2/Submit) with ESMTP id n2PGU8sK013449;
	Wed, 25 Mar 2009 16:30:08 GMT
Message-Id: <200903251630.n2PGU8sK013449@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: 517008@bugs.debian.org, zsh-workers@sunsite.dk
Subject: Re: Bug#517008: alias not expanded with zsh -c
In-reply-to: <20090325145418.GB9330@scru.org>
References: <20090225022850.GA4841@vin.lip.ens-lyon.fr> <20090325145418.GB9330@scru.org>
Comments: In-reply-to Clint Adams <schizo@debian.org>
   message dated "Wed, 25 Mar 2009 14:54:18 +0000."
Date: Wed, 25 Mar 2009 16:30:08 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 25 Mar 2009 16:30:08.0675 (UTC) FILETIME=[F644E730:01C9AD66]
X-Scanned-By: MailControl A_08_51_00 (www.mailcontrol.com) on 10.68.1.129
X-Virus-Scanned: ClamAV 0.92.1/9165/Wed Mar 25 16:08:41 2009 on bifrost
X-Virus-Status: Clean

Clint Adams wrote:
> On Wed, Feb 25, 2009 at 03:28:50AM +0100, Vincent Lefevre wrote:
> > Aliases are not expanded with the -c option, as shown below.
> > 
> > vin% cmd=$(printf "emulate sh\nalias a='echo OK >&2'\na")
> > vin% printf "%s\n" "$cmd"
> > emulate sh
> > alias a='echo OK >&2'
> > a
> > vin% printf "%s" "$cmd" | zsh -f
> > OK
> > vin% zsh -fc "$cmd"
> > zsh:3: command not found: a
> > vin% 
> > 
> > There's no such problem with ksh93, bash in POSIX mode, and dash
> > (pdksh has the same bug).
> 
> That does appear to be the behavior.

Yes, at least as far as native zsh mode goes this isn't a bug.  The
command passed is treated as a single piece of text that's parsed in one
go, so the alias isn't available until afterwards (by which time the
shell has exited).  This is the same behaviour as other chunks of code
read in one go.  To get script-like behaviour, don't use "-c", use a
script argument.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

