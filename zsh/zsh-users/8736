From zsh-users-return-8736-mason-zsh=primenet.com.au@sunsite.dk Fri Apr 22 12:22:40 2005
Return-Path: <zsh-users-return-8736-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23488 invoked from network); 22 Apr 2005 12:22:39 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 22 Apr 2005 12:22:39 -0000
Received: (qmail 75833 invoked from network); 22 Apr 2005 12:22:29 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 22 Apr 2005 12:22:29 -0000
Received: (qmail 6427 invoked by alias); 22 Apr 2005 12:22:21 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8736
Received: (qmail 6412 invoked from network); 22 Apr 2005 12:22:21 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 22 Apr 2005 12:22:21 -0000
Received: (qmail 74750 invoked from network); 22 Apr 2005 12:22:21 -0000
Received: from smtp1.poczta.interia.pl (HELO smtp.poczta.interia.pl) (217.74.65.44)
  by a.mx.sunsite.dk with SMTP; 22 Apr 2005 12:22:09 -0000
Received: by smtp.poczta.interia.pl (INTERIA.PL, from userid 502)
	id C39DED06D2; Fri, 22 Apr 2005 14:22:08 +0200 (CEST)
Received: from poczta.interia.pl (mi02.poczta.interia.pl [10.217.12.2])
	by smtp.poczta.interia.pl (INTERIA.PL) with ESMTP id 66CFBD06BE
	for <zsh-users@sunsite.dk>; Fri, 22 Apr 2005 14:22:08 +0200 (CEST)
Received: by poczta.interia.pl (INTERIA.PL, from userid 502)
	id 17F9B2BC0E2; Fri, 22 Apr 2005 14:22:08 +0200 (CEST)
Received: from localhost.localdomain (ajm186.internetdsl.tpnet.pl [83.16.246.186])
	by poczta.interia.pl (INTERIA.PL) with ESMTP id 8B13D2BC0D8
	for <zsh-users@sunsite.dk>; Fri, 22 Apr 2005 14:22:07 +0200 (CEST)
Received: from Mutt by mutt-smtp-wrapper.pl 1.2  (www.zdo.com/articles/mutt-smtp-wrapper.shtml)
Date: Fri, 22 Apr 2005 14:22:06 +0200
From: Mariusz Gniazdowski <cellsan@interia.pl>
To: zsh-users@sunsite.dk
Subject: while read; problems
Message-ID: <20050422122206.GA11327@globtel.pl>
Reply-To: Mariusz Gniazdowski <cellsan@interia.pl>
Mail-Followup-To: zsh-users@sunsite.dk
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-2
Content-Disposition: inline
User-Agent: Mutt/1.5.8i
X-EMID: 8eba226c
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.4

Hello.
I wrote function for searching longest line:

function count {
        local line max=0 idx=0 maxidx=0
        while read line; do
                line=${#line}
                (( idx++ ))
                [[ $max -lt $line ]] && { max=$line; maxidx=$idx; }
        done < "$1"
        echo "$max in line nr: $maxidx" 
}                         

First problem: this runs much faster on bash.

zsh# du -sh somefile.bin 
6,9M    somefile.bin
zsh# time ( count somefile.bin )
2,63s user 8,51s system 96% cpu 11,585 total


bash# time { count somefile.bin ;}
2501 in line nr: 9106

real    0m4.061s
user    0m3.682s
sys     0m0.222s


So 4 seconds compared to 11.5. There were tests where bash finished in 6 seconds and zsh in 21.


Second problem: zsh results differ from run to run. I had results like:
6097 in line nr: 169
6553 in line nr: 300
etc.

Bash always returns one result: 2501 in line nr: 9106

This file was binary, but i did'nt output it, or pass it to any function (in variable). It was 
only: readed line by line and counted.

-- 
Mariusz Gniazdowski

----------------------------------------------------------------------
PS. Zdjecia samochodow, bardzo duzo, bardzo fajne galerie... 
>>> http://link.interia.pl/f1877

