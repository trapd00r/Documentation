From zsh-users-return-14193-mason-zsh=primenet.com.au@sunsite.dk Sat Jun 13 20:15:57 2009
Return-Path: <zsh-users-return-14193-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18399 invoked from network); 13 Jun 2009 20:15:44 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 13 Jun 2009 20:15:44 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 63047 invoked from network); 13 Jun 2009 20:15:31 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 13 Jun 2009 20:15:31 -0000
Received: (qmail 21334 invoked by alias); 13 Jun 2009 20:15:04 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 14193
Received: (qmail 21311 invoked from network); 13 Jun 2009 20:15:02 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 13 Jun 2009 20:15:02 -0000
Received: from vms173007pub.verizon.net (vms173007pub.verizon.net [206.46.173.7])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 6D6C280307FA
	for <zsh-users@sunsite.dk>; Sat, 13 Jun 2009 22:14:58 +0200 (CEST)
Received: from torch.brasslantern.com ([96.238.219.58])
 by vms173007.mailsrvcs.net
 (Sun Java(tm) System Messaging Server 6.3-7.04 (built Sep 26 2008; 32bit))
 with ESMTPA id <0KL700GO409B8VG6@vms173007.mailsrvcs.net> for
 zsh-users@sunsite.dk; Sat, 13 Jun 2009 14:46:28 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id n5DJkMTd003623; Sat,
 13 Jun 2009 12:46:23 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id n5DJkLcT003622; Sat, 13 Jun 2009 12:46:21 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Message-id: <090613124621.ZM3621@torch.brasslantern.com>
Date: Sat, 13 Jun 2009 12:46:21 -0700
In-reply-to: <200906131929.n5DJTDBY003149@pws-pc.ntlworld.com>
Comments: In reply to Peter Stephenson <p.w.stephenson@ntlworld.com>
 "Re: which command doesn't work" (Jun 13,  8:29pm)
References: <200906131929.n5DJTDBY003149@pws-pc.ntlworld.com>
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
To: zsh-users@sunsite.dk
Subject: Re: which command doesn't work
Cc: Cesar Romani <cesar.romani@gmail.com>
MIME-version: 1.0
Content-type: text/plain; charset=us-ascii
X-Virus-Scanned: ClamAV 0.94.2/9464/Sat Jun 13 09:44:17 2009 on bifrost
X-Virus-Status: Clean

On Jun 13,  8:29pm, Peter Stephenson wrote:
} Subject: Re: which command doesn't work
}
} Cesar Romani wrote:
} > If my first command on the shell is:
} > zsh$ls -l |less
} > it takes the last version of less, namely:
} > zsh$which less
} > /c/Programmi/GnuWin32/bin/less
} > 
} > But if my first command is:
} > zsh$which less
} > /usr/local/bin/less
} > and then
} > zsh$ls -l |less
} > it takes the correct version.
} > That's strange!
} 
} If you replace "which less" with "rehash", does it also find the right
} version?  That would be a workaround (but shouldn't be necessary).

Aha!  I think I know what's going on.

Check this out:

% which less
/usr/bin/less
% mkdir /tmp/path
% touch /tmp/path/less
% chmod +x /tmp/path/less
% path=(/tmp/path $path)
% which less
/tmp/path/less
% less -V
less 382
Copyright (C) 2002 Mark Nudelman

less comes with NO WARRANTY, to the extent permitted by law.
For information about the terms of redistribution,
see the file named README in the less distribution.
Homepage: http://www.greenwoodsoftware.com/less

%

Note that /usr/bin/less executed even though which says /tmp/path/less is
found first.

So what's happening is that somewhere in Cesar's startup, the HASH_DIRS
option is causing all the files in /c/Programmi/GnuWin32/bin to be added
to the command hash table.  *After* that, he prepends /usr/local/bin et al.
to $PATH, but the hash table doesn't rebuild itself when the path changes,
so the previously hashed location is still executing.

Either add a "rehash" after changing the path, or change the path sooner.

