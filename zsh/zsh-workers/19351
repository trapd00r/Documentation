From zsh-workers-return-19351-mason-zsh=primenet.com.au@sunsite.dk Thu Jan 08 15:21:09 2004
Return-Path: <zsh-workers-return-19351-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28845 invoked from network); 8 Jan 2004 15:21:08 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 8 Jan 2004 15:21:08 -0000
Received: (qmail 9145 invoked by alias); 8 Jan 2004 15:20:57 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19351
Received: (qmail 9092 invoked from network); 8 Jan 2004 15:20:56 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 8 Jan 2004 15:20:56 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [192.35.17.2] by sunsite.dk (MessageWall 1.0.8) with SMTP; 8 Jan 2004 15:20:56 -0000
Received: from mail1.siemens.de (mail1.siemens.de [139.23.33.14])
	by thoth.sbs.de (8.11.7/8.11.7) with ESMTP id i08FKuS05293;
	Thu, 8 Jan 2004 16:20:56 +0100 (MET)
Received: from mowp006a.ww600.siemens.net (mowp006a.ru001.siemens.net [163.242.193.6])
	by mail1.siemens.de (8.11.7/8.11.7) with ESMTP id i08FKtL29184;
	Thu, 8 Jan 2004 16:20:55 +0100 (MET)
Received: by mowp006a.ru001.siemens.net with Internet Mail Service (5.5.2657.72)
	id <CPHD38N4>; Thu, 8 Jan 2004 18:20:54 +0300
Message-ID: <66F451E8923A3D42B22434287141E2E3D12323@mowp006a.ru001.siemens.net>
From: Borzenkov Andrey <Andrey.Borzenkov@siemens.com>
To: "'Oliver Kiddle'" <okiddle@yahoo.co.uk>,
   "'Zsh hackers list'"
	 <zsh-workers@sunsite.dk>
Subject: RE: autoconf 2.5 (Re: PATCH: terminfo horor) 
Date: Thu, 8 Jan 2004 18:20:54 +0300 
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2657.72)
Content-Type: text/plain

> 
> > - autoconf 2.5 does not create anything in configure. Instead the sole
> point
> > of configure script is to create config.status - and it is config.status
> > that finally does (should do) the job of creating files, making
> > substitutions etc
> 
> Taking that, what we should probably do is have configure not create
> any config.modules files but have it do the work of config.modules.sh,
> putting the results directly into config.status in such a way that
> config.status will create the config.modules file.
> 

right; but to do it we need make configure puts into config.status (or as
init part of running config.modules.sh) information that modules may need to
make decision. Using cache variables was big mistake to start with :(

that was one reason I thought about those config.snippets.

doing that also allows to simply put commands for every module in it's own
configure section using init commands that *do* depend on cache variables,
like

AC_CONFIG_COMMANDS([zsh/terminfo], [
link='if test x$have_tigetstr = xyes; then
          if test x$shared_tigetstr = xyes; then
              echo either
          else
              echo static
          fi
      else
          echo either;
      fi
'
echo name=zsh/terminfo modfile=zsh/terminfo.mdd link=$link auto=yes load=no
>> ${CONFIG_MODULES}], [
have_tigetstr=$ac_cv_func_tigetstr
shared_tigetstr=$zsh_cv_shared_tigetstr
CONFIG_MODULES=$CONFIG_MODULES
])

where the last argument does initialization.

This can't be generated dynamically because tag (first argument) must be
static :(

So the options currently are to either put all needed variables from all
modules into config.modules.sh or run it out of configure.


-andrey

