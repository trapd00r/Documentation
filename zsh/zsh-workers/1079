From wayne@tenor.clarinet.com Thu May 16 04:20:12 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3) with ESMTP id EAA06117 for <mason@werple.mira.net.au>; Thu, 16 May 1996 04:20:09 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id OAA09551; Wed, 15 May 1996 14:04:48 -0400 (EDT)
Resent-Date: Wed, 15 May 1996 14:04:48 -0400 (EDT)
Message-Id: <199605151803.LAA09248@tenor.clari.net>
To: Peter Bray <pbray@ind.tansu.com.au>
Cc: zsh-workers@math.gatech.edu
Subject: Re: zsh-2.6-beta17 : compiling on SCO - results 
In-reply-to: pbray's message of Wed, 15 May 1996 12:15:43 +1000.
	     <199605150215.MAA11431@cod.ind.tansu.com.au> 
Date: Wed, 15 May 1996 11:03:43 -0700
From: Wayne Davison <wayne@tenor.clarinet.com>
Resent-Message-ID: <"1kyYm2.0.9L2._oXcn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1079
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 1724
Status: O

Peter Bray writes:
> host operating system : sco3.2v4.2

Here's the patches I used to apply to zsh when I compiled it for
this version of sco.  The first change allows zsh to accept tty
changes via things like stty.  It does have the effect of allowing
all program to change the tty settings (even the background ones),
but that's the best SCO can do since they have a bug in their
library.  SCO 5 doesn't have this problem, so it would have to
be made conditional for only older versions of SCO, and I never
figured out how best to conditionalize this (because we got rid
of SCO from my machine).

The line numbers will be a little off, since this patch was
last applied to beta 14.

Index: jobs.c
@@ -133,6 +133,10 @@
     }
 
     pgrp = gettygrp();           /* get process group of tty      */
+#ifdef __sco
+    if (pgrp == mypgrp)
+	pgrp = jn->gleader;
+#endif
 
     /* is this job in the foreground of an interactive shell? */
     if ((jn->gleader == pgrp || (pgrp > 1 && kill(-pgrp, 0) == -1)) &&
Index: system.h
@@ -110,7 +110,7 @@
  * that doesn't have gettimeofday.  Of course we *
  * probably will move to the POSIX time function *
  *  anyway.                                      */
-#ifdef __sco
+#ifdef __old_sco
 struct timezone {
     short minutes;
 };
@@ -119,7 +119,7 @@
 /* Sco needs the following include for struct utimbuf *
  * which is strange considering we do not use that    *
  * anywhere in the code                               */
-#ifdef __sco
+#ifdef __old_sco
 # include <utime.h>
 #endif
 
@@ -215,7 +215,7 @@
 # define WSTOPSIG(X) (((X)>>8)&0377)
 #endif
 
-#ifdef HAVE_SYS_SELECT_H
+#if defined(HAVE_SYS_SELECT_H) && !defined(__sco)
 # include <sys/select.h>
 #endif
 

..wayne..


