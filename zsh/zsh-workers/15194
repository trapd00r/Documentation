From zsh-workers-return-15194-mason-zsh=primenet.com.au@sunsite.dk Sat Jun 30 20:19:32 2001
Return-Path: <zsh-workers-return-15194-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 614 invoked from network); 30 Jun 2001 20:19:30 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 30 Jun 2001 20:19:30 -0000
Received: (qmail 9515 invoked by alias); 30 Jun 2001 20:18:35 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15194
Received: (qmail 9495 invoked from network); 30 Jun 2001 20:18:34 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010630201843.ZM74@candle.brasslantern.com>
Date: Sat, 30 Jun 2001 20:18:43 +0000
X-Mailer: Z-Mail (5.0.0 30July97)
To: zsh-workers@sunsite.dk
Subject: The number of the most recent history event
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

$#history is the number of history -entries-, NOT the number of history
-events-; it never exceeds $HISTSIZE.  So, how does one get the number of
the most recent event?  I've come up with two ways:

1.	$[${(%):-%h}-1]

The $[...-1] is necessary because %h expands to the number of the entry
that is -about to be- filled in.

2.	$[${${(@O)${(@kl:5:)history}}[1]}]

The outer $[...] is necessary to force integer interpretation, thereby
stripping off the leading spaces from (l:5:), and the two (@) are needed
because $[...] causes a double-quote context.  Of course (l:5:) assumes
you haven't executed more than 99999 commands in the current shell.

If we were to add an (n) flag, e.g. (On) and (on) sort numerically (like
(Oi) and (oi) do case-independently), ${${(Onk)history}[1]} would do it,
as would ${${(onk)history}[-1]} which might be a bit clearer.

Or maybe we should just add the history number to the parameter module?

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

