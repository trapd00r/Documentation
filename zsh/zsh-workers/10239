From zsh-workers-return-10239-mason-zsh=primenet.com.au@sunsite.auc.dk Sat Mar 25 01:36:29 2000
Return-Path: <zsh-workers-return-10239-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26378 invoked from network); 25 Mar 2000 01:36:27 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 25 Mar 2000 01:36:27 -0000
Received: (qmail 19083 invoked by alias); 25 Mar 2000 01:36:19 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10239
Received: (qmail 19070 invoked from network); 25 Mar 2000 01:36:17 -0000
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: Re: zsh-3.1.6-dev-20
References: <E12Yc4C-0002qM-00.2000-03-24-21-56-29@cmailg3.svr.pol.co.uk>
MIME-Version: 1.0 (generated by AKEMI 1.13.2 - =?ISO-2022-JP?B?Ig==?=
 =?ISO-2022-JP?B?GyRCQTA0Y0s8GyhCIg==?=)
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@jaist.ac.jp>
Date: 25 Mar 2000 10:35:55 +0900
In-Reply-To: Peter Stephenson's message of "Thu, 23 Mar 2000 21:56:33 +0000"
Message-ID: <rsq7ler96h0.fsf@crane.jaist.ac.jp>
Lines: 118
User-Agent: Chao-gnus/6.12.5 AKEMI/1.13.2 (=?ISO-2022-JP?B?GyRCQTAbKEI=?=
 =?ISO-2022-JP?B?GyRCNGNLPBsoQg==?=) FLAM-DOODLE/1.12.6
 (=?ISO-2022-JP?B?GyRCM3cbKEI=?= 10R4.0/5.0) Emacs/20.4
 (sparc-sun-solaris2.6) MULE/4.0 (HANANOEN)

In article <E12Yc4C-0002qM-00.2000-03-24-21-56-29@cmailg3.svr.pol.co.uk>,
  Peter Stephenson <pws@pwstephenson.fsnet.co.uk> writes:

> I have uploaded
>   ftp://ftp.zsh.org/zsh/development/zsh-3.1.6-dev-20.tar.gz
> with the changes listed below.  This will need checking quite carefully,
> particularly by people who have submitted a lot of patches (guess who that
> might mean?)

* 10233 is not applied.

* The description for users-hosts-ports is doubled in
  Doc/Zsh/compsys.yo.  (9913 pointed out this.)

* Src/text.c is different to my version.  Where is the change come from?

| Index: Src/text.c
| ===================================================================
| RCS file: /projects/zsh/zsh/Src/text.c,v
| retrieving revision 1.1.1.19
| retrieving revision 1.1.1.18
| diff -u -r1.1.1.19 -r1.1.1.18
| --- Src/text.c	2000/03/25 00:22:02	1.1.1.19
| +++ Src/text.c	2000/03/23 04:11:14	1.1.1.18
| @@ -122,8 +122,7 @@
|      tlim = tbuf + tsiz;
|      tindent = 1;
|      tjob = 0;
| -    if (prog->len)
| -	gettext2(&s);
| +    gettext2(&s);
|      *tptr = '\0';
|      untokenize(tbuf);
|      return tbuf;
| @@ -195,6 +194,9 @@
|  	struct {
|  	    int par;
|  	} _cond;
| +	struct {
| +	    Wordcode end;
| +	} _subsh;
|      } u;
|  };
|  
| @@ -330,8 +332,10 @@
|  	    if (!s) {
|  		taddstr("( ");
|  		tindent++;
| -		tpush(code, 1);
| +		n = tpush(code, 1);
| +		n->u._subsh.end = state->pc + WC_SUBSH_SKIP(code);
|  	    } else {
| +		state->pc = s->u._subsh.end;
|  		tindent--;
|  		taddstr(" )");
|  		stack = 1;
| @@ -341,8 +345,10 @@
|  	    if (!s) {
|  		taddstr("{ ");
|  		tindent++;
| -		tpush(code, 1);
| +		n = tpush(code, 1);
| +		n->u._subsh.end = state->pc + WC_CURSH_SKIP(code);
|  	    } else {
| +		state->pc = s->u._subsh.end;
|  		tindent--;
|  		taddstr(" }");
|  		stack = 1;

* 9988 is applied (by hand because it's encoded by quoted-printable?)
  but it has a problem.

| % cvs diff -w -u -r1.1.1.6 -r1.1.1.5 Src/Modules/zpty.c
| Index: Src/Modules/zpty.c
| ===================================================================
| RCS file: /projects/zsh/zsh/Src/Modules/zpty.c,v
| retrieving revision 1.1.1.6
| retrieving revision 1.1.1.5
| diff -u -w -u -r1.1.1.6 -r1.1.1.5
| --- Src/Modules/zpty.c	2000/03/25 00:22:04	1.1.1.6
| +++ Src/Modules/zpty.c	2000/03/14 11:18:00	1.1.1.5
| @@ -165,7 +165,7 @@
|  
|  #else /* ! __osf__ */
|  
| -#if __SVR4
| +#if defined(__SVR4) || defined(sinix)
|  
|  #include <sys/stropts.h>
|  
| @@ -174,11 +174,12 @@
|  {
|      int mfd, sfd;
|      char *name;
| +    int ret;
|  
|      if ((mfd = open("/dev/ptmx", O_RDWR)) < 0)
|  	return 1;
|  
| -    if (!(name = ptsname(mfd)) || grantpt(mfd) || unlockpt(mfd)) {
| +    if (grantpt(mfd) || unlockpt(mfd) || !(name = ptsname(mfd))) {
|  	close(mfd);
|  	return 1;
|      }

Since ret is undeclared, it cannot be compiled.

% make
...
gcc -c -I. -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -DHAVE_CONFIG_H -DMODULE -Wall -Wno-implicit -Wmissing-prototypes -ggdb -fpic -o zpty..o zpty.c
zpty.c: In function `get_pty':
zpty.c:189: `ret' undeclared (first use in this function)
zpty.c:189: (Each undeclared identifier is reported only once
zpty.c:189: for each function it appears in.)

* zsh-users_2973 is not applied. (Because Geoff is not commented?)
-- 
Tanaka Akira

