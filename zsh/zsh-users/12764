From zsh-users-return-12764-mason-zsh=primenet.com.au@sunsite.dk Mon Apr 07 01:25:06 2008
Return-Path: <zsh-users-return-12764-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10642 invoked from network); 7 Apr 2008 01:25:04 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 7 Apr 2008 01:25:04 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 46083 invoked from network); 7 Apr 2008 01:24:53 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 Apr 2008 01:24:53 -0000
Received: (qmail 7670 invoked by alias); 7 Apr 2008 01:24:45 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12764
Received: (qmail 7653 invoked from network); 7 Apr 2008 01:24:44 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 7 Apr 2008 01:24:44 -0000
Received: from vms044pub.verizon.net (vms044pub.verizon.net [206.46.252.44])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 5864F80561BF
	for <zsh-users@sunsite.dk>; Mon,  7 Apr 2008 03:24:40 +0200 (CEST)
Received: from torch.brasslantern.com ([71.116.79.77])
 by vms044.mailsrvcs.net (Sun Java System Messaging Server 6.2-6.01 (built Apr
 3 2006)) with ESMTPA id <0JYX00F6AL8J2CM0@vms044.mailsrvcs.net> for
 zsh-users@sunsite.dk; Sun, 06 Apr 2008 20:24:20 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id m371OIfl031826	for
 <zsh-users@sunsite.dk>; Sun, 06 Apr 2008 18:24:19 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id m371OHZ7031825	for zsh-users@sunsite.dk; Sun,
 06 Apr 2008 18:24:17 -0700
Date: Sun, 06 Apr 2008 18:24:17 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: sudo processes completion with zstyle -e
In-reply-to: <5FAB16E1-5673-43DB-9E88-1D7D18DE1AAA@biskalar.de>
To: zsh-users ml <zsh-users@sunsite.dk>
Message-id: <080406182417.ZM31824@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <5FAB16E1-5673-43DB-9E88-1D7D18DE1AAA@biskalar.de>
Comments: In reply to Sebastian Stark <seb-zsh@biskalar.de>
 "sudo processes completion with zstyle -e" (Apr  7,  1:25am)
X-Virus-Scanned: ClamAV 0.91.2/6639/Sun Apr  6 23:58:42 2008 on bifrost
X-Virus-Status: Clean

On Apr 7,  1:25am, Sebastian Stark wrote:
} 
} When using sudo it seems the $words array is not that useful in the  
} following context:
} 
}    zstyle -e ':completion:*:processes' command 'if [[ $words[1] ==  
} sudo ]] reply="ps auxw"'

That's because the _sudo function is defined to call the _normal
completer on everything after the command name argument, which has
the effect of hiding the "sudo" and making the completion system
believe that the command line begins with "kill", so that options
etc. for kill are completed.

} Is there another way to find out whether a command is run with sudo?  

Try this:

    zstyle -e ':completion:*:processes' command \
      'if (( $funcstack[(eI)$_comps[sudo]] )) reply="ps auxw"'

That says "if the current call stack includes the completer for sudo,
then ...".

