From zsh-workers-request@euclid.skiles.gatech.edu Thu Jun 26 09:29:44 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 18689 invoked from network); 26 Jun 1997 09:29:43 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 26 Jun 1997 09:29:42 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id FAA01957; Thu, 26 Jun 1997 05:15:20 -0400 (EDT)
Resent-Date: Thu, 26 Jun 1997 05:15:20 -0400 (EDT)
Message-Id: <199706260919.LAA14661@sgi.ifh.de>
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: added space bug fix
Date: Thu, 26 Jun 1997 11:19:11 +0200
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"rY01B1.0.TU.eCZip"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3308
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

This fixes the extremely annoying bug in zsh 3.1.2 that spaces get
repeatedly added at the end of the line during menucompletion.  It
does it by null-terminating the line when the space is deleted (the
logic is set up so that the space is added in case it isn't menu
completion then deleted again when it turns out it is).

It's possible the line should be null-terminated in zle_refresh.c
instead/also, or that some other code should pay more attention to the
line length variable ll, but I don't dare touch any of that.

*** Src/Zle/zle_utils.c.sc	Sun Jun  1 07:50:52 1997
--- Src/Zle/zle_utils.c	Thu Jun 26 11:06:10 1997
***************
*** 75,81 ****
  	line[to] = line[to + cnt];
  	to++;
      }
!     ll = to;
  }
  
  /**/
--- 75,81 ----
  	line[to] = line[to + cnt];
  	to++;
      }
!     line[ll = to] = '\0';
  }
  
  /**/

-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77413
Deutsches Elektronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.

