From zsh-workers-return-28994-mason-zsh=primenet.com.au@zsh.org Wed Apr 13 19:41:07 2011
Return-Path: <zsh-workers-return-28994-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10806 invoked by alias); 13 Apr 2011 19:41:07 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28994
Received: (qmail 24523 invoked from network); 13 Apr 2011 19:40:52 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_NONE
	autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at ckhb.org does not designate permitted sender hosts)
Date: Wed, 13 Apr 2011 12:32:23 -0700 (PDT)
From: "S. Cowles" <scowles@ckhb.org>
X-X-Sender: picmar@ckhb06
To: Peter Stephenson <Peter.Stephenson@csr.com>
cc: zsh-workers@zsh.org
Subject: Re: build on os x 10.6.7, xcode 3.2.6
In-Reply-To: <20110413172646.2e406efd@pwslap01u.europe.root.pri>
Message-ID: <alpine.LN8.2.00.1104131146110.23733@ckhb06>
References: <20110412130929.GG5881@erwin> <alpine.LN8.2.00.1104130738320.23733@ckhb06> <20110413172646.2e406efd@pwslap01u.europe.root.pri>
User-Agent: Alpine 2.00 (LN8 1167 2008-08-23)
X-Face: Ek1c-Ll9]E|9mF*Z|hf5VSHqF.]0Qv%;h%=Zne"Y3am*(:Tf_BlXI;j'}FMhu%sNCjSk|</(~~v,k&/W^J;>cxD~oD:g5Tv,gN}{Y8("m<8<%%=_vy
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed

On Wed, 13 Apr 2011, Peter Stephenson wrote:

> On Wed, 13 Apr 2011 09:10:47 -0700
> "S. Cowles" <scowles@ckhb.org> wrote:
>> i have been building source from the sourceforge cvs repository on os
>> x 10.6.x for the past two months with no issues, until this week.  as
>> of rev4.3.11-dev-1, patchlevel 1.5245, i have begun getting the
>> following build error
>>
>> gcc -c -I. -I/opt/local/include -DHAVE_CONFIG_H -Wall
>> -Wmissing-prototypes -O2  -o builtin.o builtin.c In file included
>> from zsh.mdh:37, from builtin.c:33:
>> exec.epro:29: error: 'RLIM_NLIMITS' undeclared here (not in a
>> function) make[2]: *** [builtin.o] Error 1
>> make[1]: *** [modobjs] Error 2
>> make: *** [all] Error 1
>>
>> previously, rev4.3.11-dev-1, patchlevel 1.5241, and prior, built with
>> no problems.  i am still looking for what might cause the
>> RLIM_NLIMITS definition to be missed, but wanted to find out if
>> someone was already aware of this issue and might point out any
>> possible mistake on my part.
>
> No, but there's a good chance it's got something to do with this
> change.  Changing random source code options often has side effects.
> Does removing either _GNU_SOURCE or _POSIX_C_SOURCE help?
>
> --- zsh-4.3.11/Src/system.h     2010-02-22 11:12:31.000000000 +0100
> +++ zsh/Src/system.h    2011-04-12 14:20:37.106000061 +0200
> @@ -37,13 +37,12 @@
> #endif
> #endif
>
> -#if defined(__linux) || defined(__GNU__) || defined(__GLIBC__)
> /*
>  * Turn on numerous extensions.
>  * This is in order to get the functions for manipulating /dev/ptmx.
>  */
> #define _GNU_SOURCE 1
> -#endif
> +#define _POSIX_C_SOURCE 200809L
>
> /* NeXT has half-implemented POSIX support *
>  * which currently fools configure         */


i checked all three cases:
 	1)
 		/* #define _GNU_SOURCE 1 /**/
 		#define _POSIX_C_SOURCE 200809L
 	2)
 		/* #define _GNU_SOURCE 1 /**/
 		/* #define _POSIX_C_SOURCE 200809L /**/
 	3)
 		#define _GNU_SOURCE 1
 		/* #define _POSIX_C_SOURCE 200809L /**/

cases 2 and 3 built patchlevel 1.5246 with no problem.  so, indeed,
removing _POSIX_C_SOURCE does help.  thank you very much for pinpointing
the search.

perhaps some directive such as the following might be sufficiently
restrictive to handle OS X and not interfere with other OS
installations on apple hardware:

#if !defined(__APPLE__) && !defined(__APPLE_CC__)
#define _POSIX_C_SOURCE 200809L
#endif

