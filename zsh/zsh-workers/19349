From zsh-workers-return-19349-mason-zsh=primenet.com.au@sunsite.dk Thu Jan 08 12:21:17 2004
Return-Path: <zsh-workers-return-19349-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3118 invoked from network); 8 Jan 2004 12:21:16 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 8 Jan 2004 12:21:16 -0000
Received: (qmail 29162 invoked by alias); 8 Jan 2004 12:21:06 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19349
Received: (qmail 29152 invoked from network); 8 Jan 2004 12:21:06 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 8 Jan 2004 12:21:06 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [193.109.254.211] by sunsite.dk (MessageWall 1.0.8) with SMTP; 8 Jan 2004 12:21:6 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-11.tower-36.messagelabs.com!1073564463!2989459
X-StarScan-Version: 5.1.15; banners=-,-,-
Received: (qmail 3139 invoked from network); 8 Jan 2004 12:21:03 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-11.tower-36.messagelabs.com with SMTP; 8 Jan 2004 12:21:03 -0000
Received: from gmcs3.local ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id i08CL2uB023560
	for <zsh-workers@sunsite.dk>; Thu, 8 Jan 2004 12:21:02 GMT
Received: from gmcs3.local (localhost [127.0.0.1])
	by gmcs3.local (8.11.6/8.11.6/SuSE Linux 0.5) with ESMTP id i08CPfl07409
	for <zsh-workers@sunsite.dk>; Thu, 8 Jan 2004 13:25:41 +0100
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <66F451E8923A3D42B22434287141E2E3C675A5@mowp006a.ru001.siemens.net> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <66F451E8923A3D42B22434287141E2E3C675A5@mowp006a.ru001.siemens.net>
To: "Zsh hackers list" <zsh-workers@sunsite.dk>
Subject: Re: autoconf 2.5 (Re: PATCH: terminfo horor) 
Date: Thu, 08 Jan 2004 13:25:41 +0100
Message-ID: <7407.1073564741@gmcs3.local>

On 25 Dec, Andrey wrote:

> - autoconf 2.5 does not create anything in configure. Instead the sole point
> of configure script is to create config.status - and it is config.status
> that finally does (should do) the job of creating files, making
> substitutions etc

Taking that, what we should probably do is have configure not create
any config.modules files but have it do the work of config.modules.sh,
putting the results directly into config.status in such a way that
config.status will create the config.modules file.

> What I intended was to allow modules to supply "configure plugins" to make
> whatever checks are needed; then configure could simply emit list modules to
> build without generating (mostly identical) makefile fragments for every
> module. Hmm ... it does look suspiciously similar to linux kernel, does not
> it? :)
> 
> But it is near to impossible to create such plugins as shell scripts
> (autoconf simply does not support it).
> 
> What is possible is to provide configure snippets and make Util/preconfig to
> generate modules.m4 that includes them' modules.m4 would then be included by
> zshconfig.ac. Unfortunately it is not easy to handle dependencies (i.e.
> module added or removed after modules.m4 has been created). 

I don't know much about how the linux kernel handles things. The idea
of having configure snippets that are included as part of zshconfig.ac
sounds good. Would allow us to separate out configure tests that are
specific to a module.

Peter wrote:
> Can someone confirm this is a suitable patch for removing support for
> old versions of autoconf, together with deleting configure.in which I
> will commit at the same time?

That does solve the problem I had because config.status no longer
writes out a crap config.modules. Only trouble is that, as Bart points
out, those lines are needed when someone runs just config.status.

I suggest you go ahead with the rest of the patch. Except there's a
typo (arlier) and you could also merge zshconfig.ac into configure.ac -
there's no need for a separate file.

Oliver

