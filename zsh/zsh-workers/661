From zsh-workers-request@math.gatech.edu  Thu Nov 30 05:15:04 1995
Received: from math.gatech.edu (euclid.skiles.gatech.edu [130.207.146.50]) by werple.net.au (8.7/8.7.1) with SMTP id FAA13969 for <mason@werple.mira.net.au>; Thu, 30 Nov 1995 05:15:00 +1100 (EST)
Received: by math.gatech.edu (5.x/SMI-SVR4)
	id AA13388; Wed, 29 Nov 1995 12:47:26 -0500
Resent-Date: Wed, 29 Nov 1995 18:21:59 +0100 (MET)
Old-Return-Path: <heiko@pc73121.dialup.rwth-aachen.de>
Date: Wed, 29 Nov 1995 18:21:59 +0100 (MET)
From: Heiko Schroeder <heiko@pc73121.dialup.rwth-aachen.de>
Subject: zsh-2.6beta12 bug
To: zsh-workers@math.gatech.edu
Reply-To: Heiko Schroeder <heiko@Pool.Informatik.RWTH-Aachen.DE>
Message-Id: 
 <Pine.LNX.3.91.951129182113.747A-100000@pc73121.dialup.rwth-aachen.de>
Mime-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Content-Transfer-Encoding: 7BIT
Resent-Message-Id: <"jwoX-.0.6H3.jo9lm"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/661
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu


Hi!

I think I found a small bug in zsh-2.6beta12: the shell won't correctly
process input lines with 8 bit (Latin-1) characters. Processing seems to
stop at the character with it and the rest of the line being discarded.

The cause seems to be line 130 of input.c. The line

	    return lastc = (unsigned)*inbufptr++;

near the beginning of ingetc() should read:

	    return lastc = (unsigned char)*inbufptr++;

The original line may still produce a negative value for characters which
have bit 7 set. (At least with gcc 2.7.0 on a i486 running linux, I
couldn't test it under different environments.)

Perhaps it would be even cleaner to change the declaration of inbufptr
to "unsigned char *" instead of "char *".

CU
   Heiko

PS: I'm not subscribed to this maling list.

--
+----------------------------------------+------------------------------------+
|Email:                                  | Snail-mail:  Heiko Schroeder       |
|                                        |              Lerchenweg 120        |
|  heiko@pool.informatik.rwth-aachen.de  |              52223 Stolberg        |
|                                        |              GERMANY               |
+----------------------------------------+------------------------------------+

