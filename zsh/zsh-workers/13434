From zsh-workers-return-13434-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 07 04:24:26 2001
Return-Path: <zsh-workers-return-13434-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6817 invoked from network); 7 Feb 2001 04:24:25 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 7 Feb 2001 04:24:25 -0000
Received: (qmail 22943 invoked by alias); 7 Feb 2001 04:23:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13434
Received: (qmail 22923 invoked from network); 7 Feb 2001 04:23:53 -0000
Sender: ethersoft@rcn.com
To: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Cc: zsh-workers@sunsite.dk
Subject: Re: 53completion.ztst (Re: zregexparse.ztst fails with latest CVS)
References: <1010206202315.ZM4635@candle.brasslantern.com>
	<1010207025802.ZM20171@candle.brasslantern.com>
From: Vin Shelton <acs@alumni.princeton.edu>
Organization: EtherSoft, Inc
Date: 06 Feb 2001 23:28:18 -0500
In-Reply-To: <1010207025802.ZM20171@candle.brasslantern.com>
Message-ID: <m2ofwfqfq5.fsf@zion.rcn.com>
Lines: 73
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

I don't see this on my Mandrake 7.1 system.  uname -a reports:
  Linux zion.rcn.com 2.2.18 #2 SMP Mon Dec 11 21:52:20 EST 2000 i686 unknown

Built from latest CVS sources, with gcc--version ==> 2.95.3

Every test reports 'all tests successful'.

rpm -a glibc ==> glibc-2.1.3-17mdk

in case that helps.

  - vin

"Bart Schaefer" <schaefer@candle.brasslantern.com> writes:
> On Feb 6,  8:23pm, Bart Schaefer wrote:
> } Subject: zregexparse.ztst fails with latest CVS
> }
> } It goes into an infinite loop getting an I/O error on read, according to
> } strace.  This is with the standard default dynamic linkage.
> 
> This is on linux, redhat 5.2; sorry for not mentioning it sooner.
> 
> It's not the zregexparse test, it's the completion test.
> 
> With ZTST_verbose=1, I get to:
> 
> ...
> ../../zsh-3.1.6/Test/52zregexparse.ztst: all tests successful.
> Running test: directories and files
> 
> and then it hangs forever.  It appears that the zsh started on the zpty
> slave has died, leaving zpty in a read loop getting I/O error.
> 
> A statically linked zsh passes all tests successfully.
> 
> I noticed that "make clean" doesn't remove the module .so files, so I
> explicitly blew them away and rebuilt.  Makes no difference.
> 
> Tricking comptest into attaching an strace to the zsh on the pty, I find
> this (after reams of output):
> 
> 10480 open("/usr/src/local/zsh/zsh-3.1.6-dynamic/Test/../../zsh-3.1.6/Test/../Completion/Core/_setup", O_RDONLY|O_NOCTTY) = 7
> 10480 lseek(7, 0, SEEK_END)             = 1941
> 10480 lseek(7, 0, SEEK_SET)             = 0
> 10480 read(7, "#autoload\n\nlocal val nm=\"$com"..., 1941) = 1941
> 10480 close(7)                          = 0
> 10480 sigprocmask(SIG_BLOCK, [CHLD], [CHLD]) = 0
> 10480 sigprocmask(SIG_BLOCK, [CHLD], [CHLD]) = 0
> 10480 sigprocmask(SIG_UNBLOCK, [CHLD], [CHLD]) = 0
> 10480 sigprocmask(SIG_BLOCK, [CHLD], []) = 0
> 10480 sigprocmask(SIG_BLOCK, [CHLD], [CHLD]) = 0
> 10480 sigprocmask(SIG_BLOCK, [CHLD], [CHLD]) = 0
> 10480 sigprocmask(SIG_UNBLOCK, [CHLD], [CHLD]) = 0
> 10480 sigprocmask(SIG_BLOCK, [CHLD], []) = 0
> 10480 --- SIGSEGV (Segmentation fault) ---
> 10480 +++ killed by SIGSEGV +++
> 
> I was able to locate the core file, here's a partial stack trace:
> 
> (gdb) where 
> #0  0x1d42 in ?? ()
> #1  0x808a3a8 in dyn_boot_module (m=0x80d6fa0)
>     at ../../zsh-3.1.6/Src/module.c:625
> #2  0x808a525 in boot_module (m=0x80d6fa0) at ../../zsh-3.1.6/Src/module.c:677
> #3  0x808b263 in load_module (name=0x80de630 "zsh/complist")
>     at ../../zsh-3.1.6/Src/module.c:846
> 
> 
> -- 
> Bart Schaefer                                 Brass Lantern Enterprises
> http://www.well.com/user/barts              http://www.brasslantern.com
> 
> Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

