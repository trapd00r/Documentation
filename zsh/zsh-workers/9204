From zsh-workers-return-9204-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Jan 04 16:07:14 2000
Return-Path: <zsh-workers-return-9204-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15370 invoked from network); 4 Jan 2000 16:07:13 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 4 Jan 2000 16:07:13 -0000
Received: (qmail 20049 invoked by alias); 4 Jan 2000 16:07:06 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9204
Received: (qmail 20042 invoked from network); 4 Jan 2000 16:07:06 -0000
Date: Tue, 04 Jan 2000 17:06:50 +0100
From: jarausch@igpm.rwth-aachen.de
Subject: Re: PATCH: struct heap 64-bit
In-reply-to: <20000104105536.A8967@dman.com>
To: schizo@debian.org
Cc: zsh-workers@sunsite.auc.dk
Reply-to: jarausch@igpm.rwth-aachen.de
Message-id: <200001041606.RAA72897@numa1.igpm.rwth-aachen.de>
MIME-version: 1.0
Content-type: TEXT/plain; charset=us-ascii

On  4 Jan, Clint Adams wrote:
>> What's the intent?
> 
> Helmut fixed this in 9186 but the patch was reversed.
> 
> This just gets rid of the overcompensation altogether.
> Incidentally, this solves the bus error problem I was
> experiencing on 64-bit SPARC Linux.
> 
> Index: Src/zsh.h
> ===================================================================
> RCS file: /cvs/zsh/zsh/Src/zsh.h,v
> retrieving revision 1.1.1.39
> diff -u -r1.1.1.39 zsh.h
> --- Src/zsh.h	1999/12/17 12:18:28	1.1.1.39
> +++ Src/zsh.h	2000/01/04 15:51:39
> @@ -1559,9 +1559,6 @@
>      size_t size;		/* size of heap                              */
>      size_t used;		/* bytes used from the heap                  */
>      struct heapstack *sp;	/* used by pushheap() to save the value used */
> -#ifdef PAD_64_BIT
> -    size_t dummy;		/* Make sure sizeof(heap) is a multiple of 8 */
> -#endif
>  #define arena(X)	((char *) (X) + sizeof(struct heap))
>  };
>  

I don't think this is a good solution.
My patch added a comment and left the code commented.
When somebody adds a new member to struct heap next time, he/she will
then be reminded to reenable that code to pad the struct to a multiple
of 64 bits.

Helmut.

-- 
Helmut Jarausch
Lehrstuhl fuer Numerische Mathematik
Institute of Technology, RWTH Aachen
D 52056 Aachen, Germany

