From zsh-users-return-6426-mason-zsh=primenet.com.au@sunsite.dk Fri Aug 01 15:35:49 2003
Return-Path: <zsh-users-return-6426-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13985 invoked from network); 1 Aug 2003 15:35:49 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 1 Aug 2003 15:35:49 -0000
Received: (qmail 29328 invoked by alias); 1 Aug 2003 15:35:32 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 6426
Received: (qmail 29316 invoked from network); 1 Aug 2003 15:35:32 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 1 Aug 2003 15:35:32 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [193.109.254.211] by sunsite.dk (MessageWall 1.0.8) with SMTP; 1 Aug 2003 15:35:31 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-22.tower-36.messagelabs.com!1059737728!103957
X-StarScan-Version: 5.0.7; banners=.,-,-
Received: (qmail 30731 invoked from network); 1 Aug 2003 11:35:28 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-22.tower-36.messagelabs.com with SMTP; 1 Aug 2003 11:35:28 -0000
Received: from gmcs3.local ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id h71BZS3l018822;
	Fri, 1 Aug 2003 12:35:28 +0100
Received: from gmcs3.local (localhost [127.0.0.1])
	by gmcs3.local (8.11.6/8.11.6/SuSE Linux 0.5) with ESMTP id h71Bawg03540;
	Fri, 1 Aug 2003 13:36:58 +0200
cc: zsh-users@sunsite.dk
In-reply-to: <m2k7a59qfb.fsf@nielsen.fdns.net> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <m2k7a59qfb.fsf@nielsen.fdns.net>
To: Erik Toubro Nielsen <erik@nielsen.fdns.net>
Subject: Re: completion after -- 
Date: Fri, 01 Aug 2003 13:36:58 +0200
Message-ID: <3538.1059737818@gmcs3.local>

On 26 Jul, Erik Toubro Nielsen wrote:
> Assume a command line, where the option --files mean that at least one
> filename can be given after '--'
> 
>    cmd --files --other-options  ARG1 -- filenames...
> 
> (without --files the command line is
>    cmd --other-options  ARG1 
> )
> 
> The _arguments function does not seem applicable.

_arguments is applicable but it isn't sufficient on it's own.

> Any hints on how to write a completion function _cmd for this?

Check for --files and -- before calling _arguments:

local -a args
if (( ${+words[(r)--files]} && ${+words[(r)--]} && words[(i)--] < CURRENT ))
then
  _wanted files expl file _files
else
  _arguments '--files' '--other-options' ':arg1:(ARG1)'
fi

That also checks that the `--' is before the cursor.

Oliver

________________________________________________________________________
This email has been scanned for all viruses by the MessageLabs Email
Security System. For more information on a proactive email security
service working around the clock, around the globe, visit
http://www.messagelabs.com
________________________________________________________________________

