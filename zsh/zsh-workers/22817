From zsh-workers-return-22817-mason-zsh=primenet.com.au@sunsite.dk Wed Oct 04 14:41:27 2006
Return-Path: <zsh-workers-return-22817-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20446 invoked from network); 4 Oct 2006 14:41:21 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.5 (2006-08-29) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 4 Oct 2006 14:41:21 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 91191 invoked from network); 4 Oct 2006 14:41:13 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Oct 2006 14:41:13 -0000
Received: (qmail 12329 invoked by alias); 4 Oct 2006 14:41:10 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22817
Received: (qmail 12316 invoked from network); 4 Oct 2006 14:41:09 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 4 Oct 2006 14:41:09 -0000
Received: (qmail 90880 invoked from network); 4 Oct 2006 14:41:09 -0000
Received: from ms-2.rz.rwth-aachen.de (HELO ms-dienst.rz.rwth-aachen.de) (134.130.3.131)
  by a.mx.sunsite.dk with SMTP; 4 Oct 2006 14:41:05 -0000
Received: from r220-1 (r220-1.rz.RWTH-Aachen.DE [134.130.3.31])
 by ms-dienst.rz.rwth-aachen.de
 (iPlanet Messaging Server 5.2 Patch 2 (built Jul 14 2004))
 with ESMTP id <0J6M00C1M8SEQ5@ms-dienst.rz.rwth-aachen.de> for
 zsh-workers@sunsite.dk; Wed, 04 Oct 2006 16:41:03 +0200 (MEST)
Received: from relay.rwth-aachen.de ([134.130.3.1])
	by r220-1 (MailMonitor for SMTP v1.2.2 ) ; Wed,
 04 Oct 2006 16:41:02 +0200 (MEST)
Received: from fsst.voodoo.lan ([212.117.84.166])
	by relay.rwth-aachen.de (8.13.7/8.13.3/1) with ESMTP id k94Ef0re028028	for
 <zsh-workers@sunsite.dk>; Wed, 04 Oct 2006 16:41:01 +0200 (MEST)
Received: from hawk by fsst.voodoo.lan with local (Exim 4.63)
	(envelope-from <ft@bewatermyfriend.de>)
	id 1GV7ut-0006Fd-1S	for zsh-workers@sunsite.dk; Wed, 04 Oct 2006 16:40:11 +0200
Date: Wed, 04 Oct 2006 16:40:11 +0200
From: Frank Terbeck <ft@bewatermyfriend.de>
Subject: PATCH: _aptitude
To: zsh workers <zsh-workers@sunsite.dk>
Mail-followup-to: zsh workers <zsh-workers@sunsite.dk>
Message-id: <20061004144010.GB7744@fsst.voodoo.lan>
MIME-version: 1.0
Content-type: text/plain; charset=iso-8859-1
Content-transfer-encoding: 7BIT
Content-disposition: inline
Operating-System: Linux 2.6.16.16 i686
User-Agent: Mutt/1.5.13 (2006-08-11)

Hi workers,
this patch updates the _aptitude completion.

--- _aptitude.orig	2006-10-03 20:20:54.000000000 +0200
+++ _aptitude	2006-10-04 16:34:56.000000000 +0200
@@ -2,11 +2,22 @@
 
 local curcontext="$curcontext" state line cmds ret=1
 
+function _aptitude_release() {
+  #{{{
+  local expl releases
+  releases=(
+${${(M)${(f)"$(</etc/apt/sources.list)"}\
+:#[ $'\t']#deb(|-src)*}/(#b)[ $'\t']#[^ $'\t']##[ $'\t']##[^ $'\t']##[ $'\t']##([^ $'\t']##)*/$match[1]}
+  )
+  _wanted list expl release compadd ${expl} - ${(u)releases}
+  #}}}
+}
+
 _arguments -C \
   '(- 1 *)'{-h,--help}'[display help information]' \
   '(- 1 *)--version[display version information]' \
   '(-s --simulate)'{-s,--simulate}'[print actions without performing them]' \
-  '(-d --download-only)'{-d,--download-only}"[just download packages - don't install]" \
+  '(-d --download-only)'{-d,--download-only}"[just download packages - don\'t install]" \
   '(-P --prompt)'{-P,--prompt}'[always display a prompt]' \
   '(-y --assume-yes)'{-y,--assume-yes}'[assume yes answer to questions]' \
   '(-F --display-format)'{-F,--display-format}'[specify output format for search command]:format' \
@@ -17,10 +28,18 @@
   '(-D --show-deps)'{-D,--show-deps}'[show brief explanations of automatic installations and removals]' \
   '-Z[show disk space changes for each package]' \
   '(-v --verbose)'{-v,--verbose}'[causes some commands to display extra information]' \
-  '(--without-recommends)--with-recommends[install recommended packages when installing new packages]' \
+  '(-R --without-recommends)'{-R,--with-recommends}'[install recommended packages when installing new packages]' \
   '(--without-suggests)--with-suggests[install suggested packages when installing new packages]' \
-  '(--with-recommends)--without-recommends[ignore recommended packages when installing new packages]' \
+  '(-r --with-recommends)'{-r,--without-recommends}'[ignore recommended packages when installing new packages]' \
   '(--with-suggests)--without-suggests[ignore suggested packages when installing new packages]' \
+  '(-t --target-release)'{-t,--target-release}'[set the release from which packages should be installed]:release:_aptitude_release' \
+  '(-q --quiet)'{-q=,--quiet=}'[less Output]:level' \
+  '--schedule-only[schedule operations to be performed in the future]' \
+  '--purge-unused[purge unused packages instead of removing]' \
+  '--visual-preview[start up the visual interface and display its preview screen]' \
+  '-S[load the extended state information from non-standard state file]:state file:_files' \
+  '-u[begin updating the package lists as soon as the program starts]' \
+  '-i[displays a download preview when the program starts]' \
   '1: :->cmds' \
   '*: :->args' && ret=0
 

