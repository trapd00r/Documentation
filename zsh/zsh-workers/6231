From zsh-workers-return-6231-mason-zsh=primenet.com.au@sunsite.auc.dk Fri May 07 10:33:35 1999
Return-Path: <zsh-workers-return-6231-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15920 invoked from network); 7 May 1999 10:33:32 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 7 May 1999 10:33:32 -0000
Received: (qmail 15638 invoked by alias); 7 May 1999 10:33:12 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6231
Received: (qmail 15631 invoked from network); 7 May 1999 10:33:11 -0000
Message-Id: <9905071008.AA38229@ibmth.df.unipi.it>
To: "Zsh hackers list" <zsh-workers@sunsite.auc.dk>
Subject: Re: Possible impact of RE: PATCH: large file support on SunOS 5 
In-Reply-To: ""Andrej Borsenkow""'s message of "Fri, 07 May 1999 12:57:39 DFT."
             <006a01be9867$a8b43b70$21c9ca95@mow.siemens.ru> 
Date: Fri, 07 May 1999 12:08:30 +0200
From: Peter Stephenson <pws@ibmth.df.unipi.it>

"Andrej Borsenkow" wrote:
> The LFS_CFLAGS (or, for that matter, LFS64_CFLAGS) make the off_t and ino_t
> 64 bit long. Dunno about Solaris, but at least on our system they are of
> type "long long" and there is no standard portable way to print 64 bit
> integers (if sizeof(long) < 8). Our system is using %lld; Solaris is using
> %qd if I'm not wrong.

This will take a little work, but perhaps it's not so bad.  off_t is
checked for in configure.  It needs to be propagated where it occurs in the
sources, e.g. in an .st_size member, instead of being assigned to longs (I
don't think that happens much anyway, but I could be wrong).  For printing,
one of %lld or %qd will probably work; there's already a test for %qd in
the rlim_t test in configure, which can be made more general.  ino_t isn't
tested in configure so probably needs adding in the same way.

I already have several things to finish off, so maybe someone else will
feel like looking at this first (although maybe hell will freeze over while
I wait :-)).

> P.S. I am running zsh in LP64 mode for quite a long time. This is different,
> as in this case all of off_t, ino_t and long are 8 bytes, so nothing in the
> code changes. May be, if a system supports LP64 we should prefer it to LFS?

I have no idea how to do this.

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

