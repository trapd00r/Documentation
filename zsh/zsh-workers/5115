Delivered-To: mason-zsh@primenet.com.au
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
Resent-Date: Sat, 30 Jan 1999 00:55:07 -0500 (EST)
Date: Sat, 30 Jan 1999 06:54:41 +0100
From: Drazen Kacar <dave@srce.hr>
To: Bart Schaefer <schaefer@brasslantern.com>
Cc: Peter Stephenson <pws@ibmth.df.unipi.it>, zsh-workers@math.gatech.edu,
        Drazen Kacar <dave@srce.hr>
Subject: Re: PATCH: (more) Re: PATCH: 3.1.5* & 3.0.5: Re: strange xterm & zsh behaviour
Message-ID: <19990130065441.A25646@jagor.srce.hr>
References: <9901290916.AA53082@ibmth.df.unipi.it> <990129105947.ZM7816@candle.brasslantern.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 0.95i
In-Reply-To: <990129105947.ZM7816@candle.brasslantern.com>; from Bart Schaefer on Fri, Jan 29, 1999 at 10:59:47AM -0800
X-Face: 'UIE}WabGB0+U>p-#(hp<_+AD2{H],=qR*jHfm$/e]l0(kU3oOYc5lqG6gg>[\h^IOc{'siD6#!T&loIShgmYHz3#+*D38:|`~\BE,(W~Ol9BDfDwk'lKJ;Z{sY8E9(ME.E]'wvNO`$n#,;9Z`tOFcW/nHZq!BOSrM>V?C<5DTw=<$<xxB~RP@|-Co<|COgeVi1ozw_W>{c{M2V+|)0jSUl&!+8%8nIBF(u:E>SZWM^e
X-Attribution: Dave
X-Windows: Microsoft's secret weapon.
Resent-Message-ID: <"1KKXR3.0.iX6.xwfis"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Resent-Sender: zsh-workers-request@math.gatech.edu
X-Mailing-List: <zsh-workers@sunsite.auc.dk> 5115

Bart Schaefer wrote:

> I think the following is better; apply it on top of Peter's patch.  Besides
> testing fds 0 and 1 for read-write-ness before using them (when possible),
> it also prefers ttyname(SHTTY) to "/dev/tty" for the setting of the $TTY
> parameter.

Since I don't have the latest zsh development source tree, could you
integrate this one in:

#ifdef TIOCNXCL
if(open("dev/tty", O_RDWR) < 0 && errno == EBUSY)
   ioctl(0, TIOCNXCL, 0);
#endif

That will unlock terminal device (at least on Solaris) and something
should really do that (preferrably the shell). TIOCNXCL is defined in
termios.h.

-- 
 .-.   .-.    Life is a sexually transmitted disease.
(_  \ /  _)
     |        dave@srce.hr
     |        dave@fly.cc.fer.hr


