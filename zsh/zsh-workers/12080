From zsh-workers-return-12080-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Jun 27 07:10:43 2000
Return-Path: <zsh-workers-return-12080-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3818 invoked from network); 27 Jun 2000 07:10:43 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 27 Jun 2000 07:10:43 -0000
Received: (qmail 16074 invoked by alias); 27 Jun 2000 07:10:16 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12080
Received: (qmail 16067 invoked from network); 27 Jun 2000 07:10:15 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer david.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "ZSH workers mailing list" <zsh-workers@sunsite.auc.dk>
Subject: PATCH: zpty for Cygwin and strange Zsh test hanger
Date: Tue, 27 Jun 2000 11:10:12 +0400
Message-ID: <000001bfe006$bc2cc720$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="koi8-r"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2919.6700
Importance: Normal

Cygwin is using SVR4-style ptys without STREAMS support. The attached
patch makes it possible to compile zpty.c under Cygwin. I can also start
bash as subprocess and read/write there. Unfortunately, both completion
tests and nslookup function hang unde Cygwin. I was not able to use gdb
(it does not show even stacktrace), but I decided to try a single
testsuite under Unix ... and to my surpise it hung there as well. Look
(this is after installing new zsh, so it must be identical with what is
built using ``make check''):

bor@itsrm2% cd Test; ZTST_verbose=10 ../Src/zsh -f
/tools/src/zsh/Test/ztst.zsh
/tools/src/zsh/Test/53completion.ztst
ZTST_getsect: read section name: prep
ZTST_getchunk: read code chunk:
  . $ZTST_srcdir/comptest
ZTST_execchunk: status 0
ZTST_getchunk: read code chunk:
  mkdir comp.tmp
  cd comp.tmp
ZTST_execchunk: status 0
ZTST_getchunk: read code chunk:
  comptestinit -z $ZTST_testdir/../Src/zsh
ZTST_execchunk: status 0
ZTST_getchunk: read code chunk:
  mkdir dir1
  mkdir dir2
  touch file1
  touch file2
ZTST_execchunk: status 0
ZTST_getchunk: read code chunk:

ZTST_getsect: read section name: test
ZTST_test: looking for new test
ZTST_test: examining line:

ZTST_test: examining line:
  comptest $':                                                  '
ZTST_getchunk: read code chunk:
  comptest $':                                                  '
ZTST_test: examining line:
>line: {: }{}
ZTST_getredir: read redir for '>':
line: {: }{}
DESCRIPTION:{file}
DI:{dir1}
DI:{dir2}
FI:{file1}
FI:{file2}
line: {: dir1/}{}
line: {: dir2/}{}
line: {: file1}{}
line: {: file2}{}
line: {: dir1/}{}
line: {: dir2/}{}
ZTST_test: examining line:

Running test: directories and files
ZTST_test: expecting status: 0


It does NOT hang if I run ``make check''!

Any idea?

-andrej

Have a nice DOS!
B >>

