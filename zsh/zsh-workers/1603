From pws@ifh.de Thu Jul 11 18:22:20 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3/2) with ESMTP id SAA03583 for <mason@werple.mira.net.au>; Thu, 11 Jul 1996 18:22:18 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id EAA16046; Thu, 11 Jul 1996 04:12:55 -0400 (EDT)
Resent-Date: Thu, 11 Jul 1996 04:12:55 -0400 (EDT)
Message-Id: <199607110811.KAA16695@hydra.ifh.de>
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: Re: Remaining zsh3.0-pre2 bugs 
In-reply-to: "huyle@chop.ugcs.caltech.edu"'s message of "Sat, 06 Jul 1996 15:59:25 MET."
             <199607062259.PAA11588@envy.ugcs.caltech.edu> 
Date: Thu, 11 Jul 1996 10:11:43 +0200
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"bDFFL2.0.ew3.6UBvn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1603
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 1370
Status: OR

huyle@chop.ugcs.caltech.edu wrote:
> When running either of the two sequences:
>   while echo crap >/dev/null; do done
>   while true; do echo crap >/dev/null; done
> and interrupting them with <CTRL>-C, my output gets lost from then on.
> This is an intermittent problem on HP-UX--keep doing it and eventually
> it'll happen. On IRIX, the bug has happened to me every time.
> 
> pride% while echo crap >/dev/null; do done
> pride% echo yes
> pride% exec >/dev/tty
> pride% echo yes
> yes
> pride%

This exists not just under those systems, but under Solaris 2.5 too,
so it's probably not a system problem.  It occurs probably more than
half the time; changing > to >> doesn't help.  It's clear that if zsh
is interrupted somewhere or other the fd's don't get restored
properly.  Running it under gdb, the most common places for an
interruption are in the original open() for the redirection, or the
close() either in movefd() or in redup().  I've put in all sorts of
tests to look for bad returns from system functions like these, tried
blocking interrupts around the redirection code and fixfds(), and none
of it has done any good.

Help

-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77330
Deutches Electronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.


