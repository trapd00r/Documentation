From zsh-workers-return-14627-mason-zsh=primenet.com.au@sunsite.dk Thu May 31 19:03:17 2001
Return-Path: <zsh-workers-return-14627-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9913 invoked from network); 31 May 2001 19:03:16 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 31 May 2001 19:03:16 -0000
Received: (qmail 15860 invoked by alias); 31 May 2001 19:03:08 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14627
Received: (qmail 15849 invoked from network); 31 May 2001 19:03:07 -0000
Date: Thu, 31 May 2001 21:03:08 +0200 (DFT)
From: Jens Schleusener <Jens.Schleusener@debis-sfr.de>
To: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: zsh-4.0.1-pre-[45] compile problems under AIX 
In-Reply-To: <Tc0a88d0153dad562d3@mailsweeper01.cambridgesiliconradio.com>
Message-ID: <Pine.A41.3.96.1010531201932.83874A-100000@n05.sp.go.dlr.de>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 31 May 2001, Peter Stephenson wrote:

> Jens Schleusener wrote:
> > Hi,
> > 
> > I have problems to compile zsh-4.0.1-pre-4 and zsh-4.0.1-pre-5
> > under AIX 4.1.4 and 4.3.x.
> > 
> > I assume the problem is a local one (local gcc installation etc.) and
> > probably I have overseen something.
> 
> This could be a problem with the configure changes for termcap, so it might
> be serious.  First, however, does this happen with a completely clean
> distribution?  It's possible some of the attempts at fixing termcap/curses

Yes, I used a completely clean distribution.

> in the middle have confused configure.
> 
> Has anybody compiled successfully under AIX with zsh-4.0.1-pre-4 or
> zsh-4.0.1-pre-5?  If not, we need to fix this.
> 
> > Under AIX 4.1.4 (gcc 2.95.3) I got the following error:
> >
> > ...
> > gcc -c -I.  -DHAVE_CONFIG_H -I/usr/local/contrib/include  -o termcap.o
> > termcap.c
> > In file included from termcap.c:61:
> > /usr/include/term.h:1315: parse error before `SGTTY'
> 
> That probably means that curses.h hasn't been included.  Is
> TERM_H_NEEDS_CURSES_H defined in config.h?  If not we need to figure out

That was the point. TERM_H_NEEDS_CURSES_H was undefined. And the reason
seems to be an old curses.h file (63933 Bytes, Feb 14 1996 from a package
named "PDCurses") residing in a directory /usr/local/contrib/include (in
/usr/local/contrib the free software is installed on this machine). 
Compiling configure's "checking if term.h needs curses.h"-test-program
with the additional line

#include <curses.h>

failes with the inappropriate curses.h also. Remains the question why the
file /usr/local/contrib/include/curses.h was used instead of the standard
AIX /usr/include/curses.h? The answer may be (I am not familiar with the
configure process) that I forced (special reasons) for the configure run
the PATH to be PATH="/usr/local/contrib/bin:$PATH". Without that or with
renaming the strange /usr/local/contrib/include/curses.h zsh configures
and compiles well!

> why not.  In the generated file config.log, look for the message `checking
> if term.h needs curses.h'.  You should see some failure messages for an
> attempt to compile a programme which included term.h, but not curses.h
> (just what's happening in the failed compilation above), which triggers the
> symbol being defined.  It should be pretty difficult to get the compilation
> to succeed accidentally, though.
> 
> Looking at termcap.c, I can't see any other way of getting that particular
> error.

Greetings 

Jens

-- 
Dr. Jens Schleusener                T-Systems debis Systemhaus
phone: +49 (551) 709-2493           Solutions for Research
fax:   +49 (551) 709-2169           Bunsenstr.10
mail: Jens.Schleusener@debis-sfr.de D-37073 Goettingen

