From zsh-workers-return-7528-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Aug 29 07:35:27 1999
Return-Path: <zsh-workers-return-7528-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4481 invoked from network); 29 Aug 1999 07:35:26 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 29 Aug 1999 07:35:26 -0000
Received: (qmail 11486 invoked by alias); 29 Aug 1999 07:35:18 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7528
Received: (qmail 11479 invoked from network); 29 Aug 1999 07:35:18 -0000
Date: Sun, 29 Aug 1999 03:35:16 -0400
From: Will Day <willday@rom.oit.gatech.edu>
To: zsh workers mailing list <zsh-workers@sunsite.auc.dk>
Subject: prob: fg not sending CONT to 'make' children
Message-ID: <19990829033516.A27751@rom.oit.gatech.edu>
Reply-To: Will Day <willday@rom.oit.gatech.edu>
Mime-Version: 1.0
Content-Type: multipart/signed; boundary="HcAYCG3uE/tztfnV"; micalg=pgp-md5;
	protocol="application/pgp-signature"
X-Mailer: Mutt 0.95.3i
X-no-archive: yes


--HcAYCG3uE/tztfnV
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: quoted-printable

I ran into the following problem under 3.1.6 while doing a recompile; after
stopping (ctrl-Z) the make process, doing an 'fg' would not continue the
make process.  Looking at the process tree, the make itself is continued,
but its child process is still stopped.

Another datapoint is that I generally use a shell function to run make; if
I _don't_ use the function, it works properly.

Here's a distilled example:
	% cat Makefile
	  default:
	  	read i
	% zsh -f
	% echo $$
	1106
	% gm() {gmake $*}
	% gm
	read i
	^Zzsh: suspended  gm
	% fg
	[1]  + continued  gm

At this point, hitting return after return doesn't finish the make.

On another terminal:
	% /usr/proc/bin/ptree 1106
	220   /usr/local/sbin/sshd
	  21855 /usr/local/sbin/sshd
	    21858 -zsh
	      1106  zsh -f
	        1110  gmake
	          1111  /bin/sh -c read i
	        1113  zsh -f
	% truss -p 1106
	sigsuspend(0xEFFFEB48)          (sleeping...)
	% truss -p 1110
	wait()                          (sleeping...)
	% truss -p 1111
	    Stopped by signal #24, SIGTSTP, in read()
	% truss -p 1113
	    Stopped by signal #23, SIGSTOP

I found it odd that there's a second zsh process there (1113), and didn't
know what to make of it. =20

The problem doesn't occur under 3.1.5 (nor does the extra zsh process).
Looking through the code, it was clear things had changed quite a bit, but
I couldn't understand the code well enough to hazard a guess as to what's
causing the problem.

For reference, this is under Solaris 2.6, with zsh-3.1.6 (both with and
without dynamic-loading) as well as with zsh-3.1.6-pws-1.  Gmake is 3.71,
but it occurs with solaris /usr/ccs/bin/make as well.

--=20
Will Day     <PGP mail preferred>     OIT / O&E / Technical Support
willday@rom.oit.gatech.edu            Georgia Tech, Atlanta 30332-0715
  -> Opinions expressed are mine alone and do not reflect OIT policy <-
Those who would give up essential Liberty, to purchase a little temporary
Safety, deserve neither Liberty nor Safety.
    Benjamin Franklin, Pennsylvania Assembly, Nov. 11, 1755

--HcAYCG3uE/tztfnV
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: 2.6.3a
Comment: http://rom.oit.gatech.edu/~willday/pubkey.asc

iQCVAwUBN8jisxDHlOdPw2ZdAQHr+wP9HeG2leU0/zE1Fkgwg2HE4g/pgBO6mgJY
5lM6Zpn1wsnqGW4ba4cTD8OZdqMpcB4JA9fzAZ0ftMcqVWbTCcg05XFIEoev7JpN
yW7Lrt3OhytEJOfCDGvzsdeHWdERI4DYOgEdelwjltH1Mi0VMgJaA1SjxypK6pNi
lgapddl0QlA=
=+gkO
-----END PGP SIGNATURE-----

--HcAYCG3uE/tztfnV--

