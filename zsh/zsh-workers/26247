From zsh-workers-return-26247-mason-zsh=primenet.com.au@sunsite.dk Mon Jan 05 11:07:38 2009
Return-Path: <zsh-workers-return-26247-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15291 invoked from network); 5 Jan 2009 11:07:35 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.8 required=5.0 tests=AWL,BAYES_00,URIBL_SBL
	autolearn=no version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 Jan 2009 11:07:35 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 57754 invoked from network); 5 Jan 2009 11:07:30 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 Jan 2009 11:07:30 -0000
Received: (qmail 4411 invoked by alias); 5 Jan 2009 11:07:23 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26247
Received: (qmail 4400 invoked from network); 5 Jan 2009 11:07:23 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 5 Jan 2009 11:07:23 -0000
Received: from flock1.newmail.ru (flock1.newmail.ru [82.204.219.207])
	by bifrost.dotsrc.org (Postfix) with SMTP id AC0EF802720C
	for <zsh-workers@sunsite.dk>; Mon,  5 Jan 2009 12:07:18 +0100 (CET)
Received: (qmail 16708 invoked from network); 5 Jan 2009 11:07:19 -0000
Received: from unknown (HELO cooker.localnet) (arvidjaar@newmail.ru@91.77.130.231)
  by smtpd.newmail.ru with SMTP; 5 Jan 2009 11:07:19 -0000
From: Andrey Borzenkov <arvidjaar@mail.ru>
To: zsh-workers@sunsite.dk
Subject: [PATCH] cleanup for gcc -Werror=format-security
Date: Mon, 5 Jan 2009 14:07:02 +0300
User-Agent: KMail/1.10.92 (Linux/2.6.28-1avb; KDE/4.1.85; i686; ; )
MIME-Version: 1.0
Content-Type: multipart/signed;
  boundary="nextPart3426638.MHPL9RrmNC";
  protocol="application/pgp-signature";
  micalg=pgp-sha1
Content-Transfer-Encoding: 7bit
Message-Id: <200901051407.15757.arvidjaar@mail.ru>
X-Virus-Scanned: ClamAV 0.92.1/8835/Mon Jan  5 04:47:36 2009 on bifrost
X-Virus-Status: Clean

--nextPart3426638.MHPL9RrmNC
Content-Type: text/plain;
  charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline

Recently Mandriva switched to using -Wformat -Werror=3Dformat-security as=20
default build flags, this made configure and compilation fail with=20
"format not a string literal and no format arguments". The patch below=20
makes it work again. All tests still passed :)

Index: configure.ac
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /cvsroot/zsh/zsh/configure.ac,v
retrieving revision 1.114
diff -u -p -r1.114 configure.ac
=2D-- configure.ac	1 Dec 2008 12:26:25 -0000	1.114
+++ configure.ac	5 Jan 2009 11:04:25 -0000
@@ -1477,27 +1477,27 @@ if test x$zsh_cv_path_term_header !=3D xno
   fi
=20
   AC_MSG_CHECKING(if boolcodes is available)
=2D  AC_TRY_LINK($term_includes, [char **test =3D boolcodes;=20
printf(*test);],
+  AC_TRY_LINK($term_includes, [char **test =3D boolcodes; puts(*test);],
   AC_DEFINE(HAVE_BOOLCODES) boolcodes=3Dyes, boolcodes=3Dno)
   AC_MSG_RESULT($boolcodes)
   AC_MSG_CHECKING(if numcodes is available)
=2D  AC_TRY_LINK($term_includes, [char **test =3D numcodes; printf(*test);],
+  AC_TRY_LINK($term_includes, [char **test =3D numcodes; puts(*test);],
   AC_DEFINE(HAVE_NUMCODES) numcodes=3Dyes, numcodes=3Dno)
   AC_MSG_RESULT($numcodes)
   AC_MSG_CHECKING(if strcodes is available)
=2D  AC_TRY_LINK($term_includes, [char **test =3D strcodes; printf(*test);],
+  AC_TRY_LINK($term_includes, [char **test =3D strcodes; puts(*test);],
   AC_DEFINE(HAVE_STRCODES) strcodes=3Dyes, strcodes=3Dno)
   AC_MSG_RESULT($strcodes)
   AC_MSG_CHECKING(if boolnames is available)
=2D  AC_TRY_LINK($term_includes, [char **test =3D boolnames;=20
printf(*test);],
+  AC_TRY_LINK($term_includes, [char **test =3D boolnames; puts(*test);],
   AC_DEFINE(HAVE_BOOLNAMES) boolnames=3Dyes, boolnames=3Dno)
   AC_MSG_RESULT($boolnames)
   AC_MSG_CHECKING(if numnames is available)
=2D  AC_TRY_LINK($term_includes, [char **test =3D numnames; printf(*test);],
+  AC_TRY_LINK($term_includes, [char **test =3D numnames; puts(*test);],
   AC_DEFINE(HAVE_NUMNAMES) numnames=3Dyes, numnames=3Dno)
   AC_MSG_RESULT($numnames)
   AC_MSG_CHECKING(if strnames is available)
=2D  AC_TRY_LINK($term_includes, [char **test =3D strnames; printf(*test);],
+  AC_TRY_LINK($term_includes, [char **test =3D strnames; puts(*test);],
   AC_DEFINE(HAVE_STRNAMES) strnames=3Dyes, strnames=3Dno)
   AC_MSG_RESULT($strnames)
 else
Index: Src/Zle/zle_tricky.c
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_tricky.c,v
retrieving revision 1.97
diff -u -p -r1.97 zle_tricky.c
=2D-- Src/Zle/zle_tricky.c	12 Oct 2008 18:26:57 -0000	1.97
+++ Src/Zle/zle_tricky.c	5 Jan 2009 11:04:25 -0000
@@ -2286,7 +2286,7 @@ printfmt(char *fmt, int n, int dopr, int
 		case 'n':
 		    sprintf(nc, "%d", n);
 		    if (dopr)
=2D			fprintf(shout, nc);
+			fputs(nc, shout);
 		    cc +=3D MB_METASTRWIDTH(nc);
 		    break;
 		case 'B':


--nextPart3426638.MHPL9RrmNC
Content-Type: application/pgp-signature; name=signature.asc 
Content-Description: This is a digitally signed message part.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)

iEYEABECAAYFAklh6dkACgkQR6LMutpd94yKVwCeI9lnVRvKHvWMZW/NWLmSqwk7
MG4An3E/Tiy2yo0ro/zCR7fBwFpoTLzZ
=WFru
-----END PGP SIGNATURE-----

--nextPart3426638.MHPL9RrmNC--

