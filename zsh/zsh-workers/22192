From zsh-workers-return-22192-mason-zsh=primenet.com.au@sunsite.dk Fri Feb 03 22:48:35 2006
Return-Path: <zsh-workers-return-22192-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4541 invoked from network); 3 Feb 2006 22:48:34 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 3 Feb 2006 22:48:34 -0000
Received: (qmail 19638 invoked from network); 3 Feb 2006 22:48:28 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 3 Feb 2006 22:48:28 -0000
Received: (qmail 2290 invoked by alias); 3 Feb 2006 22:48:25 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22192
Received: (qmail 2270 invoked from network); 3 Feb 2006 22:48:24 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 3 Feb 2006 22:48:24 -0000
Received: (qmail 19465 invoked from network); 3 Feb 2006 22:48:24 -0000
Received: from lorien.comfychair.org (64.81.241.43)
  by a.mx.sunsite.dk with SMTP; 3 Feb 2006 22:48:23 -0000
Received: from lorien.comfychair.org (localhost [127.0.0.1])
	by lorien.comfychair.org (8.13.4/8.13.4) with ESMTP id k13MmHkA014031;
	Fri, 3 Feb 2006 14:48:17 -0800
Received: (from duvall@localhost)
	by lorien.comfychair.org (8.13.4/8.13.4/Submit) id k13MmHfs014030;
	Fri, 3 Feb 2006 14:48:17 -0800
Date: Fri, 3 Feb 2006 14:48:17 -0800
From: Danek Duvall <duvall@comfychair.org>
To: Peter Stephenson <p.w.stephenson@ntlworld.com>
Cc: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: PATCH: _hosts
Message-ID: <20060203224817.GF23141@lorien.comfychair.org>
Mail-Followup-To: Danek Duvall <duvall@comfychair.org>,
	Peter Stephenson <p.w.stephenson@ntlworld.com>,
	Zsh hackers list <zsh-workers@sunsite.dk>
References: <20060203194501.GC23141@lorien.comfychair.org> <200602032240.k13MekZj007527@pwslaptop.csr.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <200602032240.k13MekZj007527@pwslaptop.csr.com>
User-Agent: mutt-ng/devel-r535 (Linux)

On Fri, Feb 03, 2006 at 10:40:45PM +0000, Peter Stephenson wrote:

> > Is there some reason that _hosts uses the hosts tag, but _users doesn't use
> > the users tag?
> 
> I think it must be an oversight, given that the manual specifically
> mentions the existence of a users tag (as well as a users style).

Yup.  Though changing it now will break anyone who had it working with a
style with an empty tag.

> I'll commit the following...

Cool, thanks.  Just one nitty change:

> Index: Completion/Unix/Type/_hosts
> ===================================================================
> RCS file: /cvsroot/zsh/zsh/Completion/Unix/Type/_hosts,v
> retrieving revision 1.6
> diff -u -r1.6 _hosts
> --- Completion/Unix/Type/_hosts	3 Feb 2006 16:32:15 -0000	1.6
> +++ Completion/Unix/Type/_hosts	3 Feb 2006 22:34:33 -0000
> @@ -23,7 +23,7 @@
>      fi
>  
>      if [[ -r ~/.ssh/known_hosts ]]; then
> -      _cache_hosts+=( $(sed -e '/^[0-9]*\.[0-9]*\.[0-9]*\.[0-9]/d' -e 's/[ ,].*//p' ~/.ssh/known_hosts) )
> +      _cache_hosts+=(${${${(u)${(f)"$(<~/.ssh/known_hosts)"}%%[ ,]*}:#(#s)[0-9]##.[0-9]##.[0-9]##.[0-9]##(#e)}:#(#s)[0-9a-f:]##(#e)})
  +      _cache_hosts+=(${${${(u)${(f)"$(<~/.ssh/known_hosts)"}%%[ ,#]*}:#(#s)[0-9]##.[0-9]##.[0-9]##.[0-9]##(#e)}:#(#s)[0-9a-f:]##(#e)})

That is, remove everything after the first # as well, since the file can
have comments like that.

Thanks,
Danek

