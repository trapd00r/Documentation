From zsh-users-return-4004-mason-zsh=primenet.com.au@sunsite.dk Thu Jul 05 22:01:49 2001
Return-Path: <zsh-users-return-4004-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22145 invoked from network); 5 Jul 2001 22:01:48 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 5 Jul 2001 22:01:48 -0000
Received: (qmail 6517 invoked by alias); 5 Jul 2001 22:00:34 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4004
Received: (qmail 6499 invoked from network); 5 Jul 2001 22:00:33 -0000
Date: Fri, 6 Jul 2001 00:01:30 +0200
From: Sebastian Stark <seb@todesplanet.de>
To: zsh-users@sunsite.dk
Subject: DNS completion
Message-ID: <20010706000130.A7749@devel.todesplanet.de>
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="5mCyUwZo2JvN/JJP"
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
Sender: "Sebastian Stark,,," <seb@todesplanet.de>
X-Sender: 520099013841-0001@t-dialin.net


--5mCyUwZo2JvN/JJP
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

I wrote some code to support DNS zonetransfers in host completion.

It's a simple replacement for _hosts and it is not quite perfect yet.

You have to put a "search domain.com" line into /etc/resolv.conf and
need to have the "host" utility installed on your system.

Please let me know, what you think about it.

Also, I have two questions: How can I make libc calls directly from the
shell? You guess it: gethostbyname(2). Would it be possible to
substitute the awk usage with zsh parameter expansion?

please use reply-to, I'm not on the list.

-- 
1024D/DC805C44 2000-07-06 http://cran.ath.cx/~seb/publicpgpkey.asc 
key fingerprint A079 88E9 3617 838D ED65  A7D1 277D D529 DC80 5C44

--5mCyUwZo2JvN/JJP
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename=_hosts

#compdef ftp ping rwho rup xping traceroute host

local expl hosts

if ! zstyle -a ":completion:${curcontext}:hosts" hosts hosts; then
  (( $+_cache_hosts )) ||
      : ${(A)_cache_hosts:=${(s: :)${(ps:\t:)${${(f)~~"$(host -l $(awk '/search/ { print $2 }' < /etc/resolv.conf) 2>/dev/null | awk '{ print $3, $1}')"}%%\#*}##[:blank:]#[^[:blank:]]#}}}

  hosts=( "$_cache_hosts[@]" )
fi

_wanted hosts expl host \
    compadd -M 'm:{a-zA-Z}={A-Za-z} r:|.=* r:|=*' "$@" -a hosts

--5mCyUwZo2JvN/JJP--

