From zsh-workers-return-14057-mason-zsh=primenet.com.au@sunsite.dk Sat Apr 21 08:38:11 2001
Return-Path: <zsh-workers-return-14057-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1276 invoked from network); 21 Apr 2001 08:38:10 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 21 Apr 2001 08:38:10 -0000
Received: (qmail 5672 invoked by alias); 21 Apr 2001 08:38:02 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14057
Received: (qmail 5661 invoked from network); 21 Apr 2001 08:38:02 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer goliath.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "ZSH Workers Mailing List" <zsh-workers@sunsite.dk>
Subject: Zsh broken after the latest build patches
Date: Sat, 21 Apr 2001 12:37:57 +0400
Message-ID: <000701c0ca3e$5df90d80$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="koi8-r"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4133.2400
Importance: Normal

I do not know, which one exactly is responsible; but, I asked to hold off
these patches, there is nothing so important in any one of them ...

bor@itsrm2% print lsld.so: zsh: symbol not found: tgoto
zsh: killed     zsh

bor@itsrm2% nm /tools/lib/zsh/4.0.1-pre-3/zsh/zle.so | grep tgoto
[757]   |     49100|       0|  U  |GLOB |0    |UNDEF  |tgoto
bor@itsrm2% nm =zsh | grep tgoto
nothing

To remind - I have static libtermcap (a.k.a. libcurses a.k.a. libterminfo).
So, both main zsh modules *and* any module that is using them (zle, termcap,
terminfo, etc) must be linked with these modules. Before, both zsh main and
every module was linked with all libraries. Now what happens is:

Src/Zle/Makefile:

...
LIBS            = -ldl -lg -lc
...
zle.$(DL_EXT): $(MODDOBJS_zle) zle.export  $(dir_top)/Src/zsh.export
$(NOLINKMODS_zle)
        rm -f $@
        $(DLLINK) $(NXPIMP_zle) $(NNTRYOPT) $(MODDOBJS_zle) $(NOLINKMODS_zle)
$(LIBS)

Folks, the issue of dynamic linking is too complicated to be solved with one
patch. libtool was created for a reason. And definitely such changes should
not be done just before release. Please, backout these changes. I do not have
time currently to debug this (sorry), and I do not want zsh remain broken
here.

-andrej

Have a nice DOS!
B >>

