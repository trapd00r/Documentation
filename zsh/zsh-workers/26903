From zsh-workers-return-26903-mason-zsh=primenet.com.au@sunsite.dk Wed Apr 29 16:42:59 2009
Return-Path: <zsh-workers-return-26903-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27917 invoked from network); 29 Apr 2009 16:42:56 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 29 Apr 2009 16:42:56 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 50490 invoked from network); 29 Apr 2009 16:42:52 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 29 Apr 2009 16:42:52 -0000
Received: (qmail 12044 invoked by alias); 29 Apr 2009 16:42:48 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26903
Received: (qmail 12031 invoked from network); 29 Apr 2009 16:42:47 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 29 Apr 2009 16:42:47 -0000
Received: from cluster-d.mailcontrol.com (cluster-d.mailcontrol.com [85.115.60.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 07CF780EA0C0
	for <zsh-workers@sunsite.dk>; Wed, 29 Apr 2009 18:40:29 +0200 (CEST)
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly19d.srv.mailcontrol.com (MailControl) with ESMTP id n3TGgd5K001797
	for <zsh-workers@sunsite.dk>; Wed, 29 Apr 2009 17:42:39 +0100
Received: from news01.csr.com ([10.99.50.25]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Wed, 29 Apr 2009 17:42:38 +0100
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.2/8.13.4) with ESMTP id n3TGgcPa015908
	for <zsh-workers@sunsite.dk>; Wed, 29 Apr 2009 17:42:38 +0100
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.2/8.14.2/Submit) with ESMTP id n3TGgbj5015904
	for <zsh-workers@sunsite.dk>; Wed, 29 Apr 2009 17:42:37 +0100
Message-Id: <200904291642.n3TGgbj5015904@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: Re: PATCH: improve ${(q)...}
In-reply-to: <090429093553.ZM9854@torch.brasslantern.com>
References: <5191.1240937187@csr.com> <090428153749.ZM8596@torch.brasslantern.com> <200904290851.n3T8p3m8013327@news01.csr.com> <090429093553.ZM9854@torch.brasslantern.com>
Comments: In-reply-to Bart Schaefer <schaefer@brasslantern.com>
   message dated "Wed, 29 Apr 2009 09:35:53 -0700."
Date: Wed, 29 Apr 2009 17:42:37 +0100
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 29 Apr 2009 16:42:38.0150 (UTC) FILETIME=[8172F660:01C9C8E9]
X-Scanned-By: MailControl A_08_51_00 (www.mailcontrol.com) on 10.68.0.129
X-Virus-Scanned: ClamAV 0.92.1/9305/Wed Apr 29 15:43:01 2009 on bifrost
X-Virus-Status: Clean

Bart Schaefer wrote:
> On Apr 29,  9:51am, Peter Stephenson wrote:
> I'm not necessarily thinking of any specific example.  With the current
> code, ${(qqq)${(qq)v}} produces "'foo'" which still has single quotes
> after one level of quotes is stripped.  If that's combined with another
> string that also contains single quotes, whether by directly adjacent
> concatenation or by interpolation inside a double-quoted string, etc.,
> those quotes might mean something.

I still can't see how this can have an effect, but I think it's moot
anyway.

> } I won't rely on my expectation here---it's different with backslash
> } quoting anyway.  However, you've certainly spotted a case I hadn't where
> } this changes the behaviour.  I can look for different letters...
> } Hmm, we could use qQ which is currently meaningless as a sort of
> } shorthand for "minimal quoting"...?
> 
> What does (qqQQ) mean, then?  Or (qQq)?  It'd probably be better to pick
> something that currently isn't even valid syntax, like (q-) ... I was
> all set to suggest (q1) (q2) etc. but (q0) already means "split at NULL
> bytes and then quote".  However, (q-) raises the question of what (-q)
> means, and whether (-) by itself means anything; the only character that
> is currently "attached" to a preceding flag is ":" and (q:EXPR:) seems
> like overkill.

(q-) seems harmless and - on its own can be a syntax error as at
present.  I can't see any problem with that.  All this means as a
precedent is it would probably be better never to add - as a flag on its
own, which I can live with.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

