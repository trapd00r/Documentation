From zsh-workers-request@math.gatech.edu Wed Jun 03 09:15:03 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14705 invoked from network); 3 Jun 1998 09:15:02 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 3 Jun 1998 09:15:02 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id FAA28521;
	Wed, 3 Jun 1998 05:09:48 -0400 (EDT)
Resent-Date: Wed, 3 Jun 1998 05:09:48 -0400 (EDT)
Message-Id: <9806030909.AA17423@ibmth.df.unipi.it>
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Cc: "Bart Schaefer" <schaefer@brasslantern.com>
Subject: Re: Bugreport zsh 3.1.2: Shell exits prematurely after aborting history-incremental-search-backward 
In-Reply-To: ""Bart Schaefer""'s message of "Tue, 02 Jun 1998 10:41:16 DFT."
             <980602104116.ZM3619@candle.brasslantern.com> 
Date: Wed, 03 Jun 1998 11:09:14 +0200
From: Peter Stephenson <pws@ibmth.df.unipi.it>
Resent-Message-ID: <"gltJ5.0.az6.RBHTr"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4039
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

"Bart Schaefer" wrote:
> I don't follow how the value of lastc is related to what you describe.
> The only way it could possibly matter is if lastc == '\n'; space is the
> same as anything else, and the only reason it's set to space is to be
> something that won't compare equal to '\n'.  And at the point where all
> this is happening, it won't be '\n' to begin with.

In my case it is, because the shell has been through /etc/zshenv, and
the bug still occurs.  As lastc is simply a flag that data should be
flushed, it should arguably be initialised to '\n' anyway.  In any
case, it worries me that inputline() is setting lastc to space when it
fails, implying the last input character has changed when the whole
problem is it hasn't --- it's effectively setting the `there's input
data to flush' flag when it knows there isn't any.  That's why I think
the simplification is correct, even if there's something else wrong.

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 50 844536
WWW:  http://www.ifh.de/~pws/
Gruppo Teorico, Dipartimento di Fisica
Piazza Torricelli 2, 56100 Pisa, Italy

