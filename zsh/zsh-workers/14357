From zsh-workers-return-14357-mason-zsh=primenet.com.au@sunsite.dk Tue May 15 16:40:09 2001
Return-Path: <zsh-workers-return-14357-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14458 invoked from network); 15 May 2001 16:40:07 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 May 2001 16:40:07 -0000
Received: (qmail 15424 invoked by alias); 15 May 2001 16:39:58 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14357
Received: (qmail 15281 invoked from network); 15 May 2001 16:39:51 -0000
Date: Tue, 15 May 2001 09:39:18 -0700 (PDT)
From: Wayne Davison <wayned@users.sourceforge.net>
X-X-Sender:  <wayne@phong.blorf.net>
To: Zsh Workers <zsh-workers@sunsite.dk>
Subject: PATCH: history delayed drop
Message-ID: <Pine.LNX.4.33L2.0105150933500.22483-200000@phong.blorf.net>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-1463796991-216954071-989944758=:22483"

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---1463796991-216954071-989944758=:22483
Content-Type: TEXT/PLAIN; charset=US-ASCII

OK, the general consensus I got was that everyone could either live
with or endorse the delayed-drop history change without an extra
option, so I've left it off (we can always add it later, if needed).

Since we still seem to be tweaking several things in zsh prior to
release, I have done some release testing of my patch, uncovered
one more bug, tested it some more, and then checked it into CVS.
Appended is the diff of what I did.

..wayne..

---1463796991-216954071-989944758=:22483
Content-Type: TEXT/PLAIN; charset=US-ASCII; name="hist.patch"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.33L2.0105150939180.22483@phong.blorf.net>
Content-Description: Delayed drop
Content-Disposition: attachment; filename="hist.patch"

SW5kZXg6IERvYy9ac2gvb3B0aW9ucy55bw0KQEAgLTU0NCwxOCArNTQ0LDI4
IEBADQogcGluZGV4KEhJU1RfSUdOT1JFX1NQQUNFKQ0KIGNpbmRleChoaXN0
b3J5LCBpZ25vcmluZyBzcGFjZXMpDQogaXRlbSh0dChISVNUX0lHTk9SRV9T
UEFDRSkgKHR0KC1nKSkpKA0KLURvIG5vdCBlbnRlciBjb21tYW5kIGxpbmVz
IGludG8gdGhlIGhpc3RvcnkgbGlzdA0KLWlmIHRoZSBmaXJzdCBjaGFyYWN0
ZXIgb24gdGhlIGxpbmUgaXMgYSBzcGFjZSwgb3IgaWYgb25lIG9mDQotdGhl
IGV4cGFuZGVkIGFsaWFzZXMgY29udGFpbmVkIGEgbGVhZGluZyBzcGFjZS4N
CitSZW1vdmUgY29tbWFuZCBsaW5lcyBmcm9tIHRoZSBoaXN0b3J5IGxpc3Qg
d2hlbiB0aGUgZmlyc3QgY2hhcmFjdGVyIG9uDQordGhlIGxpbmUgaXMgYSBz
cGFjZSwgb3Igd2hlbiBvbmUgb2YgdGhlIGV4cGFuZGVkIGFsaWFzZXMgY29u
dGFpbnMgYQ0KK2xlYWRpbmcgc3BhY2UuDQorTm90ZSB0aGF0IHRoZSBjb21t
YW5kIGxpbmdlcnMgaW4gdGhlIGludGVybmFsIGhpc3RvcnkgdW50aWwgdGhl
IG5leHQNCitjb21tYW5kIGlzIGVudGVyZWQgYmVmb3JlIGl0IHZhbmlzaGVz
LCBhbGxvd2luZyB5b3UgdG8gYnJpZWZseSByZXVzZQ0KK29yIGVkaXQgdGhl
IGxpbmUuICBJZiB5b3Ugd2FudCB0byBtYWtlIGl0IHZhbmlzaCByaWdodCBh
d2F5IHdpdGhvdXQNCitlbnRlcmluZyBhbm90aGVyIGNvbW1hbmQsIHR5cGUg
YSBzcGFjZSBhbmQgcHJlc3MgcmV0dXJuLg0KICkNCiBwaW5kZXgoSElTVF9O
T19GVU5DVElPTlMpDQogaXRlbSh0dChISVNUX05PX0ZVTkNUSU9OUykpKA0K
LURvIG5vdCBzdG9yZSBmdW5jdGlvbiBkZWZpbml0aW9ucyBpbiB0aGUgaGlz
dG9yeSBsaXN0Lg0KK1JlbW92ZSBmdW5jdGlvbiBkZWZpbml0aW9ucyBmcm9t
IHRoZSBoaXN0b3J5IGxpc3QuDQorTm90ZSB0aGF0IHRoZSBmdW5jdGlvbiBs
aW5nZXJzIGluIHRoZSBpbnRlcm5hbCBoaXN0b3J5IHVudGlsIHRoZSBuZXh0
DQorY29tbWFuZCBpcyBlbnRlcmVkIGJlZm9yZSBpdCB2YW5pc2hlcywgYWxs
b3dpbmcgeW91IHRvIGJyaWVmbHkgcmV1c2UNCitvciBlZGl0IHRoZSBkZWZp
bml0aW9uLg0KICkNCiBwaW5kZXgoSElTVF9OT19TVE9SRSkNCiBpdGVtKHR0
KEhJU1RfTk9fU1RPUkUpKSgNCi1SZW1vdmUgdGhlIHR0KGhpc3RvcnkpICh0
dChmYyAtbCkpIGNvbW1hbmQgZnJvbQ0KLXRoZSBoaXN0b3J5IHdoZW4gaW52
b2tlZC4NCitSZW1vdmUgdGhlIHR0KGhpc3RvcnkpICh0dChmYyAtbCkpIGNv
bW1hbmQgZnJvbSB0aGUgaGlzdG9yeSBsaXN0DQord2hlbiBpbnZva2VkLg0K
K05vdGUgdGhhdCB0aGUgY29tbWFuZCBsaW5nZXJzIGluIHRoZSBpbnRlcm5h
bCBoaXN0b3J5IHVudGlsIHRoZSBuZXh0DQorY29tbWFuZCBpcyBlbnRlcmVk
IGJlZm9yZSBpdCB2YW5pc2hlcywgYWxsb3dpbmcgeW91IHRvIGJyaWVmbHkg
cmV1c2UNCitvciBlZGl0IHRoZSBsaW5lLg0KICkNCiBwaW5kZXgoSElTVF9S
RURVQ0VfQkxBTktTKQ0KIGl0ZW0odHQoSElTVF9SRURVQ0VfQkxBTktTKSko
DQpJbmRleDogU3JjL2hhc2h0YWJsZS5jDQpAQCAtMTQ4MCwxMCArMTQ4MCwx
MSBAQA0KICAgICBIYXNoTm9kZSBvbGRub2RlID0gYWRkaGFzaG5vZGUyKGh0
LCBuYW0sIG5vZGVwdHIpOw0KICAgICBIaXN0ZW50IGhlID0gKEhpc3RlbnQp
bm9kZXB0cjsNCiAgICAgaWYgKG9sZG5vZGUgJiYgb2xkbm9kZSAhPSAoSGFz
aE5vZGUpbm9kZXB0cikgew0KLQlpZiAoaGUtPmZsYWdzICYgSElTVF9NQUtF
VU5JUVVFDQorCWlmIChoZS0+ZmxhZ3MgJiAoSElTVF9NQUtFVU5JUVVFIHwg
SElTVF9UTVBTVE9SRSkNCiAJIHx8IChoZS0+ZmxhZ3MgJiBISVNUX0ZPUkVJ
R04gJiYgKEhpc3RlbnQpb2xkbm9kZSA9PSBoZS0+dXApKSB7DQorCSAgICAo
dm9pZCkgYWRkaGFzaG5vZGUyKGh0LCBvbGRub2RlLT5uYW0sIG9sZG5vZGUp
OyAvKiByZXN0b3JlIGhhc2ggKi8NCiAJICAgIGhlLT5mbGFncyB8PSBISVNU
X0RVUDsNCi0JICAgIGFkZGhhc2hub2RlKGh0LCBvbGRub2RlLT5uYW0sIG9s
ZG5vZGUpOyAvKiBSZW1vdmUgdGhlIG5ldyBkdXAgKi8NCisJICAgIGhlLT5m
bGFncyAmPSB+SElTVF9NQUtFVU5JUVVFOw0KIAl9DQogCWVsc2Ugew0KIAkg
ICAgb2xkbm9kZS0+ZmxhZ3MgfD0gSElTVF9EVVA7DQpJbmRleDogU3JjL2hp
c3QuYw0KQEAgLTc5NCwxNiArNzk0LDE5IEBADQogdm9pZA0KIGhpc3RyZWR1
Y2VibGFua3Modm9pZCkNCiB7DQotICAgIGludCBpLCBsZW4sIHBvcywgbmVl
ZGJsYW5rOw0KKyAgICBpbnQgaSwgbGVuLCBwb3MsIG5lZWRibGFuaywgc3Bh
Y2Vjb3VudCA9IDA7DQogDQotICAgIGZvciAoaSA9IDAsIGxlbiA9IDA7IGkg
PCBjaHdvcmRwb3M7IGkgKz0gMikgew0KKyAgICBpZiAoaXNzZXQoSElTVElH
Tk9SRVNQQUNFKSkNCisJd2hpbGUgKGNobGluZVtzcGFjZWNvdW50XSA9PSAn
ICcpIHNwYWNlY291bnQrKzsNCisNCisgICAgZm9yIChpID0gMCwgbGVuID0g
c3BhY2Vjb3VudDsgaSA8IGNod29yZHBvczsgaSArPSAyKSB7DQogCWxlbiAr
PSBjaHdvcmRzW2krMV0gLSBjaHdvcmRzW2ldDQogCSAgICAgKyAoaSA+IDAg
JiYgY2h3b3Jkc1tpXSA+IGNod29yZHNbaS0xXSk7DQogICAgIH0NCiAgICAg
aWYgKGNobGluZVtsZW5dID09ICdcMCcpDQogCXJldHVybjsNCiANCi0gICAg
Zm9yIChpID0gMCwgcG9zID0gMDsgaSA8IGNod29yZHBvczsgaSArPSAyKSB7
DQorICAgIGZvciAoaSA9IDAsIHBvcyA9IHNwYWNlY291bnQ7IGkgPCBjaHdv
cmRwb3M7IGkgKz0gMikgew0KIAlsZW4gPSBjaHdvcmRzW2krMV0gLSBjaHdv
cmRzW2ldOw0KIAluZWVkYmxhbmsgPSAoaSA8IGNod29yZHBvcy0yICYmIGNo
d29yZHNbaSsyXSA+IGNod29yZHNbaSsxXSk7DQogCWlmIChwb3MgIT0gY2h3
b3Jkc1tpXSkgew0KQEAgLTEwNDQsOCArMTA0NywxMCBAQA0KIAkgICAgfSBl
bHNlDQogCQlzYXZlID0gMDsNCiAJfQ0KLQlpZiAoY2h3b3JkcG9zIDw9IDIg
fHwgc2hvdWxkX2lnbm9yZV9saW5lKHByb2cpKQ0KKwlpZiAoY2h3b3JkcG9z
IDw9IDIpDQogCSAgICBzYXZlID0gMDsNCisJZWxzZSBpZiAoc2hvdWxkX2ln
bm9yZV9saW5lKHByb2cpKQ0KKwkgICAgc2F2ZSA9IC0xOw0KICAgICB9DQog
ICAgIGlmIChmbGFnICYgKEhJU1RGTEFHX0RPTkUgfCBISVNURkxBR19SRUNB
TEwpKSB7DQogCWNoYXIgKnB0cjsNCkBAIC0xMDU4LDE0ICsxMDYzLDIzIEBA
DQogCX0NCiAJaWYgKGZsYWcgJiBISVNURkxBR19SRUNBTEwpIHsNCiAJICAg
IHpwdXNobm9kZShidWZzdGFjaywgcHRyKTsNCi0NCiAJICAgIHNhdmUgPSAw
Ow0KIAl9IGVsc2UNCiAJICAgIHpzZnJlZShwdHIpOw0KICAgICB9DQorICAg
IGlmIChzYXZlIHx8ICpjaGxpbmUgPT0gJyAnKSB7DQorCUhpc3RlbnQgaGU7
DQorCWZvciAoaGUgPSBoaXN0X3Jpbmc7IGhlICYmIGhlLT5mbGFncyAmIEhJ
U1RfRk9SRUlHTjsNCisJICAgICBoZSA9IHVwX2hpc3RlbnQoaGUpKSA7DQor
CWlmIChoZSAmJiBoZS0+ZmxhZ3MgJiBISVNUX1RNUFNUT1JFKSB7DQorCSAg
ICBpZiAoaGUgPT0gaGlzdF9yaW5nKQ0KKwkJY3VybGluZS5oaXN0bnVtID0g
Y3VyaGlzdC0tOw0KKwkgICAgZnJlZWhpc3Rub2RlKChIYXNoTm9kZSloZSk7
DQorCX0NCisgICAgfQ0KICAgICBpZiAoc2F2ZSkgew0KIAlIaXN0ZW50IGhl
Ow0KLQlpbnQga2VlcGZsYWdzOw0KKwlpbnQgbmV3ZmxhZ3M7DQogDQogI2lm
ZGVmIERFQlVHDQogCS8qIGRlYnVnZ2luZyBvbmx5ICovDQpAQCAtMTA4MSw2
ICsxMDk1LDcgQEANCiAJICAgIGlmIChpc3NldChISVNUUkVEVUNFQkxBTktT
KSkNCiAJCWhpc3RyZWR1Y2VibGFua3MoKTsNCiAJfQ0KKwluZXdmbGFncyA9
IHNhdmUgPiAwPyAwIDogSElTVF9PTEQgfCBISVNUX1RNUFNUT1JFOw0KIAlp
ZiAoKGlzc2V0KEhJU1RJR05PUkVEVVBTKSB8fCBpc3NldChISVNUSUdOT1JF
QUxMRFVQUykpICYmIGhpc3RfcmluZw0KIAkgJiYgaGlzdHN0cmNtcChjaGxp
bmUsIGhpc3RfcmluZy0+dGV4dCkgPT0gMCkgew0KIAkgICAgLyogVGhpcyBo
aXN0b3J5IGVudHJ5IGNvbXBhcmVzIHRoZSBzYW1lIGFzIHRoZSBwcmV2aW91
cy4NCkBAIC0xMDg5LDE4ICsxMTA0LDE2IEBADQogCSAgICAgKiB0aW1lc3Rh
bXAgcmlnaHQuICBQZXJoYXBzLCBwcmVzZXJ2ZSB0aGUgSElTVF9PTEQgZmxh
Zy4NCiAJICAgICAqLw0KIAkgICAgaGUgPSBoaXN0X3Jpbmc7DQotCSAgICBr
ZWVwZmxhZ3MgPSBoZS0+ZmxhZ3MgJiBISVNUX09MRDsgLyogQXZvaWQgcmUt
c2F2aW5nICovDQorCSAgICBuZXdmbGFncyB8PSBoZS0+ZmxhZ3MgJiBISVNU
X09MRDsgLyogQXZvaWQgcmUtc2F2aW5nICovDQogCSAgICBmcmVlaGlzdGRh
dGEoaGUsIDApOw0KIAkgICAgY3VybGluZS5oaXN0bnVtID0gY3VyaGlzdDsN
Ci0JfSBlbHNlIHsNCi0JICAgIGtlZXBmbGFncyA9IDA7DQorCX0gZWxzZQ0K
IAkgICAgaGUgPSBwcmVwbmV4dGhpc3RlbnQoKTsNCi0JfQ0KIA0KIAloZS0+
dGV4dCA9IHp0cmR1cChjaGxpbmUpOw0KIAloZS0+c3RpbSA9IHRpbWUoTlVM
TCk7DQogCWhlLT5mdGltID0gMEw7DQotCWhlLT5mbGFncyA9IGtlZXBmbGFn
czsNCisJaGUtPmZsYWdzID0gbmV3ZmxhZ3M7DQogDQogCWlmICgoaGUtPm53
b3JkcyA9IGNod29yZHBvcy8yKSkgew0KIAkgICAgaGUtPndvcmRzID0gKHNo
b3J0ICopemFsbG9jKGNod29yZHBvcyAqIHNpemVvZihzaG9ydCkpOw0KQEAg
LTE4OTMsOCArMTkwNiwxMCBAQA0KIAkgICAgfSBlbHNlDQogCQloZS0+d29y
ZHMgPSAoc2hvcnQgKilOVUxMOw0KIAkgICAgYWRkaGlzdG5vZGUoaGlzdHRh
YiwgaGUtPnRleHQsIGhlKTsNCi0JICAgIGlmIChoaXN0X3JpbmcgIT0gaGUp
DQotCQljdXJoaXN0LS07IC8qIFdlIGRpc2NhcmRlZCBhIGZvcmVpZ24gZHVw
bGljYXRlICovDQorCSAgICBpZiAoaGUtPmZsYWdzICYgSElTVF9EVVApIHsN
CisJCWZyZWVoaXN0bm9kZSgoSGFzaE5vZGUpaGUpOw0KKwkJY3VyaGlzdC0t
Ow0KKwkgICAgfQ0KIAl9DQogCWlmIChzdGFydCAmJiByZWFkZmxhZ3MgJiBI
RklMRV9VU0VfT1BUSU9OUykgew0KIAkgICAgenNmcmVlKGxhc3RoaXN0LnRl
eHQpOw0KQEAgLTE5NjIsNyArMTk3Nyw4IEBADQogICAgIGlmIChvdXQpIHsN
CiAJZm9yICg7IGhlICYmIGhlLT5oaXN0bnVtIDw9IHhjdXJoaXN0OyBoZSA9
IGRvd25faGlzdGVudChoZSkpIHsNCiAJICAgIGlmICgod3JpdGVmbGFncyAm
IEhGSUxFX1NLSVBEVVBTICYmIGhlLT5mbGFncyAmIEhJU1RfRFVQKQ0KLQkg
ICAgIHx8ICh3cml0ZWZsYWdzICYgSEZJTEVfU0tJUEZPUkVJR04gJiYgaGUt
PmZsYWdzICYgSElTVF9GT1JFSUdOKSkNCisJICAgICB8fCAod3JpdGVmbGFn
cyAmIEhGSUxFX1NLSVBGT1JFSUdOICYmIGhlLT5mbGFncyAmIEhJU1RfRk9S
RUlHTikNCisJICAgICB8fCBoZS0+ZmxhZ3MgJiBISVNUX1RNUFNUT1JFKQ0K
IAkJY29udGludWU7DQogCSAgICBpZiAod3JpdGVmbGFncyAmIEhGSUxFX1NL
SVBPTEQpIHsNCiAJCWlmIChoZS0+ZmxhZ3MgJiBISVNUX09MRCkNCkluZGV4
OiBTcmMvenNoLmgNCkBAIC0xMjUyLDYgKzEyNTIsNyBAQA0KICNkZWZpbmUg
SElTVF9SRUFECTB4MDAwMDAwMDQJLyogQ29tbWFuZCB3YXMgcmVhZCBiYWNr
IGZyb20gZGlzayovDQogI2RlZmluZSBISVNUX0RVUAkweDAwMDAwMDA4CS8q
IENvbW1hbmQgZHVwbGljYXRlcyBhIGxhdGVyIGxpbmUgKi8NCiAjZGVmaW5l
IEhJU1RfRk9SRUlHTgkweDAwMDAwMDEwCS8qIENvbW1hbmQgY2FtZSBmcm9t
IGFub3RoZXIgc2hlbGwgKi8NCisjZGVmaW5lIEhJU1RfVE1QU1RPUkUJMHgw
MDAwMDAyMAkvKiBLaWxsIHdoZW4gdXNlciBlbnRlcnMgYW5vdGhlciBjbWQg
Ki8NCiANCiAjZGVmaW5lIEdFVEhJU1RfVVBXQVJEICAoLTEpDQogI2RlZmlu
ZSBHRVRISVNUX0RPV05XQVJEICAxDQo=
---1463796991-216954071-989944758=:22483--

