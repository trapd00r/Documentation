From zsh-workers-return-24593-mason-zsh=primenet.com.au@sunsite.dk Tue Feb 26 14:42:51 2008
Return-Path: <zsh-workers-return-24593-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11538 invoked from network); 26 Feb 2008 14:42:49 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 26 Feb 2008 14:42:49 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 31937 invoked from network); 26 Feb 2008 14:42:45 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 26 Feb 2008 14:42:45 -0000
Received: (qmail 6612 invoked by alias); 26 Feb 2008 14:42:43 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24593
Received: (qmail 6598 invoked from network); 26 Feb 2008 14:42:43 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 26 Feb 2008 14:42:43 -0000
Received: from mail.blastwave.org (mail.blastwave.org [147.87.98.10])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 6823E8026E0B
	for <zsh-workers@sunsite.dk>; Tue, 26 Feb 2008 15:42:39 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by mail.blastwave.org (Postfix) with ESMTP id 3E35F26F2;
	Tue, 26 Feb 2008 15:42:38 +0100 (MET)
X-Virus-Scanned: amavisd-new at blastwave.org
Received: from mail.blastwave.org ([127.0.0.1])
	by localhost (enterprise.blastwave.org [127.0.0.1]) (amavisd-new, port 10024)
	with LMTP id vT8mX1v5tqb8; Tue, 26 Feb 2008 15:42:27 +0100 (MET)
Received: from [10.0.0.232] (175-206-103-86.dynamic.dsl.tng.de [86.103.206.175])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.blastwave.org (Postfix) with ESMTP id B38602694;
	Tue, 26 Feb 2008 15:42:26 +0100 (MET)
In-Reply-To: <20080226141459.76dc362c@news01>
References: <8AABEECB-A9A6-43EA-BED2-4BE376CBE349@blastwave.org> <20080226141459.76dc362c@news01>
Mime-Version: 1.0 (Apple Message framework v753)
Content-Type: text/plain; charset=US-ASCII; delsp=yes; format=flowed
Message-Id: <BD1EA7D6-C784-4ED9-9558-5B655CBC5096@blastwave.org>
Cc: zsh-workers@sunsite.dk
Content-Transfer-Encoding: 7bit
From: Dagobert Michelsen <dam@blastwave.org>
Subject: Re: Failed tests of zsh 4.3.5 in Solaris 10 w/Sun Studio 12 CC
Date: Tue, 26 Feb 2008 15:42:19 +0100
To: Peter Stephenson <pws@csr.com>
X-Mailer: Apple Mail (2.753)
X-Virus-Scanned: ClamAV 0.91.2/6003/Tue Feb 26 12:34:31 2008 on bifrost
X-Virus-Status: Clean

Hi Peter,

first, thanks for the effort. I have applied the patch
and reran the testsuite.

Am 26.02.2008 um 15:14 schrieb Peter Stephenson:
> On Tue, 26 Feb 2008 14:18:14 +0100
> Dagobert Michelsen <dam@blastwave.org> wrote:
>> I am building zsh 4.3.5 on Solaris 10 x86 with the
>> Sun Studio 12 compiler and I have some failed tests
>> in the teststuite:
>> ...
>> ./A03quoting.ztst: starting.
>> Test ./A03quoting.ztst failed: bad status 1, expected 0 from:
>>    print '<\u0041>'
>>    printf '%s\n' $'<\u0042>'
>>    print '<\u0043>'
>>    printf '%s\n' $'<\u0044>'
>> Error output:
>> (eval):1: cannot do charset conversion

./A03quoting.ztst: starting.
Test ./A03quoting.ztst failed: bad status 1, expected 0 from:
   print '<\u0041>'
   printf '%s\n' $'<\u0042>'
   print '<\u0043>'
   printf '%s\n' $'<\u0044>'
Error output:
(eval):1: cannot do charset conversion (iconv failed)
Was testing: \u in both print and printf

>> ...
>> ./D07multibyte.ztst: starting.
>> Testing multibyte with locale en_US.UTF-8
>> *** /tmp/zsh.ztst.out.19793     Tue Feb 26 08:06:28 2008
>> --- /tmp/zsh.ztst.tout.19793    Tue Feb 26 08:06:28 2008
>> ***************
>> *** 1,4 ****
>> ! OK
>> ! OK
>> ! OK
>> ! OK
>> --- 1,4 ----
>> ! Failed: no error message and no question mark
>> ! Failed: no error message and no question mark
>> ! Failed: no error message and no question mark
>> ! Failed: no error message and no question mark
>> Test ./D07multibyte.ztst failed: output differs from expected as

./D07multibyte.ztst: starting.
Testing multibyte with locale en_US.UTF-8
*** /tmp/zsh.ztst.out.12712     Tue Feb 26 09:35:42 2008
--- /tmp/zsh.ztst.tout.12712    Tue Feb 26 09:35:42 2008
***************
*** 1,4 ****
! OK
! OK
! OK
! OK
--- 1,4 ----
! Failed: no error message and no question mark
! Failed: no error message and no question mark
! Failed: no error message and no question mark
! Failed: no error message and no question mark
Test ./D07multibyte.ztst failed: output differs from expected as  
shown above for:
   testfn() { (LC_ALL=C; print $'\u00e9') }
   repeat 4 testfn 2>&1 | while read line; do
     if [[ $line = *"character not in range"* ]]; then
       print OK
     elif [[ $line = "?" ]]; then
       print OK
     else
       print Failed: no error message and no question mark
     fi
   done
   true
Was testing: error handling in Unicode quoting


> This means the it hasn't found either iconv or any other library to do
> character conversion.  (The error message is suppressed in the  
> second case
> but there's a good chance it's the same error.)  The shell has two  
> basic
> ways of doing this:
>
> (i) compile environment directly supports ISO 10646
> (ii) libraries support nl_langinfo(CODESET) and
>      (a) the current locale uses UTF-8 so the shell
>          can do a trivial conversion to UTF-8.
>      (b) iconv() is available in -liconv.
>
> (i) or (ii) are handled at compile time.  The choice between (ii) 
> (a) and
> (ii)(b) is handled at run time so long as nl_langinfo(CODESET) is
> available.  I don't think (ii)(a) applies in these tests, so this
> presumably means both that the environment doesn't support ISO  
> 10646, and
> that iconv wasn't found.

At least the dynamic binding is working:

thor% ldd work/dam-thor.d/zsh-4.3.5/Src/zsh
         libpcre.so.0 =>  /opt/csw/lib/i386/libpcre.so.0
         libiconv.so.2 =>         /opt/csw/lib/i386/libiconv.so.2
         libsocket.so.1 =>        /usr/lib/libsocket.so.1
         libdl.so.1 =>    /usr/lib/libdl.so.1
         libncurses.so.5 =>       /opt/csw/lib/i386/libncurses.so.5
         libm.so.1 =>     /usr/lib/libm.so.1
         libc.so.1 =>     /usr/lib/libc.so.1
         libnsl.so.1 =>   /usr/lib/libnsl.so.1
         libmp.so.2 =>    /usr/lib/libmp.so.2

It may be of interest that I am doing a "package build" with
DESTDIR installation as following:

cd work/dam-thor.d/zsh-4.3.5 && prefix="/opt/csw" exec_prefix="/opt/ 
csw" bindir="/opt/csw/bin" optbindir="/opt/csw/bin/i386" sbindir="/ 
opt/csw/sbin" libexecdir="/opt/csw/libexec" datadir="/opt/csw/share"  
sysconfdir="/opt/csw/etc" sharedstatedir="/opt/csw/share"  
localstatedir="/opt/csw/var" libdir="/opt/csw/lib" optlibdir="/opt/ 
csw/lib/i386" infodir="/opt/csw/share/info" lispdir="/opt/csw/share/ 
emacs/site-lisp" includedir="/opt/csw/include" mandir="/opt/csw/share/ 
man" docdir="/opt/csw/share/doc" sourcedir="/opt/csw/src" CPPFLAGS=" - 
I/export/medusa/dam/build/build.5.8-i386/opt/csw/include -I/opt/csw/ 
include" CFLAGS="-I/opt/csw/include/ncurses -xO3 -xtarget=generic - 
xarch=generic -I/export/medusa/dam/build/build.5.8-i386/opt/csw/ 
include -I/opt/csw/include " CXXFLAGS="-xO3 -xtarget=generic - 
xarch=generic -I/export/medusa/dam/build/build.5.8-i386/opt/csw/ 
include -I/opt/csw/include" LDFLAGS="  -L/export/medusa/dam/build/ 
build.5.8-i386/opt/csw/lib -L/opt/csw/lib" ASFLAGS="" OPTFLAGS="-xO3 - 
xtarget=generic -xarch=generic" CC="cc" CXX="CC" LD_OPTIONS="-R/opt/ 
csw/lib/\$ISALIST -R/opt/csw/lib" CC_HOME="/opt/studio/SOS11/ 
SUNWspro" CC_VERSION="Sun C 5.8 Patch 121016-07 2007/10/03"  
CXX_VERSION="Sun C++ 5.8 Patch 121018-11 2007/05/02" VENDORNAME=""  
VENDORSTAMP="" GARCH="i386" GAROSREL="5.8" GARPACKAGE="zsh"  
PKG_CONFIG_PATH="/export/medusa/dam/build/build.5.8-i386/opt/csw/lib/ 
pkgconfig:/opt/csw/lib/pkgconfig:" DESTDIR="/export/medusa/dam/build/ 
build.5.8-i386" ./configure --prefix=/opt/csw --exec_prefix=/opt/csw  
--bindir=/opt/csw/bin --sbindir=/opt/csw/sbin --libexecdir=/opt/csw/ 
libexec --datadir=/opt/csw/share --sysconfdir=/opt/csw/etc -- 
sharedstatedir=/opt/csw/share --localstatedir=/opt/csw/var --libdir=/ 
opt/csw/lib --infodir=/opt/csw/share/info --includedir=/opt/csw/ 
include --mandir=/opt/csw/share/man --enable-maildir-support --enable- 
fndir=/opt/csw/share/zsh/functions --enable-pcre

zsh configuration
-----------------
zsh version               : 4.3.5
host operating system     : i386-pc-solaris2.8
source code location      : .
compiler                  : cc
preprocessor flags        :  -I/export/medusa/dam/build/build.5.8- 
i386/opt/csw/include -I/opt/csw/include -I/opt/csw/include
executable compiler flags : -I/opt/csw/include/ncurses -xO3 - 
xtarget=generic -xarch=generic -I/export/medusa/dam/build/build.5.8- 
i386/opt/csw/include -I/opt/csw/include
module compiler flags     : -I/opt/csw/include/ncurses -xO3 - 
xtarget=generic -xarch=generic -I/export/medusa/dam/build/build.5.8- 
i386/opt/csw/include -I/opt/csw/include  -KPIC
executable linker flags   :   -L/export/medusa/dam/build/build.5.8- 
i386/opt/csw/lib -L/opt/csw/lib
module linker flags       :   -L/export/medusa/dam/build/build.5.8- 
i386/opt/csw/lib -L/opt/csw/lib  -G
library flags             : -L/opt/csw/lib -lpcre -liconv -lsocket - 
ldl -lncurses -lm  -lc
installation basename     : zsh
binary install path       : /opt/csw/bin
man page install path     : /opt/csw/share/man
info install path         : /opt/csw/share/info
functions install path    : /opt/csw/share/zsh/functions
See config.modules for installed modules and functions.


If I can do anything to help resolving these testing issues let me know.

Thanks!

   -- Dagobert Michelsen

