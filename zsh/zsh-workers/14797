From zsh-workers-return-14797-mason-zsh=primenet.com.au@sunsite.dk Fri Jun 08 05:26:17 2001
Return-Path: <zsh-workers-return-14797-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17903 invoked from network); 8 Jun 2001 05:26:16 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 8 Jun 2001 05:26:16 -0000
Received: (qmail 18358 invoked by alias); 8 Jun 2001 05:25:53 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14797
Received: (qmail 18337 invoked from network); 8 Jun 2001 05:25:53 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer david.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "ZSH Workers Mailing List" <zsh-workers@sunsite.dk>,
   "a normal guy" <ee_in_co@yahoo.com>
Subject: RE: HP-UX 11.00 tgetenv dilemma
Date: Fri, 8 Jun 2001 09:26:00 +0400
Message-ID: <000201c0efdb$80bf9790$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
In-Reply-To: <20010602004009.8849.qmail@web12507.mail.yahoo.com>
Importance: Normal
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4522.1200

[Moved to zsh-workers]

>
> HP-UX 11.00 has two man pages discussing tgetent.  'man termcap'
> says:
>
> =======================================================(quote)
>         :
> tgetent()       ...tgetent() returns -1 if it cannot
>                 access the terminfo directory, 0 if there is no
>                 capability file for name, and 1 if all goes
> well.
>         :
> =======================================================(unquote)
>
> but 'man tgetent' says
>
>
> =======================================================(quote)
> 	:
> RETURN VALUE
>       Upon successful completion, functions that return an
>       integer return OK(0).  Otherwise, they return ERR(-1).
>
>       Functions that return pointers return a null pointer on
>       error.
> 	:
> =======================================================(unquote)
>
> The code in init.c, init_term() requires the man termcap
> functionality.  HP claims that the man tgetent functionality is
> the true X-Open Standard.  (I have not confirmed this.)
>

SUS says OK or ERR. It does not define the values. Interesting, I looked on
my own system and here manual says the same but tgetent() still works the
way zsh expects it.

> We can solve the problem in two ways.
>
> 1. If we link with -lHcurses, we get tgetent to return the
> expected 1 with success.  I suppose this would be done in the
> configure script.  This library may not be around for the
> future.
>
> 2. If the X-Open Standard is truely as HP claims, we can add
> another #ifdef block to the existing TGETENT_ACCEPTS_NULL to
> work with this situation.  Then we link with -lcurses as the
> current configure script does.
>

Pretty hard to figure out automatically.

3. Use setupterm if compiled with curses (or just if available) and tgetent
otherwise. The above problem should happen only on systems with terminfo and
setupterem must be there.

-andrej

