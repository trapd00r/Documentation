From zsh-users-return-13246-mason-zsh=primenet.com.au@sunsite.dk Thu Sep 18 17:57:54 2008
Return-Path: <zsh-users-return-13246-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23803 invoked from network); 18 Sep 2008 17:57:52 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,WEIRD_PORT
	autolearn=no version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 18 Sep 2008 17:57:52 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 85878 invoked from network); 18 Sep 2008 17:57:05 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 18 Sep 2008 17:57:05 -0000
Received: (qmail 10209 invoked by alias); 18 Sep 2008 17:56:21 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13246
Received: (qmail 10191 invoked from network); 18 Sep 2008 17:56:20 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 18 Sep 2008 17:56:20 -0000
Received: from fmmailgate04.web.de (fmmailgate04.web.de [217.72.192.242])
	by bifrost.dotsrc.org (Postfix) with ESMTP id A724B802720D
	for <zsh-users@sunsite.dk>; Thu, 18 Sep 2008 19:56:14 +0200 (CEST)
Received: from web.de 
	by fmmailgate04.web.de (Postfix) with SMTP id 8B0EB5EA0CA2
	for <zsh-users@sunsite.dk>; Thu, 18 Sep 2008 19:56:14 +0200 (CEST)
Received: from [87.166.243.182] by freemailng0402.web.de with HTTP;
 Thu, 18 Sep 2008 19:56:14 +0200
Date: Thu, 18 Sep 2008 19:56:14 +0200
Message-Id: <1626233899@web.de>
MIME-Version: 1.0
From: Oliver Paulus <oliver@webprojekt.it>
To: zsh-users@sunsite.dk
Subject: zsh completion problem
Organization: http://freemail.web.de/
X-Sender: oliver_paulus@web.de
X-Provags-Id: V01U2FsdGVkX1/SmKTrHUogQ6pqmcysBF8kMD3pIJtoX/xswU35NgmNSoAuc
 974j51oDqIbTco7jPIXfHJLHz12IBbfozcQjbr3X5Hwhu7EnhnOhhwJLerXB
 w==
Content-Type: text/plain; charset=iso-8859-15
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: ClamAV 0.92.1/8281/Thu Sep 18 19:13:14 2008 on bifrost
X-Virus-Status: Clean

Hello,

I have developed svc-restart, svc-stop, etc. helper functions to call  
/etc/init.d scripts. Here is the configuration:

---conf start
function _c-getdaemons() {
            if [[ -r /etc/init.d ]] ; then
               local f
               for f in /etc/init.d/*(:t); _wanted module expl  
'daemons' compadd $f ;
            fi
}
if [[ -d /etc/init.d ]] ; then
     for i in svc-start svc-restart svc-stop svc-force-reload svc-reload ; do
         eval "function $i() {
                 $SUDO /etc/init.d/\$1 ${i/#svc-/}
         }";
         compdef _c-getdaemons $i
     done
fi
---end

Now my problem: If I call zsh the first time I do not get the right  
completion. I type "svc-restart <TAB>" and I get the "files"  
completion. If I "reload" zsh - and try it again I get the "daemons"  
completion I have defined. Here is the reload function I use:

---conf start
function reload() {
         if [[ "$#*" -eq 0 ]]; then
                 test -r /etc/zsh/zsh-oli && . /etc/zsh/zsh-oli
                 test -r ~/.zshrc && . ~/.zshrc
                 return 0
         else
                 local fn
                 for fn in $*; do
                    unfunction $fn
                    autoload -U $fn
                 done
         fi
}
compdef _functions reload
---end

--
Oliver Paulus

OpenPGP
Key id: 28D9C44F
Fingerprint: EADA 62FC 07DC 3361 A3D6  4174 2DE3 C027 28D9 C44F
Public Key: http://pgp.mit.edu:11371/pks/lookup?op=get&search=0x28D9C44F
_________________________________________________________________________
In 5 Schritten zur eigenen Homepage. Jetzt Domain sichern und gestalten! 
Nur 3,99 EUR/Monat! http://www.maildomain.web.de/?mc=021114

