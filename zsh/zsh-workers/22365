From zsh-workers-return-22365-mason-zsh=primenet.com.au@sunsite.dk Fri Mar 17 23:38:24 2006
Return-Path: <zsh-workers-return-22365-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26955 invoked from network); 17 Mar 2006 23:38:19 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.1 (2006-03-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 17 Mar 2006 23:38:19 -0000
Received: (qmail 71010 invoked from network); 17 Mar 2006 23:38:13 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Mar 2006 23:38:13 -0000
Received: (qmail 26614 invoked by alias); 17 Mar 2006 23:38:10 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22365
Received: (qmail 26604 invoked from network); 17 Mar 2006 23:38:09 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 17 Mar 2006 23:38:09 -0000
Received: (qmail 70687 invoked from network); 17 Mar 2006 23:38:09 -0000
Received: from mta09-winn.ispmail.ntl.com (HELO mtaout03-winn.ispmail.ntl.com) (81.103.221.49)
  by a.mx.sunsite.dk with SMTP; 17 Mar 2006 23:38:08 -0000
Received: from aamtaout01-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout03-winn.ispmail.ntl.com with ESMTP
          id <20060317233807.XRWC27969.mtaout03-winn.ispmail.ntl.com@aamtaout01-winn.ispmail.ntl.com>
          for <zsh-workers@sunsite.dk>; Fri, 17 Mar 2006 23:38:07 +0000
Received: from pwslaptop.csr.com ([82.6.97.150])
          by aamtaout01-winn.ispmail.ntl.com with ESMTP
          id <20060317233807.TLRA20480.aamtaout01-winn.ispmail.ntl.com@pwslaptop.csr.com>
          for <zsh-workers@sunsite.dk>; Fri, 17 Mar 2006 23:38:07 +0000
Received: from pwslaptop.csr.com (pwslaptop.csr.com [127.0.0.1])
	by pwslaptop.csr.com (8.13.4/8.13.4) with ESMTP id k2HNbwiP005530
	for <zsh-workers@sunsite.dk>; Fri, 17 Mar 2006 23:37:59 GMT
Received: from pwslaptop.csr.com (pws@localhost)
	by pwslaptop.csr.com (8.13.4/8.13.4/Submit) with ESMTP id k2HNbvBt005526
	for <zsh-workers@sunsite.dk>; Fri, 17 Mar 2006 23:37:58 GMT
Message-Id: <200603172337.k2HNbvBt005526@pwslaptop.csr.com>
X-Authentication-Warning: pwslaptop.csr.com: pws owned process doing -bs
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: documentation update 
In-Reply-To: Your message of "Fri, 17 Mar 2006 12:15:36 PST."
             <20060317201536.GL24877@dot.blorf.net> 
Date: Fri, 17 Mar 2006 23:37:56 +0000

Wayne Davison wrote:
> On Fri, Mar 17, 2006 at 07:52:55PM +0000, Peter Stephenson wrote:
> > Also, if you diff the manual page output, you'll see that (real) 's are
> > being quoted as \&': again, I presume this is a feature.
> 
> Unfortnately, that's a misfeature.  That makes an apostrophe output as a
> curly quote, and that ruins things like example code where an apostrophe
> is what you really must type.  This sounds like something where a change
> from the various packagers (e.g. Debian) didn't bubble up to affect the
> new yodl version (since this misfeature was never actually fixed in the
> distributed yodl code itself, but was only patched in lower down).

OK, it could probably be added to your existing fix from August:

	    $(YODL) -I$(sdir) -w zman.yo version.yo $< | \
	      sed -e '1s/\\-/-/g' -e '/^\.'\''/d' \
	      -e 's/\(\\fB\)*'\''/\1\\\&'\''/' > $$target \

although it might be nicer if the quotes were only made literal in
examples; I wonder if we can tag them in such a way that sed or possibly
awk can recognize the hunks?

Also, version.yo is auto-generated, so that needs a change in the
Makefile:

Index: Doc/Makefile.in
===================================================================
RCS file: /cvsroot/zsh/zsh/Doc/Makefile.in,v
retrieving revision 1.30
diff -u -r1.30 Makefile.in
--- Doc/Makefile.in	21 Oct 2005 09:51:55 -0000	1.30
+++ Doc/Makefile.in	17 Mar 2006 23:34:19 -0000
@@ -205,10 +205,10 @@
 
 version.yo: $(sdir_top)/Config/version.mk
 	( \
-	  echo 'STARTDEF()'; \
+	  echo 'IFDEF(INCWSLEVEL)(INCWSLEVEL())(STARTDEF())'; \
 	  echo 'def(version)(0)('$(VERSION)')'; \
 	  echo 'def(date)(0)('$(VERSION_DATE)')'; \
-	  echo 'ENDDEF()#' | tr '#' '\\'; \
+	  echo 'IFDEF(DECWSLEVEL)(DECWSLEVEL())(ENDDEF())#' | tr '#' '\\'; \
 	) > $(sdir)/version.yo
 
 Zsh/modlist.yo: $(MODDOCSRC)

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page still at http://www.pwstephenson.fsnet.co.uk/

