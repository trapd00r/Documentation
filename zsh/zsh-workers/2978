From zsh-workers-request@euclid.skiles.gatech.edu Tue Mar 11 14:59:39 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 19831 invoked from network); 11 Mar 1997 14:59:36 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 11 Mar 1997 14:59:36 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id JAA16072; Tue, 11 Mar 1997 09:44:52 -0500 (EST)
Resent-Date: Tue, 11 Mar 1997 09:44:52 -0500 (EST)
From: gwing@primenet.com.au
Message-ID: <19970311144657.19792.qmail@primenet.com.au>
Subject: refresh and termcap followup
To: zsh-workers@math.gatech.edu (zsh-workers)
Date: Wed, 12 Mar 1997 01:46:57 +1100 (EST)
X-Mailer: ELM [version 2.4ME+ PL31 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"exA6Q1.0.2x3.Z_M9p"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2978
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Heyla,
 in messages 2726/2760/2772/2774, Robert F Tobler mentioned problems with zsh
and his termcap.  This was on NeXTstep.
I'm still unable to produce any of the errors on my machine.  Can anyone else
produce them?

(1)
"d0|vt100|vt100-am|vt100am|DigitalVT100"
(2)
"d0|vt100|vt100-am|vt100am|dec vt100"
(3)
"vt|xterm|vs100|4315x|xterm terminal emulator (X window system), VAXstation II"

(1) works for Robert but (2) and (3) do not.  The only real differences, not
including the reset string, between (1) and (2) are tab stuff.  I haven't
fully checked the reset strings yet.  I'm not sure why (2) would fail though
I not beyond believing the reset string is the culprit.

BTW, 
 (1) initialises and uses tabs
 (2) doesn't initialise or use tabs
 (3) doesn't initialise tabs but uses them

---------------------------------------------------------------------
Problem with (2) on NeXTstep:
% zsh -f
% PROMPT="%B%D{%d-%b-%y} %*%b %S%~%s
%m:%n%(#.#.>) "

# enter 20 normal characters, then type CTRL-A to go to beginning of line,
# then type more characters.  When typing or deleting the 2nd to 11th of
# these additional characters the commandline is printed after one additional
# linefeed, and some of the characters of the prompt overlap with the command
# line.
---------------------------------------------------------------------
Problem with (3) on NeXTstep:
# when inserting into the first line of a command thats longer than one line,
# the part from the cursor to the end of the line is not updated.
---------------------------------------------------------------------

If anyone wants to compare them, I whipped up a little function to sort the
termcaps, so you can diff them more easily. Also, in s/[  ]*//g , there's
a tab and a space.

tcsort () {
        sed '
s/\\$//
s/[	 ]*//g
s/:/:\
:/g' | awk '
/^:$/  { next }
/^::$/ { next }
       { c[i++] = $0 }
END    { for (j = 0; j < i; j++) print c[j] | "sort" }
' | awk '
       { c[i++] = $0 }
END    { printf "%s\\\n", c[i - 1]; for (j = 0; j < i - 2; j++) printf "%s\\\n", c[j] ; print c[i - 2] }
'
}

---------------------------------------------------------------------
d0|vt100|vt100-am|vt100am|Digital VT100:\
        :cr=^M:nl=^J:bl=^G:ta=^I:\
        :do=^J:co#80:li#24:cl=50\E[;H\E[2J:sf=2*\ED:\
        :le=^H:bs:am:cm=5\E[%i%d;%dH:nd=2\E[C:up=2\E[A:\
        :ce=3\E[K:cd=50\E[J:so=2\E[7m:se=2\E[m:us=2\E[4m:ue=2\E[m:\
        :md=2\E[1m:mr=2\E[7m:mb=2\E[5m:me=2\E[m:is=\E[1;24r\E[24;1H:\
        :ct=2\E[3g:st=2\EH:\
        :rf=/usr/lib/tabset/vt100:\
        :rs=\E>\E[?3l\E[?4l\E[?5l\E[?7h\E[?8h:ks=\E[?1h:ke=\E[?1l:\
        :ku=\EOA:kd=\EOB:kr=\EOC:kl=\EOD:kb=^H:\
        :ho=\E[H:k1=\EOP:k2=\EOQ:k3=\EOR:k4=\EOS:pt:sr=2*\EM:vt#3:xn:\
        :sc=\E7:rc=\E8:cs=\E[%i%d;%dr:\
        :it#8:xo:
---------------------------------------------------------------------
d0|vt100|vt100-am|vt100am|dec vt100:\
	:do=^J:co#80:li#24:cl=\E[;H\E[2J:sf=2*\ED:\
	:le=^H:bs:am:cm=5\E[%i%d;%dH:nd=2\E[C:up=2\E[A:\
	:ce=3\E[K:cd=50\E[J:so=2\E[7m:se=2\E[m:us=2\E[4m:ue=2\E[m:\
	:md=2\E[1m:mr=2\E[7m:mb=2\E[5m:me=2\E[m:\
	:rf=/usr/lib/tabset/vt100:\
	:rs=\E>\E[?3l\E[?4l\E[?5l\E[?7h\E[?8h\E[;r\E[0m\E(B\E)B\E[2J:\
	:ks=\E[?1h\E=:ke=\E[?1l\E>:ku=\EOA:kd=\EOB:kr=\EOC:kl=\EOD:kb=^H:\
	:ho=\E[H:k1=\EOP:k2=\EOQ:k3=\EOR:k4=\EOS:pt:sr=2*\EM:vt#3:xn:\
	:sc=\E7:rc=\E8:cs=\E[%i%d;%dr:
---------------------------------------------------------------------
vt|xterm|vs100|4315x|xterm terminal emulator (X window system), VAXstation II:\
        :cr=^M:do=^J:nl=^J:bl=^G:le=^H:ho=\E[H:\
        :co#80:li#24:cl=\E[H\E[2J:bs:am:xn:cm=\E[%i%d;%dH:nd=\E[C:up=\E[A:\
        :ce=\E[K:cd=\E[J:so=\E[7m:se=\E[m:us=\E[4m:ue=\E[m:\
        :md=\E[1m:mr=\E[7m:me=\E[m:\
        :ku=\EOA:kd=\EOB:kr=\EOC:kl=\EOD:kb=^H:\
        :k1=\EOP:k2=\EOQ:k3=\EOR:k4=\EOS:ta=^I:pt:sf=\n:sr=\EM:\
        :al=\E[L:dl=\E[M:ic=\E[@:dc=\E[P:\
        :ks=:ke=:sc=\E7\
        :is=\E[r\E<\E[m\E[2J\E[H\E[?7h\E[?3;4;6l:\
        :rs=\E[r\E<\E[m\E[2J\E[H\E[?7h\E[?3;4;6l:\
        :ti=\E7\E[?47h:te=\E[?47l\E8:\
        :hs:ts=\E[?E\E[?%i%dT:fs=\E[?F:es:ds=\E[?E:\
        :CV=\E[%i%oH:DC=\E[%dP:IC=\E[%d@:\
        :AL=\E[%dL:DL=\E[%dM:MT:
---------------------------------------------------------------------
-- 
Geoff Wing [mason@primenet.com.au]   Technical Manager
  Phone    : +61-3-9818 2977         PrimeNet - Internet Consultancy
  Facsimile: +61-3-9819 3788         Web : <URL:http://www.primenet.com.au/>
  Mobile   : 0412 162 441

