From zsh-users-return-14603-mason-zsh=primenet.com.au@zsh.org Wed Nov 25 12:37:52 2009
Return-Path: <zsh-users-return-14603-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1725 invoked by alias); 25 Nov 2009 12:37:52 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14603
Received: (qmail 20069 invoked from network); 25 Nov 2009 12:37:49 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-3.0 required=5.0 tests=AWL,BAYES_00,
	RCVD_IN_DNSWL_LOW autolearn=ham version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at csr.com does not designate permitted sender hosts)
Date: Wed, 25 Nov 2009 12:37:43 +0000
From: Peter Stephenson <pws@csr.com>
To: zsh-users@zsh.org
Subject: Re: Redirecting shell output to a pipe
Message-ID: <20091125123743.79814faa@news01>
In-Reply-To: <20091125064801.GA8371@fermat.math.technion.ac.il>
References: <20091124143140.GA7612@fermat.math.technion.ac.il>
	<4B0C2709.5080307@sun.com>
	<20091125064801.GA8371@fermat.math.technion.ac.il>
Organization: CSR
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.8; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 25 Nov 2009 12:37:44.0193 (UTC) FILETIME=[15EA8F10:01CA6DCC]
X-Scanned-By: MailControl A-09-22-03 (www.mailcontrol.com) on 10.71.0.124

On Wed, 25 Nov 2009 08:48:01 +0200
"Nadav Har'El" <nyh@math.technion.ac.il> wrote:
> On Tue, Nov 24, 2009, Peter Miller wrote about "Re: Redirecting shell output to a pipe":
> >...
> > > Isn't it natural to assume that in the same fashion, you should also
> > > be able to redirect the scripts output to a pipe? E.g., a very useful
> > > idiom could have been
> > >
> > > 	exec | tee filename
> > 
> > exec |& tee filename
> 
> Does this work for you? I get (on zsh 4.3.10)
> 
> 	zsh: redirection with no command
> 
> This was exactly my "complaint" - that this is sensible syntax, that
> could have worked, but doesn't.

I think this does the wrong thing: it uses NULLCMD, i.e.  executes "exec
cat | tee filename" (or otherwise, depending what $NULLCMD is), which isn't
what you want.  If you don't use a NULLCMD this fails entirely.  Adding
2>&1 doesn't change this.

Actually, I don't think this would ever work.  You need to understand what
a pipeline means to the shell: it means create a pipe, then start the
different parts of the pipeline, then wait for them to finish.  What you
want is beyond the limits of expression of the standard pipeline syntax:
you want it to say create this pipeline and leave it running as a separate
process with output redirected.

Zsh does have a syntax for exactly that:

exec > >(tee filename)

That might do what you want.

Note the "tee" process is asynchronous with respect to the rest of the
script, i.e. the shell won't wait for it to exit before the script exits.
That's normally the case with pipelines; the second process waits for the
first to exit.  I'm noting it specially here because it's perhaps less
clear that the shell is becoming the first part of a pipeline over which it
has no overall control, i.e. that it's different from running a pipeline
entirely within the shell.  But it may already be obvious that's the case.

-- 
Peter Stephenson <pws@csr.com>            Software Engineer
Tel: +44 (0)1223 692070                   Cambridge Silicon Radio Limited
Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, UK


Member of the CSR plc group of companies. CSR plc registered in England and Wales, registered number 4187346, registered office Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, United Kingdom

