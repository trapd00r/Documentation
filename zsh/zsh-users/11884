From zsh-users-return-11884-mason-zsh=primenet.com.au@sunsite.dk Wed Sep 26 15:01:59 2007
Return-Path: <zsh-users-return-11884-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22569 invoked from network); 26 Sep 2007 15:01:51 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 26 Sep 2007 15:01:51 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 4367 invoked from network); 26 Sep 2007 15:01:44 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 26 Sep 2007 15:01:44 -0000
Received: (qmail 25674 invoked by alias); 26 Sep 2007 15:01:35 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11884
Received: (qmail 25659 invoked from network); 26 Sep 2007 15:01:34 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 26 Sep 2007 15:01:34 -0000
Received: (qmail 3090 invoked from network); 26 Sep 2007 15:01:34 -0000
Received: from cpe-24-221-169-47.ca.sprintbbd.net (HELO ckhb04.ckhb.org) (24.221.169.47)
  by a.mx.sunsite.dk with SMTP; 26 Sep 2007 15:01:28 -0000
Received: by ckhb04.ckhb.org (Postfix, from userid 501)
	id 3C94448967A; Wed, 26 Sep 2007 08:01:25 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by ckhb04.ckhb.org (Postfix) with ESMTP id BD5F348965F;
	Wed, 26 Sep 2007 08:01:25 -0700 (PDT)
Date: Wed, 26 Sep 2007 08:01:25 -0700 (PDT)
From: "S. Cowles" <scowles@ckhb.org>
X-X-Sender: picmar@ckhb04.ckhb.org
To: zsh-users@sunsite.dk
Cc: Peter Stephenson <pws@csr.com>
Subject: Re: zsocket help
In-Reply-To: <200709260848.l8Q8m2BF030743@news01.csr.com>
Message-ID: <alpine.OSX.0.999.0709260759190.13930@ckhb04.ckhb.org>
References: <20070924050450.GA32335@lorien.comfychair.org>
 <200709240924.l8O9OPNP005103@news01.csr.com> <alpine.OSX.0.999.0709252352240.13930@ckhb04.ckhb.org>
 <200709260848.l8Q8m2BF030743@news01.csr.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; format=flowed; charset=us-ascii


thank you very much, peter.  and, yes, i _do_ have a purchased copy of 
your superb book.  cheers, sir.
sid


On Wed, 26 Sep 2007, Peter Stephenson wrote:

> Date: Wed, 26 Sep 2007 09:48:02 +0100
> From: Peter Stephenson <pws@csr.com>
> To: zsh-users@sunsite.dk
> Subject: Re: zsocket help
> 
> "S. Cowles" wrote:
>> does anyone have a piece of sample code showing practical usage of
>> zsockets?  i'm not having success developing functioning zsocket code
>> using a current zsh cvs code pull.  i've been working from the zshall man
>> page and from the partial zsocket examples from zshlovers without success.
>> any help would be appreciated.  thanks.
>
> I got the following to work.
>
> In terminal A:
>
>  % typeset REPLY
>  % zmodload zsh/net/socket
>  % zsocket -l /tmp/zsocket
>  % print $REPLY
>  11
>  % zsocket -a 11
>
> This now blocks.  (I put the "typeset REPLY" at the start to ensure REPLY is
> created as a string, as you would naturally do in a function.)
>
> In terminal B:
>
>  % typeset REPLY
>  % zmodload zsh/net/socket
>  % zsocket /tmp/zsocket
>  % print $REPLY
>  3
>
> Terminal A returns at this point and I did:
>
>  % print $REPLY
>  3
>  % read -u3 && print $REPLY
>
> and in terminal B:
>
>  % print -u3 This is a message on the socket
>
> which produces in terminal A:
>
>  This is a message on the socket
>
> As far as I can see there's no way of closing the file descriptors using
> zsocket, which seems an omission.  Presumably you can use "exec 3>&-"
> etc. although to close a file descriptor over 9 you need to do something
> like:
>
>  % fd=11
>  % exec {fd}>&-
>
> --
> Peter Stephenson <pws@csr.com>                  Software Engineer
> CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
> Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070
>


