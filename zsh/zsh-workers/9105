From zsh-workers-return-9105-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Dec 17 13:53:26 1999
Return-Path: <zsh-workers-return-9105-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18821 invoked from network); 17 Dec 1999 13:53:25 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Dec 1999 13:53:25 -0000
Received: (qmail 6705 invoked by alias); 17 Dec 1999 13:53:16 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9105
Received: (qmail 6698 invoked from network); 17 Dec 1999 13:53:11 -0000
Date: Fri, 17 Dec 1999 13:53:32 GMT
Message-Id: <199912171353.NAA28615@mango.dublin.iona.ie>
To: zsh-workers@sunsite.auc.dk
From: zefram@fysh.org
Subject: PATCH: Re: mkbltnmlst.sh sources directories.

This patch makes mkbltnmlist.sh warn about non-existent modules instead
of trying to source a directory.  This should be applied instead of 9101
(but it's quite harmless if both are applied by accident).

Btw, I realised that a more likely cause of the non-existent module
problem would be applying my alias modules patch and failing to run the
.preconfig script as the blurb mentioned.  This would have the effect
of putting the alias modules into xmods.conf but not actually being able
to build them.

-zefram

diff -cr ../zsh-/Src/mkbltnmlst.sh ./Src/mkbltnmlst.sh
*** ../zsh-/Src/mkbltnmlst.sh	Thu Dec 16 10:14:15 1999
--- ./Src/mkbltnmlst.sh	Fri Dec 17 13:41:44 1999
***************
*** 21,26 ****
--- 21,31 ----
  
  for x_mod in $x_mods; do
      q_x_mod=`echo $x_mod | sed 's,Q,Qq,g;s,_,Qu,g;s,/,Qs,g'`
+     eval "modfile=\$modfile_$q_x_mod"
+     if test "x$modfile" = x; then
+ 	echo >&2 "WARNING: $XMODCF lists non-existent module \`$x_mod' (ignored)"
+ 	continue
+     fi
      case "$bin_mods" in
      *" $x_mod "*)
          echo "/* linked-in known module \`$x_mod' */"
***************
*** 31,37 ****
          echo "/* non-linked-in known module \`$x_mod' */"
  	linked=no
      esac
-     eval "modfile=\$modfile_$q_x_mod"
      unset moddeps autobins autoinfixconds autoprefixconds autoparams
      unset automathfuncs
      . $srcdir/../$modfile
--- 36,41 ----

