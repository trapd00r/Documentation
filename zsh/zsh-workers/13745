From zsh-workers-return-13745-mason-zsh=primenet.com.au@sunsite.dk Sun Mar 25 00:19:01 2001
Return-Path: <zsh-workers-return-13745-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24635 invoked from network); 25 Mar 2001 00:19:00 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 25 Mar 2001 00:19:00 -0000
Received: (qmail 20938 invoked by alias); 25 Mar 2001 00:18:54 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13745
Received: (qmail 20923 invoked from network); 25 Mar 2001 00:18:53 -0000
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: Re: PATCH: More comments in ztst files 
In-reply-to: ""Bart Schaefer""'s message of "Sat, 24 Mar 2001 23:57:14 GMT."
             <1010324235714.ZM31898@candle.brasslantern.com> 
Date: Sun, 25 Mar 2001 00:19:52 +0000
From: Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Message-Id: <20010325001952.44D9F139C6@pwstephenson.fsnet.co.uk>

Bart wrote:
>   # it doesn't *say* these are case-insensitive without i...
>   # I think this is a bug.
> 
> Where "these" are ${(o)...} and ${(O)...}.  The manual does in fact say
> that (i) means sort case-insensitively with (o).  By implication, sorting
> should be case-sensitive without it, right?  The results seem to be in
> case-sensitive order, so I'm not sure what was up with this comment.

There was some argy bargy about the effect of locales, which caused some
confusion about this: in some locales (even English language ones) the
sorting was automatically case-insensitive.  We now reset LC_ALL to C in
ztst.zsh.  But this doesn't seem to be enough.

- I I be could programme recorded that watching
  be could I I programme recorded that watching
! watching that recorded programme could be I I
  watching that recorded programme I I could be
--- 1,4 ----
  be could I I programme recorded that watching
! be could I I programme recorded that watching
! watching that recorded programme I I could be
  watching that recorded programme I I could be

This is because Chmouel and company have done the job more thoroughly this
time (Mandrake 7.2):

exported LC_COLLATE=en_GB             # form orderly bus queues
exported LC_CTYPE=en_GB
exported LC_MESSAGES=en_GB            # don't say `have a nice day'
exported LC_MONETARY=en_GB            # devalue everything in sight
exported LC_NUMERIC=en_GB
exported LC_TIME=en_GB

The patch below fixes LC_COLLATE, too.

> Peter must have really been pining for William Dalrymple at this point.

Oh, dear.  I don't think I've ever really read what I wrote before.

Index: Test/ztst.zsh
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/ztst.zsh,v
retrieving revision 1.5
diff -u -r1.5 ztst.zsh
--- Test/ztst.zsh	2000/06/07 09:02:24	1.5
+++ Test/ztst.zsh	2001/03/25 00:16:09
@@ -25,6 +25,7 @@
 # Ensure the locale does not screw up sorting.  Don't supply a locale
 # unless there's one set, to minimise problems.
 [[ -n $LC_ALL ]] && LC_ALL=C
+[[ -n $LC_COLLATE ]] && LC_COLLATE=C
 [[ -n $LANG ]] && LANG=C
 
 # Set the module load path to correspond to this build of zsh.

-- 
Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Work: pws@csr.com
Web: http://www.pwstephenson.fsnet.co.uk

