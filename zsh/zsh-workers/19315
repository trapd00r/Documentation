From zsh-workers-return-19315-mason-zsh=primenet.com.au@sunsite.dk Thu Dec 18 18:17:35 2003
Return-Path: <zsh-workers-return-19315-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23500 invoked from network); 18 Dec 2003 18:17:34 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 18 Dec 2003 18:17:34 -0000
Received: (qmail 15286 invoked by alias); 18 Dec 2003 18:17:05 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19315
Received: (qmail 15248 invoked from network); 18 Dec 2003 18:17:04 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 18 Dec 2003 18:17:04 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [62.189.183.235] by sunsite.dk (MessageWall 1.0.8) with SMTP; 18 Dec 2003 18:17:4 -0000
Received: from EXCHANGE02.csr.com (unverified) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.12) with ESMTP id <T6696f68dedc0a88d0145c@MAILSWEEPER01.csr.com> for <zsh-workers@sunsite.dk>;
 Thu, 18 Dec 2003 18:16:44 +0000
Received: from csr.com ([192.168.144.127]) by EXCHANGE02.csr.com with Microsoft SMTPSVC(5.0.2195.5329);
	 Thu, 18 Dec 2003 18:18:29 +0000
To: zsh-workers@sunsite.dk
Subject: Re: ZSH build/test is slightly broken on AIX 
In-reply-to: "David Favor"'s message of "Tue, 16 Dec 2003 07:48:57 CST."
             <3FDF0D49.3040907@davidfavor.com> 
Date: Thu, 18 Dec 2003 18:16:49 +0000
Message-ID: <26690.1071771409@csr.com>
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 18 Dec 2003 18:18:29.0351 (UTC) FILETIME=[56325770:01C3C593]

David Favor wrote:
> 1) if built dynamic the following symbols have to
>     be added to Src/zsh.export for zsh to link:
> 
>        zero_mnumber
>        isident
>        c, lastend, statusll, statusline
>        tokfd

It looks like this is for 4.0.8... this should fix these.  I'll
upload a new version assume as it's clear whether there's any more
flak.  (Exporting a symbol `c' is grotesque.)

Index: Src/lex.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/lex.c,v
retrieving revision 1.19.4.2
diff -u -r1.19.4.2 lex.c
--- Src/lex.c	17 Jul 2003 17:41:18 -0000	1.19.4.2
+++ Src/lex.c	18 Dec 2003 18:12:49 -0000
@@ -44,7 +44,7 @@
 /**/
 mod_export int tok;
 /**/
-int tokfd;
+mod_export int tokfd;
 
 /* lexical analyzer error flag */
  
Index: Src/math.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/math.c,v
retrieving revision 1.9.4.2
diff -u -r1.9.4.2 math.c
--- Src/math.c	12 May 2003 14:03:36 -0000	1.9.4.2
+++ Src/math.c	18 Dec 2003 18:12:50 -0000
@@ -40,7 +40,7 @@
 /* integer zero */
 
 /**/
-mnumber zero_mnumber;
+mod_export mnumber zero_mnumber;
 
 /* last input base we used */
 
Index: Src/params.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/params.c,v
retrieving revision 1.48.4.11
diff -u -r1.48.4.11 params.c
--- Src/params.c	13 Nov 2003 16:45:38 -0000	1.48.4.11
+++ Src/params.c	18 Dec 2003 18:12:50 -0000
@@ -763,7 +763,7 @@
 /* Return 1 if the string s is a valid identifier, else return 0. */
 
 /**/
-int
+mod_export int
 isident(char *s)
 {
     char *ss;
Index: Src/Zle/compcore.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compcore.c,v
retrieving revision 1.45.4.4
diff -u -r1.45.4.4 compcore.c
--- Src/Zle/compcore.c	28 Oct 2003 16:52:30 -0000	1.45.4.4
+++ Src/Zle/compcore.c	18 Dec 2003 18:12:50 -0000
@@ -277,7 +277,7 @@
 /* This holds the end-position of the last string inserted into the line. */
 
 /**/
-int lastend;
+mod_export int lastend;
 
 #define inststr(X) inststrlen((X),1,-1)
 
Index: Src/Zle/zle_main.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_main.c,v
retrieving revision 1.18.4.4
diff -u -r1.18.4.4 zle_main.c
--- Src/Zle/zle_main.c	13 Nov 2003 16:45:38 -0000	1.18.4.4
+++ Src/Zle/zle_main.c	18 Dec 2003 18:12:50 -0000
@@ -64,7 +64,7 @@
 /* last character pressed */
 
 /**/
-int c;
+mod_export int c;		/* YUK! */
 
 /* the bindings for the previous and for this key */
 
@@ -99,9 +99,9 @@
 /* the status line, and its length */
 
 /**/
-char *statusline;
+mod_export char *statusline;
 /**/
-int statusll;
+mod_export int statusll;
 
 /* The current history line and cursor position for the top line *
  * on the buffer stack.                                          */

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR Ltd., Science Park, Milton Road,
Cambridge, CB4 0WH, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

This footnote also confirms that this email message has been swept by
MIMEsweeper for the presence of computer viruses.

www.mimesweeper.com
**********************************************************************

