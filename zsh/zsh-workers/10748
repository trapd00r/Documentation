From zsh-workers-return-10748-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Apr 13 23:06:36 2000
Return-Path: <zsh-workers-return-10748-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15498 invoked from network); 13 Apr 2000 23:06:35 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 13 Apr 2000 23:06:35 -0000
Received: (qmail 29245 invoked by alias); 13 Apr 2000 23:06:26 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10748
Received: (qmail 29228 invoked from network); 13 Apr 2000 23:06:25 -0000
Date: Thu, 13 Apr 2000 19:06:23 -0400
From: Clint Adams <schizo@debian.org>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: configure-time setting of MAXJOB revisited
Message-ID: <20000413190623.A10171@dman.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
User-Agent: Mutt/1.1.2i

This returns the previous behavior as default and allows more flexibility.

Index: configure.in
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.in,v
retrieving revision 1.4
diff -u -r1.4 configure.in
--- configure.in	2000/04/13 22:25:04	1.4
+++ configure.in	2000/04/13 23:05:07
@@ -498,27 +498,6 @@
  
 AC_CHECK_HEADER([sys/ptem.h], AC_DEFINE(WINSIZE_IN_PTEM))
 
-dnl Try to get a sane value for MAXJOB
-linux_tasks_defines_mtpu=no
-AC_MSG_CHECKING(what to set MAXJOB to)
-if test $ac_cv_header_linux_tasks_h = yes; then
-AC_EGREP_CPP(yes,
-[#include <linux/tasks.h>
- #ifdef MAX_TASKS_PER_USER
- yes
- #endif
-], linux_tasks_defines_mtpu=yes)
-fi
-
-if test $linux_tasks_defines_mtpu = yes; then
-AC_DEFINE(MAXJOB, MAX_TASKS_PER_USER)
-AC_DEFINE(NEED_LINUX_TASKS_H)
-AC_MSG_RESULT(${msg}MAX_TASKS_PER_USER)
-else
-AC_DEFINE(MAXJOB, 50)
-AC_MSG_RESULT(${msg}50)
-fi
-
 dnl -------------------
 dnl CHECK FOR LIBRARIES
 dnl -------------------
@@ -1371,6 +1350,46 @@
       AC_DEFINE(GETPWNAM_FAKED)
     fi
 fi
+
+AC_MSG_CHECKING(what to set MAXJOB to)
+dnl Do you want to alter the maximum job table size?
+undefine([max_jobtable_size])dnl
+AC_ARG_ENABLE(max-jobtable-size,
+[  --enable-max-jobtable-size=MAX   Limit job table size to MAX],
+
+[if test x$enableval = xyes; then
+
+  if test $ac_cv_header_linux_tasks_h = yes; then
+   AC_EGREP_CPP(yes,
+   [#include <linux/tasks.h>
+    #ifdef MAX_TASKS_PER_USER
+    yes
+    #endif
+   ],
+   maxj=max)
+
+   if test x$maxj = xmax; then
+    AC_DEFINE(MAXJOB, MAX_TASKS_PER_USER)
+    AC_DEFINE(NEED_LINUX_TASKS_H)
+    AC_MSG_RESULT(${msg}MAX_TASKS_PER_USER)
+   else
+    AC_DEFINE(MAXJOB, 256)
+    AC_MSG_RESULT(${msg}256)
+   fi
+  fi
+
+ elif test x$enableval = xno; then
+ AC_DEFINE(MAXJOB,512)
+ AC_MSG_RESULT(${msg}512)
+ else
+ AC_DEFINE_UNQUOTED(MAXJOB,$enableval)
+ AC_MSG_RESULT(${msg}${enableval}) 
+fi],
+[
+AC_DEFINE(MAXJOB, 50)
+ AC_MSG_RESULT(${msg}50) 
+])
+
 
 dnl ---------------
 dnl dynamic loading

