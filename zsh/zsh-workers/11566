From zsh-workers-return-11566-mason-zsh=primenet.com.au@sunsite.auc.dk Thu May 25 08:02:22 2000
Return-Path: <zsh-workers-return-11566-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20738 invoked from network); 25 May 2000 08:02:20 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 25 May 2000 08:02:20 -0000
Received: (qmail 3789 invoked by alias); 25 May 2000 08:02:14 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11566
Received: (qmail 3782 invoked from network); 25 May 2000 08:02:14 -0000
Date: Thu, 25 May 2000 10:02:12 +0200 (MET DST)
Message-Id: <200005250802.KAA32560@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Bart Schaefer"'s message of Tue, 23 May 2000 15:30:38 -0700
Subject: Re: vared messes up tty state


Bart Schaefer wrote:

> If you have `stty -echo` as e.g. in an emacs buffer and you run vared,
> then after vared exits, echo mode has been forced back on.
> 
> `ttyctl -f` has no effect on this.
> 
> Arguably, vared shouldn't even work in this condition (it behaves as
> if SINGLE_LINE_ZLE, when in fact ZLE is entirely disabled).

I agree with this last one, so should we?

Bye
 Sven

diff -u -r ../oz/Src/Zle/zle_main.c ./Src/Zle/zle_main.c
--- ../oz/Src/Zle/zle_main.c	Wed May 24 19:51:03 2000
+++ ./Src/Zle/zle_main.c	Wed May 24 20:47:57 2000
@@ -740,6 +740,10 @@
     char *p1 = NULL, *p2 = NULL;
     FILE *oshout = NULL;
 
+    if (unset(USEZLE)) {
+	zwarnnam(name, "ZLE not enabled", NULL, 0);
+	return 1;
+    }
     if (zleactive) {
 	zwarnnam(name, "ZLE cannot be used recursively (yet)", NULL, 0);
 	return 1;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

