From zsh-workers-return-12553-mason-zsh=primenet.com.au@sunsite.auc.dk Sun Aug 06 19:09:58 2000
Return-Path: <zsh-workers-return-12553-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7193 invoked from network); 6 Aug 2000 19:09:57 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 6 Aug 2000 19:09:57 -0000
Received: (qmail 818 invoked by alias); 6 Aug 2000 19:09:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12553
Received: (qmail 810 invoked from network); 6 Aug 2000 19:09:37 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000806190841.ZM24504@candle.brasslantern.com>
Date: Sun, 6 Aug 2000 19:08:41 +0000
In-Reply-To: <1000805170851.ZM22662@candle.brasslantern.com>
Comments: In reply to "Bart Schaefer" <schaefer@candle.brasslantern.com>
        "Re: Rpm completion problem" (Aug  5,  5:08pm)
References: <Pine.LNX.4.21.0008050021110.16035-100000@phong.blorf.net> 
	<1000805170851.ZM22662@candle.brasslantern.com>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Wayne Davison <wayned@users.sourceforge.net>,
        Zsh Workers <zsh-workers@sunsite.auc.dk>
Subject: Re: Rpm completion problem
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Aug 5,  5:08pm, Bart Schaefer wrote:
}
} On Aug 5, 12:25am, Wayne Davison wrote:
} }
} } I've noticed a problem in rpm completions when I specify the 'p'
} } (package file) option bunched up with other options.
} 
} This was discussed in the thread referenced by zsh-workers/11752, and
} I think the patch in 11985 was supposed to provide a way to fix it, but
} _rpm never got updated.

The last word in that discussion appears to have been   Sven, do you
recall whether you every did anything specific to this?

I remarked in 11742:

} Currently _rpm uses `-p+' as the spec for the -p option.  That means that
} anything that will follow the -p (including package file name) is allowed
} to appear in the same word, or in the next word.
} 
} If we remove the `+', then "rpm -qpc" doesn't match the spec `-p', and so
} completion doesn't enter the `package_file' state -- it instead enters the
} `package_or_file' state (the default spec from the `query' state).

This is no longer the problem; remove the `+' and `rpm -qpc <TAB>' completes
package file names exactly as it should.  However, `rpm -qp<TAB>' inserts a
space rather than completing `c' et al.

Based on my exchange with Sven as quoted in 11793, I'd say that _rpm needs
another ->state in order to handle bunched query options following -qp, or
at least that the package_file state needs to be tweaked somehow.  In the
meantime, if you don't mind having to make `p' be the last option in any
bunch beginning with `-q', just remove the `+' on line 62 of _rpm.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

