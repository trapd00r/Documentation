From zsh-workers-return-26354-mason-zsh=primenet.com.au@sunsite.dk Sun Jan 18 11:56:27 2009
Return-Path: <zsh-workers-return-26354-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26041 invoked from network); 18 Jan 2009 11:56:24 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 18 Jan 2009 11:56:24 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 28912 invoked from network); 18 Jan 2009 11:56:19 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 18 Jan 2009 11:56:19 -0000
Received: (qmail 16119 invoked by alias); 18 Jan 2009 11:56:14 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26354
Received: (qmail 16105 invoked from network); 18 Jan 2009 11:56:14 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 18 Jan 2009 11:56:14 -0000
Received: from flock1.newmail.ru (flock1.newmail.ru [82.204.219.207])
	by bifrost.dotsrc.org (Postfix) with SMTP id 9F23880271F0
	for <zsh-workers@sunsite.dk>; Sun, 18 Jan 2009 12:56:10 +0100 (CET)
Received: (qmail 1672 invoked from network); 18 Jan 2009 11:56:12 -0000
Received: from unknown (HELO cooker.localnet) (arvidjaar@newmail.ru@91.77.236.30)
  by smtpd.newmail.ru with SMTP; 18 Jan 2009 11:56:12 -0000
From: Andrey Borzenkov <arvidjaar@newmail.ru>
To: zsh-workers@sunsite.dk
Subject: Re: 4.3.9: frequent crashes in completion menu selection
Date: Sun, 18 Jan 2009 14:56:05 +0300
User-Agent: KMail/1.11.0 (Linux/2.6.29-rc2-1avb; KDE/4.1.96; i686; ; )
References: <200901081526.48797.arvidjaar@newmail.ru> <200901181447.54147.arvidjaar@newmail.ru> <237967ef0901180352o492d99a9k9e067fefec7dea83@mail.gmail.com>
In-Reply-To: <237967ef0901180352o492d99a9k9e067fefec7dea83@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/signed;
  boundary="nextPart2070942.OJU8Jklg2i";
  protocol="application/pgp-signature";
  micalg=pgp-sha1
Content-Transfer-Encoding: 7bit
Message-Id: <200901181456.07375.arvidjaar@newmail.ru>
X-Virus-Scanned: ClamAV 0.92.1/8874/Sun Jan 18 06:02:00 2009 on bifrost
X-Virus-Status: Clean

--nextPart2070942.OJU8Jklg2i
Content-Type: text/plain;
  charset="utf-8"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline

On 18 =D1=8F=D0=BD=D0=B2=D0=B0=D1=80=D1=8F 2009 14:52:15 Mikael Magnusson w=
rote:
> 2009/1/18 Andrey Borzenkov <arvidjaar@newmail.ru>:
> > On 8 =D1=8F=D0=BD=D0=B2=D0=B0=D1=80=D1=8F 2009 15:30:33 Peter Stephenso=
n wrote:
> >> Andrey Borzenkov wrote:
> >> > I hit it quite often on Mandriva cooker; I do not see any
> >> > obvious post-4.3.9 commits dealing with crashes in this area.
> >> > This usually happens during menu selection browsing file system.
> >>
> >> There's probably not a cat's chance in hell of getting anywhere
> >> with this (given the code it affects) unless it can be reproduced
> >> easily.
> >
> > The following seems to do it here:
> >
> > mkdir /tmp/u{1,2}/w{1,2}
> > {pts/1}% zsh -f
> > cooker% autoload compinit; compinit
> > cooker% zmodload zsh/complist
> > cooker% zstyle ':completion:*' menu 'select=3D0'
> > cooker% bindkey -M menuselect "/" accept-and-infer-next-history
> > cooker% setopt menucomplete
> > cooker% zstyle ':completion:*' format Completing %d
> > cooker% ls /tmp/uTAB
> >
> > Now you get menu selection; press two times '/' to get "Completing
> > 'files'" (at /tmp/u1/w1/ line contents); now press undo (^_) until
> > you get empty line; press RETURN; press 'ls /tmp/uTAB'. Zsh
> > crashes.
> >
> > For some reasons crucial point is setting "format". Not only can I
> > not make it crash without this; it seems to change the undo
> > behaviour as well - pressing undo multiples times with and without
> > "format" set cycles through *different* line contents.
>
> While it doesn't explain the crash, I'm pretty sure that should be
> zstyle ':completion:*' format 'Completing %d'

This was copy'n'paste from 'zstyle -L' output. If this is wrong, zstyle=20
=2DL should be fixed.

Besides, it seems to actually work - I do get "Completing 'files'" which=20
pretty much complies with format setting :)

--nextPart2070942.OJU8Jklg2i
Content-Type: application/pgp-signature; name=signature.asc 
Content-Description: This is a digitally signed message part.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)

iEYEABECAAYFAklzGNcACgkQR6LMutpd94yvvQCdFEVi8M+nOefIVmMVMuh2TxsH
jsEAmwSw4YgUD1NwG2WLFTgrE4KCQps+
=iVZ+
-----END PGP SIGNATURE-----

--nextPart2070942.OJU8Jklg2i--

