From zsh-workers-return-24662-mason-zsh=primenet.com.au@sunsite.dk Mon Mar 03 04:58:49 2008
Return-Path: <zsh-workers-return-24662-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13402 invoked from network); 3 Mar 2008 04:58:47 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 3 Mar 2008 04:58:47 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 52456 invoked from network); 3 Mar 2008 04:58:36 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 3 Mar 2008 04:58:36 -0000
Received: (qmail 26563 invoked by alias); 3 Mar 2008 04:58:33 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24662
Received: (qmail 26549 invoked from network); 3 Mar 2008 04:58:32 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 3 Mar 2008 04:58:32 -0000
Received: from mchenry.wikimedia.org (mchenry.wikimedia.org [66.230.200.240])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 598898028C4E
	for <zsh-workers@sunsite.dk>; Mon,  3 Mar 2008 05:58:26 +0100 (CET)
Received: from sanger.wikimedia.org ([66.230.200.241]:57097)
	by mchenry.wikimedia.org with esmtp (Exim 4.63)
	(envelope-from <river@wikimedia.org>)
	id 1JW2kq-0007tR-GY
	for zsh-workers@sunsite.dk; Mon, 03 Mar 2008 04:58:24 +0000
Received: from 87-194-213-16.bethere.co.uk ([87.194.213.16]:1759 helo=fae.mshome.net)
	by sanger.wikimedia.org with esmtpsa (TLS-1.0:RSA_AES_256_CBC_SHA1:32)
	(Exim 4.63)
	(envelope-from <river@wikimedia.org>)
	id 1JW2kq-0005BY-4u
	for zsh-workers@sunsite.dk; Mon, 03 Mar 2008 04:58:24 +0000
Date: Mon, 3 Mar 2008 04:58:15 +0000
From: River Tarnell <river@wikimedia.org>
Organization: Wikimedia Foundation, Inc.
X-Priority: 3 (Normal)
Message-ID: <1282467763.20080303045815@wikimedia.org>
To: zsh-workers@sunsite.dk
Subject: [PATCH] 4.3.5 build fails on SunOS 4.1.4
MIME-Version: 1.0
Content-Type: multipart/signed; protocol="application/pgp-signature"; micalg="pgp-sha1";
  boundary="----------D911918534BE9E6F"
X-Virus-Scanned: ClamAV 0.91.2/6090/Mon Mar  3 05:16:08 2008 on bifrost
X-Virus-Status: Clean

------------D911918534BE9E6F
Content-Type: multipart/mixed;
 boundary="----------84D2150FD070B"

------------84D2150FD070B
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable

this platform doesn't provide strtoul(), and zsh has no compat.c
replacement.  the patch (attached) provides one from NetBSD sources
(which i believe has a liberal enough license to be included in zsh).

there are two remaining problems, but i have no idea where to start
on either of them:

 + unless compiled with --disable-dynamic, any attempt to use
   completion-related features crashes the shell with 'Undefined
   symbol: _incompfunc'

 + job control doesn't work properly.  while typing ^Z in 'vi'
   works fine, in 'vim', the program immediately resumes, rather
   than returning to the shell.  both work fine with the system
   'csh'.

        - river.
------------84D2150FD070B
Content-Type: application/octet-stream;
 name="zsh-sunos.diff"
Content-transfer-encoding: base64
Content-Disposition: attachment;
 filename="zsh-sunos.diff"

KioqIGNvbmZpZ3VyZS5hYy5vbGQJRnJpIEZlYiAgMSAxMToyMjoyMiAyMDA4Ci0tLSBjb25m
aWd1cmUuYWMJTW9uIE1hciAgMyAwNDozNTowNCAyMDA4CioqKioqKioqKioqKioqKgoqKiog
MTE3NCwxMTgwICoqKioKICAJICAgICAgIGdldGxvZ2luIGdldHB3ZW50IGdldHB3bmFtIGdl
dHB3dWlkIGdldGdyZ2lkIGdldGdybmFtIFwKICAJICAgICAgIGluaXRncm91cHMgbmlzX2xp
c3QgXAogIAkgICAgICAgc2V0dWlkIHNldGV1aWQgc2V0cmV1aWQgc2V0cmVzdWlkIHNldHNp
ZCBcCiEgCSAgICAgICBtZW1jcHkgbWVtbW92ZSBzdHJzdHIgc3RyZXJyb3IgXAogIAkgICAg
ICAgZ2V0cmxpbWl0IGdldHJ1c2FnZSBcCiAgCSAgICAgICBzZXRsb2NhbGUgXAogIAkgICAg
ICAgdW5hbWUgXAotLS0gMTE3NCwxMTgwIC0tLS0KICAJICAgICAgIGdldGxvZ2luIGdldHB3
ZW50IGdldHB3bmFtIGdldHB3dWlkIGdldGdyZ2lkIGdldGdybmFtIFwKICAJICAgICAgIGlu
aXRncm91cHMgbmlzX2xpc3QgXAogIAkgICAgICAgc2V0dWlkIHNldGV1aWQgc2V0cmV1aWQg
c2V0cmVzdWlkIHNldHNpZCBcCiEgCSAgICAgICBtZW1jcHkgbWVtbW92ZSBzdHJzdHIgc3Ry
ZXJyb3Igc3RydG91bCBcCiAgCSAgICAgICBnZXRybGltaXQgZ2V0cnVzYWdlIFwKICAJICAg
ICAgIHNldGxvY2FsZSBcCiAgCSAgICAgICB1bmFtZSBcCioqKiBTcmMvY29tcGF0LmMub2xk
CVR1ZSBKdWwgMTggMTA6MTc6MTEgMjAwNgotLS0gU3JjL2NvbXBhdC5jCU1vbiBNYXIgIDMg
MDM6NDA6MjggMjAwOAoqKioqKioqKioqKioqKioKKioqIDQ0OCw0NTAgKioqKgotLS0gNDQ4
LDU1MiAtLS0tCiAgfQogIC8qKi8KICAjZW5kaWYgLyogWlNIXzY0X0JJVF9UWVBFICovCisg
CisgI2lmbmRlZiBIQVZFX1NUUlRPVUwKKyAKKyAvKgorICAqIENvcHlyaWdodCAoYykgMTk5
MCwgMTk5MworICAqCVRoZSBSZWdlbnRzIG9mIHRoZSBVbml2ZXJzaXR5IG9mIENhbGlmb3Ju
aWEuICBBbGwgcmlnaHRzIHJlc2VydmVkLgorICAqCisgICogUmVkaXN0cmlidXRpb24gYW5k
IHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CisgICog
bW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2lu
ZyBjb25kaXRpb25zCisgICogYXJlIG1ldDoKKyAgKiAxLiBSZWRpc3RyaWJ1dGlvbnMgb2Yg
c291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodAorICAqICAgIG5v
dGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xh
aW1lci4KKyAgKiAyLiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXBy
b2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodAorICAqICAgIG5vdGljZSwgdGhpcyBsaXN0IG9m
IGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUKKyAgKiAg
ICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0
aGUgZGlzdHJpYnV0aW9uLgorICAqIDMuIE5laXRoZXIgdGhlIG5hbWUgb2YgdGhlIFVuaXZl
cnNpdHkgbm9yIHRoZSBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzCisgICogICAgbWF5IGJl
IHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzIGRlcml2ZWQgZnJvbSB0aGlz
IHNvZnR3YXJlCisgICogICAgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1p
c3Npb24uCisgICoKKyAgKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBSRUdF
TlRTIEFORCBDT05UUklCVVRPUlMgYGBBUyBJUycnIEFORAorICAqIEFOWSBFWFBSRVNTIE9S
IElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRI
RQorICAqIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5F
U1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFCisgICogQVJFIERJU0NMQUlNRUQuICBJTiBO
TyBFVkVOVCBTSEFMTCBUSEUgUkVHRU5UUyBPUiBDT05UUklCVVRPUlMgQkUgTElBQkxFCisg
ICogRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVN
UExBUlksIE9SIENPTlNFUVVFTlRJQUwKKyAgKiBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBO
T1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUworICAqIE9S
IFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1Mg
SU5URVJSVVBUSU9OKQorICAqIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9G
IExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUCisgICogTElBQklMSVRZ
LCBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcg
SU4gQU5ZIFdBWQorICAqIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4g
SUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YKKyAgKiBTVUNIIERBTUFHRS4KKyAg
Ki8KKyAKKyAvKgorICAqIENvbnZlcnQgYSBzdHJpbmcgdG8gYW4gdW5zaWduZWQgbG9uZyBp
bnRlZ2VyLgorICAqCisgICogSWdub3JlcyBgbG9jYWxlJyBzdHVmZi4gIEFzc3VtZXMgdGhh
dCB0aGUgdXBwZXIgYW5kIGxvd2VyIGNhc2UKKyAgKiBhbHBoYWJldHMgYW5kIGRpZ2l0cyBh
cmUgZWFjaCBjb250aWd1b3VzLgorICAqLworIHVuc2lnbmVkIGxvbmcKKyBzdHJ0b3VsKG5w
dHIsIGVuZHB0ciwgYmFzZSkKKyAJY29uc3QgY2hhciAqbnB0cjsKKyAJY2hhciAqKmVuZHB0
cjsKKyAJaW50IGJhc2U7CisgeworIAljb25zdCBjaGFyICpzOworIAl1bnNpZ25lZCBsb25n
IGFjYywgY3V0b2ZmOworIAlpbnQgYzsKKyAJaW50IG5lZywgYW55LCBjdXRsaW07CisgCisg
CS8qIGVuZHB0ciBtYXkgYmUgTlVMTCAqLworIAorIAlzID0gbnB0cjsKKyAJZG8geworIAkJ
YyA9ICh1bnNpZ25lZCBjaGFyKSAqcysrOworIAl9IHdoaWxlIChpc3NwYWNlKGMpKTsKKyAJ
aWYgKGMgPT0gJy0nKSB7CisgCQluZWcgPSAxOworIAkJYyA9ICpzKys7CisgCX0gZWxzZSB7
CisgCQluZWcgPSAwOworIAkJaWYgKGMgPT0gJysnKQorIAkJCWMgPSAqcysrOworIAl9Cisg
CWlmICgoYmFzZSA9PSAwIHx8IGJhc2UgPT0gMTYpICYmCisgCSAgICBjID09ICcwJyAmJiAo
KnMgPT0gJ3gnIHx8ICpzID09ICdYJykpIHsKKyAJCWMgPSBzWzFdOworIAkJcyArPSAyOwor
IAkJYmFzZSA9IDE2OworIAl9CisgCWlmIChiYXNlID09IDApCisgCQliYXNlID0gYyA9PSAn
MCcgPyA4IDogMTA7CisgCisgCWN1dG9mZiA9IFVMT05HX01BWCAvICh1bnNpZ25lZCBsb25n
KWJhc2U7CisgCWN1dGxpbSA9IChpbnQpKFVMT05HX01BWCAlICh1bnNpZ25lZCBsb25nKWJh
c2UpOworIAlmb3IgKGFjYyA9IDAsIGFueSA9IDA7OyBjID0gKHVuc2lnbmVkIGNoYXIpICpz
KyspIHsKKyAJCWlmIChpc2RpZ2l0KGMpKQorIAkJCWMgLT0gJzAnOworIAkJZWxzZSBpZiAo
aXNhbHBoYShjKSkgeworIAkJCWMgLT0gaXN1cHBlcihjKSA/ICdBJyAtIDEwIDogJ2EnIC0g
MTA7CisgCQl9IGVsc2UKKyAJCQlicmVhazsKKyAJCWlmIChjID49IGJhc2UpCisgCQkJYnJl
YWs7CisgCQlpZiAoYW55IDwgMCkKKyAJCQljb250aW51ZTsKKyAJCWlmIChhY2MgPiBjdXRv
ZmYgfHwgKGFjYyA9PSBjdXRvZmYgJiYgYyA+IGN1dGxpbSkpIHsKKyAJCQlhbnkgPSAtMTsK
KyAJCQlhY2MgPSBVTE9OR19NQVg7CisgCQkJZXJybm8gPSBFUkFOR0U7CisgCQl9IGVsc2Ug
eworIAkJCWFueSA9IDE7CisgCQkJYWNjICo9ICh1bnNpZ25lZCBsb25nKWJhc2U7CisgCQkJ
YWNjICs9IGM7CisgCQl9CisgCX0KKyAJaWYgKG5lZyAmJiBhbnkgPiAwKQorIAkJYWNjID0g
LWFjYzsKKyAJaWYgKGVuZHB0ciAhPSBOVUxMKQorIAkJKmVuZHB0ciA9IGFueSA/IHMgLSAx
IDogbnB0cjsKKyAJcmV0dXJuIChhY2MpOworIH0KKyAjZW5kaWYK
------------84D2150FD070B--
------------D911918534BE9E6F
Content-Type: application/pgp-signature

-----BEGIN PGP MESSAGE-----
Version: GnuPG v1.4.7 (MingW32)

iD8DBQFHy4VnIXd7fCuc5vIRAp41AJ9Sb2xSLYiMtx+divNZGOuwvFTjqACgsx2d
wgFPvaDBEsTjxHnfO8ugEQM=
=9O3d
-----END PGP MESSAGE-----

------------D911918534BE9E6F--

