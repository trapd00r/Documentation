From zsh-workers-return-28381-mason-zsh=primenet.com.au@zsh.org Thu Oct 28 12:45:12 2010
Return-Path: <zsh-workers-return-28381-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14685 invoked by alias); 28 Oct 2010 12:45:12 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28381
Received: (qmail 13738 invoked from network); 28 Oct 2010 12:45:09 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at benizi.com designates 64.130.10.15 as permitted sender)
Date: Thu, 28 Oct 2010 08:44:33 -0400 (EDT)
From: "Benjamin R. Haskell" <zsh@benizi.com>
To: zsh-workers@zsh.org
Subject: Re: Absolute path of a path
In-Reply-To: <20101028105250.GB7283@prunille.vinc17.org>
Message-ID: <alpine.LNX.2.01.1010280836030.3583@hp>
References: <AANLkTikZN2Lk3zf2fWqD917TA-Wa5jCBQSZ-7VNWVOCj@mail.gmail.com> <AANLkTi=j_OtAziY1X=1qj=zk3P7=U6my1sd=bVshp69u@mail.gmail.com> <20101027164454.GA19471@prunille.vinc17.org> <AANLkTinLOXXBT=Wsu+gKLSEMgGGPg33c+_93CyS6xLsG@mail.gmail.com>
 <20101028104451.GB19471@prunille.vinc17.org> <20101028105250.GB7283@prunille.vinc17.org>
User-Agent: Alpine 2.01 (LNX 1266 2009-07-14)
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-1463810530-2007927372-1288269898=:3583"

---1463810530-2007927372-1288269898=:3583
Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed

[moving to -workers]

> On 2010-10-28 12:44:51 +0200, Vincent Lefevre wrote:
>> FYI:
>>
>> ypig:~> realpath symlink/../vlefevre/symlink
>> /home/vlefevre
>>
>> ypig:~> echo symlink/../vlefevre/symlink(:A)
>> /home/vlefevre/vlefevre/symlink
>>
>> where symlink is a symbolic link to ".".
>
> I think that this is even a bug in zsh, as
>
> ypig:~> echo symlink/../vlefevre/symlink2(:A)
> zsh: no match
>
> So, it seems that resolution as been done correctly (it is detected 
> that symlink/../vlefevre/symlink exists but not 
> symlink/../vlefevre/symlink2), however the output for the former one 
> /home/vlefevre/vlefevre/symlink doesn't exist (there's no vlefevre 
> file or directory in /home/vlefevre).
>

FWIW, my Perl-based workaround does the right thing, as does the 
attached simple C program.  Seems like a bug.

$ echo $ZSH_VERSION $ZSH_PATCHLEVEL
4.3.10-dev-1 1.5015
$ pwd
/home/bhaskell/tmp
$ readlink symlink
.

$ echo symlink/../tmp/symlink(:A)
/home/bhaskell/tmp/tmp/symlink
## /home/bhaskell/tmp/tmp doesn't exist

$ A () { reply=("$(perl -MCwd=realpath -we 'print realpath shift' $REPLY)") }
$ echo symlink/../tmp/symlink(+A)
/home/bhaskell/tmp

$ gcc -Wall -o realpath-test{,.c}
$ ./realpath-test symlink/../tmp/symlink
/home/bhaskell/tmp

-- 
Best,
Ben
---1463810530-2007927372-1288269898=:3583
Content-Type: TEXT/x-c; name=realpath-test.c
Content-Transfer-Encoding: BASE64
Content-ID: <alpine.LNX.2.01.1010280844330.3583@hp>
Content-Description: 
Content-Disposition: attachment; filename=realpath-test.c

I2luY2x1ZGUgPGxpbWl0cy5oPg0KI2luY2x1ZGUgPHN0ZGxpYi5oPg0KI2lu
Y2x1ZGUgPHN0ZGlvLmg+DQoNCmludCBtYWluKGludCBhcmdjLCBjaGFyICoq
YXJndikgew0KCWNoYXIgcmVzb2x2ZWRbUEFUSF9NQVhdOw0KCWlmIChhcmdj
IDwgMikgew0KCQlmcHJpbnRmKHN0ZGVyciwgIlVzYWdlOiAlcyBwYXRoXG4i
LCBhcmd2WzBdKTsNCgkJcmV0dXJuIDE7DQoJfQ0KCXJlYWxwYXRoKGFyZ3Zb
MV0sIHJlc29sdmVkKTsNCglwcmludGYoIiVzXG4iLCByZXNvbHZlZCk7DQoJ
cmV0dXJuIDA7DQp9DQo=

---1463810530-2007927372-1288269898=:3583--

