From zsh-workers-return-9134-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Dec 22 13:14:49 1999
Return-Path: <zsh-workers-return-9134-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11790 invoked from network); 22 Dec 1999 13:14:48 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 22 Dec 1999 13:14:48 -0000
Received: (qmail 26423 invoked by alias); 22 Dec 1999 13:14:35 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9134
Received: (qmail 26416 invoked from network); 22 Dec 1999 13:14:35 -0000
Date: Wed, 22 Dec 1999 13:15:31 GMT
Message-Id: <199912221315.NAA14617@mango.dublin.iona.ie>
To: zsh-workers@sunsite.auc.dk
From: zefram@fysh.org
Subject: PATCH: Re: Build problem with new module aliases & nondynamic linking

>ERROR: linked-in module `cap' depends on `zsh/cap'

Oops.  I'm glad I put that error message in there.

-zefram

diff -ur ../zsh-/Src/Makefile.in ./Src/Makefile.in
--- ../zsh-/Src/Makefile.in	Thu Dec  9 10:13:14 1999
+++ ./Src/Makefile.in	Wed Dec 22 12:52:13 1999
@@ -124,7 +124,7 @@
 	if test -f mymods.conf; then \
 	    cat mymods.conf > $@; \
 	elif test @D@ = N; then \
-	    cat $(sdir)/xmods.conf > $@; \
+	    sed -n '/L.* /{s/^.* //;p;}' < $(sdir)/xmods.conf > $@; \
 	else \
 	    echo > $@; \
 	fi
diff -ur ../zsh-/Src/mkbltnmlst.sh ./Src/mkbltnmlst.sh
--- ../zsh-/Src/mkbltnmlst.sh	Fri Dec 17 13:56:15 1999
+++ ./Src/mkbltnmlst.sh	Wed Dec 22 12:56:11 1999
@@ -12,7 +12,7 @@
 XMODCF=${XMODCF-$srcdir/xmods.conf}
 
 bin_mods=" zsh/main "`sed 's/^/ /;s/$/ /' $MODBINS`
-x_mods=`cat $XMODCF`
+x_mods=`sed 's/^.* //' $XMODCF`
 . ./modules.index
 
 trap "rm -f $1; exit 1" 1 2 15
diff -ur ../zsh-/Src/xmods.conf ./Src/xmods.conf
--- ../zsh-/Src/xmods.conf	Thu Dec 16 14:31:30 1999
+++ ./Src/xmods.conf	Wed Dec 22 12:54:56 1999
@@ -1,29 +1,29 @@
-zsh/rlimits
-zsh/zle
-zsh/complete
-zsh/compctl
-zsh/sched
-zsh/complist
-zsh/zutil
-zsh/computil
-zsh/parameter
-zsh/zleparameter
+L zsh/rlimits
+L zsh/zle
+L zsh/complete
+L zsh/compctl
+L zsh/sched
+L zsh/complist
+L zsh/zutil
+L zsh/computil
+L zsh/parameter
+L zsh/zleparameter
 cap
 clone
-compctl
-complete
-complist
-computil
+L compctl
+L complete
+L complist
+L computil
 deltochar
 example
 files
 mapfile
 mathfunc
-parameter
-rlimits
-sched
+L parameter
+L rlimits
+L sched
 stat
 zftp
-zle
-zleparameter
-zutil
+L zle
+L zleparameter
+L zutil
diff -ur ../zsh-/Src/zsh.mdd ./Src/zsh.mdd
--- ../zsh-/Src/zsh.mdd	Thu Dec 16 14:26:35 1999
+++ ./Src/zsh.mdd	Wed Dec 22 12:53:21 1999
@@ -62,7 +62,7 @@
 	@echo "Creating \`$@'."
 	@( \
 	    binmods=`sed 's/^/ /;s/$$/ /' modules-bltin`; \
-	    for mod in `cat $(sdir_src)/xmods.conf`; do \
+	    for mod in `sed 's/^.* //' $(sdir_src)/xmods.conf`; do \
 		q_mod=`echo $$mod | sed 's,Q,Qq,g;s,_,Qu,g;s,/,Qs,g'`; \
 		case $$binmods in \
 		    *" $$mod "*) \
END

