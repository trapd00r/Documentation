From zsh-workers-return-22730-mason-zsh=primenet.com.au@sunsite.dk Sun Sep 17 22:40:09 2006
Return-Path: <zsh-workers-return-22730-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15432 invoked from network); 17 Sep 2006 22:40:08 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.5 (2006-08-29) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 17 Sep 2006 22:40:08 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 65361 invoked from network); 17 Sep 2006 22:40:01 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Sep 2006 22:40:01 -0000
Received: (qmail 4801 invoked by alias); 17 Sep 2006 22:39:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22730
Received: (qmail 4792 invoked from network); 17 Sep 2006 22:39:58 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 17 Sep 2006 22:39:58 -0000
Received: (qmail 65078 invoked from network); 17 Sep 2006 22:39:58 -0000
Received: from vms048pub.verizon.net (206.46.252.48)
  by a.mx.sunsite.dk with SMTP; 17 Sep 2006 22:39:57 -0000
Received: from torch.brasslantern.com ([71.116.118.106])
 by vms048.mailsrvcs.net
 (Sun Java System Messaging Server 6.2-4.02 (built Sep  9 2005))
 with ESMTPA id <0J5R006IUDMJ5R30@vms048.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Sun, 17 Sep 2006 17:39:56 -0500 (CDT)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id k8HMdsRG032754	for
 <zsh-workers@sunsite.dk>; Sun, 17 Sep 2006 15:39:55 -0700
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id k8HMds4B032753	for zsh-workers@sunsite.dk; Sun,
 17 Sep 2006 15:39:54 -0700
Date: Sun, 17 Sep 2006 15:39:54 -0700
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: PATCH: functrace [was Re: funcstack and backtraces]
In-reply-to: <20060917191418.GA22898@scowler.net>
To: zsh-workers@sunsite.dk
Message-id: <060917153954.ZM32752@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <20060901191034.GA31335@scowler.net>
	<060904142643.ZM9472@torch.brasslantern.com>
	<20060917191418.GA22898@scowler.net>
Comments: In reply to Clint Adams <clint@zsh.org>
 "PATCH: functrace [was Re: funcstack and backtraces]" (Sep 17,  3:14pm)

On Sep 17,  3:14pm, Clint Adams wrote:
}
} This is buggy when either FUNCTIONARGZERO is unset, int is larger than
} 64-bits, or... I forget.

 ... lineno is greater than MAXINT?

} Furthermore, I am told that function_name:function_lineno is useless

Nonsense.

} and that it should be filename:file_lineno in all cases.

So for functions defined at the command line you're supposed to output
"stdin" and the number of input lines since the interpreter started?

I'd say whoever is telling you this stuff is not thinking clearly.  In
several cases it's not even possible to know the filename.

In any event:

schaefer<502> (foo() { print $functrace } ; foo )
zsh: segmentation fault (core dumped)  (; foo () { ... }; foo; )

#0  0x001e3de6 in strcpy () from /lib/tls/libc.so.6
#1  0x080aa616 in dupstring (
    s=0xb7d96590 "Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:"...)
    at ../../zsh-4.0/Src/string.c:40
#2  0x080ac028 in strcatsub (d=0xbff08010, pb=0xb7d96578 "", pe=0xb7d96578 "", 
    src=0xb7d96590 "Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:Src/zsh:"..., l=9, 
    s=0xb7d96582 "", glbsub=0, copied=0) at ../../zsh-4.0/Src/subst.c:564
#3  0x080b1857 in paramsubst (l=0xb7d96548, n=0xb7d96560, str=0xbff081a8, 
    qt=0, ssub=0) at ../../zsh-4.0/Src/subst.c:3154
#4  0x080ab18b in stringsubst (list=0xb7d96548, node=0xb7d96560, ssub=0, 
    asssub=0) at ../../zsh-4.0/Src/subst.c:156
#5  0x080aabdc in prefork (list=0xb7d96548, flags=0)
    at ../../zsh-4.0/Src/subst.c:91
#6  0x08063052 in execcmd (state=0xbff08650, input=0, output=0, how=18, 
    last1=2) at ../../zsh-4.0/Src/exec.c:1963
#7  0x080616ce in execpline2 (state=0xbff08650, pcode=67, how=18, input=0, 
    output=0, last1=0) at ../../zsh-4.0/Src/exec.c:1301
#8  0x08060bd2 in execpline (state=0xbff08650, slcode=4098, how=18, last1=0)
    at ../../zsh-4.0/Src/exec.c:1087
#9  0x08060576 in execlist (state=0xbff08650, dont_change_job=1, exiting=0)
    at ../../zsh-4.0/Src/exec.c:893
#10 0x08060285 in execode (p=0x8d82728, dont_change_job=1, exiting=0)
    at ../../zsh-4.0/Src/exec.c:793
#11 0x08067e3f in runshfunc (prog=0x8d82728, wrap=0x0, name=0xb7d96538 "foo")
    at ../../zsh-4.0/Src/exec.c:3915
#12 0x08067bea in doshfunc (name=0x8d78020 "foo", prog=0x8d82728, 
    doshargs=0xb7d96508, flags=0, noreturnval=0)
    at ../../zsh-4.0/Src/exec.c:3824
#13 0x08067511 in execshfunc (shf=0x8daf8e8, args=0xb7d96508)
    at ../../zsh-4.0/Src/exec.c:3612
#14 0x0806501d in execcmd (state=0xbff08e50, input=0, output=0, how=18, 
    last1=1) at ../../zsh-4.0/Src/exec.c:2583
#15 0x080616ce in execpline2 (state=0xbff08e50, pcode=195, how=18, input=0, 
    output=0, last1=1) at ../../zsh-4.0/Src/exec.c:1301
#16 0x08060bd2 in execpline (state=0xbff08e50, slcode=3074, how=18, last1=1)
    at ../../zsh-4.0/Src/exec.c:1087
#17 0x08060576 in execlist (state=0xbff08e50, dont_change_job=0, exiting=1)
    at ../../zsh-4.0/Src/exec.c:893
#18 0x080653e2 in execcmd (state=0xbff08e50, input=0, output=0, how=18, 
    last1=2) at ../../zsh-4.0/Src/exec.c:2666
#19 0x080616ce in execpline2 (state=0xbff08e50, pcode=195, how=18, input=0, 
    output=0, last1=0) at ../../zsh-4.0/Src/exec.c:1301
#20 0x08060bd2 in execpline (state=0xbff08e50, slcode=24578, how=18, last1=0)
    at ../../zsh-4.0/Src/exec.c:1087
#21 0x08060576 in execlist (state=0xbff08e50, dont_change_job=0, exiting=0)
    at ../../zsh-4.0/Src/exec.c:893
#22 0x08060285 in execode (p=0xb7d96420, dont_change_job=0, exiting=0)
    at ../../zsh-4.0/Src/exec.c:793
#23 0x08077866 in loop (toplevel=1, justonce=0) at ../../zsh-4.0/Src/init.c:167
#24 0x0807a46a in zsh_main (argc=1, argv=0xbff08f94)
    at ../../zsh-4.0/Src/init.c:1332
#25 0x0804c2ae in main (argc=1, argv=0xbff08f94) at ../../zsh-4.0/Src/main.c:93

