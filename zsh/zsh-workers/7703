From zsh-workers-return-7703-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Sep 07 22:24:14 1999
Return-Path: <zsh-workers-return-7703-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23120 invoked from network); 7 Sep 1999 22:24:13 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 7 Sep 1999 22:24:13 -0000
Received: (qmail 4388 invoked by alias); 7 Sep 1999 22:24:04 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7703
Received: (qmail 4377 invoked from network); 7 Sep 1999 22:24:03 -0000
Date: Tue, 7 Sep 1999 18:24:01 -0400
From: Clint Adams <schizo@debian.org>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: [3.1.6-pws-3] fix use of DESTDIR in fns
Message-ID: <19990907182401.A28749@dman.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 0.95.4i

--- zsh-3.1.6.pws3.orig/Config/installfns.sh
+++ zsh-3.1.6.pws3/Config/installfns.sh
@@ -1,6 +1,6 @@
 #!/bin/sh
 
-if test -d $fndir.old; then
+if test -d $DESTDIR$fndir.old; then
   add_old=1
 fi
 
@@ -22,27 +22,27 @@
     if test x$FUNCTIONS_SUBDIRS != x -a x$FUNCTIONS_SUBDIRS != xno; then
       subfile="$file"
       subdir="`echo $file | sed -e 's%/[^/]*$%%'`"
-      olddir="$fndir.old/$subdir"
-      instdir="$fndir/$subdir"
+      olddir="$DESTDIR$fndir.old/$subdir"
+      instdir="$DESTDIR$fndir/$subdir"
     else
       subfile="`echo $file | sed -e 's%^.*/%%'`"
-      olddir="$fndir.old"
-      instdir="$fndir"
+      olddir="$DESTDIR$fndir.old"
+      instdir="$DESTDIR$fndir"
     fi
-    if test -f $fndir/$subfile; then
-      if cmp $fndir/$subfile $sdir/$file >/dev/null; then :; else
+    if test -f $DESTDIR$fndir/$subfile; then
+      if cmp $DESTDIR$fndir/$subfile $sdir/$file >/dev/null; then :; else
 	$sdir_top/mkinstalldirs $olddir
-        mv $fndir/$subfile $olddir
+        mv $DESTDIR$fndir/$subfile $olddir
         : ${add_old:=1}
       fi
     fi
-    $sdir_top/mkinstalldirs $DESTDIR$instdir || exit 1
-    $INSTALL_DATA $sdir/$file $DESTDIR$instdir || exit 1
+    $sdir_top/mkinstalldirs $instdir || exit 1
+    $INSTALL_DATA $sdir/$file $instdir || exit 1
   fi
 done
 
 if test x$add_old != x1; then
-  rm -rf $fndir.old
+  rm -rf $DESTDIR$fndir.old
 fi
 
 exit 0

