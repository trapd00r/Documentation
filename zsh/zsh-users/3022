From zsh-users-return-3022-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Apr 13 16:22:06 2000
Return-Path: <zsh-users-return-3022-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11941 invoked from network); 13 Apr 2000 16:22:05 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 13 Apr 2000 16:22:05 -0000
Received: (qmail 19617 invoked by alias); 13 Apr 2000 16:21:33 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 3022
Received: (qmail 19601 invoked from network); 13 Apr 2000 16:21:31 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000413162121.ZM17034@candle.brasslantern.com>
Date: Thu, 13 Apr 2000 16:21:20 +0000
In-Reply-To: <38F5B637.5D5BE0F1@u.genie.co.uk>
Comments: In reply to Oliver Kiddle <opk@u.genie.co.uk>
        "Intercepting commands before they're run" (Apr 13, 12:57pm)
References: <38F5B637.5D5BE0F1@u.genie.co.uk>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Oliver Kiddle <opk@u.genie.co.uk>, zsh-users@sunsite.auc.dk
Subject: Re: Intercepting commands before they're run
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Apr 13, 12:57pm, Oliver Kiddle wrote:
} Subject: Intercepting commands before they're run
}
} I've just been experimenting with the MH mail system to see if it will
} do what I hope. In mush I can ...

Sigh.  It used to be that most people switched from MH to mush because
mush was so much faster.

} ... just type a message number to see a
} message so I tried to think of a way to persuade zsh to do this.
} 
} preexec() {
}   [[ $1 = <-> ]] && show $1
} }

Try (assuming you have FUNCTION_ARGZERO set):

    preexec() {
      [[ $1 = <-> ]] && function $1 { show $0 ; unfunction $0 }
    }

The more general case is of course

    preexec() {
      setopt localoptions extendedglob
      local cmd
      cmd=($=1)
      case $cmd[1] in
      (<->) function $1 { show $0 ; unfunction $0 };;
      (d(<->[-,])#<->) function $1 { delete ${0#d} ; unfunction $0 };;
      # ... do the whole mush command set ...
      (...#) eval function $1 \{ cd ..${${1#..}:gs@.@/..}\; unfunction $1 \};;
      # ... any other mappings you want go here ...
      (*) ;;
      esac
    }

} [...] maybe we should let preexec return an exit code to say the command
} should not be run [...]

I think I suggested that at one point, but I don't recall whether there
was any discussion.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

