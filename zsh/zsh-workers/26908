From zsh-workers-return-26908-mason-zsh=primenet.com.au@sunsite.dk Thu Apr 30 12:35:53 2009
Return-Path: <zsh-workers-return-26908-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22206 invoked from network); 30 Apr 2009 12:35:41 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 30 Apr 2009 12:35:41 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 83419 invoked from network); 30 Apr 2009 12:35:34 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 30 Apr 2009 12:35:34 -0000
Received: (qmail 12880 invoked by alias); 30 Apr 2009 12:35:28 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26908
Received: (qmail 12862 invoked from network); 30 Apr 2009 12:35:28 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 30 Apr 2009 12:35:28 -0000
Received: from mail-ew0-f162.google.com (mail-ew0-f162.google.com [209.85.219.162])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 758678028C71
	for <zsh-workers@sunsite.dk>; Thu, 30 Apr 2009 14:33:02 +0200 (CEST)
Received: by ewy6 with SMTP id 6so1109359ewy.45
        for <zsh-workers@sunsite.dk>; Thu, 30 Apr 2009 05:35:24 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:from:date:message-id
         :subject:to:content-type:content-transfer-encoding;
        bh=0FwT/2+ZMRQhhiwvHHI9YbBKwgmpFVlVE0YMKCDOs1E=;
        b=VKCGbvMC+9u/dYlAcyWIMWYzkbBcogGmc43tefHKGnWj4UQMOiuX7UqvdfJELfiCB/
         ucfIdEd8AyxkTWQ7l7lZeS+X9j/FBC1zvFxyaUw0EWRpYDM8fMc22ABWspL0UH/EMX9h
         eAENzXf7X6aCOC5hiV5cNVNa31RBCXjLLdkN0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        b=E0gBOrZHOsG1EQkqbZDJnXI4kLm4FWtsANumqwCrPbcyEpJz93856+Ew7L1c4bmRMx
         5E0KqY1yv5FDRLXD0ZkwY3seazyWAIE3AhPDh3u36JWRhz9yXo60ntJXaHAQpSyNFQol
         Z9WqKDxbTRLGMPR7NwUs0aVVJHn5Pe4i4Zz2c=
MIME-Version: 1.0
Received: by 10.216.52.194 with SMTP id e44mr482287wec.34.1241094924119; Thu, 
	30 Apr 2009 05:35:24 -0700 (PDT)
From: =?ISO-8859-1?Q?Murilo_Opsfelder_Ara=FAjo?= <mopsfelder@gmail.com>
Date: Thu, 30 Apr 2009 09:35:04 -0300
Message-ID: <e17dc37a0904300535q4ff7b681w76a2d63f7b8a1146@mail.gmail.com>
Subject: zsh seg fault when TERM = linux
To: zsh-workers@sunsite.dk
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Scanned: ClamAV 0.92.1/9306/Thu Apr 30 03:47:06 2009 on bifrost
X-Virus-Status: Clean

Hi zsh workers,

I'd like to report a situation for you.

I'm trying to connect in a ssh server with a user using zsh as your
default shell but zsh crashes.

In following, there are some info. If you need more, please, feel free to a=
sk.

TERM env var on client side is set to 'linux':

client$ echo $TERM
linux

On the server I changed the user's shell to csh:

server$ echo $SHELL
/bin/csh

When logged in on server I tried to run zsh:

server$ zsh
Segmentation fault
Exit 139

I tried a gdb with zsh. See the results:

server$ gdb zsh
GNU gdb 6.1.1 [FreeBSD]
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you ar=
e
welcome to change it and/or distribute copies of it under certain condition=
s.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i386-marcel-freebsd"...(no debugging
symbols found)...
(gdb) run
Starting program: /usr/local/bin/zsh
(no debugging symbols found)...(no debugging symbols found)...(no
debugging symbols found)...(no debugging symbols found)...(no
debugging symbols found)...(no debugging symbols found)...(no
debugging symbols found)...
Program received signal SIGSEGV, Segmentation fault.
0x283784bd in strlen () from /lib/libc.so.7
(gdb) bt
#0  0x283784bd in strlen () from /lib/libc.so.7
#1  0x282f600e in cgetset () from /lib/libc.so.7
#2  0x282f64f2 in cgetent () from /lib/libc.so.7
#3  0x2824940e in _nc_read_termcap_entry () from /lib/libncursesw.so.7
#4  0x2826accf in _nc_read_entry () from /lib/libncursesw.so.7
#5  0x28268d47 in _nc_setupterm () from /lib/libncursesw.so.7
#6  0x2823d928 in tgetent () from /lib/libncursesw.so.7
#7  0x0807bd29 in init_term ()
#8  0x0809593b in setstrvalue ()
#9  0x08099ba7 in assignsparam ()
#10 0x0809ab3e in createparamtable ()
#11 0x0807b9df in setupvals ()
#12 0x0807d6ce in zsh_main ()
#13 0x08052e32 in main ()
(gdb)

Does gdb seem to be OK?

To resolve the problem I rollbacked user's shell to zsh on server side
and did a env TERM=3Dxterm on client side. See:

client$ env TERM=3Dxterm ssh remoteuser@server
Password: *******
server$

So, I don't know if this situation is a bug or a conf problem. Feel
free to ask more information.

Thanks in advance.

--=20
Murilo Opsfelder Araujo
mopsfelder@gmail.com
{murilo,panda}@bsd.com.br
BSD will never die.
"Tempo dif=EDcil esse em que estamos, em que =E9 mais f=E1cil quebrar um
=E1tomo do que um preconceito." - Albert Einstein

