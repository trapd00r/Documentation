From zsh-users-return-12579-mason-zsh=primenet.com.au@sunsite.dk Fri Feb 15 13:57:39 2008
Return-Path: <zsh-users-return-12579-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8329 invoked from network); 15 Feb 2008 13:57:38 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 15 Feb 2008 13:57:38 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 44213 invoked from network); 15 Feb 2008 13:57:21 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 15 Feb 2008 13:57:21 -0000
Received: (qmail 18490 invoked by alias); 15 Feb 2008 13:57:12 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12579
Received: (qmail 18469 invoked from network); 15 Feb 2008 13:57:11 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 15 Feb 2008 13:57:11 -0000
Received: from prunille.vinc17.org (vinc17.pck.nerim.net [213.41.242.187])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 38EF880482A1
	for <zsh-users@sunsite.dk>; Fri, 15 Feb 2008 14:57:03 +0100 (CET)
Received: by prunille.vinc17.org (Postfix, from userid 501)
	id 15C8C1FAB009; Fri, 15 Feb 2008 14:57:03 +0100 (CET)
Date: Fri, 15 Feb 2008 14:57:02 +0100
From: Vincent Lefevre <vincent@vinc17.org>
To: ZSH User List <zsh-users@sunsite.dk>
Subject: Re: timeout problem in ssh sessions
Message-ID: <20080215135702.GU619@prunille.vinc17.org>
Mail-Followup-To: ZSH User List <zsh-users@sunsite.dk>
References: <080212083755.ZM20121@torch.brasslantern.com> <20080212232947.GA13793@spiegl.de> <080212200708.ZM20711@torch.brasslantern.com> <20080213134200.GB31852@spiegl.de> <200802131349.m1DDnXRF004831@news01.csr.com> <27b8b8a0802130621x47568c7fo304848d02a1c6e76@mail.gmail.com> <20080213143803.GI619@prunille.vinc17.org> <20080214125415.GC31852@spiegl.de> <20080214180818.GO619@prunille.vinc17.org> <20080215103220.GF31852@spiegl.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <20080215103220.GF31852@spiegl.de>
X-Mailer-Info: http://www.vinc17.org/mutt/
User-Agent: Mutt/1.5.17-vl-r19795 (2008-01-17)
X-Virus-Scanned: ClamAV 0.91.2/5830/Fri Feb 15 14:07:34 2008 on bifrost
X-Virus-Status: Clean

On 2008-02-15 11:32:20 +0100, Andy Spiegl wrote:
> if whence xsel > /dev/null 2>&1; then
>   LEFTOVER=`ps -eo user,pid,ppid,s,cpu,pmem,rss,vsize,bsdstart,etime,bsdtime,cmd | /bin/grep -v "etime,bsdtime,cmd" | /bin/grep -iE xsel | /bin/grep -v "grep -iE"`
>   if [[ -n $LEFTOVER ]]; then
>     echo 'Leftover "xsel" process:'
>     echo $LEFTOVER
> 
>     # kill xsel (started by .zsh/functions/mouse.support) if in a ssh session
>     # otherwise sshd will hang until the X clipboard is read or cleared
>     if [[ -z ${OSTYPE:#linux*} && -n $SSH_CLIENT &&
>        ${(M)${(f)"$(</proc/$PPID/status)"}:#Name:*} == Name:[[:blank:]]sshd ]]; then
>       echo -n "Terminating xsel..."
>       xsel -c -b
>       echo -e "done.\n"
> 
>       # or kill the parent sshd (pretty brutal, might close other programs!)
>       # kill -HUP $PPID 2>/dev/null

I think it would probably be better to kill the parent sshd, as if you
have two ssh sessions to the same machine, terminating the first one
will also terminate xsel for the other one.

-- 
Vincent Lefèvre <vincent@vinc17.org> - Web: <http://www.vinc17.org/>
100% accessible validated (X)HTML - Blog: <http://www.vinc17.org/blog/>
Work: CR INRIA - computer arithmetic / Arenaire project (LIP, ENS-Lyon)

