From zsh-users-return-14359-mason-zsh=primenet.com.au@sunsite.dk Thu Sep 10 09:58:18 2009
Return-Path: <zsh-users-return-14359-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4914 invoked from network); 10 Sep 2009 09:58:05 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 10 Sep 2009 09:58:05 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 11756 invoked from network); 10 Sep 2009 09:57:51 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 Sep 2009 09:57:51 -0000
Received: (qmail 26075 invoked by alias); 10 Sep 2009 09:57:38 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 14359
Received: (qmail 26050 invoked from network); 10 Sep 2009 09:57:37 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 10 Sep 2009 09:57:37 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [208.87.233.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 1B03B8043ADF
	for <zsh-users@sunsite.dk>; Thu, 10 Sep 2009 11:57:20 +0200 (CEST)
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly25g.srv.mailcontrol.com (MailControl) with ESMTP id n8A9s4ro017471
	for <zsh-users@sunsite.dk>; Thu, 10 Sep 2009 10:56:50 +0100
Received: from news01 ([10.99.50.25]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 10 Sep 2009 10:56:37 +0100
Date: Thu, 10 Sep 2009 10:56:36 +0100
From: Peter Stephenson <pws@csr.com>
To: <zsh-users@sunsite.dk>
Subject: Re: [ksh emulation] zle and bindkey commands not available when
 called from /etc/kshrc
Message-ID: <20090910105636.38d6bf14@news01>
In-Reply-To: <38D4FA2BB99A674BADDED237051D97A70C75C3EE@FFBRUE001.cfmu.corp.eurocontrol.int>
References: <38D4FA2BB99A674BADDED237051D97A70C75C3EE@FFBRUE001.cfmu.corp.eurocontrol.int>
Organization: CSR
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.8; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 10 Sep 2009 09:56:37.0211 (UTC) FILETIME=[FC8D2AB0:01CA31FC]
X-Scanned-By: MailControl A-09-22-01 (www.mailcontrol.com) on 10.71.0.135
X-Virus-Scanned: ClamAV 0.94.2/9791/Thu Sep 10 03:03:33 2009 on bifrost
X-Virus-Status: Clean

On Thu, 10 Sep 2009 11:37:24 +0200
"Tristan TERPELLE" <tristan.terpelle@eurocontrol.int> wrote:
> When I use zsh' ksh emulation mode, the following lines in /etc/kshrc
> result in errors:
> 
> autoload -Uz edit-command-line
> zle -N edit-command-line
> bindkey -M vicmd 'v' edit-command-line
> 
> The errors are:
> 
> /etc/kshrc:4: command not found: zle
> /etc/kshrc:5: command not found: bindkey
> /etc/kshrc:4: command not found: zle
> /etc/kshrc:5: command not found: bindkey
> /etc/kshrc:4: command not found: zle
> /etc/kshrc:5: command not found: bindkey

When it starts up in ksh emulation, zsh doesn't arrange to load modules
with its own extensions automatically when they are accessed by command
names, so that the names of the builtins don't clash.  It's probably worth
pointing out that zsh isn't really designed to do it's own clever
extensions in other emulations---they're there as an alternative, to make
it easier to use stuff written for other shells.  So you're going a bit
beyond the design criteria.  However, there are usually ways of fixing
things up.

For an interactive shell you can load the zle module by hand:

zmodload zsh/zle

(if you have an older version of zsh, not a recent 4.3 release, use
"zmodload -i zsh/zle" to avoid an error if the module was already loaded).
This is slightly simpler than the code it's replacing, actually, which
would mark the command zle and bindkey for autoloading---however, if you're
about to call the commands anyway, that's pointless.

You might encounter similar problems with completion, if you're using
that, and need to load the modules zsh/complete and zsh/computil.  I'm not
sure how well the completion system is set up to be called from ksh
emulation.

-- 
Peter Stephenson <pws@csr.com>            Software Engineer
Tel: +44 (0)1223 692070                   Cambridge Silicon Radio Limited
Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, UK



Member of the CSR plc group of companies. CSR plc registered in England and Wales, registered number 4187346, registered office Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, United Kingdom

