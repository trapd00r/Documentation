From zsh-workers-return-19524-mason-zsh=primenet.com.au@sunsite.dk Tue Mar 02 14:26:15 2004
Return-Path: <zsh-workers-return-19524-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29595 invoked from network); 2 Mar 2004 14:26:14 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 2 Mar 2004 14:26:14 -0000
Received: (qmail 16538 invoked by alias); 2 Mar 2004 14:26:05 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19524
Received: (qmail 16489 invoked from network); 2 Mar 2004 14:26:05 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 2 Mar 2004 14:26:05 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [82.69.48.121] by sunsite.dk (MessageWall 1.0.8) with SMTP; 2 Mar 2004 14:26:2 -0000
Received: by umarumohammed.org (Postfix, from userid 1000)
	id 0EDEE15AEFB; Tue,  2 Mar 2004 14:27:07 +0000 (GMT)
Date: Tue, 2 Mar 2004 14:27:07 +0000
From: Ibraheem Umaru-Mohammed <umarumohammed@btinternet.com>
To: Peter Stephenson <pws@csr.com>
Cc: Ibraheem Umaru-Mohammed <umarumohammed@btinternet.com>,
	Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: 4.2.0-pre-1
Message-ID: <20040302142707.GA4801@rabox>
References: <20040302114621.GA3581@rabox> <17613.1078229661@csr.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <17613.1078229661@csr.com>
X-OS: Gentoo Base System version 1.4.3.13p1 - Linux 2.6.3-rc2-gentoo
User-Agent: Mutt/1.5.6i

On [02/03/04 12:14 +0000], Peter Stephenson wrote:
> Ibraheem Umaru-Mohammed wrote:
> > Hmmmn, sigcount.h seems to have unclosed quotes:
> > 
> > ,---- [ sigcount.h ]
> > | #define SIGCOUNT        59
> > | #define sigmsg(sig) ((sig) <= SIGCOUNT ? sig_msg[sig] : "unknown signal3)
> > `----
> 
> Yes, I can believe that's wrong...  Presumably it's also wrong in
> signames.c.
> 
> The problem must be in signames2.awk which generates this:
> 
>     printf "#define sigmsg(sig) ((sig) <= SIGCOUNT ? sig_msg[sig] : %c%s%c)", 34, "unknown signal", 34
> 
> My guess is your awk is truncating the input line in some weird way.
> (It can't be 80 characters, however, since you wouldn't get the `unknown
> signal' at all.)  Can you try altering that line as per the following
> patch and see if that helps?
> 
> If your awk is playing up, you might find other weirdness, in particular
> the `# ifdef USE_SUSPENDED' bit in signames.c.  So even if it looks like
> it works it would be worth checking (or posting) the resulting signames.c.
> Any fixes ought to be similarly trivial, but I wouldn't like to second
> guess what awk is actually getting up to.
> 
[...]

I think I've found what the problem is, but have no idea why it is happening.
Take a look at the following:

Linux:

	[ibraheem@sonic:~ ] 42 % uname -a
	Linux sonic 2.6.3-rc2-gentoo #2 SMP Wed Feb 18 09:12:33 GMT 2004 i686
	Pentium III (Coppermine) GenuineIntel GNU/Linux
	[ibraheem@sonic:~ ] 43 %  nawk 'BEGIN {printf "\n\n#define sigmsg(sig) ((sig) <= SIGCOUNT ? sig_msg[sig] : %c%s%c)\n", 34, "unknown signal", 34}'


	#define sigmsg(sig) ((sig) <= SIGCOUNT ? sig_msg[sig] : "unknown
	signal")
	[ibraheem@sonic:~ ] 44 %

AIX 4.3:
	
	[ibraheem@maserati:~ ] 45 % uname -a
	AIX maserati 3 4 0043CDDA4C00
	[ibraheem@maserati:~ ] 46 % nawk 'BEGIN {printf "\n\n#define sigmsg(sig) ((sig) <= SIGCOUNT ? sig_msg[sig] : %c%s%c)\n", 34, "unknown signal", 34}'


	#define sigmsg(sig) ((sig) <= SIGCOUNT ? sig_msg[sig] : "unknown signal")
	[ibraheem@maserati:~ ] 47 %

AIX 5.2

	ibraheem@md000002s:~ ] 48 % uname -a
	AIX md000002s 2 5 00541F5A4C00
	ibraheem@md000002s:~ ] 49 % nawk 'BEGIN {printf "\n\n#define sigmsg(sig) ((sig) <= SIGCOUNT ? sig_msg[sig] : %c%s%c)\n", 34, "unknown signal", 34}'


	#define sigmsg(sig) ((sig) <= SIGCOUNT ? sig_msg[sig] : "unknown signal3)
	ibraheem@md000002s: ~] 50 % 

However, it appears that /bin/nawk is the same as /bin/awk, and not a symlink as it should be.
I will attempt to compile up nawk, and use that. 

Cheers,

			--ibraheem.

-- 

