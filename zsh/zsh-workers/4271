From zsh-workers-request@math.gatech.edu Wed Aug 05 23:38:51 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21568 invoked from network); 5 Aug 1998 23:38:50 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 5 Aug 1998 23:38:50 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id TAA10398;
	Wed, 5 Aug 1998 19:25:51 -0400 (EDT)
Resent-Date: Wed, 5 Aug 1998 19:25:51 -0400 (EDT)
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <980805162756.ZM2128@candle.brasslantern.com>
Date: Wed, 5 Aug 1998 16:27:56 -0700
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: zsh-workers@math.gatech.edu
Subject: Zsh 3.1.4 "BUG: useheap in doexpandhist()" on completion from zle widget
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"4JV8E.0.PY2._dEor"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4271
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

The setup:
__________

function frob { echo x $BUFFER x $LBUFFER x $RBUFFER x }
function prefrob { zle expand-or-complete; zle redisplay }

compctl -K frob foo
zle -N prefrob prefrob
bindkey \^I prefrob
__________

Now:

zsh% foo <TAB>

and the BUG warning appears.  The frob function is just to demonstrate that
completion is indeed being invoked from prefrob; it actually doesn't matter
what the completion is.  Any call to expand-or-complete (or related widgets)
from a user-defined widget will trigger the problem.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

