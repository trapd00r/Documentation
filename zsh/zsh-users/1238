From zsh-workers-request@math.gatech.edu Tue Jan 20 04:55:22 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 14902 invoked from network); 20 Jan 1998 04:55:19 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 20 Jan 1998 04:55:19 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id XAA10613;
	Mon, 19 Jan 1998 23:32:31 -0500 (EST)
Resent-Date: Mon, 19 Jan 1998 23:32:02 -0500 (EST)
To: zsh-users@math.gatech.edu
Sender: monnier@TEQUILA.SYSTEMSZ.CS.YALE.EDU
From: Stefan Monnier <monnier+lists/zsh/users/news/@TEQUILA.SYSTEMSZ.CS.YALE.EDU>
Newsgroups: lists.zsh.users
Subject: completion for (u)mount
Date: 19 Jan 1998 23:33:29 -0500
Message-ID: <5l3eij69ye.fsf@tequila.systemsz.cs.yale.edu>
Lines: 28
X-Newsreader: Gnus v5.5/Emacs 20.2
Path: tequila.systemsz.cs.yale.edu
NNTP-Posting-Host: tequila.systemsz.cs.yale.edu
Resent-Message-ID: <"lEnF92.0.Jb2.1Z2nq"@math>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/1238
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu


I just hacked up comletion for mount and umount on Linux. I figured some
completion fanatics might like it.


	Stefan

comp_fsmount () {
    local tmp; if [[ $UID = 0 ]]; then tmp=""; else tmp="user"; fi
    sed -n -e "s|^[^# 	][^ 	]*[ 	][ 	]*\(/[^ 	]*\)[
].*$tmp.*|\1|p" /etc/fstab	# beware the tabs
}
comp_nfsmount () {
    local cmd args host
    read -Ac cmd; read -cn where
    host=${${cmd[$where]}%%:*}
    reply=("${(@f)$(showmount -e $host | sed -n -e "s|^/\([^ ]*\) .*|$host:/\1|p")}")
}
compctl -s '$(mount | \
	      sed -e "s/^[^ ]* on \\([^ ]*\\) type.*/\\1/"'"$(
	      if [[ ! $UID = 0 ]]; then
		  echo ' | egrep "^${(j:|:)$(comp_fsmount)}\$"'
	      fi)"')' umount
compctl -s '$(comp_fsmount)' + \
	-x 'S[/]' -f -- + \
	-x 'C[0,*:*]' -K comp_nfsmount -- + \
	-s '$(< /etc/hosts)' \
	mount

