From zsh-users-return-2913-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Feb 11 17:56:34 2000
Return-Path: <zsh-users-return-2913-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15044 invoked from network); 11 Feb 2000 17:56:33 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 11 Feb 2000 17:56:33 -0000
Received: (qmail 2108 invoked by alias); 11 Feb 2000 17:56:14 -0000
Mailing-List: contact zsh-users-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.auc.dk
X-Seq: 2913
Received: (qmail 2097 invoked from network); 11 Feb 2000 17:56:12 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1000211175555.ZM32309@candle.brasslantern.com>
Date: Fri, 11 Feb 2000 17:55:55 +0000
In-Reply-To: <20000210195143.A26109@br-online.de>
Comments: In reply to Andy Spiegl <zsh.Andy@spiegl.de>
        "Re: completion but extra options allowed" (Feb 10,  7:51pm)
References: <20000210153411.A27005@fruitcom.com> 
	<1000210175857.ZM6927@candle.brasslantern.com> 
	<20000210195143.A26109@br-online.de>
X-Mailer: Z-Mail (5.0.0 30July97)
To: Andy Spiegl <zsh.Andy@spiegl.de>, zsh-users@sunsite.auc.dk
Subject: Re: completion but extra options allowed
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Feb 10,  7:51pm, Andy Spiegl wrote:
} Subject: Re: completion but extra options allowed
}
} Hi Bart,
} 
} > This means that you type "mutt -f +<TAB>" and zsh will complete files in
} > your $HOME/Mail directory following the + sign.  Mutt understands the + as
} > an abbreviation for the mail directory.  In the absence of a +, zsh just
} > completes file names after "mutt -f".
} This is exactly what I am trying to teach zsh-3.1.6.pws16 to do.

Yes, I noticed just after posting that this isn't actually handled by
_mutt and _mailboxes.  In attempting to do something with this, I found
some rather strange things going on in the guts of the completion.

_mutt calls _arguments in the expected way.

_arguments calls "_description arguments expl mailbox" which sets expl
to (-J -default-).

_arguments then calls "_mailboxes -J -default-" which (after setting up
the cache) calls "_wanted files expl 'mailbox specification'" which again
sets expl to (-J -default-).

_mailboxes then calls "compadd -J -default- -J -default- - ..." which
seems a bit odd.  The first -J -default- is from "$@" and the second is
of course "$expl[@]".  Is that really doing the right thing?

} And it doesn't expand local filenames either:
} eule:~>cd Mail
} eule:~/Mail>mutt -f a<TAB>

I think that's intentional on the grounds that files not in the mail
directory are not likely to be mail files.  It should probably be set
by a style, if the 'mailbox' style won't already work.

} BTW, _mailboxes expects the "mailboxes" definition to be in ~/.muttrc.  I
} had to change it, because I've got it in ~/.mutt/local, which is sourced
} from ~/.muttrc.  The same goes for the aliases. :-(

You don't need to edit _mailboxes, you just need

	set muttrc=~/.mutt/local

somewhere in your startup files.  You can do the same for pinedirectory
and maildirectory if they aren't ~/mail and ~/Mail (respectively).

Oh, wait -- _mutt is itself stomping $muttrc.  That's wrong;  I can at
least fix that part:

Index: Completion/User/_mutt
===================================================================
@@ -1,6 +1,6 @@
 #compdef mutt
 
-local curcontext="$curcontext" state line muttrc="~/.muttrc" ret=1
+local curcontext="$curcontext" state line ret=1
 
  _arguments -C \
  '::recipient:->userhost' \


-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

