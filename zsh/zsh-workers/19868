From zsh-workers-return-19868-mason-zsh=primenet.com.au@sunsite.dk Mon May 03 00:28:18 2004
Return-Path: <zsh-workers-return-19868-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7400 invoked from network); 3 May 2004 00:28:16 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (qmailr@130.225.247.86)
  by ns1.primenet.com.au with SMTP; 3 May 2004 00:28:16 -0000
Received: (qmail 27330 invoked from network); 3 May 2004 00:28:08 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 3 May 2004 00:28:08 -0000
Received: (qmail 3510 invoked by alias); 3 May 2004 00:27:56 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19868
Received: (qmail 3500 invoked from network); 3 May 2004 00:27:55 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (qmailr@130.225.247.86)
  by sunsite.dk with SMTP; 3 May 2004 00:27:52 -0000
Received: (qmail 26843 invoked from network); 3 May 2004 00:27:52 -0000
Received: from acolyte.scowler.net (216.254.112.45)
  by a.mx.sunsite.dk with SMTP; 3 May 2004 00:27:50 -0000
Received: by acolyte.scowler.net (Postfix, from userid 1000)
	id C127C70047; Sun,  2 May 2004 20:27:22 -0400 (EDT)
Date: Sun, 2 May 2004 20:27:22 -0400
From: Clint Adams <schizo@debian.org>
To: 245974-forwarded@bugs.debian.org
Cc: zsh-workers@sunsite.dk, Christian Anthon <anthon@kohn.kiku.dk>
Subject: Re: Bug#245974: zsh: export LC_ALL=da_DK causes segfault
Message-ID: <20040503002722.GA15956@scowler.net>
References: <20040426144112.87B951C02C@kohn.kiku.dk> <20040426154922.GA8375@scowler.net> <20040426201800.GA2029@kohn.kiku.dk> <20040426224229.GA12757@scowler.net> <20040427092356.GA4780@kohn.kiku.dk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20040427092356.GA4780@kohn.kiku.dk>
User-Agent: Mutt/1.5.5.1+cvs20040105i
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-0.0 required=6.0 tests=BAYES_44 autolearn=no 
	version=2.63
X-Spam-Hits: -0.0

> > Okay, if you use a different prompt (walters, for example), it won't
> > segfault.  Correct?
> 
> Yep.
> #0  0x080a5cdf in ztrftime ()
> #1  0x08098fc4 in promptexpand ()
> #2  0x08098330 in promptexpand ()
> #3  0x402e5b8f in zleread () from /usr/lib/zsh/4.2.0/zsh/zle.so

Seems that when LC_TIME (or LC_ALL or LANG) is set to a locale such as
da_DK or de_DE, wherein am_pm is set to null strings, zsh will segfault
upon prompt-expanding %p or %P.  Seems that the first argument to
ztrftime() is often either NULL or 0x51, though I can't figure out why.

