From zsh-workers-return-19878-mason-zsh=primenet.com.au@sunsite.dk Wed May 05 04:44:26 2004
Return-Path: <zsh-workers-return-19878-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4678 invoked from network); 5 May 2004 04:44:26 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (qmailr@130.225.247.86)
  by ns1.primenet.com.au with SMTP; 5 May 2004 04:44:26 -0000
Received: (qmail 26260 invoked from network); 5 May 2004 04:44:06 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 May 2004 04:44:06 -0000
Received: (qmail 23421 invoked by alias); 5 May 2004 04:44:01 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19878
Received: (qmail 23409 invoked from network); 5 May 2004 04:44:00 -0000
Received: from thor.dotsrc.org (HELO a.mx.sunsite.dk) (qmailr@130.225.247.86)
  by sunsite.dk with SMTP; 5 May 2004 04:43:57 -0000
Received: (qmail 25883 invoked from network); 5 May 2004 04:43:57 -0000
Received: from dsl3-63-249-88-2.cruzio.com (HELO binome.blorf.net) (63.249.88.2)
  by a.mx.sunsite.dk with SMTP; 5 May 2004 04:43:54 -0000
Received: by binome.blorf.net (Postfix, from userid 1000)
	id 4183A42C; Tue,  4 May 2004 21:43:51 -0700 (PDT)
Date: Tue, 4 May 2004 21:43:51 -0700
From: Wayne Davison <wayned@users.sourceforge.net>
To: Peter Stephenson <pws@csr.com>
Cc: zsh-workers@sunsite.dk
Subject: Re: Bug#245974: zsh: export LC_ALL=da_DK causes segfault
Message-ID: <20040505044351.GA12339@blorf.net>
References: <20040504150619.GA28923@scowler.net> <7357.1083684655@csr.com>
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="PEIAKu/WMn1b1Hv9"
Content-Disposition: inline
In-Reply-To: <7357.1083684655@csr.com>
User-Agent: Mutt/1.5.5.1+cvs20040105i
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0


--PEIAKu/WMn1b1Hv9
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Looks to me like you failed to set the first character in buf to a
non-zero value.  Here's a patch.

..wayne..

--PEIAKu/WMn1b1Hv9
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="strftime.patch"

--- Src/utils.c	4 May 2004 16:43:43 -0000	1.60
+++ Src/utils.c	5 May 2004 04:41:31 -0000
@@ -1834,7 +1834,7 @@ ztrftime(char *buf, int bufsize, char *f
 		 * Remember we've already allowed for two characters
 		 * in the accounting in bufsize (but nowhere else).
 		 */
-		*buf = '\0';
+		*buf = '\1';
 		tmp[1] = fmt[-1];
 		if (!strftime(buf, bufsize + 2, tmp, tm))
 		{

--PEIAKu/WMn1b1Hv9--

