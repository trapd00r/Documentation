From zsh-workers-return-16685-mason-zsh=primenet.com.au@sunsite.dk Thu Feb 21 12:54:48 2002
Return-Path: <zsh-workers-return-16685-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29210 invoked from network); 21 Feb 2002 12:54:47 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 21 Feb 2002 12:54:47 -0000
Received: (qmail 10321 invoked by alias); 21 Feb 2002 12:54:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 16685
Received: (qmail 10308 invoked from network); 21 Feb 2002 12:54:38 -0000
Message-ID: <20020221125435.59439.qmail@web9303.mail.yahoo.com>
Date: Thu, 21 Feb 2002 12:54:35 +0000 (GMT)
From: =?iso-8859-1?q?Oliver=20Kiddle?= <okiddle@yahoo.co.uk>
Subject: Re: Completion for pine is broken
To: Bart Schaefer <schaefer@brasslantern.com>, zsh-workers@sunsite.dk
In-Reply-To: <1020216184449.ZM25378@candle.brasslantern.com>
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="0-1399917465-1014296075=:58201"
Content-Transfer-Encoding: 8bit

--0-1399917465-1014296075=:58201
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
Content-Disposition: inline

 --- Bart Schaefer <schaefer@brasslantern.com> wrote:
> This dates from long, long ago, possibly from the introduction of
> _pine.
> (As you can guess, I hardly ever start pine from the shell; it's
> always
> running in its own xterm and I just open new folders from the pine
> menus).

I wouldn't have guessed you'd be running pine at all instead of Z-mail.

> There's this snippet in _pine:
> 
> if [[ -n $+_cache_pine_options ]]; then
>   for optfile in ~/.pinerc /etc/pine.conf; do
>     if [[ -f $optfile ]]; then
>       getopts="cat $optfile"
>       break
>     fi
>   done
>   _cache_pine_options=( $($=getopts | sed -n 's/^\([^#]*=\).*/-\1/p')
> )
> fi
> 
> 
> And then there's my .pinerc, which has this fragment:
> 
> folder-collections=Mail mail/[],
>         "Archives on zanshin.com" {zanshin.com}/archive/[%],
>         Home [],
>         "Home on zanshin.com" {zanshin.com/debug}/home/schaefer/[]
> 
> 
> The double quotes in those folder-collection names wreak havok.  In
> general,
> any word in a .pinerc can be a quoted string.  I really don't follow
> what
> that code in _pine is supposed to be doing, but whatever it is is
> broken.

Every configuration item in pine can be used on the command line like a
normal option. That code was there to try to pick up a .pinerc file to
get a list of all the configuration options. What I can't remember is
why I got it to try .pinerc files before running pine -conf. It might
have been because it was faster or it might have been because running
pine -conf omits some options. Whatever it was, I doubt it was
particularly critical. I don't use pine so only ever tested it with a
default pine configuration. Can you try the attached (to avoid
word-wrap) patch and let me know if it works. It just uses pine -conf
which I hope doesn't risk problems with quoted values messing up the
sed expression.

As an aside, _pine could perhaps use two calls to _arguments so that
you can select between the two sets of options with a tag-order.

Oliver

__________________________________________________
Do You Yahoo!?
Everything you'll ever need on one web page
from News and Sport to Email and Music Charts
http://uk.my.yahoo.com
--0-1399917465-1014296075=:58201
Content-Type: text/plain; name="pine.txt"
Content-Description: pine.txt
Content-Disposition: inline; filename="pine.txt"

--- Completion/Unix/Command/_pine	Thu Jan 17 10:24:39 2002
+++ Completion/Unix/Command/_pine	Thu Feb 21 12:26:30 2002
@@ -1,16 +1,10 @@
 #compdef pine pinef
 
 local curcontext="$curcontext" state line expl suf
-local optfile getopts='pine -conf' sortorder lusortorder opts send idx
+local sortorder lusortorder opts send idx
 
 if [[ -n $+_cache_pine_options ]]; then
-  for optfile in ~/.pinerc /etc/pine.conf; do
-    if [[ -f $optfile ]]; then
-      getopts="cat $optfile"
-      break
-    fi
-  done
-  _cache_pine_options=( $($=getopts | sed -n 's/^\([^#]*=\).*/-\1/p') )
+  _cache_pine_options=( $(_call_program pine-options pine -conf| sed -n 's/^\([^#]*=\).*/-\1/p') )
 fi
 
 sortorder=( {subject,arrival,date,from,size}{,/reverse} )

--0-1399917465-1014296075=:58201--

