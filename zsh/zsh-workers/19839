From zsh-workers-return-19839-mason-zsh=primenet.com.au@sunsite.dk Tue Apr 27 15:03:31 2004
Return-Path: <zsh-workers-return-19839-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 799 invoked from network); 27 Apr 2004 15:03:30 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 27 Apr 2004 15:03:30 -0000
Received: (qmail 13254 invoked by alias); 27 Apr 2004 15:03:14 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19839
Received: (qmail 13244 invoked from network); 27 Apr 2004 15:03:14 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 27 Apr 2004 15:03:14 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [130.225.247.86] by sunsite.dk (MessageWall 1.0.8) with SMTP; 27 Apr 2004 15:3:11 -0000
Received: (qmail 13415 invoked from network); 27 Apr 2004 15:03:11 -0000
Received: from lhuumrelay3.lnd.ops.eu.uu.net (62.189.58.19)
  by a.mx.sunsite.dk with SMTP; 27 Apr 2004 15:03:09 -0000
Received: from MAILSWEEPER01.csr.com (mailhost1.csr.com [62.189.183.235])
	by lhuumrelay3.lnd.ops.eu.uu.net (8.11.0/8.11.0) with ESMTP id i3RF2hv28471
	for <zsh-workers@sunsite.dk>; Tue, 27 Apr 2004 15:02:43 GMT
Received: from EXCHANGE02.csr.com (unverified [192.168.137.45]) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.12) with ESMTP id <T69391c7f19c0a88d016a8@MAILSWEEPER01.csr.com> for <zsh-workers@sunsite.dk>;
 Tue, 27 Apr 2004 16:02:14 +0100
Received: from csr.com ([192.168.144.127]) by EXCHANGE02.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Tue, 27 Apr 2004 16:03:41 +0100
To: zsh-workers@sunsite.dk
Subject: Re: The file-sort style is broken 
In-reply-to: "Bart Schaefer"'s message of "Tue, 27 Apr 2004 07:39:00 PDT."
             <Pine.LNX.4.44.0404270718520.10119-100000@aztec.zanshin.com> 
Date: Tue, 27 Apr 2004 16:02:42 +0100
Message-ID: <29745.1083078162@csr.com>
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 27 Apr 2004 15:03:41.0488 (UTC) FILETIME=[D3CD3B00:01C42C68]
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=BAYES_50 autolearn=no 
	version=2.63
X-Spam-Hits: 0.0

Bart Schaefer wrote:
> schaefer[512] echo $^fpath/_zip(N)
> /usr/share/zsh/4.2.0/functions/_zip
> schaefer[513] unzip -<TAB>
> No matches for `zip file'
> 
> (Huh?  Why is it trying to complete a zip file after a hyphen, rather
> than completing options?)

Do you have a matcher style set which assumes `-' is an anchor
character?

> Here's a snippet from the _complete_debug output:
> 
> : _path_files:126:then else for elif-then; tmp2=( '(#i)*.(zip|[ejw]ar)(om#q-.
> )' )
> 
> See where the "om" has been inserted?  Bad, very bad.

How about the following?

Index: Completion/Unix/Type/_path_files
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Type/_path_files,v
retrieving revision 1.23
diff -u -r1.23 _path_files
--- Completion/Unix/Type/_path_files	8 May 2003 10:30:49 -0000	1.23
+++ Completion/Unix/Type/_path_files	27 Apr 2004 15:00:34 -0000
@@ -120,7 +120,9 @@
 
     tmp2=()
     for tmp1 in "$pats[@]"; do
-      if [[ "$tmp1" = (#b)(*[^\$])(\(\([^\|~]##\)\)) ]]; then
+      if [[ "$tmp1" = (#b)(*[^\$])"(#q"(*)")" ]]; then
+	tmp2=( "$tmp2[@]" "${match[1]}(#q${sort}${match[2]})" )
+      elif [[ "$tmp1" = (#b)(*[^\$])(\(\([^\|~]##\)\)) ]]; then
         tmp2=( "$tmp2[@]" "${match[1]}((${sort}${match[2][3,-1]}" )
       elif [[ "$tmp1" = (#b)(*[^\$])(\([^\|~]##\)) ]]; then
         tmp2=( "$tmp2[@]" "${match[1]}(${sort}${match[2][2,-1]}" )

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR Ltd., Science Park, Milton Road,
Cambridge, CB4 0WH, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

This footnote also confirms that this email message has been swept by
MIMEsweeper for the presence of computer viruses.

www.mimesweeper.com
**********************************************************************

