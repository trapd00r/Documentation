From zsh-workers-request@math.gatech.edu Wed Aug 05 18:47:28 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20105 invoked from network); 5 Aug 1998 18:47:27 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 5 Aug 1998 18:47:27 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id OAA01059;
	Wed, 5 Aug 1998 14:35:03 -0400 (EDT)
Resent-Date: Wed, 5 Aug 1998 14:35:03 -0400 (EDT)
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <980805113711.ZM1055@candle.brasslantern.com>
Date: Wed, 5 Aug 1998 11:37:10 -0700
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: zsh-workers@math.gatech.edu
Subject: PATCH: 3.1.4: Off-by-an-order-of-magnitude in negated digit arguments
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"o7fyw2.0.RG.MNAor"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4268
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

I only noticed this because of my earlier patch to pass the digit argument
as the first parameter to user-defined widgets.

Try using ESC - ESC 5 C-f in the line editor.  You'll find that it moves
backwards 15 spaces, not 5 spaces.  ESC - ESC 5 ESC 4 C-f moves backwards
154 spaces, ESC - ESC 5 ESC 4 ESC 3 backs up 1543 spaces, etc.

The problem is that negargument() should NOT set the MOD_TMULT flag.  I've
scanned the other uses of MOD_TMULT and I don't think the following patch
has any bad side-effects.  

Index: Src/Zle/zle_misc.c
===================================================================
*** zle_misc.c	1998/06/01 17:08:46	1.1.1.1
--- zle_misc.c	1998/08/05 18:30:20
***************
*** 456,462 ****
  	return;
      }
      zmod.tmult = -1;
-     zmod.flags |= MOD_TMULT;
      prefixflag = 1;
  }
  
--- 456,461 ----

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

