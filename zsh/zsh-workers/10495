From zsh-workers-return-10495-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Apr 05 08:04:38 2000
Return-Path: <zsh-workers-return-10495-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18789 invoked from network); 5 Apr 2000 08:04:36 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 5 Apr 2000 08:04:36 -0000
Received: (qmail 12609 invoked by alias); 5 Apr 2000 08:04:22 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10495
Received: (qmail 12599 invoked from network); 5 Apr 2000 08:04:21 -0000
Date: Wed, 5 Apr 2000 10:03:58 +0200 (MET DST)
Message-Id: <200004050803.KAA01586@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Bart Schaefer"'s message of Wed, 5 Apr 2000 05:09:08 +0000
Subject: Re: FPATH/autoload still strange in -dev-21


Bart Schaefer wrote:

> I just got -dev-21 + patches to 10477 compiled and installed, and I'm still
> having the strange problems with exported FPATH and (autoload -U) failing
> that I described in 10316.  I examined strace output and discovered that
> in the expression:
> 
> 	if (autoload -U 2> /dev/null); then
> 
> First zsh forks the subshell, and then the subshell forks again, apparently
> in order to redirect the output of the builtin; but then the subshell exits
> for some reason I can't follow, leaving the autoload running as an orphan.
> So zsh never sees the exit status of autoload.  (The process forked from
> the subshell is plugging away close()ing each of 256 file descriptors, 
> except for 0, 1, and 2, most of which are returning EBADF, while its parent
> subshell is exiting.)

The subshell shouldn't fork, of course. That needs only be done when
we are in a pipe, not for ordinary redirection...

> ...
> 
> It occurs to me that this could be related to Geoff's report of the "jobs"
> command claiming there is a nonexistent job 3. 

Interestingly, I had the same idea before coming to this paragraph.

> Why having FPATH in the
> environment makes ths happen, I have no idea, but I can reproduce it quite
> nicely, so if anyone (Sven?) wants the sample strace output I'd be happy
> to provide it.

Yes, please.

Bye
 Sven


--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

