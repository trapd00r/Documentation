From zsh-users-return-8479-mason-zsh=primenet.com.au@sunsite.dk Thu Feb 10 16:54:39 2005
Return-Path: <zsh-users-return-8479-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17626 invoked from network); 10 Feb 2005 16:54:38 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 10 Feb 2005 16:54:38 -0000
Received: (qmail 11222 invoked from network); 10 Feb 2005 16:54:31 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 Feb 2005 16:54:31 -0000
Received: (qmail 11056 invoked by alias); 10 Feb 2005 16:54:24 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8479
Received: (qmail 11042 invoked from network); 10 Feb 2005 16:54:24 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 10 Feb 2005 16:54:24 -0000
Received: (qmail 10318 invoked from network); 10 Feb 2005 16:54:24 -0000
Received: from vinc17.net4.nerim.net (HELO ay.vinc17.org) (62.212.121.106)
  by a.mx.sunsite.dk with SMTP; 10 Feb 2005 16:54:18 -0000
Received: from lefevre by ay.vinc17.org with local (Exim 4.34)
	id 1CzHa5-0003XF-Ix; Thu, 10 Feb 2005 17:54:17 +0100
Date: Thu, 10 Feb 2005 17:54:17 +0100
From: Vincent Lefevre <vincent@vinc17.org>
To: zsh-users@sunsite.dk
Subject: History corruption (over NFS)
Message-ID: <20050210165417.GG30487@ay.vinc17.org>
Mail-Followup-To: zsh-users@sunsite.dk
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
X-Mailer-Info: http://www.vinc17.org/mutt/
User-Agent: Mutt/1.5.7i
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-1.5 required=6.0 tests=AWL,BAYES_00,LONGWORDS 
	autolearn=no version=3.0.2
X-Spam-Hits: -1.5

I've noticed history corruption (several times) when using screen,
with the following .screenrc file: the end of the .zhistory file
gets many null characters. I thought that zsh was using a lock
mechanism.

sessionname test32
shell -zsh
chdir /users/spaces/vlefevre/oldtests
sorendition 4 06
autodetach on
defscrollback 6000
escape ^za
hardstatus off
hardstatus string "%h%n (%t)"
termcapinfo xterm*|rxvt hs:ts=\E]2;:fs=^G:ds=\E]2;TITLEDISABLED^G
bind r screen telnet ulysse 4913
screen -h 6000 -t server  1 zsh -c "./t3-server -v results.stp.-2.54 2> server.out"
screen -h 6000 -t secstep 2 nice -2 zsh -c "./t3-secstep -r=results.stp.-2.54 --remove -l=20 2>&1 2> secstep.out"

Some additional information:

ulysse:~/tmd/oldtests> echo $ZSH_VERSION
4.2.0
ulysse:~/tmd/oldtests> setopt|grep hist
extendedhistory
histignoredups
histignorespace
histnofunctions
histnostore
histreduceblanks
incappendhistory
ulysse:~/tmd/oldtests> unsetopt|grep hist
noappendhistory
nobanghist
cshjunkiehistory
histallowclobber
nohistbeep
histexpiredupsfirst
histfindnodups
histignorealldups
histsavenodups
histverify
sharehistory
ulysse:~/tmd/oldtests> echo $HISTFILE
/users/spaces/vlefevre/.zhistory
ulysse:~/tmd/oldtests> echo $HISTSIZE
8000
ulysse:~/tmd/oldtests> mount|grep /users/spaces
waly:/vol/users/spaces on /users/spaces type nfs (rw,nfsvers=3,rsize=32768,wsize=32768,proto=tcp,addr=152.81.1.27)

-- 
Vincent Lefèvre <vincent@vinc17.org> - Web: <http://www.vinc17.org/>
100% accessible validated (X)HTML - Blog: <http://www.vinc17.org/blog/>
Work: CR INRIA - computer arithmetic / SPACES project at LORIA

