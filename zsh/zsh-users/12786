From zsh-users-return-12786-mason-zsh=primenet.com.au@sunsite.dk Tue Apr 15 09:52:33 2008
Return-Path: <zsh-users-return-12786-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26033 invoked from network); 15 Apr 2008 09:52:30 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.3 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 15 Apr 2008 09:52:30 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 97705 invoked from network); 15 Apr 2008 09:52:11 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 15 Apr 2008 09:52:11 -0000
Received: (qmail 9917 invoked by alias); 15 Apr 2008 09:52:02 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12786
Received: (qmail 9887 invoked from network); 15 Apr 2008 09:52:01 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 15 Apr 2008 09:52:01 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [85.115.41.190])
	by bifrost.dotsrc.org (Postfix) with ESMTP id BDB92808A379
	for <zsh-users@sunsite.dk>; Tue, 15 Apr 2008 11:51:57 +0200 (CEST)
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly03g.srv.mailcontrol.com (MailControl) with ESMTP id m3F9pQxQ026716
	for <zsh-users@sunsite.dk>; Tue, 15 Apr 2008 10:51:44 +0100
Received: from news01 ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Tue, 15 Apr 2008 10:51:14 +0100
Date: Tue, 15 Apr 2008 10:51:14 +0100
From: Peter Stephenson <pws@csr.com>
To: zsh-users@sunsite.dk
Subject: Re: iterating through a hierarchy with a filter
Message-ID: <20080415105114.36cbc35c@news01>
In-Reply-To: <20080414233353.GW1223@prunille.vinc17.org>
References: <8BAD0AA6-3B6F-4946-B636-6C16B56A944E@gmail.com>
	<200804100851.m3A8pk9S003521@news01.csr.com>
	<DDABD6BC-F3D9-4277-86C1-776B24CB914F@gmail.com>
	<20080410105245.GB11585@imada.sdu.dk>
	<20080410114214.GB5179@sc.homeunix.net>
	<4531F8C0-94EB-4803-A31F-3B961164C885@gmail.com>
	<20080414233353.GW1223@prunille.vinc17.org>
Organization: CSR
X-Mailer: Claws Mail 3.3.1 (GTK+ 2.12.5; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 15 Apr 2008 09:51:14.0698 (UTC) FILETIME=[3E67D6A0:01C89EDE]
X-Scanned-By: MailControl A-08-00-05 (www.mailcontrol.com) on 10.71.0.113
X-Virus-Scanned: ClamAV 0.91.2/6778/Tue Apr 15 10:54:28 2008 on bifrost
X-Virus-Status: Clean

On Tue, 15 Apr 2008 01:33:53 +0200
Vincent Lefevre <vincent@vinc17.org> wrote:
> On 2008-04-14 14:39:25 -0700, Alexy Khrabrov wrote:
> > If I give a single existing script as a parameter, it works fine.  If,  
> > however, I give it
> >
> > walk 'iconv -f utf8 -t cp1251' srcdir tgtdir ...
> >
> > -- I get "command not found" for 'iconv -f utf8 -t cp1251' at the line  
> > above.
> 
> You need to do sh word-splitting on $1 and make $filter an array:
> 
> filter=(${=1})
> 
> Alternatively, you can enable sh word-splitting globally.

That should work fine in this case.

More generally, I would be inclined to take the attitude that the argument
to your script is a complete command line in itself.  In that case, the
logical thing to do is to "eval" the variable that contains it.  That means
that you can put anything there you would in a normal zsh command line.  If
you want the command to be executed "at arm's length", put the eval inside
parentheses:

(eval $1) <input >output

I have a vague memory that the shell is smart enough only to fork once
if there's a single external command in the eval, but the mists of time may
be confusing me.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

