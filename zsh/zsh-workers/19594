From zsh-workers-return-19594-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 10 16:21:16 2004
Return-Path: <zsh-workers-return-19594-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27969 invoked from network); 10 Mar 2004 16:21:15 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 10 Mar 2004 16:21:15 -0000
Received: (qmail 22372 invoked by alias); 10 Mar 2004 16:21:05 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19594
Received: (qmail 22360 invoked from network); 10 Mar 2004 16:21:05 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 10 Mar 2004 16:21:05 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [62.189.58.19] by sunsite.dk (MessageWall 1.0.8) with SMTP; 10 Mar 2004 16:21:4 -0000
Received: from MAILSWEEPER01.csr.com (mailhost1.csr.com [62.189.183.235])
	by lhuumrelay3.lnd.ops.eu.uu.net (8.11.0/8.11.0) with ESMTP id i2AGL3v09776
	for <zsh-workers@sunsite.dk>; Wed, 10 Mar 2004 16:21:03 GMT
Received: from EXCHANGE02.csr.com (unverified [192.168.137.45]) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.12) with ESMTP id <T6841fc2797c0a88d01540@MAILSWEEPER01.csr.com> for <zsh-workers@sunsite.dk>;
 Wed, 10 Mar 2004 16:20:43 +0000
Received: from csr.com ([192.168.144.127]) by EXCHANGE02.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Wed, 10 Mar 2004 16:23:00 +0000
To: Zsh hackers list <zsh-workers@sunsite.dk>
Subject: Re: 4.2.0-pre-3; HP-UX 
In-reply-to: "Oliver Kiddle"'s message of "Wed, 10 Mar 2004 17:05:15 +0100."
             <3175.1078934715@trentino.logica.co.uk> 
Date: Wed, 10 Mar 2004 16:21:02 +0000
Message-ID: <6316.1078935662@csr.com>
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 10 Mar 2004 16:23:00.0194 (UTC) FILETIME=[F4622420:01C406BB]

Oliver Kiddle wrote:
> I think they expire your account if you don't use it for a while. My old
> one from when it was still Compaq has gone. Anyway, I signed up again.

Excellent.

> It builds okay but can't load all the modules - some such as zle and
> files load, others like complete and math won't.

But they compile OK?  Error messages?  Might simply be missing library
functions.

> There are also plenty of warnings:
> 
> Warning 942: "module.c", line 429 # Types 'void *' and 'int' are not
>     assignment-compatible.
>             ret = dlopen(unmeta(buf), RTLD_LAZY | RTLD_GLOBAL);
>             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Looks like a missing header.

> 
> Warning 361: "init.c", line 1204 # Value-returning function might end without
>     executing a return statement.
>     zsh_main(int argc, char **argv)
>     ^^^^^^^^

Ignorable.

> A few of these:
> Warning 1042: "jobs.c", line 421 # Subscript out of range.
>         if (sigtrapped[SIGCHLD] && job != thisjob)
>                        ^^^^^^^
> That also occurs for SIGWINCH, SIGPIPE and SIGALRM.

Suggests the awk script for signals screwed up.

> Then there are many many warnings like this:
> 
> This warning comes up a lot for many times in different places:
> Warning 952: "compctl.c", line 608 # Conversion of 'const char *' to 'char *'
>     loses 'const'.
>                         *argv = "" - 1;
>                         ^^^^^^
> 
> What is that code trying to do? Isn't that taking the address of a
> constant string. Seems dodgy to me.

Harmless.  We're not strict about `const'.  It would be nice to be,
but when you start going down that road you find you have to change
*everything*.  It's a hack so that argv[1] contains a NULL --- not a
particularly nice one.

> Then, this warning:
> Warning 942: "zle_refresh.c", line 527 # Types 'unsigned char *' and 'char *'
>     are not assignment-compatible.
>             s = nbuf[tosln - 1];
>             ^^^^^^^^^^^^^^
> And, the same for zle_refresh.c:536,542,551 and zle_thingy.c:656

This is mostly fixed up by using STOUC where necessary, but more
consistency of pointers would be better.

> I also tried compiling on the Tru64 5.1 machine. It warns about many
> unresolved things after linking each shared library. These look like the
> things which will be resolved when they are loaded at runtime. We could
> turn off the warnings with the option `-expect_unresolved *'
> 
> It stops at an error though:
> 
> cc -c -I.  -DHAVE_CONFIG_H -DMODULE -O  -o terminfo..o terminfo.c
> cc: Error: /usr/include/curses.h, line 125: In this declaration, "DO" has no 
> linkage and has a prior declaration in this scope at line number 212 in file 
> ../../Src/zsh.h. (nolinkage)
>                 *DM, *DO, *ED, *EI, *K0, *K1, *K2, *K3, *K4, *K5, *K6,
> ---------------------^

It's probably defined somewhere else.  We could rename those arguments.

> I don't have so much time at the moment either but if we're not in a
> rush for 4.2, we should be able to get zsh working on the different
> operating systems. Would it perhaps be worth putting out a 4.1.2 now to
> get the code a bit more testing and allow it to get into Linux
> distributions?

Frankly, I'm hanged if I personally am going to go round changing all
the version numbers again, but I don't mind releasing 4.2.0 and warning
users of HP-UX and AIX they may want to wait.  Nobody expects versions
ending in `0' to work anyway.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR Ltd., Science Park, Milton Road,
Cambridge, CB4 0WH, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

This footnote also confirms that this email message has been swept by
MIMEsweeper for the presence of computer viruses.

www.mimesweeper.com
**********************************************************************

