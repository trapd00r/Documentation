From zsh-users-return-8079-mason-zsh=primenet.com.au@sunsite.dk Tue Oct 19 19:12:31 2004
Return-Path: <zsh-users-return-8079-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20010 invoked from network); 19 Oct 2004 19:12:30 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 19 Oct 2004 19:12:30 -0000
Received: (qmail 40411 invoked from network); 19 Oct 2004 19:12:24 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 19 Oct 2004 19:12:24 -0000
Received: (qmail 14952 invoked by alias); 19 Oct 2004 19:11:37 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 8079
Received: (qmail 14926 invoked from network); 19 Oct 2004 19:11:35 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 19 Oct 2004 19:11:35 -0000
Received: (qmail 37780 invoked from network); 19 Oct 2004 19:10:36 -0000
Received: from posti5.jyu.fi (130.234.4.34)
  by a.mx.sunsite.dk with SMTP; 19 Oct 2004 19:10:35 -0000
Received: from heresy.ainola.jyu.fi (heresy.ainola.jyu.fi [130.234.191.114])
	by posti5.jyu.fi (8.12.8/8.12.8/antispam) with ESMTP id i9JJADRF031243;
	Tue, 19 Oct 2004 22:10:14 +0300
Received: by heresy.ainola.jyu.fi (Postfix, from userid 1000)
	id E0F7F63; Tue, 19 Oct 2004 22:10:37 +0300 (EEST)
To: zsh-users mailing list <zsh-users@sunsite.dk>, 231851@bugs.debian.org,
   bostic@bostic.com, skimo@kotnet.org
Subject: Even more about my nvi/zsh-bug
From: Juhapekka Tolvanen <juhtolv@cc.jyu.fi>
Organization: What?+ Me organized?+ Never!1
X-User-Agent-URL: http://www.gnus.org/
Reply-To: juhtolv@iki.fi
Date: Tue, 19 Oct 2004 22:10:37 +0300
Message-ID: <87k6tmcymq.fsf@heresy.ainola.jyu.fi>
User-Agent: Gnus/5.1006 (Gnus v5.10.6) Emacs/21.3 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
X-Virus-Scanned: by amavisd-milter (http://www.amavis.org/)
	at posti5.jyu.fi; Tue, 19 Oct 2004 22:10:15 +0300
X-Spam-Checked: by miltrassassin
	at posti5.jyu.fi; Tue, 19 Oct 2004 22:10:15 +0300
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0



I am talking about this bug. If nvi is started under screen, it says
this:

/home/juhtolv/.nexrc, 9: Shell expansion failed
/home/juhtolv/.nexrc, 9: Ex command failed: pending commands discarded
Press Enter to continue: 

Here is that line number 9 and comments for it:

" If ~/.nexrc exists, ~/.exrc is not read. So it must be sourced here:
so ~/.exrc

Under screen, this works fine:

SHELL=/bin/sh nvi

But plain nvi command makes that bug appear. But this is strange: I can
use any shell in that environment variable SHELL and nvi still works
fine. Even /bin/zsh is good for it. But look at this:

% echo $SHELL
zsh

As you can see, it says just "zsh", not "bin/zsh". Both these commands
make bug appear:

SHELL=sh nvi
SHELL=zsh nvi

Now, let's see some relevant parts from my ~/.screenrc :

shell -zsh

That means that whenever I hit "Ctrl-a c", it starts zsh and as
login-shell. But as you can see, path is not there, just zsh. And then:

#####################
# Automatic stuff:
#

screen -M -t ROOT 1 su -c 'zsh -l'
screen -M -t ROOT 2 su -c 'zsh -l'

# NICE HACK: Do not start those heavy zsh-shells immediately.
screen    -t zsh   3 ash -c 'fortune 100% debian-hints ; sleep 120 ; exec zsh -l'
screen    -t zsh   4 ash -c 'fortune 100% go ; sleep 180 ; exec zsh -l'
screen    -t zsh   5 ash -c 'sleep 240 ; fortune 100% np-fortune ; exec zsh -l'
screen    -t zsh   6 ash -c 'sleep 300 ; fortune 20% myfortune 80% twisted-quotes ; exec zsh -l'
screen    -t zsh   7 ash -c 'sleep 360 ; exec zsh -l'

screen    -t  zsh 8  ash -c '/home/juhtolv/bin/crm114-handlespamA.sh ; fortune 100% osfortune ; exec zsh -l'

select 1

And as you can see, zsh is there in many places without path. If I
replace every occurrence of "zsh" in that .screenrc with "/bin/zsh", nvi
works just fine under screen. Case closed!

Summa summarum: nvi checks environment variable $SHELL . It tries to use
shell mentioned in that variable, but that environment variable must
have whole path of that shell. I am not very sure, if nvi must be fixed.
Normally $SHELL is defined so that it has whole path of shell, not just
command. I guess Unix-standards like POSIX demand it to be so.

But it might be good idea to add some information about these problems
to its FAQ. I hereby declare this E-Mail message you are reading to be
public domain.


-- 
Juhapekka "naula" Tolvanen * * http colon slash slash iki dot fi slash juhtolv
"kummaan paikkaan itsesi karkotit, syyttä syyllisten seuduille. raskaisiin
taloihin pesit, kirkuviin huoneisiin. mitä ne sinulle tekevät siellä? kuka on
raapinut nimesi pois, nimesi, kasvosi, mielesi oivat palvelemaan konetta?" CMX

