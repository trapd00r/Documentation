From zsh-workers-return-9370-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Jan 19 15:46:40 2000
Return-Path: <zsh-workers-return-9370-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4202 invoked from network); 19 Jan 2000 15:46:39 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 19 Jan 2000 15:46:39 -0000
Received: (qmail 1267 invoked by alias); 19 Jan 2000 15:46:28 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9370
Received: (qmail 1259 invoked from network); 19 Jan 2000 15:46:28 -0000
Date: Wed, 19 Jan 2000 16:46:18 +0100 (MET)
Message-Id: <200001191546.QAA15764@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Alexandre Duret-Lutz's message of 19 Jan 2000 12:05:09 +0100
Subject: Re: If someone wants to try...


Alexandre Duret-Lutz wrote:

> With the three patches applied I can reproduce the following segfault.
> The idea is to make a completion (here on filenames, after cat)
> just before completing for $functions (it look like it will
> hang only when completing the varname `$functions').

Missing initialisation for a tstack field in two places.

And maybe we should try to avoid building values for arrays and hashes 
when completing their names (it's autoparamslash if I'm not completely 
mistaken). No patch for this yet.

Bye
 Sven

--- ../z.old/Src/text.c	Wed Jan 19 10:07:27 2000
+++ Src/text.c	Wed Jan 19 16:43:51 2000
@@ -615,7 +615,8 @@
 			}
 			break;
 		    case COND_AND:
-			tpush(code, 1);
+			n = tpush(code, 1);
+			n->u._cond.par = 0;
 			code = *state->pc++;
 			if (WC_COND_TYPE(code) == COND_OR) {
 			    taddstr("( ");
@@ -624,7 +625,8 @@
 			}
 			break;
 		    case COND_OR:
-			tpush(code, 1);
+			n = tpush(code, 1);
+			n->u._cond.par = 0;
 			code = *state->pc++;
 			if (WC_COND_TYPE(code) == COND_AND) {
 			    taddstr("( ");

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

