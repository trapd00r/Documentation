From zsh-users-return-7671-mason-zsh=primenet.com.au@sunsite.dk Sat Jul 10 17:25:26 2004
Return-Path: <zsh-users-return-7671-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22869 invoked from network); 10 Jul 2004 17:25:25 -0000
Received: from odin.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.85)
  by ns1.primenet.com.au with SMTP; 10 Jul 2004 17:25:25 -0000
Received: (qmail 21238 invoked from network); 10 Jul 2004 17:27:22 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 Jul 2004 17:27:22 -0000
Received: (qmail 19058 invoked by alias); 10 Jul 2004 17:24:47 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 7671
Received: (qmail 19048 invoked from network); 10 Jul 2004 17:24:46 -0000
Received: from odin.dotsrc.org (HELO a.mx.sunsite.dk) (qmailr@130.225.247.85)
  by sunsite.dk with SMTP; 10 Jul 2004 17:24:46 -0000
Received: (qmail 20182 invoked from network); 10 Jul 2004 17:26:52 -0000
Received: from student.uci.agh.edu.pl (@149.156.98.60)
  by a.mx.sunsite.dk with SMTP; 10 Jul 2004 17:26:46 -0000
Received: by student.uci.agh.edu.pl (Postfix, from userid 25828)
	id 9D1C964625; Sat, 10 Jul 2004 19:24:36 +0200 (CEST)
Date: Sat, 10 Jul 2004 19:24:36 +0200
From: Jan Srzednicki <winfried@student.agh.edu.pl>
To: zsh-users@sunsite.dk
Subject: completion being broken with colored prompts
Message-ID: <20040710172436.GC2242@student.agh.edu.pl>
Reply-To: w@dream.vg
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.6i
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

Hello there,

I use zsh 4.2.0 on FreeBSD.

Lets say I have the following PROMPT set:

PROMPT="^[[33m%m ^[[39m%# "

Colors work fine. The hostname is printed in yellow, the %# and the
Commandline are normal. It gets like:

stronghold % 

But, it seems to me that zle (with the
completion subsystem) loses it's orientation on where the cursor really
is and how long the prompt really is. Let's use the completion for
anything (ie for traversing some directory tree). So I type:

stronghold % ls /usr/src/<TAB>

And the line is messed up:

stronghold % ls /usr/srls /usr/src/
                       ^
		       
It looks like the zle thinks the end of prompt is now located in the
place I've marked. I've read through documentation, but I couldn't find
any solution (settable option or anything) to make that work properly.
When the prompt gets longer (and more color switches are used), it gets
more and more messed up, until nothing is readable anymore and I have to
type blindly.

The problem is not related to the terminal program (I tried aterm, xterm
and FreeBSD console), nor $TERM variable (tried cons25, xterm, xterm-color
and screen). I've mostly tried that on FreeBSD, but I also see it
Happening (although in a bit different way) on Linux (zsh 4.0.9), so I'm
not sure how FreeBSD-specific it is.

I have also tried putting color sequences in "%{..%}", which changes the
behaviour a bit (ie, the thing ends up in a different place), but does not
solve the problem.

Did I miss something in the documentation?

greetings,
-- 
 -- Jan Srzednicki --=-- wrzask --=-- Winfried --
 -- w@dream.vg --==-- http://violent.dream.vg/ --

