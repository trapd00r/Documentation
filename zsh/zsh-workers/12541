From zsh-workers-return-12541-mason-zsh=primenet.com.au@sunsite.auc.dk Sat Aug 05 01:28:00 2000
Return-Path: <zsh-workers-return-12541-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 929 invoked from network); 5 Aug 2000 01:27:59 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 5 Aug 2000 01:27:59 -0000
Received: (qmail 22914 invoked by alias); 5 Aug 2000 01:27:49 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12541
Received: (qmail 22907 invoked from network); 5 Aug 2000 01:27:48 -0000
Date: Fri, 4 Aug 2000 21:27:46 -0400
From: Clint Adams <schizo@debian.org>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: zrealpath
Message-ID: <20000804212746.A8137@dman.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
User-Agent: Mutt/1.1.2i

This implements zrealpath.  If there is no realpath() it merely
copies the string.  I think that this is acceptable for now since
nothing depends upon it.

Index: configure.in
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.in,v
retrieving revision 1.17
diff -u -r1.17 configure.in
--- configure.in	2000/08/02 18:01:51	1.17
+++ configure.in	2000/08/05 01:21:37
@@ -864,7 +864,7 @@
 	       signgam \
 	       putenv getenv \
 	       brk sbrk \
-	       pathconf)
+	       pathconf realpath)
 AC_FUNC_STRCOLL
 
 if test $ac_cv_func_setpgrp = yes; then
Index: Src/compat.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/compat.c,v
retrieving revision 1.2
diff -u -r1.2 compat.c
--- Src/compat.c	2000/08/04 07:09:12	1.2
+++ Src/compat.c	2000/08/05 01:21:39
@@ -141,6 +141,19 @@
 }
 #endif
 
+/**/
+mod_export char *
+zrealpath(const char *path, char *resolved_path)
+{
+#ifdef HAVE_REALPATH
+    return realpath(path, resolved_path);
+#else /* the following block should be replaced with a realpath() equiv. */
+    long pathmax;
+
+    if ((pathmax = zpathmax(path)) > 0)
+	return strncpy(resolved_path, path, pathmax);
+#endif
+}
 
 /**/
 mod_export char *

