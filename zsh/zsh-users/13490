From zsh-users-return-13490-mason-zsh=primenet.com.au@sunsite.dk Tue Nov 25 18:41:34 2008
Return-Path: <zsh-users-return-13490-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7834 invoked from network); 25 Nov 2008 18:41:30 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 Nov 2008 18:41:30 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 21292 invoked from network); 25 Nov 2008 18:41:06 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 25 Nov 2008 18:41:06 -0000
Received: (qmail 18370 invoked by alias); 25 Nov 2008 18:40:50 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13490
Received: (qmail 18358 invoked from network); 25 Nov 2008 18:40:49 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 25 Nov 2008 18:40:49 -0000
Received: from n3.bullet.mail.gq1.yahoo.com (n3.bullet.mail.gq1.yahoo.com [67.195.9.86])
	by bifrost.dotsrc.org (Postfix) with SMTP id 6112880525B5
	for <zsh-users@sunsite.dk>; Tue, 25 Nov 2008 19:40:34 +0100 (CET)
Received: from [67.195.9.83] by n3.bullet.mail.gq1.yahoo.com with NNFMP; 25 Nov 2008 18:40:33 -0000
Received: from [67.195.9.106] by t3.bullet.mail.gq1.yahoo.com with NNFMP; 25 Nov 2008 18:40:33 -0000
Received: from [127.0.0.1] by omp110.mail.gq1.yahoo.com with NNFMP; 25 Nov 2008 18:40:33 -0000
X-Yahoo-Newman-Property: ymail-3
X-Yahoo-Newman-Id: 79987.39109.bm@omp110.mail.gq1.yahoo.com
Received: (qmail 41153 invoked by uid 60001); 25 Nov 2008 18:40:32 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type:Message-ID;
  b=SKTbowDltdigPwLbXUg0tOLRtvb4H63GLOtcCE0Y/HRg9eLXb9ys2Csfhtqqt5B7hkOT3GgLszxJtON84OA0zValYi6JghUCglmz9f12/aXtoRzlCfsH7sA+oIZ3ac2rlX37ybtDVcPaTj8Vin1mtEUyC9vZoPFisoGGbjuAc6w=;
X-YMail-OSG: cJB.tdIVM1nupwu2bL9pwNOzY4LEvNFJVsF2hkwvl_GlaM7DD8XgHo_a7qc6FqJgvatmzOpL1YxbApsOci3bH7ju8KC_1G.BUr88eXd7FzXnFcuVsH4kkwfajeL2Vm.sdc95zXk-
Received: from [92.104.0.198] by web111205.mail.gq1.yahoo.com via HTTP; Tue, 25 Nov 2008 10:40:32 PST
X-Mailer: YahooMailRC/1155.32 YahooMailWebService/0.7.260.1
Date: Tue, 25 Nov 2008 10:40:32 -0800 (PST)
From: Enny Ammis <enny_ammis@yahoo.com>
Subject: Retrieving the terminal title / setting it using the name of the foreground process
To: zsh-users@sunsite.dk
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Message-ID: <882441.36344.qm@web111205.mail.gq1.yahoo.com>
X-Virus-Scanned: ClamAV 0.92.1/8679/Tue Nov 25 14:08:31 2008 on bifrost
X-Virus-Status: Clean

Hi,

i'm fairly new to zsh (it's been 4 days now), and i've been spending some time customizing it. one thing i haven't been able to do yet is change a terminal's title so that it contains the name of the currently active process, i.e. "zsh" if i'm simply using the shell, "perl args" if i'm running a perl program, "emacs file.txt" if i'm running emacs and "zsh" again if i hit ^Z and send emacs to the background. 

i haven't found as simple a way to do it as with the name of the current directory. using precmd or that kind of stuff probably wouldn't work, be it only because the name of the foreground app might change without my actually executing a command -- again, ^Z should also trigger a title change. i've tried using preexec, but then it gets mixed up when using e.g. "fg" to come back to a bg'd process. i also wanted to define TRAPTSTP to handle bg'ing, but i get the following error upon starting the shell: "can't trap SIGTSTP in interactive shells" (perhaps it's the wrong signal?)

anyway, another way i've thought of is to have a script (in my case it's in perl) run in the background, and every second call ps, capture the output and recognize the foreground processes in all tty's (most often i have a lot of them, that's why i need a way of differentiating them) and set the titles accordingly. some might argue that it's not very efficient, which might be right, and i welcome all suggestions for alternatives, then again i haven't found any other way. 

anyway, i still have some problems which i'm sure are solvable, but i haven't figured the solutions yet, perhaps someone can give me a hand? 

1) my title already contains information, so i need to *update* it, not simply overwrite it, i.e. i want to append the name of the current foreground process at the end...
e.g. my basic title as set by the precmd function is like this:
username@host:tty pwd ()
and i want the space between the brackets to be filled with the name of the fg process. 

i have thought of two possible ways to do that, both of which i dunno how to implement: 
a) upon creating the title in the precmd function, store it in a cache or something, which my perl script has access to. however, i dunno how to expand the cryptic expression "%n@%m:%l %~ ()" into a nice title from within the function... as i don't believe it's possible to access the environment of any session from a given terminal to retrieve the environment variables like $PWD, i have to use the value generated within the precmd function and extend it. anyone knows how to do that? 
b) retrieve the title of a given tty. the good part is then i wouldn't have to use a cache to store the titles of several tty's. the bad part is i dunno if it's possible. 

2) i can't remember how it's possible to "remotely" (i.e. from another terminal) change a terminal's title. i'm pretty sure i've read somewhere that this can be done by doing something like sending the "usual string" "\e]0;nice title\a" into /dev/ttyN, but that doesn't seem to work -- if i try to do that on the console, i get an error:
> echo "\e]0;abc\a" > /dev/tty5
zsh: keine Berechtigung: /dev/tty5
>
(yeah, sorry, it's german, it means "not authorized" or something like that)
anyone knows how to do that? 
if it's not possible to do that remotely, then there's always the possibility of having one perl script run in each terminal -- not nice, but that would work...

it'd be real cool if someone could give me some hints as to how i can get this on track. thx a lot in advance for your help! 

cheers

Enny



      

