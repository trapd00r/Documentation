From zsh-workers-request@math.gatech.edu Wed Mar 04 10:04:15 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 28079 invoked from network); 4 Mar 1998 10:04:13 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 4 Mar 1998 10:04:13 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.8.5/8.8.5) id EAA20314;
	Wed, 4 Mar 1998 04:45:41 -0500 (EST)
Resent-Date: Wed, 4 Mar 1998 04:45:21 -0500 (EST)
From: Andrew Main <zefram@tao.co.uk>
Message-Id: <199803040947.JAA23744@taos.demon.co.uk>
Subject: Re: Incorrect TimeZone usage in prompts - bug?
To: andsi988@student.liu.se (Andreas Sigfridsson)
Date: Wed, 4 Mar 1998 09:47:27 +0000 (GMT)
Cc: zsh-users@math.gatech.edu
In-Reply-To: <01bd46e3$37feae00$e3efec82@h227.ryd.student.liu.se> from "Andreas Sigfridsson" at Mar 3, 98 09:30:34 pm
X-Loop: zefram@tao.co.uk
X-Headers: in preparation
X-Mailer: ELM [version 2.4 PL25]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"B8xgo1.0.qy4.mAI_q"@math>
Resent-From: zsh-users@math.gatech.edu
X-Mailing-List: <zsh-users@math.gatech.edu> archive/latest/1369
X-Loop: zsh-users@math.gatech.edu
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Andreas Sigfridsson wrote:
>I like to have the time being displayed in my prompt, but on both my Linux
>computers, they display the wrong time. I live in Sweden where whe have CET,
>but zsh displays GMT. Being quite a novice on Unix/Linux I understand that
>system time can be represented in the computer in two different ways. Either
>the actual local time, or GMT with a timezone. I guess I use the latter one,
>and I cannot change, because I run Windows on the same computer. Is it
>possible that zsh just takes the clock and uses it regardless of the
>timezone?

This is tricky.

The Unix model of timekeeping is that the kernel maintains a count of
the number of seconds since the epoch, which is 1970-01-01 midnight UTC.
When displaying a time, library functions examine the environment variable
TZ, and display the time relative to this timezone.

The Windoze model of timekeeping is that the kernel knows the current
date and time of day, for the current timezone.  This kernel clock needs
to change whenever DST causes a change of timezone.

These two models are fundamentally inconsistent, so you're just asking for
trouble in trying to use both of them on the same machine.  This being
a PC, you're further affected by the fact that the PC's hardware clock
actually keeps track of date and time, and has no idea of timezone.

The usual compromise is to set the hardware clock to the current GMT time,
and in Windoze select GMT (and disable DST -- MS misuse the term "GMT"
to mean "current civil timezone in the UK").  In Windoze, therefore,
you get just UTC times, and under Linux you get whatever timezone you
select with $TZ.  You should make sure you are setting and exporting
that parameter in your startup files.

-zefram

