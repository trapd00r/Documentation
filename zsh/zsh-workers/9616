From zsh-workers-return-9616-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Feb 08 10:07:44 2000
Return-Path: <zsh-workers-return-9616-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1551 invoked from network); 8 Feb 2000 10:07:42 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 8 Feb 2000 10:07:42 -0000
Received: (qmail 23812 invoked by alias); 8 Feb 2000 10:07:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9616
Received: (qmail 23804 invoked from network); 8 Feb 2000 10:07:35 -0000
Date: Tue, 8 Feb 2000 11:07:34 +0100 (MET)
Message-Id: <200002081007.LAA01435@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Oliver Kiddle's message of Mon, 07 Feb 2000 14:39:16 +0000
Subject: Re: Problem with completion after a variable with globcomplete


Oliver Kiddle wrote:

> zsh -f
> autoload -U compinit
> compinit
> setopt globcomplete
> f=/home
> cd $f/okiddle/<tab>
> 
> Here the tab, inserts a space when I would expect it to list directories
> in my home. It seems to be that completion stops working for the second
> directory after a variable reference.

The test if we had a pattern went wrong.

Bye
 Sven

diff -ru ../z.old/Completion/Core/_path_files Completion/Core/_path_files
--- ../z.old/Completion/Core/_path_files	Tue Feb  8 10:16:39 2000
+++ Completion/Core/_path_files	Tue Feb  8 11:06:02 2000
@@ -452,7 +452,7 @@
 
     if (( $#tmp4 )) ||
        [[ -n "$compstate[pattern_match]" &&
-          "$PREFIX$SUFFIX" != "${(q)PREFIX}${(q)SUFFIX}" ]]; then
+          "${PREFIX:s/$//}${SUFFIX:s/$//}" != "${(q)PREFIX:s/$//}${(q)SUFFIX:s/$//}" ]]; then
 
       # It is. For menucompletion we now add the possible completions
       # for this component with the unambigous prefix we have built

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

