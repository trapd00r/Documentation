From zsh-workers-request@euclid.skiles.gatech.edu Thu Jun 19 08:36:20 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 16486 invoked from network); 19 Jun 1997 08:36:17 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 19 Jun 1997 08:36:17 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id EAA12257; Thu, 19 Jun 1997 04:20:39 -0400 (EDT)
Resent-Date: Thu, 19 Jun 1997 04:20:39 -0400 (EDT)
To: zsh-workers@math.gatech.edu
Path: mason
From: mason@primenet.com.au (Geoff Wing)
Newsgroups: lists.zsh.workers
Subject: Patch for zle_refresh.c
Date: 19 Jun 1997 08:24:32 GMT
Organization: PrimeNet
Lines: 60
Message-ID: <slrn5qhr60.g19.mason@coral.primenet.com.au>
References: <9706190624.AA05850@oz.fantasy.otsl.oki.co.jp> from SUZUKI Hisao at "Jun 19, 97 03:24:32 pm" <199706190704.DAA05872@hzoli.home>
Reply-To: mason@primenet.com.au
NNTP-Posting-Host: coral.primenet.com.au
X-Newsreader: slrn (0.9.3.2 UNIX)
Resent-Message-ID: <"FjCwY.0.S_2.MlEgp"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3260
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On 19 Jun 1997 17:09:00 +1000, Zoltan Hidvegi <hzoli@ny.frontiercomm.net> wrote:
:And I should apologize for the delay of zsh-3.0.4.  I have almost made a
:release but then came two new fixes from Peter az Zefram.

Well, I better give you this patch then.  It's against 3.0.3 (I think).

Note: this is a fix to avoid a coredump - it's a kludge because I haven't 
looked into the reasons behind it yet so I don't know if something else is
buggy or just this.  Also, a couple of people - Andrej Borsenkow & Zefram -
have indicated another problem with the display which I haven't got round to
investigating properly yet; I can't reproduce it from their methods.


*** zle_refresh.c.org	Tue Jun  3 15:11:25 1997
--- zle_refresh.c	Thu Jun 19 18:13:46 1997
***************
*** 758,763 ****
--- 758,765 ----
  void
  moveto(int ln, int cl)
  {
+     int c;
+ 
      if (vcs == winw) {
  	vln++, vcs = 0;
  	if (!hasam) {
***************
*** 765,776 ****
  	    zputc('\n', shout);
  	} else {
  	    if ((vln < nlnct) && nbuf[vln] && *nbuf[vln])
! 		zputc(*nbuf[vln], shout);
  	    else
! 		zputc(' ', shout);
  	    zputc('\r', shout);
  	    if ((vln < olnct) && obuf[vln] && *obuf[vln])
! 		*obuf[vln] = *nbuf[vln];
  	}
      }
  
--- 767,779 ----
  	    zputc('\n', shout);
  	} else {
  	    if ((vln < nlnct) && nbuf[vln] && *nbuf[vln])
! 		c = *nbuf[vln];
  	    else
! 		c = ' ';
! 	    zputc(c, shout);
  	    zputc('\r', shout);
  	    if ((vln < olnct) && obuf[vln] && *obuf[vln])
! 		*obuf[vln] = c;
  	}
      }
  

-- 
Geoff Wing [mason@primenet.com.au]   Technical Manager
  Phone    : +61-3-9818 2977         PrimeNet - Internet Consultancy
  Facsimile: +61-3-9819 3788         Web : <URL:http://www.primenet.com.au/>
  Mobile   : 0412 162 441

