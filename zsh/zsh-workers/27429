From zsh-workers-return-27429-mason-zsh=primenet.com.au@zsh.org Tue Nov 24 10:11:42 2009
Return-Path: <zsh-workers-return-27429-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7097 invoked by alias); 24 Nov 2009 10:11:41 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 27429
Received: (qmail 7762 invoked from network); 24 Nov 2009 10:11:37 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-3.0 required=5.0 tests=AWL,BAYES_00,
	RCVD_IN_DNSWL_LOW autolearn=ham version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at csr.com does not designate permitted sender hosts)
Message-Id: <200911241011.nAOABPxm024371@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-workers@zsh.org
Subject: Re: New "make" completion (Attempt 3)
In-reply-to: <22a0ef080911231550r315e9fc8pb1e6730ff4d464ea@mail.gmail.com>
References: <22a0ef080911231550r315e9fc8pb1e6730ff4d464ea@mail.gmail.com>
Comments: In-reply-to Michael Hwang <michael.a.hwang@gmail.com>
   message dated "Mon, 23 Nov 2009 18:50:13 -0500."
Date: Tue, 24 Nov 2009 10:11:25 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 24 Nov 2009 10:11:28.0073 (UTC) FILETIME=[7C872B90:01CA6CEE]
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A-09-22-03 (www.mailcontrol.com) on 10.68.0.133

Michael Hwang wrote:
> --0016e6d58b2f9031690479127c3d
> Content-Type: text/plain; charset=ISO-8859-1
> 
> Sorry, I guess Yahoo is nuking my attachments. Just in case, there's
> an attachment on this e-mail, as well as a paste.
> 
> http://pastebin.com/m3800c08b

At the risk of rubbing it in, that wasn't completely ideal either:  a
URL that points to the raw file is better.

I've committed this---it certain looks like it does a better job after a
brief test.

This:

  # These are left over from the old completion. I'm not sure what they do.
  #compstate[parameter]="${PREFIX%%\=*}"
  #compset -P 1 '*='
  #_value "$@"

was an attempt to complete tha value of a variable, using the usual
context of parameter completion.  By default you'd be able to complete
files, which was quite useful.  I'll commit the following, as well
as fixing the indentation back to two spaces:

Index: Completion/Unix/Command/_make
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_make,v
retrieving revision 1.21
diff -u -r1.21 _make
--- Completion/Unix/Command/_make	24 Nov 2009 10:01:11 -0000	1.21
+++ Completion/Unix/Command/_make	24 Nov 2009 10:08:53 -0000
@@ -197,7 +197,10 @@
 
 	if [[ $PREFIX == (#b)([^=]##)'='* ]] && [[ -n ${${(k)VARIABLES}[(r)${match[1]}]} ]]
 	then
-		_message 'override make variable'
+	        # Complete make variable as if shell variable
+		compstate[parameter]="${PREFIX%%\=*}"
+		compset -P 1 '*='
+		_value "$@"
 	else
 		_tags targets variables
 		while _tags
@@ -208,9 +211,4 @@
 				compadd -S '=' -- ${(k)VARIABLES}
 		done
 	fi
-
-	# These are left over from the old completion. I'm not sure what they do.
-	#compstate[parameter]="${PREFIX%%\=*}"
-	#compset -P 1 '*='
-	#_value "$@"
 fi


-- 
Peter Stephenson <pws@csr.com>            Software Engineer
Tel: +44 (0)1223 692070                   Cambridge Silicon Radio Limited
Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, UK


Member of the CSR plc group of companies. CSR plc registered in England and Wales, registered number 4187346, registered office Churchill House, Cambridge Business Park, Cowley Road, Cambridge, CB4 0WZ, United Kingdom

