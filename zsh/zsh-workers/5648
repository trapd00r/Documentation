From zsh-workers-return-5648-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Mar 05 09:09:15 1999
Return-Path: <zsh-workers-return-5648-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16640 invoked from network); 5 Mar 1999 09:09:13 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 5 Mar 1999 09:09:13 -0000
Received: (qmail 959 invoked by alias); 5 Mar 1999 09:08:45 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5648
Received: (qmail 951 invoked from network); 5 Mar 1999 09:08:43 -0000
Message-Id: <9903050852.AA19585@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk
Subject: Re: PATCH: 3.1.5-pws-10: _tar 
In-Reply-To: "Sven Wischnowsky"'s message of "Fri, 05 Mar 1999 09:18:58 NFT."
             <199903050818.JAA03410@beta.informatik.hu-berlin.de> 
Date: Fri, 05 Mar 1999 09:52:52 +0100
From: Peter Stephenson <pws@ibmth.df.unipi.it>

Sven Wischnowsky wrote:
> It was too eager to replace `*s' with `[^/]#'s. The patch below does
> the replacement only for the non-last components.

Working a lot better now, thanks.  It's maybe a little bit eager to stick
in later path components: if I type zsh-3.1.5-pws-10/Sr<TAB> it completes
(with menucompletion) all the way to Src/.cvisignore instead of hanging
around at the next slash.  I suppose normally with ordinary completion
it'll stop after the slash because the rest is ambiguous, but that won't
always be the case.

By the way, I think you can turn things like

eval patstr\="\$patstr:gs-${sep}-\*${sep}-:gs/\*\*/\*/"

into

patstr="${${patstr//$sep/*$sep}//\*##/*}"

which not only avoids the eval, it avoids difficulties with the delimiters
since the $sep is only substituted after the /'s are parsed, plus the
characters in $sep are automatically quoted by the usual noglobsubst rule.
But you have to be careful quoting metacharacters in the `before' text.
You can also now use ## to turn multiple stars into a single one with
extendedglob.  Neither form will turn *** into a single *, since the
replacement text is never used for further matching.  I don't know if
that's a bug, but probably not.

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

