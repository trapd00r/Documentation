From zsh-users-return-14769-mason-zsh=primenet.com.au@zsh.org Tue Feb 02 12:34:17 2010
Return-Path: <zsh-users-return-14769-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15736 invoked by alias); 2 Feb 2010 12:34:17 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14769
Received: (qmail 4694 invoked from network); 2 Feb 2010 12:34:13 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00,SPF_HELO_PASS
	autolearn=ham version=3.2.5
Received-SPF: none (ns1.primenet.com.au: domain at bewatermyfriend.org does not designate permitted sender hosts)
From: Frank Terbeck <ft@bewatermyfriend.org>
To: zsh-users@zsh.org
Subject: Re: Want to replace bash w zsh as system shell on Ubuntu
In-Reply-To: <20100202081546.GA5930@panix.com> (rj@panix.com's message of
	"Tue, 2 Feb 2010 03:15:47 -0500")
References: <20100202081546.GA5930@panix.com>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.1 (gnu/linux)
Date: Tue, 02 Feb 2010 13:21:44 +0100
Message-ID: <87vdefkeuf.fsf@ft.bewatermyfriend.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Df-Sender: 430444

rj wrote:
> In the couple of months I've been using Ubuntu at home, I've discovered
> I need to use the "sudo" command almost daily for administrative changes
> and systemwide, non-user-specific tasks and so on.
>
> I've already set up zsh as my user shell, but the system default shell is
> bash, and whenever I do a "sudo" I'm wrenched out of my familiar customized
> zsh environment into a raw, minimally-config'd bash.

You need to differentiate between default interactive shells and /bin/sh
here. I suspect what you mean are interactive shells here. But just in
case you do mean changing the /bin/sh symbolic link to zsh, a word of
warning:

With the grml live-cd (http://grml.org) we actually had zsh a /bin/sh
for a number of releases. And - contrary to what others may believe - it
worked well enough. Until it broke one day. Bugs were filed but went
generally ignored. That resulted in grml backing off from using zsh as
/bin/sh, documented even in our FAQ: <http://grml.org/faq/#zsh_binsh>

Looking back we probably should have reported bugs against zsh to
improve its `sh' mode.

One of the problems (which was worked around after four years in debian)
was a script defining a function called `repeat'. That's also a shell
reserved word in zsh, leading to a parsing error. If zsh would disable
`repeat' in sh mode, which would also be correct, that problem would be
gone.

The other problem mentioned in grml's FAQ is #329288[1], where the
problem is a script using `ulimit'. In sh mode, zsh does not make
`ulimit' available as a builtin command. The guy responding to the bug
report closed the bug, stating that zsh in sh mode is not a POSIX
compatible shell and therefore not supported. I guess strictly speaking,
you cannot dispute that - although sh mode is trying as hard as possible
to be compatible. Demanding POSIX here is kind of a two sided sword,
though. If you look at the actual standard for ulimit[2] you'll find
that `ulimit' is only an extension to the standard.

Granted, ksh93, pdksh, mksh, bash and dash all implement that extension.

But debian's posh, which in it's manual declares it covers SUSv3
compliance with the exceptions: echo -n, binary -a and -o to test, local
scoping. And in fact, it does *not* implement `ulimit'.

For compatibility with the other shells listed above, zsh could just
expose `ulimit' in sh mode and be done with it.


Anyway, if you do change /bin/sh to be zsh, you should prepare for
problems. And for what it's worth, I think ubuntu's choice of `dash' as
/bin/sh is rather adequate. Stick with it.


If this whole question is about the interactive shell that you're
getting dropped into by `sudo' (which I suspect), I'd change root's
shell to zsh by chsh(1) and use `sudo -i' instead of `sudo -s'.

Regards, Frank

[1] <http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=329288>
[2] <http://www.opengroup.org/onlinepubs/9699919799/utilities/ulimit.html>

-- 
In protocol design, perfection has been reached not when there is
nothing left to add, but when there is nothing left to take away.
                                                  -- RFC 1925

