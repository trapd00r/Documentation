From zsh-workers-return-5365-mason-zsh=primenet.com.au@sunsite.auc.dk Sat Feb 13 14:58:40 1999
Return-Path: <zsh-workers-return-5365-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20496 invoked from network); 13 Feb 1999 14:58:38 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 13 Feb 1999 14:58:38 -0000
Received: (qmail 21547 invoked by alias); 13 Feb 1999 14:58:06 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 5365
Received: (qmail 21540 invoked from network); 13 Feb 1999 14:58:03 -0000
Message-Id: <9902131442.AA34059@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: PATCH: zsh-3.1.5 pre-pws-8: make dependencies
Date: Sat, 13 Feb 1999 15:42:07 +0100
From: Peter Stephenson <pws@ibmth.df.unipi.it>

This is supposed to improve some make dependencies; no obvious circularity
problems yet...

1. Makemod didn't get remade when the version changed,

2. main.o didn't get remade when zsh.h changed,

3. zshpaths.h didn't get remade when Makemod (which defines the module
directory from $(VERSION) as it appears in Makemod itself) changed.
I have a suspicion FORCE is supposed to do something in this area.

--- Src/Makefile.in.deps	Sat Feb 13 14:15:31 1999
+++ Src/Makefile.in	Sat Feb 13 15:39:24 1999
@@ -85,7 +85,9 @@
 rm-modobjs-tmp:
 	rm -f stamp-modobjs.tmp
 
-Makemod modules.index prep: modules-bltin
+@@config.mk@@
+
+Makemod modules.index prep: modules-bltin $(CONFIG_INCS)
 	( cd $(sdir_top) && $(SHELL) $(subdir)/mkmodindex.sh $(subdir) ) \
 	    > modules.index.tmp
 	@if cmp -s modules.index.tmp modules.index; then \
@@ -200,6 +202,4 @@
 modobjs modules headers proto $(MAIN_OBJS): Makemod
 	@$(MAKE) -f Makemod $(MAKEDEFS) $@
 
-# ========== DEPENDENCIES FOR MAINTENANCE ==========
-
-@@config.mk@@
+$(MAIN_OBJS): $(sdir)/zsh.h
--- Src/zsh.mdd.deps	Mon Feb  8 18:14:39 1999
+++ Src/zsh.mdd	Sat Feb 13 14:23:35 1999
@@ -28,7 +28,7 @@
 version.h: $(sdir_top)/Config/version.mk
 	echo '#define ZSH_VERSION "'$(VERSION)'"' > $@
 
-zshpaths.h: FORCE
+zshpaths.h: FORCE Makemod
 	@echo '#define MODULE_DIR "'$(MODDIR)'"' > zshpaths.h.tmp
 	@if cmp -s zshpaths.h zshpaths.h.tmp; then \
 	    rm -f zshpaths.h.tmp; \

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

