From zsh-workers-return-10464-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Apr 04 12:16:26 2000
Return-Path: <zsh-workers-return-10464-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1396 invoked from network); 4 Apr 2000 12:16:25 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 4 Apr 2000 12:16:25 -0000
Received: (qmail 20397 invoked by alias); 4 Apr 2000 12:16:14 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10464
Received: (qmail 20385 invoked from network); 4 Apr 2000 12:16:13 -0000
Date: Tue, 4 Apr 2000 14:16:11 +0200 (MET DST)
Message-Id: <200004041216.OAA13494@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Peter Stephenson's message of Mon, 03 Apr 2000 21:32:35 +0100
Subject: Re: Still problems with scriptname (presumably)


Peter Stephenson wrote:

> % zsh -c 'echo '\' this_is_not_the_command_name
> this_is_not_the_command_name:-1: unmatched '
> ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
> this is the bit I object to, the error message is OK.

Note: no `PATCH:' in the subject...

I was about to send/commit the patch below (which is kinda brute
force, setting scriptname to zsh when there is a -c option on the
command line).


But then I tried ksh and bash. ksh doesn't give me an error (?!?) and
bash does the same as zsh currently does.

I don't need to say that compatibility to bash doesn't interest me, do I?

So, should I commit the change?

Bye
 Sven

Index: Src/init.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/init.c,v
retrieving revision 1.1.1.51
diff -u -r1.1.1.51 init.c
--- Src/init.c	2000/03/23 04:22:57	1.1.1.51
+++ Src/init.c	2000/04/04 12:09:26
@@ -222,6 +222,7 @@
 		cmd = *argv;
 		opts[INTERACTIVE] &= 1;
 		opts[SHINSTDIN] = 0;
+		scriptname = ztrdup("zsh");
 	    } else if (**argv == 'o') {
 		if (!*++*argv)
 		    argv++;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

