From zsh-workers-return-26244-mason-zsh=primenet.com.au@sunsite.dk Sun Jan 04 18:33:59 2009
Return-Path: <zsh-workers-return-26244-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3122 invoked from network); 4 Jan 2009 18:33:56 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 4 Jan 2009 18:33:56 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 52232 invoked from network); 4 Jan 2009 18:33:50 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Jan 2009 18:33:50 -0000
Received: (qmail 358 invoked by alias); 4 Jan 2009 18:33:44 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 26244
Received: (qmail 347 invoked from network); 4 Jan 2009 18:33:43 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 4 Jan 2009 18:33:43 -0000
Received: from vms173007pub.verizon.net (vms173007pub.verizon.net [206.46.173.7])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 806A2802720C
	for <zsh-workers@sunsite.dk>; Sun,  4 Jan 2009 19:33:39 +0100 (CET)
Received: from torch.brasslantern.com ([96.238.220.215])
 by vms173007.mailsrvcs.net
 (Sun Java System Messaging Server 6.2-6.01 (built Apr  3 2006))
 with ESMTPA id <0KCY009BXM5SEP10@vms173007.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Sun, 04 Jan 2009 12:32:16 -0600 (CST)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id n04IXaj9021865	for
 <zsh-workers@sunsite.dk>; Sun, 04 Jan 2009 10:33:37 -0800
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id n04IXaJd021864	for zsh-workers@sunsite.dk; Sun,
 04 Jan 2009 10:33:36 -0800
Date: Sun, 04 Jan 2009 10:33:36 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: How to prevent alias expansion
In-reply-to: <slrngm1n3d.sgm.joerg@alea.gnuu.de>
To: zsh-workers@sunsite.dk
Message-id: <090104103336.ZM21863@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <slrngm1n3d.sgm.joerg@alea.gnuu.de>
Comments: In reply to ( Text in unknown character set UTF-8 not shown )  Sommer
 <joerg@alea.gnuu.de>        "How to prevent alias expansion" (Jan  4,  3:57pm)
X-Virus-Scanned: ClamAV version 0.92.1, clamav-milter version 0.92.1 on bifrost
X-Virus-Status: Clean

On Jan 4,  3:57pm, Jorg wrote: }
} 
} I've a problem with alias expansion. When using run-help and an global
} alias for redirect to /dev/null the command fails.
}
} % alias -g DN='>/dev/null'
} % git show DN<ESC h>
} <empty output>
} 
} I propose this patch:
} -		eval "run-help-$1:t ${(q@)cmd_args[2,-1]}"
} +		eval "run-help-$1:t ${(qq@)cmd_args[2,-1]}"

Hrm.  (qq) is not "quote twice", it's "quote with single quotes", whereas
(q) is "quote with backslashes".

So what's happening here is that quoting with backslashes doesn't change
"DN" at all (because it contains no metacharacters), so then during the
eval, global alias expansion kicks in as usual.  Quoting with single
quotes prevents alias expansion and passes (show DN) to run-help-git.

I can't decide what's correct here.  Are there are cases where someone
would want such an alias to expand?  run-help itself already looks up
aliases on the command word by way of "which".  Consequently a more
obvious patch (to a reader of the script) might be:

  emulate -R zsh
- setopt localoptions
+ setopt localoptions noaliases


