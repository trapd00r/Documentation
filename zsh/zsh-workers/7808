From zsh-workers-return-7808-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Sep 13 14:22:05 1999
Return-Path: <zsh-workers-return-7808-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7109 invoked from network); 13 Sep 1999 14:22:03 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 13 Sep 1999 14:22:03 -0000
Received: (qmail 21200 invoked by alias); 13 Sep 1999 14:21:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7808
Received: (qmail 21193 invoked from network); 13 Sep 1999 14:21:49 -0000
Date: Mon, 13 Sep 1999 16:21:47 +0200 (MET DST)
Message-Id: <199909131421.QAA21463@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 13 Sep 1999 22:57:04 +0900
Subject: Re: Silly questions about _arguments & Co (and probably bugs)


Tanaka Akira wrote:

> Z:akr@is27e1u11% Src/zsh -f 2>z     
> is27e1u11% bindkey -e; fpath=($PWD/Completion/*(/)); autoload -U compinit; compinit -D; compdef _tst tst
> is27e1u11% compconf group_matches=yes message_format='%d' description_format='%d' describe_options=yes   
> is27e1u11% patch -l<TAB>
> option
> -B   -D   -E   -F   -N   -R   -S   -T   -V   -Y   -Z   -b   -d   -z   
> 
> Completion candidates are not enough.
> 
> With `set -x', zsh reports:
> 
> ...
> +_arguments:680> uns=-ignore-whitespacel 
> ...
> 
> Hm. Exclusive long options should not used for `uns'.

Yep.

Bye
 Sven

diff -u oldcompletion/Base/_arguments Completion/Base/_arguments
--- oldcompletion/Base/_arguments	Mon Sep 13 15:46:24 1999
+++ Completion/Base/_arguments	Mon Sep 13 16:21:02 1999
@@ -561,7 +561,7 @@
           uns="${ws[1][2,-1]}"
 
       if [[ -n "$uns" ]]; then
-        uns="${(@j::)${(v)=xors[(I)${ws[1][1]}[$uns]]}#[-+]}"
+        uns="${(@j::)${(M@)${(v)=xors[(I)${ws[1][1]}[$uns]]}:#??}#[-+]}"
 	if  [[ -n "$uns" ]]; then
 	  tmp=(
 	    "opts[${(@)^opts[(I)${ws[1][1]}[$uns]]}]"
@@ -677,11 +677,11 @@
     done
   fi
 
-  [[ -n "$sopts" && -n "$opt" && "$PREFIX" = [-+]${~soptseq}[$sopts] ]] && \
+  [[ -n "$sopts" && -n "$opt" && "$PREFIX" = [-+]${~soptseq}[$sopts] ]] &&
       uns="${PREFIX[2,-1]}"
 
   if [[ -n "$uns" ]]; then
-    uns="${(@j::)${(v)=xors[(I)${ws[1][1]}[$uns]]}#[-+]}"
+    uns="${(@j::)${(M@)${(v)=xors[(I)${ws[1][1]}[$uns]]}:#??}#[-+]}"
     if [[ -n "$uns" ]]; then
       tmp=(
         "opts[${(@)^opts[(I)${pre[1]}[$uns]]}]"

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

