From zsh-workers-return-11335-mason-zsh=primenet.com.au@sunsite.auc.dk Fri May 12 07:03:01 2000
Return-Path: <zsh-workers-return-11335-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4763 invoked from network); 12 May 2000 07:02:59 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 12 May 2000 07:02:59 -0000
Received: (qmail 16966 invoked by alias); 12 May 2000 07:02:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11335
Received: (qmail 16949 invoked from network); 12 May 2000 07:02:49 -0000
Date: Fri, 12 May 2000 09:02:48 +0200 (MET DST)
Message-Id: <200005120702.JAA11015@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Bart Schaefer"'s message of Fri, 12 May 2000 01:46:32 +0000
Subject: Re: _complete_debug causes core dump.


Bart Schaefer wrote:

> On May 12,  5:07am, Tanaka Akira wrote:
> } Subject: _complete_debug causes core dump.
> }
> } _complete_debug causes core dump as follows.
> 
> It's not _complete_debug, it's _message.  If you call _message when there
> are no matches (which _complete_debug does in this case), makecomplist()
> returns 1 and docompletion() derefs a null pointer.  If you don't call
> _message (the case when _main_complete is called directly) makecomplist()
> returns 0 and most of docompletion() is bypassed by a goto.

The problem was that the branch should only be executed when there are 
matches which was ensured before that `compadd -x' change.

Bye
 Sven

Index: Src/Zle/compcore.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compcore.c,v
retrieving revision 1.18
diff -u -r1.18 compcore.c
--- Src/Zle/compcore.c	2000/05/11 08:40:11	1.18
+++ Src/Zle/compcore.c	2000/05/12 07:01:13
@@ -400,7 +400,7 @@
 	if (nmatches > 1 && diffmatches) {
 	    /* There is more than one match. */
 	    ret = do_ambiguous();
-	} else if (nmatches == 1 || !diffmatches) {
+	} else if (nmatches == 1 || (nmatches > 1 && !diffmatches)) {
 	    /* Only one match. */
 	    Cmgroup m = amatches;
 

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

