From zsh-workers-return-22018-mason-zsh=primenet.com.au@sunsite.dk Thu Nov 24 11:42:29 2005
Return-Path: <zsh-workers-return-22018-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5172 invoked from network); 24 Nov 2005 11:42:27 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.0 (2005-09-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.0
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 24 Nov 2005 11:42:27 -0000
Received: (qmail 75666 invoked from network); 24 Nov 2005 11:42:21 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 24 Nov 2005 11:42:21 -0000
Received: (qmail 29538 invoked by alias); 24 Nov 2005 11:42:19 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22018
Received: (qmail 29529 invoked from network); 24 Nov 2005 11:42:18 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 24 Nov 2005 11:42:18 -0000
Received: (qmail 75383 invoked from network); 24 Nov 2005 11:42:18 -0000
Received: from cluster-d.mailcontrol.com (HELO rly37d.srv.mailcontrol.com) (217.69.20.190)
  by a.mx.sunsite.dk with SMTP; 24 Nov 2005 11:42:17 -0000
Received: from exchange03.csr.com ([62.189.241.194])
	by rly37d.srv.mailcontrol.com (MailControl) with ESMTP id jAOBgDJ4004238
	for <zsh-workers@sunsite.dk>; Thu, 24 Nov 2005 11:42:13 GMT
Received: from news01 ([10.103.143.38]) by exchange03.csr.com with Microsoft SMTPSVC(5.0.2195.6713);
	 Thu, 24 Nov 2005 11:44:57 +0000
Date: Thu, 24 Nov 2005 11:42:11 +0000
From: Peter Stephenson <pws@csr.com>
To: zsh-workers@sunsite.dk
Subject: Re: PATCH: newuser system
Message-Id: <20051124114211.1fc867ab.pws@csr.com>
In-Reply-To: <1051124060054.ZM29995@candle.brasslantern.com>
References: <200511231113.jANBD95L013878@news01.csr.com>
	<1051124060054.ZM29995@candle.brasslantern.com>
Organization: Cambridge Silicon Radio
X-Mailer: Sylpheed version 0.9.12 (GTK+ 1.2.10; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 24 Nov 2005 11:44:57.0638 (UTC) FILETIME=[7E921C60:01C5F0EC]
X-Scanned-By: MailControl A-05-40-01 (www.mailcontrol.com) on 10.68.0.147

Bart Schaefer <schaefer@brasslantern.com> wrote:
> This is an impressive piece of work.

Thank you.

> } As this will be seen by a great many new users it
> } really needs to be tested as widely as possible.
> 
> Am I wrong in thinking this could be tested by starting the shell with
> ZDOTDIR in the environment pointing to an empty directory?

That works fine.  Anyone can try it out by:

mkdir /tmp/zdotdir
autoload -Uz zsh-newuser-install
ZDOTDIR=/tmp/zdotdir zsh-newuser-install

(add -f to the end if there's already a .zshrc there.)

> } Index: INSTALL
> } +"name=zsh/newuser" int the config.modules file, which is generated in the
>                        ^^
> (I didn't proofread the rest so closely, I fear.)

I'll check that in.

> } +# Substitute an initial ~ for human consumption.
> } +if [[ $zd = $HOME ]]; then
> } +  zdmsg="~"
> } +else
> } +  zdmsg=$zd
> } +fi
> 
>   zdmsg=${(%):-%~}
> 
> (How's *that* for obfuscation?)

That would deserve another "snicker", but $zd isn't necessarily the current
directory at that point, and we'd like to keep the directory after the
function exits... still, it's certainly a good idea to fix directories
under $HOME and I've done that in the patch.

> Regarding keymaps ... it might be helpful if the explanatory text were
> to recommend choosing the emacs keymap, as that's the one assumed by
> most of the completion system initialization and the one most similar
> to other line editors (e.g. bash/readline).

This is the message you get when you enter the appropriate menu, so it's
explained... but maybe I could set the initial state to "Recommended" and
the default so that it picks "bindkey -e" unless you explicitly tell it not
to?  (This is what happens in the history menu---if you pick that option it
sets your HISTSIZE and SAVEHIST to 1000 unless you explicitly edit them.)


Default editing configuration
=============================

The keys in the shell's line editor can be made to behave either
like Emacs or like Vi, two common Unix editors.  If you have no
experience of either, Emacs is recommended.  If you don't pick one,
the shell will try to guess based on the EDITOR environment variable.
Usually it's better to pick one explicitly.

# (1) Change default editing configuration
# bindkey -e                                                     (no value set)

# (0) or (q)  Return to main menu (no changes made yet)

--- Type one of the keys in parentheses ---


Index: INSTALL
===================================================================
RCS file: /cvsroot/zsh/zsh/INSTALL,v
retrieving revision 1.20
diff -u -r1.20 INSTALL
--- INSTALL	23 Nov 2005 11:29:20 -0000	1.20
+++ INSTALL	24 Nov 2005 11:40:59 -0000
@@ -243,7 +243,7 @@
 /usr/local/share/zsh/<VERSION>/scripts/newuser).  This feature can be
 turned off simply by removing this script.  The module can be removed
 entirely from the configured shell by editing the line starting
-"name=zsh/newuser" int the config.modules file, which is generated in the
+"name=zsh/newuser" in the config.modules file, which is generated in the
 top level distribution directory during configuration: change the line to
 include "link=no auto=no".
 
Index: Functions/Newuser/zsh-newuser-install
===================================================================
RCS file: /cvsroot/zsh/zsh/Functions/Newuser/zsh-newuser-install,v
retrieving revision 1.2
diff -u -r1.2 zsh-newuser-install
--- Functions/Newuser/zsh-newuser-install	23 Nov 2005 11:29:21 -0000	1.2
+++ Functions/Newuser/zsh-newuser-install	24 Nov 2005 11:41:00 -0000
@@ -61,8 +61,8 @@
 trap 'save=0' HUP INT QUIT
 
 # Substitute an initial ~ for human consumption.
-if [[ $zd = $HOME ]]; then
-  zdmsg="~"
+if [[ $zd = $HOME(#b)(|/*) ]]; then
+  zdmsg="~$match[1]"
 else
   zdmsg=$zd
 fi

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


This message has been scanned for viruses by BlackSpider MailControl - www.blackspider.com

