From zsh-workers-return-10116-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Mar 13 15:02:58 2000
Return-Path: <zsh-workers-return-10116-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24074 invoked from network); 13 Mar 2000 15:02:57 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 13 Mar 2000 15:02:57 -0000
Received: (qmail 8622 invoked by alias); 13 Mar 2000 15:02:44 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10116
Received: (qmail 8085 invoked from network); 13 Mar 2000 15:01:36 -0000
Message-ID: <38CD02BC.E17A47@u.genie.co.uk>
Date: Mon, 13 Mar 2000 15:01:16 +0000
From: Oliver Kiddle <opk@u.genie.co.uk>
X-Mailer: Mozilla 4.72 [en] (Win95; I)
X-Accept-Language: en
MIME-Version: 1.0
To: Zsh workers <zsh-workers@sunsite.auc.dk>
Subject: PATCH: _source
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

The source builtin was only completing for the current directory and .
was not included in the completion.

Could someone who has been tracking all the patches please check if
gdiff is still listed in _use_lo instead of _diff. I'd submit a patch
to move it but suspect that I'm out-of-date there.

Oliver Kiddle

--- Completion/Builtins/_source.bak	Mon Mar 13 12:54:34 2000
+++ Completion/Builtins/_source	Mon Mar 13 14:38:02 2000
@@ -1,8 +1,14 @@
-#compdef source
+#compdef source .
 
 if [[ CURRENT -ge 3 ]]; then
   compset -n 2
   _normal
 else
-  _files
+  if [[ -prefix */ && ! -o pathdirs ]]; then
+    _files
+  elif [[ $words[1] = . ]]; then
+    _files -W path
+  else
+    _files -W "(. $path)"
+  fi
 fi

