From zsh-workers-request@math.gatech.edu Tue Nov 10 04:56:25 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3454 invoked from network); 10 Nov 1998 04:56:23 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 10 Nov 1998 04:56:23 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id XAA18182;
	Mon, 9 Nov 1998 23:51:50 -0500 (EST)
Resent-Date: Mon, 9 Nov 1998 23:51:50 -0500 (EST)
Message-Id: <199811100440.UAA11464@scv1.apple.com>
To: zsh-workers@math.gatech.edu
Subject: Patch for Zsh
Date: Mon, 9 Nov 1998 20:40:31 -0800
From: Wilfredo Sanchez <wsanchez@apple.com>
Reply-To: wsanchez@apple.com
Resent-Message-ID: <"Q_Ndb3.0.-R4.cPyHs"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4594
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Here is a patch to Zsh which makes the described changes.

	-Fred


Makefile.in:
 - Add install-strip target, as per GNU makefile conventions.
 - Add install.html target.

config.guess:
config.sub:
 - Add Rhapsody.

Doc/Makefile.in:
 - Add install.html target.

Src/Makefile.in:
 - Add $(STRIPFLAGS) to install line for zsh to support install-strip target.

Src/Makemod.in.in:
 - Don't create the modules directory if there are no modules to install.

Zle/zle_main.c:
 - Declare setterm, which conflicts with our libc, __private_extern__.


Index: CoreOS/Commands/Other/zsh/zsh/Makefile.in
diff -u CoreOS/Commands/Other/zsh/zsh/Makefile.in:1.1.1.2 CoreOS/Commands/Other/zsh/zsh/Makefile.in:1.5
--- CoreOS/Commands/Other/zsh/zsh/Makefile.in:1.1.1.2	Thu Nov  5 18:42:00 1998
+++ CoreOS/Commands/Other/zsh/zsh/Makefile.in	Fri Nov  6 16:08:06 1998
@@ -51,6 +51,10 @@

 # ========== DEPENDENCIES FOR INSTALLING ==========

+# install stripped
+install-strip:
+       $(MAKE) install STRIPFLAGS="-s"
+
 # install/uninstall everything
 install: install.bin install.modules install.man install.info
 uninstall: uninstall.bin uninstall.modules uninstall.man uninstall.info
@@ -69,6 +73,10 @@

 # install/uninstall just the info pages
 install.info uninstall.info:
+       @cd Doc && $(MAKE) $(MAKEDEFS) $@
+
+# install/uninstall just the html pages
+install.html uninstall.html:
        @cd Doc && $(MAKE) $(MAKEDEFS) $@

 # ========== DEPENDENCIES FOR CLEANUP ==========
Index: CoreOS/Commands/Other/zsh/zsh/config.guess
diff -u CoreOS/Commands/Other/zsh/zsh/config.guess:1.1.1.2 CoreOS/Commands/Other/zsh/zsh/config.guess:1.4
--- CoreOS/Commands/Other/zsh/zsh/config.guess:1.1.1.2	Thu Nov  5 18:42:02 1998
+++ CoreOS/Commands/Other/zsh/zsh/config.guess	Thu Nov  5 18:48:21 1998
@@ -557,6 +557,12 @@
                            # says <Richard.M.Bartel@ccMail.Census.GOV>
         echo i586-unisys-sysv4
         exit 0 ;;
+    Power*:Rhapsody:*:*)
+        echo powerpc-apple-rhapsody${UNAME_RELEASE}
+        exit 0 ;;
+    *:Rhapsody:*:*)
+        echo ${UNAME_MACHINE}-apple-rhapsody${UNAME_RELEASE}
+        exit 0 ;;
 esac

 #echo '(No uname command or uname output not recognized.)' 1>&2
Index: CoreOS/Commands/Other/zsh/zsh/config.sub
diff -u CoreOS/Commands/Other/zsh/zsh/config.sub:1.1.1.1 CoreOS/Commands/Other/zsh/zsh/config.sub:1.2
--- CoreOS/Commands/Other/zsh/zsh/config.sub:1.1.1.1	Thu Oct  2 17:15:58 1997
+++ CoreOS/Commands/Other/zsh/zsh/config.sub	Fri Oct  3 11:22:08 1997
@@ -689,7 +689,7 @@
              | -ptx* | -coff* | -ecoff* | -winnt* | -domain* | -vsta* \
              | -udi* | -eabi* | -lites* | -ieee* | -go32* | -aux* \
              | -cygwin32* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
-             | -linux* | -uxpv*)
+             | -linux* | -uxpv* | -rhapsody* )
        # Remember, each alternative MUST END IN *, to match a version number.
                ;;
        -sunos5*)
Index: CoreOS/Commands/Other/zsh/zsh/Doc/Makefile.in
diff -u CoreOS/Commands/Other/zsh/zsh/Doc/Makefile.in:1.1.1.2 CoreOS/Commands/Other/zsh/zsh/Doc/Makefile.in:1.5
--- CoreOS/Commands/Other/zsh/zsh/Doc/Makefile.in:1.1.1.2	Thu Nov  5 18:42:03 1998
+++ CoreOS/Commands/Other/zsh/zsh/Doc/Makefile.in	Fri Nov  6 16:08:08 1998
@@ -141,6 +141,10 @@
 	  else :; \
 	  fi || exit 1; \
 	done
+
+install.html: zsh_toc.html
+	$(sdir_top)/mkinstalldirs $(htmldir)
+	$(INSTALL_DATA) *.html $(htmldir)

 # uninstall man pages
 uninstall.man:
Index: CoreOS/Commands/Other/zsh/zsh/Src/Makefile.in
diff -u CoreOS/Commands/Other/zsh/zsh/Src/Makefile.in:1.1.1.2 CoreOS/Commands/Other/zsh/zsh/Src/Makefile.in:1.2
--- CoreOS/Commands/Other/zsh/zsh/Src/Makefile.in:1.1.1.2	Thu Nov  5 18:42:06 1998
+++ CoreOS/Commands/Other/zsh/zsh/Src/Makefile.in	Fri Nov  6 16:08:09 1998
@@ -139,7 +139,7 @@
 # install binary, creating install directory if necessary
 install.bin-here: zsh install.bin-@L@
 	$(sdir_top)/mkinstalldirs $(bindir)
-	$(INSTALL_PROGRAM) zsh $(bindir)/zsh-$(VERSION)
+	$(INSTALL_PROGRAM) $(STRIPFLAGS) zsh $(bindir)/zsh-$(VERSION)
 	if test -f $(bindir)/zsh; then \
 	    rm -f $(bindir)/zsh.old; \
 	    ln $(bindir)/zsh $(bindir)/zsh.old; \
Index: CoreOS/Commands/Other/zsh/zsh/Src/Makemod.in.in
diff -u CoreOS/Commands/Other/zsh/zsh/Src/Makemod.in.in:1.1.1.1 CoreOS/Commands/Other/zsh/zsh/Src/Makemod.in.in:1.2
--- CoreOS/Commands/Other/zsh/zsh/Src/Makemod.in.in:1.1.1.1	Thu Nov  5 18:42:06 1998
+++ CoreOS/Commands/Other/zsh/zsh/Src/Makemod.in.in	Mon Nov  9 20:00:54 1998
@@ -119,8 +119,9 @@
 install.bin-here uninstall.bin-here:

 install.modules-here:
-	$(sdir_top)/mkinstalldirs $(MODDIR)
-	modules='$(MODULES)'; for mod in $$modules; do \
+	modules='$(MODULES)'; \
+	if test -n "$$modules"; then $(sdir_top)/mkinstalldirs $(MODDIR); fi; \
+	for mod in $$modules; do \
 	    $(INSTALL_PROGRAM) $$mod $(MODDIR)/$$mod; \
 	done

Index: CoreOS/Commands/Other/zsh/zsh/Src/Zle/zle_main.c
diff -u CoreOS/Commands/Other/zsh/zsh/Src/Zle/zle_main.c:1.1.1.1 CoreOS/Commands/Other/zsh/zsh/Src/Zle/zle_main.c:1.2
--- CoreOS/Commands/Other/zsh/zsh/Src/Zle/zle_main.c:1.1.1.1	Thu Nov  5 18:42:15 1998
+++ CoreOS/Commands/Other/zsh/zsh/Src/Zle/zle_main.c	Fri Nov  6 16:08:13 1998
@@ -110,6 +110,9 @@

 /* set up terminal */

+#ifdef __APPLE__
+__private_extern__
+#endif
 /**/
 void
 setterm(void)

---
	      Wilfredo Sanchez | wsanchez@apple.com | 408.974-5174
	Apple Computer, Inc., 1 Infinite Loop 302.4K, Cupertino, CA 95014
	          (Mac OS X) Core Operating Systems Group | BSD

