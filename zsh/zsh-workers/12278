From zsh-workers-return-12278-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Jul 17 14:57:07 2000
Return-Path: <zsh-workers-return-12278-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 11349 invoked from network); 17 Jul 2000 14:57:06 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Jul 2000 14:57:06 -0000
Received: (qmail 5209 invoked by alias); 17 Jul 2000 14:56:53 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12278
Received: (qmail 5201 invoked from network); 17 Jul 2000 14:56:52 -0000
Date: Mon, 17 Jul 2000 15:56:50 +0100
From: Adam Spiers <adam@spiers.net>
To: zsh-workers@sunsite.auc.dk
Subject: Re: adding a toplevel zsh.spec.in file
Message-ID: <20000717155650.A6739@thelonious.new.ox.ac.uk>
Reply-To: Adam Spiers <adam@spiers.net>
Mail-Followup-To: zsh-workers@sunsite.auc.dk
References: <20000707125317.A1626@thelonious.new.ox.ac.uk> <m2hfa1lxwv.fsf@cassini.us.mandrakesoft.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 1.0.1i
In-Reply-To: <m2hfa1lxwv.fsf@cassini.us.mandrakesoft.com>; from chmouel@mandrakesoft.com on Fri, Jul 07, 2000 at 09:15:12AM -0700
X-Home-Page: http://www.new.ox.ac.uk/~adam/
X-OS: RedHat Linux

Chmouel Boudjnah (chmouel@mandrakesoft.com) wrote:
> Be careful you'll have by the way need to fight with the
> RPM_BUILD_ROOT in the %install :
> 
> --- zsh-3.1.9/Src/zsh.mdd.chmou Tue Jul  4 10:06:32 2000
> +++ zsh-3.1.9/Src/zsh.mdd       Tue Jul  4 10:54:11 2000
> @@ -53,8 +53,10 @@
>             rm -f zshpaths.h.tmp; \
>             echo "\`zshpaths.h' is up to date." ; \
>         else \
> +           if [ ! -f .in_rpm_install ]; then \
>             mv -f zshpaths.h.tmp zshpaths.h; \
>             echo "Updated \`zshpaths.h'." ; \
> +           fi; \
>         fi
>  
>  bltinmods.list: modules.stamp modules-bltin xmods.conf mkbltnmlst.sh
> 
> and this in %install :
> 
> # Zsh hardcode the prefix in binary even at install.
> pushd Src/ && {
>     touch .in_rpm_install
>     %makeinstall
> } && popd

Are you sure?  I've built many rpms of zsh in the past, and if you're
talking about the problem I think you are, I got around them by using
DESTDIR:

%install
rm -rf $RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT/usr/info $RPM_BUILD_ROOT/bin $RPM_BUILD_ROOT/etc $RPM_B
UILD_ROOT/etc/zprofile.d $RPM_BUILD_ROOT/usr/bin $RPM_BUILD_ROOT/usr/lib $RPM_BU
ILD_ROOT/usr/doc/zsh-%{version}

make DESTDIR=$RPM_BUILD_ROOT install
make DESTDIR=$RPM_BUILD_ROOT install.modules
make DESTDIR=$RPM_BUILD_ROOT install.info

