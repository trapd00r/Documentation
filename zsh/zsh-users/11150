From zsh-users-return-11150-mason-zsh=primenet.com.au@sunsite.dk Sun Jan 28 20:06:17 2007
Return-Path: <zsh-users-return-11150-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13207 invoked from network); 28 Jan 2007 20:06:12 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 28 Jan 2007 20:06:12 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 75087 invoked from network); 28 Jan 2007 20:06:06 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Jan 2007 20:06:05 -0000
Received: (qmail 29972 invoked by alias); 28 Jan 2007 20:05:56 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11150
Received: (qmail 29963 invoked from network); 28 Jan 2007 20:05:56 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 28 Jan 2007 20:05:56 -0000
Received: (qmail 73898 invoked from network); 28 Jan 2007 20:05:56 -0000
Received: from vms042pub.verizon.net (206.46.252.42)
  by a.mx.sunsite.dk with SMTP; 28 Jan 2007 20:05:49 -0000
Received: from torch.brasslantern.com ([71.116.79.148])
 by vms042.mailsrvcs.net (Sun Java System Messaging Server 6.2-6.01 (built Apr
 3 2006)) with ESMTPA id <0JCL003E9H5BKKE9@vms042.mailsrvcs.net> for
 zsh-users@sunsite.dk; Sun, 28 Jan 2007 14:05:37 -0600 (CST)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id l0SK5Y5D000732; Sun,
 28 Jan 2007 12:05:34 -0800
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id l0SK5XoI000731; Sun, 28 Jan 2007 12:05:33 -0800
Date: Sun, 28 Jan 2007 12:05:33 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: zsh handling of non-standard if-evaluations
In-reply-to: <184104.7951.qm@web36811.mail.mud.yahoo.com>
To: Daniel Qarras <dqarras@yahoo.com>, zsh-users@sunsite.dk
Message-id: <070128120533.ZM730@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <184104.7951.qm@web36811.mail.mud.yahoo.com>
Comments: In reply to Daniel Qarras <dqarras@yahoo.com>
 "Re: zsh handling of non-standard if-evaluations" (Jan 28, 11:00am)

On Jan 28, 11:00am, Daniel Qarras wrote:
}
} Hmm, my login shell is zsh and I've set in my ~/.zshenv:
} 
} . /etc/profile
} 
} which in turns goes thru /etc/profile.d/*.sh and one of those scripts
} is from the proprietary application. So perhaps I should do "setopt
} no_equals" before the above mentioned line?

Generally speaking ~/.zshenv is too early in the startup script order
to be reading /etc/profile from there.  If you need to read /etc/profile
you should do it from ~/.zprofile.

As I said before, reading /etc/profile should be done with "emulate sh"
in effect.  Unfortunately "emulate zsh" doesn't fully reverse the effect
of "emulate sh", because emulation turns off options that differ from
the defaults no matter which shell is being emulated.  So to get back to
your original state, you need something like this:

    zmodload -i zsh/parameter && {
      __zsh=( ${(kv)options} )
      emulate sh
      . /etc/profile
      emulate zsh
      options=( $__zsh )
      unset __zsh
    }

This has the side-effect of vacating any option settings from any scripts
in /etc/profile.d that happen to know about zsh, but I think of that as a 
good thing.

