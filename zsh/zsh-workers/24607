From zsh-workers-return-24607-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 27 01:43:56 2008
Return-Path: <zsh-workers-return-24607-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7055 invoked from network); 27 Feb 2008 01:43:54 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 27 Feb 2008 01:43:54 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 89041 invoked from network); 27 Feb 2008 01:43:45 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 27 Feb 2008 01:43:45 -0000
Received: (qmail 26805 invoked by alias); 27 Feb 2008 01:43:42 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24607
Received: (qmail 26783 invoked from network); 27 Feb 2008 01:43:41 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 27 Feb 2008 01:43:41 -0000
Received: from n35.bullet.mail.ukl.yahoo.com (n35.bullet.mail.ukl.yahoo.com [87.248.110.168])
	by bifrost.dotsrc.org (Postfix) with SMTP id BF02B802720E
	for <zsh-workers@sunsite.dk>; Wed, 27 Feb 2008 02:43:37 +0100 (CET)
Received: from [217.146.182.179] by n35.bullet.mail.ukl.yahoo.com with NNFMP; 27 Feb 2008 01:43:37 -0000
Received: from [87.248.111.151] by t5.bullet.ukl.yahoo.com with NNFMP; 27 Feb 2008 01:43:37 -0000
Received: from [127.0.0.1] by omp208.mail.ukl.yahoo.com with NNFMP; 27 Feb 2008 01:43:37 -0000
X-Yahoo-Newman-Id: 277196.10910.bm@omp208.mail.ukl.yahoo.com
Received: (qmail 48577 invoked from network); 26 Feb 2008 17:37:02 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.co.uk;
  h=Received:X-YMail-OSG:X-Yahoo-Newman-Property:Received:In-reply-to:From:References:To:Subject:Date:Message-ID;
  b=4LZbggKwiYplFqEs0QL6UZXxyrzX0k29dVyeGGRtAUipO6eLd4F4gYIS38CmbOz1PLf/RGEXR46o/709jCvm+YIETSZB0GAP+KKgZcmjuBJDe6i1z5hoHzlr7oy6jUucc8b9IPgTZGfvxztWQw/yJoOmGXN7akwD8X7UZ7odPm0=  ;
Received: from unknown (HELO thecus) (okiddle@89.48.26.61 with plain)
  by smtp003.mail.ukl.yahoo.com with SMTP; 26 Feb 2008 17:36:59 -0000
X-YMail-OSG: WHbN6xYVM1lxHT3rKo3SMQbwAp_ik_dCwu4ukSg68ua3UHT34J4rOzfDc3RC_sHbMyNkulO2WA--
X-Yahoo-Newman-Property: ymail-3
Received: from opk (helo=thecus)
	by thecus with local-esmtp (Exim 4.63)
	(envelope-from <okiddle@yahoo.co.uk>)
	id 1JU3jg-0004vg-DA; Tue, 26 Feb 2008 18:37:00 +0100
In-reply-to: <200802261610.m1QGAwJ3008939@news01.csr.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <8AABEECB-A9A6-43EA-BED2-4BE376CBE349@blastwave.org> <20080226141459.76dc362c@news01> <BD1EA7D6-C784-4ED9-9558-5B655CBC5096@blastwave.org> <20080226145741.6e74fc22@news01> <656429B3-438B-4ECF-85C4-04E38D837D1A@blastwave.org> <200802261610.m1QGAwJ3008939@news01.csr.com>
To: Dagobert Michelsen <dam@blastwave.org>, zsh-workers@sunsite.dk
Subject: Re: * Re: Failed tests of zsh 4.3.5 in Solaris 10 w/Sun Studio 12 CC
Date: Tue, 26 Feb 2008 18:37:00 +0100
Message-ID: <18951.1204047420@thecus>
X-Virus-Scanned: ClamAV 0.91.2/6006/Wed Feb 27 02:03:40 2008 on bifrost
X-Virus-Status: Clean

Peter wrote:
> > Is this an error from zsh or is this a bug in libiconv?

It's actually better to avoid using libiconv and stick to the builtin
iconv on Solaris. It handles 646 correctly. I always make a point of
making sure it doesn't find GNU libiconv when compiling.

> +		    if (!codessetstr || !*codsetstr ||
> +			!strcmp(codesetstr, "646"))
> +			codesetstr == "US-ASCII";

Is the last line of this correct? Isn't it meant to be an assignment?

I would be inclined to wrap the whole thing inside #ifdef
_libiconv_version because the problem only occurs when using GNU iconv
instead of the Solaris builtin one.

Oliver

