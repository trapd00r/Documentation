From zsh-workers-return-18491-mason-zsh=primenet.com.au@sunsite.dk Wed Apr 30 15:55:50 2003
Return-Path: <zsh-workers-return-18491-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12442 invoked from network); 30 Apr 2003 15:55:49 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 30 Apr 2003 15:55:49 -0000
Received: (qmail 16995 invoked by alias); 30 Apr 2003 15:55:44 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18491
Received: (qmail 16987 invoked from network); 30 Apr 2003 15:55:43 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 30 Apr 2003 15:55:43 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [192.54.253.222] by sunsite.dk (MessageWall 1.0.8) with SMTP; 30 Apr 2003 15:55:43 -0000
Received: by binome.blorf.net (Postfix, from userid 1000)
	id DE88BA738; Wed, 30 Apr 2003 08:55:25 -0700 (PDT)
Date: Wed, 30 Apr 2003 08:55:25 -0700
From: Wayne Davison <wayned@users.sourceforge.net>
To: Andrey Borzenkov <arvidjaar@mail.ru>
Cc: zsh-workers@sunsite.dk
Subject: Re: PATCH: fix menu completion on terminal with do=^J/without do
Message-ID: <20030430155525.GA5843@binome.blorf.net>
References: <200304271249.49111.arvidjaar@mail.ru>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <200304271249.49111.arvidjaar@mail.ru>
User-Agent: Mutt/1.4.1i

On Sun, Apr 27, 2003 at 12:49:49PM +0400, Andrey Borzenkov wrote:
> The patch exports tc_downcurs and makes complist using it.

Yes, this seems to be the right thing to do.  Because the init_term()
code may have completely disabled all known downward-motion capabilities
(when it removed "do=^J"), zsh must always call tc_downcurs(ct) instead
of trying to call tcmultout(TCDOWN, TCMULTDOWN, ct) directly.  It must
also be prepared to handle a non-zero return code which indicates that
the cursor has moved to column 0.

In the case of your patch, it appears that the calling code always
returns the cursor to column 0 before calling tc_downcurs(), so I
believe your patch to be the right fix.

..wayne..

