From zsh-workers-return-19324-mason-zsh=primenet.com.au@sunsite.dk Fri Dec 19 08:55:27 2003
Return-Path: <zsh-workers-return-19324-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5219 invoked from network); 19 Dec 2003 08:55:26 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 19 Dec 2003 08:55:26 -0000
Received: (qmail 12216 invoked by alias); 19 Dec 2003 08:55:20 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19324
Received: (qmail 12166 invoked from network); 19 Dec 2003 08:55:20 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 19 Dec 2003 08:55:20 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [193.109.254.211] by sunsite.dk (MessageWall 1.0.8) with SMTP; 19 Dec 2003 8:55:20 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-8.tower-36.messagelabs.com!1071824118!2609957
X-StarScan-Version: 5.1.15; banners=-,-,-
Received: (qmail 3040 invoked from network); 19 Dec 2003 08:55:18 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-8.tower-36.messagelabs.com with SMTP; 19 Dec 2003 08:55:18 -0000
Received: from gmcs3.local ([158.234.142.61])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id hBJ8tHuB028072
	for <zsh-workers@sunsite.dk>; Fri, 19 Dec 2003 08:55:18 GMT
Received: from gmcs3.local (localhost [127.0.0.1])
	by gmcs3.local (8.11.6/8.11.6/SuSE Linux 0.5) with ESMTP id hBJ8xVA03818
	for <zsh-workers@sunsite.dk>; Fri, 19 Dec 2003 09:59:31 +0100
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <27087.1071767130@csr.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <27087.1071767130@csr.com>
To: zsh-workers@sunsite.dk (Zsh hackers list)
Subject: autoconf 2.5 (Re: PATCH: terminfo horor) 
Date: Fri, 19 Dec 2003 09:59:31 +0100
Message-ID: <3816.1071824371@gmcs3.local>

This line of the patch looks suspicious:

+link='if test "x$ac_cv_func_tigetstr" = xyes -a "x$ac_cv_header_curses_h"; then

Testing just "x$ac_cv_header_curses_h" will always be true. Did you
intend an ` = xyes' or ` = xno' in there?

With SuSE 7.3, the patch was fine.

On my Debian testing system it solves the ERR problem but I found that
it would never build the terminfo module regardless of whether or not I
used the --with-curses-terminfo option. This turned out to be a quite
separate and largely unrelated problem.

The configure script is creating config.modules twice. Second time
round when evaluating $link using the code in terminfo.mdd,
$ac_cv_func_tigetstr was unset. It seems the configure script runs
config.status. By running configure with --no-create, it was happy to
build terminfo.so. Switching from autoconf 2.57 to 2.13 also solved the
issue.

configure cats config.modules.sh into config.status using
AC_OUTPUT_COMMANDS which is obsolete in autoconf 2.5. Using the new
AC_CONFIG_COMMANDS doesn't help because variables like
$ac_cv_func_tigetstr are still not set.

Does anyone understand the real point of config.status? Why does
configure need to run it? I get the impression that it should contain
just a duplicate of what is in config.modules as created and recreate
it as opposed to rerunning scripts to derive its contents.

We really ought to ditch support for autoconf 2.13 in the 4.1 branch.
Not having a mixture will just make things simpler.

Oliver

