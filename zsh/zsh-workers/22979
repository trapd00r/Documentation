From zsh-workers-return-22979-mason-zsh=primenet.com.au@sunsite.dk Tue Nov 07 18:46:57 2006
Return-Path: <zsh-workers-return-22979-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29500 invoked from network); 7 Nov 2006 18:46:52 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.7
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 7 Nov 2006 18:46:52 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 41967 invoked from network); 7 Nov 2006 18:46:46 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 7 Nov 2006 18:46:46 -0000
Received: (qmail 7977 invoked by alias); 7 Nov 2006 18:46:44 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22979
Received: (qmail 7968 invoked from network); 7 Nov 2006 18:46:43 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 7 Nov 2006 18:46:43 -0000
Received: (qmail 41688 invoked from network); 7 Nov 2006 18:46:43 -0000
Received: from cluster-c.mailcontrol.com (168.143.177.190)
  by a.mx.sunsite.dk with SMTP; 7 Nov 2006 18:46:39 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly07c.srv.mailcontrol.com (MailControl) with ESMTP id kA7IkYN7005268
	for <zsh-workers@sunsite.dk>; Tue, 7 Nov 2006 18:46:34 GMT
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Tue, 7 Nov 2006 18:46:33 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.7/8.13.4) with ESMTP id kA7IkXP1012198
	for <zsh-workers@sunsite.dk>; Tue, 7 Nov 2006 18:46:33 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.7/8.13.7/Submit) with ESMTP id kA7IkXHx012195
	for <zsh-workers@sunsite.dk>; Tue, 7 Nov 2006 18:46:33 GMT
Message-Id: <200611071846.kA7IkXHx012195@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: "Zsh hackers list" <zsh-workers@sunsite.dk>
Subject: Re: Hooks 
In-reply-to: <061107091449.ZM1096@torch.brasslantern.com> 
References: <5db995410611060845y53f673e6je029a9c60659f116@mail.gmail.com> <20061106174053.GA4323@sc> <5db995410611061314l26e089b8wb214da46064c8235@mail.gmail.com> <20061106215051.GB4323@sc> <Pine.OSX.4.61.0611061617370.1112@vanunu.ucsc.edu> <20061107081800.GA4420@sc> <20061107104916.d01e2fa5.pws@csr.com> <dbfc82860611070711u322a6948m675ef9a38d097717@mail.gmail.com> <061107091449.ZM1096@torch.brasslantern.com>
Comments: In-reply-to Bart Schaefer <schaefer@brasslantern.com>
   message dated "Tue, 07 Nov 2006 09:14:49 -0800."
Date: Tue, 07 Nov 2006 18:46:33 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 07 Nov 2006 18:46:33.0724 (UTC) FILETIME=[0BF783C0:01C7029D]
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A-07-06-75 (www.mailcontrol.com) on 10.67.0.117

Bart Schaefer wrote:
> For example, if one of the functions causes an error condition (the
> sort of thing that would jump to the final clause of an "always" block)
> is the whole chain aborted, or only the one function?

Currently we don't reset the errflag.  In some cases (precmd and
periodic) we abort all precommand processing on a failure: this is how
it has always worked, for suitable values of "always", in the case of
chained activities before a prompt.  This probably needs to be
documented, however it works.

> Related but more subtle, if a function returns a non-zero status,
> should that affect the rest of the functions in the array in any way?
> Put another way, are there rules for cascading the hooks?

I thought of this, but decided it wasn't that helpful.  The whole point
of being able to do this automatically is that you shouldn't care what
other functions are doing.  However, maybe there's a counterexample.

> And what is the value of "$@" when these functions are called?  Does
> is differ depending on which hook array they're in?  (The signatures
> of preexec, precmd, and chpwd are quite different.)

It's the same as the currently defined function for that context.
That seems the only sensible way of doing it.

> I'd suggest that, at least as a first pass, rather than coded up in C,
> this be implmented with a few functions distributed in Functions/Misc
> and designed to be installed as preexec, precmd, and/or chpwd.

Certainly I could mimic the current system in shell functions, but I'm
not sure what that gains: the whole point of doing it in C is that you
can rely on it always being there.  I will certainly consider changes to
the current system.

I made one screwup: preexec_functions aren't handled unless preexec
exists as well.  I've used a different optimisation to avoid needing the
argument handling if there's nothing to do.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


To access the latest news from CSR copy this link into a web browser:  http://www.csr.com/email_sig.php

