From zsh-workers-return-10768-mason-zsh=primenet.com.au@sunsite.auc.dk Sat Apr 15 14:07:29 2000
Return-Path: <zsh-workers-return-10768-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3587 invoked from network); 15 Apr 2000 14:07:27 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 Apr 2000 14:07:27 -0000
Received: (qmail 24079 invoked by alias); 15 Apr 2000 14:07:15 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10768
Received: (qmail 24054 invoked from network); 15 Apr 2000 14:07:12 -0000
Date: Sat, 15 Apr 2000 10:06:32 -0400
From: Clint Adams <schizo@debian.org>
To: Zefram <zefram@fysh.org>
Cc: Anthony Schneider <aschneid@mail.slc.edu>, zsh-workers@sunsite.auc.dk
Subject: PATCH: OpenBSD dl configure test ld flags
Message-ID: <20000415100632.A8466@scowler.net>
References: <20000414135110.A27516@mail.slc.edu> <E12gS62-0002my-00@crucigera.fysh.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
User-Agent: Mutt/1.0.1i
In-Reply-To: <E12gS62-0002my-00@crucigera.fysh.org>; from zefram@fysh.org on Sat, Apr 15, 2000 at 01:54:46PM +0100

> This is interesting.  It indicates that, despite finding dlopen() et al,
> the configure process failed to actually perform a dynamic loading and
> symbol lookup.  Can you diagnise it further?

I get the same thing under OpenBSD 2.2.  This seems to help:


Index: configure.in
===================================================================
RCS file: /cvsroot/zsh/zsh/configure.in,v
retrieving revision 1.5
diff -u -r1.5 configure.in
--- configure.in	2000/04/13 23:11:54	1.5
+++ configure.in	2000/04/15 14:01:46
@@ -1485,6 +1485,7 @@
     netbsd*)      DLLDFLAGS="${DLLDFLAGS=${DLLDARG}-x -shared --whole-archive}" ;;
     aix*)         DLLDFLAGS="${DLLDFLAGS=-G -bexpall -lc}" ;;
     solaris*|sysv4*|esix*) DLLDFLAGS="${DLLDFLAGS=-G}" ;;
+    openbsd*)     DLLDFLAGS="${DLLDFLAGS=-Bshareable}" ;;
   esac
   case "$host" in
     *-hpux*)  EXTRA_LDFLAGS="${EXTRA_LDFLAGS=-Wl,-E}" ;;

