From zsh-users-return-4699-mason-zsh=primenet.com.au@sunsite.dk Tue Feb 26 19:21:52 2002
Return-Path: <zsh-users-return-4699-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13235 invoked from network); 26 Feb 2002 19:21:51 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 26 Feb 2002 19:21:51 -0000
Received: (qmail 21569 invoked by alias); 26 Feb 2002 19:21:34 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4699
Received: (qmail 21555 invoked from network); 26 Feb 2002 19:21:32 -0000
Date: Tue, 26 Feb 2002 11:21:19 -0800 (PST)
From: Bart Schaefer <schaefer@brasslantern.com>
Sender: <schaefer@ns1.sodaware.com>
To: Ian Lynagh <igloo@earth.li>
cc: <zsh-users@sunsite.dk>
Subject: Re: Length of %? in prompt
In-Reply-To: <20020226184213.GA16659@stu163.keble.ox.ac.uk>
Message-ID: <Pine.LNX.4.33.0202261047240.14523-100000@ns1.sodaware.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Tue, 26 Feb 2002, Ian Lynagh wrote:

> One more thing...as the first % escapes the second in
> "%%1v>-->%?---------%<< " it looks like there is no way to change this
> value on the fly without recreating the prompt - is this correct?

If you "setopt promptsubst" you can use a variable for the width:

setopt promptsubst
W=5
PS1='%$W>-->%?----------%<< '

You just have to make sure there are as many hyphens in the truncate
region as the largest value you ever expect to assign to W.

If for some other reason you want to avoid promptsubst, you will have to
recreate the prompt, or at least recreate one of the psvar values like
this:

W=5
PS1='%1v '
precmd {
  psvar[1]=${(%%):-%$W>-->%?----------%<<}
}

Just be sure that the prompt expansion of %? is the first thing in precmd,
or else it'll get the exit status of whatever other commands appear in
precmd rather than the exit status of the last interactive command.

