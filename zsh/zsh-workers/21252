From zsh-workers-return-21252-mason-zsh=primenet.com.au@sunsite.dk Tue May 10 18:38:30 2005
Return-Path: <zsh-workers-return-21252-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14783 invoked from network); 10 May 2005 18:38:29 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 10 May 2005 18:38:29 -0000
Received: (qmail 26047 invoked from network); 10 May 2005 18:38:23 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 May 2005 18:38:23 -0000
Received: (qmail 9108 invoked by alias); 10 May 2005 18:38:20 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21252
Received: (qmail 8567 invoked from network); 10 May 2005 18:36:37 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 10 May 2005 18:36:37 -0000
Received: (qmail 24643 invoked from network); 10 May 2005 18:36:37 -0000
Received: from www.ostsee-abc.de (HELO hydra.bec.de) (62.206.222.50)
  by a.mx.sunsite.dk with SMTP; 10 May 2005 18:36:33 -0000
Received: from britannica.bec.de (storm.stura.uni-rostock.de [139.30.252.72])
	by hydra.bec.de (Postfix) with ESMTP id EB02535707
	for <zsh-workers@sunsite.dk>; Tue, 10 May 2005 20:36:30 +0200 (CEST)
Received: by britannica.bec.de (Postfix, from userid 1001)
	id 613F77D12; Tue, 10 May 2005 20:36:09 +0200 (CEST)
Date: Tue, 10 May 2005 20:36:09 +0200
From: Joerg Sonnenberger <joerg@britannica.bec.de>
To: zsh-workers@sunsite.dk
Subject: DragonFly support
Message-ID: <20050510183609.GA60490@britannica.bec.de>
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="lrZ03NoBR/3+SXJZ"
Content-Disposition: inline
User-Agent: Mutt/1.5.9i
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6


--lrZ03NoBR/3+SXJZ
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hi zsh hackers,
attached are a few patches against 4.2.5 for DragonFly, it would
be nice if they could be included in the next (4.2.x) release.

The patch for the pkg tools completion might be better left out,
since both ports and pkgsrc are used on DragonFly.

Joerg

P.S.: Please CC me, I'm not subscribed.

--lrZ03NoBR/3+SXJZ
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename=patch-configure

--- configure.orig	2005-04-04 11:49:26.000000000 +0200
+++ configure	2005-05-10 00:02:26.000000000 +0200
@@ -15747,7 +15747,7 @@
     esac
   fi
   case "$host_os" in
-    freebsd*|linux*|irix*|osf*|gnu*) DLLDFLAGS="${DLLDFLAGS=-shared}" ;;
+    freebsd*|linux*|irix*|osf*|gnu*|dragonfly*) DLLDFLAGS="${DLLDFLAGS=-shared}" ;;
     sunos*)       DLLDFLAGS="${DLLDFLAGS=-assert nodefinitions}" ;;
     sysv4*|esix*) DLLDFLAGS="${DLLDFLAGS=-G $ldflags}" ;;
     netbsd*)      DLLDFLAGS="${DLLDFLAGS=${DLLDARG}-x -shared --whole-archive}" ;;

--lrZ03NoBR/3+SXJZ
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="patch-Completion::BSD::Command::_bsd_pkg"

--- Completion/BSD/Command/_bsd_pkg.orig	2005-05-09 23:55:33.000000000 +0200
+++ Completion/BSD/Command/_bsd_pkg	2005-05-09 23:56:46.000000000 +0200
@@ -5,7 +5,7 @@
   local ret=1 paths portsdir pkgsdir
 
   case $OSTYPE in
-  netbsd*)
+  netbsd* | dragonfly*)
     portsdir=/usr/pkgsrc
     ;;
   *)
@@ -65,7 +65,7 @@
         '-r[fetch from remote site]'
       )
       ;;
-    netbsd*)
+    netbsd* | dragonfly*)
       flags=(
 	$flags[@]
 	'-u[update]'
@@ -110,7 +110,7 @@
 	'*:package file name:_files'
       )
       ;;
-    netbsd*)
+    netbsd* | dragonfly*)
       # NetBSD users, improve me!
       flags=(
 	'*:package name:_bsd_pkg_pkgs'
@@ -143,7 +143,7 @@
         '-x[use regular expression]'
       )
       ;;
-    netbsd*)
+    netbsd* | dragonfly*)
       flags=(
 	$flags[@]
 	'(:)-a[delete all installed packages]'
@@ -196,7 +196,7 @@
 	'-x[use regular expression]'
       )
       ;;
-    netbsd*)
+    netbsd* | dragonfly*)
       flags=(
 	$flags[@]
 	'-B[show build information]'

--lrZ03NoBR/3+SXJZ
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="patch-Completion::BSD::Command::_chflags"

--- Completion/BSD/Command/_chflags.orig	2005-05-09 23:55:24.000000000 +0200
+++ Completion/BSD/Command/_chflags	2005-05-09 23:55:03.000000000 +0200
@@ -25,7 +25,7 @@
   unset own
 fi
 
-if [[ $OSTYPE = freebsd* ]]; then
+if [[ $OSTYPE = freebsd* || $OSTYPE = dragonfly* ]]; then
   flags=( $flags[@]
     '(nouunlnk)uunlnk[set the user undeletable flag]'
     '(uunlnk)nouunlnk[unset the user undeletable flag]'

--lrZ03NoBR/3+SXJZ
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="patch-Completion::Unix::Command::_apm"

--- Completion/Unix/Command/_apm.orig	2005-05-09 23:57:43.000000000 +0200
+++ Completion/Unix/Command/_apm	2005-05-09 23:58:44.000000000 +0200
@@ -11,7 +11,7 @@
     '(-n --noignore)'{-n,--noignore}'[tell the system not to ignore system-generated APM message]' \
     '(-i --ignore)'{-i,--ignore}'[tell the system to ignore system-generated APM message]' && return
 
-elif [[ $OSTYPE == freebsd* ]]; then
+elif [[ $OSTYPE == freebsd* || $OSTYPE = dragonfly* ]]; then
 
   _arguments \
     '-a[display AC line status]' \

--lrZ03NoBR/3+SXJZ
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="patch-Completion::Unix::Command::_cvs"

--- Completion/Unix/Command/_cvs.orig	2005-05-09 23:57:52.000000000 +0200
+++ Completion/Unix/Command/_cvs	2005-05-09 23:59:19.000000000 +0200
@@ -7,7 +7,7 @@
 
   # "+Qqrwtnlvb:T:e:d:Hfz:s:xa"
   case $OSTYPE in
-  freebsd*|openbsd*)
+  freebsd*|openbsd*|dragonfly*)
     extra='-R[read only access]'
     ;;
   esac

--lrZ03NoBR/3+SXJZ
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="patch-Completion::Unix::Command::_ifconfig"

--- Completion/Unix/Command/_ifconfig.orig	2005-05-09 23:57:59.000000000 +0200
+++ Completion/Unix/Command/_ifconfig	2005-05-09 23:58:49.000000000 +0200
@@ -19,7 +19,7 @@
       {,-}trailers {,-}link{0,1,2}
     )
   ;;
-  freebsd*)
+  freebsd* | dragonfly*)
     args=( -s $updown
       '(-a -l -u -d -m -L 1 *)-C[list interface cloners]'
       '(-l -C)-m[list supported media]'

--lrZ03NoBR/3+SXJZ
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="patch-Completion::Unix::Command::_mount"

--- Completion/Unix/Command/_mount.orig	2005-05-09 23:58:03.000000000 +0200
+++ Completion/Unix/Command/_mount	2005-05-09 23:59:50.000000000 +0200
@@ -471,7 +471,7 @@
       'swidth[specify stripe width]:size'
     )
     ;;
-  freebsd*)
+  freebsd*|dragonfly*)
     _fs_any=(
       '(sync)async[do all I/O asynchronously]'
       'current[use current options on already mounted file system]'
@@ -626,7 +626,7 @@
     deffs=hsfs
     typeops=-F
     ;;
-  freebsd*)
+  freebsd*|dragonfly*)
     args=( -s
       '(:)-a[mount all filesystems in fstab]'
       '-d[cause everything to be done except for the actual system call]'      
@@ -700,7 +700,7 @@
 	'*:dev or dir:->udevordir'
       )
     ;;
-    freebsd*)
+    freebsd*|dragonfly*)
       args=(
 	'(*)-a[unmount all mounted file systems]'
 	'-A[unmount all mounted file systems except the root]'
@@ -762,7 +762,7 @@
   fi
 
   case "$OSTYPE" in
-  freebsd*)
+  freebsd*|dragonfly*)
     while read mline; do 
       case $mline[(w)1] in
 	\#* )

--lrZ03NoBR/3+SXJZ
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="patch-Completion::Unix::Command::_mt"

--- Completion/Unix/Command/_mt.orig	2005-05-09 23:58:35.000000000 +0200
+++ Completion/Unix/Command/_mt	2005-05-09 23:57:23.000000000 +0200
@@ -44,7 +44,7 @@
     'densities:explain some common density codes'
     'datcompression:enquire or set compression status'
   )
-elif [[ $OSTYPE = freebsd* ]]; then
+elif [[ $OSTYPE = freebsd* || $OSTYPE = dragonfly* ]]; then
   cmds=( ${cmds:#(asf|eof):*}
     'smk:write specified number of setmarks at current position'
     'fss:forward space by specified number of setmarks'

--lrZ03NoBR/3+SXJZ
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="patch-Completion::Unix::Command::_sysctl"

--- Completion/Unix/Command/_sysctl.orig	2005-05-09 23:58:13.000000000 +0200
+++ Completion/Unix/Command/_sysctl	2005-05-09 23:58:54.000000000 +0200
@@ -13,7 +13,7 @@
       '(-o)-x[show opaques as well (entire values)]' \
       '(-a)*:sysctl variable:_multi_parts -i . sysctlvars'
   ;;
-  freebsd[0-4].*|darwin*)
+  freebsd[0-4].*|darwin*|dragonfly*)
     : ${(A)_cache_sysctlvars:=${${$(sysctl -A 2>/dev/null):#[^a-z]*}%%:*}}
     _arguments -s -A "-*" \
       '(-w -X *)-a[list all]' \

--lrZ03NoBR/3+SXJZ
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="patch-Completion::Unix::Type::_file_systems"

--- Completion/Unix/Type/_file_systems.orig	2005-05-09 23:58:17.000000000 +0200
+++ Completion/Unix/Type/_file_systems	2005-05-10 00:00:42.000000000 +0200
@@ -16,9 +16,9 @@
   ;;
   osf*) fss=( advfs ufs nfs mfs cdfs ) ;;
   solaris*) fss=( ufs nfs hsfs s5fs pcfs cachefs tmpfs ) ;;
-  freebsd*)
+  freebsd*|dragonfly*)
     fss=( cd9660 devfs ext2fs fdesc kernfs linprocfs mfs msdos nfs 
-          ntfs null nwfs portal procfs std ufs umap union )
+          ntfs null nwfs portal procfs std udf ufs umap union )
   ;;
   *)
     # default for all other systems

--lrZ03NoBR/3+SXJZ
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="patch-Completion::Unix::Type::_net_interfaces"

--- Completion/Unix/Type/_net_interfaces.orig	2005-05-09 23:58:21.000000000 +0200
+++ Completion/Unix/Type/_net_interfaces	2005-05-10 00:00:05.000000000 +0200
@@ -12,7 +12,7 @@
       disp=(-ld list)
     fi
   ;;
-  darwin*|freebsd*) intf=( $(ifconfig -l) ) ;;
+  darwin*|freebsd*|dragonfly*) intf=( $(ifconfig -l) ) ;;
   irix*) intf=( ${${${(f)"$(/usr/etc/netstat -i)"}%% *}[2,-1]} ) ;;
   linux*) intf=( /proc/sys/net/ipv4/conf/*~*(all|default)(N:t) ) ;;
   *) intf=( $(ifconfig -a|sed -n 's/^\([^ 	:]*\).*/\1/p') ) ;;

--lrZ03NoBR/3+SXJZ
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="patch-Src::Modules::zpty.c"

--- Src/Modules/zpty.c.orig	2004-06-03 00:15:01.000000000 +0200
+++ Src/Modules/zpty.c	2005-05-10 00:01:41.000000000 +0200
@@ -246,15 +246,13 @@
 #ifdef __linux
     static char char1[] = "abcdefghijklmnopqrstuvwxyz";
     static char char2[] = "0123456789abcdef";
-#else /* __linux */
-# ifdef __FreeBSD__
+#elif defined(__FreeBSD__) || defined(__DragonFly__)
     static char char1[] = "pqrsPQRS";
     static char char2[] = "0123456789abcdefghijklmnopqrstuv";
-# else /* __FreeBSD__ */
+#else /* __FreeBSD__ || __DragonFly__ */
     static char char1[] = "pqrstuvwxyzPQRST";
     static char char2[] = "0123456789abcdef";
-# endif /* __FreeBSD__ */
-#endif /* __linux */
+#endif
 
     static char name[11];
     static int mfd, sfd;

--lrZ03NoBR/3+SXJZ--

