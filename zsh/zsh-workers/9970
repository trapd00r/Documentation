From zsh-workers-return-9970-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Mar 03 02:56:14 2000
Return-Path: <zsh-workers-return-9970-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26554 invoked from network); 3 Mar 2000 02:56:12 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 3 Mar 2000 02:56:12 -0000
Received: (qmail 12421 invoked by alias); 3 Mar 2000 02:56:04 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9970
Received: (qmail 12402 invoked from network); 3 Mar 2000 02:56:03 -0000
To: zsh-workers@sunsite.auc.dk
Path: mason
From: mason@primenet.com.au (Geoff Wing)
X-Newsgroups: lists.zsh.workers
Subject: Re: Preliminary release of 3.0.8 - please test
Date: 3 Mar 2000 02:55:56 GMT
Organization: PrimeNet Computer Consultants
Lines: 42
Distribution: local
Message-ID: <slrn8buads.pqj.mason@coral.primenet.com.au>
References: <slrn8bn840.2ac.mason@coral.primenet.com.au> <1000229161839.ZM29768@candle.brasslantern.com>
Reply-To: mason@primenet.com.au
NNTP-Posting-Host: coral.primenet.com.au
X-Trace: coral.primenet.com.au 952052156 26452 203.43.15.2 (3 Mar 2000 02:55:56 GMT)
X-Complaints-To: usenet@coral.primenet.com.au
NNTP-Posting-Date: 3 Mar 2000 02:55:56 GMT
User-Agent: slrn/0.9.6.2 (NetBSD)

Bart Schaefer <schaefer@candle.brasslantern.com> typed:
:On Feb 29, 10:33am, Geoff Wing wrote:
:} Subject: Re: Preliminary release of 3.0.8 - please test
:} After some initial usage, got it into a state of:
:} % %
:} fg: no such job: 3
:} % %%
:} fg: no such job: 3
:} % fg
:} fg: no current job
:} % jobs
:} %
:Hrm.  The job handling code is now identical to 3.1.6-dev-19, so if you
:can get 3.0.8 into that state theres a problem for 3.1.6 as well.

I'm thinking that getjob() may need a setcurjob() before it checks curjob.

builtin.c:bin_fg() has
    ....
    /* If necessary, update job table. */
        if (unset(NOTIFY))
            scanjobs();
        setcurjob();
    ....
    if (!*argv) {
        if (func == BIN_FG || func == BIN_BG || func == BIN_DISOWN) {
            if (curjob == -1 || (jobtab[curjob].stat & STAT_NOPRINT)) {
                zwarnnam(name, "no current job", NULL, 0);                
    ....

builtin.c:getjob() has
    ....
    if (*s == '%' || *s == '+' || !*s) {
        if (curjob == -1) {
            zwarnnam(prog, "no current job", NULL, 0);
    ....

Regards,
-- 
Geoff Wing : <gcw@pobox.com>     Work URL: http://www.primenet.com.au/
Rxvt Stuff : <gcw@rxvt.org>      Ego URL : http://pobox.com/~gcw/
Zsh Stuff  : <gcw@zsh.org>       Phone   : (Australia) 0413 431 874

