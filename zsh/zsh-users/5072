From zsh-users-return-5072-mason-zsh=primenet.com.au@sunsite.dk Fri Jun 21 11:37:42 2002
Return-Path: <zsh-users-return-5072-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28969 invoked from network); 21 Jun 2002 11:37:41 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 21 Jun 2002 11:37:41 -0000
Received: (qmail 6157 invoked by alias); 21 Jun 2002 11:37:27 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 5072
Received: (qmail 6145 invoked from network); 21 Jun 2002 11:37:26 -0000
From: "Vagn Johansen" <v@johansen.mail.dk>
To: zsh-users@sunsite.dk
Subject: Re: compinit problems with Cygwin and Win2000
Date: Fri, 21 Jun 2002 13:37:26 +0200
MIME-Version: 1.0
References: <20020617160353.EKQO27002.fepD.post.tele.dk@fepP5.im.tele.dk> <1020618085113.17690@mssC.post.tele.dk>
X-Mailer: Opasia webmail (version opasia/3.1.0)
X-Originating-IP: 194.255.118.209
Content-Type: text/plain; charset=iso-8859-1
Message-Id: <20020621113726.VHNO1315.fepE.post.tele.dk@fepP1.im.tele.dk>


Well, my original reply did not get through. But after
spending a little more time on the problem I found the
cause.

It was caused by the comparison in:

_d_als=($(whence -wm '_*' | sort |
while read -rA _d_line; do
  [[ ${_d_line[2]} = function ]] && print -r - ${_d_line[1]%:}
done))

${_d_line[2]} contains "function^M" and not "function"
as expected.

The use of the .zcompdump cache file works properly
when I change the comparison to 

  [[ ${_d_line[2]} = function? ]] && print -r - ${_d_line[1]%:}

I will probably run into this line ending problem again.

Note: the problem does not occur on win98.

Vagn J

v@johansen.mail.dk wrote:
> >Try changing that to
> >
> >  fpath=(~/.zfunc $fpath)
> >
> >and then see what happens.
> >
> 
> That does not change anything. But is more correct than what
> I
> had, so I will be using that line in the future. 
> 
> From what I understand from looking at  the compdump code,
> the 
> second to last "autoload" in .zcompdump should autoload all
> the underscore
> functions in $fpath[2]. Correct?
> 
> Also completions don't work (cd <TAB>, ls <TAB> etc.) when
> statring a shell when the .zcomdump exists. If I delete
> .zcomdump
> and start a shell, then the completions work (print -<TAB>
> is cool!).
> 
> By the way: i don't have this problem on my win98 machine at
> home.
> 
> --
> Vagn Johansen
> (Replying to my own mail because Barts mail is on my PC at
> home)


--
Vagn Johansen

