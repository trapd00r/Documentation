From zsh-users-return-13650-mason-zsh=primenet.com.au@sunsite.dk Mon Jan 05 19:27:09 2009
Return-Path: <zsh-users-return-13650-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15441 invoked from network); 5 Jan 2009 19:27:05 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 Jan 2009 19:27:05 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 6919 invoked from network); 5 Jan 2009 19:26:56 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 Jan 2009 19:26:56 -0000
Received: (qmail 20071 invoked by alias); 5 Jan 2009 19:26:39 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13650
Received: (qmail 20057 invoked from network); 5 Jan 2009 19:26:38 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 5 Jan 2009 19:26:38 -0000
Received: from mail.o2.co.uk (vader.london.02.net [82.132.130.150])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 37C5B802720C
	for <zsh-users@sunsite.dk>; Mon,  5 Jan 2009 20:26:35 +0100 (CET)
Received: from sc.homeunix.net (78.105.235.196) by mail.o2.co.uk (8.0.013.3) (authenticated as stephane.chazelas)
        id 494B97CF042B17E6; Mon, 5 Jan 2009 19:26:34 +0000
Received: from chazelas by sc.homeunix.net with local (Exim 4.69)
	(envelope-from <stephane_chazelas@yahoo.fr>)
	id 1LJv5t-0002Pj-IN; Mon, 05 Jan 2009 19:26:33 +0000
Date: Mon, 5 Jan 2009 19:26:33 +0000
From: Stephane Chazelas <Stephane_Chazelas@yahoo.fr>
To: Webb Sprague <webb.sprague@gmail.com>
Cc: zsh-users@sunsite.dk
Subject: Re: Problem with arrays -- "unknown file attribute"
Message-ID: <20090105192633.GC4857@sc.homeunix.net>
Mail-Followup-To: Webb Sprague <webb.sprague@gmail.com>,
	zsh-users@sunsite.dk
References: <b11ea23c0901050004h4f1825egc01d39c1f74c0ef0@mail.gmail.com> <alpine.LNX.2.00.0901050308270.17470@acer.home.local> <20090105092403.GA7733@sc.homeunix.net> <alpine.LNX.2.00.0901050426390.17470@acer.home.local> <m3fxjxenta.fsf@klanderman.net> <b11ea23c0901050931q790f8804tdbc8807c0c51a086@mail.gmail.com> <20090105181731.GA4857@sc.homeunix.net> <b11ea23c0901051042w393b8aeey6e03082d63a39481@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-15
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <b11ea23c0901051042w393b8aeey6e03082d63a39481@mail.gmail.com>
User-Agent: Mutt/1.5.16 (2007-09-19)
X-Virus-Scanned: ClamAV 0.92.1/8837/Mon Jan  5 17:08:06 2009 on bifrost
X-Virus-Status: Clean

On Mon, Jan 05, 2009 at 10:42:09AM -0800, Webb Sprague wrote:
> Thanks Stephane for all your comments on zsh scripting.  I just have
> one question below...
> 
> > Or you could keep the default value of IFS which in zsh is
> > $' \t\n\0' (in other shells it's $' \t\n' as they don't support
> > the NUL character anyway).
> 
> What does the dollar do in IFS?  I actually have to get rid of it in
> order to make the script work.


$'...' is another kind of quotes that come from ksh93. Shells
got it wrong from the start in not expanding the \t, \n, \a...
in their double quotes. Instead it is tools like echo, printf,
awk... that expand them each one in its own way and causing all
sorts of problems as they are then expanded even when we don't
want them to. Fixing that was impossible as that would have
broken scripts, so Korn introduced a new kind of quote that
is used to expand those sequences. '\t' is the sequence of the 2
characters, \ and t, so in IFS that means both \ and t are
separators; and $'\t' is the tab character.

>I think it might be part of the reason
> all of my array conversions have been giving me hell, actually.
> 
> Here is a working function (so far -- the inserts might have something lurking):
> 
> pop-colnames () {
>     setopt localoptions errreturn
>     local IFS=' \t\n'

That means space, \, t and n are separators.

>     TABS=($(sqlite3 $DB .tables))
>     for TAB in $TABS; do
>         echo $TAB 2>&1

echo doesn't output anything on its standard error, so it makes
no sense to redirect it.

>         COLS=($(sqlite3 $DB "select * from $TAB where ROWID=1;"| sed
> 's/\"//g' | sed 's/|/\\t/g'))
[...]

You don't need 2 instances of sed and you don't need to escape "
as it is not special to sed (while there's no guarantee that \"
is special in some sed implementation).

sed 's/"//g;s/|/\\t/g'

-- 
Stéphane

