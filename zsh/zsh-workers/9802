From zsh-workers-return-9802-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Feb 21 08:48:50 2000
Return-Path: <zsh-workers-return-9802-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15149 invoked from network); 21 Feb 2000 08:48:49 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 21 Feb 2000 08:48:49 -0000
Received: (qmail 20901 invoked by alias); 21 Feb 2000 08:48:41 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9802
Received: (qmail 20892 invoked from network); 21 Feb 2000 08:48:40 -0000
Date: Mon, 21 Feb 2000 09:48:38 +0100 (MET)
Message-Id: <200002210848.JAA04448@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Peter Stephenson's message of Sat, 19 Feb 2000 19:31:01 +0000
Subject: PATCH: Re: Too much backslashing of quoted shriek?


Peter Stephenson wrote:

> fn() {
>   foo='Hi!'
>   print -r ${(qq)foo}
> }
> 
> % fn
> 'Hi\!'

That should be easy to fix.

Bye
 Sven

diff -ru ../z.old/Src/utils.c Src/utils.c
--- ../z.old/Src/utils.c	Fri Feb 18 15:42:14 2000
+++ Src/utils.c	Mon Feb 21 09:46:29 2000
@@ -2858,7 +2858,7 @@
 		  (isset(MAGICEQUALSUBST) && (u[-1] == '=' || u[-1] == ':')) ||
 		  (*u == '~' && isset(EXTENDEDGLOB))) &&
 	    (!instring ||
-	     (isset(BANGHIST) && *u == (char)bangchar) ||
+	     (isset(BANGHIST) && *u == (char)bangchar && instring != 1) ||
 	     (instring == 2 &&
 	      (*u == '$' || *u == '`' || *u == '\"' || *u == '\\')) ||
 	     (instring == 1 && *u == '\''))) {

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

