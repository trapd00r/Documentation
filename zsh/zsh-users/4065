From zsh-users-return-4065-mason-zsh=primenet.com.au@sunsite.dk Sun Jul 29 13:57:39 2001
Return-Path: <zsh-users-return-4065-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 22741 invoked from network); 29 Jul 2001 13:57:37 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 29 Jul 2001 13:57:37 -0000
Received: (qmail 19326 invoked by alias); 29 Jul 2001 13:57:24 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 4065
Received: (qmail 19313 invoked from network); 29 Jul 2001 13:57:23 -0000
Date: Sun, 29 Jul 2001 14:57:15 +0100
From: Alan Third <alan@idiocy.org>
To: zsh-users mailing list <zsh-users@sunsite.auc.dk>
Subject: using precmd() to get hostnames out of commands
Message-ID: <20010729145715.A3460@idiocy.org>
Mail-Followup-To: Alan Third <alan@idiocy.org>,
	zsh-users mailing list <zsh-users@sunsite.auc.dk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.3.18i

Right, a while ago I decided that I wanted my hostname completion to
include any hostnames that I typed on the command line during a
session so I could do things like:


grover:/home/alan>ping  penglet.org
<snip>
grover:/home/alan>ssh pen<tab>

So I came up with this:


iplegal()
{
if [[ $1 == ([1-9]||[1-9][0-9]||1[0-9][0-9]||[2[0-4][0-9]||25[0-5]).\
([0-9]||[1-9][0-9]||1[0-9][0-9]||[2[0-4][0-9]||25[0-5]).\
([0-9]||[1-9][0-9]||1[0-9][0-9]||[2[0-4][0-9]||25[0-5]).\
([0-9]||[1-9][0-9]||1[0-9][0-9]||[2[0-4][0-9]||25[0-5]) ]]
then
        echo legal
else
        echo illegal
fi
}

precmd()
{
        # add any hostnames from the last command to the 
        # hostname completion array
        lastargs=(`fc -ln -1`)

        for stuff in $lastargs
        do
                if [[ $stuff == (*.org||*.com||*.net||*.edu||*.??~*.\
[[:digit:]][[:digit:]]) || `iplegal $stuff` == legal ]]
                then
                        hosts=($hosts $stuff)
                        zstyle ':completion:*:hosts' hosts $hosts
                fi
        done
}

It also recognises IPs and sticks them in too.

Is there a better way to do this? 

Thanks.
-- 
Alan Third

Cows go moo!

