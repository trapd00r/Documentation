From zsh-users-return-6171-mason-zsh=primenet.com.au@sunsite.dk Fri Jun 20 10:20:15 2003
Return-Path: <zsh-users-return-6171-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3314 invoked from network); 20 Jun 2003 10:20:14 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 20 Jun 2003 10:20:14 -0000
Received: (qmail 12984 invoked by alias); 20 Jun 2003 10:19:58 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 6171
Received: (qmail 12977 invoked from network); 20 Jun 2003 10:19:58 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 20 Jun 2003 10:19:58 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [62.2.95.247] by sunsite.dk (MessageWall 1.0.8) with SMTP; 20 Jun 2003 10:19:57 -0000
Received: from wesley.pjcj.net (dclient217-162-93-94.hispeed.ch [217.162.93.94])
	by smtp.hispeed.ch (8.12.6/8.12.6/tornado-1.0) with ESMTP id h5KAJtmW029750;
	Fri, 20 Jun 2003 12:19:55 +0200
Received: from localhost
	([127.0.0.1] helo=pjcj.sytes.net ident=www-data)
	by wesley.pjcj.net with smtp (Exim 3.36 #1 (Debian))
	id 19TIzr-0003Uh-00; Fri, 20 Jun 2003 12:19:55 +0200
Received: from 193.134.254.145
        (SquirrelMail authenticated user pjcj)
        by wesley.pjcj.net with HTTP;
        Fri, 20 Jun 2003 12:19:55 +0200 (CEST)
Message-ID: <44014.193.134.254.145.1056104395.squirrel@wesley.pjcj.net>
In-Reply-To: <19145.1056019282@csr.com>
References: <19145.1056019282@csr.com>
Date: Fri, 20 Jun 2003 12:19:55 +0200 (CEST)
Subject: Re: zsh 4.0.7 and 4.1.1 released
From: "Paul Johnson" <paul@pjcj.net>
To: "Peter Stephenson" <pws@csr.com>
Cc: zsh-users@sunsite.dk (zsh users list)
User-Agent: SquirrelMail/1.4.0
MIME-Version: 1.0
Content-Type: text/plain;charset=iso-8859-1
X-Priority: 3
Importance: Normal


Peter Stephenson said:

> I have uploaded zsh 4.0.7 and zsh 4.1.1 to ftp://ftp.zsh.org/pub/ .

I was hoping to track this down and fix it properly, but unfortunately I
won't have the time, so I thought it better just to report what I have
found.  If it seems to be simply a problem with my configuration then
don't worry about it, though 4.0.4 compiled without problem.

Apologies if this mailer wraps things badly, and thanks for all your work
and for a great shell.

    zsh configuration
    -----------------
    zsh version               : 4.1.1
    host operating system     : sparc-sun-solaris2.8
    source code location      : .
    compiler                  : gcc
    preprocessor flags        : -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
    executable compiler flags :  -Wall -Wmissing-prototypes -O2
    module compiler flags     :  -Wall -Wmissing-prototypes -O2 -fPIC
    executable linker flags   :   -s
    module linker flags       :   -s -G
    library flags             : -lsocket -ldl -lnsl -lcurses -lm  -lc
    installation basename     : zsh
    binary install path       : /usr/local/home/pidjjq/opt/bin
    man page install path     : /usr/local/home/pidjjq/opt/man
    info install path         : /usr/local/home/pidjjq/opt/info
    functions install path    :
/usr/local/home/pidjjq/opt/share/zsh/4.1.1/functions
    See config.modules for installed modules and functions.

    gcc version 3.1 compiled on Solaris 2.6

I tried compiling 4.1.1 on Solaris 2.8 and hit the following error:

    gcc -c -I. -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -DHAVE_CONFIG_H
-DMODULE -Wall -Wmissing-prototypes -O2 -fPIC -o terminfo..o
terminfo.c
    In file included from
/var/spool/pkg/gcc-3.1/lib/gcc-lib/sparc-sun-solaris2.6/3.1/include/curses.h:783,
                     from terminfo.c:48:
    /usr/local/include/unctrl.h:57: syntax error before "char"
    /usr/local/include/unctrl.h:57: conflicting types for `unctrl'
    /var/spool/pkg/gcc-3.1/lib/gcc-lib/sparc-sun-solaris2.6/3.1/include/curses.h:297:
previous declaration of `unctrl'
    *** Error code 1
    make: Fatal error: Command failed for target `terminfo..o'
    Current working directory
/usr/local/home/pidjjq/g/build/zsh-4.1.1/Src/Modules
    *** Error code 1
    make: Fatal error: Command failed for target `modules'


/usr/local/include/unctrl.h:57 is:

    extern NCURSES_CONST char *unctrl(chtype);

and NCURSES_CONST is not defined.

/usr/local/include/ncurses.h, /usr/local/include/curses.h,
/usr/local/include/term.h and /usr/local/include/termcap.h have the
line:

    #define NCURSES_CONST /*nothing*/

/var/spool/pkg/gcc-3.1/lib/gcc-lib/sparc-sun-solaris2.6/3.1/include/curses.h:297
is the last line of:

    extern  char    *longname(void),        /* long name of terminal */
                    *termname(void),        /* effective terminal name */
                    *keyname(int),  /* name of token returned by wgetch() */
                    *slk_label(int),
                    erasechar(void),
                    killchar(void),
                    *unctrl(int);

but as a quick hack I defined the _UNCTRL_H guard and the compilation
completed:

make check gave the following errors, though:

cd Test ; make check
if test -n "gcc"; then \
  cd .. && DESTDIR= \
  make MODDIR=`pwd`/Test/Modules install.modules > /dev/null; \
fi
mkdir /usr/local/home/pidjjq/g/build/zsh-4.1.1/Test/Modules
mkdir /usr/local/home/pidjjq/g/build/zsh-4.1.1/Test/Modules/zsh
mkdir /usr/local/home/pidjjq/g/build/zsh-4.1.1/Test/Modules/zsh/net
for f in ./*.ztst; do \
  ../Src/zsh +Z -f ./ztst.zsh $f; \
done
./A01grammar.ztst: starting.
This test hangs the shell when it fails...
./A01grammar.ztst: all tests successful.
./A02alias.ztst: starting.
./A02alias.ztst: all tests successful.
./A03quoting.ztst: starting.
./A03quoting.ztst: all tests successful.
./A04redirect.ztst: starting.
./A04redirect.ztst: all tests successful.
./A05execution.ztst: starting.
./A05execution.ztst: all tests successful.
./A06assign.ztst: starting.
./A06assign.ztst: all tests successful.
./B01cd.ztst: starting.
./B01cd.ztst: all tests successful.
./B02typeset.ztst: starting.
./B02typeset.ztst: all tests successful.
./B03print.ztst: starting.
./B03print.ztst: all tests successful.
./B04read.ztst: starting.
./B04read.ztst: all tests successful.
./C01arith.ztst: starting.
./C01arith.ztst: all tests successful.
./C02cond.ztst: starting.
./C02cond.ztst: all tests successful.
./C03traps.ztst: starting.
This test takes at least three seconds...
This test, too, takes at least three seconds...
./C03traps.ztst: all tests successful.
./C04funcdef.ztst: starting.
./C04funcdef.ztst: all tests successful.
./D01prompt.ztst: starting.
./D01prompt.ztst: all tests successful.
./D02glob.ztst: starting.
./D02glob.ztst: all tests successful.
./D03procsubst.ztst: starting.
./D03procsubst.ztst: all tests successful.
./D04parameter.ztst: starting.
./D04parameter.ztst: all tests successful.
./D05array.ztst: starting.
./D05array.ztst: all tests successful.
./D06subscript.ztst: starting.
./D06subscript.ztst: all tests successful.
./E01options.ztst: starting.
*** /tmp/zsh.ztst.err.20526     Thu Jun 19 13:31:49 2003
--- /tmp/zsh.ztst.terr.20526    Thu Jun 19 13:31:49 2003
***************
*** 1,3 ****
! +(eval):3> fn
! +fn:0> print message
! +(eval):4> unsetopt xtrace
--- 1,3 ----
! trace (eval):3> fn
! trace fn:0> print message
! trace (eval):4> unsetopt xtrace
Test ./E01options.ztst failed: error output differs from expected as shown
above for:
  fn() { print message; }
  setopt xtrace
  fn
  unsetopt xtrace
  fn
Was testing: XTRACE option
./E01options.ztst: test failed.
./E02xtrace.ztst: starting.
*** /tmp/zsh.ztst.out.20839     Thu Jun 19 13:31:50 2003
--- /tmp/zsh.ztst.tout.20839    Thu Jun 19 13:31:50 2003
***************
*** 18,26 ****
  Tracing: function 2>file
  Tracing: source
  Tracing: source 2>file
! +(eval):7> print 'Tracing: ( builtin ) 2>file'
! +(eval):9> cat
! +(eval):11> print 'Tracing: { builtin } 2>file'
! +(eval):13> cat
! +(eval):15> print 'Tracing: do builtin done 2>file'
! +(eval):17> cat
--- 18,26 ----
  Tracing: function 2>file
  Tracing: source
  Tracing: source 2>file
! trace (eval):7> print 'Tracing: ( builtin ) 2>file'
! trace (eval):9> cat
! trace (eval):11> print 'Tracing: { builtin } 2>file'
! trace (eval):13> cat
! trace (eval):15> print 'Tracing: do builtin done 2>file'
! trace (eval):17> cat
Test ./E02xtrace.ztst failed: output differs from expected as shown above
for:
  set -x
  print 'Tracing: builtin'
  print 'Tracing: builtin 2>file' 2>xtrace.err
  cat <<<'Tracing: external'
  cat <<<'Tracing: external 2>file' 2>>xtrace.err
  ( print 'Tracing: ( builtin )' )
  ( print 'Tracing: ( builtin ) 2>file' ) 2>>xtrace.err
  ( cat <<<'Tracing: ( external )' )
  ( cat <<<'Tracing: ( external ) 2>file' ) 2>>xtrace.err
  { print 'Tracing: { builtin }' }
  { print 'Tracing: { builtin } 2>file' } 2>>xtrace.err
  { cat <<<'Tracing: { external }' }
  { cat <<<'Tracing: { external } 2>file' } 2>>xtrace.err
  repeat 1 do print 'Tracing: do builtin done'; done
  repeat 1 do print 'Tracing: do builtin done 2>file'; done 2>>xtrace.err
  repeat 1 do cat <<<'Tracing: do external done'; done
  repeat 1 do cat <<<'Tracing: do external done 2>file'; done 2>>xtrace.err
  xtf 'Tracing: function'
  xtf 'Tracing: function 2>file' 2>>xtrace.err
  . ./xt.in 'Tracing: source'
  . ./xt.in 'Tracing: source 2>file' 2>>xtrace.err
  set +x
  cat xtrace.err
Error output:
trace (eval):2> print 'Tracing: builtin'
trace (eval):3> print 'Tracing: builtin 2>file'
trace (eval):4> cat
trace (eval):5> cat
trace (eval):6> print 'Tracing: ( builtin )'
trace (eval):8> cat
trace (eval):10> print 'Tracing: { builtin }'
trace (eval):12> cat
trace (eval):14> print 'Tracing: do builtin done'
trace (eval):16> cat
trace (eval):18> xtf 'Tracing: function'
trace xtf:1> local regression_test_dummy_variable
trace xtf:2> print 'Tracing: function'
trace (eval):19> xtf 'Tracing: function 2>file'
trace xtf:1> local regression_test_dummy_variable
trace xtf:2> print 'Tracing: function 2>file'
trace (eval):20> . ./xt.in 'Tracing: source'
trace ./xt.in:1> print 'Tracing: source'
trace (eval):21> . ./xt.in 'Tracing: source 2>file'
trace ./xt.in:1> print 'Tracing: source 2>file'
trace (eval):22> set +x
Was testing: xtrace with and without redirection
./E02xtrace.ztst: test failed.
./V01zmodload.ztst: starting.
./V01zmodload.ztst: all tests successful.
./V02zregexparse.ztst: starting.
./V02zregexparse.ztst: all tests successful.
./Y01completion.ztst: starting.
./Y01completion.ztst: all tests successful.
./Y02compmatch.ztst: starting.
./Y02compmatch.ztst: all tests successful.
./Y03arguments.ztst: starting.
*** /tmp/zsh.ztst.out.21517     Thu Jun 19 13:32:42 2003
--- /tmp/zsh.ztst.tout.21517    Thu Jun 19 13:32:43 2003
***************
*** 2,8 ****
  line: {tst -o +o }{}
  line: {tst -o +o }{}
  MESSAGE:{no arguments}
! line: {tst +o }{}
! line: {tst +o -o }{}
! line: {tst +o -o }{}
  MESSAGE:{no arguments}
--- 2,10 ----
  line: {tst -o +o }{}
  line: {tst -o +o }{}
  MESSAGE:{no arguments}
! line: {tst -+}{}
! MESSAGE:{no arguments}
! line: {tst -+}{}
! MESSAGE:{no arguments}
! line: {tst -+}{}
  MESSAGE:{no arguments}
Test ./Y03arguments.ztst failed: output differs from expected as shown
above for:
 tst_arguments -+o
 comptest $'tst -\t\t\t\C-w\C-w+\t\t\t'
Was testing: option beginning with + and -.
./Y03arguments.ztst: test failed.
*** Error code 1 (ignored)
rm -rf Modules .zcompdump

-- 
Paul Johnson - paul@pjcj.net
http://www.pjcj.net

