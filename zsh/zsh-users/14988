From zsh-users-return-14988-mason-zsh=primenet.com.au@zsh.org Fri Apr 09 09:03:19 2010
Return-Path: <zsh-users-return-14988-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25806 invoked by alias); 9 Apr 2010 09:03:19 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 14988
Received: (qmail 18479 invoked from network); 9 Apr 2010 09:03:07 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at seiken.de does not designate permitted sender hosts)
From: Joke de Buhr <joke@seiken.de>
To: zsh-users@zsh.org
Subject: Re: Count only visible characters?
Date: Fri, 9 Apr 2010 11:02:55 +0200
User-Agent: KMail/1.12.2 (Linux/2.6.31-9-rt; KDE/4.3.2; x86_64; ; )
References: <loom.20100409T002951-342@post.gmane.org>
In-Reply-To: <loom.20100409T002951-342@post.gmane.org>
MIME-Version: 1.0
Content-Type: Text/Plain;
  charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
Message-Id: <201004091102.55291.joke@seiken.de>

Since you are using prompt expansion you should always escape the color codes 
with "%{...%}". That's the only way zsh can calculate the length of the prompt 
line correctly. Otherwise the cursor will not be positioned at the end of the 
visual end.

testing="%{%F{green}%}hello"


If you need to do manual counting you can use this 

${(S%%)#testing//\%\{*\%\}}

The command replaces every escape %{...%} sequence prior to calculating the 
length.


$ testing="%{%F{green}%}hello"
$ echo ${(S%%)#testing//\%\{*\%\}}
5


On Friday, 9. April 2010 00:38:05 Seth House wrote:
> Is there any way to count only visible characters?
> 
>     testing="%F{green}hello"
>     echo ${(%)#testing}
> 
> The number I'm interested in is 5 not 14.
> 
> After an awful lot of Googling, I'm under the impression this isn't a
>  trivial problem. If that is true, I would certainly enjoy a little
>  exposition if someone has time.
> 
> Thanks.
> - Seth
> 

