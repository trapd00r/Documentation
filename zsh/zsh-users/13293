From zsh-users-return-13293-mason-zsh=primenet.com.au@sunsite.dk Sun Sep 28 18:13:01 2008
Return-Path: <zsh-users-return-13293-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1562 invoked from network); 28 Sep 2008 18:12:49 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 28 Sep 2008 18:12:49 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 18947 invoked from network); 28 Sep 2008 18:12:22 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Sep 2008 18:12:22 -0000
Received: (qmail 17153 invoked by alias); 28 Sep 2008 18:11:45 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13293
Received: (qmail 17135 invoked from network); 28 Sep 2008 18:11:44 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 28 Sep 2008 18:11:44 -0000
Received: from momoland.openchat.com (p84-72.acedsl.com [66.114.84.72])
	by bifrost.dotsrc.org (Postfix) with ESMTP id DB0A680308B9
	for <zsh-users@sunsite.dk>; Sun, 28 Sep 2008 20:11:40 +0200 (CEST)
Received: from momoland.openchat.com (localhost [127.0.0.1])
	by momoland.openchat.com (Postfix) with ESMTP id 62F19F8F4050
	for <zsh-users@sunsite.dk>; Sun, 28 Sep 2008 14:11:38 -0400 (EDT)
Date: Sun, 28 Sep 2008 14:11:38 -0400
Message-ID: <873ajkcf8l.wl%max@openchat.com>
From: Max Mikhanosha <max@openchat.com>
To: zsh-users@sunsite.dk
Subject: _expand completer with ignored-patterns and all-expansions
User-Agent: Wanderlust/2.15.3 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.8 (=?ISO-8859-4?Q?Shij=F2?=) APEL/10.6 Emacs/22.0.51
 (x86_64-unknown-linux-gnu) MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
X-Virus-Scanned: ClamAV 0.92.1/8347/Sun Sep 28 01:35:46 2008 on bifrost
X-Virus-Status: Clean

I'm in an directory with java sources, and I want to cvs update
**/build.xml.

cvs update **/build.xml<tab> 

I have it so that my completers are _expand then _complete, and first
choice it offers is a list of all the files, which is what I want, so
my choices are:

   1. bin/a/b/c/build.xml bin/d/e/f/build.xml a/b/c/build.xml d/e/f/build.xml
   2. bin/a/b/c/build.xml
   3. bin/d/e/f/build.xml
   4. a/b/c/build.xml
   5. d/e/f/build.xml
   6. foo/bar/build.xml
  
Pressing Enter on choice 1. leads to a quick realization that bin/
directory is not under version control, so whole cvs command fails
with unable to find CVS/Entries.

After doing:

zstyle ':completion:*expand*:*' ignored-patterns 'bin/*'


The choices offered are:

   1. a/b/c/build.xml
   2. d/e/f/build.xml
   3. foo/bar/build.xml

As you can see the choice of all the completions together disappeared?
It seems that the ignored-patterns is applied by _expand to the
all-expansions completion thus disabling it.  What I'm looking for is:

   1. a/b/c/build.xml d/e/f/build.xml foo/bar/build.xml
   2. a/b/c/build.xml
   3. d/e/f/build.xml
   4. foo/bar/build.xml

I.e. when removing ignored-patterns from all-expansions, expand should remove 
individual elements before all-expansions is joined into the string, while
currently it looks like its doing it after.

The $fignore behaves as expected, i.e. patters in fignore are causing
the matches to be excluded from the all-expansions individually, I
can't use $fignore because it appears only the file portion is being
matched there, so adding bin/* to fignore does not work.

(P.S I know that I could have typed **/(^bin)/build.xml instead of
playing with completions system, but its still looks like a bug/problem)


