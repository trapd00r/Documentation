From A.Main@dcs.warwick.ac.uk Thu Jul 18 07:28:46 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3/2) with ESMTP id HAA04866 for <mason@werple.mira.net.au>; Thu, 18 Jul 1996 07:28:44 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id RAA23993; Wed, 17 Jul 1996 17:18:38 -0400 (EDT)
Resent-Date: Wed, 17 Jul 1996 17:18:38 -0400 (EDT)
From: Zefram <A.Main@dcs.warwick.ac.uk>
Message-Id: <24013.199607172117@stone.dcs.warwick.ac.uk>
Subject: bugfix in fout code
To: zsh-workers@math.gatech.edu (Z Shell workers mailing list)
Date: Wed, 17 Jul 1996 22:17:44 +0100 (BST)
X-Patch: 116
X-Loop: zefram@dcs.warwick.ac.uk
X-Stardate: [-31]7824.43
X-US-Congress: Moronic fuckers
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"qV8rs3.0.ps5.kYLxn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1689
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 1536
Status: O

-----BEGIN PGP SIGNED MESSAGE-----

I've been getting mysterious core dumps under SunOS for the past couple
of days, starting, coincidentally, just after I installed pre3.  A dump
from a zsh script led to the culprit: SunOS' fflush(), which doesn't
agree with a NULL argument.  In this case it *is* a bug to call fflush
with a NULL argument, so here's the solution:

      Index: Src/jobs.c
      ===================================================================
      RCS file: /home/zefram/usr/cvsroot/zsh/Src/jobs.c,v
      retrieving revision 1.3
      diff -c -r1.3 jobs.c
      *** jobs.c	1996/07/16 14:26:54	1.3
      --- jobs.c	1996/07/17 20:23:37
      ***************
      *** 338,346 ****
        	    putc('\n', fout);
        	    fline = 0;
        	}
      !     } else if (doputnl && interact && !synch)
        	putc('\n', fout);
      !     fflush(fout);
        
        /* print "(pwd now: foo)" messages */
        
      --- 338,348 ----
        	    putc('\n', fout);
        	    fline = 0;
        	}
      ! 	fflush(fout);
      !     } else if (doputnl && interact && !synch) {
        	putc('\n', fout);
      ! 	fflush(fout);
      !     }
        
        /* print "(pwd now: foo)" messages */
        

 -zefram

-----BEGIN PGP SIGNATURE-----
Version: 2.6.2

iQCVAwUBMe1MwHD/+HJTpU/hAQF3PAQAgJUStFHCdvqtqdq0qi1H7Q0YV7F/bve7
SxSNS9vyhL+UYv7xcmQ/EG/BEkHnUEWQWokKHJn3AU3DpSbTo/LbP1rpRUbRLn6Q
uymeQcATORdid0Vz+yvOC+cWscxRXutZFrZ/8Wq/3SHVM0jiPsgie82aZTpfXnlm
9n1WHzcYo50=
=pq2T
-----END PGP SIGNATURE-----


