From zsh-workers-return-21622-mason-zsh=primenet.com.au@sunsite.dk Mon Aug 15 17:23:25 2005
Return-Path: <zsh-workers-return-21622-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 23012 invoked from network); 15 Aug 2005 17:23:21 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 15 Aug 2005 17:23:21 -0000
Received: (qmail 89083 invoked from network); 15 Aug 2005 17:23:15 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 15 Aug 2005 17:23:15 -0000
Received: (qmail 14203 invoked by alias); 15 Aug 2005 17:23:13 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21622
Received: (qmail 14191 invoked from network); 15 Aug 2005 17:23:13 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 15 Aug 2005 17:23:13 -0000
Received: (qmail 88771 invoked from network); 15 Aug 2005 17:23:13 -0000
Received: from flock1.newmail.ru (212.48.140.157)
  by a.mx.sunsite.dk with SMTP; 15 Aug 2005 17:23:09 -0000
Received: (qmail 31021 invoked from network); 15 Aug 2005 17:15:45 -0000
Received: from unknown (HELO ?10.0.0.53?) (arvidjaar@newmail.ru@83.237.61.42)
  by smtpd.newmail.ru with SMTP; 15 Aug 2005 17:15:45 -0000
From: Andrey Borzenkov <arvidjaar@newmail.ru>
To: zsh-workers@sunsite.dk
Subject: [PATCH] fix zrefresh recursive completion call
Date: Mon, 15 Aug 2005 21:22:50 +0400
User-Agent: KMail/1.8.2
References: <200508121021.j7CAL18n012569@news01.csr.com> <200508141955.43507.arvidjaar@newmail.ru>
In-Reply-To: <200508141955.43507.arvidjaar@newmail.ru>
MIME-Version: 1.0
Content-Type: multipart/signed;
  boundary="nextPart2894062.nPbL2Ui2sH";
  protocol="application/pgp-signature";
  micalg=pgp-sha1
Content-Transfer-Encoding: 7bit
Message-Id: <200508152122.55273.arvidjaar@newmail.ru>
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham 
	version=3.0.4

--nextPart2894062.nPbL2Ui2sH
Content-Type: text/plain;
  charset="utf-8"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline

On Sunday 14 August 2005 19:55, Andrey Borzenkov wrote:
>
> 1. attempt to use a-a-m-c results in
>
> {pts/2}% ll =D0=BA=D0=BA=D0=BA=D0=BA=D0=BA=D0=BA=D0=BA=D0=BA =D0=BA=D0=BA=
=D0=BA=D0=BA=D0=BA=D0=BA=D0=BA=D0=BA=D0=BA=D0=BA=D0=BA/home/bor/src/zsh/Src=
/Zle/compresult.c:690:
> line not metafied
> zsh: segmentation fault (core dumped)  pkg/bin/zsh

This happens with ASCII as well; the attached patch fixes it (zrefresh call=
s=20
completion recursively).

Index: Src/Zle/zle_refresh.c
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_refresh.c,v
retrieving revision 1.26
diff -u -p -r1.26 zle_refresh.c
=2D-- Src/Zle/zle_refresh.c       11 Aug 2005 18:40:53 -0000      1.26
+++ Src/Zle/zle_refresh.c       15 Aug 2005 17:18:25 -0000
@@ -746,8 +746,13 @@ singlelineout:
        zfree(tmpline, tmpll);

     /* if we have a new list showing, note it; if part of the list has been
=2D    overwritten, redisplay it. */
+    overwritten, redisplay it. We have to metafy line back before calling
+    completion code */
     if (showinglist =3D=3D -2 || (showinglist > 0 && showinglist < nlnct))=
 {
+       if (remetafy) {
+           metafy_line();
+           remetafy =3D 0;
+       }
        inlist =3D 1;
        listmatches();
        inlist =3D 0;

--nextPart2894062.nPbL2Ui2sH
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.0 (GNU/Linux)

iD8DBQBDAM9vR6LMutpd94wRAh9nAJ0VWWSYqVuh7k3mTyrPKLWj2RUMEwCeOB1I
7PP3NsbRTzqIvwrn0YZCBdI=
=Q/eq
-----END PGP SIGNATURE-----

--nextPart2894062.nPbL2Ui2sH--

