From zsh-workers-return-20152-mason-zsh=primenet.com.au@sunsite.dk Mon Jul 12 16:28:55 2004
Return-Path: <zsh-workers-return-20152-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21636 invoked from network); 12 Jul 2004 16:28:54 -0000
Received: from odin.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.85)
  by ns1.primenet.com.au with SMTP; 12 Jul 2004 16:28:54 -0000
Received: (qmail 9136 invoked from network); 12 Jul 2004 16:32:07 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 12 Jul 2004 16:32:07 -0000
Received: (qmail 26112 invoked by alias); 12 Jul 2004 16:28:35 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20152
Received: (qmail 26095 invoked from network); 12 Jul 2004 16:28:34 -0000
Received: from odin.dotsrc.org (HELO a.mx.sunsite.dk) (qmailr@130.225.247.85)
  by sunsite.dk with SMTP; 12 Jul 2004 16:28:34 -0000
Received: (qmail 8657 invoked from network); 12 Jul 2004 16:31:54 -0000
Received: from unknown (HELO moonbase.zanshin.com) (@167.160.213.139)
  by a.mx.sunsite.dk with SMTP; 12 Jul 2004 16:31:40 -0000
Received: from toltec.zanshin.com (toltec.zanshin.com [64.84.47.166])
	by moonbase.zanshin.com (8.12.11/8.12.11) with ESMTP id i6CGSDuj002554
	for <zsh-workers@sunsite.dk>; Mon, 12 Jul 2004 09:28:13 -0700
Date: Mon, 12 Jul 2004 09:28:13 -0700 (PDT)
From: Bart Schaefer <schaefer@brasslantern.com>
Reply-To: zsh-workers@sunsite.dk
To: zsh-workers@sunsite.dk
Subject: Re: Bug with the new prompt redraw code 
In-Reply-To: <20040711224206.4114D865D@pwstephenson.fsnet.co.uk>
Message-ID: <Pine.LNX.4.60.0407120920460.16720@toltec.zanshin.com>
References: <20040711224206.4114D865D@pwstephenson.fsnet.co.uk>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=0.0 required=6.0 tests=none autolearn=no version=2.63
X-Spam-Hits: 0.0

On Sun, 11 Jul 2004, Peter Stephenson wrote:

> > > > (1) zle-line-init runs before the prompt is displayed
> 
> > Also it doesn't address (1) but then maybe that doesn't matter.
> 
> I could be convinced it does, but see if this makes the problem go away
> first.

I can confirm that this does print the prompt that was assigned during
zle-line-init, rather than the garbage that was output before the patch.

So, what about (1)?  To repeat, the intent was to display a multi-line 
prompt immediately after a command finishes, but then refresh only the 
last line of that prompt on subsequent zle redisplays (the original 
example involved SIGWINCH handling).

An almost-equivalent thing can be achieved by using "print -P" from the
precmd function instead of by assignment to PS1, but there's a question
of whether other commands in zle-line-init should affect values that are
substituted into the prompt (e.g. $psvar).

