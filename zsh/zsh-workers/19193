From zsh-workers-return-19193-mason-zsh=primenet.com.au@sunsite.dk Wed Oct 15 15:32:34 2003
Return-Path: <zsh-workers-return-19193-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14463 invoked from network); 15 Oct 2003 15:32:33 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 15 Oct 2003 15:32:33 -0000
Received: (qmail 6107 invoked by alias); 15 Oct 2003 15:32:27 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19193
Received: (qmail 6082 invoked from network); 15 Oct 2003 15:32:26 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 15 Oct 2003 15:32:26 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [62.189.183.235] by sunsite.dk (MessageWall 1.0.8) with SMTP; 15 Oct 2003 15:32:26 -0000
Received: from EXCHANGE02.csr.com (unverified) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.10) with ESMTP id <T654d002bd6c0a88d01524@MAILSWEEPER01.csr.com>;
 Wed, 15 Oct 2003 16:32:33 +0100
Received: from csr.com ([192.168.144.127]) by EXCHANGE02.csr.com with Microsoft SMTPSVC(5.0.2195.5329);
	 Wed, 15 Oct 2003 16:33:03 +0100
To: "Julien CROUZET" <julien@synten.com>
cc: zsh-workers@sunsite.dk
Subject: Re: ZSH segfaults with huge command 
In-reply-to: ""Julien CROUZET""'s message of "Wed, 15 Oct 2003 17:06:47 +0200."
             <00f501c3932d$f40e5fe0$6900000a@julien> 
Date: Wed, 15 Oct 2003 16:32:25 +0100
Message-ID: <6631.1066231945@csr.com>
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 15 Oct 2003 15:33:03.0468 (UTC) FILETIME=[9F78CAC0:01C39331]

I think we're going to need a backtrace from zsh, but here's one shot in
the dark which is the nearest I can guess.  I don't think it's the
problem, though, and in any case I'd refer to know the root cause.

Index: Src/glob.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/glob.c,v
retrieving revision 1.31
diff -u -r1.31 glob.c
--- Src/glob.c	6 Oct 2003 22:42:39 -0000	1.31
+++ Src/glob.c	15 Oct 2003 15:31:54 -0000
@@ -245,8 +245,8 @@
 {
     char buf[PATH_MAX];
 
-    DPUTS(strlen(s) + !*s + pathpos - pathbufcwd >= PATH_MAX,
-	  "BUG: statfullpath(): pathname too long");
+    if (strlen(s) + !*s + pathpos - pathbufcwd >= PATH_MAX)
+	return 1;
     strcpy(buf, pathbuf + pathbufcwd);
     strcpy(buf + pathpos - pathbufcwd, s);
     if (!*s && *buf) {

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR Ltd., Science Park, Milton Road,
Cambridge, CB4 0WH, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

This footnote also confirms that this email message has been swept by
MIMEsweeper for the presence of computer viruses.

www.mimesweeper.com
**********************************************************************

