From zsh-workers-return-20902-mason-zsh=primenet.com.au@sunsite.dk Tue Mar 01 18:03:20 2005
Return-Path: <zsh-workers-return-20902-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16110 invoked from network); 1 Mar 2005 18:03:19 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 1 Mar 2005 18:03:19 -0000
Received: (qmail 42161 invoked from network); 1 Mar 2005 18:03:13 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 1 Mar 2005 18:03:13 -0000
Received: (qmail 20868 invoked by alias); 1 Mar 2005 18:03:05 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20902
Received: (qmail 20854 invoked from network); 1 Mar 2005 18:03:04 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 1 Mar 2005 18:03:04 -0000
Received: (qmail 41746 invoked from network); 1 Mar 2005 18:03:04 -0000
Received: from mail36.messagelabs.com (193.109.254.211)
  by a.mx.sunsite.dk with SMTP; 1 Mar 2005 18:02:56 -0000
X-VirusChecked: Checked
X-Env-Sender: okiddle@yahoo.co.uk
X-Msg-Ref: server-23.tower-36.messagelabs.com!1109700174!14467800!1
X-StarScan-Version: 5.4.11; banners=-,-,-
X-Originating-IP: [158.234.9.163]
Received: (qmail 23544 invoked from network); 1 Mar 2005 18:02:54 -0000
Received: from iris.logica.co.uk (158.234.9.163)
  by server-23.tower-36.messagelabs.com with SMTP; 1 Mar 2005 18:02:54 -0000
Received: from trentino.logica.co.uk ([158.234.142.59])
	by iris.logica.co.uk (8.12.3/8.12.3/Debian -4) with ESMTP id j21I2t61007031
	for <zsh-workers@sunsite.dk>; Tue, 1 Mar 2005 18:02:55 GMT
Received: from trentino.groupinfra.com (localhost [127.0.0.1])
	by trentino.logica.co.uk (Postfix) with ESMTP id C004C2E5D2
	for <zsh-workers@sunsite.dk>; Tue,  1 Mar 2005 19:02:34 +0100 (CET)
X-VirusChecked: Checked
X-StarScan-Version: 5.0.7; banners=.,-,-
In-reply-to: <200503011246.j21CkRGS031240@news01.csr.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <5964.1109263147@trentino.logica.co.uk> <200503011246.j21CkRGS031240@news01.csr.com>
To: Zsh workers <zsh-workers@sunsite.dk>
Subject: Re: configure tests for iconv 
Date: Tue, 01 Mar 2005 19:02:34 +0100
Message-ID: <31072.1109700154@trentino.groupinfra.com>
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

Peter wrote:
> I finally got around to trying this under a couple of versions of
> Cygwin.  It compiles and links with libiconv fine.  It announces it

That probably means the configure changes are right.

> can't do charset conversion, but as far as I can find out it always did;
> probably something outside the C code needs setting up.

Have you tried with a simple character in the basic ASCII range such as
\\u0061. If that works then it may be related to however locales are
configured in Cygwin.

There's a few places in the C code where it produces that error message
so it'd be useful to establish which one applies. Could you perhaps edit
the four instances of the error message to identify which is printed.
Either that or check what the various defines such as HAVE_NL_LANGINFO
and HAVE_ICONV are set to? If HAVE_ICONV is undefined, my AC_DEFINE may
be clashing with the AC_CHECK_FUNC. That could be solved by renaming
HAVE_ICONV in the AC_DEFINE.

Does /usr/bin/printf's \u work?
Also worth checking is
  zmodload zsh/langinfo
  print $langinfo[CODESET]

Thanks

Oliver

