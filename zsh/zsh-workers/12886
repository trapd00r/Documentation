From zsh-workers-return-12886-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Oct 04 14:10:39 2000
Return-Path: <zsh-workers-return-12886-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21542 invoked from network); 4 Oct 2000 14:10:38 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 4 Oct 2000 14:10:38 -0000
Received: (qmail 3919 invoked by alias); 4 Oct 2000 14:10:23 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12886
Received: (qmail 3908 invoked from network); 4 Oct 2000 14:10:22 -0000
To: zsh-workers@sunsite.auc.dk
Subject: Re: _cvs update
References: <hvoem1xyz84.fsf@coulee.m17n.org>
 <1001004101414.ZM21914@candle.brasslantern.com>
MIME-Version: 1.0 (generated by REMI 1.14.3 - "Matsudai")
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@m17n.org>
Date: 04 Oct 2000 23:06:14 +0900
In-Reply-To: <1001004101414.ZM21914@candle.brasslantern.com>
 (Bart Schaefer's message of "Wed, 4 Oct 2000 10:14:14 +0000")
Message-ID: <hvobsx0zoo9.fsf@coulee.m17n.org>
Lines: 43
User-Agent: T-gnus/6.14.5 (based on Gnus v5.8.7) (revision 03) REMI/1.14.3 (Matsudai) Deisui/1.14.0 (Kikuhime) APEL/10.2 Emacs/20.7 (i386-unknown-openbsd2.7) MULE/4.0 (HANANOEN)

In article <1001004101414.ZM21914@candle.brasslantern.com>,
  "Bart Schaefer" <schaefer@candle.brasslantern.com> writes:

> Anything that makes a query against the repository should respect the
> remote-access style, the way _cvs_revisions does.  You handled that in
> _cvs_(top|sub)_modules but not in _cvs_vendor_branches.

OK.  This patch do that.

However I think _cvs needs another style name to control cvs
invocation.  Because it may be slow even with local repository.
Currently,  remote-access style prevents local access as well as
remote access.  I think it's not so correct.

Index: Completion/User/_cvs
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/User/_cvs,v
retrieving revision 1.13
diff -u -r1.13 _cvs
--- Completion/User/_cvs	2000/10/04 05:10:20	1.13
+++ Completion/User/_cvs	2000/10/04 13:48:03
@@ -744,11 +744,14 @@
 (( $+functions[_cvs_vendor_branches] )) ||
 _cvs_vendor_branches () {
   local expl vendor_branch
-  if [[ -n $opt_args[-b] ]]; then
-    _cvs_extract_vendor_branch -b "$opt_args[-b]" "$cvsroot" "$line[1]" \
-      vendor_branch
-  else
-    _cvs_extract_vendor_branch "$cvsroot" "$line[1]" vendor_branch
+  vendor_branch=()
+  if zstyle -T ":completion:${curcontext}:" remote-access; then
+    if [[ -n $opt_args[-b] ]]; then
+      _cvs_extract_vendor_branch -b "$opt_args[-b]" "$cvsroot" "$line[1]" \
+	vendor_branch
+    else
+      _cvs_extract_vendor_branch "$cvsroot" "$line[1]" vendor_branch
+    fi
   fi
   if (( $#vendor_branch )); then
     _wanted values expl 'vendor branch' compadd -a vendor_branch
-- 
Tanaka Akira

