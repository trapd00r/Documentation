From zsh-workers-return-11497-mason-zsh=primenet.com.au@sunsite.auc.dk Mon May 22 12:22:02 2000
Return-Path: <zsh-workers-return-11497-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 1798 invoked from network); 22 May 2000 12:22:00 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 22 May 2000 12:22:00 -0000
Received: (qmail 17919 invoked by alias); 22 May 2000 12:21:53 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11497
Received: (qmail 17911 invoked from network); 22 May 2000 12:21:52 -0000
Date: Mon, 22 May 2000 14:20:34 +0200 (MET DST)
Message-Id: <200005221220.OAA20330@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Andrej Borsenkow"'s message of Mon, 22 May 2000 15:44:03 +0400
Subject: PATCH: RE: side effect of "select=long"


Andrej Borsenkow wrote:

> Not at all. We have separately completion lists AND menu
> completion/selection. First list is displayed (of course, with
> corresponding settings) and then, on the second TAB, menu
> completion/selection is started. So, that means `start selection INSTEAD
> of list if matches do not fit on the screen and start selection ON THE
> SECOND TAB always (assuming, it was not started already)'.

That's what I wanted to make possible. There was a thinko in the code, 
though, sorry. The incantation is, of course:

  zstyle ':completion:*' menu 'select=0' 'select=long-list'

Ok?

Bye
 Sven

Index: Completion/Core/_main_complete
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Core/_main_complete,v
retrieving revision 1.24
diff -u -r1.24 _main_complete
--- Completion/Core/_main_complete	2000/05/22 12:14:37	1.24
+++ Completion/Core/_main_complete	2000/05/22 12:20:49
@@ -159,9 +159,9 @@
 
   _menu_style=( "$_menu_style[@]" "$_def_menu_style[@]" )
 
-  if [[ -z "$compstate[insert]" ]]; then
-    [[ -n "$_menu_style[(r)select=long-list]" && tmp -gt LINES ]] &&
-        compstate[insert]=menu
+  if [[ "$compstate[list]" = *list &&
+        -n "$_menu_style[(r)select=long-list]" && tmp -gt LINES ]]; then
+    compstate[insert]=menu
   elif [[ "$compstate[insert]" = "$_saved_insert" ]]; then
     if [[ -n "$_menu_style[(r)select=long]" && tmp -gt LINES ]]; then
         compstate[insert]=menu

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

