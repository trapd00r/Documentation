From zsh-workers-return-13440-mason-zsh=primenet.com.au@sunsite.dk Wed Feb 07 17:22:17 2001
Return-Path: <zsh-workers-return-13440-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25428 invoked from network); 7 Feb 2001 17:22:16 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 7 Feb 2001 17:22:16 -0000
Received: (qmail 3111 invoked by alias); 7 Feb 2001 17:22:07 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13440
Received: (qmail 3096 invoked from network); 7 Feb 2001 17:22:04 -0000
From: "Bart Schaefer" <schaefer@candle.brasslantern.com>
Message-Id: <1010207171224.ZM30542@candle.brasslantern.com>
Date: Wed, 7 Feb 2001 17:12:24 +0000
In-Reply-To: <000101c090da$a80e3eb0$21c9ca95@mow.siemens.ru>
Comments: In reply to "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
        "RE: 53completion.ztst (Re: zregexparse.ztst fails with latest CVS)" (Feb  7, 10:50am)
References: <000101c090da$a80e3eb0$21c9ca95@mow.siemens.ru>
X-Mailer: Z-Mail (5.0.0 30July97)
To: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>,
        <zsh-workers@sunsite.dk>
Subject: Re: 53completion.ztst (Re: zregexparse.ztst fails with latest CVS)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

On Feb 7, 10:50am, Andrej Borsenkow wrote:
} Subject: RE: 53completion.ztst (Re: zregexparse.ztst fails with latest CVS
}
} I cannot reproduce it either on MIPS based Unix. I have CVS + my patch I've
} sent at Monday (but it should not affect this anyway). OTOH I cannot run
} anything related to zpty for a long time under Cygwin (hoping to look at it
} closer). Any chance it may be related?

No, it happens with plain zsh -f too.  Transcript follows; don't let the
"zsh-3.1.9" in path names confuse you, that's my local CVS sandbox name.

(gdb) run -f
Starting program: /scratch/local/src/zsh/zsh-3.1.9-dynamic/Src/zsh -f
zagzig% module_path=($PWD/Test/Modules)
zagzig% setopt extendedglob
zagzig% fpath=(/usr/src/local/zsh/zsh-3.1.9/(Completion|Functions)/*~*/CVS(/)) 
zagzig% autoload -U compinit
zagzig% compinit -u
zagzig% zmodload
zsh/zutil
zsh/compctl
zsh/complete
zsh/main
zsh/zle
zsh/parameter
zagzig% zstyle ":completion:*:default" list-colors "no=<NO>" "fi=<FI>" "di=<DI>" "ln=<LN>" "pi=<PI>" "so=<SO>" "bd=<BD>" "cd=<CD>" "ex=<EX>" "mi=<MI>" "tc=<TC>" "sp=<SP>" "lc=<LC>" "ec=<EC>\n" "rc=<RC>"
zagzig% zstyle ":completion:*" group-name ""
zagzig% zstyle ":completion:*:messages" format "<MESSAGE>%d</MESSAGE>
dquote> "
zagzig% zstyle ":completion:*:descriptions" format "<DESCRIPTION>%d</DESCRIPTION>
dquote> "
zagzig% zstyle ":completion:*:options" verbose yes
zagzig% zstyle ":completion:*:values" verbose yes
zagzig% setopt noalwayslastprompt listrowsfirst completeinword
zagzig% zmodload -i zsh/complist
zsh: failed to load module: zsh/complist

At this point, if I try a second time to load zsh/complist, zsh crashes:

Program received signal SIGSEGV, Segmentation fault.
0x1d42 in ?? ()
(gdb) up
#1  0x808a3a8 in dyn_boot_module (m=0x80d6f88)
    at ../../zsh-3.1.9/Src/module.c:625
625             return fn(m);
(gdb) where 5
#0  0x1d42 in ?? ()
#1  0x808a3a8 in dyn_boot_module (m=0x80d6f88)
    at ../../zsh-3.1.9/Src/module.c:625
#2  0x808a525 in boot_module (m=0x80d6f88) at ../../zsh-3.1.9/Src/module.c:677
#3  0x808b263 in load_module (name=0x80de3e0 "zsh/complist")
    at ../../zsh-3.1.9/Src/module.c:846
#4  0x808b6ad in require_module (nam=0x400e4588 "zmodload", 
    module=0x80de3e0 "zsh/complist", res=1, test=0)
    at ../../zsh-3.1.9/Src/module.c:889
(More stack frames follow...)
(gdb) print fn
$3 = (int (*)()) 0x40165198 <domenuselect+5984>
(gdb) print m
$4 = (struct module *) 0x80d6f88
(gdb) print *m
$5 = {nam = 0x80de3e0 "zsh/complist", flags = 20, u = {handle = 0x80dfc00, 
    linked = 0x80dfc00, alias = 0x80dfc00 ""}, deps = 0x80dd090, wrapper = 0}


} > I noticed that "make clean" doesn't remove the module .so files,
} 
} Sorry? You really mean Zsh, do not you? :-)

Ah, I see now what confused me:  Because "make check" died, it didn't
remove the Test/Modules/ temporary installation directory; I did an
"ls **/*.so" and saw there were some, without noticing where.  The
"mostlyclean-here" rule in Test/Makefile.in doesn't clean those out.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

Zsh: http://www.zsh.org | PHPerl Project: http://phperl.sourceforge.net   

