From zsh-workers-request@euclid.skiles.gatech.edu Tue Dec 10 09:05:07 1996
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 14287 invoked from network); 10 Dec 1996 09:05:06 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 10 Dec 1996 09:05:06 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id DAA20825; Tue, 10 Dec 1996 03:56:42 -0500 (EST)
Resent-Date: Tue, 10 Dec 1996 03:56:42 -0500 (EST)
Message-Id: <199612100857.JAA07347@hydra.ifh.de>
To: zsh-workers@math.gatech.edu (Zsh hackers list)
Subject: Another missing HEAPALLOC
Date: Tue, 10 Dec 1996 09:57:28 +0100
From: Peter Stephenson <pws@ifh.de>
Resent-Message-ID: <"PvELf.0.K55.ANIho"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2550
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

% echo $zs
/home/sgi/pws/src/zsh-3.0.1/Src
% cd zs
BUG: permanent allocation in getstrvalue
~zs

PERMALLOC is set in bin_cd for calling cd_get_dest(), but the
parameter code in getnamedir() needs HEAPALLOC.  (Is this
getstrvalue() test new?  I've only just started noticing the error
messages.)  The following patch is chosen simply to make the minimum
code reorganisation necessary, but maybe the HEAPALLOC needs to be
further down in getstrvalue() or wherever, as Zoltan suggested.

*** Src/builtin.c~	Mon Dec  9 17:57:22 1996
--- Src/builtin.c	Tue Dec 10 09:48:52 1996
***************
*** 1180,1186 ****
  	for (rest = s; *rest && *rest != '/'; rest++);
  	save = *rest;
  	*rest = 0;
! 	s = getnameddir(s);
  	*rest = save;
  
  	if (s && *rest)
--- 1180,1188 ----
  	for (rest = s; *rest && *rest != '/'; rest++);
  	save = *rest;
  	*rest = 0;
! 	HEAPALLOC {
! 	    s = getnameddir(s);
! 	} LASTALLOC;
  	*rest = save;
  
  	if (s && *rest)

-- 
Peter Stephenson <pws@ifh.de>       Tel: +49 33762 77366
WWW:  http://www.ifh.de/~pws/       Fax: +49 33762 77413
Deutches Electronen-Synchrotron --- Institut fuer Hochenergiephysik Zeuthen
DESY-IfH, 15735 Zeuthen, Germany.

