From zsh-workers-return-11360-mason-zsh=primenet.com.au@sunsite.auc.dk Mon May 15 08:04:25 2000
Return-Path: <zsh-workers-return-11360-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14906 invoked from network); 15 May 2000 08:04:21 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 May 2000 08:04:21 -0000
Received: (qmail 695 invoked by alias); 15 May 2000 08:02:16 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11360
Received: (qmail 688 invoked from network); 15 May 2000 08:02:16 -0000
Date: Mon, 15 May 2000 10:02:12 +0200 (MET DST)
Message-Id: <200005150802.KAA13547@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 14 May 2000 07:54:40 +0900
Subject: PATCH: Re: zparseopts causes core dump


Tanaka Akira wrote:

> zparseopts causes core dump as follows.
> 
> Z(4):akr@serein% Src/zsh -f 
> serein% set - -a
> serein% zparseopts -a=xxx
> zsh: segmentation fault (core dumped)  Src/zsh -f

`-a=xxx' is not a option description and zparseopts should catch that
case, right.

Bye
 Sven

Index: Src/Modules/zutil.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Modules/zutil.c,v
retrieving revision 1.2
diff -u -r1.2 zutil.c
--- Src/Modules/zutil.c	2000/05/04 20:16:10	1.2
+++ Src/Modules/zutil.c	2000/05/15 08:00:59
@@ -1326,12 +1326,18 @@
 		}
 		break;
 	    }
-	    if (!o)
+	    if (!o) {
+		o = "";
 		break;
+	    }
 	} else {
 	    args--;
 	    break;
 	}
+    }
+    if (!o) {
+	zwarnnam(nam, "missing option descriptions", NULL, 0);
+	return 1;
     }
     while ((o = dupstring(*args++))) {
 	if (!*o) {

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

