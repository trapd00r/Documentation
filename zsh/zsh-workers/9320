From zsh-workers-return-9320-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Jan 14 19:07:48 2000
Return-Path: <zsh-workers-return-9320-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2091 invoked from network); 14 Jan 2000 19:07:47 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 14 Jan 2000 19:07:47 -0000
Received: (qmail 476 invoked by alias); 14 Jan 2000 19:07:40 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 9320
Received: (qmail 469 invoked from network); 14 Jan 2000 19:07:40 -0000
To: "Zsh hackers list" <zsh-workers@sunsite.auc.dk>
Cc: Gene Cohler <gene@bear.com>
Subject: Re: dl.h/dlfnc.h clash in module.c RE: 3.1.6-dev-15 
In-reply-to: ""Andrej Borsenkow""'s message of "Thu, 13 Jan 2000 22:02:20 +0300."
             <000001bf5df8$b7dab6e0$21c9ca95@mow.siemens.ru> 
Date: Fri, 14 Jan 2000 19:09:52 +0000
From: Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Message-Id: <E129Byx-00012x-00.2000-01-14-19-02-00@cmailg6.svr.pol.co.uk>

"Andrej Borsenkow" wrote:
> O.K., looks, like my mail was lost.
> 
> I complained about inability to load complete.so (that depends on zle.so) in
> dev-14. It turned out to be patch from 9200, that changed
> 
> #ifdef HAVE_DLFNC_H
> #include <dlfnc.h>
> 
> into
> 
> #ifdef HAVE_DLFNC_H
> #ifdef HAVE_DL_H
> #include <dl.h>
> #else
> #include <dlfnc.h>
> #endif
> 
> Our system has dl.h that has nothing to do with dynamic locading (it is most
> probably from Double Linked lists). It results in RTLD_GLOBAL being undefined
> (defined to dummy value in module.c) - with obvious consequencies ...
> 
> The wording in 9200 was "HPUX 11.0 does not have dlfnc.h ..." - I fail to see
> how above patch fixes that.

The patch came from Gene Cohler <gene@bear.com> in 9211, and he'll have to
answer this, since most of us don't have access to HPUX 11.  I think the
point is it needs to prefer dl.h to dlfcn.h in that case, if both exist.
(Although I agree that if the problem *really* is that dlfnc.h *doesn't*
exist, HAVE_DLFNC_H oughtn't to be defined in the first place and something
screwy is happening.)  The solution may be to test something HP-specific.
Would changing the second line to

#if defined(HAVE_DL_H) && defined(__hpux)

suit everybody?

-- 
Peter Stephenson <pws@pwstephenson.fsnet.co.uk>

