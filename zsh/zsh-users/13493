From zsh-users-return-13493-mason-zsh=primenet.com.au@sunsite.dk Tue Nov 25 20:25:20 2008
Return-Path: <zsh-users-return-13493-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 16800 invoked from network); 25 Nov 2008 20:25:16 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 25 Nov 2008 20:25:16 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 53738 invoked from network); 25 Nov 2008 20:24:58 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 25 Nov 2008 20:24:58 -0000
Received: (qmail 5887 invoked by alias); 25 Nov 2008 20:24:41 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13493
Received: (qmail 5877 invoked from network); 25 Nov 2008 20:24:41 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 25 Nov 2008 20:24:41 -0000
Received: from mtaout03-winn.ispmail.ntl.com (mtaout03-winn.ispmail.ntl.com [81.103.221.49])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 7F08580525B4
	for <zsh-users@sunsite.dk>; Tue, 25 Nov 2008 21:24:38 +0100 (CET)
Received: from aamtaout02-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout03-winn.ispmail.ntl.com
          (InterMail vM.7.08.04.00 201-2186-134-20080326) with ESMTP
          id <20081125202434.LZNI1691.mtaout03-winn.ispmail.ntl.com@aamtaout02-winn.ispmail.ntl.com>
          for <zsh-users@sunsite.dk>; Tue, 25 Nov 2008 20:24:34 +0000
Received: from pws-pc ([81.107.43.40]) by aamtaout02-winn.ispmail.ntl.com
          (InterMail vG.2.02.00.01 201-2161-120-102-20060912) with ESMTP
          id <20081125202434.RLAC21638.aamtaout02-winn.ispmail.ntl.com@pws-pc>
          for <zsh-users@sunsite.dk>; Tue, 25 Nov 2008 20:24:34 +0000
Date: Tue, 25 Nov 2008 20:24:24 +0000
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-users@sunsite.dk
Subject: Re: Retrieving the terminal title / setting it using the name of
 the foreground process
Message-ID: <20081125202424.31c66c3d@pws-pc>
In-Reply-To: <882441.36344.qm@web111205.mail.gq1.yahoo.com>
References: <882441.36344.qm@web111205.mail.gq1.yahoo.com>
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.12; x86_64-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Cloudmark-Analysis: v=1.0 c=1 a=B4rGJAEzLxIA:10 a=WiOgQWAHYx4A:10 a=NLZqzBF-AAAA:8 a=bzfBeZNW5XdeN45PqREA:9 a=sgK32ROHjDEQsvjYVdgA:7 a=RB3DxqE2WBH1h2EjU1FAj1UmFH8A:4 a=rC2wZJ5BpNYA:10 a=_dQi-Dcv4p4A:10 a=LY0hPdMaydYA:10
X-Virus-Scanned: ClamAV 0.92.1/8680/Tue Nov 25 19:37:58 2008 on bifrost
X-Virus-Status: Clean

On Tue, 25 Nov 2008 10:40:32 -0800 (PST)
Enny Ammis <enny_ammis@yahoo.com> wrote:
> i'm fairly new to zsh (it's been 4 days now), and i've been spending
> some time customizing it. one thing i haven't been able to do yet is
> change a terminal's title so that it contains the name of the currently
> active process, i.e. "zsh" if i'm simply using the shell, "perl args" if
> i'm running a perl program, "emacs file.txt" if i'm running emacs

The simplest thing you can do is

  preexec() { print -nr $'\033'"]2;$1"$'\a' }

This is designed to avoid problems with the command line to be executed,
passed in $1, being interpreted specially, which is why it's more
complicated than you might first expect.

> and "zsh" again if i hit ^Z and send emacs to the background. 

Well, you can't trap the ^Z itself in an interactive shell.  However,
if you're just trying to get something to happen when you get back to
the prompt, it's easy.  If all you want is to cancel the stuff in the
title bar and replace it with zsh when a programme isn't running in the
foreground:

  precmd() { print -nr $'\033'"]2;zsh"$'\a' }

I'm not sure if that was all there was too it.  You can get the information
about jobs from parameters; in a recent shell, the variable $jobstates,
contained in the zsh/parameter module, is the easiest to manipulate.
See the zshmodules manual.

If you have other information to go into the title you will need to
store that in a shell variable whereever it's generated and add it to
the information that's printed out.

  # wherever
  foo="... some stuff ..."

  # then...
  preexec() { print -nr $'\033'"]2;$foo$1"$'\a' }
  precmd() { print -nr $'\033'"]2;${foo}zsh"$'\a' }

If you want to do something different, short, specific questions are
most likely to get a useful answer.

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

