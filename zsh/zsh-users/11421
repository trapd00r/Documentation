From zsh-users-return-11421-mason-zsh=primenet.com.au@sunsite.dk Tue Apr 17 14:08:07 2007
Return-Path: <zsh-users-return-11421-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7530 invoked from network); 17 Apr 2007 14:08:04 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.8 (2007-02-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,FORGED_RCVD_HELO
	autolearn=ham version=3.1.8
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 17 Apr 2007 14:08:04 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 64685 invoked from network); 17 Apr 2007 14:07:58 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 17 Apr 2007 14:07:58 -0000
Received: (qmail 6501 invoked by alias); 17 Apr 2007 14:07:36 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11421
Received: (qmail 6486 invoked from network); 17 Apr 2007 14:07:34 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 17 Apr 2007 14:07:33 -0000
Received: (qmail 62933 invoked from network); 17 Apr 2007 14:07:33 -0000
Received: from cluster-c.mailcontrol.com (168.143.177.190)
  by a.mx.sunsite.dk with SMTP; 17 Apr 2007 14:07:29 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly22c.srv.mailcontrol.com (MailControl) with ESMTP id l3HE5dLE026496
	for <zsh-users@sunsite.dk>; Tue, 17 Apr 2007 15:07:20 +0100
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Tue, 17 Apr 2007 15:06:45 +0100
Date: Tue, 17 Apr 2007 15:06:45 +0100
From: Peter Stephenson <pws@csr.com>
To: zsh-users@sunsite.dk (Zsh users list)
Subject: Re: zsh 4.3.3 released
Message-Id: <20070417150645.b6d62e3c.pws@csr.com>
In-Reply-To: <200704171342.l3HDgehc000575@news01.csr.com>
References: <200704161647.l3GGl2FE027950@news01.csr.com>
	<f010p6$u6s$1@sea.gmane.org>
	<f02i3o$ggr$1@sea.gmane.org>
	<200704171342.l3HDgehc000575@news01.csr.com>
Organization: Cambridge Silicon Radio
X-Mailer: Sylpheed version 2.2.10 (GTK+ 2.10.8; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 17 Apr 2007 14:06:45.0761 (UTC) FILETIME=[A2116710:01C780F9]
X-Scanned-By: MailControl A-06-00-00 (www.mailcontrol.com) on 10.67.0.132

Peter Stephenson <pws@csr.com> wrote:
> Thorsten Kampe wrote:
> > Could I have a confirmation for this? Was my informal bug report 
> > sufficient or do you need a more detailed description?!
> 
> I haven't yet understood what the problem actually is, nor reproduced it
> yet.

OK, I've found it; it wasn't too hard---all uses of %{ in completion were
basically broken (I'm incrementing the pointer before instead of after
processing the escape character).  Thanks for the report.  See if there are
any problems left after this.

Index: Src/Zle/complist.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/complist.c,v
retrieving revision 1.102
diff -u -r1.102 complist.c
--- Src/Zle/complist.c	2 Apr 2007 13:58:19 -0000	1.102
+++ Src/Zle/complist.c	17 Apr 2007 14:04:08 -0000
@@ -1046,13 +1046,11 @@
 			tcout(TCUNDERLINEEND);
 		    break;
 		case ZWC('{'):
-		    for (p++; *p && (*p != '%' || p[1] != '}'); p++)
+		    for (; *p && (*p != '%' || p[1] != '}'); p++)
 			if (dopr)
 			    putc(*p == Meta ? *++p ^ 32 : *p, shout);
 		    if (*p)
-			p++;
-		    else
-			p--;
+			p += 2;
 		    break;
 		case ZWC('m'):
 		    if (stat) {


-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


To access the latest news from CSR copy this link into a web browser:  http://www.csr.com/email_sig.php

To get further information regarding CSR, please visit our Investor Relations page at http://ir.csr.com/csr/about/overview

