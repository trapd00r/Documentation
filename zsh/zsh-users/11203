From zsh-users-return-11203-mason-zsh=primenet.com.au@sunsite.dk Fri Feb 16 04:01:56 2007
Return-Path: <zsh-users-return-11203-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14684 invoked from network); 16 Feb 2007 04:01:54 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.8 (2007-02-13) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO
	autolearn=ham version=3.1.8
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Feb 2007 04:01:54 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 28661 invoked from network); 16 Feb 2007 04:01:49 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Feb 2007 04:01:49 -0000
Received: (qmail 20712 invoked by alias); 16 Feb 2007 04:01:38 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11203
Received: (qmail 20703 invoked from network); 16 Feb 2007 04:01:37 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 16 Feb 2007 04:01:37 -0000
Received: (qmail 27069 invoked from network); 16 Feb 2007 04:01:37 -0000
Received: from vms042pub.verizon.net (206.46.252.42)
  by a.mx.sunsite.dk with SMTP; 16 Feb 2007 04:01:31 -0000
Received: from torch.brasslantern.com ([71.116.79.148])
 by vms042.mailsrvcs.net (Sun Java System Messaging Server 6.2-6.01 (built Apr
 3 2006)) with ESMTPA id <0JDJ00KPZF6DI7V6@vms042.mailsrvcs.net> for
 zsh-users@sunsite.dk; Thu, 15 Feb 2007 22:01:26 -0600 (CST)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id l1G41O4M028838	for
 <zsh-users@sunsite.dk>; Thu, 15 Feb 2007 20:01:25 -0800
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id l1G41NRb028837	for zsh-users@sunsite.dk; Thu,
 15 Feb 2007 20:01:23 -0800
Date: Thu, 15 Feb 2007 20:01:23 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: "script" trickery
In-reply-to: <20070216.041058.75192333.Meino.Cramer@gmx.de>
To: zsh-users@sunsite.dk
Message-id: <070215200123.ZM28836@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <20070216.041058.75192333.Meino.Cramer@gmx.de>
Comments: In reply to Meino Christian Cramer <Meino.Cramer@gmx.de>
 ""script" trickery" (Feb 16,  4:10am)

On Feb 16,  4:10am, Meino Christian Cramer wrote:
}
}  I tried to write a shell function for my .zshrc which first checks 
}  for the existence of the given file and then starts script.
} 
}  But that fails due to the fact that "script" seems to start a subshel
}  or do other trickery.

Well, yes, it starts a subshell, but that shouldn't prevent a function
in the calling shell from testing for the existence of the file before
script even gets started.

    function script {
      emulate -L zsh
      setopt noclobber
      zmodload -i zsh/zutil
      local -a opts
      zparseopts -D -a opts a c: f q t  
      set -- "${@:-typescript}"
      if [[ -e $1 ]]; then
        print -u2 script: file exists: $1
	return 1
      fi
      command script $opts $*
    }
 

