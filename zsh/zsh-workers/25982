From zsh-workers-return-25982-mason-zsh=primenet.com.au@sunsite.dk Fri Oct 31 10:00:41 2008
Return-Path: <zsh-workers-return-25982-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 7218 invoked from network); 31 Oct 2008 10:00:28 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.2 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 31 Oct 2008 10:00:28 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 34209 invoked from network); 31 Oct 2008 10:00:20 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 31 Oct 2008 10:00:20 -0000
Received: (qmail 81 invoked by alias); 31 Oct 2008 10:00:15 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 25982
Received: (qmail 65 invoked from network); 31 Oct 2008 10:00:15 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 31 Oct 2008 10:00:15 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [208.87.233.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 2414C80524C0
	for <zsh-workers@sunsite.dk>; Fri, 31 Oct 2008 11:00:09 +0100 (CET)
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly06g.srv.mailcontrol.com (MailControl) with ESMTP id m9V9vSvt006635
	for <zsh-workers@sunsite.dk>; Fri, 31 Oct 2008 09:59:34 GMT
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Fri, 31 Oct 2008 09:58:33 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.2/8.13.4) with ESMTP id m9V9wSUF005556
	for <zsh-workers@sunsite.dk>; Fri, 31 Oct 2008 09:58:28 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.2/8.14.2/Submit) with ESMTP id m9V9wRRg005552
	for <zsh-workers@sunsite.dk>; Fri, 31 Oct 2008 09:58:28 GMT
Message-Id: <200810310958.m9V9wRRg005552@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: "Zsh workers" <zsh-workers@sunsite.dk>
Subject: Re: another bug: zsh_directory_name
In-reply-to: <22701.1225446292@thecus>
References: <200810302213.m9UMD2Mi012011@pws-pc.ntlworld.com> <22701.1225446292@thecus>
Comments: In-reply-to Oliver Kiddle <okiddle@yahoo.co.uk>
   message dated "Fri, 31 Oct 2008 10:44:52 +0100."
Date: Fri, 31 Oct 2008 09:58:27 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 31 Oct 2008 09:58:33.0228 (UTC) FILETIME=[3BFE74C0:01C93B3F]
X-Scanned-By: MailControl A-08-50-15 (www.mailcontrol.com) on 10.71.0.116
X-Virus-Scanned: ClamAV 0.92.1/8547/Fri Oct 31 10:27:15 2008 on bifrost
X-Virus-Status: Clean

Oliver Kiddle wrote:
> Peter Stephenson wrote:
> > so the problem is that the max function depth is too large on those
> > systems (or, equivalently, the resource limits are too small).
> 
> Probably so but it should be noted that I get the seg fault on systems
> with 4.3.9 where older versions of zsh print the "maximum nested function
> level reached" message. Has some change meant that more stack space is
> being used than before when calling functions recursively?

The function stack debugging information is now larger.

It also runs a dupstring() at each level to save the name of the file
from which the function was loaded; although this doesn't affect the
stack, it is quite inefficent, but I think the "shfunc" structure can be
removed at any time so it's not easy to do better.

We can reduce the maximum function depth if it's getting flaky on too
many systems.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

