From zsh-workers-return-19269-mason-zsh=primenet.com.au@sunsite.dk Wed Dec 03 10:47:43 2003
Return-Path: <zsh-workers-return-19269-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15324 invoked from network); 3 Dec 2003 10:47:42 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 3 Dec 2003 10:47:42 -0000
Received: (qmail 22716 invoked by alias); 3 Dec 2003 10:47:36 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19269
Received: (qmail 22666 invoked from network); 3 Dec 2003 10:47:35 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 3 Dec 2003 10:47:35 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [62.189.183.235] by sunsite.dk (MessageWall 1.0.8) with SMTP; 3 Dec 2003 10:47:35 -0000
Received: from EXCHANGE02.csr.com (unverified) by MAILSWEEPER01.csr.com
 (Content Technologies SMTPRS 4.3.10) with ESMTP id <T66481bbdd4c0a88d017e8@MAILSWEEPER01.csr.com>;
 Wed, 3 Dec 2003 10:47:21 +0000
Received: from csr.com ([192.168.144.127]) by EXCHANGE02.csr.com with Microsoft SMTPSVC(5.0.2195.5329);
	 Wed, 3 Dec 2003 10:48:48 +0000
To: Ulrik Haugen <qha@lysator.liu.se>
cc: zsh-workers@sunsite.dk
Subject: Re: Probable bug in zsh 4.x 
In-reply-to: "Ulrik Haugen"'s message of "Wed, 03 Dec 2003 00:42:44 +0100."
             <873cc2947f.fsf@haugen.visit.se> 
Date: Wed, 03 Dec 2003 10:47:23 +0000
Message-ID: <22215.1070448443@csr.com>
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 03 Dec 2003 10:48:48.0880 (UTC) FILETIME=[0862EF00:01C3B98B]

Ulrik Haugen wrote:
> I think I've found a bug in zsh versions 4.0.7 and 4.1.1.
> 
> Globbing with character classes doesn't work with local Swedish
> characters.

Thanks, that's been around ever since the pattern code was rewritten.
It would only show up where chars are signed.  See if this makes it go
away.

Index: Src/pattern.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/pattern.c,v
retrieving revision 1.15
diff -u -r1.15 pattern.c
--- Src/pattern.c	29 Oct 2003 19:17:30 -0000	1.15
+++ Src/pattern.c	3 Dec 2003 10:44:10 -0000
@@ -2265,7 +2265,7 @@
 		DPUTS(1, "BUG: unknown metacharacter in range.");
 		break;
 	    }
-	} else if (*range == ch)
+	} else if (STOUC(*range) == ch)
 	    return 1;
     }
     return 0;
Index: Misc/globtests
===================================================================
RCS file: /cvsroot/zsh/zsh/Misc/globtests,v
retrieving revision 1.2
diff -u -r1.2 globtests
--- Misc/globtests	6 Apr 2000 18:44:01 -0000	1.2
+++ Misc/globtests	3 Dec 2003 10:44:11 -0000
@@ -179,5 +179,6 @@
 f path/testy    *((#s)|/)test((#e)|/)*
 f path/testy/ohyes *((#s)|/)test((#e)|/)*
 f path/atest/ohyes *((#s)|/)test((#e)|/)*
+t björn		*[åäöÅÄÖ]*
 EOT
 print "$failed tests failed."
Index: Test/D02glob.ztst
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/D02glob.ztst,v
retrieving revision 1.2
diff -u -r1.2 D02glob.ztst
--- Test/D02glob.ztst	26 Mar 2003 17:33:40 -0000	1.2
+++ Test/D02glob.ztst	3 Dec 2003 10:44:11 -0000
@@ -174,6 +174,7 @@
 >1:  [[ path/testy = *((#s)|/)test((#e)|/)* ]]
 >1:  [[ path/testy/ohyes = *((#s)|/)test((#e)|/)* ]]
 >1:  [[ path/atest/ohyes = *((#s)|/)test((#e)|/)* ]]
+>0:  [[ björn = *[åäöÅÄÖ]* ]]
 >0 tests failed.
 
   globtest globtests.ksh

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR Ltd., Science Park, Milton Road,
Cambridge, CB4 0WH, UK                          Tel: +44 (0)1223 692070


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
the system manager.

This footnote also confirms that this email message has been swept by
MIMEsweeper for the presence of computer viruses.

www.mimesweeper.com
**********************************************************************

