From zsh-users-return-12990-mason-zsh=primenet.com.au@sunsite.dk Sat Jun 28 17:49:57 2008
Return-Path: <zsh-users-return-12990-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6565 invoked from network); 28 Jun 2008 17:49:55 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 28 Jun 2008 17:49:55 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 40476 invoked from network); 28 Jun 2008 17:49:30 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Jun 2008 17:49:30 -0000
Received: (qmail 21405 invoked by alias); 28 Jun 2008 17:49:09 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12990
Received: (qmail 21391 invoked from network); 28 Jun 2008 17:49:08 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 28 Jun 2008 17:49:08 -0000
Received: from news.zipcon.net (news.zipcon.net [209.221.136.9])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id B428B80524FA
	for <zsh-users@sunsite.dk>; Sat, 28 Jun 2008 19:49:03 +0200 (CEST)
Received: from owl.localnet (dsl-63-249-22-9.zipcon.net [63.249.22.9])
	by news.zipcon.net (8.13.1/8.13.1) with ESMTP id m5SHnU0U000592
	for <zsh-users@sunsite.dk>; Sat, 28 Jun 2008 10:49:31 -0700
Received: by owl.localnet (Postfix, from userid 1000)
	id 3585B300E8320; Sat, 28 Jun 2008 10:48:59 -0700 (PDT)
From: David Bitseff <dbitsef@zipcon.net>
To: zsh-users@sunsite.dk
Subject: zle history and cursor position
Date: Sat, 28 Jun 2008 10:48:58 -0700
User-Agent: KMail/1.9.52 (Linux/2.6.25.9; KDE/4.0.84; i686; ; )
MIME-Version: 1.0
Content-Type: Multipart/Mixed;
  boundary="Boundary-00=_KmnZISk1zGD5ia/"
Message-Id: <200806281048.58647.dbitsef@zipcon.net>
X-Virus-Scanned: ClamAV 0.92.1/7583/Sat Jun 28 17:00:59 2008 on bifrost
X-Virus-Status: Clean

--Boundary-00=_KmnZISk1zGD5ia/
Content-Type: text/plain;
  charset="us-ascii"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

I've found this useful, so I thought I'd share.  When you hit return it saves 
the cursor position, and then it's restored when moving to the last command in 
the history.

You need to have the cursor somewhere in the middle of the middle of the line 
when hitting enter to see it work.  Then press the up arrow.



--Boundary-00=_KmnZISk1zGD5ia/
Content-Type: text/plain;
  charset="us-ascii";
  name="zle-cursor-position"
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment;
	filename="zle-cursor-position"

### restore the cursor position when calling up/down-history ###
typeset -gi last_cursor_position=0
accept-line() {
	last_cursor_position=$CURSOR
	zle .accept-line
}
up-line-or-history() {
	zle .up-line-or-history
	if [[  $(( $HISTNO + 1 )) -ge $HISTCMD && $BUFFERLINES -eq 1 ]] ; then
		CURSOR=$last_cursor_position
	fi
}
down-line-or-history () {
	zle .down-line-or-history
	if [[ $(( $HISTNO + 1 )) -ge $HISTCMD && $BUFFERLINES -eq 1 ]] ; then
		CURSOR=$last_cursor_position
	fi
}

zle -N accept-line
zle -N up-line-or-history
zle -N down-line-or-history


# Local Variables:
# vim:filetype=sh
# End:

--Boundary-00=_KmnZISk1zGD5ia/--

