From zsh-workers-return-12477-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Aug 02 09:36:55 2000
Return-Path: <zsh-workers-return-12477-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14588 invoked from network); 2 Aug 2000 09:36:49 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 2 Aug 2000 09:36:49 -0000
Received: (qmail 20493 invoked by alias); 2 Aug 2000 09:36:33 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12477
Received: (qmail 20486 invoked from network); 2 Aug 2000 09:36:27 -0000
Date: Wed, 2 Aug 2000 11:36:10 +0200 (MET DST)
Message-Id: <200008020936.LAA08517@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Adam Spiers's message of Tue, 1 Aug 2000 17:31:52 +0100
Subject: Re: PATCH: completion caching layer


Adam Spiers wrote:

> ...
> 
> OK, I've implemented this via the 'cache-policy' style, which should
> contain the name of a function which returns zero iff the cache needs
> rebuilding.  _cache_invalid is a helper function which makes it easy
> to perform this calculation.
> 
> Here's the patch (with documentation too, woohoo!)  It's quite big,
> mainly because of reindentation.  I'd be very grateful if one or two
> people could give it a quick thrashing to see whether I've
> missed/broken anything (it seems fine for me but ...)  I'll commit it
> if it works for someone else or if I get bored of waiting for people
> to try :-)

It's a bit unfortunate that _cache_invalid can be called twice (in
your examples), once directly and once from _retrieve_cache. I think.

And why do _cache_invalid and _retrieve_cache re-define themselves?
There's nothing else in the files (_retrieve_cache doesn't even call
its new definition). Or have I missed something?

And the styles or not in the style list in compsys.yo. Nor in _zstyle
(I always forget that, too ;-).

About the lookup: I /think/ it would be more convenient if the type of 
information cached would appear in the context, so that you could say
`zstyle ":completion:*:rpms" cache-policy ...'. Haven't really played
with it yet, though.

And another thing: with `zstyle -e' one could use a boolean style
`cache-invalid' or whatever and let the user do the rest. It's hard to 
give arguments to that, though. Other than by documenting
$_cache_path, that is.


Minor comment: `foo && return 0' is both smaller and faster than
`if foo; then return 0; fi'. But since I may have done that myself,
I'll better not say this too loudly ;-}

Bye
 Sven


--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

