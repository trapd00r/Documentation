From zsh-workers-return-20821-mason-zsh=primenet.com.au@sunsite.dk Fri Feb 18 13:46:01 2005
Return-Path: <zsh-workers-return-20821-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8671 invoked from network); 18 Feb 2005 13:46:01 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 18 Feb 2005 13:46:01 -0000
Received: (qmail 7183 invoked from network); 18 Feb 2005 13:45:55 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 18 Feb 2005 13:45:55 -0000
Received: (qmail 18472 invoked by alias); 18 Feb 2005 13:45:50 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20821
Received: (qmail 18458 invoked from network); 18 Feb 2005 13:45:49 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 18 Feb 2005 13:45:49 -0000
Received: (qmail 6846 invoked from network); 18 Feb 2005 13:45:49 -0000
Received: from vinc17.net4.nerim.net (HELO ay.vinc17.org) (62.212.121.106)
  by a.mx.sunsite.dk with SMTP; 18 Feb 2005 13:45:37 -0000
Received: from lefevre by ay.vinc17.org with local (Exim 4.34)
	id 1D28Rr-0006mV-CC; Fri, 18 Feb 2005 14:45:35 +0100
Date: Fri, 18 Feb 2005 14:45:35 +0100
From: Vincent Lefevre <vincent@vinc17.org>
To: zsh-workers@sunsite.dk
Subject: stat on Linux/x86_64 (was: zsh on Opteron (Linux) and limit)
Message-ID: <20050218134534.GA25272@ay.vinc17.org>
Mail-Followup-To: Vincent Lefevre <vincent@vinc17.org>,
	zsh-workers@sunsite.dk
References: <20050215125144.GI19378@ay.vinc17.org> <20050215125815.GA17248@scowler.net> <20050215155912.GN19378@ay.vinc17.org> <20050217165423.GN19378@ay.vinc17.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <20050217165423.GN19378@ay.vinc17.org>
X-Mailer-Info: http://www.vinc17.org/mutt/
User-Agent: Mutt/1.5.8-vl-20050218i
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.5

[I'm sending this reply from zsh-users to zsh-workers; I'm not
subscribed to zsh-workers, make sure I'm Cc'ed in the replies.
Thanks.]

On 2005-02-17 17:54:23 +0100, Vincent Lefevre wrote:
> and if I use the stat builtin with ~hc/bin/zsh, I get:
> 
> Shell compiled with wrong ino_t size
> Shell compiled with wrong off_t size

Concerning this problem, here's an excerpt of my config.log:

[...]
configure:8246: checking if long is 64 bits
configure:8263: gcc -o conftest  -Wall -Wmissing-prototypes -ggdb  -g conftest.c -ldl -lnsl -lcurses -lm  -lc >&5
configure:8266: $? = 0
configure:8268: ./conftest
configure:8271: $? = 0
configure:8285: result: yes
configure:8799: checking for sigset_t
[...]

In the configure.ac file:

 Note that ZSH_64_BIT_TYPE, OFF_T_IS_64_BIT, INO_T_IS_64_BIT do *not* get
 defined if long is already 64 bits, since in that case no special handling
 is required.

Are you sure?

In the Src/Modules/stat.c file:

    case ST_INO:
#ifdef INO_T_IS_64_BIT
        convbase(optr, sbuf->st_ino, 0);
#else
        DPUTS(sizeof(sbuf->st_ino) > 4,
              "Shell compiled with wrong ino_t size");
        statulprint((unsigned long)sbuf->st_ino, optr);
#endif
        break;

-- 
Vincent Lefèvre <vincent@vinc17.org> - Web: <http://www.vinc17.org/>
100% accessible validated (X)HTML - Blog: <http://www.vinc17.org/blog/>
Work: CR INRIA - computer arithmetic / SPACES project at LORIA

