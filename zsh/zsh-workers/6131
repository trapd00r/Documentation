From zsh-workers-return-6131-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Apr 28 08:16:06 1999
Return-Path: <zsh-workers-return-6131-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24737 invoked from network); 28 Apr 1999 08:16:01 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 28 Apr 1999 08:16:01 -0000
Received: (qmail 5207 invoked by alias); 28 Apr 1999 08:15:46 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6131
Received: (qmail 5199 invoked from network); 28 Apr 1999 08:15:42 -0000
Message-Id: <9904280751.AA15306@ibmth.df.unipi.it>
To: Ville Herva <vherva@babbage.tky.hut.fi>,
        zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: Re: [Solved] Re: Terminal problem with linux-2.0.34 
In-Reply-To: "Ville Herva"'s message of "Wed, 28 Apr 1999 00:14:46 DFT."
             <19990428001446.A4114@babbage.tky.hut.fi> 
Date: Wed, 28 Apr 1999 09:51:16 +0200
From: Peter Stephenson <pws@ibmth.df.unipi.it>

Ville Herva wrote:
> This proved to be the select call in line 517 in Zle/zle_main.c (zsh-3.1.5
> vanilla):       
>                 
>                 if (!kungetct && select(SHTTY+1, (SELECT_ARG_2_T) & foofd,
>                                         NULL, NULL, &tv) <= 0)
> 
> If I add the following line before the above call, zsh works well:
>                 
>                 tv.tv_sec = 0;

Thanks, this is the diff for 3.1.5-pws-16 (Bart's already put something into
3.0.6).

--- Src/Zle/zle_main.c.tv	Mon Apr 19 11:40:09 1999
+++ Src/Zle/zle_main.c	Wed Apr 28 09:48:30 1999
@@ -413,7 +413,6 @@
 
     baud = getiparam("BAUD");
     costmult = (baud) ? 3840000L / baud : 0;
-    tv.tv_sec = 0;
 #endif
 
     /* ZLE doesn't currently work recursively.  This is needed in case a *
@@ -523,6 +522,7 @@
 #ifdef HAVE_SELECT
 	    if (baud && !(lastcmd & ZLE_MENUCMP)) {
 		FD_SET(SHTTY, &foofd);
+		tv.tv_sec = 0;
 		if ((tv.tv_usec = cost * costmult) > 500000)
 		    tv.tv_usec = 500000;
 		if (!kungetct && select(SHTTY+1, (SELECT_ARG_2_T) & foofd,

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

