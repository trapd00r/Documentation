From zsh-workers-return-6200-mason-zsh=primenet.com.au@sunsite.auc.dk Mon May 03 10:29:18 1999
Return-Path: <zsh-workers-return-6200-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 214 invoked from network); 3 May 1999 10:29:16 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 3 May 1999 10:29:16 -0000
Received: (qmail 19387 invoked by alias); 3 May 1999 10:29:03 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6200
Received: (qmail 19310 invoked from network); 3 May 1999 10:26:52 -0000
Message-Id: <9905031000.AA21091@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: Re: User installation script for new completion 
In-Reply-To: "Bruce Stephens"'s message of "02 May 1999 15:56:38 DFT."
             <m3so9f5xll.fsf@cenderis.demon.co.uk> 
Date: Mon, 03 May 1999 12:00:42 +0200
From: Peter Stephenson <pws@ibmth.df.unipi.it>

Bruce Stephens wrote:
> > +#  - Probably should allow a set of directories to be added to $fpath,
> > +#    like Core, Base, etc.
> 
> Yes, probably.  Couldn't compinit do this, though?  i.e., it could
> look at the directory it's in for subdirectories, and add them?

Not quite what you suggested, but it should simplify installation when I
modify compinstall:  compinit looks at how many completion files it has
found, and if there are fewer than twenty (that's about the number in the
Core directory) it adds the path to itself to fpath.  I haven't quite
worked out on what occasions it should look for subdirectories.

This fails when functionargzero is not set.  Great.  Any better
suggestions?

--- Completion/Core/compinit.old	Mon May  3 09:54:38 1999
+++ Completion/Core/compinit	Mon May  3 11:54:13 1999
@@ -272,6 +272,11 @@
 
 typeset -U _i_files
 _i_files=( ${^~fpath}/_(|*[^~])(N:t) )
+if [[ $#_i_files -lt 20 && $0 = */* ]]; then
+  # Assume that we need to add the compinit directory to fpath.
+  fpath=(${0:h} $fpath)
+  _i_files=( ${^~fpath}/_(|*[^~])(N:t) )
+fi
 _i_initname=$0
 _i_done=''
 
-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

