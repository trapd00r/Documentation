<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux (vers 25 March 2009), see www.w3.org">
  <meta http-equiv="Content-Type" content=
  "text/html; charset=utf-8">

  <title>Git Magic - 章 7. Git大師技</title>
  <link rel="stylesheet" href="default.css" type="text/css">
  <meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
  <link rel="home" href="index.html" title="Git 魔法">
  <link rel="up" href="index.html" title="Git 魔法">
  <link rel="prev" href="ch06.html" title="章 6. 多人Git">
  <link rel="next" href="ch08.html" title="章 8. 揭開面紗">
</head>

<body bgcolor="white" text="black" link="#0000FF" vlink="#840084"
alink="#0000FF">
    <div class="toc">
      <ul>
<li><b>Git Magic</b></li>
        <li>
          <span class="preface"><a href="index.html">前言</a></span>

          <ul>
            <li><span class="section"><a href=
            "index.html#_%E8%87%B4%E8%AC%9D">致謝！</a></span></li>

            <li><span class="section"><a href=
            "index.html#_%E8%A8%B1%E5%8F%AF">許可</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch01.html">1.
          入門</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch01.html#_%E5%B7%A5%E4%BD%9C%E6%98%AF%E7%8E%A9">工作是玩</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6">版本控制</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_%E5%88%86%E4%BD%88%E6%8E%A7%E5%88%B6">分佈控制</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_%E4%B8%80%E5%80%8B%E8%AA%A4%E5%8D%80">一個誤區</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_%E5%90%88%E4%BD%B5%E8%A1%9D%E7%AA%81">合併衝突</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch02.html">2.
          基本技巧</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch02.html#_%E4%BF%9D%E5%AD%98%E7%8B%80%E6%85%8B">保存狀態</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E6%B7%BB%E5%8A%A0_%E5%88%AA%E9%99%A4_%E9%87%8D%E5%91%BD%E5%90%8D">
            添加、刪除、重命名</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E9%80%B2%E9%9A%8E%E6%92%A4%E9%8A%B7_%E9%87%8D%E5%81%9A">
            進階撤銷/重做</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E6%92%A4%E9%8A%B7">撤銷</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E8%AE%8A%E6%9B%B4%E6%97%A5%E8%AA%8C%E7%94%9F%E6%88%90">
            變更日誌生成</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E4%B8%8B%E8%BC%89%E6%AA%94%E6%A1%88">下載檔案</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E5%88%B0%E6%9C%80%E6%96%B0">到最新</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E5%BF%AB%E9%80%9F%E7%99%BC%E4%BD%88">快速發佈</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E6%88%91%E5%80%91%E5%B7%B2%E7%B6%93%E5%81%9A%E4%BA%86%E4%BB%80%E9%BA%BC">
            我們已經做了什麼？</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_%E7%B7%B4%E7%BF%92">練習</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch03.html">3.
          克隆周邊</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch03.html#_%E8%A8%88%E7%AE%97%E6%A9%9F%E9%96%93%E5%90%8C%E6%AD%A5">
            計算機間同步</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E5%85%B8%E5%9E%8B%E6%BA%90%E7%A2%BC%E6%8E%A7%E5%88%B6">
            典型源碼控制</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E5%B0%81%E9%96%89%E6%BA%90%E7%A2%BC">封閉源碼</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E8%A3%B8%E5%80%89%E5%BA%AB">裸倉庫</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E6%8E%A8%E9%82%84%E6%98%AF%E6%8B%BD">推還是拽</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E9%A0%85%E7%9B%AE%E5%88%86%E5%8F%89">項目分叉</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E7%B5%82%E6%A5%B5%E5%82%99%E4%BB%BD">終極備份</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E8%BC%95%E5%BF%AB%E5%A4%9A%E4%BB%BB%E5%8B%99">
            輕快多任務</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E6%B8%B8%E6%93%8A%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6">
            游擊版本控制</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_mercurial">Mercurial</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_bazaar">Bazaar</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_%E6%88%91%E5%81%8F%E6%84%9Bgit%E7%9A%84%E5%8E%9F%E5%9B%A0">
            我偏愛Git的原因</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch04.html">4.
          分支巫術</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch04.html#_%E8%80%81%E9%97%86%E9%8D%B5">老闆鍵</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E9%AA%AF%E9%AB%92%E7%9A%84%E5%B7%A5%E4%BD%9C">
            骯髒的工作</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E5%BF%AB%E9%80%9F%E4%BF%AE%E8%A8%82">快速修訂</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E5%90%88%E4%BD%B5">合併</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E4%B8%8D%E9%96%93%E6%96%B7%E5%B7%A5%E4%BD%9C%E6%B5%81">
            不間斷工作流</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E9%87%8D%E7%B5%84%E9%9B%9C%E4%BA%82">重組雜亂</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E7%AE%A1%E7%90%86%E5%88%86%E6%94%AF">管理分支</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E8%87%A8%E6%99%82%E5%88%86%E6%94%AF">臨時分支</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_%E6%8C%89%E4%BD%A0%E5%B8%8C%E6%9C%9B%E7%9A%84%E6%96%B9%E5%BC%8F%E5%B7%A5%E4%BD%9C">
            按你希望的方式工作</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch05.html">5.
          關於歷史</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch05.html#_%E6%88%91%E8%AA%8D%E9%8C%AF">我認錯</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_%E6%9B%B4%E8%A4%87%E9%9B%9C%E6%83%85%E6%B3%81">
            更複雜情況</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_%E6%9C%AC%E5%9C%B0%E8%AE%8A%E6%9B%B4%E4%B9%8B%E5%BE%8C">
            本地變更之後</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_%E9%87%8D%E5%AF%AB%E6%AD%B7%E5%8F%B2">重寫歷史</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_%E8%A3%BD%E9%80%A0%E6%AD%B7%E5%8F%B2">製造歷史</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_%E5%93%AA%E5%85%92%E9%8C%AF%E4%BA%86">哪兒錯了？</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_%E8%AA%B0%E8%AE%93%E4%BA%8B%E6%83%85%E8%AE%8A%E7%B3%9F%E4%BA%86">
            誰讓事情變糟了？</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_%E5%80%8B%E4%BA%BA%E7%B6%93%E9%A9%97">個人經驗</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch06.html">6.
          多人Git</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch06.html#_%E6%88%91%E6%98%AF%E8%AA%B0">我是誰？</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_git%E5%9C%A8ssh_http%E4%B8%8A">Git在SSH,
            HTTP上</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_git%E5%9C%A8%E9%9A%A8%E4%BE%BF%E4%BB%80%E9%BA%BC%E4%B8%8A">
            Git在隨便什麼上</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_%E8%A3%9C%E4%B8%81_%E5%85%A8%E7%90%83%E8%B2%A8%E5%B9%A3">
            補丁：全球貨幣</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_%E5%B0%8D%E4%B8%8D%E8%B5%B7_%E7%A7%BB%E8%B5%B0%E4%BA%86">
            對不起，移走了</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_%E9%81%A0%E7%AB%AF%E5%88%86%E6%94%AF">遠端分支</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_%E5%A4%9A%E9%81%A0%E7%AB%AF">多遠端</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_%E6%88%91%E7%9A%84%E5%96%9C%E5%A5%BD">我的喜好</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch07.html">7.
          Git大師技</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch07.html#_%E6%BA%90%E7%A2%BC%E7%99%BC%E4%BD%88">源碼發佈</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_%E6%8F%90%E4%BA%A4%E8%AE%8A%E6%9B%B4">提交變更</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_%E6%88%91%E7%9A%84%E6%8F%90%E4%BA%A4%E5%A4%AA%E5%A4%A7%E4%BA%86">
            我的提交太大了！</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_%E7%B4%A2%E5%BC%95_git%E7%9A%84%E4%B8%AD%E8%BD%89%E5%8D%80%E5%9F%9F">
            索引：Git的中轉區域</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_%E5%88%A5%E4%B8%9F%E4%BA%86%E4%BD%A0%E7%9A%84head">
            別丟了你的HEAD</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_head%E6%8D%95%E7%8D%B5">HEAD捕獵</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_%E5%9F%BA%E4%BA%8Egit%E6%A7%8B%E5%BB%BA">基于Git構建</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_%E5%A4%A7%E8%86%BD%E7%9A%84%E7%89%B9%E6%8A%80">
            大膽的特技</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_%E9%98%BB%E6%AD%A2%E5%A3%9E%E6%8F%90%E4%BA%A4">
            阻止壞提交</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch08.html">8.
          揭開面紗</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch08.html#_%E5%A4%A7%E8%B1%A1%E7%84%A1%E5%BD%A2">大象無形</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_%E6%95%B8%E6%93%9A%E5%AE%8C%E6%95%B4%E6%80%A7">
            數據完整性</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_%E6%99%BA%E8%83%BD">智能</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_%E7%B4%A2%E5%BC%95">索引</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_git%E7%9A%84%E6%BA%90%E8%B5%B7">Git的源起</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_%E5%B0%8D%E8%B1%A1%E8%B3%87%E6%96%99%E5%BA%AB">
            對象資料庫</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_blob%E5%B0%8D%E8%B1%A1">Blob對象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_tree%E5%B0%8D%E8%B1%A1">Tree對象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_commit%E5%B0%8D%E8%B1%A1">Commit對象</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_%E6%B2%92%E9%82%A3%E9%BA%BC%E7%A5%9E">沒那麼神</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch09.html">9. 附錄 A:
          Git的缺點</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch09.html#_sha1_%E7%9A%84%E5%BC%B1%E9%BB%9E">SHA1
            的弱點</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E5%BE%AE%E8%BB%9F_windows">微軟
            Windows</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E4%B8%8D%E7%9B%B8%E9%97%9C%E7%9A%84%E6%AA%94%E6%A1%88">
            不相關的檔案</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E8%AA%B0%E5%9C%A8%E7%B7%A8%E8%BC%AF%E4%BB%80%E9%BA%BC">
            誰在編輯什麼？</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E6%AA%94%E6%A1%88%E6%AD%B7%E5%8F%B2">檔案歷史</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E5%88%9D%E5%A7%8B%E5%85%8B%E9%9A%86">初始克隆</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E4%B8%8D%E7%A9%A9%E5%AE%9A%E7%9A%84%E9%A0%85%E7%9B%AE">
            不穩定的項目</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E5%85%A8%E5%B1%80%E8%A8%88%E6%95%B8%E5%99%A8">
            全局計數器</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E7%A9%BA%E5%AD%90%E7%9B%AE%E9%8C%84">空子目錄</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E5%88%9D%E5%A7%8B%E6%8F%90%E4%BA%A4">初始提交</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_%E4%BB%8B%E9%9D%A2%E6%80%AA%E7%99%96">介面怪癖</a></span></li>
          </ul>
        </li>

        <li><span class="chapter"><a href="ch10.html">10. 附錄 B:
        本指南的翻譯</a></span></li>
      </ul>
    </div>
<div class="content">
  <div class="chapter" title="章 7. Git大師技">
    <div class="titlepage">
      <div>
        <div>
          <h2 class="title"><a name=
          "_git%E5%A4%A7%E5%B8%AB%E6%8A%80"></a>章 7. Git大師技</h2>
        </div>
      </div>
    </div>

    <p>到現在，你應該有能力查閲 <span class="strong"><strong>git
    help</strong></span> 頁，並理解几乎所有東西。然而，查明解決特
    定問題需要的確切命令可能是乏味的。或許我可以省你點功夫：以下是我過去曾經需要 的一些食譜。</p>

    <div class="section" title="源碼發佈">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E6%BA%90%E7%A2%BC%E7%99%BC%E4%BD%88"></a>源碼發佈</h2>
          </div>
        </div>
      </div>

      <p>就我的項目而言，Git完全跟蹤了我想打包並發佈給用戶的檔案。創建一個源碼包，我運 行：</p>
      <pre class="literallayout">
$ git archive --format=tar --prefix=proj-1.2.3/ HEAD
</pre>
    </div>

    <div class="section" title="提交變更">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E6%8F%90%E4%BA%A4%E8%AE%8A%E6%9B%B4"></a>提交變更</h2>
          </div>
        </div>
      </div>

      <p>對特定項目而言，告訴Git你增加，刪除和重命名了一些檔案很麻煩。而鍵入如下命令會容易的多：</p>
      <pre class="literallayout">
$ git add .
$ git add -u
</pre>

      <p>Git將查找當前目錄的檔案並自己算出具體的情況。除了用第二個add命令，如果你也打 算這時提交，可以運行`git
      commit -a`。關於如何指定應被忽略的檔案，參見 <span class="strong"><strong>git
      help ignore</strong></span> 。</p>

      <p>你也可以用一行命令完成以上任務：</p>
      <pre class="literallayout">
$ git ls-files -d -m -o -z | xargs -0 git update-index --add --remove
</pre>

      <p>這裡 <span class="strong"><strong>-z</strong></span> 和
      <span class="strong"><strong>-0</strong></span>
      選項可以消除包含特殊字元的檔案名引起的不良副作用。注意這個 命令也添加應被忽略的檔案，這時你可能需要加上
      <code class="literal">-x</code> 或 <code class=
      "literal">-X</code> 選項。</p>
    </div>

    <div class="section" title="我的提交太大了！">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E6%88%91%E7%9A%84%E6%8F%90%E4%BA%A4%E5%A4%AA%E5%A4%A7%E4%BA%86">
            </a>我的提交太大了！</h2>
          </div>
        </div>
      </div>

      <p>是不是忽視提交太久了？痴迷地編碼，直到現在才想起有源碼控制工具這回事？提交一
      系列不相關的變更，因為那是你的風格？</p>

      <p>別擔心，運行：</p>
      <pre class="literallayout">
$ git add -p
</pre>

      <p>為你做的每次修改，Git將展示給你變動的代碼，並詢問該變動是否應是下一次提交的一
      部分。回答“y”或者“n”。也有其他選項，比如延遲決定；鍵入“？”來學習更多。</p>

      <p>一旦你滿意，鍵入</p>
      <pre class="literallayout">
$ git commit
</pre>

      <p>來精確地提交你所選擇的變更（階段變更）。確信你沒加上 <span class=
      "strong"><strong>-a</strong></span> 選項，否則Git將提交 所有修改。</p>

      <p>如果你修改了許多地方的許多檔案怎麼辦？一個一個地查看變更令人沮喪，心態麻木。 這種情況下，使用
      <span class="strong"><strong>git add -i</strong></span> ，
      它的界面不是很直觀，但更靈活。敲幾個鍵，你可 以一次決定階段或非階段性提交幾個檔案，或查看並只選擇特定檔案的變更。作為另一
      種選擇，你還可以運行 <span class="strong"><strong>git commit
      --interactive</strong></span> ，這個命令會在你操作完後自動 進行提交。</p>
    </div>

    <div class="section" title="索引：Git的中轉區域">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E7%B4%A2%E5%BC%95_git%E7%9A%84%E4%B8%AD%E8%BD%89%E5%8D%80%E5%9F%9F">
            </a>索引：Git的中轉區域</h2>
          </div>
        </div>
      </div>

      <p>當目前為止，我們已經忽略Git著名的'索引‘概念，但現在我們必須面對它，以解釋上
      面發生的。索引是一個臨時中轉區。Git很少在你的項目和它的歷史之間直接倒騰數據。
      通常，Git先寫數據到索引，然後拷貝索引中的數據到最終目的地。</p>

      <p>例如， <span class="strong"><strong>commit -a</strong></span>
      實際上是一個兩步過程。第一步把每個追蹤檔案當前狀態的快照放 到索引中。第二步永久記錄索引中的快照。 沒有
      <span class="strong"><strong>-a</strong></span>
      的提交只執行第二步，並且只在 運行不知何故改變索引的命令才有意義，比如 <span class=
      "strong"><strong>git add</strong></span> 。</p>

      <p>通常我們可以忽略索引並假裝從歷史中直接讀並直接寫。在這個情況下，我們希望更好
      地控制，因此我們操作索引。我們放我們變更的一些的快照到索引中，而不是所有的， 然後永久地記錄這個小心操縱的快照。</p>
    </div>

    <div class="section" title="別丟了你的HEAD">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E5%88%A5%E4%B8%9F%E4%BA%86%E4%BD%A0%E7%9A%84head"></a>別丟了你的HEAD</h2>
          </div>
        </div>
      </div>

      <p>HEAD好似一個游標，通常指向最新提交，隨最新提交向前移動。一些Git命令讓你來移動 它。 例如：</p>
      <pre class="literallayout">
$ git reset HEAD~3
</pre>

      <p>將立即向回移動HEAD三個提交。這樣所有Git命令都表現得好似你沒有做那最後三個提交，
      然而你的檔案保持在現在的狀態。具體應用參見幫助頁。</p>

      <p>但如何回到將來呢？過去的提交對將來一無所知。</p>

      <p>如果你有原先Head的SHA1值，那麼：</p>
      <pre class="literallayout">
$ git reset 1b6d
</pre>

      <p>但假設你從來沒有記下呢？別擔心，像這些命令，Git保存原先的Head為一個叫
      ORGI_HEAD的標記，你可以安全體面的返回：</p>
      <pre class="literallayout">
$ git reset ORIG_HEAD
</pre>
    </div>

    <div class="section" title="HEAD捕獵">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_head%E6%8D%95%E7%8D%B5"></a>HEAD捕獵</h2>
          </div>
        </div>
      </div>

      <p>或許ORG_HEAD不夠。或許你剛認識到你犯了個歷史性的錯誤，你需要回到一個早已忘記 分支上一個遠古的提交。</p>

      <p>預設，Git保存一個提交至少兩星期，即使你命令Git摧毀該提交所在的分支。難點是找
      到相應的哈希值。你可以查看在.git/objects裡所有的哈希值並嘗試找到你期望的。但 有一個更容易的辦法。</p>

      <p>Git把算出的提交哈希值記錄在“.git/logs”。這個子目錄引用包括所有分支上所有活
      動的歷史，同時檔案HEAD顯示它曾經有過的所有哈希值。後者可用來發現分支上一些不 小心丟掉提交的哈希值。</p>

      <p>The reflog command provides a friendly interface to these
      log files. Try</p>

      <p>命令reflog為訪問這些日誌檔案提供友好的介面，試試</p>
      <pre class="literallayout">
$ git reflog
</pre>

      <p>而不是從reflog拷貝粘貼哈希值，試一下：</p>
      <pre class="literallayout">
$ git checkout "@{10 minutes ago}"
</pre>

      <p>或者撿出後五次訪問過的提交，通過：</p>
      <pre class="literallayout">
$ git checkout "@{5}"
</pre>

      <p>更多內容參見 <span class="strong"><strong>git help
      rev-parse</strong></span> 的‘`Specifying Revisions’'部分。</p>

      <p>你或許期望去為已刪除的提交設置一個更長的保存周期。例如：</p>
      <pre class="literallayout">
$ git config gc.pruneexpire "30 days"
</pre>

      <p>意思是一個被刪除的提交會在刪除30天後，且運行 <span class="strong"><strong>git
      gc</strong></span> 以後，被永久丟棄。</p>

      <p>你或許還想關掉 <span class="strong"><strong>git
      gc</strong></span> 的自動運行：</p>
      <pre class="literallayout">
$ git config gc.auto 0
</pre>

      <p>在這種情況下提交將只在你手工運行 <span class="strong"><strong>git
      gc</strong></span> 的情況下才永久刪除。</p>
    </div>

    <div class="section" title="基于Git構建">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E5%9F%BA%E4%BA%8Egit%E6%A7%8B%E5%BB%BA"></a>基于Git構建</h2>
          </div>
        </div>
      </div>

      <p>依照真正的UNIX風格設計，Git允許其易於用作其他程序的底層組件，比如圖形界面，
      Web界面，可選擇的命令行界面，補丁管理工具，導入和轉換工具等等。實際上，一些
      Git命令它們自己就是站在巨人肩膀上的腳本。通過一點修補，你可以定製Git適應你的 偏好。</p>

      <p>一個簡單的技巧是，用Git內建alias命令來縮短你最常使用命令：</p>
      <pre class="literallayout">
$ git config --global alias.co checkout
$ git config --global --get-regexp alias  # 顯示當前別名
alias.co checkout
$ git co foo                              # 和“git checkout foo”一樣
</pre>

      <p>另一個技巧，在提示符或窗口標題上打印當前分支。調用：</p>
      <pre class="literallayout">
$ git symbolic-ref HEAD
</pre>

      <p>顯示當前分支名。在實際應用中，你可能最想去掉“refs/heads/”並忽略錯誤：</p>
      <pre class="literallayout">
$ git symbolic-ref HEAD 2&gt; /dev/null | cut -b 12-
</pre>

      <p>子目錄 <code class="literal">contrib</code>
      是一個基于Git工具的寶庫。它們中的一些時時會被提升為官方命令。 在Debian和Ubuntu，這個目錄位於
      <code class="literal">/usr/share/doc/git-core/contrib</code>
      。</p>

      <p>一個受歡迎的居民是 <code class=
      "literal">workdir/git-new-workdir</code> 。通過聰明的符號連結，這個腳本創
      建一個新的工作目錄，其歷史與原來的倉庫共享：</p>
      <pre class="literallayout">
$ git-new-workdir an/existing/repo new/directory
</pre>

      <p>這個新的目錄和其中的檔案可被視為一個克隆，除了既然歷史是共享的，兩者的樹自動
      保持同步。不必合併，推入或拉出。</p>
    </div>

    <div class="section" title="大膽的特技">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E5%A4%A7%E8%86%BD%E7%9A%84%E7%89%B9%E6%8A%80"></a>大膽的特技</h2>
          </div>
        </div>
      </div>

      <p>這些天，Git使得用戶意外摧毀數據變得更困難。但如若你知道你在做什麼，你可以突破 為通用命令所設的防衛保障。</p>

      <p>*Checkout*：未提交的變更會導致撿出失敗。銷毀你的變更，並無論如何都checkout一
      個指定的提交，使用強制標記：</p>
      <pre class="literallayout">
$ git checkout -f HEAD^
</pre>

      <p>另外，如果你為撿出指定特別路徑，那就沒有安全檢查了。提供的路徑將被不加提示地
      覆蓋。如你使用這種方式的檢出，要小心。</p>

      <p><span class="strong"><strong>Reset</strong></span>:
      如有未提交變更重置也會失敗。強制其通過，運行：</p>
      <pre class="literallayout">
$ git reset --hard 1b6d
</pre>

      <p><span class="strong"><strong>Branch</strong></span>:
      引起變更丟失的分支刪除會失敗。強制刪除，鍵入：</p>
      <pre class="literallayout">
$ git branch -D dead_branch  # instead of -d
</pre>

      <p>類似，通過移動試圖覆蓋分支，如果隨之而來有數據丟失，也會失敗。強制移動分支，鍵入：</p>
      <pre class="literallayout">
$ git branch -M source target  # 而不是 -m
</pre>

      <p>不像checkout和重置，這兩個命令延遲數據銷毀。這個變更仍然存儲在.git的子目錄裡，
      並且可以通過恢復.git/logs裡的相應哈希值獲取（參見上面 上面“HEAD獵捕”）。默
      認情況下，這些數據會保存至少兩星期。</p>

      <p><span class="strong"><strong>Clean</strong></span>:
      一些Git命令拒絶執行，因為它們擔心會重裝未納入管理的檔案。如果你確信
      所有未納入管理的檔案都是消耗，那就無情地刪除它們，使用：</p>
      <pre class="literallayout">
$ git clean -f -d
</pre>

      <p>下次，那個討厭的命令就會工作！</p>
    </div>

    <div class="section" title="阻止壞提交">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%E9%98%BB%E6%AD%A2%E5%A3%9E%E6%8F%90%E4%BA%A4"></a>阻止壞提交</h2>
          </div>
        </div>
      </div>

      <p>愚蠢的錯誤污染我的倉庫。最可怕的是由於忘記 <span class="strong"><strong>git
      add</strong></span> 而引起的檔案丟失。較小
      的罪過是行末追加空格並引起合併衝突：儘管危害少，我希望浙西永遠不要出現在公開 記錄裡。</p>

      <p>不過我購買了傻瓜保險，通過使用一個_鈎子_來提醒我這些問題：</p>
      <pre class="literallayout">
$ cd .git/hooks
$ cp pre-commit.sample pre-commit  # 對舊版本Git，先運行chmod +x
</pre>

      <p>現在Git放棄提交，如果檢測到無用的空格或未解決的合併衝突。</p>

      <p>對本文檔，我最終添加以下到 <span class=
      "strong"><strong>pre-commit</strong></span>
      鈎子的前面，來防止缺魂兒的事：</p>
      <pre class="literallayout">
if git ls-files -o | grep '\.txt$'; then
  echo FAIL! Untracked .txt files.
  exit 1
fi
</pre>

      <p>幾個git操作支持鈎子；參見 <span class="strong"><strong>git help
      hooks</strong></span> 。我們早先激活了作為例子的 <span class=
      "strong"><strong>post-update</strong></span>
      鈎子，當討論基于HTTP的Git的時候。無論head何時移動，這個鈎子都會
      運行。例子腳本post-update更新Git在基于Git並不知曉的傳輸協議，諸如HTTP，通訊時 所需的檔案。</p>
    </div>
  </div><script type="text/javascript" src="find_selflink.js">
</script><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
  </script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1901330-2");
  pageTracker._initData();
  pageTracker._trackPageview();
  </script>
</div>
</div><div class="footer"><a href="/~blynn/">Ben Lynn</a></div>
</body>
</html>
