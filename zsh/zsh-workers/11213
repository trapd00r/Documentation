From zsh-workers-return-11213-mason-zsh=primenet.com.au@sunsite.auc.dk Fri May 05 16:14:20 2000
Return-Path: <zsh-workers-return-11213-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8431 invoked from network); 5 May 2000 16:14:18 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 5 May 2000 16:14:18 -0000
Received: (qmail 15763 invoked by alias); 5 May 2000 16:14:05 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11213
Received: (qmail 15697 invoked from network); 5 May 2000 16:14:02 -0000
To: zsh-workers@sunsite.auc.dk
Subject: Re: Expand only completions, complete only uncompleted completions
References: <1000505144645.ZM651@candle.brasslantern.com>
MIME-Version: 1.0 (generated by SEMI 1.13.7 - "Awazu")
Content-Type: text/plain; charset=US-ASCII
From: Tanaka Akira <akr@m17n.org>
Date: 06 May 2000 01:15:04 +0900
In-Reply-To: <1000505144645.ZM651@candle.brasslantern.com>
 (Bart Schaefer's message of "Fri, 5 May 2000 14:46:44 +0000")
Message-ID: <hvor9bhnfcn.fsf@serein.m17n.org>
Lines: 63
User-Agent: T-gnus/6.14.1 (based on Gnus v5.8.3) (revision 16) SEMI/1.13.7 (Awazu) FLIM/1.13.2 (Kasanui) Emacs/20.6 (i686-pc-linux-gnu) MULE/4.0 (HANANOEN)

In article <1000505144645.ZM651@candle.brasslantern.com>,
  "Bart Schaefer" <schaefer@candle.brasslantern.com> writes:

> On a slightly different topic:
> 
> 
> zagzig[117] cvs add _lzop _l<TAB>
> Completing file
> _lzop   _look 
> 
> 
> No, I don't need _lzop any more, it's already there.

This patch do it.
(And allow multiple --allow-root.)

Index: Completion/User/_cvs
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/User/_cvs,v
retrieving revision 1.4
diff -u -r1.4 _cvs
--- Completion/User/_cvs	2000/04/11 07:57:57	1.4
+++ Completion/User/_cvs	2000/05/05 16:12:02
@@ -7,7 +7,7 @@
   _arguments -s \
     -{a,f,H,l,n,Q,q,r,t,v,w,x} \
     '--version' '--help' '--help-commands' '--help-synonyms' '--help-options' \
-    '--allow-root=:rootdir:_files -/' \
+    '*--allow-root=:rootdir:_files -/' \
     '-b+:bindir:_cvs_bindir' \
     '-T+:temporary directory:_cvs_tempdir' \
     '-d+:cvsroot:_cvs_root' \
@@ -601,6 +601,10 @@
   _cvs_setup_prefix
   if [[ -d ${pref}CVS ]]; then
     _cvs_setup_modentries
+    setopt localoptions unset
+    local omit
+    omit=($line)
+    eval 'entries=(${entries:#('${(j:|:)${(@)omit:q}}')})'
     (( $#entries )) && _files "$@" -g "${(j:|:)${(@)entries:q}}"
   else
     _files "$@"
@@ -615,7 +619,7 @@
     _cvs_setup_allentries
     setopt localoptions unset
     local omit
-    omit=(${pref}*(D:t))
+    omit=(${pref}*(D:t) $line)
     eval 'entries=(${entries:#('${(j:|:)${(@)omit:q}}')})'
     _tags directories && compadd "$@" -P "$qpref" - ${entries:q} ||
         _cvs_directories "$@"
@@ -632,7 +636,7 @@
     _cvs_setup_allentries
     setopt localoptions unset
     local omit
-    omit=($_cvs_ignore_default ${entries:q} ${=cvsignore})
+    omit=($_cvs_ignore_default ${entries:q} ${=cvsignore} $line)
     [[ -r ~/.cvsignore ]] && omit=($omit $(<~/.cvsignore))
     [[ -r ${pref}.cvsignore ]] && omit=($omit $(<${pref}.cvsignore))
     _path_files "$@" -g '*~(*/|)('${(j:|:)omit}')(D)' ||
-- 
Tanaka Akira

