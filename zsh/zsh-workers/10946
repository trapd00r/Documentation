From zsh-workers-return-10946-mason-zsh=primenet.com.au@sunsite.auc.dk Wed Apr 26 19:51:24 2000
Return-Path: <zsh-workers-return-10946-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9241 invoked from network); 26 Apr 2000 19:51:23 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 26 Apr 2000 19:51:23 -0000
Received: (qmail 22536 invoked by alias); 26 Apr 2000 19:51:16 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10946
Received: (qmail 22522 invoked from network); 26 Apr 2000 19:51:16 -0000
Date: Wed, 26 Apr 2000 20:49:17 +0100
From: Adam Spiers <adam@spiers.net>
To: zsh-workers@sunsite.auc.dk
Subject: Re: PATCH: _history_complete_word
Message-ID: <20000426204917.A13452@thelonious.new.ox.ac.uk>
Reply-To: Adam Spiers <adam@spiers.net>
Mail-Followup-To: zsh-workers@sunsite.auc.dk
References: <200003310814.KAA06936@beta.informatik.hu-berlin.de>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 1.0.1i
In-Reply-To: <200003310814.KAA06936@beta.informatik.hu-berlin.de>; from wischnow@informatik.hu-berlin.de on Fri, Mar 31, 2000 at 10:14:03AM +0200
X-Home-Page: http://www.new.ox.ac.uk/~adam/
X-OS: RedHat Linux

Sven Wischnowsky (wischnow@informatik.hu-berlin.de) wrote:
> I think _history_complete_word could use the new tag label stuff, too.
> 
> There is something in this function I don't understand:
> 
> There is always one match inserted immediately. That's ok for a
> function like this, but why does _h_c_w then test for
> `$compstate[insert] = menu'?

Peter added that in 8070, giving the reason that without it, h-c-w
`has the unfortunate effect that menu completion is turned off unless
history_stop is set, even if you usually have it on.'

> It means that this is almost unusable without normally using
> menucompletion (one can't cycle through the matches).

My brain aches too much right now to figure this mess out.  I'll come
back to it soon.  I suppose it should be fixed before 3.1.7 though.

> No patch for this, because I'm not completely sure which behaviour is
> desired.

I know what interactive behaviour I desire.  Expressing that in terms
of interactions with $compstate is another matter :-)

Just noticed another new quirk with h-c-w now.  I have:

  zstyle ':completion:*:descriptions' format '%B---- %d%b'
  zstyle ':completion:*:history-words' stop verbose
  zstyle ':completion:*:history-words' remove_all_dups yep
                                                        
The first time I press M-/ the message `---- history word' appears,
which means that I have to press it twice to get the first match,
which shouldn't really happen unless the `list' style is turned on.
How can this be fixed?

Incidentally, there may still be other outstanding issues with h-c-w
which I've been meaning to look at for ages but now everything's
changed so much, I'm not sure I know whether anything needs doing
about it.  In particular, I'm thinking of what Sven and Bart discussed
in 8336 and 8341.

Adam

