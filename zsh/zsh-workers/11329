From zsh-workers-return-11329-mason-zsh=primenet.com.au@sunsite.auc.dk Thu May 11 16:10:07 2000
Return-Path: <zsh-workers-return-11329-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 13673 invoked from network); 11 May 2000 16:10:04 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 11 May 2000 16:10:04 -0000
Received: (qmail 26422 invoked by alias); 11 May 2000 16:09:56 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11329
Received: (qmail 26413 invoked from network); 11 May 2000 16:09:55 -0000
Message-ID: <391ADB4A.91B3A3FD@u.genie.co.uk>
Date: Thu, 11 May 2000 17:09:46 +0100
From: Oliver Kiddle <opk@u.genie.co.uk>
X-Mailer: Mozilla 4.72 [en] (Win95; I)
X-Accept-Language: en
MIME-Version: 1.0
To: Zsh workers <zsh-workers@sunsite.auc.dk>
Subject: PATCH: Re: return command's exit code from _call
References: <391AD206.7A5B2523@u.genie.co.uk> <1000511154724.ZM28622@candle.brasslantern.com>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

Bart Schaefer wrote:
> 
> The exit value of a function is supposed to be the exit value of the last
> command that it executed.  That is, "return $?" should be unnecessary; if
> $? has the right value to begin with, that's what should be returned by
> default.

I sort-of knew that somewhere at the back of my mind but I wasn't sure
if the last command would be the if statement or the eval command?

> So if this patch really changed the behavior, then there's another bug
> somewhere else (perhaps in the wordcode executor for if/else/fi?).

Oops, this is my fault for being too hasty and too stupid. The problem
is that the redirection of stderr had been lost and was nothing to do
with the exit code. The exit code was my first guess because that was
what the problem was last time. It appeared to fix the problem, because
the first time, I ran it, it produced the error message, I reloaded
_call and it worked properly but that was because _cache_groups had now
been set.

The patch fixes _groups. I'll also correct _call.

Sorry about that

Oliver

Index: Completion/User/_groups
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/User/_groups,v
retrieving revision 1.3
diff -r1.3 _groups
10c10
<         tmp=$(_call groups ypcat group.byname); then
---
>         tmp=$(_call groups ypcat group.byname 2>/dev/null); then

