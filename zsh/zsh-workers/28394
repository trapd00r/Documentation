From zsh-workers-return-28394-mason-zsh=primenet.com.au@zsh.org Mon Nov 08 19:29:03 2010
Return-Path: <zsh-workers-return-28394-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 25403 invoked by alias); 8 Nov 2010 19:29:03 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28394
Received: (qmail 20799 invoked from network); 8 Nov 2010 19:28:50 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.0 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,
	T_TO_NO_BRKTS_FREEMAIL autolearn=ham version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at _spf.google.com designates 209.85.215.171 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:from:to:subject:date
         :message-id:x-mailer:in-reply-to:references;
        bh=B+QRVsuwZQwwfuvRNm7a9gz8+ngTSUk0z0NqqhJmQLw=;
        b=PRktO/gEpPgxdO+DSBcDHTQ+V0iAOuPxobXfDsrTmGh/SDKw38TATpUD6qUh2zevu1
         XFUswcPY4ATh1o+KCW418RwwnyZerJYpWy9wmU8/5OoOldnFCFhdmdYO8wmCn6K7q1qX
         swFLIfKuhPrgouJKwNgN+VoBhFCEQW11FMym0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=from:to:subject:date:message-id:x-mailer:in-reply-to:references;
        b=NDd75gLCht5xgT3rY7RcjotqeO5JlpBLn+D4Txz5PshzYDUfAgTNg8HseisNFWiltk
         lSdNbFdth9W6oNb2xj41pJikTTCn/jCHx02GYMpm5DRgdXJTzemwT+4i75OPwcMm52jF
         SCt1GJN06RjDvSBeSZlMIhl+vTcPIc5eNh1nk=
From: Andrey Borzenkov <arvidjaar@gmail.com>
To: zsh-workers@zsh.org
Subject: [PATCH 2/2] zshguide: Makefile fixes
Date: Mon,  8 Nov 2010 22:28:37 +0300
Message-Id: <1289244517-14442-2-git-send-email-arvidjaar@gmail.com>
X-Mailer: git-send-email 1.7.3.2
In-Reply-To: <1289244517-14442-1-git-send-email-arvidjaar@gmail.com>
References: <1289244517-14442-1-git-send-email-arvidjaar@gmail.com>

- there was very interesting effect of line continuation
on perl - as "\<new line>" was passed verbatim to perl, it was
apparently interpreted as reference to variable with name
<new line> resulting in

\documentclass[a4paper]{book}
SCALAR(0xd1b100)\usepackage[T1]{fontenc}

This is with perl 5.12.2. Patch makes sure continuation is
interpreted and stripped off by shell.

- "make web" was missing zshguide_us.pdf target

- add some more temp files to "clean" target
---
 Makefile |   28 +++++++++++++++-------------
 1 files changed, 15 insertions(+), 13 deletions(-)

diff --git a/Makefile b/Makefile
index 83dd8a4..2fa0ec2 100755
--- a/Makefile
+++ b/Makefile
@@ -8,9 +8,9 @@ SRC_DIST = Makefile zshguide.yo $(CHAPTERS)
 DTD = <!doctype html public "-//w3c//dtd html 4.0 transitional//en">
 
 .latex.pdf:
-	while pdflatex $< | perl -pe '/should run.*again/ && $$run++; \
-	/^LaTeX Warning:.*Rerun/ && $$run++; \
-	eof && exit(!$$run);'; do true; done
+	while pdflatex $< | perl -pe '/should run.*again/ && $$run++; '\
+	'/^LaTeX Warning:.*Rerun/ && $$run++; '\
+	'eof && exit(!$$run);'; do true; done
 .yo.txt:
 	yodl2txt $<
 
@@ -48,19 +48,19 @@ PERLCOMMON = "\\usepackage[T1]{fontenc}\n", \
 	yodl2latex $<
 	cp $@ tmp.latex
 	perl -ne 'if (/^\\usepackage/) { \
-	  print "\\documentclass[a4paper]{book}\n", \
-	  "\\usepackage{a4wide}\n", $(PERLCOMMON)' \
+	  print "\\documentclass[a4paper]{book}\n", '\
+	'  "\\usepackage{a4wide}\n", $(PERLCOMMON)' \
 	$@ > $@.tmp  &&  mv $@.tmp $@
-	perl -ne 'if (/^\\usepackage/) { \
-	  print "\\documentclass{book}\n", \
-	  $(PERLCOMMON)' \
+	perl -ne 'if (/^\\usepackage/) { '\
+	'  print "\\documentclass{book}\n", '\
+	'  $(PERLCOMMON)' \
 	tmp.latex > $*_us.latex
 	rm -f tmp.latex
 
 .latex.dvi:
-	if latex $< | perl -pe '/should run.*again/ && $$run++; \
-	/^LaTeX Warning:.*Rerun/ && $$run++; \
-	eof && exit(!$$run);'; then \
+	if latex $< | perl -pe '/should run.*again/ && $$run++; '\
+	'/^LaTeX Warning:.*Rerun/ && $$run++; '\
+	'eof && exit(!$$run);'; then \
 	latex $<; \
 	fi
 .dvi.ps:
@@ -73,7 +73,7 @@ all: zshguide.html zshguide.latex zshguide.txt zshguide.pdf \
 
 zshguide.txt zshguide.html zshguide.latex: zshguide.yo $(CHAPTERS)
 
-zshguide.pdf zshguide.dvi: zshguide.latex
+zshguide.pdf zshguide_us.pdf zshguide.dvi: zshguide.latex
 
 # zshguide.ps: zshguide.dvi
 
@@ -92,4 +92,6 @@ web:    zshguide.html zshguide.latex zshguide.pdf zshguide_us.pdf
 
 clean:
 	rm -f zshguide*.html zshguide*.txt zshguide*.tex zshguide*.latex \
-	zshguide*.dvi zshguide.pdf zshguide*.ps zshguide.aux zshguide.toc
+	zshguide*.dvi zshguide.pdf zshguide*.ps zshguide.aux zshguide.toc \
+	zshguide*.log zshguide*.pdf *~ zshguide*.aux zshguide*.toc \
+	zshguide*.tmp tmp.latex
-- 
1.7.3.2

