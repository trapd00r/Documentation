From zsh-workers-return-19253-mason-zsh=primenet.com.au@sunsite.dk Fri Nov 14 22:37:02 2003
Return-Path: <zsh-workers-return-19253-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 14663 invoked from network); 14 Nov 2003 22:37:02 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 14 Nov 2003 22:37:02 -0000
Received: (qmail 7916 invoked by alias); 14 Nov 2003 22:36:52 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19253
Received: (qmail 7854 invoked from network); 14 Nov 2003 22:36:52 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 14 Nov 2003 22:36:52 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [80.184.45.94] by sunsite.dk (MessageWall 1.0.8) with SMTP; 14 Nov 2003 22:36:51 -0000
Received: from opk by athlon with esmtp (masqmail 0.2.20) id
 1AKmhb-1uN-00; Fri, 14 Nov 2003 23:46:07 +0100
cc: zw <zsh-workers@sunsite.dk>
In-reply-to: <20031103034244.16802.qmail@web10405.mail.yahoo.com> 
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <20031103034244.16802.qmail@web10405.mail.yahoo.com>
To: Felix Rosencrantz <f_rosencrantz@yahoo.com>
Subject: Re: Build problem on terminfo.c on FreeBSD 4.7 
Date: Fri, 14 Nov 2003 23:46:07 +0100
Message-ID: <7338.1068849967@athlon>

On 2 Nov, Felix Rosencrantz wrote:
> Since Clint's changes (zsh-workers/19076) I'm seeing build problems with
> terminfo.c on FreeBSD 4.7:
> 
> terminfo.c: In function `boot_':
> terminfo.c:381: warning: implicit declaration of function `setupterm'
> terminfo.c:381: `ERR' undeclared (first use in this function)
> terminfo.c:381: (Each undeclared identifier is reported only once
> terminfo.c:381: for each function it appears in.)
> 
> ERR is defined in curses.h.  Not sure why that is not included, because the
> autoconf code is opaque to me.

I get this same problem on one particular Linux box. With
--with-curses-terminfo, it builds. Unfortunately, the autoconf code for
handling curses/terminfo is fairly opaque to me too.

At the top of terminfo.c, the following is used around the curses.h
include:

# ifdef HAVE_CURSES_H
#  include <curses.h>
# endif

So curses.h would be included. However, HAVE_CURSES_H is not defined.
This seems to be because the curses.h header check is inside this in
zshconfig.ac:
  case "$LIBS" in
  *curses*)
This presumably fails because it uses just -ltermcap.

libtermcap.so is just a link to libncurses.so here. So how is that
situation otherwise handled? Should the HAVE_SETUPTERM test perhaps
similarly only be done if $LIBS = *curses*? Or can we perhaps safely
substitute -1 for ERR?

Oliver

