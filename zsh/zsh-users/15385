From zsh-users-return-15385-mason-zsh=primenet.com.au@zsh.org Fri Sep 10 11:43:17 2010
Return-Path: <zsh-users-return-15385-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9537 invoked by alias); 10 Sep 2010 11:43:17 -0000
Mailing-List: contact zsh-users-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Users List <zsh-users.zsh.org>
List-Post: <mailto:zsh-users@zsh.org>
List-Help: <mailto:zsh-users-help@zsh.org>
Delivered-To: mailing list zsh-users@zsh.org
X-Seq: 15385
Received: (qmail 11638 invoked from network); 10 Sep 2010 11:43:15 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.0 required=5.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,UNPARSEABLE_RELAY
	autolearn=ham version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at yahoo.fr does not designate permitted sender hosts)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.fr;
  h=DKIM-Signature:Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Date:From:To:Cc:Subject:Message-ID:Mail-Followup-To:References:MIME-Version:Content-Type:Content-Disposition:In-Reply-To:User-Agent;
  b=Mk8hFvpWqRGpyT5xOCA9EbHKuyms3DfqFdM8yZhge05R6PTZz4EpaI1i48q4vg6FamKkWHMJo8eiHMo0F3hCpxvtYiv3Ph2hbIw0P3unxWzOxTW9UZx0VJbjRK6IepdL3ZLpVz3BqlWAHZLi4sJYC+dsn+5gmxBki3e3iosQig4=  ;
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.fr; s=s1024; t=1284118592; bh=fhDoxRzMObXciNu3JZiuCgepzErG0NMRFBOB6ssQip0=; h=Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Date:From:To:Cc:Subject:Message-ID:Mail-Followup-To:References:MIME-Version:Content-Type:Content-Disposition:In-Reply-To:User-Agent; b=TkwiMwLgvOpMN5q/ShWiWcS3iFHDMrCxBlTp87+752ubmwqOwHBCVEQw+TV+EI8pClDoGYEhKZi2Eunw6ajKxFcOzj45NVKUplS+XJNaHgSCLw0JA9yAp3xiL5fyZSxvd09I/bja63EZggA5csFIQFNMeGmIubbq9oWaDnL89iE=
X-Yahoo-SMTP: V1UR0WuswBDVD1eFhM33188Ir8ciBckz4W8ZMsAh
X-YMail-OSG: _gu1XykVM1nqYIJt9TvHa2bAYyXVFsg_oJWI3dAmUexIpf9
 RhzAsfbpRtt3kXD1C_cle_BpA6FcuJwZr5ECf5Lo7S3AsipaE9XbDA6_J2.Q
 s0XWpJ7Gw8MR8D3JfEucexFF7QSROEhHmezuFAxkPbG52pdhHTEO.kKcM8_e
 3gMg8qX6q9N1iMy342tRAEnolBYDzLlsMo_9Ne2ktAlCHTgiVYQFTljva.GG
 wLJ5HRwHs
X-Yahoo-Newman-Property: ymail-3
Date: Fri, 10 Sep 2010 12:36:32 +0100
From: Stephane Chazelas <stephane_chazelas@yahoo.fr>
To: Dominik Vogt <dominik.vogt@gmx.de>
Cc: zsh-users@zsh.org
Subject: Re: Tesing a fifo without opening it?
Message-ID: <20100910113632.GA4692@yahoo.fr>
Mail-Followup-To: Dominik Vogt <dominik.vogt@gmx.de>, zsh-users@zsh.org
References: <20100910063544.45240@gmx.net>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20100910063544.45240@gmx.net>
User-Agent: Mutt/1.5.20 (2009-06-14)

2010-09-10 08:35:44 +0200, Dominik Vogt:
[...]
> 05   if read -t REQUEST < "$1"; then
[...]
> Now, the problem is that input redirection in line 5 blocks
> until the main script also opens the fifo.  So the -t flag of
> read does not "work" here (because read is not even executed
> until the fifo can be opened).  I want to check if data is
> available in the fifo without blocking, but I can't find a way
> around blocking in the input redirection.
[...]

On Linux (at least, though the behavior is not clearly defined
by POSIX)

read -t REQUEST <> "$1"

should work.

Otherwise, other approaches: open with O_NONBLOCK (though you'd
need to do it in something else as I don't think zsh has an
interface to open with O_NONBLOCK).

Or you could do

: > "$1" & read...

though it would have other side effects.

-- 
Stephane

