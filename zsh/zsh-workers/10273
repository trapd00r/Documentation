From zsh-workers-return-10273-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Mar 27 11:00:41 2000
Return-Path: <zsh-workers-return-10273-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2929 invoked from network); 27 Mar 2000 11:00:38 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 27 Mar 2000 11:00:38 -0000
Received: (qmail 19631 invoked by alias); 27 Mar 2000 11:00:27 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10273
Received: (qmail 19619 invoked from network); 27 Mar 2000 11:00:26 -0000
Date: Mon, 27 Mar 2000 13:00:25 +0200 (MET DST)
Message-Id: <200003271100.NAA03746@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 25 Mar 2000 03:38:55 +0900
Subject: Re: PATCH: _xwit


Tanaka Akira wrote:

> ...
> 
> But, this doesn't work because [[ -prefix [0-9]# ]] is failed even
> when $PREFIX is empty:
> 
> Z(2):akr@is27e1u11% Src/zsh -f
> is27e1u11% bindkey -e; autoload -U compinit; compinit -D; compdef _tst tst
> is27e1u11% _tst () { if [[ -prefix [0-9]# ]]; then compadd succ; else compadd fail; fi } 
> is27e1u11% tst <TAB>
> ->
> is27e1u11% tst fail 

Oops. Wrong security test.

Bye
 Sven

diff -ru ../z.old/Src/Zle/complete.c Src/Zle/complete.c
--- ../z.old/Src/Zle/complete.c	Mon Mar 27 12:49:45 2000
+++ Src/Zle/complete.c	Mon Mar 27 12:58:11 2000
@@ -740,7 +740,7 @@
 		char *p, sav;
 
 		if (!(l = strlen(compprefix)))
-		    return 0;
+		    return ((na == 1 || na == -1) && pattry(pp, compprefix));
 		if (na < 0) {
 		    p = compprefix + l;
 		    na = -na;
@@ -766,7 +766,7 @@
 		char *p;
 
 		if (!(ol = l = strlen(compsuffix)))
-		    return 0;
+		    return ((na == 1 || na == -1) && pattry(pp, compsuffix));
 		if (na < 0) {
 		    p = compsuffix;
 		    na = -na;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

