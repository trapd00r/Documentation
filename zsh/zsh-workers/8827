From zsh-workers-return-8827-mason-zsh=primenet.com.au@sunsite.auc.dk Tue Nov 30 21:00:34 1999
Return-Path: <zsh-workers-return-8827-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6161 invoked from network); 30 Nov 1999 21:00:33 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 30 Nov 1999 21:00:33 -0000
Received: (qmail 23452 invoked by alias); 30 Nov 1999 21:00:21 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8827
Received: (qmail 23444 invoked from network); 30 Nov 1999 21:00:19 -0000
Date: Tue, 30 Nov 1999 16:00:18 -0500
From: Clint Adams <schizo@debian.org>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: partial program transform support (Texinfo)
Message-ID: <19991130160018.A31936@dman.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
User-Agent: Mutt/1.0i

This can be used independently of 8824 if you take out
the hunk for Src/Makefile.in.  Otherwise it's meant to
follow it.

Index: Makefile.in
===================================================================
RCS file: /cvs/zsh/zsh/Makefile.in,v
retrieving revision 1.1.1.6
diff -u -r1.1.1.6 Makefile.in
--- Makefile.in	1999/09/07 22:33:05	1.1.1.6
+++ Makefile.in	1999/11/30 20:57:51
@@ -38,12 +38,15 @@
 
 @DEFS_MK@
 
+transform = @program_transform_name@
+tzsh = `echo zsh | sed "$(transform)"`
+
 # ========== DEPENDENCIES FOR BUILDING ==========
 
 # default target
 all: config.h
 	@for subdir in Src Doc; do \
-	  (cd $$subdir && $(MAKE) $(MAKEDEFS) $@) || exit 1; \
+	  (cd $$subdir && $(MAKE) $(MAKEDEFS) tzsh=$(tzsh) $@) || exit 1; \
 	done
 
 check test:
@@ -68,7 +71,7 @@
 
 # install/uninstall just the binary
 install.bin uninstall.bin:
-	@cd Src && $(MAKE) $(MAKEDEFS) $@
+	@cd Src && $(MAKE) $(MAKEDEFS) tzsh=$(tzsh) $@
 
 # install/uninstall just the modules
 install.modules uninstall.modules:
@@ -85,7 +88,7 @@
 
 # install/uninstall just the info pages
 install.info uninstall.info:
-	@cd Doc && $(MAKE) $(MAKEDEFS) $@
+	@cd Doc && $(MAKE) $(MAKEDEFS) tzsh=$(tzsh) $@
 
 # install/uninstall just the html pages
 install.html uninstall.html:
Index: Doc/.cvsignore
===================================================================
RCS file: /cvs/zsh/zsh/Doc/.cvsignore,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 .cvsignore
--- Doc/.cvsignore	1999/04/15 18:05:35	1.1.1.1
+++ Doc/.cvsignore	1999/11/30 20:57:51
@@ -1,5 +1,6 @@
 Makefile
 version.yo
+zsh.yo
 zsh*.1
 zsh.texi
 zsh.info*
Index: Doc/.distfiles
===================================================================
RCS file: /cvs/zsh/zsh/Doc/.distfiles,v
retrieving revision 1.1.1.7
diff -u -r1.1.1.7 .distfiles
--- Doc/.distfiles	1999/08/01 14:48:53	1.1.1.7
+++ Doc/.distfiles	1999/11/30 20:57:51
@@ -2,7 +2,7 @@
     .cvsignore .distfiles Makefile.in
     META-FAQ.yo intro.ms
     version.yo zmacros.yo zman.yo ztexi.yo
-    zsh.yo zshbuiltins.yo zshcompctl.yo zshcompsys.yo zshcompwid.yo
+    zsh.yo.in zshbuiltins.yo zshcompctl.yo zshcompsys.yo zshcompwid.yo
     zshexpn.yo zshmisc.yo zshmodules.yo zshoptions.yo zshparam.yo
     zshzftpsys.yo zshzle.yo
     zsh.texi
Index: Doc/Makefile.in
===================================================================
RCS file: /cvs/zsh/zsh/Doc/Makefile.in,v
retrieving revision 1.1.1.26
diff -u -r1.1.1.26 Makefile.in
--- Doc/Makefile.in	1999/11/03 09:06:24	1.1.1.26
+++ Doc/Makefile.in	1999/11/30 20:57:51
@@ -35,6 +35,8 @@
 sdir_top        = @top_srcdir@
 INSTALL         = @INSTALL@
 
+tzsh = zsh
+
 @DEFS_MK@
 
 MAKEINFO = makeinfo
@@ -66,20 +68,23 @@
 
 # ========== DEPENDENCIES FOR BUILDING ==========
 
-all: $(MAN) zsh.texi zsh.info ../META-FAQ
+all: $(MAN) zsh.texi $(tzsh).info ../META-FAQ
 
 everything: all zsh.dvi zsh_us.ps zsh_a4.ps zsh_toc.html
 
 zsh.dvi: zsh.texi
 	$(TEXI2DVI) $(sdir)/zsh.texi
 
-zsh.info: zsh.texi
+%.info: zsh.texi
 	$(MAKEINFO) $(sdir)/zsh.texi || exit 0
 
 zsh.texi: zsh.yo
 	$(YODL) -o $(sdir)/zsh.texi -I$(sdir) -w ztexi.yo version.yo zsh.yo
 	test -f $(sdir)/zsh.texi
 
+zsh.yo: zsh.yo.in
+	sed 's,@@TEXINFO@@,texinfo\($(tzsh).info\)\($(tzsh)\),' zsh.yo.in >zsh.yo
+
 .yo.1:
 	case $@ in \
 	  */*) target=$@ ;; \
@@ -175,9 +180,9 @@
 	done
 
 # install info pages, creating install directory if necessary
-install.info: zsh.info
+install.info: $(tzsh).info
 	$(sdir_top)/mkinstalldirs $(DESTDIR)$(infodir)
-	for file in zsh.info zsh.info-[1-9]*; do \
+	for file in $(tzsh).info $(tzsh).info-[1-9]*; do \
 	  if test -f $$file; then \
 	    $(INSTALL_DATA) $$file $(DESTDIR)$(infodir); \
 	  elif test -f $(sdir)/$$file; then \
@@ -186,7 +191,7 @@
 	   fi || exit 1; \
 	done
 	if $(SHELL) -c 'install-info --version' >/dev/null 2>&1; then \
-	  install-info --dir-file=$(DESTDIR)$(infodir)/dir $(DESTDIR)$(infodir)/zsh.info; \
+	  install-info --dir-file=$(DESTDIR)$(infodir)/dir $(DESTDIR)$(infodir)/$(tzsh).info; \
 	else true; fi
 
 install.html: zsh_toc.html
@@ -201,7 +206,7 @@
 
 # uninstall info pages
 uninstall.info:
-	rm -f $(DESTDIR)$(infodir)/zsh.info $(DESTDIR)$(infodir)/zsh.info-[1-9]*
+	rm -f $(DESTDIR)$(infodir)/$(tzsh).info $(DESTDIR)$(infodir)/$(tzsh).info-[1-9]*
 
 # ========== DEPENDENCIES FOR CLEANUP ==========
 
@@ -214,7 +219,7 @@
 	rm -f Makefile *.1 *.texi
 
 realclean-here: distclean-here
-	cd $(sdir) && rm -f version.yo ../META-FAQ
+	cd $(sdir) && rm -f version.yo ../META-FAQ zsh.yo
 
 @CLEAN_MK@
 
Index: Src/Makefile.in
===================================================================
RCS file: /cvs/zsh/zsh/Src/Makefile.in,v
retrieving revision 1.1.1.15
diff -u -r1.1.1.15 Makefile.in
--- Src/Makefile.in	1999/11/30 15:55:08	1.1.1.15
+++ Src/Makefile.in	1999/11/30 20:57:52
@@ -42,8 +42,7 @@
 sdir_src      = $(sdir)
 dir_src       = .
 
-transform=@program_transform_name@
-tzsh=`echo zsh | sed '$(transform)'`
+tzsh = zsh
 
 # ========= DEPENDENCIES FOR BUILDING ==========

