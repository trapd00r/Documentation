From zsh-workers-return-27069-mason-zsh=primenet.com.au@sunsite.dk Sun Jun 28 19:31:00 2009
Return-Path: <zsh-workers-return-27069-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21110 invoked from network); 28 Jun 2009 19:30:56 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from new-brage.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.254.104)
  by ns1.primenet.com.au with SMTP; 28 Jun 2009 19:30:56 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 98539 invoked from network); 28 Jun 2009 19:30:50 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Jun 2009 19:30:50 -0000
Received: (qmail 1069 invoked by alias); 28 Jun 2009 19:30:43 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 27069
Received: (qmail 1031 invoked from network); 28 Jun 2009 19:30:42 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 28 Jun 2009 19:30:42 -0000
Received: from mail-ew0-f218.google.com (mail-ew0-f218.google.com [209.85.219.218])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 629D280307FA
	for <zsh-workers@sunsite.dk>; Sun, 28 Jun 2009 21:30:30 +0200 (CEST)
Received: by ewy18 with SMTP id 18so4462703ewy.45
        for <zsh-workers@sunsite.dk>; Sun, 28 Jun 2009 12:30:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:cc:content-type
         :content-transfer-encoding;
        bh=/fnuaBnaB1/mU0cWGtZXMLxCEqnMpa1j8DgKiERfZVY=;
        b=sKKIHsFRd6L0XkRFP+VgKZGDB8xOaDkA0XsxrB5gUjhNjAL18M//czJnCFhy8YxuRJ
         7nFKJ/GcI7pD+2a+nahjyzIdHCd1nsVsuHg9MVt6RM2ekKYQOhySnpfAourMdMyHFhM0
         UCLjG0nWqrSXRg1gafRtYndo9GLul1OY5XNy8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :cc:content-type:content-transfer-encoding;
        b=Dpdh6C3pdQLfvi4yJ7fs2IlxEJj9KQmNWfyhqUR6CVyhWlXoO/hlmO1RabTIR1lqDj
         Lu1WwQQoo94QmKuwKodcM4JVnDmfcrO1ICotH5JBhmEVfh7YnuSSJCD31620o285pYZn
         kap+KFesgVLNtTLV/7PtuwBb+Yl4/6FHNOdes=
MIME-Version: 1.0
Received: by 10.210.134.5 with SMTP id h5mr954171ebd.88.1246217429690; Sun, 28 
	Jun 2009 12:30:29 -0700 (PDT)
In-Reply-To: <200906282055.34430.nechtom@gmail.com>
References: <200906282055.34430.nechtom@gmail.com>
Date: Sun, 28 Jun 2009 21:30:29 +0200
Message-ID: <237967ef0906281230lc27eabcr177018fbddfe27e2@mail.gmail.com>
Subject: Re: Multi-line prompt and terminal window resize
From: Mikael Magnusson <mikachu@gmail.com>
To: =?UTF-8?B?VG9tw6HFoSBOZWNodXRuw70=?= <nechtom@gmail.com>
Cc: zsh-workers@sunsite.dk
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Scanned: ClamAV 0.94.2/9516/Sun Jun 28 20:08:45 2009 on bifrost
X-Virus-Status: Clean

2009/6/28 Tom=C3=A1=C5=A1 Nechutn=C3=BD <nechtom@gmail.com>:
> Hello,
>
> I have multiline prompt:
>
> PROMPT=3D"%n:%~
> $ "
>
> I noticed that after resizing terminal window (konsole and urxvt), zsh ad=
ds
> extra first line of prompt. But only after startup or when you type somet=
hing
> before resizing (eg. when you resize n-times and don't type anything it
> happens just once).

If you have RPS1 set to something, I can explain what happens: The
problem is that urxvt reflows lines when you resize the terminal,
which can add a line, then zsh redraws it too, which keeps half of the
old line. I have no idea why it happens with a multiline prompt
though; it seems zsh doesn't output spaces to the end of the first
line. You get a quite fun effect if you setopt promptcr promptsp and
do echo -n foo, then resize (wider or narrower).

--=20
Mikael Magnusson

