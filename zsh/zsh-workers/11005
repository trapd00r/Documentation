From zsh-workers-return-11005-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Apr 28 11:58:46 2000
Return-Path: <zsh-workers-return-11005-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 709 invoked from network); 28 Apr 2000 11:58:40 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 28 Apr 2000 11:58:40 -0000
Received: (qmail 22689 invoked by alias); 28 Apr 2000 11:58:01 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11005
Received: (qmail 22677 invoked from network); 28 Apr 2000 11:58:00 -0000
Date: Fri, 28 Apr 2000 12:56:24 +0100
From: Peter Stephenson <pws@cambridgesiliconradio.com>
Subject: Re: (file) completion in compinstall
In-reply-to: "Your message of Fri, 28 Apr 2000 15:13:23 +0400."
 <000301bfb102$c4936c30$21c9ca95@mow.siemens.ru>
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Message-id: <0FTQ00FHA6HZ5M@la-la.cambridgesiliconradio.com>
Content-transfer-encoding: 7BIT

> As I understand, compinstall is using vared to get input. Currently,
> completion in the first prompt (for the file name) tries to complete
> commands; I did not try any other (is there anything accept file names
> that may be sensibly completed? I believe, everything else is menu
> driven or free text input)

I was going to remark on this, too, but forgot.  As far as I know,
completion usually just treats a line of vared input exactly the same way
as an ordinary command line.  This is very rarely the most useful
behaviour; a better default would be ordinary default completion,
i.e. assume a null command and treat the rest as command words.

There's some low-level support: compstate[vared] gets set to the name of
the parameter being edited and can be detected in completion functions.
However, there doesn't seem to be any support in the function system with
the exception of some commented-out code in _first, which would treat the
line being edited as if you were editing an assignment to that variable.  I
can't remember why that's not the default.

It might be possible to change this in compinstall by setting
compstate[context] directly, but come to think of it, I doubt if it
actually is possible outside a completion widget.  Even then, making the
value local would be unpleasant.

I'd prefer a more general solution to completion with vared, if Sven has
any ideas...

-- 
Peter Stephenson <pws@cambridgesiliconradio.com>
Cambridge Silicon Radio, Unit 300, Science Park, Milton Road,
Cambridge, CB4 0XL, UK                          Tel: +44 (0)1223 392070

