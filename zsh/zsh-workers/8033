From zsh-workers-return-8033-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Sep 23 14:24:41 1999
Return-Path: <zsh-workers-return-8033-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 8252 invoked from network); 23 Sep 1999 14:24:40 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 23 Sep 1999 14:24:40 -0000
Received: (qmail 7793 invoked by alias); 23 Sep 1999 14:24:28 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 8033
Received: (qmail 7786 invoked from network); 23 Sep 1999 14:24:28 -0000
Message-Id: <9909231348.AA20988@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk
Subject: Re: core dumps with (( #\... )) 
In-Reply-To: "Sven Wischnowsky"'s message of "Thu, 23 Sep 1999 15:04:26 DFT."
             <199909231304.PAA24601@beta.informatik.hu-berlin.de> 
Date: Thu, 23 Sep 1999 15:48:58 +0200
From: Peter Stephenson <pws@ibmth.df.unipi.it>

Sven Wischnowsky wrote:
> > Should I change it but keep \ for backward compatibility?
> 
> That would be kind.

This is not hard.

--- Doc/Zsh/arith.yo.mchar	Tue Sep 21 11:25:32 1999
+++ Doc/Zsh/arith.yo	Thu Sep 23 15:43:36 1999
@@ -86,13 +86,14 @@
 arithmetic expressions. The shell currently defines no mathematical
 functions, but modules may define some.
 
-An expression of the form `tt(#\)var(x)' where var(x) is any character
+An expression of the form `tt(##)var(x)' where var(x) is any character
 sequence such as `tt(a)', `tt(^A)', or `tt(\M-\C-x)' gives the ascii
 value of this character and an expression of the form `tt(#)var(foo)'
 gives the ascii value of the first character of the value of the
 parameter var(foo).  Note that this is different from the expression
 `tt($#)var(foo)', a standard parameter substitution which gives the
-length of the parameter var(foo).
+length of the parameter var(foo).  `tt(#\)' is accepted instead of
+`tt(##)', but its use is deprecated.
 
 Named parameters and subscripted arrays can be referenced by name within an
 arithmetic expression without using the parameter expansion syntax.  For
--- Src/math.c.mchar	Thu Sep 23 15:42:18 1999
+++ Src/math.c	Thu Sep 23 15:42:20 1999
@@ -374,7 +374,7 @@
 		return NUM;
 	    }
 	    if (*ptr == '#') {
-		if (*++ptr == '\\') {
+		if (*++ptr == '\\' || *ptr == '#') {
 		    int v;
 
 		    ptr++;

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

