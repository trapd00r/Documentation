From zsh-users-return-3931-mason-zsh=primenet.com.au@sunsite.dk Sun Jun 17 13:22:18 2001
Return-Path: <zsh-users-return-3931-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 10266 invoked from network); 17 Jun 2001 13:22:17 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Jun 2001 13:22:17 -0000
Received: (qmail 22634 invoked by alias); 17 Jun 2001 13:21:37 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 3931
Received: (qmail 22603 invoked from network); 17 Jun 2001 13:21:36 -0000
To: Will Andrews <will@physics.purdue.edu>
cc: zsh-users@sunsite.dk, jtb@NetBSD.org
Subject: Re: Compile of Zsh 4.0.1 on NetBSD/sparc64 fails.. 
In-Reply-To: Message from Will Andrews <will@physics.purdue.edu> 
   of "Sun, 17 Jun 2001 05:55:38 EST." <20010617055538.X49931@bohr.physics.purdue.edu> 
Date: Sun, 17 Jun 2001 14:26:04 +0000
From: Jason Beegan <jtb@netbsd.org>


[....]
> G'day,
> 
> I can't get zsh 4.0.1 (or 3.1.9) to compile, or more
> specifically, link.  Sorry for the long lines:
> 
> % make
> `complete.mdh' is up to date.
> rm -f stamp-modobjs.tmp
> gcc -c -I.  -DHAVE_CONFIG_H -Wall -Wno-implicit -Wmissing-prototypes -O2 -fpic 
> -o utils.o utils.c utils.c: In function `gettempname':                         
>          
> utils.c:1106: warning: cast to pointer from integer of different size          
>                   
> gcc -c -I.  -DHAVE_CONFIG_H -Wall -Wno-implicit -Wmissing-prototypes -O2 -fpic 
> -o watch.o watch.c
> echo '' builtin.o compat.o cond.o exec.o glob.o hashtable.o hist.o init.o input
> .o jobs.o lex.o linklist.o loop.o math.o mem.o module.o options.o params.o pars
> e.o pattern.o prompt.o signals.o signames.o string.o subst.o text.o utils.o wat
> ch.o >> ../Src/stamp-modobjs.tmp
> Updated `stamp-modobjs'.
> rm -f libzsh-4.0.1.so
> gcc  -s -Wl,-x -shared --whole-archive -o libzsh-4.0.1.so  `cat stamp-modobjs` 
> -ltermcap -lm  -lc
> hist.o: In function `herrflush':                                     
> hist.o(.text+0x444): relocation truncated to fit: R_SPARC_GOT13 strin  
> hist.o: In function `getsubsargs':
> hist.o(.text+0x4fc): relocation truncated to fit: R_SPARC_GOT13 hsubr  
> hist.o(.text+0x500): relocation truncated to fit: R_SPARC_GOT13 hsubl  
[....]
> 
> Log at http://www.physics.purdue.edu/~will/zsh-4.0.1.log ...
> 
> Incidentally, there are two patches in the NetBSD
> pkgsrc/shells/zsh package which apparently solve this problem.
> See:
> 
> http://cvsweb.netbsd.org/bsdweb.cgi/pkgsrc/shells/zsh/patches/patch-aa
> http://cvsweb.netbsd.org/bsdweb.cgi/pkgsrc/shells/zsh/patches/patch-ab
> 
> Apparently both patches have been in that tree for ~4 years.  Does
> anyone feel like merging them into mainstream zsh to get rid of them?
> 
> -- 
> wca

patch-ab uses -fPIC instead of -fpic for generating relocatable code.
-fpic will not work for some architectures.  See the documentation
for gcc.

Actually, that patch is only a couple of weeks old (since zsh was
updated to 4.0.1 -- the older zsh-3.0.8 didn't use dynamically
loadable modules).  zsh-3.0.8 has been relocated to pkgsrc/shells/zsh3
for the moment.


Regards,

Jason Beegan


$NetBSD: patch-ab,v 1.4 2001/06/05 16:28:08 jtb Exp $

--- configure.orig	Fri Jun  1 14:52:49 2001
+++ configure
@@ -6771,7 +6771,7 @@
     DLLDARG=""
   fi
   if test -n "$GCC"; then
-    DLCFLAGS="${DLCFLAGS=-fpic}"
+    DLCFLAGS="${DLCFLAGS=-fPIC}"
   else
     case "$host_os" in
       hpux*)                 DLCFLAGS="${DLCFLAGS=+z}" ;;

