From zsh-workers-return-6841-mason-zsh=primenet.com.au@sunsite.auc.dk Fri Jun 25 06:58:42 1999
Return-Path: <zsh-workers-return-6841-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 6216 invoked from network); 25 Jun 1999 06:58:40 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 25 Jun 1999 06:58:40 -0000
Received: (qmail 27623 invoked by alias); 25 Jun 1999 06:58:15 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6841
Received: (qmail 27616 invoked from network); 25 Jun 1999 06:58:13 -0000
Date: Fri, 25 Jun 1999 08:58:11 +0200 (MET DST)
Message-Id: <199906250658.IAA02207@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: "Bart Schaefer"'s message of Thu, 24 Jun 1999 16:16:20 +0000
Subject: Re: PATCH: pws-N: function line numbers


Bart Schaefer wrote:

> On Jun 24, 12:02pm, Peter Stephenson wrote:
> } Subject: PATCH: pws-N: function line numbers
> }
> } It would be sort of nice to fix this stuff in 3.0.6 too, but that means
> } adapting both Sven's and my previous fixes, which is a rather deathly task.
> 
> Yawn.  Been there, done that.
> 
> 1999-06-19 05:11  Bart Schaefer <schaefer@zsh.org>
> 
> 	* Doc/zsh.texi, Doc/zshbuiltins.man, Src/builtin.c, Src/exec.c,
> 	Src/init.c, Src/input.c, Src/parse.c, Src/zsh.h: Adapt Sven's and
>         PWS's patches for correct LINENO computation from 6693, 6705.
> 
> Is there something else that I missed?

There is something I missed: the %_ was wrong for else-branches.

Bye
 Sven

--- os/loop.c	Thu Jun 24 14:03:59 1999
+++ Src/loop.c	Fri Jun 25 08:55:35 1999
@@ -378,7 +378,7 @@
     noerrexit = olderrexit;
 
     if (*t) {
-	cmdpush(s ? CS_ELIFTHEN : CS_IFTHEN);
+	cmdpush(*i ? (s ? CS_ELIFTHEN : CS_IFTHEN) : CS_ELSE);
 	execlist(*t, 1, flags & CFLAG_EXEC);
 	cmdpop();
     } else

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

