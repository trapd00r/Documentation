From zsh-workers-return-20880-mason-zsh=primenet.com.au@sunsite.dk Sun Feb 27 08:30:31 2005
Return-Path: <zsh-workers-return-20880-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27231 invoked from network); 27 Feb 2005 08:30:31 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 27 Feb 2005 08:30:31 -0000
Received: (qmail 46865 invoked from network); 27 Feb 2005 08:30:24 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 27 Feb 2005 08:30:24 -0000
Received: (qmail 29146 invoked by alias); 27 Feb 2005 08:30:18 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 20880
Received: (qmail 29125 invoked from network); 27 Feb 2005 08:30:17 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 27 Feb 2005 08:30:17 -0000
Received: (qmail 46464 invoked from network); 27 Feb 2005 08:30:17 -0000
Received: from morda.newmail.ru (HELO flock1.newmail.ru) (212.48.140.150)
  by a.mx.sunsite.dk with SMTP; 27 Feb 2005 08:30:13 -0000
Received: (qmail 20116 invoked from network); 27 Feb 2005 08:14:50 -0000
Received: from unknown (HELO ?10.0.0.1?) (arvidjaar@newmail.ru@83.237.61.12)
  by smtpd.newmail.ru with SMTP; 27 Feb 2005 08:14:50 -0000
From: Andrey Borzenkov <arvidjaar@newmail.ru>
To: zsh-workers@sunsite.dk
Subject: Re: Named directories
Date: Sun, 27 Feb 2005 11:30:11 +0300
User-Agent: KMail/1.7.2
References: <2e24629722633f291ea82664e14cbc5d@ee.oulu.fi> <Pine.LNX.4.61.0502261405550.18748@toltec.zanshin.com>
In-Reply-To: <Pine.LNX.4.61.0502261405550.18748@toltec.zanshin.com>
MIME-Version: 1.0
Content-Type: text/plain;
  charset="utf-8"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline
Message-Id: <200502271130.11602.arvidjaar@newmail.ru>
X-Spam-Checker-Version: SpamAssassin 3.0.2 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=6.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.2
X-Spam-Hits: -2.6

On Sunday 27 February 2005 01:17, Bart Schaefer wrote:
>
> Hey, PWS and the UTF-8 gang:  If "bin" were in fact a name consisting of
> three wide characters, i.e., they display as three characters but occupy
> 6 or more bytes, would the prompt code treat ~three as a shorter string
> for purposes of the %~ expansion?
>

yes I'd like to know too :) See 20870 for some more problems. Apparently in=
=20
addition to byte vs. character we get yet character length vs. character=20
width problem.

I got a closer look at SUS. All description of shell is in terms of charact=
ers=20
where characters are specifically defined (elsewhere in SUS) as multibyte=20
characters in current locale as opposed to single byte. It means that answe=
r=20
to your question is - zsh should behave the same in single byte or multibyt=
e=20
locale as long as number of characters is the same.

Some other weird effects - older UNICODE versions did not rule out multiple=
=20
encoding for the same character:

{pts/2}% print -- $'\xd0\xb0'
=D0=B0
{pts/2}% print -- $'\xe0\x90\xb0'
=D0=B0

Checking under Linux, apparently the latter won't be accepted on conversion=
 to=20
wc; it means that a file name containing such pattern will be shown correct=
ly=20
by simply "ls ." but can not be edited at all currently.

Looking at some other implementation - most maintain input in original=20
multibyte form and convert to wc only to apply wctype functions. They treat=
=20
invalid mb sequence as characters of size 1 and build extra vector with=20
character sizes to speed up iteration over input.

Perl internally tags string either as UNICODE or as character strings; but =
it=20
has completely different implementation, UNICODE is implemented internally=
=20
and not depends on locale.

=2Dandrey

