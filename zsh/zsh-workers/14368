From zsh-workers-return-14368-mason-zsh=primenet.com.au@sunsite.dk Wed May 16 21:07:43 2001
Return-Path: <zsh-workers-return-14368-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 19264 invoked from network); 16 May 2001 21:07:42 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 16 May 2001 21:07:42 -0000
Received: (qmail 29316 invoked by alias); 16 May 2001 21:07:34 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 14368
Received: (qmail 29304 invoked from network); 16 May 2001 21:07:33 -0000
To: mlandis <mlandis@ucsd.edu>,
	zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: Re: 4.0.1-pre-4 
In-reply-to: "mlandis"'s message of "Wed, 16 May 2001 13:44:20 PDT."
             <Pine.LNX.3.96.1010516100236.11167A-100000@dirm.org> 
Date: Wed, 16 May 2001 23:07:30 +0100
From: Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Message-Id: <20010516220730.3586C139CC@pwstephenson.fsnet.co.uk>

mlandis wrote:
> ./A01grammar.ztst: starting.
> Test ./A01grammar.ztst failed: bad status 1, expected 0 from:
>   echo f*
>   noglob echo f*
> Error output:
> ZTST_execchunk:2: no matches found: f*
> Was testing: `noglob' precommand modifier
> ./A01grammar.ztst: test failed.

(By the way, I don't think you've mentioned what system this is on yet.)

The globbing failure is the basic problem (maybe not the only one, but the
one to solve first).  This is stupid, but have you tried doing `setopt
glob' before trying a pattern match on files?

Next, does

[[ foo = f* ]] && print "that worked"

work?  If not, it looks like pattern.c wasn't compiled properly.  In that
case, it may be some alignment problem.  You can probe a bit further by
doing

[[ foo = foo ]] && print "it worked that time"

since strings are optimised not to do full pattern matching.  After that,
I'm stuck without some kind of debugger trace.

If the pattern match did work, however, it's probably something wrong with
the file code, maybe something like readdir().  It's nothing to do with
this from Etc/MACHINES, is it?  It's unlikely to be different from
3.1.9-dev-8.

Sun: Solaris 2.*
	The UCB versions of the routines for reading directories are not
	usable (the struct definitions are incompatible with the ones
	assumed by zsh).  The symptom of this is that globbed filenames in
	the compiled version of zsh will be missing the first two letters.
	To avoid this, make sure you compile zsh without any reference
	to /usr/ucblib in your LD_LIBRARY_PATH.  You can easily do this
	by just unsetting LD_LIBRARY_PATH before building zsh.

-- 
Peter Stephenson <pws@pwstephenson.fsnet.co.uk>
Work: pws@csr.com
Web: http://www.pwstephenson.fsnet.co.uk

