From zsh-workers-return-13892-mason-zsh=primenet.com.au@sunsite.dk Tue Apr 03 11:22:53 2001
Return-Path: <zsh-workers-return-13892-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 12496 invoked from network); 3 Apr 2001 11:22:51 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 3 Apr 2001 11:22:51 -0000
Received: (qmail 11387 invoked by alias); 3 Apr 2001 11:22:39 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13892
Received: (qmail 11373 invoked from network); 3 Apr 2001 11:22:38 -0000
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
Date: Tue, 3 Apr 2001 13:22:38 +0200 (MET DST)
Message-Id: <200104031122.NAA23997@beta.informatik.hu-berlin.de>
To: zsh-workers@sunsite.dk
Subject: Re: Test Failures from Latest CVS
In-Reply-To: <m2lmpimvyn.fsf@zion.rcn.com>

Vin Shelton wrote:

> ...
>
> Test /usr/local/src/zsh-2001-04-02/Test/C02cond.ztst failed: bad status 1, expected 0 from:
>   # Find a block special file system.  This is a little tricky.
>   block=$(find /dev /devices -type b -print 2>/dev/null|head -1) &&
>   [[ -b $block && ! -b zerolength ]]
> Was testing: -b cond

>From C02cond I only get the well known failure in the -N test (which comes
after this test here).  So, dunno...

With the completion tests I had other problems, caused partly by me
overlooking two more places where fpaths to the completion system were
used and partly caused by 13868.

Bye
  Sven

Index: Src/Zle/compmatch.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/compmatch.c,v
retrieving revision 1.34
diff -u -r1.34 compmatch.c
--- Src/Zle/compmatch.c	2001/04/02 09:05:50	1.34
+++ Src/Zle/compmatch.c	2001/04/03 11:21:24
@@ -2076,8 +2076,7 @@
 
 				if ((diff = sub_join(o, n, tn, 0))) {
 				    o->flags = (o->flags & ~CLF_MISS) | of;
-				    if (po && po->prefix &&
-                                        cmp_anchors(o, po, 0)) {
+				    if (po && po->prefix) {
 					po->flags |= CLF_MISS;
 					po->max += diff;
 				    }
Index: Test/comptest
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/comptest,v
retrieving revision 1.11
diff -u -r1.11 comptest
--- Test/comptest	2001/02/08 03:29:59	1.11
+++ Test/comptest	2001/04/03 11:21:24
@@ -1,7 +1,9 @@
 comptestinit () {
   setopt extendedglob
   [[ -d $ZTST_testdir/Modules/zsh ]] && module_path=( $ZTST_testdir/Modules )
-  fpath=( $ZTST_srcdir/../(Completion|Functions)/*~*/CVS(/) )
+  fpath=( $ZTST_srcdir/../Functions/*~*/CVS(/)
+          $ZTST_srcdir/../Completion
+          $ZTST_srcdir/../Completion/*/*~*/CVS(/) )
 
   zmodload -i zsh/zpty
 
Index: Test/ztst.zsh
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/ztst.zsh,v
retrieving revision 1.9
diff -u -r1.9 ztst.zsh
--- Test/ztst.zsh	2001/04/02 13:04:05	1.9
+++ Test/ztst.zsh	2001/04/03 11:21:24
@@ -64,6 +64,7 @@
 
 # Set the function autoload paths to correspond to this build of zsh.
 fpath=( $ZTST_srcdir/../Functions/*~*/CVS(/)
+        $ZTST_srcdir/../Completion
         $ZTST_srcdir/../Completion/*/*~*/CVS(/) )
 
 : ${TMPPREFIX:=/tmp/zsh}


-- 
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

