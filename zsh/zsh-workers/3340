From zsh-workers-request@euclid.skiles.gatech.edu Thu Jul 03 02:39:42 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 23579 invoked from network); 3 Jul 1997 02:39:37 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 3 Jul 1997 02:39:37 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id WAA19091; Wed, 2 Jul 1997 22:07:42 -0400 (EDT)
Resent-Date: Wed, 2 Jul 1997 22:07:42 -0400 (EDT)
To: zsh-workers@math.gatech.edu
Path: mason
From: mason@primenet.com.au (Geoff Wing)
Newsgroups: lists.zsh.workers
Subject: Refresh patch (Was: Refresh problem)
Date: 3 Jul 1997 02:11:36 GMT
Organization: PrimeNet
Lines: 51
Message-ID: <slrn5rm2io.m01.mason@ns1.primenet.com.au>
References: <Pine.SV4.3.95.970613191434.5343I-100000@itsrm1> <Pine.SV4.3.95.970702211638.11294B-100000@itsrm1>
Reply-To: mason@primenet.com.au
NNTP-Posting-Host: ns1.primenet.com.au
X-Newsreader: slrn (0.9.4.1 UNIX)
Resent-Message-ID: <"Jllvy2.0.Eg4.jbmkp"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/3340
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Andrej Borsenkow <borsenkow.msk@sni.de> typed:
:On Fri, 13 Jun 1997, Andrej Borsenkow wrote:
:bor@itsrm1:~%> aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
:aaaaaaaaaaaaaaaaaaaaaaa '
:quote> bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
:bbbbbbbbbbbbbbbbbbbbbbbbbbbb '
:
:write(10, 0x082FA92C, 212)                      = 212
:   a a a a a a a a a a a a a a a a a a a a a a a a a a a a a a a a
:   a a a a a a a a a a a a a a a a a a a a a a a a a a a a a a a a
:   a a a a a a a a a a a a a a a a a a a a a a a a   '1B [ 0 K1B [
:   0 m\r\n b b b b b b b b b b b b b b b b b b b b b b b b b b b b
:   b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b
:   b b b b b b b b b b b b b b b b b b b b\n b b b b b b b b b b b
:   b b b b b b b b b b   '1B [ 0 K1B [ 0 m

Very helpful.
Try this.  It's a patch against 3.0.4, but it should work with 3.1.2:


*** zle_refresh.c.org	Mon Jun 23 15:12:47 1997
--- zle_refresh.c	Thu Jul  3 12:02:34 1997
***************
*** 575,583 ****
  	if (nllen)
  	    strncpy(p1, nl, nllen);
  	memset(p1 + nllen, ' ', winw - nllen);
! 	p1[winw] = p1[winw + 1] = '\0';
  	if (ln && nbuf[ln])
! 	    strncpy(nl, p1, winw + 2);	/* next time obuf will be up-to-date */
  	else
  	    nl = p1;		/* don't keep the padding for prompt line */
  	nllen = winw;
--- 575,584 ----
  	if (nllen)
  	    strncpy(p1, nl, nllen);
  	memset(p1 + nllen, ' ', winw - nllen);
! 	p1[winw] = '\0';
! 	p1[winw + 1] = (nllen < winw) ? '\0' : nl[winw + 1];
  	if (ln && nbuf[ln])
! 	    memcpy(nl, p1, winw + 2);	/* next time obuf will be up-to-date */
  	else
  	    nl = p1;		/* don't keep the padding for prompt line */
  	nllen = winw;


-- 
Geoff Wing [mason@primenet.com.au]   Technical Manager
  Phone    : +61-3-9818 2977         PrimeNet - Internet Consultancy
  Facsimile: +61-3-9819 3788         Web : <URL:http://www.primenet.com.au/>
  Mobile   : 0412 162 441

