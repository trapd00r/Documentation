From zsh-workers-return-12614-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Aug 14 10:49:24 2000
Return-Path: <zsh-workers-return-12614-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5097 invoked from network); 14 Aug 2000 10:49:21 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 14 Aug 2000 10:49:21 -0000
Received: (qmail 21975 invoked by alias); 14 Aug 2000 10:49:10 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 12614
Received: (qmail 21966 invoked from network); 14 Aug 2000 10:49:07 -0000
X-Envelope-Sender-Is: Andrej.Borsenkow@mow.siemens.ru (at relayer goliath.siemens.de)
From: "Andrej Borsenkow" <Andrej.Borsenkow@mow.siemens.ru>
To: "ZSH workers mailing list" <zsh-workers@sunsite.auc.dk>
Subject: PATCH: minor tests cleanup and _zmodload patch
Date: Mon, 14 Aug 2000 14:49:04 +0400
Message-ID: <000101c005dd$43775820$21c9ca95@mow.siemens.ru>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="koi8-r"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2911.0)
Importance: Normal
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4133.2400

In case of completion tests ztst.zsh tried to remove test directory when child
command was still active and had it as current one. This is an error under
Cygwin (actually, NT, may be Win9x as well).

Patch adds %clean section that unloads zpty killing (hopefully) any child
command.

Small hunk for _zmodload just adds DLL to suffix list.

-andrej

Have a nice DOS!
B >>

Index: Completion/Builtins/_zmodload
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Builtins/_zmodload,v
retrieving revision 1.3
diff -u -r1.3 _zmodload
--- Completion/Builtins/_zmodload       2000/08/08 09:13:36     1.3
+++ Completion/Builtins/_zmodload       2000/08/14 10:44:59
@@ -10,7 +10,7 @@
   _tags files aliases
   while _tags; do
     _requested files expl 'module file' \
-      _files -W module_path -/g '*.s[ol](:r)' && ret=0
+      _files -W module_path -/g '*.(dll|s[ol])(:r)' && ret=0
     _requested aliases expl 'module alias' \
       compadd -- ${${(f)"$(zmodload -A)"}%% *} && ret=0
     (( ret )) || break
Index: Test/53completion.ztst
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/53completion.ztst,v
retrieving revision 1.7
diff -u -r1.7 53completion.ztst
--- Test/53completion.ztst      2000/07/17 10:36:00     1.7
+++ Test/53completion.ztst      2000/08/14 10:44:59
@@ -49,3 +49,7 @@
 >DI:{dir2}
 >FI:{file1}
 >FI:{file2}
+
+%clean
+
+  zmodload -ui zsh/zpty
Index: Test/54compmatch.ztst
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/54compmatch.ztst,v
retrieving revision 1.4
diff -u -r1.4 54compmatch.ztst
--- Test/54compmatch.ztst       2000/06/19 10:48:22     1.4
+++ Test/54compmatch.ztst       2000/08/14 10:44:59
@@ -510,4 +510,5 @@
 >COMPADD:{}

 %clean
-exit 0
+
+  zmodload -ui zsh/zpty
Index: Test/55arguments.ztst
===================================================================
RCS file: /cvsroot/zsh/zsh/Test/55arguments.ztst,v
retrieving revision 1.2
diff -u -r1.2 55arguments.ztst
--- Test/55arguments.ztst       2000/07/27 13:06:19     1.2
+++ Test/55arguments.ztst       2000/08/14 10:44:59
@@ -144,3 +144,6 @@
 >NO:{abyyy}
 >NO:{abzzz}

+%clean
+
+  zmodload -ui zsh/zpty

