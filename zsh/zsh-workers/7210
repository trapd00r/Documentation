From zsh-workers-return-7210-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Jul 19 20:17:26 1999
Return-Path: <zsh-workers-return-7210-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2064 invoked from network); 19 Jul 1999 20:17:24 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 19 Jul 1999 20:17:24 -0000
Received: (qmail 15203 invoked by alias); 19 Jul 1999 20:17:12 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7210
Received: (qmail 15196 invoked from network); 19 Jul 1999 20:17:10 -0000
Date: Mon, 19 Jul 1999 22:06:42 +0200
From: Ollivier Robert <roberto@keltia.freenix.fr>
To: zsh-workers@sunsite.auc.dk
Subject: PATCH: [3.1.6-pre2] Fix for dynamic linking under FreeBSD
Message-ID: <19990719220642.A15070@keltia.freenix.fr>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
User-Agent: Mutt/0.95.5i
X-Operating-System: FreeBSD 4.0-CURRENT/ELF ctm#5468 AMD-K6 MMX @ 200 MHz

Here is a fix that should work for both older a.out systems and newer (3.x &
4.x) ELF FreeBSD systems.

--- configure.in.old	Mon Jul 19 21:49:19 1999
+++ configure.in	Mon Jul 19 21:51:38 1999
@@ -1187,7 +1187,7 @@
   fi
   case "$host_os" in
     hpux*)        DLLDFLAGS="${DLLDFLAGS=-b}" ;;
-    linux*|irix*|osf*) DLLDFLAGS="${DLLDFLAGS=-shared}" ;;
+    freebsd*|linux*|irix*|osf*) DLLDFLAGS="${DLLDFLAGS=-shared}" ;;
     sunos*)       DLLDFLAGS="${DLLDFLAGS=-assert nodefinitions}" ;;
     sysv4*|esix*) DLLDFLAGS="${DLLDFLAGS=-G $ldflags}" ;;
     netbsd*)      DLLDFLAGS="${DLLDFLAGS=${DLLDARG}-x -shared --whole-archive}" ;;
@@ -1196,7 +1196,7 @@
   esac
   case "$host" in
     *-hpux*)  EXTRA_LDFLAGS="${EXTRA_LDFLAGS=-Wl,-E}" ;;
-    *-linux*) EXTRA_LDFLAGS="${EXTRA_LDFLAGS=-rdynamic}" ;;
+    *-freebsd3*|*-freebsd4*|*-linux*) EXTRA_LDFLAGS="${EXTRA_LDFLAGS=-rdynamic}" ;;
     mips-sni-sysv4)
       #
       # unfortunately, we have different compilers


While I'm here, here is the size of the various modules under FreeBSD/ELF:

-rwxr-xr-x  1 roberto  wheel    8344 Jul 19 22:04 Src/Builtins/rlimits.so*
-rwxr-xr-x  1 roberto  wheel    4596 Jul 19 22:04 Src/Builtins/sched.so*
-rwxr-xr-x  1 roberto  wheel    2576 Jul 19 22:04 Src/Modules/cap.so*
-rwxr-xr-x  1 roberto  wheel    4416 Jul 19 22:04 Src/Modules/clone.so*
-rwxr-xr-x  1 roberto  wheel    5972 Jul 19 22:04 Src/Modules/example.so*
-rwxr-xr-x  1 roberto  wheel    9632 Jul 19 22:04 Src/Modules/files.so*
-rwxr-xr-x  1 roberto  wheel    5456 Jul 19 22:04 Src/Modules/mapfile.so*
-rwxr-xr-x  1 roberto  wheel    9728 Jul 19 22:04 Src/Modules/parameter.so*
-rwxr-xr-x  1 roberto  wheel    9028 Jul 19 22:04 Src/Modules/stat.so*
-rwxr-xr-x  1 roberto  wheel   26252 Jul 19 22:04 Src/Modules/zftp.so*
-rwxr-xr-x  1 roberto  wheel    9980 Jul 19 22:04 Src/Zle/comp1.so*
-rwxr-xr-x  1 roberto  wheel   30740 Jul 19 22:04 Src/Zle/compctl.so*
-rwxr-xr-x  1 roberto  wheel   18456 Jul 19 22:04 Src/Zle/complist.so*
-rwxr-xr-x  1 roberto  wheel    3136 Jul 19 22:04 Src/Zle/deltochar.so*
-rwxr-xr-x  1 roberto  wheel  210320 Jul 19 22:05 Src/Zle/zle.so*

-- 
Ollivier ROBERT -=- FreeBSD: The Power to Serve! -=- roberto@keltia.freenix.fr
The Postman hits! The Postman hits! You have new mail.

