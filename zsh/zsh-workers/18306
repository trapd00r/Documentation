From zsh-workers-return-18306-mason-zsh=primenet.com.au@sunsite.dk Thu Feb 27 02:34:06 2003
Return-Path: <zsh-workers-return-18306-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27312 invoked from network); 27 Feb 2003 02:34:06 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 27 Feb 2003 02:34:06 -0000
Received: (qmail 179 invoked by alias); 27 Feb 2003 02:33:51 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 18306
Received: (qmail 172 invoked from network); 27 Feb 2003 02:33:51 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 27 Feb 2003 02:33:51 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [203.24.36.2] by sunsite.dk (MessageWall 1.0.8) with SMTP; 27 Feb 2003 2:33:48 -0000
Received: (qmail 27305 invoked by uid 8); 27 Feb 2003 02:33:41 -0000
To: zsh-workers@sunsite.dk
Path: not-for-mail
From: Geoff Wing <mason@primenet.com.au>
X-Newsgroups: lists.zsh.workers
Subject: PATCH: for: restoring the RPROMPT broken?
Date: Thu, 27 Feb 2003 02:33:40 +0000 (UTC)
Organization: PrimeNet Computer Consultants
Lines: 39
Message-ID: <b3jte4$qjn$1@coral.primenet.com.au>
References: <20030224172213.GA18105@binome.blorf.net>
Reply-To: mason@primenet.com.au
NNTP-Posting-Host: sparkles.primenet.com.au
X-Trace: coral.primenet.com.au 1046313220 27255 203.43.15.10 (27 Feb 2003 02:33:40 GMT)
X-Complaints-To: usenet@coral.primenet.com.au
NNTP-Posting-Date: Thu, 27 Feb 2003 02:33:40 +0000 (UTC)
User-Agent: slrn/0.9.7.4 (NetBSD)

Wayne Davison <wayned@users.sourceforge.net> typed:
: I've noticed that in 4.1.0-dev-6 that when the RPROMPT vanishes (due
: to the typing of a long command), it does not pop back into existence
[...] 
: I don't think this was an intentional change, was it?  I don't see
: anything about it in the ChangeLog file.

Whoops, I did that.  And it's only been broken since October 2001!

Index: Src/Zle/zle_refresh.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/zle_refresh.c,v
retrieving revision 1.7
diff -u -r1.7 zle_refresh.c
--- Src/Zle/zle_refresh.c	1 Jul 2002 16:50:43 -0000	1.7
+++ Src/Zle/zle_refresh.c	27 Feb 2003 02:25:39 -0000
@@ -614,7 +614,6 @@
 
     /* output the right-prompt if appropriate */
 	if (put_rpmpt && !ln && !oput_rpmpt) {
-	    oput_rpmpt = put_rpmpt;
 	    moveto(0, winw - 1 - rpromptw);
 	    zputs(rpromptbuf, shout);
 	    vcs = winw - 1;
@@ -662,6 +661,7 @@
 	}
     }
     clearf = 0;
+    oput_rpmpt = put_rpmpt;
 
 /* move to the new cursor position */
     moveto(nvln, nvcs);
 

Regards,
-- 
Geoff Wing : <gcw@pobox.com>
Rxvt Stuff : <gcw@rxvt.org>
Zsh Stuff  : <gcw@zsh.org>

