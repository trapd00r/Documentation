From zsh-workers-request@math.gatech.edu Fri Oct 23 16:52:06 1998
Return-Path: <zsh-workers-request@math.gatech.edu>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17876 invoked from network); 23 Oct 1998 16:52:05 -0000
Received: from math.gatech.edu (list@130.207.146.50)
  by ns1.primenet.com.au with SMTP; 23 Oct 1998 16:52:05 -0000
Received: (from list@localhost)
	by math.gatech.edu (8.9.1/8.9.1) id MAA25015;
	Fri, 23 Oct 1998 12:43:32 -0400 (EDT)
Resent-Date: Fri, 23 Oct 1998 12:43:32 -0400 (EDT)
From: "Bart Schaefer" <schaefer@brasslantern.com>
Message-Id: <981023094615.ZM21227@candle.brasslantern.com>
Date: Fri, 23 Oct 1998 09:46:15 -0700
In-Reply-To: <98Oct23.115056+0200met_dst.117392-12597+1@csd.ia.pw.edu.pl>
Comments: In reply to Michal Gomulinski <s146028@ia.pw.edu.pl>
        "Compiling ZSH-3.0.0 on QNX 4.23" (Oct 23, 11:50am)
References: <98Oct23.115056+0200met_dst.117392-12597+1@csd.ia.pw.edu.pl>
X-Mailer: Z-Mail (4.0b.820 20aug96)
To: Michal Gomulinski <s146028@ia.pw.edu.pl>, zsh-workers@math.gatech.edu
Subject: Re: Compiling ZSH-3.0.0 on QNX 4.23
Cc: M.Gomulinski@writeme.com
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Resent-Message-ID: <"0F6lw.0.o66.p8BCs"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/4440
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

On Oct 23, 11:50am, Michal Gomulinski wrote:
} Subject: Compiling ZSH-3.0.0 on QNX 4.23
}
} I've managed to compile zsh-3.0.0 on QNX box (Watcom C). The only changes
} I had to make are related to different definition of DIR structure
} and some things about inclusion of termio header files. 

Were you able to run "configure" or did you assemble the config headers
by hand?

If you were able to use "configure", then it would be helpful if you
could send some suggestions for how that script could identify a QNX
system.  Or, if there's a constant that your preprocessor defines that
identifies QNX, use that to wrap your changes in #ifdef ... so that
you aren't altering code that works correctly on other systems.

} The most serious thing was the existence of halloc in the system 
} libraries (it means Huge alloc there). That is why I had to change
} your halloc into something else everywhere in the sources.

A better solution would be to add something like

#ifdef QNX	/* or whatever appropriate preprocessor symbol */
#define halloc zsh_halloc	/* Fix conflict with "Huge alloc" */
#endif

to the top of prototypes.h, and leave the rest of the code alone.

} Still one problem remains, that is when I had automatic correction
} turned on and type say "mkae" zsh writes
} something like this
} 
} Correct mkae to make ?[nya] n
} 
} Note that it doesn't wait for the answer but assumes the answer is no
} and tries to execute 'mkae' immediately, which of course fails.

This probably means that zsh is not being able to properly set terminal
modes, and is likely related to the termio v. termios problems you had.

In the bit of system.h that you patched, the line you changed is inside
an #ifdef HAVE_TERMIOS_H.  If you don't have termios.h, how did configure
produce that definition?  Rather than change the #include line, you
should change config.h to undefine HAVE_TERMIOS_H and instead define
HAVE_TERMIO_H -- and also see if you can figure out why configure got it
wrong.

-- 
Bart Schaefer                                 Brass Lantern Enterprises
http://www.well.com/user/barts              http://www.brasslantern.com

