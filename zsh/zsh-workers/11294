From zsh-workers-return-11294-mason-zsh=primenet.com.au@sunsite.auc.dk Wed May 10 08:18:48 2000
Return-Path: <zsh-workers-return-11294-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4398 invoked from network); 10 May 2000 08:18:47 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 10 May 2000 08:18:47 -0000
Received: (qmail 23245 invoked by alias); 10 May 2000 08:18:34 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11294
Received: (qmail 23225 invoked from network); 10 May 2000 08:18:33 -0000
Date: Wed, 10 May 2000 10:18:32 +0200 (MET DST)
Message-Id: <200005100818.KAA08132@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Oliver Kiddle's message of Tue, 09 May 2000 17:50:26 +0100
Subject: Re: PATCH: arguments for typeset (and variants)


Oliver Kiddle wrote:

> ...
> 
> I had a few problems with the + options in _vars_eq but I must have been
> doing something wrong. There should be +g, +h, +r, +t, +x (any maybe
> some others) options but when I put them in the completion spec as
> something like '(-f)-+x[ex...', completion for typeset hangs zsh.

No, my fault. The -+ works by using the spec twice, but it used the
whole spec, not only the `-+...' part.

Bye
 Sven

Index: Src/Zle/computil.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/computil.c,v
retrieving revision 1.15
diff -u -r1.15 computil.c
--- Src/Zle/computil.c	2000/05/09 09:05:36	1.15
+++ Src/Zle/computil.c	2000/05/10 08:16:57
@@ -651,7 +651,7 @@
 	    Caopt opt;
 	    Caarg oargs = NULL;
 	    int multi, otype = CAO_NEXT, again = 0;
-	    char *name, *descr, c;
+	    char *name, *descr, c, *againp = NULL;
 
 	    rec:
 
@@ -665,6 +665,7 @@
 		p[2] != '=' && p[2] != '-' && p[2] != '+') {
 		/* It's a -+ or +- definition. We just execute the whole
 		 * stuff twice for such things. */
+		againp = dupstring(p);
 		name = ++p;
 		*p = (again ? '-' : '+');
 		again++;
@@ -838,7 +839,7 @@
 
 	    if (again == 1) {
 		/* Do it all again for `*-...'. */
-		p = dupstring(*args);
+		p = againp;
 		goto rec;
 	    }
 	} else if (*p == '*') {

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

