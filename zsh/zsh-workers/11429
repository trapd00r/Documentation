From zsh-workers-return-11429-mason-zsh=primenet.com.au@sunsite.auc.dk Wed May 17 06:48:00 2000
Return-Path: <zsh-workers-return-11429-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28628 invoked from network); 17 May 2000 06:47:58 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 May 2000 06:47:58 -0000
Received: (qmail 24251 invoked by alias); 17 May 2000 06:47:53 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 11429
Received: (qmail 24244 invoked from network); 17 May 2000 06:47:52 -0000
Date: Wed, 17 May 2000 08:47:32 +0200 (MET DST)
Message-Id: <200005170647.IAA29460@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 17 May 2000 01:14:49 +0900
Subject: PATCH: Re: PATCH: Re: ~user completion in single quotes.


Tanaka Akira wrote:

> In article <200005161122.NAA27048@beta.informatik.hu-berlin.de>,
>   Sven Wischnowsky <wischnow@informatik.hu-berlin.de> writes:
> 
> > Hmhm, seems sensible, because there is `compset -q' for real in-quote
> > completion.
> 
> User name completion is correctly disabled.  Thanks.
> 
> Z(4):akr@serein% Src/zsh -f
> serein% bindkey -e; autoload -U compinit; compinit -D
> serein% mkdir '~zzz'
> serein% echo '~z<TAB>
> 
> But filenames beginning with tilde is not completed.

Ugh. Not only filenames, any kind of match. And for '=...', too.

Bye
 Sven

Index: Completion/Core/_main_complete
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Core/_main_complete,v
retrieving revision 1.19
diff -u -r1.19 _main_complete
--- Completion/Core/_main_complete	2000/05/16 11:44:57	1.19
+++ Completion/Core/_main_complete	2000/05/17 06:47:13
@@ -45,11 +45,13 @@
 
 # Special completion contexts after `~' and `='.
 
-if compset -P 1 '='; then
-  compstate[context]=equal
-elif [[ "$PREFIX" != */* && "$PREFIX[1]" = '~' ]]; then
-  compset -p 1
-  compstate[context]=tilde
+if [[ -z "$compstate[quote]" ]]; then
+  if compset -P 1 '='; then
+    compstate[context]=equal
+  elif [[ "$PREFIX" != */* && "$PREFIX[1]" = '~' ]]; then
+    compset -p 1
+    compstate[context]=tilde
+  fi
 fi
 
 # Initial setup.

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

