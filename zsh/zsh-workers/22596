From zsh-workers-return-22596-mason-zsh=primenet.com.au@sunsite.dk Thu Aug 10 09:28:12 2006
Return-Path: <zsh-workers-return-22596-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 3309 invoked from network); 10 Aug 2006 09:28:08 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.4 (2006-07-25) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 10 Aug 2006 09:28:08 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 96847 invoked from network); 10 Aug 2006 09:28:02 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 10 Aug 2006 09:28:02 -0000
Received: (qmail 9556 invoked by alias); 10 Aug 2006 09:27:59 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22596
Received: (qmail 9547 invoked from network); 10 Aug 2006 09:27:59 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 10 Aug 2006 09:27:59 -0000
Received: (qmail 96549 invoked from network); 10 Aug 2006 09:27:59 -0000
Received: from cluster-c.mailcontrol.com (168.143.177.190)
  by a.mx.sunsite.dk with SMTP; 10 Aug 2006 09:27:57 -0000
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly27c.srv.mailcontrol.com (MailControl) with ESMTP id k7A9RXYt018807
	for <zsh-workers@sunsite.dk>; Thu, 10 Aug 2006 10:27:35 +0100
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.1830);
	 Thu, 10 Aug 2006 10:27:11 +0100
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.13.4/8.13.4) with ESMTP id k7A9RAW8019879
	for <zsh-workers@sunsite.dk>; Thu, 10 Aug 2006 10:27:11 +0100
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.13.4/8.13.4/Submit) with ESMTP id k7A9RA9d019876
	for <zsh-workers@sunsite.dk>; Thu, 10 Aug 2006 10:27:10 +0100
Message-Id: <200608100927.k7A9RA9d019876@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: zsh-workers@sunsite.dk
Subject: Re: PATCH: complist with long display lines 
In-reply-to: <060810010102.ZM24015@torch.brasslantern.com> 
References: <200608071540.k77FeWcL020899@news01.csr.com> <060807101946.ZM19622@torch.brasslantern.com> <20060809230445.6eb66ce0.p.w.stephenson@ntlworld.com> <060810010102.ZM24015@torch.brasslantern.com>
Comments: In-reply-to Bart Schaefer <schaefer@brasslantern.com>
   message dated "Thu, 10 Aug 2006 01:01:02 -0700."
Date: Thu, 10 Aug 2006 10:27:10 +0100
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 10 Aug 2006 09:27:11.0443 (UTC) FILETIME=[28861A30:01C6BC5F]
Content-Type: text/plain
MIME-Version: 1.0
X-Scanned-By: MailControl A-07-04-01 (www.mailcontrol.com) on 10.67.0.137

Bart Schaefer wrote:
> How did you ever track this down?

That's three evenings which will never come again.

Once I'd found that array indexing for mgtab was off, which took a
certain amount of digging since it's referenced in some odd ways, it
wasn't so hard to find out how the limits were being set and how the
assumption in the line limit was being violated.

As I indicated, whether the assumption is present at all and only the
places where I've applied the fix is another matter to be determined...

> It may be worthwhile (or at least satisfying to paranoid types) to add
> the following patch, which I've had sitting around uncommitted because
> it failed to resolve the addressing issues that you seem to finally
> have identified.  This patch prevents the infinite loop alluded to in
> 21842, by catching cases where an array index starts out negative and
> decrements from there.  It might be unnecessary now, but:

I don't think I've done anything which would prevent this infinite loop.
mcols comes from the global columns which comes from the environment, so
if that's negative there are problems.  So I think this would be useful.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070


To access the latest news from CSR copy this link into a web browser:  http://www.csr.com/email_sig.php

