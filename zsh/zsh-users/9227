From zsh-users-return-9227-mason-zsh=primenet.com.au@sunsite.dk Thu Aug 04 12:02:01 2005
Return-Path: <zsh-users-return-9227-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 21859 invoked from network); 4 Aug 2005 12:01:55 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 4 Aug 2005 12:01:55 -0000
Received: (qmail 20348 invoked from network); 4 Aug 2005 12:01:47 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Aug 2005 12:01:47 -0000
Received: (qmail 29535 invoked by alias); 4 Aug 2005 12:01:40 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 9227
Received: (qmail 29522 invoked from network); 4 Aug 2005 12:01:39 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 4 Aug 2005 12:01:39 -0000
Received: (qmail 19341 invoked from network); 4 Aug 2005 12:01:39 -0000
Received: from corvus.et.put.poznan.pl (150.254.11.9)
  by a.mx.sunsite.dk with SMTP; 4 Aug 2005 12:01:32 -0000
Received: from corvus (corvus.et.put.poznan.pl [150.254.11.9])
	by corvus.et.put.poznan.pl (8.11.6+Sun/8.11.6) with ESMTP id j74C1US03958;
	Thu, 4 Aug 2005 14:01:30 +0200 (MET DST)
Received: from helios.et.put.poznan.pl ([150.254.29.65])
	by corvus.et.put.poznan.pl (MailMonitor for SMTP v1.2.2 ) ;
	Thu, 4 Aug 2005 14:01:28 +0200 (MET DST)
Received: from localhost.et.put.poznan.pl (pc3169.et.put.poznan.pl [150.254.11.169])
	by helios.et.put.poznan.pl (8.11.6+Sun/8.11.6) with ESMTP id j74C1QD17204;
	Thu, 4 Aug 2005 14:01:26 +0200 (MET DST)
Received: by localhost.et.put.poznan.pl (Postfix, from userid 1001)
	id 390D4121822; Thu,  4 Aug 2005 14:01:33 +0200 (CEST)
Date: Thu, 4 Aug 2005 14:01:32 +0200
From: Adam Piatyszek <ediap@ET.PUT.Poznan.PL>
To: Peter Stephenson <pws@csr.com>
Cc: zsh-users@sunsite.dk
Subject: Re: SVN completion problem
Message-ID: <20050804120132.GA3460@lespaul.et.put.poznan.pl>
Reply-To: Adam Piatyszek <ediap@ET.PUT.Poznan.PL>
Mail-Followup-To: Adam Piatyszek <ediap@et.put.poznan.pl>,
	Peter Stephenson <pws@csr.com>, zsh-users@sunsite.dk
References: <20050804071923.GB10096@lespaul.et.put.poznan.pl> <26217.1123151188@trentino.groupinfra.com> <20050804105055.GJ10096@lespaul.et.put.poznan.pl> <10499.1123156312@csr.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-2
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <10499.1123156312@csr.com>
User-Agent: Mutt/1.5.8i
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham 
	version=3.0.4

* Peter Stephenson <pws@csr.com> [04.08.2005 13:51]:
> In the latest version svn already gets called with LC_MESSAGES=C to
> work around this.  Do you have an old version?  The file in the
> source bundle is Completion/Unix/Command/_subversion.

My zsh version is:

#v+
ediap@lespaul ~ % qpkg -I -v zsh
app-shells/zsh-4.2.5 *
#v-

It seems that it is the latest stable release denoted in
http://zsh.sunsite.dk/News/

OK. I managed to fix the `_subversion' file by adding LC_ALL=C and now
it works...

Here is a patch:

#v+
--- _subversion	2005-08-04 13:50:29.000000000 +0200
+++ _subversion.new	2005-08-04 13:53:54.000000000 +0200
@@ -64,10 +64,10 @@
 _svn_subcommand () {
   local subcmd _svn_subcmds _svn_subcmd_usage
 
-  _svn_subcmd_usage=${${(M)${(f)"$(_call_program options svn help $1)"}:#usage:*}#usage: $1 }
+  _svn_subcmd_usage=${${(M)${(f)"$(_call_program options LC_ALL=C svn help $1)"}:#usage:*}#usage: $1 }
 
   _svn_subcmds=(
-    ${${=${${${(M)${(f)"$(_call_program options svn help $1)"##*Valid options:}:#* :*}%% #:*}/ arg/:arg:}/(#b)-([[:alpha:]]) \[--([a-z-]##)\](:arg:)#/(--$match[2])-$match[1]$match[3] (-$match[1])--$match[2]$match[3]}[2,-1]}
+    ${${=${${${(M)${(f)"$(_call_program options LC_ALL=C svn help $1)"##*Valid options:}:#* :*}%% #:*}/ arg/:arg:}/(#b)-([[:alpha:]]) \[--([a-z-]##)\](:arg:)#/(--$match[2])-$match[1]$match[3] (-$match[1])--$match[2]$match[3]}[2,-1]}
   )
 
   case $1 in;
@@ -108,7 +108,7 @@
   if (( ! $+_svnadmin_cmds )); then
     typeset -gA _svnadmin_cmds
     _svnadmin_cmds=(
-      ${=${(f)${${"$(_call_program commands svnadmin help)"#l#*Available subcommands:}}}/(#s)[[:space:]]#(#b)([a-z]##)[[:space:]]#(\([a-z, ?]##\))#/$match[1] :$match[1]${match[2]:+:${${match[2]//[(),]}// /:}}:}
+      ${=${(f)${${"$(_call_program commands LC_ALL=C svnadmin help)"#l#*Available subcommands:}}}/(#s)[[:space:]]#(#b)([a-z]##)[[:space:]]#(\([a-z, ?]##\))#/$match[1] :$match[1]${match[2]:+:${${match[2]//[(),]}// /:}}:}
     )
   fi
 
@@ -131,10 +131,10 @@
 _svnadmin_subcommand () {
   local subcmd _svnadmin_subcmds _svnadmin_subcmd_usage
 
-  _svnadmin_subcmd_usage=${${(M)${(f)"$(_call_program options svnadmin help $1)"}:#$1: usage:*}#$1: usage: svnadmin $1 }
+  _svnadmin_subcmd_usage=${${(M)${(f)"$(_call_program options LC_ALL=C svnadmin help $1)"}:#$1: usage:*}#$1: usage: svnadmin $1 }
 
   _svnadmin_subcmds=(
-    ${${=${${${(M)${(f)"$(_call_program options svnadmin help $1)"##*Valid options:}:#*:*}%% #:*}/ arg/:arg:}/(#b)-([[:alpha:]]) \[--([a-z-]##)\](:arg:)#/(--$match[2])-$match[1]$match[3] (-$match[1])--$match[2]$match[3]}[2,-1]}
+    ${${=${${${(M)${(f)"$(_call_program options LC_ALL=C svnadmin help $1)"##*Valid options:}:#*:*}%% #:*}/ arg/:arg:}/(#b)-([[:alpha:]]) \[--([a-z-]##)\](:arg:)#/(--$match[2])-$match[1]$match[3] (-$match[1])--$match[2]$match[3]}[2,-1]}
   )
 
   [[ "$_svnadmin_subcmd_usage" == *REPOS_PATH* ]] &&

#v-

Thanks for your help!

/ediap

-- 
-=#=-  Adam Pi±tyszek - "ediap"    -=#=-  Liunx ID: #204648         -=#=-
-=#=-  ediap (at) et.put.poznan.pl -=#=-  JID: ediap (at) chrome.pl -=#=-
-=#=-  http://ediap.prv.pl/        -=#=-  Gadu-Gadu: 1157376        -=#=-
-=#=-  PGP key ID: 0x341E22F0      -=#=-  ICQ: 3303291              -=#=-

