From zsh-users-return-12194-mason-zsh=primenet.com.au@sunsite.dk Mon Nov 05 15:37:19 2007
Return-Path: <zsh-users-return-12194-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18344 invoked from network); 5 Nov 2007 15:37:11 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 5 Nov 2007 15:37:11 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 41621 invoked from network); 5 Nov 2007 15:37:05 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 5 Nov 2007 15:37:05 -0000
Received: (qmail 20139 invoked by alias); 5 Nov 2007 15:36:56 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12194
Received: (qmail 20120 invoked from network); 5 Nov 2007 15:36:55 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 5 Nov 2007 15:36:55 -0000
Received: (qmail 40349 invoked from network); 5 Nov 2007 15:36:55 -0000
Received: from vms048pub.verizon.net (206.46.252.48)
  by a.mx.sunsite.dk with SMTP; 5 Nov 2007 15:36:49 -0000
Received: from torch.brasslantern.com ([71.116.71.62])
 by vms048.mailsrvcs.net (Sun Java System Messaging Server 6.2-6.01 (built Apr
 3 2006)) with ESMTPA id <0JR100A4UHYXCP20@vms048.mailsrvcs.net> for
 zsh-users@sunsite.dk; Mon, 05 Nov 2007 09:35:22 -0600 (CST)
Received: from torch.brasslantern.com (localhost.localdomain [127.0.0.1])
	by torch.brasslantern.com (8.13.1/8.13.1) with ESMTP id lA5FZKgQ024493; Mon,
 05 Nov 2007 07:35:20 -0800
Received: (from schaefer@localhost)	by torch.brasslantern.com
 (8.13.1/8.13.1/Submit) id lA5FZJ3b024492; Mon, 05 Nov 2007 07:35:19 -0800
Date: Mon, 05 Nov 2007 07:35:19 -0800
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: since 4.3.4, artifact-appearance at prompt
In-reply-to: <1801.1194262118@thecus>
To: Oliver Kiddle <okiddle@yahoo.co.uk>, zsh-users@sunsite.dk
Message-id: <071105073519.ZM24491@torch.brasslantern.com>
MIME-version: 1.0
X-Mailer: OpenZMail Classic (0.9.2 24April2005)
Content-type: text/plain; charset=us-ascii
References: <20071103234335.GB10499@panix.com>
	<071103183038.ZM8388@torch.brasslantern.com>	<20071104034810.GA3923@panix.com>
	<20071104070008.15348.qmail@smasher.org>
	<071104094803.ZM22628@torch.brasslantern.com>	<1801.1194262118@thecus>
Comments: In reply to Oliver Kiddle <okiddle@yahoo.co.uk>
 "Re: since 4.3.4, artifact-appearance at prompt" (Nov  5, 11:28am)

On Nov 5, 11:28am, Oliver Kiddle wrote:
}
} Bart wrote:
} > [*] I can't make this happen no matter how fast I hammer on the enter
} > key, so I suspect this is related to other problems with slow prompts.
} 
} I've seen it happen occasionally over a slow ssh connection.
} 
} Could we perhaps do an stty -echo around the printing of the % up until
} the newline is printed.

It's apparent that the "\r" that is being printed at the end of the
promptsp output doesn't actually fix the problem Wayne described, or
Russell wouldn't be reporting it.  You can still get a % on a blank
line from typeahead.

On the other hand I think "stty -echo" in the midst of typeahead could
cause even more confusion.

} Is the default really printing %# (the prompt expansion) as opposed to
} a literal % character?

Yep, in fact it's "%B%S%#%s%b", see Src/utils.c:preprompt().

