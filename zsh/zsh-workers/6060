From zsh-workers-return-6060-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Apr 19 10:01:01 1999
Return-Path: <zsh-workers-return-6060-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17645 invoked from network); 19 Apr 1999 10:00:59 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 19 Apr 1999 10:00:59 -0000
Received: (qmail 22218 invoked by alias); 19 Apr 1999 10:00:43 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 6060
Received: (qmail 22208 invoked from network); 19 Apr 1999 10:00:42 -0000
Date: Mon, 19 Apr 1999 12:00:37 +0200 (MET DST)
Message-Id: <199904191000.MAA19181@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Peter Stephenson's message of Mon, 19 Apr 1999 11:18:51 +0200
Subject: Re: compstate[old_list]


Peter Stephenson wrote:

> I tried to add these lines to the top of _main_complete so that listing
> widgets could be made to use an existing list of completions.
> 
> if [[ $WIDGET = *list* && -n $compconfig[old_list] &&
>   -n $compstate[old_list] &&
>   ( $compconfig[old_list] = always || $compstate[old_list] != shown ) ]]; then
>   compstate[old_list]=keep
>   return
> fi
> 
> But when I start a non-contextual completion, and the list is displayed by
> autolist, and I then type ^D, this doesn't work --- it seems
> $compstate[old_list] is not set.  Is this just me?

This was caused in zle_main.c, which I obviously forgot to change.

Bye
 Sven

diff -u os/Zle/zle_main.c Src/Zle/zle_main.c
--- os/Zle/zle_main.c	Tue Apr 13 09:41:27 1999
+++ Src/Zle/zle_main.c	Mon Apr 19 11:59:59 1999
@@ -579,12 +579,7 @@
 
 	if(!(wflags & ZLE_KEEPSUFFIX))
 	    removesuffix();
-	if(!(wflags & ZLE_MENUCMP) ||
-	   ((wflags & WIDGET_NCOMP) && compwidget != w)) {
-	    /* If we are doing a special completion, and the widget
-	     * is not the one currently in use for special completion,
-	     * we are starting a new completion.
-	     */
+	if(!(wflags & ZLE_MENUCMP)) {
 	    fixsuffix();
 	    invalidatelist();
 	}

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

