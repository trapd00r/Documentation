From zsh-users-return-12185-mason-zsh=primenet.com.au@sunsite.dk Sun Nov 04 14:52:36 2007
Return-Path: <zsh-users-return-12185-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20147 invoked from network); 4 Nov 2007 14:52:28 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.2.3
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 4 Nov 2007 14:52:28 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 45926 invoked from network); 4 Nov 2007 14:52:19 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 4 Nov 2007 14:52:19 -0000
Received: (qmail 6261 invoked by alias); 4 Nov 2007 14:52:11 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 12185
Received: (qmail 6246 invoked from network); 4 Nov 2007 14:52:10 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 4 Nov 2007 14:52:10 -0000
Received: (qmail 44876 invoked from network); 4 Nov 2007 14:52:10 -0000
Received: from nf-out-0910.google.com (64.233.182.191)
  by a.mx.sunsite.dk with SMTP; 4 Nov 2007 14:52:04 -0000
Received: by nf-out-0910.google.com with SMTP id d21so1144680nfb
        for <zsh-users@sunsite.dk>; Sun, 04 Nov 2007 06:52:02 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=beta;
        h=domainkey-signature:received:received:from:to:subject:references:date:in-reply-to:message-id:user-agent:mime-version:content-type;
        bh=uB8oEi/dUI90ejTvhd1HY45eMzp9pD8ZDH9lWME0NKA=;
        b=L0azu0xGRHBZOiYPAUGdK9lTah8qK8fI3ktcQQn0LFeThoIjeNwATjidXMd2B0yI+ts2SncWP2PsGH/8MMYsYxKq/MFnNWn2It+/YvBgvjDRx78HRWTrj5wepMPH3PM3PJViJgE5I75OIIO8sLXcEWnwZc3u++tFHc4YIInlqfA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=beta;
        h=received:from:to:subject:references:date:in-reply-to:message-id:user-agent:mime-version:content-type;
        b=GZM62zoZCjZN5vSIJQ60JYt3818JzHsA+92oAvR861SPdX3st9fKUfa120PFEI7StqWk3fQf80OR3vmeDhJpanAfVhx9PLZqAq0RV8mFPq9uVzz+Encq9i9PPwuJJSBHhyAGEj2wRbn+mvmf5P7R/WPPvXHtP2XBN+s7eOg/Zbo=
Received: by 10.78.203.15 with SMTP id a15mr2955911hug.1194187921924;
        Sun, 04 Nov 2007 06:52:01 -0800 (PST)
Received: from brian.griffin ( [87.181.109.98])
        by mx.google.com with ESMTPS id i5sm12201672mue.2007.11.04.06.52.00
        (version=TLSv1/SSLv3 cipher=OTHER);
        Sun, 04 Nov 2007 06:52:01 -0800 (PST)
From: Benjamin Andresen <bandresen@gmail.com>
To: zsh-users@sunsite.dk
Subject: Re: since 4.3.4, artifact-appearance at prompt
References: <20071103234335.GB10499@panix.com>
Date: Sun, 04 Nov 2007 15:51:58 +0100
In-Reply-To: <20071103234335.GB10499@panix.com> (Russell Hoover's message of "Sat\, 3 Nov 2007 19\:43\:35 -0400")
Message-ID: <87sl3m2hdd.fsf@brian.griffin>
User-Agent: Gnus/5.11 (Gnus v5.11) Emacs/23.0.50 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

Russell Hoover <rj@panix.com> writes:

> I always now get, at the leftmost column of the blank line, the
> appearance of a percent-sign backgrounded in orange.

I have the same problem. But the percent sign is inverted for me,
always the inverted terminal backgroud colour.  I tried to ask people
in #zsh, but nobody could reproduce it...

It especially often happens when I exit applications with ^D.
(Currently I can _only_ reproduce it that way.)

For instance, take this example:

$ PROMPT='zsh%% ' zsh -f
zsh% rc
% % (Inverted colour, after pressing ^D)
zsh% 

the same happens with sbcl, irb and some other line based application.
(Not ed though. And if I strace =rc, it doesn't show the percent sign,
but it does when I strace zsh. So I guess it's related to zsh.)

<snip from strace>
rt_sigaction(SIGINT, {0x80a2fc0, [], SA_INTERRUPT}, NULL, 8) = 0
write(10, "\33[1m\33[3m%\33[23m\33[1m\33[0m          "..., 167%
) = 167
rt_sigaction(SIGINT, {0x80a2fc0, [], SA_INTERRUPT}, NULL, 8) = 0
<snap>
(Important, the percent sign above is inverted.)

rc is the smallest binary I could get to show the problem and it looks
as if it isn't related to readline as I first thought.

zsh% ldd =rc
        linux-gate.so.1 =>  (0xb7f5a000)
        libm.so.6 => /lib/libm.so.6 (0xb7f24000)
        libutil.so.1 => /lib/libutil.so.1 (0xb7f20000)
        libpthread.so.0 => /lib/libpthread.so.0 (0xb7f08000)
        libc.so.6 => /lib/libc.so.6 (0xb7dd2000)
        /lib/ld-linux.so.2 (0xb7f5b000)

I accepted the fate, I just wanted to give additional information. :-)

hth,
benny

