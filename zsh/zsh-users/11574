From zsh-users-return-11574-mason-zsh=primenet.com.au@sunsite.dk Sat Jun 16 17:28:33 2007
Return-Path: <zsh-users-return-11574-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 20763 invoked from network); 16 Jun 2007 17:28:31 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.1 (2007-05-02) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.1
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 16 Jun 2007 17:28:31 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 614 invoked from network); 16 Jun 2007 17:28:25 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 16 Jun 2007 17:28:25 -0000
Received: (qmail 4171 invoked by alias); 16 Jun 2007 17:28:17 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 11574
Received: (qmail 4159 invoked from network); 16 Jun 2007 17:28:16 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 16 Jun 2007 17:28:16 -0000
Received: (qmail 99166 invoked from network); 16 Jun 2007 17:28:16 -0000
Received: from mtaout02-winn.ispmail.ntl.com (81.103.221.48)
  by a.mx.sunsite.dk with SMTP; 16 Jun 2007 17:28:13 -0000
Received: from aamtaout03-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout02-winn.ispmail.ntl.com with ESMTP
          id <20070616172811.EYCA4.mtaout02-winn.ispmail.ntl.com@aamtaout03-winn.ispmail.ntl.com>
          for <zsh-users@sunsite.dk>; Sat, 16 Jun 2007 18:28:11 +0100
Received: from pwslaptop.csr.com ([81.107.45.67])
          by aamtaout03-winn.ispmail.ntl.com with ESMTP
          id <20070616172811.TPZK26699.aamtaout03-winn.ispmail.ntl.com@pwslaptop.csr.com>
          for <zsh-users@sunsite.dk>; Sat, 16 Jun 2007 18:28:11 +0100
Received: from pwslaptop.csr.com (pwslaptop.csr.com [127.0.0.1])
	by pwslaptop.csr.com (8.13.8/8.13.7) with ESMTP id l5GHPwPm004038
	for <zsh-users@sunsite.dk>; Sat, 16 Jun 2007 18:25:59 +0100
Message-Id: <200706161725.l5GHPwPm004038@pwslaptop.csr.com>
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-users@sunsite.dk
Subject: Re: how to customize _all_matches use? 
In-Reply-To: Message from Vadim Zeitlin <vz-zsh@zeitlins.org> 
   of "Fri, 15 Jun 2007 22:25:31 +0200." <20070615202549.MSYR16334.aamtain04-winn.ispmail.ntl.com@a.mx.sunsite.dk> 
Date: Sat, 16 Jun 2007 18:25:58 +0100

Vadim Zeitlin wrote:
>  I'd like to have a key binding which would complete all matches which I
> would get by pressing TAB at once. AFAICS from the manual/user guide, this
> is what the all-matches completer is for and so, following the examples
> there, I tried to do the following:
> 
> 	% zle -C all-matches complete-word _generic
> 	% bindkey '^Xa' all-matches
> 	% zstyle ':completion:all-matches:*' completer _all_matches
> 
> However this doesn't seem to work:
> 
> 	% ls
> 	bar  baz  foo
> 	% ls ^Xa # nothing happens
> 
> I do get the behaviour I want if I do
> 
> 	% zstyle ':completion:all-matches:*' completer _all_matches _complete
> 
> but with one extremely annoying side-effect:
> 
> 	% ls ^Xa
> 	% ls bar baz foo # this is the same line completed by the shell
> 	bar baz foo
> 	bar  baz  foo

The following should fix it:

zstyle ':completion:all-matches:*' insert true

This is mentioned in the manual under the style "insert", but you have
to go hunting and have some idea of what you're looking for (I actually
found it by looking at the completer itself.)  The business about the
completer doesn't seemed to be mentioned at all, but I have the same
experience as you.  It looks like the manual needs to be updated.

>  And, of course, I don't really want to have this behaviour so much for ls
> as for other commands where the completion can't be replaced with just '*'.
> For example, it would be very useful to have for "cvs diff" for which I use
> 
> 	zstyle ':completion::complete:cvs-diff:argument-rest:' \
> 		tag-order existing-files removed-files directories
> 
> so that pressing TAB after "cvs di" normally completes only the modified
> files. But pressing ^Xa also completes the sub-directories -- is there any
> way I could avoid this?

I haven't tried this, but you *should* still be able to use the
tag-order style with all-matches.  The context will be different,
though; as in the styles you quoted it should start
':completion:all-matches:'.  If it's not that obvious or nothing works,
let us know.

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

