From zsh-workers-return-7155-mason-zsh=primenet.com.au@sunsite.auc.dk Thu Jul 15 10:15:35 1999
Return-Path: <zsh-workers-return-7155-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 15896 invoked from network); 15 Jul 1999 10:15:32 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 15 Jul 1999 10:15:32 -0000
Received: (qmail 27059 invoked by alias); 15 Jul 1999 10:15:17 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 7155
Received: (qmail 27052 invoked from network); 15 Jul 1999 10:15:16 -0000
Message-Id: <9907150944.AA40348@ibmth.df.unipi.it>
To: zsh-workers@sunsite.auc.dk (Zsh hackers list)
Subject: PATCH: 3.1.6-test-1: small zftp changes
Date: Thu, 15 Jul 1999 11:44:17 +0200
From: Peter Stephenson <pws@ibmth.df.unipi.it>

Since I'm not going to be doing anything major soon, here are two small
changes to the zftp functions to get them out of the way.

--- Functions/Zftp/zfgoto.bak	Fri Jun 11 17:55:19 1999
+++ Functions/Zftp/zfgoto	Thu Jul 15 11:41:18 1999
@@ -67,7 +67,10 @@
 host=${line%%:*}
 dir=${line#*:}
 
-if [[ $user = ftp || $user = anonymous ]]; then
+if [[ $ZFTP_USER = $user && $ZFTP_HOST = $host ]]; then
+  # We're already there, just change directory
+  zfcd ${dir:-~}
+elif [[ $user = ftp || $user = anonymous ]]; then
   # Anonymous ftp, so we don't need password etc.
   zfanon $host && [[ -n $dir ]] && zfcd $dir
 elif [[ $zflastsession = ${host}:* && $user = $zflastuser ]]; then
--- Functions/Zftp/zfinit.bak	Fri Jun 11 18:36:36 1999
+++ Functions/Zftp/zfinit	Thu Jul 15 11:41:19 1999
@@ -1,6 +1,6 @@
 emulate -L zsh
 
-[[ $1 = -n ]] || zmodload -ia zftp
+[[ $1 = -n ]] || zmodload -e zftp || zmodload -ia zftp
 
 alias zfcd='noglob zfcd'
 alias zfget='noglob zfget'

-- 
Peter Stephenson <pws@ibmth.df.unipi.it>       Tel: +39 050 844536
WWW:  http://www.ifh.de/~pws/
Dipartimento di Fisica, Via Buonarroti 2, 56127 Pisa, Italy

