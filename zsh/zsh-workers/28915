From zsh-workers-return-28915-mason-zsh=primenet.com.au@zsh.org Fri Mar 18 22:07:14 2011
Return-Path: <zsh-workers-return-28915-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 28041 invoked by alias); 18 Mar 2011 22:07:14 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28915
Received: (qmail 28994 invoked from network); 18 Mar 2011 22:07:03 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
Received-SPF: none (ns1.primenet.com.au: domain at now.ath.cx does not designate permitted sender hosts)
X-SENDER-IP: [83.227.16.166]
X-LISTENER: [smtp.bredband.net]
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: AgxAAJdtg01T4xCmPGdsb2JhbACYeYx4CwEBAQE3MsQYhWMEjGM
X-IronPort-AV: E=Sophos;i="4.63,207,1299452400"; 
   d="scan'208";a="379303596"
From: Nikolai Weibull <now@bitwi.se>
To: zsh-workers@zsh.org
Cc: Nikolai Weibull <now@bitwi.se>
Subject: [PATCH 3/4] Fix git-branch -[dD] -r completion
Date: Fri, 18 Mar 2011 22:35:11 +0100
Message-Id: <1300484112-9392-4-git-send-email-now@bitwi.se>
X-Mailer: git-send-email 1.7.4.1
In-Reply-To: <1300484112-9392-1-git-send-email-now@bitwi.se>
References: <1300484112-9392-1-git-send-email-now@bitwi.se>

Signed-off-by: Nikolai Weibull <now@bitwi.se>
---
 Completion/Unix/Command/_git |   10 +++++++---
 1 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/Completion/Unix/Command/_git b/Completion/Unix/Command/_git
index 8a590be..0f573a1 100644
--- a/Completion/Unix/Command/_git
+++ b/Completion/Unix/Command/_git
@@ -266,8 +266,12 @@ _git-branch () {
   if (( words[(I)-d] || words[(I)-D] )); then
     dependent_creation_args=
     dependent_deletion_args=(
-      '-r[delete remote-tracking branches]'
-      '*: :__git_ignore_line_inside_arguments __git_branch_names')
+      '-r[delete remote-tracking branches]')
+    if (( words[(I)-r] )); then
+      dependent_deletion_args+='*: :__git_ignore_line_inside_arguments __git_remote_branch_names'
+    else
+      dependent_deletion_args+='*: :__git_ignore_line_inside_arguments __git_branch_names'
+    fi
   fi
 
   declare -a dependent_modification_args
@@ -4913,7 +4917,7 @@ __git_remote_branch_names () {
   local expl
   declare -a branch_names
 
-  branch_names=(${${(f)"$(_call_program remote-branch-refs git for-each-ref --format='%(refname)' refs/remotes 2>/dev/null)"}#refs/remotes/})
+  branch_names=(${${(f)"$(_call_program remote-branch-refs git for-each-ref --format='"%(refname)"' refs/remotes 2>/dev/null)"}#refs/remotes/})
   __git_command_successful $pipestatus || return
 
   _wanted remote-branch-names expl 'remote branch name' compadd $* - $branch_names
-- 
1.7.4.1

