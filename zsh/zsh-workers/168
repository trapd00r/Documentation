From zsh-workers-request@math.gatech.edu  Fri Jul  7 18:21:39 1995
Received: from gatech.edu (gatech.edu [130.207.244.244]) by werple.mira.net.au (8.6.12/8.6.9) with SMTP id SAA00536 for <mason@werple.mira.net.au>; Fri, 7 Jul 1995 18:21:31 +1000
Received: from math (math.skiles.gatech.edu) by gatech.edu with SMTP id AA19230
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Fri, 7 Jul 1995 04:17:49 -0400
Received: by math (5.x/SMI-SVR4)
	id AA19233; Fri, 7 Jul 1995 04:14:20 -0400
Resent-Date: Fri, 7 Jul 95 4:15:14 EDT
Old-Return-Path: <jszabo@usacs.rutgers.edu>
Date: Fri, 7 Jul 95 4:15:14 EDT
From: The Power Hungry <jszabo@usacs.rutgers.edu>
To: zsh-workers@math.gatech.edu
Subject: TERM bug
Message-Id: <CMM-RU.1.4.805104914.jszabo@usacs.rutgers.edu>
Resent-Message-Id: <"QsSQ3.0.Ni4.RpE_l"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/168
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

If I start with TERM set to vt100, then change it to tty, then change it back
to vt100, the prompt loses it's escape sequences, and the RPROMPT is gone:

4:07am usacs ~/zsh-2.6-beta10 % TERM=tty                       [vt100] 07/07/95
4:07am usacs ~/zsh-2.6-beta10 % TERM=vt100
4:07am usacs ~/zsh-2.6-beta10 % exec -zsh
. .zshrc
  4:08am  up 85 days, 10:38,  6 users,  load average: 0.75, 0.48, 0.55
4:08am usacs ~/zsh-2.6-beta10 % fg                             [vt100] 07/07/95

You can't see it here, but at first usacs is bold and [vt100] is
reverse video.  The first is normal text and the second is gone after
TERM goes from vt100 to tty back to vt100.  It's gotten better though,
in older beta versions when you pressed return on a dumb terminal you
never got a new prompt.

I'm on a sun running sunos.  I'm not on the mailinglist, so please
reply by email.  Here is the output of reporter:

# START zsh saveset
# uname:  SunOS usacs.rutgers.edu 4.1.3_U1 3 sun4

# Aliases.

alias 3='\'| pr -3 -t -l1\''
alias F='\'| figlet\''
alias G='\'| egrep -i\''
alias GF='\'| fgrep -f ~/.friends\''
alias L='\'| less\''
alias M='\'| mail\''
alias S='\'| sort -n\''
alias W='\'| write\''
alias a='alias'
alias att='\'telnet guard.research.att.com\''
alias b='banner'
alias back='\'xv -ncols 206 -root -rmode 5 -maxpect -quit\''
alias bindkey='\'noglob bindkey\''
alias c='clear'
alias clam='\'rlogin -8 clam\''
alias convo='\'rlogin convolution\''
alias cp='\'cp -i\''
alias d='\'ls -d .*\''
alias dh='\'dirs -v\''
alias dot='\'ls -a | grep \'\'^\..*\'\'\''
alias e='echo'
alias eden='\'rlogin -8 eden\''
alias en='\'enscript -2rGh\''
alias f='finger'
alias find='\'noglob find\''
alias fm='\'finger -m\''
alias gan='\'rlogin -8 gandalf\''
alias h='history'
alias hinfo='\'host -t hinfo\''
alias igor='\'telnet ny.mtek.chalmers.se 1701\''
alias j='jobs'
alias k9='\'kill -9\''
alias kxlock='\'kill $(ps -ax G xlock | awk "{print $1}")\''
alias l='less'
alias lc='\'wc -l\''
alias lock='\'lock -p -t 60000\''
alias ls='\'ls -F\''
alias lsd='\'ls -d */\''
alias m='make'
alias macx.ad='\'xrdb -merge macx.ad\''
alias move='\'cat .log >>.log2; rm .log\''
alias mroe='more'
alias mv='\'nocorrect mv -i\''
alias myps='\'ps -x\''
alias nrable='\'ls -AFltrd *(^R)\''
alias nw='\'l -ltr | tail\''
alias p='print'
alias pcount='\'lpr -Plp6 ~/bin/ps.pages; lpq -Plp6\''
alias pd='pushd'
alias peg='\'rlogin -8 pegasus\''
alias pop='popd'
alias q='\'quota -v\''
alias rable='\'ls -AFltrd *(R)\''
alias relog='\'. ~/.zshrc; log\''
alias rem='\'rlogin -8 remus\''
alias rep='\'l =(!!)\''
alias rlogin='\'rlogin -8\''
alias rmail='\'emacs -f rmail\''
alias rom='\'rlogin -8 romulus\''
alias siz='\'ls -s | sort -n\''
alias sn='\'sed -n\''
alias strings='\'strings -\''
alias t='cat'
alias un='unalias'
alias unpr='\'unset RPROMPT\''
alias up='uptime'
alias v='mv'
alias vt='\'TERM=vt102\''
alias where='\'hostname; echo >/dev/null\''
alias which='\'which -a\''
alias which-command='whence'
alias whoami='\'echo root\''
alias win='\'x -options -fn 6x12 -- \''
alias work='\'rlogin -8 -l szabo cnj.digex.com\''
alias xdef='\'xrdb -merge .Xdefaults\''
alias xwork='\'x -casify -rlogin -l szabo cnj.digex.com\''
alias z='suspend'
alias zcomp='\'. ~/.zcomp\''
alias zlogin='\'. ~/.zlogin\''
alias zshenv='\'. ~/.zshenv\''
alias zshrc='\'. ~/.zshrc\''

# Key bindings.

bindkey -r "^@"
bindkey -r "^A"
bindkey -r "^B"
bindkey -r "^C"
bindkey -r "^D"
bindkey -r "^E"
bindkey -r "^F"
bindkey -r "^G"
bindkey -r "^H"
bindkey -r "^I"
bindkey -r "^J"
bindkey -r "^K"
bindkey -r "^L"
bindkey -r "^M"
bindkey -r "^N"
bindkey -r "^O"
bindkey -r "^P"
bindkey -r "^Q"
bindkey -r "^R"
bindkey -r "^S"
bindkey -r "^T"
bindkey -r "^U"
bindkey -r "^V"
bindkey -r "^W"
bindkey -r "^X"
bindkey -r "^Y"
bindkey -r "^Z"
bindkey -r "\e"
bindkey -r "^_"
bindkey -r " "
bindkey -r "^?"
bindkey -r "\M-/"
bindkey -r "\M-="
bindkey -r "^X^A"
bindkey -r "^X^B"
bindkey -r "^X^F"
bindkey -r "^X^J"
bindkey -r "^X^K"
bindkey -r "^X^N"
bindkey -r "^X^O"
bindkey -r "^X^U"
bindkey -r "^X^V"
bindkey -r "^X^X"
bindkey -r "^X^Z"
bindkey -r "^X*"
bindkey -r "^XG"
bindkey -r "^Xg"
bindkey -r "^Xr"
bindkey -r "^Xs"
bindkey -r "^Xu"
bindkey -r "\e^D"
bindkey -r "\e^G"
bindkey -r "\e^H"
bindkey -r "\e^I"
bindkey -r "\e^J"
bindkey -r "\e^L"
bindkey -r "\e^M"
bindkey -r "\e^_"
bindkey -r "\e "
bindkey -r "\e!"
bindkey -r "\e\""
bindkey -r "\e$"
bindkey -r "\e'"
bindkey -r "\e-"
bindkey -r "\e."
bindkey -r "\e0"
bindkey -r "\e1"
bindkey -r "\e2"
bindkey -r "\e3"
bindkey -r "\e4"
bindkey -r "\e5"
bindkey -r "\e6"
bindkey -r "\e7"
bindkey -r "\e8"
bindkey -r "\e9"
bindkey -r "\e<"
bindkey -r "\e>"
bindkey -r "\e?"
bindkey -r "\eA"
bindkey -r "\eB"
bindkey -r "\eC"
bindkey -r "\eD"
bindkey -r "\eF"
bindkey -r "\eG"
bindkey -r "\eH"
bindkey -r "\eL"
bindkey -r "\eN"
bindkey -r "\eP"
bindkey -r "\eQ"
bindkey -r "\eR"
bindkey -r "\eS"
bindkey -r "\eT"
bindkey -r "\eU"
bindkey -r "\eW"
bindkey -r "\e[A"
bindkey -r "\e[B"
bindkey -r "\e[C"
bindkey -r "\e[D"
bindkey -r "\e_"
bindkey -r "\ea"
bindkey -r "\eb"
bindkey -r "\ec"
bindkey -r "\ed"
bindkey -r "\ef"
bindkey -r "\eg"
bindkey -r "\eh"
bindkey -r "\el"
bindkey -r "\en"
bindkey -r "\ep"
bindkey -r "\eq"
bindkey -r "\er"
bindkey -r "\es"
bindkey -r "\et"
bindkey -r "\eu"
bindkey -r "\ew"
bindkey -r "\ex"
bindkey -r "\ey"
bindkey -r "\ez"
bindkey -r "\e|"
bindkey -r "\e^?"
bindkey -r "\M-/"
bindkey -r "\M-="

bindkey "^@"	set-mark-command
bindkey "^A"	beginning-of-line
bindkey "^B"	backward-char
bindkey "^C"	undefined-key
bindkey "^D"	delete-char-or-list
bindkey "^E"	end-of-line
bindkey "^F"	forward-char
bindkey "^G"	send-break
bindkey "^H"	backward-delete-char
bindkey "^I"	expand-or-complete
bindkey "^J"	accept-line
bindkey "^K"	kill-line
bindkey "^L"	clear-screen
bindkey "^M"	accept-line
bindkey "^N"	down-line-or-history
bindkey "^O"	accept-line-and-down-history
bindkey "^P"	up-line-or-history
bindkey "^Q"	push-line
bindkey "^R"	history-incremental-search-backward
bindkey "^S"	history-incremental-search-forward
bindkey "^T"	transpose-chars
bindkey "^U"	kill-whole-line
bindkey "^V"	quoted-insert
bindkey "^W"	backward-kill-word
bindkey "^X"	prefix
bindkey "^Y"	yank
bindkey "^Z"	accept-and-hold
bindkey "\e"	prefix
bindkey "^_"	undo
bindkey " "	magic-space
bindkey "^?"	backward-delete-char
bindkey "\M-/"	send-string
bindkey "\M-="	send-string
bindkey "^X^A"	vi-find-prev-char-skip
bindkey "^X^B"	vi-match-bracket
bindkey "^X^F"	vi-find-next-char
bindkey "^X^J"	vi-join
bindkey "^X^K"	kill-buffer
bindkey "^X^N"	infer-next-history
bindkey "^X^O"	overwrite-mode
bindkey "^X^U"	undo
bindkey "^X^V"	vi-cmd-mode
bindkey "^X^X"	exchange-point-and-mark
bindkey "^X^Z"	universal-argument
bindkey "^X*"	expand-word
bindkey "^XG"	list-expand
bindkey "^Xg"	list-expand
bindkey "^Xr"	history-incremental-search-backward
bindkey "^Xs"	history-incremental-search-forward
bindkey "^Xu"	undo
bindkey "\e^D"	list-choices
bindkey "\e^G"	send-break
bindkey "\e^H"	backward-kill-word
bindkey "\e^I"	self-insert-unmeta
bindkey "\e^J"	self-insert-unmeta
bindkey "\e^L"	clear-screen
bindkey "\e^M"	self-insert-unmeta
bindkey "\e^_"	copy-prev-word
bindkey "\e "	expand-history
bindkey "\e!"	expand-history
bindkey "\e\""	quote-region
bindkey "\e$"	spell-word
bindkey "\e'"	quote-line
bindkey "\e-"	neg-argument
bindkey "\e."	insert-last-word
bindkey "\e0"	digit-argument
bindkey "\e1"	digit-argument
bindkey "\e2"	digit-argument
bindkey "\e3"	digit-argument
bindkey "\e4"	digit-argument
bindkey "\e5"	digit-argument
bindkey "\e6"	digit-argument
bindkey "\e7"	digit-argument
bindkey "\e8"	digit-argument
bindkey "\e9"	digit-argument
bindkey "\e<"	beginning-of-buffer-or-history
bindkey "\e>"	end-of-buffer-or-history
bindkey "\e?"	which-command
bindkey "\eA"	accept-and-hold
bindkey "\eB"	backward-word
bindkey "\eC"	capitalize-word
bindkey "\eD"	kill-word
bindkey "\eF"	forward-word
bindkey "\eG"	get-line
bindkey "\eH"	run-help
bindkey "\eL"	down-case-word
bindkey "\eN"	history-search-forward
bindkey "\eP"	history-search-backward
bindkey "\eQ"	push-line
bindkey "\eR"	toggle-literal-history
bindkey "\eS"	spell-word
bindkey "\eT"	transpose-words
bindkey "\eU"	up-case-word
bindkey "\eW"	copy-region-as-kill
bindkey "\e[A"	up-line-or-history
bindkey "\e[B"	down-line-or-history
bindkey "\e[C"	forward-char
bindkey "\e[D"	backward-char
bindkey "\e_"	insert-last-word
bindkey "\ea"	accept-and-hold
bindkey "\eb"	backward-word
bindkey "\ec"	capitalize-word
bindkey "\ed"	kill-word
bindkey "\ef"	forward-word
bindkey "\eg"	get-line
bindkey "\eh"	run-help
bindkey "\el"	down-case-word
bindkey "\en"	history-search-forward
bindkey "\ep"	history-search-backward
bindkey "\eq"	push-line
bindkey "\er"	toggle-literal-history
bindkey "\es"	spell-word
bindkey "\et"	transpose-words
bindkey "\eu"	up-case-word
bindkey "\ew"	copy-region-as-kill
bindkey "\ex"	execute-named-cmd
bindkey "\ey"	yank-pop
bindkey "\ez"	execute-last-named-cmd
bindkey "\e|"	vi-goto-column
bindkey "\e^?"	backward-kill-word
bindkey "\M-/"	"\\"
bindkey "\M-="	"|"

# Completions.


# Undefined functions.

autoload acx
autoload cdmatch
autoload check
autoload clean
autoload cx
autoload gfing
autoload harden
autoload lpr2
autoload mere
autoload multicomp
autoload namedir
autoload pick
autoload pinger
autoload ppt
autoload proto
autoload ps2
autoload randline
autoload refun
autoload run-help
autoload suns
autoload tell
autoload term
autoload testvar
autoload yp
autoload yp2
autoload yu
autoload zap
autoload zed

# Defined functions.

Xcolours () {
	reply=($(awk '{ print $4 }' < /usr/local/X11R5/lib/X11/rgb.txt)) 
}
Xcursor () {
	reply=($(awk '/^#define/ {print $2}' \
</usr/local/X11R5/include/X11/cursorfont.h | sed 's/^XC_//')) 
}
btell () {
	banner $2 | write $1
}
lookup () {
	grep $1 /etc/passwd
}
ppt2 () {
	indent -troff $1 | troff -mindent -t | lpr -Plp26
}
precmd () {
	prompt
}
prompt () {
	PROMPT='%U%t%u %B%m%b %~ %# ' 
	RPROMPT="%S[$TERM]%s %W" 
}
setenv () {
	export $1=$2
}
shfonts () {
	reply=($(cd ~/figlet2.0/; ls *.flf | sed 's/\.flf//')) 
}
shusers () {
	reply=($(users)) 
}
	echo $2 | write $1
}

# Limits.

limit datasize        511MB
limit stacksize       384MB
limit coredumpsize    0kB
limit descriptors     256

# Non-array variables.

TERMCAP=''
TERM='vt100'
ARGC="0"
ATTRIBUTION="%f wrote:"
BAUD="9600"
BIN="h01a"
CDPATH=".:/trident/u1/jszabo"
COLUMNS="80"
DIRSTACKSIZE="50"
EDITOR="/usr/local/bin/emacs"
EGID="34925"
ENV=".kshrc"
ERRNO="9"
EUID="884"
FCEDIT="emacs"
FIGNORE=".o:.pro:.old"
FPATH="/trident/u1/jszabo/func"
GID="34925"
HELPDIR="/trident/u1/jszabo/help"
HISTFILE="/trident/u1/jszabo/.zhistory"
HISTSIZE="600"
HOME="/trident/u1/jszabo"
HOST="usacs.rutgers.edu"
HOSTTYPE="sunos4.1.3_U1"
KEYTIMEOUT="40"
LANG=""
LESS="emb20"
LINENO="354"
LINES="24"
LISTMAX="100"
LITHISTSIZE="5"
LOGCHECK="60"
LOGNAME="jszabo"
MACHTYPE="sparc"
MAIL="/usr/spool/mail/jszabo"
MAILCALL="NEW MAIL! "
MAILCHECK="60"
MAILPATH="/usr/spool/mail/jszabo?You got new mail, Joey.:/trident/u1/jszabo/.log?You have been fingered, Joe."
MANPATH="/trident/u1/jszabo/man:/usr/share/man:/usr/local/X11R5/man:/usr/local/X11R4/lib/man:/usr/local/gnu/man"
NULLCMD="cat"
OLDPWD="/trident/u1/jszabo/zsh-2.6-beta10"
OPTARG=""
OPTIND="1"
OSTYPE="sunos4.1.3_U1"
PAGER="less"
PATH="/trident/u1/jszabo/bin:/usr/local/gnu/bin:/usr/local/bin:/usr/ucb:/usr/bin:/usr/5bin:/usr/local/X11R5/bin:/usr/local/X11R4/bin:/usr/etc:/usr/games:/usr/openwin/bin:/usr/local/etc/jrslide:."
PERIOD="0"
POSTEDIT=""
PPID="24145"
PRINTER="lp26"
PROMPT="%U%t%u %B%m%b %~ %# "
PROMPT2="> "
PROMPT3="?# "
PROMPT4="+ "
PS1="%U%t%u %B%m%b %~ %# "
PS2="> "
PS3="?# "
PS4="+ "
PSVAR=""
PWD="/trident/u1/jszabo/zsh-2.6-beta10/Util"
RANDOM="28917"
READNULLCMD="less"
REPORTTIME="-1"
RPROMPT="%S[vt100]%s %W"
RPS1="%S[vt100]%s %W"
SAVEHIST="600"
SECONDS="244"
SHELL="/trident/u1/jszabo/bin/zsh"
SHLVL="1"
SPROMPT="zsh: correct \`%R\' to \`%r\' [nyae]? "
TIMEFMT="%J  %U user %S system %P cpu %*E total"
TMOUT="14400"
TMPPREFIX="/tmp/zsh"
TROFF="groff"
TTY="/dev/ttypc"
UID="884"
USER="jszabo"
USERNAME="jszabo"
VENDOR="sun"
WATCH="radetich:harding:amyt:davem:slm:malorenc"
WATCHFMT="%n %a from %m at %t."
WORDCHARS="*?_-.[]~=/&;!#$%^(){}<>"
XCMSDB="/trident/u1/jszabo/Xcmsrgb.txt"
YOUSAID="In %C you wrote:"
ZSH_NAME="zsh"
ZSH_VERSION="2.6-beta10"
each="unix"
histchars="!^#"
reporter_junkiequotes="no"
status="1"
str="SunOS usacs.rutgers.edu 4.1.3_U1 3 sun4"
xwin="/usr/local/X11R5/"
prompt='test%'

# Array variables.

argv=()
cdpath=(. /trident/u1/jszabo)
fignore=(.o .pro .old)
fpath=(/trident/u1/jszabo/func)
hosts=(remus romulus gandalf eden prep.ai.mit.edu)
mail=(/usr/spool/mail/jszabo .log)
mailpath=(/usr/spool/mail/jszabo?You got new mail, Joey. /trident/u1/jszabo/.log?You have been fingered, Joe.)
manpath=(/trident/u1/jszabo/man /usr/share/man /usr/local/X11R5/man /usr/local/X11R4/lib/man /usr/local/gnu/man)
path=(/trident/u1/jszabo/bin /usr/local/gnu/bin /usr/local/bin /usr/ucb /usr/bin /usr/5bin /usr/local/X11R5/bin /usr/local/X11R4/bin /usr/etc /usr/games /usr/openwin/bin /usr/local/etc/jrslide .)
psvar=()
signals=(EXIT HUP INT QUIT ILL TRAP IOT EMT FPE KILL BUS SEGV SYS PIPE ALRM TERM URG STOP TSTP CONT CHLD TTIN TTOU IO XCPU XFSZ VTALRM PROF WINCH LOST USR1 USR2 ZERR DEBUG)
watch=(radetich harding amyt davem slm malorenc)

# Exported variables.

export TERMCAP
export TERM
export ATTRIBUTION
export BIN
export EDITOR
export ENV
export FCEDIT
export HOME
export LESS
export LOGNAME
export MAIL
export MAILCALL
export PAGER
export PATH
export PRINTER
export PWD
export READNULLCMD
export SHELL
export SHLVL
export TERM
export TROFF
export USER
export XCMSDB
export YOUSAID

# Setopt.

setopt appendhistory
setopt autocd
setopt autolist
setopt autoparamkeys
setopt autopushd
setopt autoresume
setopt cdablevars
setopt completeinword
setopt correct
setopt extendedglob
setopt globdots
setopt hashcmds
setopt hashdirs
setopt hashlistall
setopt histignoredups
setopt login
setopt longlistjobs
setopt noclobber
setopt nohup
setopt nolistbeep
setopt notify
setopt promptsubst
setopt pushdminus
setopt pushdsilent
setopt pushdtohome
setopt rcquotes
setopt sunkeyboardhack

# END zsh saveset

