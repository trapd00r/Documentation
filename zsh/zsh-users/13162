From zsh-users-return-13162-mason-zsh=primenet.com.au@sunsite.dk Sat Aug 30 11:57:23 2008
Return-Path: <zsh-users-return-13162-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 9613 invoked from network); 30 Aug 2008 11:57:11 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 30 Aug 2008 11:57:11 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 9571 invoked from network); 30 Aug 2008 11:56:56 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 30 Aug 2008 11:56:56 -0000
Received: (qmail 609 invoked by alias); 30 Aug 2008 11:56:27 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13162
Received: (qmail 591 invoked from network); 30 Aug 2008 11:56:26 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 30 Aug 2008 11:56:26 -0000
Received: from mtaout02-winn.ispmail.ntl.com (mtaout02-winn.ispmail.ntl.com [81.103.221.48])
	by bifrost.dotsrc.org (Postfix) with ESMTP id 73654801E2B4
	for <zsh-users@sunsite.dk>; Sat, 30 Aug 2008 13:56:23 +0200 (CEST)
Received: from aamtaout01-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout02-winn.ispmail.ntl.com with ESMTP
          id <20080830115622.LEJ21103.mtaout02-winn.ispmail.ntl.com@aamtaout01-winn.ispmail.ntl.com>
          for <zsh-users@sunsite.dk>; Sat, 30 Aug 2008 12:56:22 +0100
Received: from pws-pc ([81.107.43.40]) by aamtaout01-winn.ispmail.ntl.com
          with ESMTP
          id <20080830115622.FHUA5827.aamtaout01-winn.ispmail.ntl.com@pws-pc>
          for <zsh-users@sunsite.dk>; Sat, 30 Aug 2008 12:56:22 +0100
Date: Sat, 30 Aug 2008 12:56:14 +0100
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-users@sunsite.dk
Subject: Re: Minor tweak for _module completion
Message-ID: <20080830125614.3b735308@pws-pc>
In-Reply-To: <877685.18033.qm@web36807.mail.mud.yahoo.com>
References: <877685.18033.qm@web36807.mail.mud.yahoo.com>
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.11; x86_64-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: ClamAV 0.92.1/8120/Sat Aug 30 05:43:49 2008 on bifrost
X-Virus-Status: Clean

On Sat, 30 Aug 2008 03:58:11 -0700 (PDT)
Daniel Qarras <dqarras@yahoo.com> wrote:
> the attached patch hides backup files (ending with ~, often created
> unknowingly with emacs by many users) while completing for "module".
> 
> (I presume it was ok to use "grep -E" instead of two grep commands,
> ie, "grep -E" should be supported where zsh can be used? If not, please
> feel free to modify if needed.)

The following simply strips modules ending in "~" within the shell,
instead.  I haven't tried it out since I don't have a suitable set-up.

It ought to be possible to make _module use $fignore (or the equivalent
as a style) but I haven't investigated that.  It would be neater to do
that, but it would take more fiddling around and this is a common enough
case it's probably worth doing anyway.

Index: Completion/Unix/Command/_module
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_module,v
retrieving revision 1.6
diff -u -r1.6 _module
--- Completion/Unix/Command/_module	2 Oct 2007 09:08:27 -0000	1.6
+++ Completion/Unix/Command/_module	30 Aug 2008 11:52:26 -0000
@@ -85,7 +85,7 @@
 {
   if [[ -n $MODULEPATH ]] && [[ ${+_available_modules} -eq 0 ]]
   then
-    _available_modules=($(find ${(e)=MODULEPATH//:/ } -xtype f -print 2>/dev/null | grep -v \\.version | sed -e 's,\('${${(e)=MODULEPATH//:/\/\\\|}%\\\|}'\),,g' -e 's,^/*,,g'))
+    _available_modules=(${$(find ${(e)=MODULEPATH//:/ } -xtype f -print 2>/dev/null | grep -v \\.version | sed -e 's,\('${${(e)=MODULEPATH//:/\/\\\|}%\\\|}'\),,g' -e 's,^/*,,g'):#*\~})
   fi
 }
 


-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

