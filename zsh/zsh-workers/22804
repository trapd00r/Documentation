From zsh-workers-return-22804-mason-zsh=primenet.com.au@sunsite.dk Sun Oct 01 22:50:26 2006
Return-Path: <zsh-workers-return-22804-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 27018 invoked from network); 1 Oct 2006 22:50:24 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.5 (2006-08-29) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.3 required=5.0 tests=AWL,BAYES_00,
	FORGED_RCVD_HELO autolearn=ham version=3.1.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 1 Oct 2006 22:50:24 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 17151 invoked from network); 1 Oct 2006 22:50:17 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 1 Oct 2006 22:50:17 -0000
Received: (qmail 17318 invoked by alias); 1 Oct 2006 22:50:15 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 22804
Received: (qmail 17308 invoked from network); 1 Oct 2006 22:50:15 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 1 Oct 2006 22:50:15 -0000
Received: (qmail 16967 invoked from network); 1 Oct 2006 22:50:15 -0000
Received: from ug-out-1314.google.com (66.249.92.169)
  by a.mx.sunsite.dk with SMTP; 1 Oct 2006 22:50:12 -0000
Received: by ug-out-1314.google.com with SMTP id o2so423074uge
        for <zsh-workers@sunsite.dk>; Sun, 01 Oct 2006 15:50:12 -0700 (PDT)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:to:subject:mime-version:content-type:content-transfer-encoding:content-disposition;
        b=Je3M4iJrdaNcBl556pvAuCHAEBRsn8yAsSrQZaVIOt5Z06meoYXXUk+05GmpNOcUGdv2d1PoKrbiE+3kB20scg+AzR8HKIiUdIQi1lmZREIjAhIuoMLX7VU5bIkC9GnZV1EHvdME1+hweEXDHW5WxOx/4rD0U0XLlVDE/2F2rNE=
Received: by 10.67.29.12 with SMTP id g12mr2291052ugj;
        Sun, 01 Oct 2006 15:50:12 -0700 (PDT)
Received: by 10.66.222.13 with HTTP; Sun, 1 Oct 2006 15:50:12 -0700 (PDT)
Message-ID: <237967ef0610011550m68473684q1184eb22b5190f33@mail.gmail.com>
Date: Mon, 2 Oct 2006 00:50:12 +0200
From: "Mikael Magnusson" <mikachu@gmail.com>
To: zsh-workers <zsh-workers@sunsite.dk>
Subject: Remove (probably?) unhelpful check in narrow-to-region
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

With this change, you can press set-mark, narrow-to-region with the
cursor in the same place, without it you always have to include one
character in the narrowed region. This is useful for example if you
want to insert some command from history, just press the combo and
history search or whatever like usual, then press enter. I tried it
out for a bit and i haven't been able to find any negative effects.

PS I tried to include some ansi color codes in the -p and -P arguments
but they just get printed literally, would it be possible to print
them evaluated instead? I stared at the code for 5 minutes but
couldn't figure out where the extra quoting is added.

Index: Functions/Zle/narrow-to-region
===================================================================
RCS file: /cvsroot/zsh/zsh/Functions/Zle/narrow-to-region,v
retrieving revision 1.2
diff -p -u -d -r1.2 narrow-to-region
--- Functions/Zle/narrow-to-region	5 Jul 2002 10:49:47 -0000	1.2
+++ Functions/Zle/narrow-to-region	1 Oct 2006 22:46:23 -0000
@@ -68,9 +68,7 @@ if [[ -n $_ntr_save || -z $_ntr_restore
     _ntr_end=$CURSOR
   fi

-  if (( _ntr_start == _ntr_end )); then
-    return 1
-  elif (( _ntr_start > _ntr_end )); then
+  if (( _ntr_start > _ntr_end )); then
     _ntr_swap=_ntr_start
     _ntr_start=_ntr_end
     _ntr_end=_ntr_swap


-- 
Mikael Magnusson

