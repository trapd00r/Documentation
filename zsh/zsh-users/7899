From zsh-users-return-7899-mason-zsh=primenet.com.au@sunsite.dk Sat Aug 21 06:01:00 2004
Return-Path: <zsh-users-return-7899-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24164 invoked from network); 21 Aug 2004 06:00:59 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 21 Aug 2004 06:00:59 -0000
Received: (qmail 48071 invoked from network); 21 Aug 2004 06:00:53 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 21 Aug 2004 06:00:53 -0000
Received: (qmail 26840 invoked by alias); 21 Aug 2004 06:00:10 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 7899
Received: (qmail 26823 invoked from network); 21 Aug 2004 06:00:10 -0000
Received: from unknown (HELO a.mx.sunsite.dk) (130.225.247.88)
  by 130.225.247.90 with SMTP; 21 Aug 2004 06:00:10 -0000
Received: (qmail 46163 invoked from network); 21 Aug 2004 05:58:11 -0000
Received: from unknown (HELO moonbase.zanshin.com) (167.160.213.139)
  by a.mx.sunsite.dk with SMTP; 21 Aug 2004 05:58:09 -0000
Received: from toltec.zanshin.com (toltec.zanshin.com [64.84.47.166])
	by moonbase.zanshin.com (8.12.11/8.12.11) with ESMTP id i7L5w7Wb002532
	for <zsh-users@sunsite.dk>; Fri, 20 Aug 2004 22:58:07 -0700
Date: Fri, 20 Aug 2004 22:58:07 -0700 (PDT)
From: Bart Schaefer <schaefer@brasslantern.com>
Reply-To: zsh-users@sunsite.dk
To: zsh-users@sunsite.dk
Subject: Re: Tip of the day: previous command output
In-Reply-To: <Pine.LNX.4.61.0408200905300.27591@toltec.zanshin.com>
Message-ID: <Pine.LNX.4.61.0408202230290.2395@toltec.zanshin.com>
References: <20040819085812.GL22962@localhost> <Pine.LNX.4.61.0408190748530.9464@toltec.zanshin.com>
 <20040819164250.GA21575@spiegl.de> <Pine.LNX.4.61.0408190956440.9464@toltec.zanshin.com>
 <20040820121202.GA31466@spiegl.de> <20040820145032.GH13530@ay.vinc17.org>
 <Pine.LNX.4.61.0408200905300.27591@toltec.zanshin.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Spam-Checker-Version: SpamAssassin 2.63 on a.mx.sunsite.dk
X-Spam-Level: 
X-Spam-Status: No, hits=-1.5 required=6.0 tests=BAYES_01 autolearn=no 
	version=2.63
X-Spam-Hits: -1.5

On Fri, 20 Aug 2004, Bart Schaefer wrote:

> I won't try to test this, but something like this should do it:

OK, I lied.  I tested it.  It didn't do what I expected, though it did 
what I told it to do.

Here's a version that actually does what was asked:

  _expand_word_and_keep() {
    function compadd() {
      local -A args
      zparseopts -E -A args J:
      if [[ $args[-J] == all-expansions ]]
      then
        builtin compadd -A kept "$@"
        kept=(${(Q)${(z)kept}})
      fi
      builtin compadd "$@"
    }
    local result
    _main_complete _expand
    result=$?
    unfunction compadd
    return result
  }

With 4.2.1, you can replace the five "local ... return" lines with

    { _main_complete _expand } always { unfunction compadd }

Left as an excercise:  Get the name of the "keep" variable from a zstyle,
so you can stash expansions in different places depending on context.

