From zsh-workers-return-13688-mason-zsh=primenet.com.au@sunsite.dk Wed Mar 21 14:41:47 2001
Return-Path: <zsh-workers-return-13688-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 17012 invoked from network); 21 Mar 2001 14:41:46 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 21 Mar 2001 14:41:46 -0000
Received: (qmail 12987 invoked by alias); 21 Mar 2001 14:41:38 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 13688
Received: (qmail 12971 invoked from network); 21 Mar 2001 14:41:37 -0000
Date: Wed, 21 Mar 2001 15:41:37 +0100 (MET)
Message-Id: <200103211441.PAA29343@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.dk
In-reply-to: "Bart Schaefer"'s message of Tue, 20 Mar 2001 18:42:28 +0000
Subject: Re: `make' completion in zsh-3.1.9


Bart Schaefer wrote:

> On Mar 20, 11:33am, Sven Wischnowsky wrote:
> } Subject: Re: `make' completion in zsh-3.1.9
> }
> } Bart Schaefer wrote:
> } 
> } > zsh% while read -e; do :; done < Makefile | less
> } > 
> } > hangs until interrupted.  This works:
> } > 
> } > zsh% { while read -e; do :; done < Makefile } | less
> } 
> } Hrm, works for me.  (Please not another non-reproducible-everywhere
> } job contorl bug, please please please...)
> 
> It appears that "less" never gets started on my RH5.2 machine.  The
> "while" loop runs until it has written 4k bytes, then it gets stuck.
> 
> If the file redirected to the while loop is less than 4k in size, it
> all works fine.

Argh.  Works on DU (large buffers, it seems), but not on Solaris.

The problem is that the loop is not put in a sub-shell.  Ahem.

And w.r.t. the code in execcmd() this is correct (of, course, code is
always correct, silly me).  But how can we solve this?  Didn't it once 
work?  Changing the test at exec.c:1968 to also test for is_cursh
makes it work only half the way -- less comes up, but if one leaves it 
(fast enough) the sub-shell gets blocked, trying to write into the
pipe and being too stupid to find out that it can't anymore.

I'm very much confused... anyone know what we are supposed to do now?


Bye
 Sven


--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

