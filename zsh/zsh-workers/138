From zsh-workers-request@math.gatech.edu  Mon Jul  3 23:10:55 1995
Received: from gatech.edu (gatech.edu [130.207.244.244]) by werple.mira.net.au (8.6.12/8.6.9) with SMTP id XAA16986 for <mason@werple.mira.net.au>; Mon, 3 Jul 1995 23:10:50 +1000
Received: from math (math.skiles.gatech.edu) by gatech.edu with SMTP id AA01297
  (5.65c/Gatech-10.0-IDA for <mason@werple.mira.net.au>); Mon, 3 Jul 1995 09:11:47 -0400
Received: by math (5.x/SMI-SVR4)
	id AA02974; Mon, 3 Jul 1995 09:08:03 -0400
Resent-Date: Mon, 3 Jul 1995 14:58:37 +0100 (MET DST)
Old-Return-Path: <hzoli@cs.elte.hu>
From: hzoli@cs.elte.hu (Zoltan Hidvegi)
Message-Id: <9507031307.AA10338@turan.elte.hu>
Subject: Re: [2.6-beta9-hzoli9] BUG (patch enclosed) in exec.c?
To: mdb@cdc.noaa.gov (Mark Borges)
Date: Mon, 3 Jul 1995 14:58:37 +0100 (MET DST)
In-Reply-To: <9507012025.AA21790@bjerknes> from "Mark Borges" at Jul 1, 95 02:25:57 pm
X-Mailer: ELM [version 2.4 PL21]
Content-Type: text
Sender: hzoli@cs.elte.hu
Resent-Message-Id: <"DARaG2.0.Kk.ok-zl"@math>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/138
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

> 
> Hi Zoltan--
> 
> I recently moved up to beta9-hzoli9, patched from zsh-2.6-beta9 using
> the files:
> 
> 	zsh-2.6-beta9-hzoli9.diff.gz
> 	patch1.gz
> 
> Anyway, I still had problems with zsh wiping out the history file, so
> I did a bit of snooping. In exec.c (at least in my patched hzoli9)
> there are two instances of savehistfile (one near line 1430, the other
> near line 1454). In contrast, there is only one in the baseline
> zsh-2.6-beta9 exec.c (although it's still too buggy for me to use!),
> near line 1442. Should hzoli9's exec.c have two, or did I mispatch it
> somehow? 

I think you patched everything right. And I think that there should be two
places to save the history. One is where you exec a builtin zsh command or a
shell function, and the other is when you exec an external command. The
baseline zsh does not save history when you do

% exec echo bye

But it does save it after

% exec /bin/echo bye

I merely made the two exec's compatible with each other. It seems that your
bug should be reproducible with the baseline as well. Also it seems that it
only happens when you do funy things in your .zshrc. Could you send the
shortest .zshrc which reproduces the bug (as I remeber you already sent
something earlier but I had no time to examine that)? Isn't it done by some
backquote substitution? But I really do not understand exec.c too much, so it
is possible that I did not chose the proper solution for this problem.

Zoltan

