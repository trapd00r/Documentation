From zsh-workers-request@euclid.skiles.gatech.edu  Sat Mar  2 05:58:33 1996
Received: from euclid.skiles.gatech.edu (euclid.skiles.gatech.edu [130.207.146.50]) by werple.net.au (8.7/8.7.1) with ESMTP id FAA09577 for <mason@werple.mira.net.au>; Sat, 2 Mar 1996 05:58:28 +1100 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id NAA07731; Fri, 1 Mar 1996 13:36:08 -0500 (EST)
Resent-Date: Fri, 1 Mar 1996 13:36:08 -0500 (EST)
Message-Id: <9603011834.AA10797@marathon.cs.ucla.edu>
To: zsh-workers@math.gatech.edu
Subject: New hist.c patch (Was: Re: UGLY CRASHES UNDER ZSH 2.6 BETA 12)
In-Reply-To: Your message of "Fri, 01 Mar 1996 14:36:42 +0100."
             <9603011336.AA12720@hydra.ifh.de> 
Date: Fri, 01 Mar 1996 10:34:54 -0800
From: Eskandar Ensafi <esky@CS.UCLA.EDU>
Resent-Message-ID: <"7Tvt72.0.ju1.OEqDn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/789
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu


Hello,

On Fri, 01 Mar 1996 14:36:42 +0100, Peter Stephenson wrote:
[original bug report omitted]
> I can't reproduce this either for some reason, but my guess is that
> the alias stack has got a NULL on it, which signifies history
> expansion, and the lexrestore() is assuming it's an alias and trying
> to dereference it.  Have a go at this (should be completely safe to
> give to the kids at home):


Thanks!  It worked.  Here's Peter's patch again:


==============================================================================
*** Src/hist.c~	Mon Feb 19 10:09:38 1996
--- Src/hist.c	Fri Mar  1 14:31:05 1996
***************
*** 440,447 ****
      Alias ix;
  
      while (alstackind) {
! 	ix = alstack[--alstackind];
! 	ix->inuse = 0;
      }
  }
  
--- 440,447 ----
      Alias ix;
  
      while (alstackind) {
! 	if ((ix = alstack[--alstackind]))
! 	  ix->inuse = 0;
      }
  }
==============================================================================

Later,

- Eskandar

------------------------------------------------------------------------------
Eskandar Ensafi                              Object-Oriented Software Engineer
University of California, Los Angeles                                         
Department of Biomathematics              esky@cs.ucla.edu (ASCII, MIME, NeXT)
School of Medicine                  http://www.cs.ucla.edu/csd-lanai/fweb/esky
------------------------------------------------------------------------------

