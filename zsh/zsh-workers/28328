From zsh-workers-return-28328-mason-zsh=primenet.com.au@zsh.org Thu Oct 07 20:25:03 2010
Return-Path: <zsh-workers-return-28328-mason-zsh=primenet.com.au@zsh.org>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 26344 invoked by alias); 7 Oct 2010 20:25:03 -0000
Mailing-List: contact zsh-workers-help@zsh.org; run by ezmlm
Precedence: bulk
X-No-Archive: yes
List-Id: Zsh Workers List <zsh-workers.zsh.org>
List-Post: <mailto:zsh-workers@zsh.org>
List-Help: <mailto:zsh-workers-help@zsh.org>
Delivered-To: mailing list zsh-workers@zsh.org
X-Seq: 28328
Received: (qmail 29195 invoked from network); 7 Oct 2010 20:25:00 -0000
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_NONE
	autolearn=ham version=3.3.1
Received-SPF: pass (ns1.primenet.com.au: SPF record at ntlworld.com designates 81.103.221.48 as permitted sender)
Date: Thu, 7 Oct 2010 21:24:46 +0100
From: Peter Stephenson <p.w.stephenson@ntlworld.com>
To: zsh-workers@zsh.org
Subject: Re: Any comment on users/15442 ?
Message-ID: <20101007212446.06a476b0@pws-pc>
In-Reply-To: <101005185057.ZM5374@torch.brasslantern.com>
References: <101005185057.ZM5374@torch.brasslantern.com>
X-Mailer: Claws Mail 3.7.6 (GTK+ 2.20.1; x86_64-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Cloudmark-Analysis: v=1.1 cv=4QByPj+6Iq2k/6L54d+eVKTdgQxdscpRskJJReCfdXo= c=1 sm=0 a=qsdrDVg5mKQA:10 a=4YI7mmuYAqcA:10 a=kj9zAlcOel0A:10 a=NLZqzBF-AAAA:8 a=ggKFyvHT31ktsrgXAXQA:9 a=LPI2vIBqn5sKAwvzFg4A:7 a=x7ksAFZU0v_gGyaXKCON8nCjEBsA:4 a=CjuIK1q_8ugA:10 a=_dQi-Dcv4p4A:10 a=HpAAvcLHHh0Zw7uRqdWCyQ==:117

/* Er, yeah. */

> } host# IFS=
> } host# set - "a b" "c   d" e$'\0'f 'gxh'
> } host# setopt sh_wordsplit
> } host# print -l $*
> } a bc   defgxh
> 
> This might in fact be a bug.  Fix (?) below; everyone but PWS can stop
> reading when their eyes begin to glaze over, as this is zsh-workers
> material.  I took the approach of basing this on emulation mode rather
> than on the SH_WORD_SPLIT option, to minimize zsh-mode disruption, but
> that can easily be adjusted.

I think the option would be better.  I'm not very keen on things that
can only be adjusted by changing the entire emulation.  Anything
beginning "SH_" means "do this like sh, you are now leaving the world of
zsh", in my book [it's still selling], so the usual guarantees that we
won't change the behaviour are superseded by sh compatibility.  That
also makes it easier to test.

> The following implements the ksh-equivalent behavior by initializing the
> state of the (@) flag based upon the value of $IFS when we are in sh/ksh
> emulation mode, and then by requiring later joining to pay attention.
> However, it also has the side-effect of changing the behavior of ${=...}
> in a related way.

I doubt that's a problem.  I think they should split in the same way.
We're now in sh-land using a zsh-specific feature with an unusual
setting for IFS.  It probably just needs to follow sh behaviour.

> There no longer is a chunk marked "YUK" that I can find so I'm not sure
> what either of these refers to.

I think this went when Wayne fixed up word splitting so it worked
properly on strings that occur inside braced parameter substitutions.
Look at the 4.2 branch if you want to see what it looked like before.
Hence many of the comments may be out of date.  It also may have made
isarr operate differently.

-- 
Peter Stephenson <p.w.stephenson@ntlworld.com>
Web page now at http://homepage.ntlworld.com/p.w.stephenson/

