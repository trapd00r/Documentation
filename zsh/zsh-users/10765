From zsh-users-return-10765-mason-zsh=primenet.com.au@sunsite.dk Wed Sep 27 09:56:09 2006
Return-Path: <zsh-users-return-10765-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5591 invoked from network); 27 Sep 2006 09:56:06 -0000
X-Spam-Checker-Version: SpamAssassin 3.1.5 (2006-08-29) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=BAYES_00,FORGED_RCVD_HELO 
	autolearn=ham version=3.1.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 27 Sep 2006 09:56:06 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 78461 invoked from network); 27 Sep 2006 09:55:57 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 27 Sep 2006 09:55:57 -0000
Received: (qmail 20352 invoked by alias); 27 Sep 2006 09:55:49 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 10765
Received: (qmail 20343 invoked from network); 27 Sep 2006 09:55:48 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 27 Sep 2006 09:55:48 -0000
Received: (qmail 77363 invoked from network); 27 Sep 2006 09:55:48 -0000
Received: from esacom89-ext.esoc.esa.int (HELO esacom89-int.esoc.esa.int) (131.176.86.4)
  by a.mx.sunsite.dk with SMTP; 27 Sep 2006 09:55:46 -0000
Received: from esacom53.esoc.esa.int (131-176-86-254.esoc.esa.int [131.176.86.254])
	by esacom89-int.esoc.esa.int (8.13.3/8.13.3/ESA-External-v4.0) with ESMTP id k8R9tcSk025121;
	Wed, 27 Sep 2006 09:55:39 GMT
Received: from dcle12.dev.esoc.esa.int (dcle12.dev.esoc.esa.int [131.176.58.71])
	by esacom53.esoc.esa.int (8.12.10/8.12.10/ESA-Internal-v3.2) with ESMTP id k8R9tXEK017381;
	Wed, 27 Sep 2006 09:55:33 GMT
Received: from dcle12 (localhost [127.0.0.1])
	by dcle12.dev.esoc.esa.int (8.13.6+Sun/8.13.6) with ESMTP id k8R9tX6W026119;
	Wed, 27 Sep 2006 09:55:33 GMT
cc: zsh-users@sunsite.dk
In-reply-to: <20060923210240.GA13304@phil.en.oaci.org>
From: Oliver Kiddle <okiddle@yahoo.co.uk>
References: <20060923210240.GA13304@phil.en.oaci.org>
To: Philip <weirdofreak@gmail.com>
Subject: Re: imagemagick completes for all files
Date: Wed, 27 Sep 2006 11:55:33 +0200
Message-ID: <26118.1159350933@dcle12>

On 23 Sep, Philip wrote:
> My imagemagick completion lists all files, not just images.

Looks like it has been broken for a long time.

> I'm not sure what the (-.) means, but removing that doesn't help either,

It limits the glob to filenames so you would need to have a directory
with a .jpeg extension or something before you'd notice a difference.

You correctly identified the lines causing the problems. The patch below
fixes it for me. Hopefully this applies cleanly against the latest CVS.
I've using whatever comes with Solaris 10 here.

Oliver

--- /usr/sfw/share/zsh/4.2.1/functions/Completion/Unix/_imagemagick	Sat Jan  8 11:43:08 2005
+++ /home/okiddle/.zfunc/_imagemagick	Wed Sep 27 11:49:09 2006
@@ -14,7 +14,7 @@
 formats=jpg:jpeg:tiff:miff:ras:bmp:cgm:dcx:ps:eps:fig:fits:fpx:gif:mpeg:pbm:pgm:ppm:pcd:pcl:pdf:pcx:png:rad:rgb:rgba:rle:sgi:html:shtml:tga:ttf:uil:xwd:xbm:xpm:yuv
 
 if (( $# )); then
-  _files "$@" "$expl[@]" -g '*.(#i)(${~format//:/|})(-.)'
+  _files -g "*.(#i)(${~formats//:/|})(-.)" "$@"
   return
 fi
 

