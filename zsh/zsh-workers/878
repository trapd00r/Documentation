From hzoli@cs.elte.hu Sun Mar 31 10:00:47 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3) with ESMTP id KAA09219 for <mason@werple.mira.net.au>; Sun, 31 Mar 1996 10:00:45 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id SAA16582; Sat, 30 Mar 1996 18:48:09 -0500 (EST)
Resent-Date: Sat, 30 Mar 1996 18:48:09 -0500 (EST)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199603302345.AAA01719@hzoli.ppp.cs.elte.hu>
Subject: termbuf should not be global
To: zsh-workers@math.gatech.edu (Zsh hacking and development)
Date: Sun, 31 Mar 1996 00:45:15 +0100 (MET)
X-Mailer: ELM [version 2.4ME+ PL11 (25)]
MIME-Version: 1.0
Content-Type: application/pgp; format=text; x-action=sign
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"Fbif1.0.w24.uWSNn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/878
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 1663
Status: O

-----BEGIN PGP SIGNED MESSAGE-----

The patch below make termbuf local.  That's OK since the value of termbuf
is not used anywhere (not even in init_term).  tgetent is only called to
determine whether TERM is valid or not.  And the termbuf must not be used
anyway since it is not guaranteed that tgetent fills it with any useful
information (e.g. ncurses ignores it completely).

So I made it local and increased its size to 2048 (since local variables do
not increase memory usage until they are not exremly big).  This my prevent
some problems when the termcap entry is longer that 1024 bytes (it should
not be longer but I remember Dave Sainty complaining about this in
art. 458).

This patch does not fix any bugs and it is already included in
beta13-hzoli13.

Bye,

Zoltan

 rcsdiff -qc -kk -r1.10 -r1.11 Src/globals.h
 *** Src/globals.h
 --- Src/globals.h	1996/01/28 16:05:33	1.11
 ***************
 *** 480,489 ****
   
   EXTERN int qbang;
    
 - /* the termcap buffer */
 -  
 - EXTERN char termbuf[1024];
 - 
   /* text attribute mask */
    
   #ifdef GLOBALS
 --- 480,485 ----
 rcsdiff -qc -kk -r1.10 -r1.11 Src/init.c
 *** Src/init.c
 --- Src/init.c	1996/01/28 16:05:33	1.11
 ***************
 *** 459,464 ****
 --- 459,466 ----
   int
   init_term(void)
   {
 +     char termbuf[2048];
 + 
       if (!*term)
   	return termok = TERM_BAD;
   

-----BEGIN PGP SIGNATURE-----
Version: 2.6.3i
Charset: noconv

iQCVAwUBMV3HggupSCiLN749AQG6tQP/cWhIUpknCHHOjhJyRdFgJQ5LLAQiHwJe
puCdqs4e0pIuERHjMRkIRY/7bWXTEV0PIfDV3srmil5g6CqiBbQNZTlEFspt9Kq/
cMT+UlAj9/jlgKJ9+s0CRgq007YBtYqji2IALjoTKxOuui01Q1VmQTmnZWmk4ytB
v7auLKjuoqI=
=rDpA
-----END PGP SIGNATURE-----
