From hzoli@cs.elte.hu Sat Jun 29 04:00:19 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by melb.werple.net.au (8.7.5/8.7.3/2) with ESMTP id EAA21381 for <mason@werple.mira.net.au>; Sat, 29 Jun 1996 04:00:16 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id NAA12738; Fri, 28 Jun 1996 13:51:03 -0400 (EDT)
Resent-Date: Fri, 28 Jun 1996 13:51:03 -0400 (EDT)
From: Zoltan Hidvegi <hzoli@cs.elte.hu>
Message-Id: <199606281750.TAA02803@bolyai.cs.elte.hu>
Subject: Re: bug (?) in 3.0-pre1
To: gene@bear.com
Date: Fri, 28 Jun 1996 19:50:44 +0200 (MET DST)
Cc: zsh-workers@math.gatech.edu
In-Reply-To: <9606281712.AA07249@bear.com> from "gene@bear.com" at "Jun 28, 96 01:12:35 pm"
Organization: Dept. of Comp. Sci., Eotvos University, Budapest, Hungary
Phone: (36 1)2669833 ext: 2667, home phone: (36 1) 2752368
X-Mailer: ELM [version 2.4ME+ PL16 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"8-E1f1.0.y63.6k1rn"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1466
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu
Content-Length: 642
Status: OR

> 
> HPUX 9.01 s700.
> 
> Start a new shell and do 'cd -' generates BUG.
> 
>  % exec $SHELL
>  % cd -
>  ~/app/gnuplot/gnuplot
>  BUG: permanent allocation in doshfunc
>  %

I added an additional test to doshfunc() which revealed a memory leak
again.  Below is the patch to fix that.

Zoltan

*** Src/builtin.c	1996/06/28 02:05:24	2.49
--- Src/builtin.c	1996/06/28 17:46:27
***************
*** 1269,1275 ****
--- 1269,1277 ----
      if ((l = getshfunc("chpwd"))) {
  	fflush(stdout);
  	fflush(stderr);
+ 	heapalloc();
  	doshfunc(dupstruct(l), NULL, 0, 1);
+ 	permalloc();
      }
  
      /* handle directory stack sizes out of range */


