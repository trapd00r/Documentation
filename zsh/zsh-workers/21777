From zsh-workers-return-21777-mason-zsh=primenet.com.au@sunsite.dk Wed Sep 28 14:46:02 2005
Return-Path: <zsh-workers-return-21777-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 24466 invoked from network); 28 Sep 2005 14:46:00 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 28 Sep 2005 14:46:00 -0000
Received: (qmail 48763 invoked from network); 28 Sep 2005 14:45:54 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 28 Sep 2005 14:45:54 -0000
Received: (qmail 6930 invoked by alias); 28 Sep 2005 14:45:51 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 21777
Received: (qmail 6916 invoked from network); 28 Sep 2005 14:45:50 -0000
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by sunsite.dk with SMTP; 28 Sep 2005 14:45:50 -0000
Received: (qmail 48396 invoked from network); 28 Sep 2005 14:45:50 -0000
Received: from vms042pub.verizon.net (206.46.252.42)
  by a.mx.sunsite.dk with SMTP; 28 Sep 2005 14:45:48 -0000
Received: from candle.brasslantern.com ([71.116.81.225])
 by vms042.mailsrvcs.net
 (Sun Java System Messaging Server 6.2 HotFix 0.04 (built Dec 24 2004))
 with ESMTPA id <0INJ0046W7OAXE74@vms042.mailsrvcs.net> for
 zsh-workers@sunsite.dk; Wed, 28 Sep 2005 09:45:47 -0500 (CDT)
Received: from candle.brasslantern.com (IDENT:schaefer@localhost [127.0.0.1])
	by candle.brasslantern.com (8.12.11/8.12.11) with ESMTP id j8SEjjsj024301	for
 <zsh-workers@sunsite.dk>; Wed, 28 Sep 2005 07:45:45 -0700
Received: (from schaefer@localhost)	by candle.brasslantern.com
 (8.12.11/8.12.11/Submit) id j8SEjjUB024300	for zsh-workers@sunsite.dk; Wed,
 28 Sep 2005 07:45:45 -0700
Date: Wed, 28 Sep 2005 14:45:44 +0000
From: Bart Schaefer <schaefer@brasslantern.com>
Subject: Re: Regression in UTF-8 support
In-reply-to: <5522.1127902970@csr.com>
To: zsh-workers@sunsite.dk (Zsh hackers list)
Message-id: <1050928144544.ZM24299@candle.brasslantern.com>
MIME-version: 1.0
X-Mailer: Z-Mail (5.0.0 30July97)
Content-type: text/plain; charset=us-ascii
References: <200509252005.41824.arvidjaar@newmail.ru>
	<20050927152247.6a1f6452.pws@csr.com>
	<237967ef05092710007dfd7b1b@mail.gmail.com>
	<200509280704.50012.arvidjaar@newmail.ru>	<5327.1127902539@csr.com>
 <5522.1127902970@csr.com>
Comments: In reply to Peter Stephenson <pws@csr.com>
 "Re: Regression in UTF-8 support" (Sep 28, 11:22am)
X-Spam-Checker-Version: SpamAssassin 3.0.4 (2005-06-05) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00 autolearn=ham 
	version=3.0.4

On Sep 28, 11:22am, Peter Stephenson wrote:
}
} On the gripping hand, it's not clear we even need to quote a null in
} a history file, since it's not a set of null-terminated strings.

History files have traditionally had problems with NFS-mounted home
directories when zsh instances on multiple machines are sharing the
files.  A common NFS problem, at least in years past, has been to
dump a bunch of NULs into files when e.g. two processes disagree on
the ftruncate() length.  Presently (IIRC) the zsh history mechanism
discards these unmetafied NULs, which masks a lot of potential idiocy.

Also, zsh history files have long been designed such that they are
compatible with other shells as long as you don't turn on assorted
extended features.  Metafication probably breaks a little of this
already, but unmetafied NULs would abolish it entirely.

However, my biggest objection would be that changing the history file
format would mean that previous versions of zsh would not be able to
share the files with newer versions.

