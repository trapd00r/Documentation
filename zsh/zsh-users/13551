From zsh-users-return-13551-mason-zsh=primenet.com.au@sunsite.dk Tue Dec 09 12:39:43 2008
Return-Path: <zsh-users-return-13551-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 29001 invoked from network); 9 Dec 2008 12:39:40 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.3 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.5
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 9 Dec 2008 12:39:40 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 41785 invoked from network); 9 Dec 2008 12:39:30 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 9 Dec 2008 12:39:30 -0000
Received: (qmail 1743 invoked by alias); 9 Dec 2008 12:39:13 -0000
Mailing-List: contact zsh-users-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-users@sunsite.dk
X-Seq: 13551
Received: (qmail 1728 invoked from network); 9 Dec 2008 12:39:12 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 9 Dec 2008 12:39:12 -0000
Received: from cluster-d.mailcontrol.com (cluster-d.mailcontrol.com [85.115.60.190])
	by bifrost.dotsrc.org (Postfix) with ESMTPS id 44C8280308BE
	for <zsh-users@sunsite.dk>; Tue,  9 Dec 2008 13:39:09 +0100 (CET)
Received: from rly02d.srv.mailcontrol.com (localhost.localdomain [127.0.0.1])
	by rly02d.srv.mailcontrol.com (MailControl) with ESMTP id mB9CcuJP022855
	for <zsh-users@sunsite.dk>; Tue, 9 Dec 2008 12:39:08 GMT
Received: from submission.mailcontrol.com (submission.mailcontrol.com [86.111.216.190])
	by rly02d.srv.mailcontrol.com (MailControl) id mB9CbGOa016363
	for zsh-users@sunsite.dk; Tue, 9 Dec 2008 12:37:16 GMT
Received: from cameurexb01.EUROPE.ROOT.PRI ([193.128.72.68])
	by rly02d-eth0.srv.mailcontrol.com (envelope-sender Peter.Stephenson@csr.com) (MIMEDefang) with ESMTP id mB9CbGUG016306; Tue, 09 Dec 2008 12:37:16 +0000 (GMT)
Received: from news01.csr.com ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Tue, 9 Dec 2008 12:37:16 +0000
Received: from news01.csr.com (localhost.localdomain [127.0.0.1])
	by news01.csr.com (8.14.2/8.13.4) with ESMTP id mB9CbGka024855;
	Tue, 9 Dec 2008 12:37:16 GMT
Received: from csr.com (pws@localhost)
	by news01.csr.com (8.14.2/8.14.2/Submit) with ESMTP id mB9CbGsi024851;
	Tue, 9 Dec 2008 12:37:16 GMT
Message-Id: <200812091237.mB9CbGsi024851@news01.csr.com>
X-Authentication-Warning: news01.csr.com: pws owned process doing -bs
To: Rocky Bernstein <rocky.bernstein@gmail.com>,
        Zsh users list <zsh-users@sunsite.dk>
Subject: Re: Is this correct? Redirecting stdin/stout to implement a gdb-like "set inferior tty" in zshdb
In-reply-to: <20081209121404.GB5462@sc.homeunix.net>
References: <6cd6de210812090327o11abb9f3w2cc932515e4dbef8@mail.gmail.com> <20081209121213.GA5462@sc.homeunix.net> <20081209121404.GB5462@sc.homeunix.net>
Comments: In-reply-to Stephane Chazelas <Stephane_Chazelas@yahoo.fr>
   message dated "Tue, 09 Dec 2008 12:14:04 +0000."
Date: Tue, 09 Dec 2008 12:37:16 +0000
From: Peter Stephenson <pws@csr.com>
X-OriginalArrivalTime: 09 Dec 2008 12:37:16.0364 (UTC) FILETIME=[DE55F0C0:01C959FA]
X-Scanned-By: MailControl A_08_51_00 (www.mailcontrol.com) on 10.68.1.112
X-Virus-Scanned: ClamAV 0.92.1/8735/Tue Dec  9 09:53:21 2008 on bifrost
X-Virus-Status: Clean

Stephane Chazelas wrote:
> On Tue, Dec 09, 2008 at 12:12:13PM +0000, Stephane Chazelas wrote:
> > On Tue, Dec 09, 2008 at 06:27:48AM -0500, Rocky Bernstein wrote:
> > [...]
> > > exec 7<&0 </dev/null 6>&1  # Line taken from an autoconf "configure" scri
> pt.
> > > #...
> > > exec {_Dbg_fdi} <> $1
> > > while : ; do
> > >   vared -e -h -p "foo> " line <&${_Dbg_fdi} || break
> > 
> > The thing is read doesn't read from fd 0 (not does it write its
> [...]          ^^^^
> 
> Sorry, I meant "vared" above.

Ah, yes, I missed that, which is the key point.  If vared doesn't yet
have a terminal (because it's a non-interactive shell, as here), it will
open /dev/tty, which isn't what you want (but worked in my test).

It would be relatively straightforward to supply vared with an option to
use as the terminal if there was none.  However it would be messier to
have it use the given terminal to replace any existing terminal in an
interactive shell (it *might* work saving and restoring the FDs but it's
a little fraught since zle not's designed to manage multiple terminals
at once), so that option would probably be limited to use in
non-interactive shells.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

