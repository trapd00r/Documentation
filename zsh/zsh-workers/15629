From zsh-workers-return-15629-mason-zsh=primenet.com.au@sunsite.dk Tue Aug 14 16:22:47 2001
Return-Path: <zsh-workers-return-15629-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 5343 invoked from network); 14 Aug 2001 16:22:46 -0000
Received: from sunsite.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 14 Aug 2001 16:22:46 -0000
Received: (qmail 28322 invoked by alias); 14 Aug 2001 16:22:40 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 15629
Received: (qmail 28300 invoked from network); 14 Aug 2001 16:22:39 -0000
Date: Tue, 14 Aug 2001 12:22:31 -0400
From: Clint Adams <clint@zsh.org>
To: zsh-workers@sunsite.dk
Subject: PATCH: unzip -Z
Message-ID: <20010814122231.A7258@dman.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i

unzip -Z should behave just as zipinfo does.
Will commit to both branches.

Index: Completion/Unix/Command/_zip
===================================================================
RCS file: /cvsroot/zsh/zsh/Completion/Unix/Command/_zip,v
retrieving revision 1.1
diff -u -r1.1 _zip
--- Completion/Unix/Command/_zip	2001/04/02 12:07:44	1.1
+++ Completion/Unix/Command/_zip	2001/08/14 16:20:24
@@ -1,6 +1,6 @@
 #compdef zip unzip zipinfo
 
-local suffixes suf zipfile izip
+local suffixes suf zipfile izip uzi
 local expl curcontext="$curcontext" state line
 typeset -A opt_args
 
@@ -73,11 +73,17 @@
       '(-p -z)-L[lowercase (some) filenames]' \
       '-M[page output]' \
       '-x[exclude the following names]' \
+      '-Z[zipinfo mode]:zipinfomode:->zipinfo' \
       "(-p -f -u -l -t -z -n -o -j -C -X -q -qq -a -aa -v -L -M)1:zip file:_files -g '(#i)*.(zip|[jw]ar)'" \
       '*:file:->files' && return 0
   ;;
-  zipinfo)
+esac
+
+[[ $state == zipinfo ]] && uzi="-Z[zipinfo mode]"
+
+if [[ $service == zipinfo ]] || [[ -n $uzi ]]; then
     _arguments -C -s \
+      $uzi \
       '(-2 -s -m -l -v -h -t -T -z)-1[filenames only]' \
       '(-1 -s -m -l -v -T)-2[just filenames but allow -h/-t/-z]' \
       '(-1 -2 -m -l -v -h -t)-s[short format]' \
@@ -93,8 +99,7 @@
       '-x[exclude the following names]' \
       "(-1 -2 -s -m -l -v -h -z -C -t -T -M)1:zip file:_files -g '(#i)*.(zip|[jw]ar)'" \
       '*:file:->files' && return 0
-  ;;
-esac
+fi
 
 case $state in
   suffixes)

