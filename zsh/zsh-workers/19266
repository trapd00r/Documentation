From zsh-workers-return-19266-mason-zsh=primenet.com.au@sunsite.dk Tue Nov 25 03:51:10 2003
Return-Path: <zsh-workers-return-19266-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 2158 invoked from network); 25 Nov 2003 03:51:09 -0000
Received: from sunsite.dk (130.225.247.90)
  by ns1.primenet.com.au with SMTP; 25 Nov 2003 03:51:09 -0000
Received: (qmail 13615 invoked by alias); 25 Nov 2003 03:51:03 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 19266
Received: (qmail 13511 invoked from network); 25 Nov 2003 03:51:03 -0000
Received: from localhost (HELO sunsite.dk) (127.0.0.1)
  by localhost with SMTP; 25 Nov 2003 03:51:03 -0000
X-MessageWall-Score: 0 (sunsite.dk)
Received: from [216.27.190.146] by sunsite.dk (MessageWall 1.0.8) with SMTP; 25 Nov 2003 3:51:2 -0000
Received: from ceramic.fifi.org (mail@ceramic.fifi.org [216.27.190.147])
	by tantale.fifi.org (8.9.3p2/8.9.3/Debian 8.9.3-21) with ESMTP id TAA22679
	for <zsh-workers@sunsite.dk>; Mon, 24 Nov 2003 19:51:01 -0800
Received: from phil by ceramic.fifi.org with local (Exim 4.22)
	id 1AOUE8-0007vF-Du
	for zsh-workers@sunsite.dk; Mon, 24 Nov 2003 19:51:00 -0800
To: zsh-workers@sunsite.dk
Subject: [PATCH] allows configure to run in the background
Mail-Copies-To: nobody
From: Philippe Troin <phil@fifi.org>
Date: 24 Nov 2003 19:51:00 -0800
Message-ID: <87fzgdcdi3.fsf@ceramic.fifi.org>
Lines: 8
User-Agent: Gnus/5.09 (Gnus v5.9.0) Emacs/21.2
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="=-=-="
Sender: Philippe Troin <phil@fifi.org>


--=-=-=

The checking "if tcsetpgrp() actually works" configure test stops the
configure script if it is ran in the background. The enclose patch
prevents this from happening by ignoring SIGTTOU for the duration of
this test.

Phil.

--=-=-=
Content-Type: text/x-patch
Content-Disposition: attachment; filename=zsh-bgconfigure.patch

Index: zshconfig.ac
===================================================================
RCS file: /cvsroot/zsh/zsh/zshconfig.ac,v
retrieving revision 1.42
diff -b -u -r1.42 zshconfig.ac
--- zshconfig.ac	13 Nov 2003 14:34:34 -0000	1.42
+++ zshconfig.ac	25 Nov 2003 03:38:29 -0000
@@ -1577,6 +1577,7 @@
 dnl for instance, BeOS R4.51 does not support it yet
 dnl -----------
 if test -t 0 && test $ac_cv_func_tcsetpgrp = yes; then
+    trap "" SIGTTOU > /dev/null 2>&1 || :
     AC_CACHE_CHECK(if tcsetpgrp() actually works,
     zsh_cv_sys_tcsetpgrp,
     [AC_TRY_RUN([
@@ -1594,6 +1595,7 @@
     if test $zsh_cv_sys_tcsetpgrp = no; then
       AC_DEFINE(BROKEN_TCSETPGRP)
     fi
+    trap - SIGTTOU > /dev/null 2>&1 || :
 fi
 
 dnl -----------

--=-=-=--

