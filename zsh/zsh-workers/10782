From zsh-workers-return-10782-mason-zsh=primenet.com.au@sunsite.auc.dk Mon Apr 17 08:49:07 2000
Return-Path: <zsh-workers-return-10782-mason-zsh=primenet.com.au@sunsite.auc.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 4727 invoked from network); 17 Apr 2000 08:49:06 -0000
Received: from sunsite.auc.dk (130.225.51.30)
  by ns1.primenet.com.au with SMTP; 17 Apr 2000 08:49:06 -0000
Received: (qmail 2984 invoked by alias); 17 Apr 2000 08:48:56 -0000
Mailing-List: contact zsh-workers-help@sunsite.auc.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.auc.dk
X-Seq: 10782
Received: (qmail 2962 invoked from network); 17 Apr 2000 08:48:54 -0000
Date: Mon, 17 Apr 2000 10:48:48 +0200 (MET DST)
Message-Id: <200004170848.KAA09370@beta.informatik.hu-berlin.de>
From: Sven Wischnowsky <wischnow@informatik.hu-berlin.de>
To: zsh-workers@sunsite.auc.dk
In-reply-to: Tanaka Akira's message of 16 Apr 2000 00:59:00 +0900
Subject: PATCH: Re: _arguments -+o


Tanaka Akira wrote:

> serein% bindkey -e; autoload -U compinit; compinit -D
> serein% _tst () { _arguments -+o }
> serein% tst +o <TAB>
> ->
> serein% tst +o +o
> 
> +o is completed more than once.

Oops. The xor list wasn't set up correctly.

Bye
 Sven

Index: Src/Zle/computil.c
===================================================================
RCS file: /cvsroot/zsh/zsh/Src/Zle/computil.c,v
retrieving revision 1.6
diff -u -r1.6 computil.c
--- Src/Zle/computil.c	2000/04/17 08:04:42	1.6
+++ Src/Zle/computil.c	2000/04/17 08:48:17
@@ -623,7 +623,7 @@
 		 * stuff twice for such things. */
 		name = ++p;
 		*p = (again ? '-' : '+');
-		again = 1 - again;
+		again++;
 	    } else {
 		name = p;
 		/* If it's a long option skip over the first `-'. */
@@ -767,7 +767,7 @@
 		    opt->descr = NULL;
 	    } else
 		opt->descr = NULL;
-	    opt->xor = xor;
+	    opt->xor = (again == 1 ? zarrdup(xor) : xor);
 	    opt->type = otype;
 	    opt->args = oargs;
 	    opt->num = nopts++;
@@ -783,7 +783,7 @@
 	    if (single && name[1] && !name[2])
 		ret->single[STOUC(name[1])] = opt;
 
-	    if (again) {
+	    if (again == 1) {
 		/* Do it all again for `*-...'. */
 		p = dupstring(*args);
 		goto rec;

--
Sven Wischnowsky                         wischnow@informatik.hu-berlin.de

