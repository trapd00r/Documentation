From zsh-workers-return-24666-mason-zsh=primenet.com.au@sunsite.dk Mon Mar 03 12:38:51 2008
Return-Path: <zsh-workers-return-24666-mason-zsh=primenet.com.au@sunsite.dk>
Delivered-To: mason-zsh@primenet.com.au
Received: (qmail 18161 invoked from network); 3 Mar 2008 12:38:40 -0000
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on f.primenet.com.au
X-Spam-Level: 
X-Spam-Status: No, score=-2.4 required=5.0 tests=AWL,BAYES_00 autolearn=ham
	version=3.2.4
Received: from news.dotsrc.org (HELO a.mx.sunsite.dk) (130.225.247.88)
  by ns1.primenet.com.au with SMTP; 3 Mar 2008 12:38:40 -0000
Received-SPF: none (ns1.primenet.com.au: domain at sunsite.dk does not designate permitted sender hosts)
Received: (qmail 14778 invoked from network); 3 Mar 2008 12:38:35 -0000
Received: from sunsite.dk (130.225.247.90)
  by a.mx.sunsite.dk with SMTP; 3 Mar 2008 12:38:35 -0000
Received: (qmail 16216 invoked by alias); 3 Mar 2008 12:38:32 -0000
Mailing-List: contact zsh-workers-help@sunsite.dk; run by ezmlm
Precedence: bulk
X-No-Archive: yes
Delivered-To: mailing list zsh-workers@sunsite.dk
X-Seq: 24666
Received: (qmail 16202 invoked from network); 3 Mar 2008 12:38:32 -0000
Received: from bifrost.dotsrc.org (130.225.254.106)
  by sunsite.dk with SMTP; 3 Mar 2008 12:38:32 -0000
Received: from cluster-g.mailcontrol.com (cluster-g.mailcontrol.com [85.115.41.190])
	by bifrost.dotsrc.org (Postfix) with ESMTP id E867C8028C52
	for <zsh-workers@sunsite.dk>; Mon,  3 Mar 2008 13:38:27 +0100 (CET)
Received: from rly10g.srv.mailcontrol.com (localhost.localdomain [127.0.0.1])
	by rly10g.srv.mailcontrol.com (MailControl) with ESMTP id m23Cbsh6023718
	for <zsh-workers@sunsite.dk>; Mon, 3 Mar 2008 12:37:54 GMT
Received: from submission.mailcontrol.com (submission.mailcontrol.com [86.111.216.190])
	by rly10g.srv.mailcontrol.com (MailControl) id m23CauqP018694
	for zsh-workers@sunsite.dk; Mon, 3 Mar 2008 12:36:56 GMT
Received: from cameurexb01.EUROPE.ROOT.PRI ([62.189.241.200])
	by rly10g-eth0.srv.mailcontrol.com (envelope-sender Peter.Stephenson@csr.com) (MIMEDefang) with ESMTP id m23CUP59025768; Mon, 03 Mar 2008 12:36:56 +0000 (GMT)
Received: from news01 ([10.103.143.38]) by cameurexb01.EUROPE.ROOT.PRI with Microsoft SMTPSVC(6.0.3790.3959);
	 Mon, 3 Mar 2008 12:36:22 +0000
Date: Mon, 3 Mar 2008 12:36:22 +0000
From: Peter Stephenson <pws@csr.com>
To: River Tarnell <river@wikimedia.org>,
        "Zsh Hackers' List"
 <zsh-workers@sunsite.dk>
Subject: Re: [PATCH] 4.3.5 build fails on SunOS 4.1.4
Message-ID: <20080303123622.169e55c8@news01>
In-Reply-To: <1282467763.20080303045815@wikimedia.org>
References: <1282467763.20080303045815@wikimedia.org>
Organization: CSR
X-Mailer: Claws Mail 3.3.1 (GTK+ 2.12.5; i386-redhat-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 03 Mar 2008 12:36:22.0594 (UTC) FILETIME=[30358A20:01C87D2B]
X-Scanned-By: MailControl A-08-00-04 (www.mailcontrol.com) on 10.71.1.120
X-Virus-Scanned: ClamAV 0.91.2/6092/Mon Mar  3 06:04:26 2008 on bifrost
X-Virus-Status: Clean

On Mon, 3 Mar 2008 04:58:15 +0000
River Tarnell <river@wikimedia.org> wrote:
> this platform doesn't provide strtoul(), and zsh has no compat.c
> replacement.  the patch (attached) provides one from NetBSD sources
> (which i believe has a liberal enough license to be included in zsh).

Right, and you've even included the licence, so I've committed it as it is.
Thanks.

> there are two remaining problems, but i have no idea where to start
> on either of them:
> 
>  + unless compiled with --disable-dynamic, any attempt to use
>    completion-related features crashes the shell with 'Undefined
>    symbol: _incompfunc'

I think the answer here is probably --disable-dynamic.  It's going back a
while, but I have a suspicion dynamic linking has always been problematic
on SunOS 4.  It might be fixable if anyone thought it worth while and had
the time and facilities.

For the specific problem, on some older systems an underscore needed to be
added by hand to entry points when fetching them with dlsym().  It looks
like this is some variant of that problem (although dlsym() isn't directly
involved).  Again, it's going back a bit and I'm not sure how this was
supposed to pan out.

>  + job control doesn't work properly.  while typing ^Z in 'vi'
>    works fine, in 'vim', the program immediately resumes, rather
>    than returning to the shell.  both work fine with the system
>    'csh'.

Job control definitely worked once on 4.1.x because I used to use it all
the time about 15(!) years ago, although I think that was in the age before
vim.  It's likely to need some poking around with a suitable system, unless
it awakes some memory of Bart's.

It might be worth trying "ttyctl -f" before calling vim the first time in
case it's monkeying with terminal settings.  I don't hold out much hope,
but it's at least a very quick test.

-- 
Peter Stephenson <pws@csr.com>                  Software Engineer
CSR PLC, Churchill House, Cambridge Business Park, Cowley Road
Cambridge, CB4 0WZ, UK                          Tel: +44 (0)1223 692070

