From zsh-workers-request@euclid.skiles.gatech.edu  Sat Aug  3 01:03:31 1996
Received: from euclid.skiles.gatech.edu (list@euclid.skiles.gatech.edu [130.207.146.50]) by coral.primenet.com.au (8.7.5/8.7.3) with ESMTP id BAA00500 for <mason@primenet.com.au>; Sat, 3 Aug 1996 01:03:30 +1000 (EST)
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id KAA22712; Fri, 2 Aug 1996 10:59:53 -0400 (EDT)
Resent-Date: Fri, 2 Aug 1996 10:59:53 -0400 (EDT)
From: Louis.Granboulan@ens.fr (Louis Granboulan)
Message-Id: <199608021458.QAA16392@agaric.ens.fr>
Subject: zsh-mem & prompt
To: zsh-workers@math.gatech.edu
Date: Fri, 2 Aug 1996 16:58:44 +0200 (MET DST)
X-Mailer: ELM [version 2.4 PL24 ME8a]
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"bNGyt2.0.oY5.eVX0o"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/1891
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

This is zsh-3.0-pre5 on a SPARCstation-5 with SunOS 4.1.4
When it is configured with --enable-zsh-mem, I have the following
message : attempt to free more than allocated
The problem is that the prompt buffer `lpptbuf' does not terminate with '\0'.

Here is a patch that solves this:
*** zle_misc.c.orig     Wed Jul 31 17:43:13 1996
--- zle_misc.c  Fri Aug  2 16:55:55 1996
***************
*** 1279,1280 ****
--- 1279,1285 ----
      }
+     /* Terminate the string */
+     if (! *fm) {
+       addbufspc(1);
+       pputc(*fm);
+     }

