From zsh-workers-request@euclid.skiles.gatech.edu Mon Feb 17 07:28:23 1997
Return-Path: <zsh-workers-request@euclid.skiles.gatech.edu>
Delivered-To: mason@primenet.com.au
Received: (qmail 14530 invoked from network); 17 Feb 1997 07:28:21 -0000
Received: from euclid.skiles.gatech.edu (list@130.207.146.50)
  by coral.primenet.com.au with SMTP; 17 Feb 1997 07:28:21 -0000
Received: (from list@localhost) by euclid.skiles.gatech.edu (8.7.3/8.7.3) id BAA11224; Mon, 17 Feb 1997 01:47:32 -0500 (EST)
Resent-Date: Mon, 17 Feb 1997 01:47:32 -0500 (EST)
From: gwing@primenet.com.au
Message-ID: <19970217064928.14467.qmail@primenet.com.au>
Subject: zsh-3.1.1 on NetBSD patch & problems
To: zsh-workers@math.gatech.edu (zsh-workers)
Date: Mon, 17 Feb 1997 17:49:28 +1100 (EST)
X-Mailer: ELM [version 2.4 PL25]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Resent-Message-ID: <"zeFkc3.0.Jl2.3y_1p"@euclid>
Resent-From: zsh-workers@math.gatech.edu
X-Mailing-List: <zsh-workers@math.gatech.edu> archive/latest/2901
X-Loop: zsh-workers@math.gatech.edu
Precedence: list
Resent-Sender: zsh-workers-request@math.gatech.edu

Heyla,
I've set up zsh to use modules on NetBSD
This is on NetBSD 1.2C .  Similar systems like OpenBSD and FreeBSD may
work with the same things.

A couple of things:

1) What's happened to default compctls?
% zsh-3.0.0 -f
% compctl
bindkey -b
builtin -c
export -v
setopt -o
typeset -v
unset -v
unsetopt -o
vared -v
which -c
COMMAND -c
DEFAULT -f
FIRST

% zsh-3.1.1 -f
% compctl
COMMAND -c
DEFAULT -f
FIRST


2) NetBSD make has lots of problems with the Makefile:
 2a) Zle/* stuff doesn't get built the first time you ``make'' in Src.
 2b) if you've made everything, then ``make'' without changing everything,
     everything is rebuilt.
 Of course, GNU make works fine.

3) why is -pedantic set for --enable-debug ?

4) How about `important' changes like
      * Src/options.c: set ALWAYSLASTPROMPT, APPENDHISTORY, AUTOLIST,
	AUTOMENU, AUTOPARAMKEYS, AUTOPARAMSLASH, AUTOREMOVESLASH,
	LISTAMBIGUOUS, LISTTYPES options by default
   going into Etc/NEWS

5) On NetBSD:
 ``ld -x -Bshareable -o foo.so foo..o''
seems to be doing the same thing as
 ``ar r foo.a foo..o bar..o
   ranlib foo.a
   ld -x -Bshareable -Bforcearchive -o foo.so foo.a''
which is the standard way NetBSD does shared libraries. 
The first form is compatible with the current zsh Makefile style.  The second
would require several changes.  Hopefully, the first form will always work 
like the second.

6) I had something else, but I can't think of it now, so here's the patch.


*** configure.in	1997/01/25 19:00:07	3.1.1.11
--- configure.in	1997/02/17 05:53:09
***************
*** 208,214 ****
  fi
  if test -n "$auto_ldflags"; then
    if test "${enable_zsh_debug}" = yes; then
!     LDFLAGS=-g
    fi
  fi
  
--- 208,217 ----
  fi
  if test -n "$auto_ldflags"; then
    if test "${enable_zsh_debug}" = yes; then
!     case "$host_os" in
!       netbsd*)    LDFLAGS="" ;;
!       *)          LDFLAGS=-g ;;
!     esac
    fi
  fi
  
***************
*** 821,826 ****
--- 824,830 ----
      solaris*)     DLLDFLAGS="${DLLDFLAGS=-G}" ;;
      sunos*)       DLLDFLAGS="${DLLDFLAGS=-assert nodefinitions}" ;;
      sysv4*|esix*) DLLDFLAGS="${DLLDFLAGS=-G $ldflags}" ;;
+     netbsd*)      DLLDFLAGS="${DLLDFLAGS=-x -Bshareable}" ;;
    esac
    case "$host_os" in
      hpux*)  EXTRA_LDFLAGS="${EXTRA_LDFLAGS=-Wl,-E}" ;;


-- 
Geoff Wing [gwing@primenet.com.au]   Technical Manager
  Phone    : +61-3-9818 2977         PrimeNet - Internet Consultancy
  Facsimile: +61-3-9819 3788         Web : <URL:http://www.primenet.com.au/>
  Mobile   : 0412 162 441

